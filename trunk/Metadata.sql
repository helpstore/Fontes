/******************************************************************************/
/****         Generated by IBExpert 2006.12.13 26/10/2011 02:21:57         ****/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES NONE;

CREATE DATABASE 'localhost:D:\Sistemas\Manager\Dados\comparer\MANAGER_PADRAO.GDB'
USER 'SYSDBA' PASSWORD 'sbrsige'
PAGE_SIZE 4096
DEFAULT CHARACTER SET NONE;



/******************************************************************************/
/****                               Domains                                ****/
/******************************************************************************/

CREATE DOMAIN DACTIONS AS
VARCHAR(500);

CREATE DOMAIN DALIQUOTA AS
VARCHAR(5);

CREATE DOMAIN DALIQUOTAECF AS
CHAR(5);

CREATE DOMAIN DANO AS
SMALLINT;

CREATE DOMAIN DCEP AS
VARCHAR(8);

CREATE DOMAIN DCHAR AS
CHAR(1);

CREATE DOMAIN DCHAR10 AS
VARCHAR(10);

CREATE DOMAIN DCHAR15 AS
VARCHAR(15);

CREATE DOMAIN DCHAR2 AS
CHAR(2);

CREATE DOMAIN DCHAR3 AS
CHAR(3);

CREATE DOMAIN DCHAR4 AS
VARCHAR(4);

CREATE DOMAIN DCHAR6 AS
VARCHAR(6);

CREATE DOMAIN DCHAR80 AS
VARCHAR(80);

CREATE DOMAIN DCNPJ AS
CHAR(14);

CREATE DOMAIN DCODIGO AS
INTEGER;

CREATE DOMAIN DCODIGOPROD AS
VARCHAR(15);

CREATE DOMAIN DCODIGOTRIB AS
SMALLINT;

CREATE DOMAIN DCODORIGEM AS
SMALLINT;

CREATE DOMAIN DCONSMUIDOR_REVENDA AS
CHAR(1);

CREATE DOMAIN DCPFCGC AS
VARCHAR(15);

CREATE DOMAIN DDATA AS
TIMESTAMP;

CREATE DOMAIN DDATA2 AS
DATE;

CREATE DOMAIN DDEBITO_CREDITO AS
CHAR(1);

CREATE DOMAIN DDESCRICAO AS
VARCHAR(30);

CREATE DOMAIN DDOCUMENTO AS
VARCHAR(20);

CREATE DOMAIN DEMAIL AS
VARCHAR(80);

CREATE DOMAIN DENDERECO AS
VARCHAR(40);

CREATE DOMAIN DES AS
CHAR(1)
DEFAULT 'E';

CREATE DOMAIN DFLOAT AS
FLOAT;

CREATE DOMAIN DFONE AS
VARCHAR(20);

CREATE DOMAIN DFREQUENCIA AS
CHAR(3);

CREATE DOMAIN DHISTORICO AS
VARCHAR(100);

CREATE DOMAIN DHISTORICO2 AS
VARCHAR(300);

CREATE DOMAIN DINTEIRO AS
SMALLINT;

CREATE DOMAIN DINTERESTADUAL AS
CHAR(1)
DEFAULT 'E';

CREATE DOMAIN DINTERIRO AS
SMALLINT;

CREATE DOMAIN DLOCAL AS
SMALLINT;

CREATE DOMAIN DLOGICO AS
CHAR(1)
DEFAULT 'N';

CREATE DOMAIN DLOGIN AS
VARCHAR(10);

CREATE DOMAIN DMENSAGEM AS
VARCHAR(80);

CREATE DOMAIN DMESES AS
SMALLINT;

CREATE DOMAIN DMN_BIGINT AS
BIGINT;

CREATE DOMAIN DMN_BLOB_TEXT AS
BLOB SUB_TYPE 1 SEGMENT SIZE 200 CHARACTER SET ASCII;

CREATE DOMAIN DMN_DOUBLE AS
DOUBLE PRECISION;

CREATE DOMAIN DMN_INDICE_COBRANCA AS
VARCHAR(70);

CREATE DOMAIN "DMN_VARCHAR(100)" AS
VARCHAR(100);

CREATE DOMAIN DNIVEL AS
CHAR(1)
DEFAULT '1';

CREATE DOMAIN DNOME AS
VARCHAR(50);

CREATE DOMAIN DNOMETABELA AS
VARCHAR(31);

CREATE DOMAIN DNUMCNH AS
CHAR(11);

CREATE DOMAIN DNUMERO_END AS
VARCHAR(15);

CREATE DOMAIN DNUMERO_LOTE AS
VARCHAR(20);

CREATE DOMAIN DOBJETO AS
VARCHAR(30);

CREATE DOMAIN DOBS AS
BLOB SUB_TYPE 0 SEGMENT SIZE 80;

CREATE DOMAIN DORIGEM AS
CHAR(3);

CREATE DOMAIN DPATH AS
VARCHAR(100);

CREATE DOMAIN DPERIODO AS
CHAR(1);

CREATE DOMAIN DPESSOA AS
CHAR(1)
DEFAULT 'M';

CREATE DOMAIN DPLACA AS
CHAR(8);

CREATE DOMAIN DPORCENTAGEM AS
NUMERIC(12,2);

CREATE DOMAIN DPROCESSADO AS
CHAR(1)
DEFAULT 'N';

CREATE DOMAIN DQTD AS
INTEGER
DEFAULT 0;

CREATE DOMAIN DQUANTIDADE AS
NUMERIC(18,4);

CREATE DOMAIN DRGIE AS
VARCHAR(15);

CREATE DOMAIN DSENHA AS
VARCHAR(20);

CREATE DOMAIN DSERIE AS
VARCHAR(5);

CREATE DOMAIN DSIGLAUM AS
CHAR(4);

CREATE DOMAIN DSN AS
CHAR(1)
DEFAULT 'S';

CREATE DOMAIN DSYSMSG AS
VARCHAR(120);

CREATE DOMAIN DTIME AS
TIME;

CREATE DOMAIN DTIPOCNH AS
CHAR(3);

CREATE DOMAIN DTIPODL AS
CHAR(1)
DEFAULT 'L';

CREATE DOMAIN DTIPOJURO AS
CHAR(1)
DEFAULT 'S';

CREATE DOMAIN DTIPO_CHEQUE AS
CHAR(2);

CREATE DOMAIN DTIPO_FATURA AS
VARCHAR(11);

CREATE DOMAIN DUF AS
CHAR(2)
DEFAULT 'MS';

CREATE DOMAIN DVALOR AS
NUMERIC(18,4)
DEFAULT 0;

CREATE DOMAIN DVALOR2 AS
NUMERIC(18,2);

CREATE DOMAIN DVALOR_EXT AS
NUMERIC(18,5);

CREATE DOMAIN "DVARCHAR(16)" AS
VARCHAR(16);

CREATE DOMAIN "DVARCHAR(2)" AS
VARCHAR(2);

CREATE DOMAIN "DVARCHAR(20)" AS
VARCHAR(20);

CREATE DOMAIN "DVARCHAR(30" AS
VARCHAR(30);

CREATE DOMAIN "DVARCHAR(40)" AS
VARCHAR(40);

CREATE DOMAIN "DVARCHAR(7)" AS
VARCHAR(7);

CREATE DOMAIN DVARCHAR180 AS
VARCHAR(180);

CREATE DOMAIN DVARCHAR200 AS
VARCHAR(200);

CREATE DOMAIN DVARCHAR5 AS
VARCHAR(5);

CREATE DOMAIN DVARCHAR600 AS
VARCHAR(600);

CREATE DOMAIN DVARCHAR80 AS
VARCHAR(80);

CREATE DOMAIN NEW_DOMAIN AS
SMALLINT;



/******************************************************************************/
/****                              Generators                              ****/
/******************************************************************************/

CREATE GENERATOR CRG_CARGAS_GE;
SET GENERATOR CRG_CARGAS_GE TO 0;

CREATE GENERATOR CRG_ROTAS_GE;
SET GENERATOR CRG_ROTAS_GE TO 0;

CREATE GENERATOR CTB_CONFIG_REL_GE;
SET GENERATOR CTB_CONFIG_REL_GE TO 0;

CREATE GENERATOR EST_AGRUPADOR_GE;
SET GENERATOR EST_AGRUPADOR_GE TO 0;

CREATE GENERATOR EST_ALTPRECOS_GE;
SET GENERATOR EST_ALTPRECOS_GE TO 0;

CREATE GENERATOR EST_ALTPRECOS_GRUPO_GE;
SET GENERATOR EST_ALTPRECOS_GRUPO_GE TO 0;

CREATE GENERATOR EST_ALTPRECOS_MARCA_GE;
SET GENERATOR EST_ALTPRECOS_MARCA_GE TO 0;

CREATE GENERATOR EST_ALTPRECO_UNID_GE;
SET GENERATOR EST_ALTPRECO_UNID_GE TO 0;

CREATE GENERATOR EST_APLICACOES_GE;
SET GENERATOR EST_APLICACOES_GE TO 0;

CREATE GENERATOR EST_CONTAGEM_GE;
SET GENERATOR EST_CONTAGEM_GE TO 0;

CREATE GENERATOR EST_COR_GE;
SET GENERATOR EST_COR_GE TO 0;

CREATE GENERATOR EST_ENTRADAS_MANUAL_GE;
SET GENERATOR EST_ENTRADAS_MANUAL_GE TO 0;

CREATE GENERATOR EST_ENTRADAS_PARC_GE;
SET GENERATOR EST_ENTRADAS_PARC_GE TO 134;

CREATE GENERATOR EST_GRADES_GE;
SET GENERATOR EST_GRADES_GE TO 0;

CREATE GENERATOR EST_GRUPOS_GE;
SET GENERATOR EST_GRUPOS_GE TO 15;

CREATE GENERATOR EST_KARDEX_GE;
SET GENERATOR EST_KARDEX_GE TO 2506;

CREATE GENERATOR EST_LOTE_GE;
SET GENERATOR EST_LOTE_GE TO 31;

CREATE GENERATOR EST_MARCAS_GE;
SET GENERATOR EST_MARCAS_GE TO 41;

CREATE GENERATOR EST_MATERIAL_GE;
SET GENERATOR EST_MATERIAL_GE TO 0;

CREATE GENERATOR EST_NATUREZA_GE;
SET GENERATOR EST_NATUREZA_GE TO 0;

CREATE GENERATOR EST_PERFIL_GRADES_GE;
SET GENERATOR EST_PERFIL_GRADES_GE TO 0;

CREATE GENERATOR EST_PRODUTOS_GE;
SET GENERATOR EST_PRODUTOS_GE TO 155;

CREATE GENERATOR EST_REDUCOES_GE;
SET GENERATOR EST_REDUCOES_GE TO 1;

CREATE GENERATOR FAT_CAIXAS_SANGRIA_GE;
SET GENERATOR FAT_CAIXAS_SANGRIA_GE TO 0;

CREATE GENERATOR FAT_CARTA_GARANTIA_GE;
SET GENERATOR FAT_CARTA_GARANTIA_GE TO 0;

CREATE GENERATOR FAT_COTACOES_GE;
SET GENERATOR FAT_COTACOES_GE TO 0;

CREATE GENERATOR FAT_GARANTIAS_GE;
SET GENERATOR FAT_GARANTIAS_GE TO 0;

CREATE GENERATOR FAT_MESAS_GE;
SET GENERATOR FAT_MESAS_GE TO 0;

CREATE GENERATOR FAT_NOTAS_GE;
SET GENERATOR FAT_NOTAS_GE TO 0;

CREATE GENERATOR FAT_ORCAMENTOS_GE;
SET GENERATOR FAT_ORCAMENTOS_GE TO 2;

CREATE GENERATOR FAT_ORCAMENTO_MASCARA_GE;
SET GENERATOR FAT_ORCAMENTO_MASCARA_GE TO 0;

CREATE GENERATOR FAT_PDV_GE;
SET GENERATOR FAT_PDV_GE TO 0;

CREATE GENERATOR FAT_TERCEIROS_GE;
SET GENERATOR FAT_TERCEIROS_GE TO 0;

CREATE GENERATOR FAT_TROCAS_GE;
SET GENERATOR FAT_TROCAS_GE TO 4;

CREATE GENERATOR FAT_VENDAS_GE;
SET GENERATOR FAT_VENDAS_GE TO 528;

CREATE GENERATOR FAT_VENDAS_ITENS_ID;
SET GENERATOR FAT_VENDAS_ITENS_ID TO 0;

CREATE GENERATOR FAT_VENDEDOR_GE;
SET GENERATOR FAT_VENDEDOR_GE TO 7;

CREATE GENERATOR FIN_ADMINISTRADORA_GE;
SET GENERATOR FIN_ADMINISTRADORA_GE TO 1;

CREATE GENERATOR FIN_BAIXA_PAGAR_GE;
SET GENERATOR FIN_BAIXA_PAGAR_GE TO 539;

CREATE GENERATOR FIN_BAIXA_RECEBER_GE;
SET GENERATOR FIN_BAIXA_RECEBER_GE TO 631;

CREATE GENERATOR FIN_CARTAO_GE;
SET GENERATOR FIN_CARTAO_GE TO 13;

CREATE GENERATOR FIN_CENTRO_CUSTO_GE;
SET GENERATOR FIN_CENTRO_CUSTO_GE TO 0;

CREATE GENERATOR FIN_COBRADOR_GE;
SET GENERATOR FIN_COBRADOR_GE TO 2;

CREATE GENERATOR FIN_FATURAS_PARCELAS_GE;
SET GENERATOR FIN_FATURAS_PARCELAS_GE TO 0;

CREATE GENERATOR FIN_FATURA_GE;
SET GENERATOR FIN_FATURA_GE TO 0;

CREATE GENERATOR FIN_FATURA_PARCIAL_GE;
SET GENERATOR FIN_FATURA_PARCIAL_GE TO 0;

CREATE GENERATOR FIN_FORMAS_PAGTO_GE;
SET GENERATOR FIN_FORMAS_PAGTO_GE TO 12;

CREATE GENERATOR FIN_HAVER_BAIXA_GE;
SET GENERATOR FIN_HAVER_BAIXA_GE TO 0;

CREATE GENERATOR FIN_HAVER_GE;
SET GENERATOR FIN_HAVER_GE TO 0;

CREATE GENERATOR FIN_LOCAL_COBRANCA_GE;
SET GENERATOR FIN_LOCAL_COBRANCA_GE TO 2;

CREATE GENERATOR FIN_LOTE_CHEQUE_GE;
SET GENERATOR FIN_LOTE_CHEQUE_GE TO 0;

CREATE GENERATOR FIN_MOTIVO_COBRANCA_GE;
SET GENERATOR FIN_MOTIVO_COBRANCA_GE TO 1;

CREATE GENERATOR FIN_MOTIVO_DEVOLUCAO_GE;
SET GENERATOR FIN_MOTIVO_DEVOLUCAO_GE TO 0;

CREATE GENERATOR FIN_PAGAR_ANO_GE;
SET GENERATOR FIN_PAGAR_ANO_GE TO 2010;

CREATE GENERATOR FIN_PAGAR_COD_GE;
SET GENERATOR FIN_PAGAR_COD_GE TO 2;

CREATE GENERATOR FIN_PAGAR_GE;
SET GENERATOR FIN_PAGAR_GE TO 2006;

CREATE GENERATOR FIN_PLANILHA_GE;
SET GENERATOR FIN_PLANILHA_GE TO 1111;

CREATE GENERATOR FIN_RECEBER_ANO_GE;
SET GENERATOR FIN_RECEBER_ANO_GE TO 2006;

CREATE GENERATOR FIN_RECEBER_COD_GE;
SET GENERATOR FIN_RECEBER_COD_GE TO 1435;

CREATE GENERATOR FIN_RECEBER_GE;
SET GENERATOR FIN_RECEBER_GE TO 0;

CREATE GENERATOR FIN_RECIBOS_GE;
SET GENERATOR FIN_RECIBOS_GE TO 172;

CREATE GENERATOR FIN_RECIBOS_PAGAS;
SET GENERATOR FIN_RECIBOS_PAGAS TO 0;

CREATE GENERATOR FIN_RECIBOS_PAGAS_GE;
SET GENERATOR FIN_RECIBOS_PAGAS_GE TO 273;

CREATE GENERATOR GEN_ACT_ACERTOCONTA_ID;
SET GENERATOR GEN_ACT_ACERTOCONTA_ID TO 132;

CREATE GENERATOR GEN_ACT_CONFIGURACAOTITULO_ID;
SET GENERATOR GEN_ACT_CONFIGURACAOTITULO_ID TO 35;

CREATE GENERATOR GEN_ACT_EVENTOCONTABIL_ID;
SET GENERATOR GEN_ACT_EVENTOCONTABIL_ID TO 0;

CREATE GENERATOR GEN_ACT_TITULOGERADO_ID;
SET GENERATOR GEN_ACT_TITULOGERADO_ID TO 125;

CREATE GENERATOR GEN_AGR_CATEGORIA_DEFENSIVO_ID;
SET GENERATOR GEN_AGR_CATEGORIA_DEFENSIVO_ID TO 100;

CREATE GENERATOR GEN_AGR_CLASSE_TOXICOLOGICA_ID;
SET GENERATOR GEN_AGR_CLASSE_TOXICOLOGICA_ID TO 4;

CREATE GENERATOR GEN_AGR_CLASSIFICAO_QUIMICA_ID;
SET GENERATOR GEN_AGR_CLASSIFICAO_QUIMICA_ID TO 170;

CREATE GENERATOR GEN_AGR_CLASS_AMBIENTAL_ID;
SET GENERATOR GEN_AGR_CLASS_AMBIENTAL_ID TO 7;

CREATE GENERATOR GEN_AGR_CULTURA_ID;
SET GENERATOR GEN_AGR_CULTURA_ID TO 0;

CREATE GENERATOR GEN_AGR_DEFENSIVO_AGRICOLA_ID;
SET GENERATOR GEN_AGR_DEFENSIVO_AGRICOLA_ID TO 0;

CREATE GENERATOR GEN_AGR_FABRICANTE_ID;
SET GENERATOR GEN_AGR_FABRICANTE_ID TO 23;

CREATE GENERATOR GEN_AGR_MAT_EMBALAGEM_ID;
SET GENERATOR GEN_AGR_MAT_EMBALAGEM_ID TO 6;

CREATE GENERATOR GEN_AGR_MEDIDA_DOSAGEM_ID;
SET GENERATOR GEN_AGR_MEDIDA_DOSAGEM_ID TO 9;

CREATE GENERATOR GEN_AGR_PRAGA_ID;
SET GENERATOR GEN_AGR_PRAGA_ID TO 435;

CREATE GENERATOR GEN_AGR_RECEITAS_ID;
SET GENERATOR GEN_AGR_RECEITAS_ID TO 350;

CREATE GENERATOR GEN_AGR_REGISTRANTE_ID;
SET GENERATOR GEN_AGR_REGISTRANTE_ID TO 1;

CREATE GENERATOR GEN_BCH_CODIGO;
SET GENERATOR GEN_BCH_CODIGO TO 1;

CREATE GENERATOR GEN_CM2_ACERTO_COMISSAO_ID;
SET GENERATOR GEN_CM2_ACERTO_COMISSAO_ID TO 0;

CREATE GENERATOR GEN_CM2_COMISSAO_PARC_ID;
SET GENERATOR GEN_CM2_COMISSAO_PARC_ID TO 373;

CREATE GENERATOR GEN_CM2_PARC_ACERTO_ID;
SET GENERATOR GEN_CM2_PARC_ACERTO_ID TO 0;

CREATE GENERATOR GEN_CM_COMISSAO_ID;
SET GENERATOR GEN_CM_COMISSAO_ID TO 225;

CREATE GENERATOR GEN_CM_COMISSAO_PARC_ID;
SET GENERATOR GEN_CM_COMISSAO_PARC_ID TO 244;

CREATE GENERATOR GEN_CM_LOG_ID;
SET GENERATOR GEN_CM_LOG_ID TO 0;

CREATE GENERATOR GEN_CM_PARC_PAGAR_ID;
SET GENERATOR GEN_CM_PARC_PAGAR_ID TO 0;

CREATE GENERATOR GEN_CM_PERFIL_FAIXA_DESC_ID;
SET GENERATOR GEN_CM_PERFIL_FAIXA_DESC_ID TO 0;

CREATE GENERATOR GEN_CM_PERFIL_FAIXA_ID;
SET GENERATOR GEN_CM_PERFIL_FAIXA_ID TO 0;

CREATE GENERATOR GEN_CM_PERFIL_FAIXA_PROD_ID;
SET GENERATOR GEN_CM_PERFIL_FAIXA_PROD_ID TO 0;

CREATE GENERATOR GEN_CM_PERFIL_ID;
SET GENERATOR GEN_CM_PERFIL_ID TO 2;

CREATE GENERATOR GEN_CM_PERFIL_PAGTO_FAIXA_ID;
SET GENERATOR GEN_CM_PERFIL_PAGTO_FAIXA_ID TO 0;

CREATE GENERATOR GEN_CM_PERFIL_PAGTO_ID;
SET GENERATOR GEN_CM_PERFIL_PAGTO_ID TO 0;

CREATE GENERATOR GEN_CM_REL_COM_PGR_REC_ID;
SET GENERATOR GEN_CM_REL_COM_PGR_REC_ID TO 307;

CREATE GENERATOR GEN_CRG_FORMAR_CARGA_ID;
SET GENERATOR GEN_CRG_FORMAR_CARGA_ID TO 0;

CREATE GENERATOR GEN_CRG_ORDEM_CARGA_ID;
SET GENERATOR GEN_CRG_ORDEM_CARGA_ID TO 0;

CREATE GENERATOR GEN_CRG_ORDEM_CARGA_ITENS_ID;
SET GENERATOR GEN_CRG_ORDEM_CARGA_ITENS_ID TO 0;

CREATE GENERATOR GEN_DEFENSIVOCULTURAPRAGA_ID;
SET GENERATOR GEN_DEFENSIVOCULTURAPRAGA_ID TO 84;

CREATE GENERATOR GEN_EMAIL_POS_EST_ITENS_ID;
SET GENERATOR GEN_EMAIL_POS_EST_ITENS_ID TO 0;

CREATE GENERATOR GEN_EST_ALTERA_PRECO_ID;
SET GENERATOR GEN_EST_ALTERA_PRECO_ID TO 0;

CREATE GENERATOR GEN_EST_ALTERA_PRECO_ITEM_ID;
SET GENERATOR GEN_EST_ALTERA_PRECO_ITEM_ID TO 0;

CREATE GENERATOR GEN_EST_CLASSE_GRAO_ID;
SET GENERATOR GEN_EST_CLASSE_GRAO_ID TO 0;

CREATE GENERATOR GEN_EST_CONVERSAO_UNID_MED_ID;
SET GENERATOR GEN_EST_CONVERSAO_UNID_MED_ID TO 0;

CREATE GENERATOR GEN_EST_EMAIL_ESTOQUE_ID;
SET GENERATOR GEN_EST_EMAIL_ESTOQUE_ID TO 0;

CREATE GENERATOR GEN_EST_ENTRADAS_COD_INTERNO;
SET GENERATOR GEN_EST_ENTRADAS_COD_INTERNO TO 75;

CREATE GENERATOR GEN_EST_ENTRADAS_ITENS_LOTES_ID;
SET GENERATOR GEN_EST_ENTRADAS_ITENS_LOTES_ID TO 79;

CREATE GENERATOR GEN_EST_HISTORICO_PRD_CUSTO_ID;
SET GENERATOR GEN_EST_HISTORICO_PRD_CUSTO_ID TO 63;

CREATE GENERATOR "GEN_EST_LOCALIZACAO _ID";
SET GENERATOR "GEN_EST_LOCALIZACAO _ID" TO 0;

CREATE GENERATOR GEN_EST_LOCALIZACAO_ID;
SET GENERATOR GEN_EST_LOCALIZACAO_ID TO 0;

CREATE GENERATOR GEN_EST_LOTE_ID;
SET GENERATOR GEN_EST_LOTE_ID TO 0;

CREATE GENERATOR GEN_EST_LOTE_SEMENTES_ID;
SET GENERATOR GEN_EST_LOTE_SEMENTES_ID TO 0;

CREATE GENERATOR GEN_EST_PENEIRA_ID;
SET GENERATOR GEN_EST_PENEIRA_ID TO 0;

CREATE GENERATOR GEN_EST_PRODUTOS_AGREGADOS_ID;
SET GENERATOR GEN_EST_PRODUTOS_AGREGADOS_ID TO 0;

CREATE GENERATOR GEN_EST_PRODUTOS_SIMILARES_ID;
SET GENERATOR GEN_EST_PRODUTOS_SIMILARES_ID TO 0;

CREATE GENERATOR GEN_EST_SECAO_ID;
SET GENERATOR GEN_EST_SECAO_ID TO 0;

CREATE GENERATOR GEN_EST_TIPO_GRAO_ID;
SET GENERATOR GEN_EST_TIPO_GRAO_ID TO 0;

CREATE GENERATOR GEN_EXP_CTB_CF_PROSOFT_ALIQ_ID;
SET GENERATOR GEN_EXP_CTB_CF_PROSOFT_ALIQ_ID TO 0;

CREATE GENERATOR GEN_EXP_CTB_CF_PROSOFT_ID;
SET GENERATOR GEN_EXP_CTB_CF_PROSOFT_ID TO 0;

CREATE GENERATOR GEN_FAT_ITEMTABELAPRECO_ID;
SET GENERATOR GEN_FAT_ITEMTABELAPRECO_ID TO 0;

CREATE GENERATOR GEN_FAT_MICRO_TERMINAL_ID;
SET GENERATOR GEN_FAT_MICRO_TERMINAL_ID TO 0;

CREATE GENERATOR GEN_FAT_TABELAPRECO_ID;
SET GENERATOR GEN_FAT_TABELAPRECO_ID TO 0;

CREATE GENERATOR GEN_FAT_TBL_VD_TABELA_ID;
SET GENERATOR GEN_FAT_TBL_VD_TABELA_ID TO 0;

CREATE GENERATOR GEN_FAT_TBL_VENDEDOR_ID;
SET GENERATOR GEN_FAT_TBL_VENDEDOR_ID TO 0;

CREATE GENERATOR GEN_FAT_VENDEDOR_TBL_PRECO_ID;
SET GENERATOR GEN_FAT_VENDEDOR_TBL_PRECO_ID TO 0;

CREATE GENERATOR GEN_FIN_COTACOES_ID;
SET GENERATOR GEN_FIN_COTACOES_ID TO 1;

CREATE GENERATOR GEN_FIN_FOLHA_PAGTO_ID;
SET GENERATOR GEN_FIN_FOLHA_PAGTO_ID TO 104;

CREATE GENERATOR GEN_FIN_FOLHA_TIPO_MOVIMENTO_ID;
SET GENERATOR GEN_FIN_FOLHA_TIPO_MOVIMENTO_ID TO 10;

CREATE GENERATOR GEN_FIN_MOEDA_ID;
SET GENERATOR GEN_FIN_MOEDA_ID TO 1;

CREATE GENERATOR GEN_FORMAS_PAGTO_PARC_ID;
SET GENERATOR GEN_FORMAS_PAGTO_PARC_ID TO 0;

CREATE GENERATOR GEN_GLO_CLIENTES_PRODUTOS_ID;
SET GENERATOR GEN_GLO_CLIENTES_PRODUTOS_ID TO 0;

CREATE GENERATOR GEN_GLO_CLI_PROD_ITENS_ID;
SET GENERATOR GEN_GLO_CLI_PROD_ITENS_ID TO 0;

CREATE GENERATOR GEN_GLO_CONTATOS_ID;
SET GENERATOR GEN_GLO_CONTATOS_ID TO 72;

CREATE GENERATOR GEN_GLO_MODELO_DOCUMENTO_ID;
SET GENERATOR GEN_GLO_MODELO_DOCUMENTO_ID TO 0;

CREATE GENERATOR GEN_GLO_PAIS_ID;
SET GENERATOR GEN_GLO_PAIS_ID TO 0;

CREATE GENERATOR GEN_GLO_TIPO_CONTATO_ID;
SET GENERATOR GEN_GLO_TIPO_CONTATO_ID TO 12;

CREATE GENERATOR GEN_GLO_VEICULOS_ID;
SET GENERATOR GEN_GLO_VEICULOS_ID TO 14;

CREATE GENERATOR GEN_ITENS_COMISSOES_ID;
SET GENERATOR GEN_ITENS_COMISSOES_ID TO 1949;

CREATE GENERATOR GEN_LOG_FAT_VENDAS_ID;
SET GENERATOR GEN_LOG_FAT_VENDAS_ID TO 645;

CREATE GENERATOR GEN_NFE_XML_LOG_ID;
SET GENERATOR GEN_NFE_XML_LOG_ID TO 0;

CREATE GENERATOR GEN_OFC_CONTRATOS_ID;
SET GENERATOR GEN_OFC_CONTRATOS_ID TO 0;

CREATE GENERATOR GEN_OFC_CONTRATOS_ITENS_DESC_ID;
SET GENERATOR GEN_OFC_CONTRATOS_ITENS_DESC_ID TO 0;

CREATE GENERATOR GEN_OFC_CONTRATOS_ITENS_ID;
SET GENERATOR GEN_OFC_CONTRATOS_ITENS_ID TO 0;

CREATE GENERATOR GEN_OFC_GRP_CONTRATOS_ID;
SET GENERATOR GEN_OFC_GRP_CONTRATOS_ID TO 0;

CREATE GENERATOR GEN_OFC_GRP_CONTRATOS_ITENS_ID;
SET GENERATOR GEN_OFC_GRP_CONTRATOS_ITENS_ID TO 0;

CREATE GENERATOR GEN_OFC_INTERVALO;
SET GENERATOR GEN_OFC_INTERVALO TO 21;

CREATE GENERATOR GEN_OFC_LEITURAS_ID;
SET GENERATOR GEN_OFC_LEITURAS_ID TO 75;

CREATE GENERATOR GEN_OFC_LEITURAS_ITENS_ID;
SET GENERATOR GEN_OFC_LEITURAS_ITENS_ID TO 0;

CREATE GENERATOR GEN_OFC_LOG_STATUS_ID;
SET GENERATOR GEN_OFC_LOG_STATUS_ID TO 5;

CREATE GENERATOR GEN_OFC_MENSALIDADES_ID;
SET GENERATOR GEN_OFC_MENSALIDADES_ID TO 0;

CREATE GENERATOR GEN_OFC_MENSALIDADES_ITENS_ID;
SET GENERATOR GEN_OFC_MENSALIDADES_ITENS_ID TO 0;

CREATE GENERATOR GEN_OFC_MOTIVO_CHAMADO_ID;
SET GENERATOR GEN_OFC_MOTIVO_CHAMADO_ID TO 2;

CREATE GENERATOR GEN_OFC_ORDEM_MOVTOS_GE;
SET GENERATOR GEN_OFC_ORDEM_MOVTOS_GE TO 0;

CREATE GENERATOR GEN_OFC_OS_ANEXOS_ID;
SET GENERATOR GEN_OFC_OS_ANEXOS_ID TO 2;

CREATE GENERATOR GEN_OFC_O_S_INTERVALO_EMAIL_ID;
SET GENERATOR GEN_OFC_O_S_INTERVALO_EMAIL_ID TO 2;

CREATE GENERATOR GEN_OFC_PENDENCIA_ID;
SET GENERATOR GEN_OFC_PENDENCIA_ID TO 0;

CREATE GENERATOR GEN_OFC_STATUS_ID;
SET GENERATOR GEN_OFC_STATUS_ID TO 6;

CREATE GENERATOR GEN_OFC_TIPO_ATENDIMENTO_ID;
SET GENERATOR GEN_OFC_TIPO_ATENDIMENTO_ID TO 4;

CREATE GENERATOR GEN_OFC_TIPO_MOVTO_ID;
SET GENERATOR GEN_OFC_TIPO_MOVTO_ID TO 0;

CREATE GENERATOR GEN_SINTEG_60M_ID;
SET GENERATOR GEN_SINTEG_60M_ID TO 0;

CREATE GENERATOR GEN_SIS_CONFIG_REL_ID;
SET GENERATOR GEN_SIS_CONFIG_REL_ID TO 0;

CREATE GENERATOR GEN_SIS_RELEASE_ID;
SET GENERATOR GEN_SIS_RELEASE_ID TO 0;

CREATE GENERATOR GEN_TBL_TESTE_ID;
SET GENERATOR GEN_TBL_TESTE_ID TO 0;

CREATE GENERATOR GEN_TEMP_CUSTO_MEDIO_ID;
SET GENERATOR GEN_TEMP_CUSTO_MEDIO_ID TO 0;

CREATE GENERATOR GEN_TIPO_ENDERECO;
SET GENERATOR GEN_TIPO_ENDERECO TO 4;

CREATE GENERATOR GLO_ATIVIDADES_GE;
SET GENERATOR GLO_ATIVIDADES_GE TO 15;

CREATE GENERATOR GLO_BAIRROS_GE;
SET GENERATOR GLO_BAIRROS_GE TO 40;

CREATE GENERATOR GLO_CIDADES_GE;
SET GENERATOR GLO_CIDADES_GE TO 32;

CREATE GENERATOR GLO_CLASSIFICACAO_GE;
SET GENERATOR GLO_CLASSIFICACAO_GE TO 1;

CREATE GENERATOR GLO_CLIENTE_ENDERECO;
SET GENERATOR GLO_CLIENTE_ENDERECO TO 16;

CREATE GENERATOR GLO_CONTRATOS_GE;
SET GENERATOR GLO_CONTRATOS_GE TO 0;

CREATE GENERATOR GLO_DECLARACAO_VENDA_GE;
SET GENERATOR GLO_DECLARACAO_VENDA_GE TO 0;

CREATE GENERATOR GLO_DEPARTAMENTO_GE;
SET GENERATOR GLO_DEPARTAMENTO_GE TO 0;

CREATE GENERATOR GLO_LOGRADOUROS_GE;
SET GENERATOR GLO_LOGRADOUROS_GE TO 210;

CREATE GENERATOR GLO_MARCA_VEICULO_GE;
SET GENERATOR GLO_MARCA_VEICULO_GE TO 7;

CREATE GENERATOR GLO_MODELOS_PROPRIEDADES_GE;
SET GENERATOR GLO_MODELOS_PROPRIEDADES_GE TO 1;

CREATE GENERATOR GLO_PATRIMONIO_GE;
SET GENERATOR GLO_PATRIMONIO_GE TO 0;

CREATE GENERATOR GLO_PECAS_GE;
SET GENERATOR GLO_PECAS_GE TO 0;

CREATE GENERATOR GLO_PESSOAS_FJ_GE;
SET GENERATOR GLO_PESSOAS_FJ_GE TO 319;

CREATE GENERATOR GLO_REGIAO_GE;
SET GENERATOR GLO_REGIAO_GE TO 31;

CREATE GENERATOR GLO_TIPO_VEICULO_GE;
SET GENERATOR GLO_TIPO_VEICULO_GE TO 8;

CREATE GENERATOR GLO_TRANSPORTASDORAS_GE;
SET GENERATOR GLO_TRANSPORTASDORAS_GE TO 2;

CREATE GENERATOR GNR_CONTROLE_PEDIDO_RESTAURANTE;
SET GENERATOR GNR_CONTROLE_PEDIDO_RESTAURANTE TO 0;

CREATE GENERATOR GNR_EST_CONTAGEM_GRADE;
SET GENERATOR GNR_EST_CONTAGEM_GRADE TO 34;

CREATE GENERATOR GNR_EST_CONTAGEM_GRADE_PRODUTO;
SET GENERATOR GNR_EST_CONTAGEM_GRADE_PRODUTO TO 160;

CREATE GENERATOR GNR_FIN_CHEQUES_ID;
SET GENERATOR GNR_FIN_CHEQUES_ID TO 20;

CREATE GENERATOR IBE$LOG_TABLES_GEN;
SET GENERATOR IBE$LOG_TABLES_GEN TO 0;

CREATE GENERATOR MOV_CONTABIL_GE;
SET GENERATOR MOV_CONTABIL_GE TO 673;

CREATE GENERATOR NEW_GENERATOR;
SET GENERATOR NEW_GENERATOR TO 0;

CREATE GENERATOR OFC_DEFEITO_GE;
SET GENERATOR OFC_DEFEITO_GE TO 5;

CREATE GENERATOR OFC_GRAVIDADE;
SET GENERATOR OFC_GRAVIDADE TO 3;

CREATE GENERATOR OFC_MECANICOS_GE;
SET GENERATOR OFC_MECANICOS_GE TO 2;

CREATE GENERATOR OFC_MOTORES_GE;
SET GENERATOR OFC_MOTORES_GE TO 0;

CREATE GENERATOR OFC_ORDEM_GE;
SET GENERATOR OFC_ORDEM_GE TO 26;

CREATE GENERATOR OFC_ORDEM_MOVTOS_GE;
SET GENERATOR OFC_ORDEM_MOVTOS_GE TO 3;

CREATE GENERATOR OFC_ORDEM_ORC_GE;
SET GENERATOR OFC_ORDEM_ORC_GE TO 0;

CREATE GENERATOR OFC_SERVICO_GE;
SET GENERATOR OFC_SERVICO_GE TO 0;

CREATE GENERATOR OFC_VIAJANTE_GE;
SET GENERATOR OFC_VIAJANTE_GE TO 0;

CREATE GENERATOR PLANO_GE;
SET GENERATOR PLANO_GE TO 21;

CREATE GENERATOR PST_ABASTECIMENTOS_GE;
SET GENERATOR PST_ABASTECIMENTOS_GE TO 0;

CREATE GENERATOR PST_BOMBAS_GE;
SET GENERATOR PST_BOMBAS_GE TO 0;

CREATE GENERATOR PST_CONTADOR_UGM_GE;
SET GENERATOR PST_CONTADOR_UGM_GE TO 0;

CREATE GENERATOR PST_LINHA_ABASTECIMENTOS_GE;
SET GENERATOR PST_LINHA_ABASTECIMENTOS_GE TO 0;

CREATE GENERATOR SIS_ETIQUETAS_GE;
SET GENERATOR SIS_ETIQUETAS_GE TO 0;

CREATE GENERATOR SIS_LOG_GE;
SET GENERATOR SIS_LOG_GE TO 662;

CREATE GENERATOR SIS_MENSAGENS_ANO_GE;
SET GENERATOR SIS_MENSAGENS_ANO_GE TO 2009;

CREATE GENERATOR SIS_MENSAGENS_COD_GE;
SET GENERATOR SIS_MENSAGENS_COD_GE TO 1;

CREATE GENERATOR SIS_MENSAGENS_GE;
SET GENERATOR SIS_MENSAGENS_GE TO 0;

CREATE GENERATOR SIS_MODULOS_GE;
SET GENERATOR SIS_MODULOS_GE TO 620;

CREATE GENERATOR SIS_PERFIL_GE;
SET GENERATOR SIS_PERFIL_GE TO 6;

CREATE GENERATOR SIS_USUARIOS_GE;
SET GENERATOR SIS_USUARIOS_GE TO 29;



/******************************************************************************/
/****                              Exceptions                              ****/
/******************************************************************************/

CREATE EXCEPTION ABRIR_CX 'Impossível abrir novo caixa.Caixa anterior ainda aberto.';

CREATE EXCEPTION AGRUPADORFISCAL 'Agrupadores Fiscais Nao Correspondem, Verifique!';

CREATE EXCEPTION ALT_PRC_PRD_DUPLICADO 'Erro. Produto duplicado no registro de alteração de preço';

CREATE EXCEPTION BAIXAHAVER 'O Valor Baixado e Maior que o Valor Devido, verifique!';

CREATE EXCEPTION BLOQUEIA_GERA_RECEBER 'Esta venda não irá gerar contas a receber pois é uma fatura futura!';

CREATE EXCEPTION BLOQUEIA_PAGAR 'Código de Contas à Pagar já utilizado. Contate suporte@softbr.net.';

CREATE EXCEPTION BLT_BANCO_PADRAO 'Não existe um banco definido como padrão para gerar boletos!';

CREATE EXCEPTION BLT_NOSSONUMERO 'Nosso número duplicado';

CREATE EXCEPTION CHEQUE_CONCILIADO 'Este Cheque está conciliado, portanto não pode ser selecionado novamente';

CREATE EXCEPTION CM_EST_COM 'Erro (Todas as parcelas de comissão precisam possuir o mesmo status)';

CREATE EXCEPTION CM_PG_BAIXADA 'Erro (Registro possui movimentos de Contas à Pagar baixados). Verifique';

CREATE EXCEPTION CM_PG_EXISTE 'Erro(Registro possui movimentos em Contas à Pagar). Verifique';

CREATE EXCEPTION CM_RELACAO 'Erro(Inconsistência no relacionamento de comissões). Verfique';

CREATE EXCEPTION CODIGO_SECUNDARIO_DUPLICADO 'Código Secundário Duplicado, Verifique!';

CREATE EXCEPTION COMISSAO_QUITADA 'Impossível estornar. Comissão de baixa já provisionada';

CREATE EXCEPTION CONSULTE_SUPORTE 'Procedimento retirado do sistema. Consulte suporte 3422-9791';

CREATE EXCEPTION CTB_VERIFICA_TIPO 'Tipo de Lancamento Invalido, Verifique!';

CREATE EXCEPTION DESCONTO_ACIMA 'Vlr. de desconto aplicado nos items está acima do vlr. permitido';

CREATE EXCEPTION DT_COBRANCA_INVALIDA 'Dt. de cobrança (''Cobrado Em'') inválido.';

CREATE EXCEPTION EST_COMPROMETIDO 'Impossível modificar status, orçamento já possui movimentos de venda';

CREATE EXCEPTION EXCLUI_ORCAMENTO 'Orçamento não pode ser excluído, existem vendas relacionadas';

CREATE EXCEPTION EXCLUSAO 'Exclusao Nao Permitida, Verifique!';

CREATE EXCEPTION EXCLUSAO_PLANILHA 'So e Permitido Excluir a Planilha Inteira, Verifique!';

CREATE EXCEPTION EXP_ESTORNA_BAIXA 'Impossível estornar. Existem movimentos de baixa realizados posteriormente';

CREATE EXCEPTION EXP_ESTORNA_TTGERADO 'Erro ao estornar. Existem movimentos de baixa nos títulos gerados pelo acerto';

CREATE EXCEPTION EXP_MOV_DUPLICADO 'Numero de documento duplicado. Verifique!';

CREATE EXCEPTION EXP_NFE1 'Impossível salvar. Numero de NFe (NUM_NF) já está contido em outro registro.';

CREATE EXCEPTION EXP_NFE2 'Impossível salvar. Número da NF difere da chave NFe.';

CREATE EXCEPTION EXP_NFE3 'Impossível salvar. Chave NFe já esta sendo utilizada em outro registro.';

CREATE EXCEPTION EXP_NFE4 'Impossível salvar.Chave NFe já está sendo utilizada em outro registro (NUM_NF)';

CREATE EXCEPTION EXP_NFE5 'Impossível salvar. Número da NF difere da chave NFe.';

CREATE EXCEPTION EXP_NFE6 'Impossível salvar. Número da NF difere da chave NFe.';

CREATE EXCEPTION FALHAATUAIZACAO 'Nem Um Registro Atualizado, Verifique!';

CREATE EXCEPTION FAT_VINCULADO 'Impossível faturar. Incoerência no vinculo de faturamento';

CREATE EXCEPTION FAT_VINCULADO_ITENS 'Impossível faturar. Incoerência no vínculo de itens no faturamento';

CREATE EXCEPTION FAT_VINCULADO_ITENS1 'EX 1';

CREATE EXCEPTION FAT_VINCULADO_ITENS2 'EX 2';

CREATE EXCEPTION MOVIMENTO_BANCARIO_DUPLICADO 'Impossível inserir este movimento bancário, número de documento já existente.';

CREATE EXCEPTION MOVIMENTO_CONCILIADO 'Este Movimento esta conciliado, por tanto, nao pode ser Alterado';

CREATE EXCEPTION MOV_CTCUSTO 'Este registro não pode ser agrupador pois possui movtos de baixa relacionados';

CREATE EXCEPTION NDOCTO_DUPLICADO 'Erro ao efetuar o lançamento. Numero de documento duplicado.';

CREATE EXCEPTION NF_DUPLICADO 'Este Nº de NF já foi utilizado por outro registro';

CREATE EXCEPTION NF_RELACAO 'Impossível salvar. Faturamento requere relacionamento';

CREATE EXCEPTION NOTADUPLICADA 'Numero de Nota Fiscal Duplicado, Verifique!';

CREATE EXCEPTION OFC_EXP_GRUPO_EMP 'Impossível inserir. Cliente já presente no grupo empresarial.';

CREATE EXCEPTION REC_VENDA 'Registro possui vínculo com Vendas, não pode ser modificado.';

CREATE EXCEPTION SEM_CAIXA_SELECIONADO 'Não existe um caixa selecionado para este movimento!';

CREATE EXCEPTION TESTE 'Recurso técnico não documentado!';

CREATE EXCEPTION VALIDA_ALTERA_CONTRATO 'O contrato não pode ser alterado, já existem itens para esta leitura.';

CREATE EXCEPTION VALIDA_ALT_PROD_ITEN_CONTRATO 'Impossível alterar. Existem atendimentos realizados para mesmo';

CREATE EXCEPTION VALIDA_COBRADOR 'Impossivel excluir. Cobrador possui registro em cobranças';

CREATE EXCEPTION VALIDA_COM_ITEM 'Percentual definido é inválido, Verifique.';

CREATE EXCEPTION VALIDA_CONTRATO 'Este Contrato Produto/Cliente possui registros dependentes. Impossível excluir';

CREATE EXCEPTION VALIDA_COTACAO_MOEDA 'Esta moeda já possui uma cotação para a data selecionada. Verifique';

CREATE EXCEPTION VALIDA_CTB_EXCLUSAO 'Impossível excluir movimento. Existem cheques emitidos relacioanados.';

CREATE EXCEPTION VALIDA_DELETE_ITEN_CONTRATO 'Impossível excluir, existem atendimentos para o item do contrato. Verifique!';

CREATE EXCEPTION VALIDA_DOCUMENTO 'CNPJ ou CPF repetidos. Verifique.';

CREATE EXCEPTION VALIDA_DT_VIGENCIA 'Intervalo de vigência inválido. Verifique.';

CREATE EXCEPTION VALIDA_FAT_SEM_CAIXA 'Impossível fechar! Faturamento não possui usuário vinculado. Contate o suporte';

CREATE EXCEPTION VALIDA_FAT_SEM_USER_VALIDO 'Erro ao executar a ação. Faturamento vinculado a um usuário inválido';

CREATE EXCEPTION VALIDA_FORNECEDOR 'Fornecedor com cadastro duplicado. Verifique';

CREATE EXCEPTION VALIDA_INSERT_ITEN_CONTRATO 'Este equipamento esta ativo em outro contrato. Verifique!';

CREATE EXCEPTION VALIDA_LOTE 'Impossível faturar. Defina os lotes dos produtos';

CREATE EXCEPTION VALIDA_N_RECEITA 'Impossível alterar. nº da Receita Agronômica já utilizado.';

CREATE EXCEPTION VALIDA_ORCAMENTO 'Cliente vinculado ao Faturamento difere do cliente vinculado ao Orçamento.';

CREATE EXCEPTION VALIDA_PARCELAMENTO 'É necessário definir o parcelamento para este faturamento';

CREATE EXCEPTION VALIDA_PARC_VD_DIAS 'Dias do intervalo definido incorretamente. Verifique.';

CREATE EXCEPTION VALIDA_PARC_VD_PC 'Parcela do intervalo definida incorretamente. Verifique.';

CREATE EXCEPTION VALIDA_PRD_ITEM_TBL 'O produto selecionado não consta na tabela de preços. Verifique.';

CREATE EXCEPTION VALIDA_PRD_REPETI '';

CREATE EXCEPTION VALIDA_PRD_REPETIDO 'Impossível inserir, o produto já consta na tabela de preços.';

CREATE EXCEPTION VALIDA_PROD_DEFENSIVO 'Este produto já está sendo utilizado em outro defensivo. Verifique';

CREATE EXCEPTION VALIDA_RECEBER 'Registro de Contas à Receber lançado em duplicidade. Contate o suporte Softbr.';

CREATE EXCEPTION VALIDA_RECEBER2 'Erro. Registros de Contas à Receber não foram gerados, verifique!';

CREATE EXCEPTION VALIDA_SERIE 'Série de produto já está cadastrada. Verifique.';

CREATE EXCEPTION VALIDA_UNIDADE 'A unidade selecionada não é válida para o produto selecionado.';

CREATE EXCEPTION VALIDA_VENDA_FATURADA 'Impossível excluir. Pedido está faturado ou enviado para o caixa.';

CREATE EXCEPTION VENDA_FATURADA 'Esta faturamento possui movimentos no Financeiro, Verifique';



SET TERM ^ ; 



/******************************************************************************/
/****                          Stored Procedures                           ****/
/******************************************************************************/

CREATE PROCEDURE ACERTA_FIN_CHEQUE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    BANCO CHAR(3),
    CHEQUE VARCHAR(6),
    DATA_ACERTO TIMESTAMP,
    JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ACOMPANHAMENTO_VENDAS (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CAIXA TIMESTAMP,
    VALOR FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ADM_CX_VER_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ADM_CX_VER_FAT_TROCAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CLIENTE VARCHAR(30),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    PRAZO NUMERIC(18,4),
    TTL_ENTRADA NUMERIC(18,4),
    TTL_SAIDA NUMERIC(18,4),
    TTL_LIQUIDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ADM_CX_VER_FAT_VENDAS_CAIXA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    VALE_TROCO NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    NOME VARCHAR(50),
    DOCTO VARCHAR(20),
    TIPO CHAR(6),
    TOTAL_BRUTO NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AGENDAR_COBRANCAS_AGRUPADA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    COBRAR_EM DATE,
    COBRADOR INTEGER,
    DATA_SERVIDOR DATE,
    MOTIVO INTEGER,
    HISTORICO VARCHAR(100))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AGENDAR_COBRANCAS_PESSOA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    PESSOA INTEGER,
    HISTORICO VARCHAR(100),
    MOTIVO INTEGER,
    DATA_SERVIDOR DATE,
    COBRAR DATE,
    COBRADOR INTEGER,
    RECEBER INTEGER,
    ORIGEM CHAR(3),
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AGRUPA_FATURAS (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
RETURNS (
    MENSAGEM VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AGRUPADOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    AGRUPADOR VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ALTERA_PRECOS_ARQ_EXT_PRODUTOS (
    CNPJ CHAR(14),
    DESTINO CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ANALISE_CLIENTE (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    QUANTIDADE_COMPRAS INTEGER,
    VALORES_ABERTOS NUMERIC(18,4),
    VALORES_PAGOS NUMERIC(18,4),
    ENTRADAS_PAGAS NUMERIC(18,4),
    NEGATIVADO_N_VEZES INTEGER,
    ULTIMA_CONSULTA DATE,
    REABILITADO_DIA DATE,
    MEDIA_ATRASO INTEGER,
    MAIOR_ATRASO INTEGER,
    MAIOR_COMPRA NUMERIC(18,4),
    MEDIA_MENSAL NUMERIC(18,4),
    LIMITE_CREDITO NUMERIC(18,4),
    LIMITE_DISPONIVEL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ANALISE_CUSTOS (
    CNPJ CHAR(14),
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ANALISE_CUSTOS_VENDAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ANALISE_INADIMPLENCIA (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    LANCADO NUMERIC(18,4),
    PAGO NUMERIC(18,4),
    ABERTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    PARCIAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ANALISE_INADIMPLENCIA_VENCTO (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    LANCADO NUMERIC(18,4),
    PAGO NUMERIC(18,4),
    ABERTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    PARCIAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_CLIENTES_MARCADOS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_ETIQUETAS_IMPRESSAS (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_ETIQUETAS_MATRIZ (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    INDICADO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_ORDEM_SERVICO_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SERVICO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_ORDEM_SERVICO_SERVICO_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_PARCELAS_GARANTIAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_PARCELAS_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_PARCELAS_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE APAGA_PARCELAS_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AT_NF_ENT_CUSTO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AT_NF_ENT_FINANCEIRO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER,
    DATA_CAIXA DATE)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AT_NF_ENT_QTD (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_BOLETO (
    CODIGO CHAR(3))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_ESTOQUE_PRODUTO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_GRUPOS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOMEG VARCHAR(50),
    NOMES VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_ORCAMENTOS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_ULTIMO_CHEQUE (
    CNPJ VARCHAR(14),
    CONTA INTEGER,
    CHEQUE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ATUALIZA_VENDAS_FATURA_FUTURA
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE AUTENTICA_USUARIO (
    LOGIN VARCHAR(10),
    SENHA VARCHAR(20))
RETURNS (
    NOME VARCHAR(50),
    PERFIL INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_FATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_FATURA_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4),
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_FATURA_PARCIAL_ADM (
    CNPJ CHAR(14),
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    CODIGO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_PAGAR (
    CNPJ CHAR(14),
    CODPAG INTEGER,
    ANOPAG SMALLINT,
    HISTORICOBX VARCHAR(100),
    DATA_BAIXA DATE,
    USUARIO INTEGER,
    VALOR_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODPAG INTEGER,
    ANOPAG SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_BX_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_PAGAR_SELECAO (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    CHEQUE INTEGER,
    BANCO CHAR(3),
    TURNO INTEGER,
    CONTA_BANCO INTEGER,
    CAIXA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_FATURA_PARCIAL (
    CNPJ CHAR(14),
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    FATURA INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_PARCIAL (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_PARCIAL_ADM (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_BX_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_PARCIAL_PDV (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_SELECAO (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_SELECAO_ADM (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    PDV CHAR(1),
    BANCO INTEGER,
    DATA_BAIXA DATE,
    DESCONTO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_SELECAO_LOJA (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    TOTAL NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    BANCO INTEGER,
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DIF_JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_SELECAO_LOJA_ADM (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    TOTAL NUMERIC(18,4),
    BANCO INTEGER,
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DIF_JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BAIXA_RECEBER_SELECAO_PDV (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    PDV CHAR(1),
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BCH_ATUALIZA_CUPOM (
    CNPJ VARCHAR(14),
    PEDIDO INTEGER,
    CUPOM INTEGER)
RETURNS (
    EXISTE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BCH_CANCELA_CUPOM (
    CNPJ VARCHAR(14),
    CUPOM INTEGER)
RETURNS (
    EXISTE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE BCH_DEFINE_COD_PRODUTO
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CAIXA_SALDOS (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CALCULA_IMPOSTOS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CALCULA_JUROS (
    CNPJ VARCHAR(14),
    VENCIMENTO DATE,
    BAIXA DATE,
    VALOR NUMERIC(18,4),
    TAXA_PASSADA NUMERIC(18,4))
RETURNS (
    RESULT NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CANCELA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CANCELA_ITEM_GENERICO_PDV (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CUPOM INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    UNIDADE CHAR(4),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CANCELA_NOTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA_CANCELAMENTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CANCELA_PEDIDO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA_CANCELAMENTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CANCELA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CARREGAR_FATURA (
    CNPJ CHAR(14),
    CARGA INTEGER,
    FATURA INTEGER,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CLIENTES_INATIVOS_PERIODO (
    CNPJ CHAR(14),
    TEMPO INTEGER,
    MOVIMENTO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    ULTIMA_COMPRA DATE,
    FONE VARCHAR(20),
    FONE1 VARCHAR(20),
    FONE2 VARCHAR(20),
    RECEBER NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE COMPLETA (
    S VARCHAR(50),
    P VARCHAR(1),
    N INTEGER)
RETURNS (
    STR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE COMPLETAESQ (
    S VARCHAR(50),
    P VARCHAR(1),
    N INTEGER)
RETURNS (
    STR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE COMPOE_ROTA (
    CNPJ VARCHAR(14),
    ROTA INTEGER,
    CIDADE INTEGER)
RETURNS (
    CONT INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONCILIA_BANCO (
    CODIGO INTEGER,
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONCILIA_CARTAO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONCILIA_CHEQUE (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    TIPO CHAR(1),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONCILIADOSPERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE,
    D1 DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_CONCILIACAO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONFERE_DOCTO_PAGAR (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DOCTO VARCHAR(20),
    CODIGO INTEGER,
    ANO INTEGER)
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONFERE_DOCTO_RECEBER (
    CNPJ CHAR(14),
    TIPO_DOCTO VARCHAR(3),
    DOCTO VARCHAR(20))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONFERE_ESTOQUE_GRADE (
    CNPJ CHAR(14))
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    QUANTIDADE_GRADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONFEREPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
RETURNS (
    CONFERE CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONFIGURA_DIREITOS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_COBRANCA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    VLR_NOMINAL NUMERIC(18,4),
    VLR_BAIXADO NUMERIC(18,4),
    SALDO_NOMINAL NUMERIC(18,4),
    INDICE VARCHAR(70),
    DATA DATE,
    ULTIMA_BAIXA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    ENDERECO_TRABALHO VARCHAR(50),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    NUMERO_TRABALHO VARCHAR(15),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    CPF_CGC VARCHAR(15),
    AGENDADO_PARA TIMESTAMP,
    COBRAR_EM TIMESTAMP,
    MOTIVO VARCHAR(50),
    HISTORICO VARCHAR(100),
    COBRADOR INTEGER,
    CONTPAGAS INTEGER,
    CONTAGENDAMENTOS INTEGER,
    LOCAL_COBRANCA INTEGER,
    NOME_COBRADOR VARCHAR(50),
    RECEBER INTEGER,
    ANO INTEGER,
    DOCTO VARCHAR(20),
    ORIGEM CHAR(3),
    LANCAMENTO TIMESTAMP,
    VENDA INTEGER,
    SELECIONADO CHAR(1),
    ARQ_MORTO CHAR(1),
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_COBRANCA_PESSOA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    PESSOA INTEGER)
RETURNS (
    EMP_EMPRESA VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_CNPJ VARCHAR(20),
    EMP_ENDERECO VARCHAR(80),
    EMP_CEP VARCHAR(20),
    EMP_BAIRRO VARCHAR(50),
    EMP_FONE VARCHAR(20),
    REC_ANO_VN SMALLINT,
    REC_CODIGO_TRC INTEGER,
    REC_CODIGO_VN INTEGER,
    REC_DATA_ULT_BAIXA TIMESTAMP,
    REC_DOCTO VARCHAR(20),
    REC_DT_AVISO TIMESTAMP,
    REC_DT_EMISSAO TIMESTAMP,
    REC_DT_LANCTO TIMESTAMP,
    REC_DT_VENCTO DATE,
    REC_HISTORICO VARCHAR(100),
    REC_JUROS_PARCIAL FLOAT,
    REC_JUROS_REC FLOAT,
    REC_ORIGEM CHAR(3),
    REC_PARCELA VARCHAR(6),
    REC_PARCIAL FLOAT,
    REC_TIPO_DOCTO CHAR(3),
    REC_VALOR FLOAT,
    REC_VALOR_NOMINAL FLOAT,
    REC_VLR_ORIG_ALT CHAR(1),
    REC_VLR_PARCIAL FLOAT,
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA TIMESTAMP,
    ULTIMA_BAIXA TIMESTAMP,
    NOME VARCHAR(50),
    PESSOA_FJ INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    ENDERECO_TRABALHO VARCHAR(50),
    NUMERO_TRABALHO VARCHAR(15),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    CPF_CGC VARCHAR(15),
    AGENDADO_PARA TIMESTAMP,
    COBRAR_EM TIMESTAMP,
    MOTIVO VARCHAR(50),
    HISTORICO VARCHAR(100),
    COBRADOR INTEGER,
    FANTASIA VARCHAR(50),
    RG_IE VARCHAR(15),
    DT_NASCIMENTO TIMESTAMP,
    NOME_COBRADOR VARCHAR(50),
    RECEBER INTEGER,
    ANO INTEGER,
    ATRASO INTEGER,
    DOCTO VARCHAR(20),
    ORIGEM CHAR(3),
    LANCAMENTO TIMESTAMP,
    VENDA INTEGER,
    SELECIONADO CHAR(1),
    TOTALRECEBER NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_COTACOES (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    FORMA_PGTO INTEGER,
    NOME_FORMA VARCHAR(50),
    TRANSPORTADORA VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    DESC_ACRESC NUMERIC(18,4),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_COTACOES_ITENS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_GARANTIA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    FORMA_PGTO INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_FORMA VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_ORDEM_SERV_ITENS_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_ORDEM_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA DATE,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    VLR_ENTRADA NUMERIC(18,4),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    MED_VIRABREQUIM VARCHAR(20),
    MED_BIELA VARCHAR(20),
    MED_CILINDRO VARCHAR(20),
    MED_CARCACA VARCHAR(20),
    ORCAMENTO INTEGER,
    NUMERO_VENDA INTEGER,
    DEFEITO_RECLAMADO VARCHAR(50),
    CONDICAO_FINAL_EQUIPAMENTO VARCHAR(50),
    HORA_CHEGADA TIME,
    HORA_SAIDA TIME,
    CONTADOR_TOTAL NUMERIC(18,4),
    CONTADOR_COR NUMERIC(18,4),
    CONTADOR_PRETO NUMERIC(18,4),
    CONTADOR_IMPRESSAO NUMERIC(18,4),
    CONTADOR_CILINDRO NUMERIC(18,4),
    CONTADOR_REVELADOR NUMERIC(18,4),
    NOME_DEFEITO VARCHAR(50),
    PROPRIEDADE INTEGER,
    NOME_PROPRIEDADE VARCHAR(50),
    CAUSA_CHAMADO VARCHAR(200),
    TIPO_ATENDIMENTO VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF VARCHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    ATIVA CHAR(1),
    TIPO_CONTRATO VARCHAR(50),
    MODELO VARCHAR(50),
    GARANTIA DATE,
    CPF VARCHAR(20),
    VENDEDOR INTEGER,
    TECNICO INTEGER,
    CONTRATO VARCHAR(20),
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_ORDEM_SERVICO_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_ORDEM_SERVICO_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA DATE,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    VLR_ENTRADA NUMERIC(18,4),
    VALIDADE DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_TROCA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    FORMA_PGTO INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_FORMA VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONSULTA_VENDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    EMP_EMPRESA VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_FONE VARCHAR(20),
    EMP_CEP VARCHAR(20),
    EMP_BAIRRO VARCHAR(50),
    EMP_ENDERECO VARCHAR(80),
    EMP_CNPJ VARCHAR(20),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    IMP_PEDIDO CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    TIPO_VENDA CHAR(3),
    CONVENIADO INTEGER,
    NOME_CONVENIADO VARCHAR(50),
    NOME_CONSUMIDOR VARCHAR(50),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBSERVACAO VARCHAR(600),
    PROPRIEDADE INTEGER,
    NOME_PROPRIEDADE VARCHAR(50),
    TERCEIRO INTEGER,
    FORMA_PGTO INTEGER,
    CARGA INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    LOCAL INTEGER,
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_NATUREZA VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    NOME_TERCEIRO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    KM_ATUAL NUMERIC(18,4),
    MEDIA_KM NUMERIC(18,4),
    AVISTA CHAR(1),
    ENDERECO_CONSUMIDOR VARCHAR(30),
    DOCUMENTOS_CONSUMIDOR VARCHAR(20),
    CIDADE_CONSUMIDOR VARCHAR(50),
    TRANSPORTADORA INTEGER,
    DATA_CAIXA DATE,
    REQUISICAO VARCHAR(6),
    TROCO NUMERIC(18,4),
    PCT_COMISSAO NUMERIC(18,4),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONTA_CTB_CONFIG_REL_CONTAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CONTA INTEGER)
RETURNS (
    NUM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONTAGEM_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CONTAGEM_MENSAL (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    PRODUTO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_CUSTO_VENDAS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_ENTRADA_ITENS_CFOP
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_EST_FEC_DIARIO (
    DATA DATE,
    CNPJ VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_ID_CHEQUE
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_SUBGRUPO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    SUBGRUPO INTEGER,
    GRUPO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CORRIGE_VENDAS_ITENS_PROMOCAO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE COTACAO_DOLAR (
    DATA DATE)
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_ARQUIVO_EXTERNO_PRODUTOS (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_CODIGO_INTERNO
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_CTB_FLUXO_CAIXA (
    CNPJ CHAR(14),
    DATA TIMESTAMP,
    SALDO_INICIAL NUMERIC(18,4),
    VENDAS_VISTA NUMERIC(18,4),
    RECEBER NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    CHQ_PRAZO NUMERIC(18,4),
    PAGAR NUMERIC(18,4),
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_LOG_TRANSACOES (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DOCUMENTO VARCHAR(20),
    ORIGEM CHAR(6),
    USUARIO INTEGER,
    DATA TIMESTAMP,
    HORA TIME,
    COMPUTADOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_RECIBO (
    CNPJ CHAR(14),
    FAVORECIDO VARCHAR(50),
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    DT_LANCTO DATE,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    CPF_CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    PLANILHA INTEGER,
    INTEGRAL CHAR(1))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_RECIBO_PAGAS (
    CNPJ CHAR(14),
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    DT_LANCTO DATE,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_SIS_MENU (
    CNPJ CHAR(14),
    CATEGORIA VARCHAR(50),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    COMPUTADOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CRIA_SIS_MENU_ITEM (
    CNPJ CHAR(14),
    CATEGORIA VARCHAR(50),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    COMPUTADOR VARCHAR(50),
    CAPTION VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CTB_PLANOCONTA_I (
    CNPJ CHAR(14),
    CONTA INTEGER,
    CODIGO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE CX_MOVTOS_LANCA_CONTAB_GERAL (
    CNPJ CHAR(14),
    PLANILHA INTEGER,
    DATA DATE,
    CONTA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DADOS_VENDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    TIPO_VENDA CHAR(3),
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DATA_HORA (
    TP VARCHAR(1))
RETURNS (
    DATA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DATA_SERVIDOR
RETURNS (
    DATA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DESCARREGAR_FATURA (
    CNPJ CHAR(14),
    CARGA INTEGER,
    FATURA INTEGER,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DESCONCILIA_BANCO (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DESVINCULA_RECEBER_FATURA (
    CNPJ CHAR(14),
    RECEBER INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DEVOLVE_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DEVOLVE_FIN_CHEQUE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    BANCO CHAR(3),
    CHEQUE VARCHAR(6),
    DATA_DEVOLUCAO DATE,
    MOTIVO_DEVOLUCAO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DEVOLVE_GARANTIA_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DEVOLVE_TROCA_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DIA_PREF_FATURAMENTO (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    DIA_PREF_FAT INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE DIGITOS (
    NDOCTO VARCHAR(20))
RETURNS (
    INTEIRO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EMITIR_FATURAS (
    CNPJ CHAR(14),
    DATA DATE,
    TOLERANCIA INTEGER,
    TIPO_CLIENTE CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EMITIR_FATURAS_CLIENTE (
    CNPJ CHAR(14),
    DATA DATE,
    TOLERANCIA INTEGER,
    CLIENTE INTEGER)
RETURNS (
    FATURA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENCERRA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENCERRA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENCERRA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    VALE_TROCO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENTRADAS_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENTRADAS_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENTRADAS_MENSAIS (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    PRODUTO VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENTRADAS_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DATA_REF TIMESTAMP,
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENVIA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENVIA_CAIXA_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENVIA_GARANTIA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ENVIA_TROCA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EST_GRUPOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    BASE SMALLINT,
    MINIMO SMALLINT,
    MAXIMO SMALLINT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EST_PROD_MAX_MIN (
    CNPJ VARCHAR(14),
    ESTOQUE VARCHAR(3))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EST_PRODUTOS_APLICACOES_I (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    APLICACAO VARCHAR(50),
    LOCAL VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EST_SUBGRUPOS_I (
    CNPJ CHAR(14),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME VARCHAR(50),
    DESCONTO_MAX NUMERIC(18,4),
    DIGITA_PRC CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EST_UNIDADES_I (
    CNPJ CHAR(14),
    SIGLA CHAR(4),
    NOME VARCHAR(50),
    UNIDADES INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_PAGAR_INTEGRAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_RECEBER (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_RECEBER_INTEGRAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ESTORNA_RECEBER_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_CHEQUE_PLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_COTACAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_CTB_CONFIG_REL_CONTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    CONTA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_ENTRADA (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_LEITURA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_MENSALIDADE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_NOTA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_NOTA_ABERTOS (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_ORCAMENTO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_ORDEM_ORC (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUI_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUIR_FECHAMENTO_DIARIO (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUIR_MENSAGEM (
    CODIGO INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXCLUIR_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXISTE_ANALISE_CUSTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXISTE_ANALISE_CUSTO_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXT_NF_ENT_CUSTO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXT_NF_ENT_FINANCEIRO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXT_NF_ENT_QTD (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    ACEITE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_NOTA_CANCELADA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_PAGAR (
    CNPJ CHAR(14),
    CODBX INTEGER,
    ANOBX SMALLINT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    ANOBX SMALLINT,
    VLR_PARCIAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_PLANILHA (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE EXTORNA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_CAIXAS_MOVIMENTOS_C (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_CAIXAS_MOVIMENTOS_D (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_CAIXAS_MOVIMENTOS_GERAL_C (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_CAIXAS_MOVIMENTOS_GERAL_D (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_CAIXAS_MOVTOS_LANCA_CONTAB (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    PLANILHA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_CARREGADAS (
    CNPJ VARCHAR(14),
    CARGA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    NUM_NF INTEGER,
    DESC_ACRES NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    ORCAMENTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_CARREGAR (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    NUM_NF INTEGER,
    DESC_ACRES NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    ORCAMENTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLR_PARC_LC NUMERIC(18,4),
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    APRAZO NUMERIC(18,4),
    UF CHAR(2),
    SERIE CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_ITENS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    QUANTIDADE_FIS NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_FIS NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_PRODUTOS_CAIXA (
    CNPJ CHAR(14),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FAT_VENDAS_PRODUTOS_CAIXA_GERAL (
    CNPJ CHAR(14),
    DATA_CAIXA DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    MOV_CAIXA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FATURA_FUTURA (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICO VARCHAR(100),
    EMISSAO DATE,
    VENCIMENTO DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    BANCO VARCHAR(3),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    PARCELAS INTEGER,
    INTERVALO INTEGER)
RETURNS (
    NUM_FATURA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FATURA_OFC_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FATURA_RECEBER (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    VENCIMENTO DATE,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    BANCO VARCHAR(3))
RETURNS (
    NUM_FATURA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FB_VER_FIN_CHEQUES (
    CNPJ VARCHAR(14))
RETURNS (
    INDICE VARCHAR(40),
    ID INTEGER,
    BANCO VARCHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO DATE,
    PRE_DATE DATE,
    VALOR NUMERIC(18,4),
    CONCILIADO VARCHAR(6),
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    DATA_CONCILIACAO DATE,
    JUROS NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO DATE,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO DATE,
    VEZES_DEVOLUCAO INTEGER,
    PROCESSADO CHAR(1),
    MARCADO CHAR(1),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(50),
    MOTIVO_DEVOLUCAO VARCHAR(50),
    PESSOA_FJ INTEGER,
    CMC7 VARCHAR(50),
    DATA_REAPRES DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_ALTPRECO (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_ALTPRECO_GRUPO (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_ALTPRECO_MARCA (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_CAIXA_RESUMO (
    CNPJ CHAR(14),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_CAIXA_RESUMO_MOVTOS (
    CNPJ CHAR(14),
    DATA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_CONTAGEM (
    CNPJ VARCHAR(15),
    COD INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHA_ENTRADA_MANUAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHAMENTO_DIARIO (
    CNPJ CHAR(14),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHAMENTO_DIARIO_INVERSO (
    CNPJ CHAR(14),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHAMENTO_MES (
    CNPJ CHAR(14),
    DATA DATE,
    DATAINICIAL DATE,
    DATAFINAL DATE,
    MES SMALLINT,
    ANO SMALLINT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHAR_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER,
    SALDO NUMERIC(18,4),
    PLANILHA INTEGER,
    VISTA NUMERIC(18,4),
    PRAZO NUMERIC(18,4))
RETURNS (
    ACEITE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FECHAR_CAIXA_GERAL (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER,
    SALDO NUMERIC(18,4))
RETURNS (
    ACEITE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FIN_BAIXAS_RECEBER_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DT_BAIXA TIMESTAMP,
    VLR_BAIXA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FIN_CONTAS_PAGAR_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    ORIGEM CHAR(3),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FIN_CONTAS_PAGAS_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    ORIGEM CHAR(3),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    DATA_BAIXA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FIN_CONTAS_RECEBER_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    TIPO_DOCTO CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE FUTUROS (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GARANTIAS_DIARIA_ENT (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GARANTIAS_DIARIA_SAI (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO (
    TABELA VARCHAR(50),
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_DUPLICATA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_MENSAGEM (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_PAGAR (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_PROPRIEDADE (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_RECEBER (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_SUBGRUPO (
    CNPJ CHAR(14),
    GRUPO INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GERAR_CODIGO_VEICULO (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GETLENGTH (
    TEXTO VARCHAR(255) CHARACTER SET ISO8859_1)
RETURNS (
    TAMANHO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GLO_CIDADES_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    UF CHAR(2))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GLO_CLIENTES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    LIMITE_CREDITO NUMERIC(18,4),
    BLOQUEADO CHAR(1),
    PAI VARCHAR(50),
    MAE VARCHAR(50),
    TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    TEMPO_SERVICO VARCHAR(15),
    RENDA NUMERIC(18,4),
    CEP VARCHAR(10),
    END_TRABALHO VARCHAR(50),
    NUMERO_TRABALHO VARCHAR(15),
    CIDADE_TRABALHO VARCHAR(50),
    UF_TRABALHO CHAR(2),
    CONJUGE VARCHAR(50),
    DT_NASC_CONJ DATE,
    FONE_CONJ VARCHAR(20),
    CONS_REV CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GLO_FORNECEDORES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GLO_PESSOAS_FJ_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    ATIVIDADE INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    BAIRRO VARCHAR(50),
    CIDADE VARCHAR(50),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    INSC_MUNIC VARCHAR(15),
    UF VARCHAR(2))
RETURNS (
    COD INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GLO_PROPRIEDADES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GMB_LETRAS_ESTOQUE (
    LETRA CHAR(1),
    QTDE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GRAFICO_GRUPOPROD (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE GRAFICO_VENDASVEND (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4),
    PERCT_VENDA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE HISTORICO_FIN_COBRANCAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER,
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE HISTORICO_FIN_COBRANCAS_PCL (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    RECEBER INTEGER,
    ANO_REC INTEGER)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER,
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMP_OFC_CTRL_QUALIDADE (
    CNPJ CHAR(14),
    CONTROLE INTEGER)
RETURNS (
    CODIGO INTEGER,
    VIRABREQUIM VARCHAR(15),
    MEDIDA_MANCAL VARCHAR(15),
    MEDIDA_BIELA VARCHAR(15),
    FOLGA_AXIAL_VIRABREQUIM VARCHAR(15),
    CABECOTE VARCHAR(15),
    ALTURA_CABECOTE VARCHAR(15),
    ALTURA_VALV_ADMISSAO VARCHAR(15),
    ALTURA_VALV_ESCAPE VARCHAR(15),
    BLOCO VARCHAR(15),
    FOLGA_CILINDRO VARCHAR(15),
    FOLGA_RADIAL_BLOCO VARCHAR(15),
    BIELA VARCHAR(15),
    FOLGA_RADIAL_BIELA VARCHAR(15),
    FOLGA_PINO VARCHAR(15),
    FOLGA_AXIAL_BIELA VARCHAR(15),
    AJUSTADO VARCHAR(15),
    TORQUE_MANCAL VARCHAR(15),
    TORQUE_BIELA VARCHAR(15),
    ALTURA_PISTAO VARCHAR(15),
    MONTADOR INTEGER,
    NOME_MONTADOR VARCHAR(50),
    PESSOA_FJ INTEGER,
    NOME_CLIENTE VARCHAR(50),
    DATA TIMESTAMP,
    MOTOR INTEGER,
    NOME_MOTOR VARCHAR(50),
    OBSERVACAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    NOME_MONTADOR_VIRABREQUIM VARCHAR(50),
    NOME_MONTADOR_CABECOTE VARCHAR(50),
    NOME_MONTADOR_BLOCO VARCHAR(50),
    NOME_MONTADOR_BIELA VARCHAR(50),
    NOME_MONTADOR_AJUSTE VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_EST_PRODUTOS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    NEG_QTDADE_2 CHAR(1),
    COMPLEMENTO_NF CHAR(1),
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM INTEGER,
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    SUBUNIDADE INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_ORCAMENTO (
    CNPJ VARCHAR(20),
    CODIGO INTEGER,
    CFOP INTEGER)
RETURNS (
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_ORCAMENTOS (
    CNPJ VARCHAR(20),
    DATA DATE,
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    FORMA_PGTO INTEGER,
    OBSERVACAO VARCHAR(80),
    NOME_CONSUMIDOR VARCHAR(50),
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    DESC_ACRESC NUMERIC(18,4),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    NOME VARCHAR(50),
    VALIDADE DATE,
    TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_ORCAMENTOS_ITENS (
    CNPJ VARCHAR(20),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    MARCA VARCHAR(30),
    QUANTIDADE_2 NUMERIC(18,4),
    MARCA_2 VARCHAR(30),
    PRC_UNITARIO_2 NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_ORDEM_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE IMPORTA_ORDEM_SERVICO_EXISTENTE (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    CODIGO_2 INTEGER)
RETURNS (
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INDEXA_CUSTOS (
    CNPJ CHAR(14),
    INDEXADOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_CTB_CHEQUE (
    CNPJ CHAR(14),
    CHEQUE INTEGER,
    CONTA INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER,
    ORIGEM CHAR(1),
    PLANILHA INTEGER,
    CONTABILIDADE CHAR(1),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL (
    CNPJ CHAR(14),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    BANCO CHAR(3),
    TIPO_LANCAMENTO CHAR(1),
    COD_DOC CHAR(3),
    FORNECEDOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_EST_FECHAMENTO_MES (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DATA TIMESTAMP,
    MES INTEGER,
    ANO INTEGER,
    SALDO_INICIAL NUMERIC(18,4),
    ENTRADAS NUMERIC(18,4),
    SAIDAS NUMERIC(18,4),
    GRUPO INTEGER,
    CUSTO NUMERIC(18,4),
    SUB_GRUPO INTEGER,
    TIPO CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_ETIQUETA_PRODUTO (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    NOME VARCHAR(50),
    VALOR NUMERIC(18,4),
    QUANTIDADE INTEGER,
    SEQUENCIA INTEGER,
    NUMERO VARCHAR(6),
    GRADE CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_FAT_VENDAS_COR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO VARCHAR(3),
    AGENCIA VARCHAR(20),
    CONTA VARCHAR(6),
    CHEQUE VARCHAR(6),
    DVCONTA CHAR(1),
    DVAGENCIA CHAR(1),
    DVCHEQUE CHAR(1),
    AVISTA CHAR(1),
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    USUARIO_CAIXA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_FIN_CHEQUES (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    TIPO CHAR(2),
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    TURNO INTEGER,
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    INDICADO INTEGER,
    PORCENTAGEM NUMERIC(18,4),
    NOME VARCHAR(50),
    INICIO TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_NOTAFATURA (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    FATURA INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_PRODUTO_PDV (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    NEG_QTDADE_2 CHAR(1),
    PRC_VENDA NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    PROD_PESAVEL CHAR(1),
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_SANGRIAS (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA TIMESTAMP,
    TURNO INTEGER,
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERE_VALOR_ADICIONAL_FATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERIR_FIN_FATURAS_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    VALOR_ATUAL NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE INSERIR_NUMERO_GRADE (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    GRADE CHAR(4),
    NUMERO VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_CONTAB_PROD_CAIXA_GERAL (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_CONTABILIDADE_ESTOQUE (
    CNPJ CHAR(14),
    DATA DATE,
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_CONTABILIDADE_PROD_CAIXA (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    PLANILHA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_CONVENIO_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    HISTORICO VARCHAR(100),
    CODREC INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_MOVIMENTO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LANCA_PAGAR_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    HISTORICO VARCHAR(100),
    CODPGR INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LISTA_CCUSTO (
    IDGRP INTEGER)
RETURNS (
    COD_CENTRO INTEGER,
    AGRUPADOR INTEGER,
    CENTRO VARCHAR(50),
    VENCTO DATE,
    VALOR FLOAT,
    PARCIAL FLOAT,
    SALDO FLOAT,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LISTA_PRODUTOS_CAIXA (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LISTA_PRODUTOS_CAIXA_GERAL (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LISTA_PRODUTOS_GRADES (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    GRADE CHAR(4),
    MATERIAL INTEGER,
    COR INTEGER,
    ESTOQUE NUMERIC(18,4),
    NOME_MATERIAL VARCHAR(50),
    NOME_COR VARCHAR(50),
    PERFIL INTEGER,
    NOME_PERFIL VARCHAR(50),
    NUMERO VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGO_GRUPO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGOMAIOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGOMAIOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGOMENOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_CODIGOMENOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOME (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOME_GRUPO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOMEMAIOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOMEMAIOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOMEMENOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE LOCALIZAR_PRODUTO_NOMEMENOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_DUPLICATA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_NOT_NULL
RETURNS (
    NOMETABELA VARCHAR(50),
    NOMECAMPO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_NUMCUPOM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    NUMERO INTEGER,
    TIPO CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_NUMNOTA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3),
    DATA_NF DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_NUMNOTA_AGRUPADA (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3),
    DATA_EMISSAO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_NUMNOTA_OS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_RECEBER_LANCAMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA_FJ INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_RECEBER_VENCIMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA_FJ INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MARCA_RECEBER_VENCIMENTO_FATURA (
    CNPJ CHAR(14),
    FATURA INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MASCARAIE (
    UF CHAR(2))
RETURNS (
    MASCARA VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MEDIA_MENSAL_PAGAMENTOS (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    MEDIA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE MIGRAR_FAT_CUPOM (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NAOCONCILIADOS (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_CLIENTE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    CLIENTE VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_EMITENTE (
    CNPJ VARCHAR(14))
RETURNS (
    EMITENTE VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_GMB_GERA_CLIENTE
RETURNS (
    CLIENTE VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_GMB_GERA_PRODUTO
RETURNS (
    LINHA VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_GMB_GERA_TRANSPORTADORA
RETURNS (
    TRANSPORTADORA VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_NOTAFISCAL (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    XXBSERIE VARCHAR(3),
    XXBTPEMIS CHAR(1),
    XXBCDV CHAR(1),
    XXBFINNFE CHAR(1))
RETURNS (
    LINHA VARCHAR(1000))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_PRODUTO (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15))
RETURNS (
    LINHA VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NFE_TRANSPORTADORA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    TRANSPORTADORA VARCHAR(500))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NOME_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NOME_SIMILAR (
    PRODUTO_A VARCHAR(13),
    PRODUTO_B VARCHAR(13),
    PRODUTO VARCHAR(13))
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE NOMEUSUARIO (
    USUARIO INTEGER)
RETURNS (
    NOME VARCHAR(10))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_MECANICOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    COM_VISTA NUMERIC(12,2),
    COM_PRAZO NUMERIC(12,2),
    PESSOA_FJ INTEGER,
    SENHA VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_MOTORES_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(80),
    TIPO VARCHAR(10),
    CILINDROS VARCHAR(15),
    COMBUSTIVEL VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_MOTORES_SERVICOS_I (
    CNPJ CHAR(14),
    MOTOR INTEGER,
    SERVICO INTEGER,
    NOME_SERVICO VARCHAR(50),
    ATIVO CHAR(1),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_ORDEM_SERVICO_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ORCAMENTO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO CHAR(1),
    MOTOR INTEGER,
    ENVIADA_CAIXA CHAR(1),
    PLACA CHAR(8),
    DATA_FECHAMENTO TIMESTAMP,
    FORMA_PAGTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_ORDEM_SERVICO_ORC_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO CHAR(1),
    MOTOR INTEGER,
    ENVIADA_CAIXA CHAR(1),
    PLACA CHAR(8),
    DATA_FECHAMENTO TIMESTAMP,
    FORMA_PAGTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_ORDEM_SERVICO_SERVICO_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_ORDEM_SERVICO_SERVICO_ORC_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE OFC_SERVICOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ORGANIZA_ANO_COBRANCAS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ORGANIZA_FATURAS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ORGANIZA_SERVICOS_ORDENS
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACERTA_ESTOQUE_FERT
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACERTA_KARDEX
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_EST_TITULO_GERADO (
    CNPJ VARCHAR(14),
    ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PARCELA VARCHAR(6),
    QTDE_MOEDA NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    NOME_RAZAO VARCHAR(50),
    CPF_CNPJ VARCHAR(15),
    DT_VENCTO DATE,
    TIPO VARCHAR(20),
    STATUS VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_ESTORNA (
    CNPJ VARCHAR(14),
    ACERTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_GERA_CONFIG_TITULO (
    CNPJ VARCHAR(14),
    DATAINICIOVARIACAO DATE,
    DATAFIMVARIACAO DATE,
    COD_INDEXADOR INTEGER,
    QUANTIDADEINDEXADOR NUMERIC(18,4),
    JUROSIMPLES SMALLINT,
    TAXAMULTA NUMERIC(18,4),
    CARENCIAMULTA INTEGER,
    TIPODESCONTO INTEGER,
    PERCDESCONTOANTECIPADO NUMERIC(18,4),
    PERCDESCONTOPONTUALIDADE NUMERIC(18,4),
    COD_JURO_POS_FIXADO INTEGER,
    DATAINICIOJUROS DATE,
    CARENCIAJUROS INTEGER,
    TAXARISCO NUMERIC(18,4),
    TAXAJUROS NUMERIC(18,4),
    VIGENCIA INTEGER)
RETURNS (
    COD_CONFIG_TITULO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_IMPRIME_RECIBO (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
RETURNS (
    ACT_COD_CONTA INTEGER,
    ACT_TIPO_MOVIMENTO VARCHAR(100),
    ACT_DOCTO VARCHAR(20),
    ACT_PARCELA VARCHAR(6),
    ACT_DT_EMISSAO DATE,
    ACT_DT_VENCTO DATE,
    ACT_QTDE_MOEDA NUMERIC(18,4),
    ACT_VALOR_NOMINAL NUMERIC(18,4),
    ACT_JUROS NUMERIC(18,4),
    ACT_VARIACAO NUMERIC(18,4),
    ACT_MULTA NUMERIC(18,4),
    ACT_DESCONTO NUMERIC(18,4),
    ACT_TOTAL NUMERIC(18,4),
    PSA_NOME VARCHAR(50),
    PSA_NOME_RECIBO VARCHAR(50),
    PSA_CPF_CGC VARCHAR(50),
    EMP_NOME VARCHAR(50),
    EMP_IE VARCHAR(15),
    EMP_BAIRRO VARCHAR(50),
    EMP_LOGRADOURO VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_NUMERO INTEGER,
    EMP_CNPJ VARCHAR(20),
    ACT_PLANILHA INTEGER,
    ACT_TIPO_ACERTO VARCHAR(100),
    USR_NOME VARCHAR(50),
    B_ACT_VALOR_NOMINAL NUMERIC(18,4),
    B_ACT_JUROS NUMERIC(18,4),
    B_ACT_VARIACAO NUMERIC(18,4),
    B_ACT_MULTA NUMERIC(18,4),
    B_ACT_DESCONTO NUMERIC(18,4),
    B_ACT_TOTAL NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    NUM_NF INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_LISTA_TT_GERADO (
    CNPJ VARCHAR(14),
    ACERTO INTEGER,
    TIPO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    PARCELA VARCHAR(6),
    QTDE_MOEDA NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    NOME_RAZAO VARCHAR(50),
    CPF_CNPJ VARCHAR(15),
    DT_VENCTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER,
    TURNO INTEGER,
    DATA_BAIXA DATE,
    VALOR_NOMINAL_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VARIACAO NUMERIC(18,4),
    MOEDA NUMERIC(18,4),
    PLANILHA INTEGER,
    ACT_TIPO_BAIXA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_PAGAS (
    CNPJ CHAR(14),
    COD_ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PGR INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_RECEBER (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER,
    TURNO INTEGER,
    DATA_BAIXA DATE,
    VALOR_NOMINAL_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VARIACAO NUMERIC(18,4),
    MOEDA NUMERIC(18,4),
    PLANILHA INTEGER,
    ACT_TIPO_BAIXA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ACT_RECEBIDAS (
    CNPJ CHAR(14),
    COD_ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ATUALIZA_ULT_VENDA (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1),
    ENTSAID CHAR(1),
    MOVEST CHAR(1),
    DATA_ULT_VD DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_BAIXA_BOLETO (
    CNPJ VARCHAR(14),
    USUARIO INTEGER,
    TURNO INTEGER,
    NOSSONUM BIGINT,
    BANCO INTEGER,
    VALOR_BX NUMERIC(18,4),
    VLR_JUROS_BX NUMERIC(18,4),
    DT_CRED DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_BLT_GERA_TITULOS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CONTACORRENTE INTEGER,
    ORIGEM CHAR(1))
RETURNS (
    BLT_NUM_COPIAS INTEGER,
    BLT_LAYOUT_IMPRESSAO CHAR(1),
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    CED_NOME VARCHAR(50),
    CED_RUA VARCHAR(50),
    CED_NUM VARCHAR(15),
    CED_EMAIL VARCHAR(80),
    CED_CEP VARCHAR(8),
    CED_CIDADE VARCHAR(50),
    CED_UF VARCHAR(2),
    CED_BAIRRO VARCHAR(50),
    CED_CPF_CGC VARCHAR(14),
    BLT_CARTEIRA VARCHAR(10),
    BLT_MODALIDADE VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_MULTA NUMERIC(18,4),
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    REC_DESCONTO NUMERIC(18,4),
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE,
    REC_CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CALC_MED_COPIA (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(15),
    ITEM_CONTRATO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CALC_MED_COPIA_LT (
    CNPJ VARCHAR(14),
    CODIGO_ITEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CALCULA_COMISSAO_FAIXA (
    CNPJ VARCHAR(18),
    VENDEDOR INTEGER,
    VALOR_VISTA NUMERIC(18,4),
    VALOR_PRAZO NUMERIC(18,4))
RETURNS (
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CALCULA_JUROS (
    CNPJ VARCHAR(18),
    VALOR NUMERIC(18,4),
    DATA_VECTO DATE,
    DATA_CALC DATE,
    TX_JUROS_ATE NUMERIC(18,8),
    TX_JUROS_APOS NUMERIC(18,8),
    TIPO CHAR(1),
    TOLERANCIA_JUROS INTEGER)
RETURNS (
    VALOR_JUROS NUMERIC(18,8))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CALCULA_MULTA_REC (
    CNPJ VARCHAR(18),
    COD_REC INTEGER,
    PESSOA_FJ INTEGER,
    VENDA INTEGER,
    DATA DATE,
    TOLERANCIA_JUROS INTEGER,
    MULTA_FINANCEIRA NUMERIC(18,4))
RETURNS (
    VALOR_MULTA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CFS_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_CF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CM_CUSTO_MEDIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CM2_ATUALIZA_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODREC INTEGER,
    CODPAG INTEGER,
    DT_LANCTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CM2_GERA_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODREC INTEGER,
    CODPAG INTEGER,
    DT_LANCTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CM2_QUITAR_COMISSAO (
    CNPJ VARCHAR(14),
    COD_AGENTE INTEGER,
    CC_CUSTO INTEGER,
    HISTORICO VARCHAR(100),
    DT_VENCTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_COM_VENDEDOR (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    VALOR_VISTA NUMERIC(18,4),
    VALOR_PRAZO NUMERIC(18,4))
RETURNS (
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_COMISSAO_FAIXA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    DATA_CAIXA DATE,
    DATA DATE,
    DESC_ACRES NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(70),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4),
    COM_TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    VLR_ITEM NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_COR_NUMERACAO_RECEBER
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CORRIGE_RECEBER
RETURNS (
    CONT INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CREDITA_PENDENCIA (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    NEW_QTDE NUMERIC(18,4),
    OLD_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CRG_FORMACAO_ROTA (
    CNPJ VARCHAR(14),
    CODIGO_FORMACAO INTEGER)
RETURNS (
    CRG_CODIGO INTEGER,
    CRG_CODIGO_VND INTEGER,
    CRG_DATA TIMESTAMP,
    CRG_NOME_RECEBEDOR VARCHAR(50),
    CRG_LOGRADOURO VARCHAR(50),
    CRG_NUMERO VARCHAR(15),
    CRG_BAIRRO VARCHAR(50),
    CRG_CEP VARCHAR(8),
    CRG_CIDADE VARCHAR(50),
    CRG_COMPLEMENTO VARCHAR(30),
    CRG_DT_ENTREGA TIMESTAMP,
    CRG_HR_ENTREGA TIME,
    CRG_OBSERVACAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CRG_PESO_BRUTO FLOAT,
    CRG_PESO_LIQUIDO FLOAT,
    CRG_STATUS INTEGER,
    CRG_UF CHAR(2),
    CRG_USUARIO INTEGER,
    CRGF_CODIGO INTEGER,
    CRGF_NOME_MOTORISTA VARCHAR(50),
    CRGF_STATUS INTEGER,
    CRGF_USUARIO INTEGER,
    CRGF_BAIRRO VARCHAR(50),
    CRGF_CIDADE VARCHAR(50),
    CRGF_CNPJ_CPF CHAR(14),
    CRGF_FONE VARCHAR(20),
    CRGF_IE_RG VARCHAR(15),
    CRGF_LOGRADOURO VARCHAR(40),
    CRGF_NUMERO VARCHAR(15),
    E_NOME VARCHAR(50),
    E_FONE VARCHAR(20),
    E_ENDERECO VARCHAR(50),
    E_CEP VARCHAR(8),
    E_BAIRRO VARCHAR(50),
    E_CIDADE VARCHAR(50),
    E_CNPJ VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CTB_EXTRATO_BANCARIO (
    CNPJ VARCHAR(14),
    CONTA INTEGER,
    DATA1 DATE,
    DATA2 DATE,
    TIPO_MOV CHAR(1))
RETURNS (
    DATA DATE,
    DATA_CONC DATE,
    DOCUMENTO VARCHAR(20),
    COD_DOC VARCHAR(3),
    HISTORICO VARCHAR(108),
    TIPO CHAR(1),
    DEBITO NUMERIC(18,4),
    CREDITO NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    SALDO_DIA_CREDITO NUMERIC(18,4),
    SALDO_DIA_DEBITO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CTB_LANCA_CONTAB_PAGAR (
    CNPJ VARCHAR(14),
    CODIGOPAGAR INTEGER,
    ANOPAGAR INTEGER,
    VALOR NUMERIC(18,4),
    DATA DATE,
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    CONTA INTEGER,
    PLANILHA INTEGER,
    FORNECEDOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_CTB_MOVIMENTODIARIO (
    CNPJ VARCHAR(14),
    DATAI DATE,
    DATAF DATE,
    CODIGO VARCHAR(15))
RETURNS (
    CONTA INTEGER,
    NOMECONTA VARCHAR(50),
    DATA DATE,
    SALDODIA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_DESCONTOS_NF_SERVICO (
    CNPJ VARCHAR(14),
    COD_CLIENTE INTEGER,
    COD_VENDA INTEGER)
RETURNS (
    DESCONTO FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_DESCTO_ICM (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    DESC_ICMS FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_ACERTOCUSTOMEDIO (
    CNPJ VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_COM_PARC (
    CNPJ VARCHAR(14),
    COD_PARC INTEGER,
    VENDEDOR INTEGER,
    STATUS CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_MAX_MIN (
    CNPJ VARCHAR(14),
    TIPO SMALLINT,
    FORNECEDOR INTEGER,
    MARCA INTEGER,
    LOC1 INTEGER,
    LOC2 INTEGER,
    LOC3 INTEGER,
    TIPO_CALC CHAR(1))
RETURNS (
    PRD_EST_FISICO NUMERIC(18,4),
    PRD_PRODUTO VARCHAR(67),
    PRD_CODIGO VARCHAR(15),
    PRD_GRUPO VARCHAR(50),
    PRD_SUB_GRUPO VARCHAR(50),
    PRD_DT_ULTCOMPRA DATE,
    PRD_DT_ULTVENDA DATE,
    PRD_ESTOQUE NUMERIC(18,4),
    SUJ_COMPRA_MAX NUMERIC(18,4),
    QTDE_COTACAO NUMERIC(18,4),
    SUJ_COMPRA_MIN NUMERIC(18,4),
    PRD_ATIVO CHAR(1),
    PRD_MAX NUMERIC(18,4),
    PRD_MIN NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_PROCESSA_CONTAGEM_GRADE (
    CNPJ VARCHAR(14),
    CONTAGEM_GRADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EST_VALIDACODBARRAS (
    CODIGO VARCHAR(15),
    GRADE VARCHAR(4),
    NUMERO VARCHAR(6),
    USA_GRADE SMALLINT,
    CNPJ VARCHAR(14))
RETURNS (
    EXISTE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ESTORNA_CH (
    CNPJ VARCHAR(14),
    CHEQUE VARCHAR(6),
    BANCO VARCHAR(3),
    CONTA VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ESTORNA_PAGAR2 (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXCLUI_COMISSAO (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXCLUI_COMISSAO_2 (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXCLUI_VENDA_2
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXECUTA_DEVOLUCAO (
    CNPJ VARCHAR(18),
    ID_AGRUPADOR INTEGER,
    PESSOA INTEGER,
    VENDEDOR INTEGER,
    CODIGO INTEGER,
    CFOP INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXECUTA_ORDEM_CARGA (
    USUARIO INTEGER,
    CNPJ CHAR(14),
    CODIGO_VND INTEGER,
    NEW_STATUS INTEGER)
RETURNS (
    ORDEM_CARGA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXECUTA_RECEITUARIO (
    CNPJ VARCHAR(18),
    COD_FATURAMENTO INTEGER,
    NEW_FECHADA CHAR(1),
    OLD_FECHADA CHAR(1),
    NEW_CANCELADA CHAR(1),
    OLD_CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXECUTA_REMESSA (
    CNPJ VARCHAR(18),
    ID_AGRUPADOR INTEGER,
    PESSOA INTEGER,
    CODIGO INTEGER,
    CFOP INTEGER,
    PROPRIEDADE INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXP_CONSULTA_FORNECEDORES (
    CNPJ VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    TIPO CHAR(10))
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(15),
    NOME VARCHAR(50),
    EXISTE CHAR(1),
    SELECIONADO CHAR(1),
    CNPJ_ORIGEM VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXP_CONSULTA_PRODUTOS (
    CNPJ VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    TIPO CHAR(10))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    EXISTE CHAR(1),
    SELECIONADO CHAR(1),
    CNPJ_ORIGEM VARCHAR(14),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXP_INSERE_CLIENTES (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXP_INSERE_PESSOAS (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXP_INSERE_PRODUTO (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXPORTA_BALANCA (
    CNPJ VARCHAR(14),
    BALANCA CHAR(1))
RETURNS (
    PRC_VENDA NUMERIC(18,4),
    NOME VARCHAR(50),
    VALIDADE INTEGER,
    PROD_PESAVEL CHAR(1),
    CODIGO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXPORTA_IAGRO_LANCAMENTOS (
    CNPJ VARCHAR(14),
    COD_FATURAMENTO INTEGER)
RETURNS (
    IE VARCHAR(14),
    TIPOREGISTRO SMALLINT,
    SEQUENCIA INTEGER,
    IE_P VARCHAR(9),
    NOTAFISCAL VARCHAR(14),
    RECIBO VARCHAR(14),
    DATA DATE,
    QUANTIDADE FLOAT,
    VOLUME_EMBALAGEM FLOAT,
    UND_MEDIDA INTEGER,
    MAT_EMBALAGEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_EXTRAI_NUM_NFE (
    CHAVE_NFE VARCHAR(44))
RETURNS (
    NUM_NFE VARCHAR(10))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FAT_GERA_PAGAR (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    DATA_CAIXA DATE,
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    CCT_ID INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FAT_GERA_RECEBER (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    DATA_CAIXA DATE,
    LOCAL INTEGER,
    HISTORICO VARCHAR(100),
    TIPO_DOCTO VARCHAR(3),
    PARCELA VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FIN_ACERTA_CHEQUE (
    INDICE VARCHAR(40),
    CNPJ VARCHAR(14),
    DATA DATE,
    CONTACAIXA INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    VALOR NUMERIC(9,2),
    JUROS NUMERIC(9,2),
    DESCONTOS NUMERIC(9,2),
    CONTADEV INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FIN_ARRUMACHEQUES_ID
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FIN_REAPRES_CHEQUE (
    INDICE VARCHAR(40),
    DATA DATE,
    CNPJ VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FIN_SOMAR_CONCILIACAO (
    CNPJ VARCHAR(14))
RETURNS (
    AVISTA NUMERIC(9,2),
    APRAZO NUMERIC(9,2),
    DESCARTADOS NUMERIC(9,2),
    TOTAL NUMERIC(9,2))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_FLUXO_CAIXA (
    CNPJ VARCHAR(14),
    CHEQUE CHAR(1),
    CARTAO CHAR(1),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    DATA DATE,
    TT_RECEBER_EFETIVO FLOAT,
    TT_RECEBER_PREVISO FLOAT,
    TT_PAGAR_EFETIVO FLOAT,
    TT_PAGAR_PREVISTO FLOAT,
    TT_SALDO_PREVISTO FLOAT,
    TT_SALDO_EFETIVO FLOAT,
    E_CNPJ VARCHAR(14),
    SALDO_CAIXAS FLOAT,
    SALDO_CONTAS FLOAT,
    SALDO_INICIAL FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_COMISSAO (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE,
    USUARIO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_COTACOES (
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_CPAGAR (
    CNPJ VARCHAR(15),
    VDD INTEGER,
    CENTRO_CUSTO INTEGER,
    DT_VENCTO DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_EST_KARDEX (
    CNPJ VARCHAR(18),
    PESSOA INTEGER,
    CODIGO INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1),
    MOVEST CHAR(1),
    ENTSAID CHAR(1),
    NEW_DATA DATE,
    NEW_NF INTEGER,
    OLD_NF INTEGER,
    NEW_LOCAL INTEGER,
    OLD_LOCAL INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_LEITURAS_AUT (
    CNPJ VARCHAR(14),
    DATA_REFERENCIA DATE)
RETURNS (
    CONT INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_MENSALIDADE_AUT (
    CNPJ VARCHAR(14),
    DATA_REFERENCIA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_TABELA_ALTERACAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    MARCA INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    PRODUTO VARCHAR(15),
    MARGEM NUMERIC(18,4),
    INCREMENTAL CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_TABELA_PRECO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    MARCA INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    PRODUTO VARCHAR(15),
    MARGEM NUMERIC(18,4),
    INCREMENTAL CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_TITULOS (
    CNPJ VARCHAR(14))
RETURNS (
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    BLT_CARTEIRA VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_MULTA NUMERIC(18,4),
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    REC_DESCONTO NUMERIC(18,4),
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE,
    BLT_NUM_IMP INTEGER,
    COD_RECEBER INTEGER,
    FTR_COD_CLIENTE INTEGER,
    FTR_VENDEDOR INTEGER,
    FTR_REGIAO INTEGER,
    FTR_LOCAL_COB INTEGER,
    FTR_CLASSIFICACAO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GERA_TITULOS_PERIODO (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    BLT_CARTEIRA VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    COD_REC INTEGER,
    PESSOA_FJ INTEGER,
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DESCONTOS NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_CONT_AMERICA (
    CNPJ VARCHAR(15),
    CONTAGEM_GRADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_ENCONTRA_ENTRADAS (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    FORNECEDOR VARCHAR(65),
    DATA_NF DATE,
    CODIGO INTEGER,
    PRODUTO VARCHAR(80),
    NUM_NF VARCHAR(20),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    ORIGEM CHAR(3),
    DESCONTO_NOTA NUMERIC(18,4),
    COD_FORN INTEGER,
    CFOP INTEGER,
    TOTAL_NOTA NUMERIC(18,4),
    TOTAL_ITEMS NUMERIC(15,4),
    GERAL_NOTA NUMERIC(18,4),
    GERAL_ITEMS NUMERIC(15,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_FURO_VENDA_ENT (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    TIPO CHAR(1))
RETURNS (
    CODIGO_VD INTEGER,
    RETTOTAL_ITEMS NUMERIC(18,4),
    RETTOTAL_VENDA NUMERIC(18,4),
    FECHADA CHAR(1),
    MOTIVO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_FURO_VENDA_SAIDA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    TIPO CHAR(1))
RETURNS (
    CODIGO_VD INTEGER,
    RETTOTAL_ITEMS NUMERIC(18,4),
    RETTOTAL_VENDA NUMERIC(18,4),
    FECHADA CHAR(1),
    MOTIVO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_GERA_COMISSAO_AMERICA (
    CNPJ VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_GERA_KARDEX (
    CNPJ VARCHAR(18),
    DATA1 DATE,
    DATA2 DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_GERA_NOSSO_NUMERO (
    CNPJ VARCHAR(18))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_REGERAR_MOV_CTB (
    CNPJ VARCHAR(14))
RETURNS (
    VALOR FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_REPROCESSA_ESTOQUE (
    CNPJ VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_GMB_VD_S_REC
RETURNS (
    RETORNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMP_DUPLICADA (
    CNPJ VARCHAR(14),
    COD_VENDA INTEGER,
    COD_RECEBER INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    VALOR_EXTENSO VARCHAR(200),
    VD_TOTAL FLOAT,
    VD_CODIGO INTEGER,
    VD_NUM_NF INTEGER,
    DPL_VALOR FLOAT,
    DPL_VENCTO DATE,
    DPL_EMISSAO DATE,
    DPL_PARCELA VARCHAR(6),
    SAC_CODIGO INTEGER,
    SAC_NOME VARCHAR(50),
    DPL_NUMERO INTEGER,
    SAC_RG_IE VARCHAR(20),
    SAC_ENDERECO VARCHAR(50),
    SAC_CEP VARCHAR(20),
    SAC_CIDADE VARCHAR(50),
    SAC_BAIRRO VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_CPF_CGC VARCHAR(79),
    SAC_NUMERO VARCHAR(15),
    SAC_FONE VARCHAR(20),
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_TOTAL_UNITARIO FLOAT,
    PRD_UNIDADE VARCHAR(4),
    PRD_NOME VARCHAR(50),
    PRD_CODIGO VARCHAR(15),
    VD_DESCONTOS FLOAT,
    PROP_BAIRRO VARCHAR(50),
    PROP_IE VARCHAR(15),
    PROP_NOME_ENDERECO VARCHAR(120),
    PROP_CEP VARCHAR(8),
    PROP_CIDADE VARCHAR(50),
    PROP_UF VARCHAR(2),
    PROP_NOME VARCHAR(50),
    VDD_CODIGO INTEGER,
    VDD_NOME VARCHAR(50),
    VDDI_NOME VARCHAR(50),
    VDDI_CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMP_ITENS_REM_DEV (
    CNPJ VARCHAR(14),
    COD_ORIGEM INTEGER,
    COD_DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMP_NF_AGRUPADA (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    DT_NF DATE)
RETURNS (
    CLI_NOME VARCHAR(50),
    VD_CODIGO INTEGER,
    CLI_PROPRIEDADE VARCHAR(50),
    VEND_NOME VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_IE_SUB VARCHAR(15),
    CLI_IE VARCHAR(15),
    CLI_CNPJ VARCHAR(20),
    CLI_ENDERECO VARCHAR(70),
    CLI_BAIRRO VARCHAR(50),
    CLI_CEP VARCHAR(10),
    CLI_CIDADE VARCHAR(50),
    CLI_FAX VARCHAR(20),
    CLI_FONE VARCHAR(20),
    CLI_UF CHAR(2),
    VD_NATUREZA VARCHAR(50),
    VD_MSG_ECF VARCHAR(50),
    VD_OBS VARCHAR(200),
    VD_CFOP INTEGER,
    VD_DT_EMISSAO DATE,
    VD_DT_SAIDA DATE,
    VD_HORA_SAIDA TIME,
    VD_TOTAL_PROD FLOAT,
    VD_TOTAL_LIQUIDO FLOAT,
    VD_ICMS_DEBITADO FLOAT,
    VD_TOTAL_NF FLOAT,
    VD_DESCONTO FLOAT,
    VD_VLR_FRETE FLOAT,
    VD_VLR_SEGURO FLOAT,
    VD_VLR_OUTRAS_DESP FLOAT,
    VD_BASE_CALC FLOAT,
    VD_VLR_ICM FLOAT,
    VD_BASE_CALC_SUB FLOAT,
    VD_VOLUME FLOAT,
    VD_VLR_ICM_SUB FLOAT,
    VD_VLR_IPI FLOAT,
    PRD_IPI FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(400),
    PRD_UNIDADE CHAR(4),
    PRD_SIT_TRIB CHAR(6),
    PRD_CL_FIS CHAR(2),
    PRD_QTDE FLOAT,
    PRD_VLR_UNIT FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    PRD_VLR_TTL_ITEM FLOAT,
    PRD_ALIQ_ICM VARCHAR(10),
    PRD_COMPLEMENTO VARCHAR(100),
    PRD_REDUCAO VARCHAR(80),
    VDI_COMPLEMENTO VARCHAR(100),
    VDI_CFOP INTEGER,
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(14),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(8),
    TRP_MARCA VARCHAR(8),
    TRP_NUMERO VARCHAR(8),
    PRD_OBSERVACAO VARCHAR(200),
    GPR_OBS BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_COMPLEMENTAR BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    PC_PARCELAMENTO VARCHAR(300),
    PRD_PRODUTO_LOTE VARCHAR(250),
    VD_ENTRADA CHAR(1),
    VD_SAIDA CHAR(1),
    NUM_NF INTEGER,
    ALT_DETALHE FLOAT,
    DESC_ICM_TTL_PROD FLOAT,
    DESC_ICM_LBL_TTL_PROD VARCHAR(50),
    DESC_ICM_TTL_DESCTO FLOAT,
    DESC_ICM_LBL_TTL_DESCTO VARCHAR(50),
    DESC_ICM_TTL_LIQ FLOAT,
    DESC_ICM_LBL_TTL_LIQ VARCHAR(50),
    DESC_ICM_MSG_1 VARCHAR(200),
    DESC_ICM_MSG_2 VARCHAR(200),
    DT_IMP_NF DATE,
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_VD_VOLUME VARCHAR(30),
    LINHA INTEGER,
    VND_CODIGOS VARCHAR(180))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPREME_NF_SERV (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA INTEGER)
RETURNS (
    COMPLEMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CLIENTE VARCHAR(50),
    RG_IE VARCHAR(15),
    ENDERECO VARCHAR(130),
    BAIRRO VARCHAR(50),
    CIDADE VARCHAR(50),
    UF VARCHAR(2),
    FONE VARCHAR(20),
    CEP VARCHAR(10),
    CPF_CGC VARCHAR(20),
    INSC_MUNIC VARCHAR(15),
    FAT_FATURA1 VARCHAR(10),
    FAT_VENCTO1 VARCHAR(12),
    FAT_VLR1 VARCHAR(12),
    FAT_FATURA2 VARCHAR(10),
    FAT_VENCTO2 VARCHAR(12),
    FAT_VLR2 VARCHAR(12),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    VLR_TOTAL_UNIT NUMERIC(18,4),
    PIS NUMERIC(18,4),
    IRRF NUMERIC(18,4),
    INSS NUMERIC(18,4),
    VLR_PIS NUMERIC(18,4),
    VLR_IRRF NUMERIC(18,4),
    VLR_INSS NUMERIC(18,4),
    TOTAL_VENDA NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    TEXTO_PIS VARCHAR(30),
    TEXTO_IRRF VARCHAR(30),
    TEXTO_INSS VARCHAR(30),
    TEXTO_DESCONTO VARCHAR(30),
    BASE_CALC_ISS NUMERIC(18,4),
    VLR_ISS NUMERIC(18,4),
    VLR_ISS_SUB NUMERIC(18,4),
    TOTAL_NF NUMERIC(18,4),
    FRETE_DESTINATARIO CHAR(1),
    FRETE_EMITENTE CHAR(1),
    CLI_PROPRIEDADE VARCHAR(50),
    CLI_IE VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_NF_GRAFICA (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    DT_NF DATE,
    I_NUM_NF INTEGER)
RETURNS (
    CLI_NOME VARCHAR(50),
    VD_CODIGO INTEGER,
    CLI_PROPRIEDADE VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_IE_SUB VARCHAR(15),
    CLI_IE VARCHAR(15),
    CLI_CNPJ VARCHAR(20),
    CLI_ENDERECO VARCHAR(130),
    CLI_BAIRRO VARCHAR(50),
    CLI_CEP VARCHAR(10),
    CLI_CIDADE VARCHAR(50),
    CLI_FONE VARCHAR(20),
    CLI_FAX VARCHAR(20),
    CLI_UF CHAR(2),
    VEND_NOME VARCHAR(50),
    VEND_COD INTEGER,
    VD_NATUREZA VARCHAR(50),
    VD_MSG_ECF VARCHAR(50),
    VD_OBS VARCHAR(200),
    VD_CFOP INTEGER,
    VD_DT_EMISSAO DATE,
    VD_DT_SAIDA DATE,
    VD_HORA_SAIDA TIME,
    VD_ICMS_DEBITADO FLOAT,
    VD_TOTAL_PROD FLOAT,
    VD_TOTAL_LIQUIDO FLOAT,
    VD_TOTAL_NF FLOAT,
    VD_DESCONTO FLOAT,
    VD_VLR_FRETE FLOAT,
    VD_VLR_SEGURO FLOAT,
    VD_VLR_OUTRAS_DESP FLOAT,
    VD_BASE_CALC FLOAT,
    VD_VLR_ICM FLOAT,
    VD_BASE_CALC_SUB FLOAT,
    VD_VOLUME FLOAT,
    VD_VLR_ICM_SUB FLOAT,
    VD_VLR_IPI FLOAT,
    PRD_IPI FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(400),
    PRD_UNIDADE CHAR(4),
    PRD_SIT_TRIB CHAR(6),
    PRD_CL_FIS CHAR(2),
    PRD_QTDE FLOAT,
    PRD_VLR_UNIT FLOAT,
    PRD_PORC_DESC FLOAT,
    PRD_VLR_TTL_ITEM FLOAT,
    PRD_ALIQ_ICM VARCHAR(10),
    PRD_COMPLEMENTO VARCHAR(100),
    PRD_REDUCAO VARCHAR(80),
    PRC_UNITARIO_LIQ FLOAT,
    PRC_UNITARIO FLOAT,
    VDI_COMPLEMENTO VARCHAR(100),
    VDI_CFOP INTEGER,
    PRD_OBSERVACAO VARCHAR(200),
    PRD_PRODUTO_LOTE VARCHAR(250),
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(15),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(50),
    TRP_MARCA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    GPR_OBS BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_COMPLEMENTAR BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    PC_PARCELAMENTO VARCHAR(300),
    PRD_DEFENSIVO VARCHAR(300),
    PRD_CONCAT VARCHAR(800),
    VD_ENTRADA CHAR(1),
    VD_SAIDA CHAR(1),
    NUM_NF INTEGER,
    ALT_DETALHE FLOAT,
    DESC_ICM_TTL_PROD FLOAT,
    DESC_ICM_LBL_TTL_PROD VARCHAR(50),
    DESC_ICM_TTL_DESCTO FLOAT,
    DESC_ICM_LBL_TTL_DESCTO VARCHAR(50),
    DESC_ICM_TTL_LIQ FLOAT,
    DESC_ICM_LBL_TTL_LIQ VARCHAR(50),
    DESC_ICM_MSG_1 VARCHAR(200),
    DESC_ICM_MSG_2 VARCHAR(200),
    COD_ORIGINADOR VARCHAR(70),
    DT_IMP_NF DATE,
    PARCELA_1_NUMERO VARCHAR(6),
    PARCELA_1_VALOR FLOAT,
    PARCELA_1_VENCTO DATE,
    PARCELA_1_EXTENSO VARCHAR(200),
    PARCELA_2_NUMERO VARCHAR(6),
    PARCELA_2_VALOR FLOAT,
    PARCELA_2_VENCTO DATE,
    PARCELA_2_EXTENSO VARCHAR(200),
    PARCELA_3_NUMERO VARCHAR(6),
    PARCELA_3_VALOR FLOAT,
    PARCELA_3_VENCTO DATE,
    PARCELA_3_EXTENSO VARCHAR(200),
    PARCELA_4_NUMERO VARCHAR(6),
    PARCELA_4_VALOR FLOAT,
    PARCELA_4_VENCTO DATE,
    PARCELA_4_EXTENSO VARCHAR(200),
    PARCELA_5_NUMERO VARCHAR(6),
    PARCELA_5_VALOR FLOAT,
    PARCELA_5_VENCTO DATE,
    PARCELA_5_EXTENSO VARCHAR(200),
    PARCELA_6_NUMERO VARCHAR(6),
    PARCELA_6_VALOR FLOAT,
    PARCELA_6_VENCTO DATE,
    PARCELA_6_EXTENSO VARCHAR(200),
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_VD_VOLUME VARCHAR(30),
    LINHA INTEGER,
    VND_CODIGOS VARCHAR(180))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_OS (
    CNPJ VARCHAR(15),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    PSA_CODIGO INTEGER,
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_FANTASIA VARCHAR(50),
    PSA_ENDERECO VARCHAR(100),
    PSA_BAIRRO VARCHAR(50),
    PSA_CEP VARCHAR(8),
    PSA_FONE VARCHAR(20),
    PSA_CONTATO VARCHAR(50),
    PSA_CIDADE VARCHAR(80),
    PSA_REGIAO VARCHAR(60),
    OS_NOME_TECNICO VARCHAR(50),
    OS_KM INTEGER,
    OS_EQUIPAMENTO VARCHAR(50),
    OS_EQ_MODELO VARCHAR(50),
    OS_EQ_MARCA VARCHAR(50),
    OS_EQ_SERIE VARCHAR(30),
    OS_SOLICITANTE VARCHAR(50),
    OS_DEFEITO_RECLAMADO VARCHAR(50),
    OS_OBS_FECHAMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_PESSOA_OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_DT_PROGRAMACAO DATE,
    OS_HR_PROGRAMACAO TIME,
    OS_TECNICO VARCHAR(50),
    OS_MOTIVO_CHAMADO VARCHAR(50),
    OS_TIPO_ATENDIMENTO VARCHAR(50),
    OS_CT_TOTAL INTEGER,
    OS_CT_COR INTEGER,
    OS_CT_PRETO INTEGER,
    OS_DT_CILINDRO DATE,
    OS_CT_CILINDRO INTEGER,
    OS_CT_REVELADOR INTEGER,
    OS_DT_REVELADOR DATE,
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_TOTAL FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(50),
    OS_DT_INICIO DATE,
    OS_TIPO_CONTRATO VARCHAR(50),
    OS_HR_INICIALIZACAO TIME,
    OS_DT_FINALIZACAO DATE,
    OS_HR_FINALIZACAO TIME,
    CAB_NOME_EMPRESA VARCHAR(50),
    CAB_END_EMPRESA VARCHAR(200),
    CAB_FONE_EMPRESA VARCHAR(20),
    VEI_PLACA VARCHAR(8),
    VEI_COR VARCHAR(50),
    VEI_MODELO VARCHAR(50),
    VEI_ANO INTEGER,
    VEI_CHASSI VARCHAR(50),
    VEI_MARCA VARCHAR(50),
    PSA_CPF VARCHAR(15),
    PSA_RG_IE VARCHAR(20),
    OS_CODIGO INTEGER,
    OS_EQUIPAMENTO_OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_PROMISSORIA (
    CNPJ VARCHAR(15),
    CODIGO INTEGER,
    TIPO CHAR(1))
RETURNS (
    PSA_CODIGO INTEGER,
    VD_DATA DATE,
    VD_CODIGO INTEGER,
    VD_COD_VENDEDOR INTEGER,
    VD_NF INTEGER,
    VD_CF VARCHAR(20),
    PC_PARCELA VARCHAR(6),
    PSA_FONE VARCHAR(20),
    PC_VALOR FLOAT,
    PC_VENCTO DATE,
    PC_DIA INTEGER,
    PC_MES INTEGER,
    PC_ANO INTEGER,
    PSA_NOME VARCHAR(50),
    PSA_ENDERECO VARCHAR(100),
    PSA_BAIRRO VARCHAR(50),
    PSA_CIDADE VARCHAR(50),
    PSA_CNPJ VARCHAR(14),
    PSA_RG_IE VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_RECEITA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    NOME_PROPRIETARIO VARCHAR(70),
    NOME_PROPRIEDADE VARCHAR(70),
    CIDADE_PROPRIEDADE VARCHAR(70),
    CULTURA VARCHAR(70),
    PRAGA VARCHAR(70),
    COD_PRODUTO VARCHAR(15),
    MEDIDA_DOSAGEM VARCHAR(15),
    MEDIDA_VAZAO VARCHAR(15),
    ORIENTACAO_USO_EQUIPAMENTO VARCHAR(80),
    ORIENTACAO_TECNICA VARCHAR(80),
    ORIENTACAO_COMPLEMENTAR VARCHAR(80),
    ORIENTACAO_FORMA_APLICACAO VARCHAR(80),
    FORMULACAO VARCHAR(80),
    CIDADE_EMPRESA VARCHAR(80),
    CLASSE_TOXICOLOGICA VARCHAR(80),
    INGREDIENTE_ATIVO VARCHAR(80),
    NOME_PRODUTO VARCHAR(50),
    DOSAGEM NUMERIC(18,4),
    VAZAO NUMERIC(18,4),
    DATA_EMISSAO DATE,
    NOME_TECNICO VARCHAR(50),
    CREA_TECNICO VARCHAR(20),
    CTPS_TECNICO VARCHAR(20),
    CPF_CNPJ_PRODUTOR VARCHAR(20),
    CPF_CNPJ_TECNICO VARCHAR(20),
    CNPJ_EMPRESA VARCHAR(20),
    INTERVALO_SEGURANCA INTEGER,
    AREA_TRATADA NUMERIC(18,4),
    AREA_TOTAL VARCHAR(30),
    QTDE_ITENS FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_SERIE_DEVOLUCAO (
    ORDEM_CARGA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    PSA_CLIENTE VARCHAR(50),
    PSA_FANTASIA_CLI VARCHAR(50),
    PSA_CIDADE VARCHAR(60),
    PSA_ENDERECO_CLI VARCHAR(100),
    VD_COD_VENDA INTEGER,
    VD_PESSOA_FJ INTEGER,
    VD_DT_VENDA DATE,
    VD_DATA_CAIXA DATE,
    VD_DESC_ACRESC FLOAT,
    VD_TOTAL FLOAT,
    VD_NUM_CUPOM INTEGER,
    VD_NUM_NF INTEGER,
    VD_OBSERVACAO VARCHAR(200),
    VD_VOLUME NUMERIC(18,4),
    VD_PESO NUMERIC(18,4),
    VD_HORA TIME,
    VD_TIPO_DOCTO VARCHAR(3),
    VD_TOTAL_BRUTO FLOAT,
    COD_CLIENTE INTEGER,
    DESC_ITEM FLOAT,
    NOME_VENDEDOR VARCHAR(50),
    VD_ORDEM_CARGA INTEGER,
    PRODUTO VARCHAR(50),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    CGC_CPF_CLI VARCHAR(20),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    CONT_ITENS NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO INTEGER,
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    PC_PARCELAMENTO VARCHAR(300),
    CGRI_CARREGADO FLOAT,
    CGRI_DEVOLVIDO FLOAT,
    CGRI_ENTREGUE FLOAT,
    CGRI_QUANTIDADE FLOAT,
    CGRI_GRADE VARCHAR(4),
    CGRI_NUMERO VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_SERIE_NF (
    VENDA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CONTATO VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    COD_INDICE INTEGER,
    COD_CLIENTE INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL_DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(50),
    VDI_GRADE CHAR(4),
    VDI_NUMERO VARCHAR(6),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PESO_ITEN FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    SERV_COMPLEMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    PROD_COMPLEMENTO VARCHAR(120),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO VARCHAR(50),
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PRO_RUA_NOME VARCHAR(50),
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    VD_CFOP INTEGER,
    VD_CFOP_DESC VARCHAR(50),
    PC_PARCELAMENTO VARCHAR(300),
    TROCO NUMERIC(18,4),
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(15),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(50),
    TRP_MARCA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    VD_VLR_FRETE NUMERIC(18,4),
    VD_DATA_BASE DATE,
    VD_BASE_CALC NUMERIC(18,4),
    VD_BASE_CALC_SUB NUMERIC(18,4),
    VD_VLR_ICM_SUB NUMERIC(18,4),
    VD_VLR_ICM NUMERIC(18,4),
    VD_TOTAL_PROD NUMERIC(18,4),
    VD_VLR_SEGURO NUMERIC(18,4),
    VD_VLR_OUTRAS_DESP NUMERIC(18,4),
    VD_VLR_IPI NUMERIC(18,4),
    VD_TOTAL_NF NUMERIC(18,4),
    S_MSG_PROX_FOLHA VARCHAR(100),
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_TOTAL_BRUTO VARCHAR(30),
    S_DESC_ACRESC VARCHAR(30),
    S_TOTAL VARCHAR(30),
    VD_DESC_CARREGAMENTO VARCHAR(300),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    OFC_PLACA VARCHAR(10))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_SERIE_ORC_NF (
    ORCA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DATA_VALIDADE DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(50),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_IMPRIME_SERIE_REQUISICAO (
    ORDEM_CARGA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    COD_CLIENTE INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VD_ORDEM_CARGA INTEGER,
    PRODUTO VARCHAR(50),
    VDI_GRADE CHAR(4),
    VDI_NUMERO VARCHAR(6),
    VDI_CARREGADO FLOAT,
    VDI_CARREGAR FLOAT,
    VDI_ENTREGUE FLOAT,
    VDI_DEVOLVIDO FLOAT,
    VDI_ENTREGAR FLOAT,
    VDI_DEVOLVER FLOAT,
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO INTEGER,
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    PC_PARCELAMENTO VARCHAR(300),
    CGRI_CARREGADO FLOAT,
    CGRI_DEVOLVIDO FLOAT,
    CGRI_ENTREGUE FLOAT,
    CGRI_QUANTIDADE FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LISTA_COMISSAO (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    VENDEDOR INTEGER)
RETURNS (
    VD_TOTAL FLOAT,
    VD_COD_VENDEDOR INTEGER,
    VD_DT_VD DATE,
    VD_DT_CX DATE,
    VD_CODIGO INTEGER,
    VD_TIPO VARCHAR(30),
    PCT_COMISSAO FLOAT,
    VLR_COMISSAO FLOAT,
    BX_CODIGO INTEGER,
    BX_VALOR FLOAT,
    BX_JUROS FLOAT,
    BX_DESCONTOS FLOAT,
    BX_DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LISTA_COMPRAS (
    CNPJ VARCHAR(18),
    CODIGO VARCHAR(15),
    LOAD INTEGER)
RETURNS (
    COD_FORNECEDOR INTEGER,
    FORNECEDOR VARCHAR(80),
    TELEFONE VARCHAR(20),
    NDOCTO VARCHAR(20),
    TIPO_DOCTO VARCHAR(20),
    LOCAL_ESTOQUE INTEGER,
    CUSTO FLOAT,
    DATA DATE,
    QTDE FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LISTA_FATURAMENTOS (
    CNPJ VARCHAR(18),
    PESSOA_FJ INTEGER,
    ES CHAR(1),
    CFOP INTEGER,
    TIPO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DATA DATE,
    DATA_CAIXA DATE,
    FECHADA CHAR(1),
    VENDEDOR VARCHAR(50),
    NATUREZA VARCHAR(80),
    SALDO NUMERIC(18,4),
    NUM_NF INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LISTA_PRODUTO (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    VENCTO_PRC_VENDA DATE,
    VALIDA_MULT_QTDE_MIN CHAR(1),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    COD_GETIN VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    QNTDE_MINIMA_VENDA FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    TRIB_PIS CHAR(2),
    TRIB_COFINS CHAR(2),
    TRIB_IPI CHAR(2),
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    CSOSN INTEGER,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    CODIGO_NCM VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    SECAO INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1),
    UND_PRIMARIA CHAR(4),
    FATOR_CONVERSAO NUMERIC(18,4),
    QNTDE_PDR_CARGA NUMERIC(18,4),
    SINCRONIZA_FILIAIS CHAR(1),
    UND_CARREGAMENTO CHAR(4),
    TRIB_ALIQ_EST NUMERIC(18,4),
    TRIB_ALIQ_INT NUMERIC(18,4),
    TRIB_MODALIDADE VARCHAR(50),
    APLICACAO BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    IMG_2 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_1 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_3 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_4 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    CODIGO_FABRICANTE VARCHAR(50),
    COR INTEGER,
    MATERIAL INTEGER,
    BCH_CODIGO INTEGER,
    COD_LOCALIZACAO_1 INTEGER,
    COD_LOCALIZACAO_2 INTEGER,
    COD_LOCALIZACAO_3 INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LOG_FAT_VENDAS (
    LOG_CODIGO INTEGER,
    LOG_CNPJ VARCHAR(14),
    LOG_USUARIO INTEGER,
    LOG_OPERACAO VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_ATENDIMENTO_OS_SINT (
    CNPJ VARCHAR(14),
    DATA_INI DATE,
    DATA_FIM DATE,
    TP_DATA CHAR(1),
    PR_REGIAO INTEGER,
    PR_MODELO INTEGER,
    PR_CLIENTE INTEGER,
    PR_MTV_CHAMADO INTEGER,
    PR_EQUIPAMENTO VARCHAR(15),
    PR_TPCONTRATO INTEGER,
    PR_TPA_CODIGO INTEGER,
    PR_MARCA INTEGER,
    PR_CONTRATO INTEGER,
    PR_CIDADE INTEGER,
    PR_STATUS INTEGER,
    PR_TECNICO INTEGER)
RETURNS (
    OFC_CODIGO INTEGER,
    ID_CONTRATO INTEGER,
    OFC_DATA DATE,
    OFC_TEMPO_VIAJEM FLOAT,
    OFC_DT_ENTRADA DATE,
    OFC_DT_FECHAMENTO DATE,
    OFC_DT_SOLICITACAO DATE,
    OFC_HR_ENTRADA TIME,
    OFC_DT_ATRIBUICAO DATE,
    OFC_HR_ATRIBUICAO TIME,
    OFC_DATA_FECHAMENTO DATE,
    OFC_TOTAL NUMERIC(18,4),
    OFC_SOLICITANTE VARCHAR(50),
    OFC_VENDA INTEGER,
    OFC_KM_RODADO NUMERIC(18,4),
    OFC_HORAS_TRABALHADAS NUMERIC(18,4),
    ST_CODIGO INTEGER,
    ST_COR INTEGER,
    ST_NOME VARCHAR(50),
    MEC_CODIGO INTEGER,
    MEC_NOME VARCHAR(50),
    DEF_CODIGO INTEGER,
    DEF_NOME VARCHAR(50),
    MTC_CODIGO INTEGER,
    MTC_NOME VARCHAR(50),
    TPA_CODIGO INTEGER,
    TPA_NOME VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_NOME_RAZAO VARCHAR(90),
    REG_CODIGO INTEGER,
    REG_DESCRICAO VARCHAR(50),
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(90),
    PRD_SERIE VARCHAR(30),
    MDL_CODIGO INTEGER,
    MDL_NOME VARCHAR(50),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    CP_TEMPO_RESPOSTA FLOAT,
    CP_COD_CONTRATO INTEGER,
    TPC_NOME VARCHAR(50),
    TP_ATENDIMENTO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(70),
    TECNICO_ATDD CHAR(1),
    REG_NOME VARCHAR(50),
    BAIRRO VARCHAR(50),
    ENDERECO VARCHAR(100),
    FONE VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_CRG_FORMACAO_SINT (
    CNPJ VARCHAR(14),
    CODIGO_FORMACAO INTEGER)
RETURNS (
    CRGI_PRODUTO VARCHAR(15),
    CRGI_NOME_PRODUTO VARCHAR(50),
    CRGI_GRADE VARCHAR(4),
    CRGI_NUMERO VARCHAR(6),
    CRGI_UNIDADE CHAR(4),
    CRGI_CARREGADO FLOAT,
    PRD_LOCALIZACAO_1 VARCHAR(30),
    PRD_LOCALIZACAO_2 VARCHAR(30),
    PRD_LOCALIZACAO_3 VARCHAR(30),
    E_NOME VARCHAR(50),
    E_FONE VARCHAR(20),
    E_ENDERECO VARCHAR(50),
    E_CEP VARCHAR(8),
    E_BAIRRO VARCHAR(50),
    E_CIDADE VARCHAR(50),
    E_CNPJ VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_DIAS_TRAB_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    OST_DT_INICIO DATE,
    OST_DT_FIM DATE,
    OST_HR_INICIO TIME,
    OST_HR_FIM TIME,
    OST_QTDE_HORA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_EST_COMPROMETIDO (
    CNPJ VARCHAR(18))
RETURNS (
    TOTAL_ITEM NUMERIC(18,4),
    CLIENTE VARCHAR(70),
    CODIGO INTEGER,
    PRODUTO VARCHAR(70),
    QUANTIDADE NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    MARCA VARCHAR(50),
    FORNECEDOR INTEGER,
    PSA_CODIGO INTEGER,
    PSA_NOME_RAZAO VARCHAR(50),
    PRD_NOME VARCHAR(50),
    ORIGEM VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_MOV_ANEXO_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    MOV_HISTORICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    MOV_VALOR NUMERIC(18,4),
    MOV_TIPO CHAR(1),
    MOV_DATA DATE,
    MOV_TIPO_DESPESA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_MOVIMENTOS_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    OSI_CODIGO INTEGER,
    OSI_QUANTIDADE NUMERIC(18,4),
    OSI_SERVICO INTEGER,
    OSI_UNITARIO NUMERIC(18,4),
    SRV_CODIGO VARCHAR(15),
    SRV_NOME VARCHAR(50),
    SRV_SERVICO VARCHAR(10))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_OS_PREVENTIVA (
    CNPJ CHAR(14),
    COD_CIDADE INTEGER,
    COD_TECNICO INTEGER,
    COD_CLIENTE INTEGER,
    DATA_BASE DATE,
    ATIVO CHAR(1))
RETURNS (
    CONTRATO_ATIVO CHAR(1),
    CONTRATO_CLIENTE INTEGER,
    CONTRATO_CODIGO INTEGER,
    CONTRATO_DIAS_RECHAMADO INTEGER,
    CONTRATO_DT_FIM TIMESTAMP,
    CONTRATO_DT_INICIO TIMESTAMP,
    NUMERO_CONTRATO VARCHAR(30),
    TEMPO_RESPOSTA INTEGER,
    ATIVIDADE_CLIENTE INTEGER,
    BAIRRO_CLIENTE INTEGER,
    CIDADE_CLIENTE INTEGER,
    CODIGO_CLIENTE INTEGER,
    CPF_CNPJ VARCHAR(15),
    NOME_FANTASIA VARCHAR(50),
    RAZAO_SOCIAL VARCHAR(50),
    REGIAO_CLIENTE INTEGER,
    RG_INSC_ESTADUAL VARCHAR(15),
    UF CHAR(2),
    PRODUTO_ATIVO CHAR(1),
    CODIGO_PRODUTO VARCHAR(15),
    CODIGO_PRODUTO_SEC VARCHAR(15),
    CODIGO_MARCA INTEGER,
    NOME_PRODUTO VARCHAR(50),
    MARCA_PRODUTO VARCHAR(50),
    MODELO_PRODUTO VARCHAR(80),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    MEDIA_COPIA INTEGER,
    CONTRATO_COPIAS_PREVENTIVA INTEGER,
    QTDE_COPIA_ATUAL INTEGER,
    QTDE_COPIA_PREVISTA INTEGER,
    DT_FECHAMENTO_ULTIMO DATE,
    CONTADOR_ULTIMO INTEGER,
    PONTO_VISITA_PREVENTIVA DATE,
    DIAS_EM_ATRASO INTEGER,
    NOME_CIDADE VARCHAR(50),
    NOME_REGIAO VARCHAR(50),
    NOME_TIPO_CONTRATO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_POSICAO_EST (
    CNPJ VARCHAR(18),
    DATA_BASE DATE,
    CODPRODUTO VARCHAR(15),
    CODGRUPO INTEGER,
    CODSUBGRUPO INTEGER,
    CODMARCA INTEGER,
    CODFORNECEDOR INTEGER,
    CODLOCALIZACAO1 INTEGER,
    CODLOCALIZACAO2 INTEGER,
    CODLOCALIZACAO3 INTEGER,
    CPL CHAR(1))
RETURNS (
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    COD_FORNECEDOR INTEGER,
    FORNECEDOR VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    DATA_MOV DATE,
    ORIGEM VARCHAR(6),
    QTDE_ANT NUMERIC(18,4),
    QTDE NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    TIPO_MOV CHAR(1),
    UND VARCHAR(4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_AQUISICAO NUMERIC(18,4),
    TTL_PRC_CUSTO_MED NUMERIC(18,4),
    TTL_PRC_VENDA NUMERIC(18,4),
    TTL_CUSTO_AQUISICAO NUMERIC(18,4),
    DT_VENCTO_PRC_VENDA DATE,
    LOCALIZACAO_1 INTEGER,
    LOCALIZACAO_2 INTEGER,
    LOCALIZACAO_3 INTEGER,
    LOCALIZACAO_1_NOME VARCHAR(50),
    LOCALIZACAO_2_NOME VARCHAR(50),
    LOCALIZACAO_3_NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LST_POSICAO_EST2 (
    CNPJ VARCHAR(14),
    DATA_BASE DATE,
    CODPRODUTO VARCHAR(15),
    CODGRUPO INTEGER,
    CODSUBGRUPO INTEGER,
    CODMARCA INTEGER,
    CODFORNECEDOR INTEGER,
    CODLOCALIZACAO1 INTEGER,
    CODLOCALIZACAO2 INTEGER,
    CODLOCALIZACAO3 INTEGER,
    CPL CHAR(1))
RETURNS (
    PRODUTO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_LT_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    COD_VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_MIGRA_CONTRATO_LEITURA (
    CNPJ VARCHAR(14))
RETURNS (
    CONT INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_MS_ESTORNA_FATURAMENTOS (
    CNPJ VARCHAR(14),
    MS_CODIGO INTEGER,
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_MS_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    DATA_CX DATE,
    CONTA INTEGER,
    DT_VENCTO DATE)
RETURNS (
    COD_FATURAMENTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFE_FATURAMENTOS (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    CODIGO INTEGER,
    NUM_NF INTEGER,
    NUM_CF INTEGER,
    TRP_PLACA VARCHAR(8),
    TRP_UF_PLACA VARCHAR(2),
    CANCELADA CHAR(1),
    TOTAL FLOAT,
    TOTAL_NF FLOAT,
    DESC_ACRESC FLOAT,
    DATA DATE,
    DATA_CX DATE,
    SELECIONADO CHAR(1),
    ID_AGRUPADOR INTEGER,
    CFOP INTEGER,
    NATUREZA VARCHAR(50),
    DEST_CPF_CNPJ VARCHAR(14),
    DEST_CEP VARCHAR(8),
    DEST_LOGRADOURO VARCHAR(100),
    DEST_NUMERO VARCHAR(15),
    DEST_COMPLEMENTO VARCHAR(50),
    DEST_BAIRRO VARCHAR(50),
    DEST_COD_CIDADE INTEGER,
    DEST_CIDADE VARCHAR(50),
    DEST_UF VARCHAR(2),
    DEST_FONE VARCHAR(20),
    DEST_IE VARCHAR(20),
    DEST_RAZAO_SOCIAL VARCHAR(50),
    ICM FLOAT,
    VALOR_ICM_SUBST FLOAT,
    BASE_ICM FLOAT,
    BASE_ICM_SUBST FLOAT,
    SCNPJ VARCHAR(14),
    PSA_CODIGO INTEGER,
    NFE_PROTOCOLO VARCHAR(200),
    NFE_RECIBO VARCHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    AVISTA CHAR(1),
    OUTROS CHAR(1),
    ES CHAR(1),
    NFE_CHAVE VARCHAR(80),
    NFE_AUTORIZADA CHAR(1),
    OBSERVACAO VARCHAR(200),
    PGTO_FRETE CHAR(1),
    TRP_NOME VARCHAR(50),
    TRP_MOTORISTA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    TRP_ESPECIE VARCHAR(50),
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_LIQUIDO FLOAT,
    TRP_QTDE FLOAT,
    TRP_CPF_CNPJ VARCHAR(50),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE2 VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_CPF_CNPJ2 VARCHAR(14),
    TRP_UF VARCHAR(2),
    TRP_IE VARCHAR(50),
    MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFE_FATURAMENTOS_ITENS (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    NITEM INTEGER,
    CFOP INTEGER,
    CPROD VARCHAR(15),
    CXPRODUTO VARCHAR(50),
    QCOM FLOAT,
    UCOM VARCHAR(4),
    VPROD FLOAT,
    VUNCOM FLOAT,
    QTRIB FLOAT,
    UTRIB VARCHAR(4),
    VUTRIB FLOAT,
    TRIB_MODALIDADE VARCHAR(50),
    PICMS NUMERIC(18,4),
    VICMS NUMERIC(18,4),
    VBC NUMERIC(18,4),
    PICMS_SUB NUMERIC(18,4),
    VICMS_SUB NUMERIC(18,4),
    VBC_SUB NUMERIC(18,4),
    CST VARCHAR(10),
    CODIGO_NCM VARCHAR(50),
    TRIB_PIS CHAR(2),
    TRIB_COFINS CHAR(2),
    TRIB_IPI CHAR(2),
    CSOSN INTEGER,
    COD_GETIN VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFE_VERIFICA_NUM_NF (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    NUM_NF VARCHAR(20),
    SERIE VARCHAR(3))
RETURNS (
    EXISTE_NF INTEGER,
    EXISTE_XML INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFENT_EXPORTA_ITENS_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    PSA_CODIGO INTEGER,
    SERIE CHAR(10),
    DATA_ENTRADA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    BASE_IPI FLOAT,
    IND_TRIB_IPI CHAR(1),
    IND_TRIB_ICMS CHAR(1),
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_PCT_RED_BASE FLOAT,
    PRODUTO_ALIQ_IPI FLOAT,
    DESP_ACESSORIAS FLOAT,
    PRODUTO_ALIQ_ICMS FLOAT,
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_ISS FLOAT,
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    REDUCAO FLOAT,
    CNPJ_EMITENTE VARCHAR(15),
    VLR_ICM_SUBS_ITEM FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFENT_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_ENTRADA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    BASE_IPI FLOAT,
    IND_TRIB_IPI CHAR(1),
    IND_TRIB_ICMS CHAR(1),
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_PCT_RED_BASE FLOAT,
    PRODUTO_ALIQ_IPI FLOAT,
    DESP_ACESSORIAS FLOAT,
    PRODUTO_ALIQ_ICMS FLOAT,
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_ISS FLOAT,
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    REDUCAO FLOAT,
    CNPJ_EMITENTE VARCHAR(15),
    VLR_ICM_SUBS_ITEM FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFS_EXPORTA_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFS_EXPORTA_ITENS_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    VLR_OUTROS FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFS_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    VLR_OUTROS FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_NFS_EXPORTA_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    MODELO VARCHAR(4),
    DATA_SAIDA DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OFC_EST_LEITURA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    VENDA INTEGER)
RETURNS (
    COD_FATURAMENTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OFC_LEITURA_GERA_ITENS (
    CNPJ VARCHAR(14),
    CONTRATO INTEGER,
    LEITURA INTEGER,
    DATA_REFERENCIA DATE,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OFC_LEITURA_UPD_TOTAL (
    CNPJ VARCHAR(14),
    LEITURA INTEGER,
    ITEM_LEITURA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OFC_MEDIA_COPIA (
    CNPJ VARCHAR(14),
    LEITURA INTEGER,
    DATA_REF DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OFC_MENSALIDADES_GERA_ITENS (
    CNPJ VARCHAR(14),
    CONTRATO INTEGER,
    COD_MENSALIDADE INTEGER,
    DATA_REFERENCIA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_OS_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    COD_VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_RECIBO_REC (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    REIMPRESSAO CHAR(1))
RETURNS (
    CLI_CODIGO INTEGER,
    CLI_NOME VARCHAR(80),
    CLI_CPF_CNPJ VARCHAR(20),
    VLR_BAIXA NUMERIC(18,4),
    RECIBO INTEGER,
    REC_CODIGO INTEGER,
    REC_PARCELA VARCHAR(6),
    REC_VLR_BAIXA NUMERIC(18,4),
    REC_SALDO NUMERIC(18,4),
    REC_JUROS NUMERIC(18,4),
    REC_MULTA NUMERIC(18,4),
    REC_VALOR_NOMINAL NUMERIC(18,4),
    REC_BX_PARCIAL NUMERIC(18,4),
    REC_SALDO_NOMINAL NUMERIC(18,4),
    REC_DESCONTOS NUMERIC(18,4),
    REC_DOCTO VARCHAR(20),
    REC_HISTORICO VARCHAR(100),
    BX_HISTORICO VARCHAR(100),
    REC_VENDA INTEGER,
    REC_DT_LANCTO DATE,
    EP_NOME VARCHAR(50),
    EP_ENDERECO VARCHAR(100),
    EP_BAIRRO VARCHAR(50),
    EP_CIDADE VARCHAR(50),
    EP_FONE VARCHAR(20),
    EP_FAX VARCHAR(20),
    EP_CNPJ VARCHAR(20),
    TIPO_BAIXA VARCHAR(50),
    IMPRESSAO VARCHAR(50),
    NUM_NF INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_AUX_CONTAGEM_ESTOQUE (
    CNPJ VARCHAR(18),
    IDMARCA INTEGER,
    IDGRUPO INTEGER,
    IDSUBGRUPO INTEGER,
    ATIVO CHAR(1))
RETURNS (
    PRD_ATIVO CHAR(1),
    PRD_CNPJ CHAR(14),
    PRD_CODIGO VARCHAR(15),
    PRD_CODIGO_2 VARCHAR(15),
    PRD_EST_MAX NUMERIC(18,4),
    PRD_EST_MIN NUMERIC(18,4),
    PRD_GRUPO INTEGER,
    PRD_LOCALIZACAO_1 VARCHAR(30),
    PRD_LOCALIZACAO_2 VARCHAR(30),
    PRD_LOCALIZACAO_3 VARCHAR(30),
    PRD_MARCA INTEGER,
    PRD_NOME VARCHAR(50),
    PRD_POSSUI_LOTE CHAR(1),
    PRD_QTDADE_1 NUMERIC(18,4),
    PRD_QTDADE_2 NUMERIC(18,4),
    PRD_QTDADE_MAX NUMERIC(18,4),
    PRD_QTDADE_MIN NUMERIC(18,4),
    PRD_SUBGRUPO INTEGER,
    PRD_SUBUNIDADE INTEGER,
    PRD_UNIDADE CHAR(4),
    GRP_NOME VARCHAR(50),
    SGRP_NOME VARCHAR(50),
    LOTE_LOTE VARCHAR(10),
    LOTE_VALIDADE TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COM_COBRADOR (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    CODIGO INTEGER,
    COD_COBRADOR INTEGER,
    COBRADOR VARCHAR(50),
    CLIENTE VARCHAR(75),
    COD_DOCTO INTEGER,
    VLR_NOMINAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    VLR_JUROS NUMERIC(18,4),
    VLR_DESCONTOS NUMERIC(18,4),
    DT_VENCTO DATE,
    DT_PAGTO DATE,
    ATRASO INTEGER,
    HR_COB TIME,
    DATA_COB DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSAO (
    CNPJ VARCHAR(14),
    QUITADO CHAR(1))
RETURNS (
    CM_CNPJ VARCHAR(14),
    CM_CODIGO INTEGER,
    CM_COD_VENDA INTEGER,
    CM_COD_VENDEDOR INTEGER,
    CMP_COD_RECEBER INTEGER,
    CMP_PARC_CR VARCHAR(6),
    CMP_PCT_LIBERADO NUMERIC(18,4),
    CMP_PCT_PAGO NUMERIC(18,4),
    CMP_PCT_VLR_TOTAL NUMERIC(18,4),
    VD_DATA DATE,
    VD_DT_CX DATE,
    VD_TOTAL NUMERIC(18,4),
    VD_ENTRADA NUMERIC(18,4),
    VD_DESC_ACRESC NUMERIC(18,4),
    VD_TOTAL_LIQ NUMERIC(18,4),
    VD_COD_PAGTO INTEGER,
    VD_COD_CLIENTE INTEGER,
    VD_CLIENTE VARCHAR(50),
    VD_FORMA_PAGTO VARCHAR(80),
    VDI_QTDE NUMERIC(18,4),
    VDI_PRC_UNITARIO NUMERIC(18,4),
    VDI_DESCONTO NUMERIC(18,4),
    VDI_CUSTO NUMERIC(18,4),
    VDI_TTL_ITEM NUMERIC(18,4),
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(50),
    VDD_NOME VARCHAR(50),
    PRD_COD_NOME VARCHAR(80))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSAO_REC (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    VD_CODIGO INTEGER,
    DATA DATE,
    VD_DT_CAIXA DATE,
    PESSOA_FJ INTEGER,
    CLIENTE VARCHAR(55),
    DOCTO VARCHAR(15),
    TOTAL NUMERIC(18,4),
    COD_REC INTEGER,
    COD_ORIGEM INTEGER,
    ORIGEM VARCHAR(10),
    LIQUIDO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VLR_COMISSAO NUMERIC(18,4),
    VLR_BX_ORIG NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    PCT_BAIXA NUMERIC(18,4),
    NUM_NF INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSAO_TRC (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    CLIENTE VARCHAR(50),
    PESSOA_FJ INTEGER,
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    TIPO_MOV CHAR(10),
    LIQUIDO NUMERIC(18,4),
    PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSAO_VED (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    CLIENTE VARCHAR(55),
    NATUREZA INTEGER,
    DOCTO VARCHAR(15),
    TOTAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    FORM_PAGTO INTEGER,
    PRAZO NUMERIC(18,4),
    VLR_COMISSAO NUMERIC(18,4),
    TIPO_MOV VARCHAR(10),
    TIPO_FAT VARCHAR(10),
    ID_AGRUPADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSOES_TERC_BX (
    CNPJ VARCHAR(14),
    CODIGO_CR INTEGER,
    CODIGO_PG INTEGER,
    CODIGO INTEGER)
RETURNS (
    COD_BAIXA INTEGER,
    VLR_COMISSAO NUMERIC(18,4),
    PCT_BAIXA NUMERIC(18,4),
    VALOR_BAIXA NUMERIC(18,4),
    STATUS CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_COMISSOES_TERCEIROS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    AGENTE VARCHAR(100),
    VLR_COMISSAO NUMERIC(18,4),
    VLR_CONTA NUMERIC(18,4),
    SALDO_COMISSAO NUMERIC(18,4),
    COD_PAGAR INTEGER,
    COD_RECEBER INTEGER,
    RCNPJ VARCHAR(14),
    RCODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_CT13 (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    INSC_ESTADUAL VARCHAR(15),
    CNPJ_PROPRIEDADE VARCHAR(14),
    PECUARISTA VARCHAR(50),
    PROPRIEDADE VARCHAR(50),
    CIDADE_PROPRIEDADE VARCHAR(50),
    ENDERECO_PROPRIEDADE VARCHAR(50),
    ENDERECO_PECUARISTA VARCHAR(50),
    CEP VARCHAR(50),
    EMAIL VARCHAR(80),
    CELULAR VARCHAR(20),
    CIDADE_PECUARISTA VARCHAR(50),
    UF VARCHAR(2),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    NUM_DOSES NUMERIC(18,4),
    NUM_NF INTEGER,
    DATA_FABRICACAO DATE,
    DATA_COMPRA DATE,
    PARTIDA VARCHAR(10),
    LABORATORIO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_DEMONSTRATIVO (
    CNPJ VARCHAR(14),
    MES INTEGER,
    ANO INTEGER)
RETURNS (
    CODIGO INTEGER,
    AGRUPADOR INTEGER,
    NOME VARCHAR(50),
    VALOR1 FLOAT,
    VALOR2 FLOAT,
    VALOR3 FLOAT,
    VALOR4 FLOAT,
    VALOR5 FLOAT,
    VALOR6 FLOAT,
    SMES1 VARCHAR(10),
    SMES2 VARCHAR(10),
    SMES3 VARCHAR(10),
    SMES4 VARCHAR(10),
    SMES5 VARCHAR(10),
    SMES6 VARCHAR(10))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_DEVOLUCOES (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    N_DOCTO INTEGER,
    NOME_RAZAO VARCHAR(70),
    COD_VENDA INTEGER,
    DATA DATE,
    CFOP INTEGER,
    TIPO_VENDA CHAR(3),
    DATA_CAIXA DATE,
    VLR_BRUTO NUMERIC(18,4),
    VLR_DESC_ACRESC NUMERIC(18,4),
    VLR_TOTAL NUMERIC(18,4),
    VLR_BASE_ICM NUMERIC(18,4),
    VLR_ICM NUMERIC(18,4),
    VLR_ICM_SUB NUMERIC(18,4),
    VLR_BASE_ICM_SUB NUMERIC(18,4),
    CANCELADA CHAR(1),
    STATUS VARCHAR(10),
    TIPO_DOC INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_ENT_PRODUTOS (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    FORNECEDOR VARCHAR(65),
    DATA_NF DATE,
    NDOC VARCHAR(20),
    PRODUTO VARCHAR(80),
    NUM_NF VARCHAR(20),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    ORIGEM CHAR(3),
    DESCONTO_NOTA NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    COD_FORN INTEGER,
    AQUI CHAR(3),
    CFOP INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_ENTRADAS_PRODUTOS (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_EQUIPAMENTOS (
    CNPJ VARCHAR(15),
    DATA1 DATE,
    DATA2 DATE,
    PR_REGIAO INTEGER,
    PR_CLIENTE INTEGER,
    PR_MARCA INTEGER,
    PR_MODELO INTEGER,
    PR_EQUIPAMENTO VARCHAR(15),
    PR_TPCONTRATO INTEGER,
    PR_CONTRATO INTEGER,
    PR_CIDADE INTEGER,
    PR_SERIE VARCHAR(30),
    ATIVO CHAR(1))
RETURNS (
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(90),
    SERIE VARCHAR(30),
    MRC_CODIGO INTEGER,
    MARCA VARCHAR(50),
    MODELO VARCHAR(50),
    MDL_CODIGO INTEGER,
    MEDIA_COPIAS INTEGER,
    COD_CLIENTE INTEGER,
    CHAMADOS_SUB INTEGER,
    CHAMADOS_TIT INTEGER,
    KM_RODADO FLOAT,
    TEMPO_RESP_VENC INTEGER,
    TEMPO_RESP_MED FLOAT,
    PSA_FANTASIA VARCHAR(80),
    REG_CODIGO INTEGER,
    REG_NOME VARCHAR(50),
    BAIRRO VARCHAR(50),
    ENDERECO VARCHAR(100),
    CIDADE VARCHAR(60),
    FONE VARCHAR(20),
    TOTAL_CHAMADOS INTEGER,
    COD_TIPO_CONTRATO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_PAGAR (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    DT_CX DATE,
    TIPO CHAR(1))
RETURNS (
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DOCTO VARCHAR(20),
    TIPO_DOCTO CHAR(3),
    CLIENTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    VALOR_NOMINAL FLOAT,
    BX_PARCIAL FLOAT,
    SALDO FLOAT,
    COD_CLASSIFICACAO INTEGER,
    CLASSIFICACAO VARCHAR(50),
    COD_LOCALCOBRANCA INTEGER,
    LOCALCOBRANCA VARCHAR(50),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    COD_REGIAO INTEGER,
    REGIAO VARCHAR(50),
    FONE VARCHAR(20),
    CONTATO VARCHAR(30),
    LOCAL_TRABALHO VARCHAR(50),
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(50),
    UNIDADE VARCHAR(4),
    SUBUNIDADE INTEGER,
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_DESCONTO FLOAT,
    PRD_TOTAL FLOAT,
    DATA_ULT_BX DATE,
    JUROS FLOAT,
    MULTA FLOAT,
    DESCTO_RES FLOAT,
    ARQ_MORTO CHAR(1),
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_PRODUTOS (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    ICOD_PRODUTO VARCHAR(15),
    CLIENTE INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    MARCA INTEGER)
RETURNS (
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    DESC_RATEADO NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    COD_PRODUTO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_RECEBER (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    DT_CX DATE,
    TIPO CHAR(1))
RETURNS (
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DOCTO VARCHAR(20),
    TIPO_DOCTO CHAR(3),
    CLIENTE VARCHAR(50),
    NOME_CLIENTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    VALOR_NOMINAL FLOAT,
    BX_PARCIAL FLOAT,
    SALDO FLOAT,
    COD_CLASSIFICACAO INTEGER,
    CLASSIFICACAO VARCHAR(50),
    COD_LOCALCOBRANCA INTEGER,
    LOCALCOBRANCA VARCHAR(50),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    COD_REGIAO INTEGER,
    REGIAO VARCHAR(50),
    CIDADE_NOME VARCHAR(50),
    COD_ROTA INTEGER,
    ROTA VARCHAR(50),
    FONE VARCHAR(20),
    CONTATO VARCHAR(30),
    LOCAL_TRABALHO VARCHAR(50),
    DATA_ULT_BX DATE,
    JUROS FLOAT,
    MULTA FLOAT,
    DESCTO_RES FLOAT,
    ARQ_MORTO CHAR(1),
    VENDA INTEGER,
    VLR_COMISSAO FLOAT,
    PORCENTAGEM FLOAT,
    CIDADE INTEGER,
    NUM_NF INTEGER,
    XMULTA FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_SUGESTAO_COMPRA (
    CNPJ VARCHAR(18),
    DATA1 DATE,
    DATA2 DATE,
    COD_FORNECEDOR2 INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    PRODUTO VARCHAR(80),
    VMM FLOAT,
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    FORNECEDOR VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50),
    UNIDADE VARCHAR(4),
    QTDE_PEDIDA FLOAT,
    QTDE_MAX FLOAT,
    QTDE_MIN FLOAT,
    QTDE FLOAT,
    COD_FORNECEDOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_TITULOS_PENDENTES (
    CNPJ VARCHAR(14),
    E_PESSOA_FJ INTEGER,
    E_DT_VENCTO_1 DATE,
    E_DT_VENCTO_2 DATE,
    E_DT_EMISSAO_1 DATE,
    E_DT_EMISSAO_2 DATE,
    E_JUROS NUMERIC(18,4),
    E_DESCONTO NUMERIC(18,4),
    DTBASE DATE)
RETURNS (
    CODIGO INTEGER,
    TIPO VARCHAR(20),
    COD_PESSOA INTEGER,
    NOME_PESSOA VARCHAR(70),
    DOCTO VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    DT_EMISSAO DATE,
    DATA_ULT_BX DATE,
    DT_VENCIMENTO DATE,
    INDEXADOR VARCHAR(20),
    QTDE_INDEXADOR NUMERIC(18,4),
    VARIACAO_INDEXADOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    SALDO_FINAL NUMERIC(18,4),
    VALOR_NOMINAL NUMERIC(18,4),
    AMORTIZACAO NUMERIC(18,4),
    SALDO_NOMINAL NUMERIC(18,4),
    B_JUROS NUMERIC(18,4),
    B_DESCONTOS NUMERIC(18,4),
    B_SALDO_FINAL NUMERIC(18,4),
    B_VALOR_NOMINAL NUMERIC(18,4),
    B_AMORTIZACAO NUMERIC(18,4),
    B_SALDO_NOMINAL NUMERIC(18,4),
    COD_VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_VD_GRUPO (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    CLIENTE INTEGER,
    FECHADA CHAR(1),
    DATAINI DATE,
    DATAFIM DATE,
    TIPO_CUSTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_PRODUTO VARCHAR(80),
    DATA DATE,
    DATA_CAIXA DATE,
    NOME_RAZAO VARCHAR(50),
    NOME VARCHAR(50),
    QTDE NUMERIC(18,4),
    VLR_VENDA NUMERIC(18,4),
    VLR_DESCONTO NUMERIC(18,4),
    VLR_BRUTO NUMERIC(18,4),
    VLR_CUSTO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_VENDAS_GERAIS (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    N_DOCTO INTEGER,
    NOME_RAZAO VARCHAR(70),
    COD_VENDA INTEGER,
    DATA DATE,
    CFOP INTEGER,
    TIPO_VENDA CHAR(3),
    DATA_CAIXA DATE,
    VLR_BRUTO NUMERIC(18,4),
    VLR_DESC_ACRESC NUMERIC(18,4),
    VLR_TOTAL NUMERIC(18,4),
    VLR_BASE_ICM NUMERIC(18,4),
    VLR_ICM NUMERIC(18,4),
    VLR_ICM_SUB NUMERIC(18,4),
    VLR_BASE_ICM_SUB NUMERIC(18,4),
    CANCELADA CHAR(1),
    STATUS VARCHAR(10),
    TIPO_DOC INTEGER,
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_VENDAS_MARCA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO_VD INTEGER,
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    PESO NUMERIC(18,4),
    TOTAL_PESO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CLIENTE VARCHAR(100),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    N_DOCTO INTEGER,
    DATA_CX DATE,
    DATA_VD DATE,
    CFOP INTEGER,
    UND VARCHAR(10),
    PRODUTO VARCHAR(70),
    SEQUENCIA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_VENDAS_PERIODO (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    TOTAL_BRUTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    DATA TIMESTAMP,
    DATA_CX DATE,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    OBSERVACAO VARCHAR(80),
    TIPO_MOV CHAR(5),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CANCELADA CHAR(1),
    PRD_COD CHAR(15),
    PRD_NOME CHAR(50),
    PRD_UNIDADE CHAR(4),
    PRD_SUBUNIDADE INTEGER,
    PRD_QUANTIDADE NUMERIC(18,4),
    PRD_PRC_UNITARIO NUMERIC(18,4),
    PRD_DESCONTO NUMERIC(18,4),
    PRD_TOTAL NUMERIC(18,4),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    DOCTO CHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REL_VENDAS_PERIODO_SINT (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    TOTAL_BRUTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    DATA DATE,
    DATA_CX DATE,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    OBSERVACAO VARCHAR(80),
    TIPO_MOV CHAR(5),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CANCELADA CHAR(1),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    DOCTO CHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REPROCESSA_CUSTO_MEDIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    DATA DATE)
RETURNS (
    CUSTOMEDIO FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_RESUMO_CAIXA (
    CNPJ VARCHAR(14),
    DATA_CX DATE,
    USUARIO INTEGER,
    TURNO INTEGER,
    CONTA INTEGER)
RETURNS (
    DIN_VDVISTA NUMERIC(18,4),
    DIN_VDPRAZO NUMERIC(18,4),
    DIN_RECBTO NUMERIC(18,4),
    CHVISTA_VDVISTA NUMERIC(18,4),
    CHVISTA_VDPRAZO NUMERIC(18,4),
    CHVISTA_RECBTO NUMERIC(18,4),
    CHPRE_VDVISTA NUMERIC(18,4),
    CHPRE_VDPRAZO NUMERIC(18,4),
    CHPRE_RECBTO NUMERIC(18,4),
    CRTVISTA_VDVISTA NUMERIC(18,4),
    CRTVISTA_VDPRAZO NUMERIC(18,4),
    CRTVISTA_RECBTO NUMERIC(18,4),
    CRTPRE_VDVISTA NUMERIC(18,4),
    CRTPRE_VDPRAZO NUMERIC(18,4),
    CRTPRE_RECBTO NUMERIC(18,4),
    TICKET_VDVISTA NUMERIC(18,4),
    TICKET_VDPRAZO NUMERIC(18,4),
    TICKET_RECBTO NUMERIC(18,4),
    TOTAL_DINHEIRO NUMERIC(18,4),
    TOTAL_CHEQUE_VISTA NUMERIC(18,4),
    TOTAL_CHEQUE_PRE NUMERIC(18,4),
    TOTAL_CARTAO_VISTA NUMERIC(18,4),
    TOTAL_CARTAO_PRE NUMERIC(18,4),
    TOTAL_TROCO NUMERIC(18,4),
    TROCO_VDVISTA NUMERIC(18,4),
    TROCO_VDPRAZO NUMERIC(18,4),
    TOTAL_VALE_TROCO NUMERIC(18,4),
    TOTAL_GERAL NUMERIC(18,4),
    TOTAL_CHEQUE NUMERIC(18,4),
    TOTAL_CARTAO NUMERIC(18,4),
    TOTAL_TICKET NUMERIC(18,4),
    TOTAL_ENTCX NUMERIC(18,4),
    TOTAL_SAIDACX NUMERIC(18,4),
    TOTAL_VDVISTA NUMERIC(18,4),
    TOTAL_VDPRAZO NUMERIC(18,4),
    TOTAL_PARCELADO NUMERIC(18,4),
    TOTAL_CAIXA NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    CP_SLD_ANT CHAR(1),
    AB_CXDINHEIRO NUMERIC(18,4),
    AB_CXMOEDA NUMERIC(18,4),
    AB_CXCHEQUE NUMERIC(18,4),
    AB_CXCHEQUE_PRAZO NUMERIC(18,4),
    AB_CXTICKET NUMERIC(18,4),
    AB_CXTOTAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_RESUMO_CAIXA_PERIODO (
    CNPJ VARCHAR(14),
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    DIN_VDVISTA NUMERIC(18,4),
    DIN_VDPRAZO NUMERIC(18,4),
    DIN_RECBTO NUMERIC(18,4),
    CHVISTA_VDVISTA NUMERIC(18,4),
    CHVISTA_VDPRAZO NUMERIC(18,4),
    CHVISTA_RECBTO NUMERIC(18,4),
    CHPRE_VDVISTA NUMERIC(18,4),
    CHPRE_VDPRAZO NUMERIC(18,4),
    CHPRE_RECBTO NUMERIC(18,4),
    CRTVISTA_VDVISTA NUMERIC(18,4),
    CRTVISTA_VDPRAZO NUMERIC(18,4),
    CRTVISTA_RECBTO NUMERIC(18,4),
    CRTPRE_VDVISTA NUMERIC(18,4),
    CRTPRE_VDPRAZO NUMERIC(18,4),
    CRTPRE_RECBTO NUMERIC(18,4),
    TICKET_VDVISTA NUMERIC(18,4),
    TICKET_VDPRAZO NUMERIC(18,4),
    TICKET_RECBTO NUMERIC(18,4),
    TOTAL_DINHEIRO NUMERIC(18,4),
    TOTAL_CHEQUE_VISTA NUMERIC(18,4),
    TOTAL_CHEQUE_PRE NUMERIC(18,4),
    TOTAL_CARTAO_VISTA NUMERIC(18,4),
    TOTAL_CARTAO_PRE NUMERIC(18,4),
    TOTAL_TROCO NUMERIC(18,4),
    TROCO_VDVISTA NUMERIC(18,4),
    TROCO_VDPRAZO NUMERIC(18,4),
    TOTAL_VALE_TROCO NUMERIC(18,4),
    TOTAL_GERAL NUMERIC(18,4),
    TOTAL_CHEQUE NUMERIC(18,4),
    TOTAL_CARTAO NUMERIC(18,4),
    TOTAL_TICKET NUMERIC(18,4),
    TOTAL_ENTCX NUMERIC(18,4),
    TOTAL_SAIDACX NUMERIC(18,4),
    TOTAL_VDVISTA NUMERIC(18,4),
    TOTAL_VDPRAZO NUMERIC(18,4),
    TOTAL_PARCELADO NUMERIC(18,4),
    TOTAL_CAIXA NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    CP_SLD_ANT CHAR(1),
    AB_CXDINHEIRO NUMERIC(18,4),
    AB_CXMOEDA NUMERIC(18,4),
    AB_CXCHEQUE NUMERIC(18,4),
    AB_CXCHEQUE_PRAZO NUMERIC(18,4),
    AB_CXTICKET NUMERIC(18,4),
    AB_CXTOTAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_RET_VLR_VENDA (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    DESC_ATUAL NUMERIC(18,4))
RETURNS (
    TTL_UNT_ORIG NUMERIC(18,4),
    TTL_UNT NUMERIC(18,4),
    TTL_VENDA NUMERIC(18,4),
    TTL_DESCTO NUMERIC(18,4),
    TTL_PERCT NUMERIC(18,4),
    DESCTO_RES NUMERIC(18,4),
    VALIDO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_REUTILIZAR_N_NF (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SELECIONA_VENDA (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    VELHO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SET_NF_AGRUPADA (
    CNPJ VARCHAR(18),
    PESSOA_FJ INTEGER,
    NUMERO INTEGER,
    SERIE CHAR(3),
    DATA_NF DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SET_SALDO_ORCAMENTO (
    CNPJ VARCHAR(18),
    COD_VENDA INTEGER,
    COD_ORCAMENTO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_50 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_DOCTO DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT,
    VLR_ISENTO FLOAT,
    VLR_BASE FLOAT,
    EMISSORDOCUMENTO CHAR(1),
    MODELO INTEGER,
    CODIGO_FISCAL CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_53 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_DOCTO DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT,
    VLR_ISENTO FLOAT,
    VLR_BASE FLOAT,
    EMISSORDOCUMENTO CHAR(1),
    CODIGO_FISCAL CHAR(4),
    SITUACAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_54 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    PSA_CPF_CNPJ VARCHAR(15),
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_MOVTO DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESP_ACESSORIAS FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    BASE_IPI FLOAT,
    CODIGO_FISCAL CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_60D (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    DATA_MOVTO DATE,
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    PRD_DESCRICAO VARCHAR(50),
    PRD_UNIDADE VARCHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_60I (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    DATA_MOVTO DATE,
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    PRD_DESCRICAO VARCHAR(50),
    PRD_UNIDADE VARCHAR(3),
    NUM_CUPOM INTEGER,
    N_ITEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SINTEG_60R (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    MESANO VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SUB_PCD_EST_MAX_MIN (
    CNPJ VARCHAR(18),
    GRUPO INTEGER,
    PRD_CODIGO VARCHAR(15),
    TIPO INTEGER)
RETURNS (
    PRD_ESTOQUE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_SUB_REL_RECEBER (
    CNPJ VARCHAR(14),
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DT_CX DATE,
    TIPO_JUROS CHAR(1),
    TX_JUROS_ATE NUMERIC(18,4),
    TX_JUROS_APOS NUMERIC(18,4),
    TOLERANCIA_JUROS INTEGER,
    MULTA_FINANCEIRA NUMERIC(18,4),
    CIDADE INTEGER,
    VENDA INTEGER,
    DATA DATE,
    VLR_CONTA NUMERIC(18,4),
    COD_LOCALCOBRANCA INTEGER)
RETURNS (
    DESCTO_RES NUMERIC(15,2),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    LOCALCOBRANCA VARCHAR(50),
    CLASSIFICACAO VARCHAR(50),
    COD_CLASSIFICACAO INTEGER,
    LOCAL_TRABALHO VARCHAR(50),
    ROTA VARCHAR(50),
    COD_ROTA INTEGER,
    SALDO NUMERIC(18,4),
    JUROS FLOAT,
    MULTA FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_TESTANDO (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    DESC_ATUAL NUMERIC(18,4))
RETURNS (
    TTL_VENDA NUMERIC(18,4),
    DESCTO_RES NUMERIC(18,4),
    VALIDO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_TOTAL_FISCAL (
    CNPJ VARCHAR(14),
    DTINI DATE,
    DTFIN DATE,
    CLIENTE INTEGER)
RETURNS (
    CTE5VLRICMS NUMERIC(18,4),
    CTE5TOTAL NUMERIC(18,4),
    CTE5BASEICMS NUMERIC(18,4),
    CTEESTBASEICMS NUMERIC(18,4),
    CTEESTVLRICMS NUMERIC(18,4),
    CTEESTTOTAL NUMERIC(18,4),
    CTEINTBASEICMS NUMERIC(18,4),
    CTEINTVLRICMS NUMERIC(18,4),
    CTEINTTOTAL NUMERIC(18,4),
    CTE3BASEICMS NUMERIC(18,4),
    CTE3VLRICMS NUMERIC(18,4),
    CTE3TOTAL NUMERIC(18,4),
    CTEDIVBASEICMS NUMERIC(18,4),
    CTEDIVVLRICMS NUMERIC(18,4),
    CTEDIVTOTAL NUMERIC(18,4),
    CTEDEVBASEICMS NUMERIC(18,4),
    CTEDEVVLRICMS NUMERIC(18,4),
    CTEDEVTOTAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_TTL_VD_VISTA_PRAZO (
    CNPJ VARCHAR(14),
    USUARIO INTEGER,
    DATA_CX DATE,
    TURNO INTEGER,
    VISTA CHAR(1))
RETURNS (
    TOTAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_VENDA_TERCEIRO (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    TIPO CHAR(10),
    TIPO_DT CHAR(10))
RETURNS (
    CODIGO INTEGER,
    DATA_VD DATE,
    VLR_TOTAL FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_LIQUIDO FLOAT,
    TTL_CUSTO_ITENS FLOAT,
    LB_PCT FLOAT,
    LB_VLR FLOAT,
    COD_VENDEDOR INTEGER,
    VENDEDOR VARCHAR(50),
    COD_TERCEIRO INTEGER,
    TERCEIRO VARCHAR(50),
    COD_CLIENTE INTEGER,
    CLIENTE VARCHAR(50),
    COD_FORNECEDOR INTEGER,
    COD_MARCA INTEGER,
    COD_SUBGRUPO INTEGER,
    COD_GRUPO INTEGER,
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(50),
    COM_VISTA FLOAT,
    COM_PRAZO FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_VERIFICA_LIMITE (
    CNPJ VARCHAR(18),
    CLIENTE INTEGER,
    VALOR_VENDA NUMERIC(18,4),
    FORMA_PAGTO INTEGER)
RETURNS (
    VALIDO CHAR(1),
    LIMITE NUMERIC(18,4),
    TOTAL_CHEQUES NUMERIC(18,4),
    TOTAL_CHEQUES_N_CONCILIADO NUMERIC(18,4),
    TOTAL_CHEQUES_N_REAP NUMERIC(18,4),
    TOTAL_RECEBER NUMERIC(18,4),
    TOTAL_FATURAS NUMERIC(18,4),
    MOTIVO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_VERIFICA_VENDA_VINCULADA (
    CNPJ VARCHAR(14),
    ID_AGRUPADOR INTEGER,
    CFOP INTEGER,
    PRODUTO VARCHAR(15),
    QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCD_ZERA_ESTOQUE_GRADE
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PCT_ACT_GERA_ACERTO (
    CNPJ VARCHAR(14),
    DT_CAIXA DATE,
    HISTORICO VARCHAR(100),
    USUARIO INTEGER,
    TIPO_ACERTO INTEGER,
    VALOR_PAGAR NUMERIC(18,4),
    VALOR_RECEBER NUMERIC(18,4))
RETURNS (
    COD_ACERTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PDV_PRODUTO (
    E VARCHAR(14),
    C VARCHAR(15))
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO VARCHAR(1),
    ALIQUOTA_ECF VARCHAR(5),
    PESAVEL VARCHAR(1),
    NEG_QTDADE_2 CHAR(1),
    VALIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE POSSUI_GRADE (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PROCESSA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20),
    DATA DATE,
    DATA_CX DATE,
    BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PROCESSA_CONCILIACAO_CHEQUE (
    CNPJ VARCHAR(20),
    DATA DATE,
    CODIGO INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PROCESSA_DESDOBRAMENTO_CONTABIL (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_CODIGO (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO TIMESTAMP,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA TIMESTAMP,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100),
    COMPROMETIDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_CODIGOMAIOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100),
    COMPROMETIDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_CODIGOMENOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_NOME (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CNPJ VARCHAR(14),
    COMPLEMENTO VARCHAR(100),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO TIMESTAMP,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA TIMESTAMP,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    SECAO INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_NOMEMAIOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    SECAO INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PRODUTO_NOMEMENOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    SECAO INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE PROXIMO_TURNO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE QUANTIDADE_FISCAL (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE QUANTIDADE_PRODUTO (
    CNPJ CHAR(14),
    VENDA INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE RECALCULA_FATURA (
    CNPJ CHAR(14),
    FATURA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REGORGANIZA_CLIENTES
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REGORGANIZA_FORNECEDORES
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REORGANIZA_DATA_VENDA (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REORGANIZA_PARC_ENT
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REORGANIZA_PRODUTOS_GRADES (
    CNPJ CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REORGANIZA_RECEBER
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE REORGANIZA_VENDAS_PRAZO_VISTA
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE RESPONDER_MENSAGEN (
    REMETENTE VARCHAR(10),
    DESTINATARIO VARCHAR(10),
    RESERVADO CHAR(1),
    ASSUNTO VARCHAR(50),
    MENSAGEM VARCHAR(120),
    DT_ENVIO TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ROUND2 (
    ENTRA DECIMAL(15,4))
RETURNS (
    SAI DECIMAL(15,2))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_ANTERIOR_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CAIXA_GERAL (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CAIXAS_FRENTISTAS (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTA_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CONTA INTEGER,
    NOME VARCHAR(50),
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTA_PERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTA_PERIODO_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTAIND_PERIODO_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTAINDEXADO_PERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_CONTAS_PERIODO (
    CNPJ CHAR(14),
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    SALDO_INICIAL NUMERIC(18,4),
    SALDO_LANCADAS NUMERIC(18,4),
    SALDO_BAIXAS NUMERIC(18,4),
    SALDO_FINAL NUMERIC(18,4),
    ORIGEM CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_FLUXO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO_RECEBER NUMERIC(18,4),
    SALDO_PAGAR NUMERIC(18,4),
    SALDO_CHEQUE NUMERIC(18,4),
    SALDO_ESTOQUE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_INICIAL_ESTOQUE_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_VENDAS_PRAZO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDO_VENDAS_VISTA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANT_CONTA (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANT_CONTA_DRE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANT_CONTA_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANT_CONTACONC (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANTCONTABILIDADE (
    CNPJ VARCHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    CREDITO NUMERIC(18,8),
    DEBITO NUMERIC(18,8))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANTINDEXADO_CONTA (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOANTINDEXADO_CONTA_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDOPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SALDORESTANTEPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER,
    TOTAL NUMERIC(18,4))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SEL_VER_VENDAS (
    CNPJ CHAR(14),
    TP CHAR(1),
    I_CODIGO INTEGER,
    I_TIPO_VENDA CHAR(3),
    I_CLIENTE INTEGER,
    I_DATA DATE,
    I_DATA_CAIXA DATE)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_NF_XML VARCHAR(8),
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CARGA INTEGER,
    CANCELADA CHAR(1),
    SERIE CHAR(3),
    SELECIONADA CHAR(1),
    STATUS_CARREGAMENTO INTEGER,
    ORDEM_CARGA INTEGER,
    PSA_ATIVIDADE INTEGER,
    PSA_BAIRRO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_CEP VARCHAR(8),
    PSA_CIDADE INTEGER,
    PSA_COMPLEMENTO VARCHAR(30),
    PSA_CONTATO VARCHAR(30),
    PSA_CONVENIO INTEGER,
    PSA_CPF_CGC VARCHAR(15),
    PSA_DT_CADASTRO TIMESTAMP,
    PSA_DT_NASCIMENTO TIMESTAMP,
    PSA_EMISSOR VARCHAR(6),
    PSA_ENDERECO INTEGER,
    PSA_FANTASIA VARCHAR(50),
    PSA_FAX VARCHAR(20),
    PSA_FONE VARCHAR(20),
    PSA_INSC_MUNIC VARCHAR(15),
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_NUMERO VARCHAR(15),
    PSA_PESSOA CHAR(1),
    PSA_RG_IE VARCHAR(15),
    PSA_UF CHAR(2),
    LGD_NOME VARCHAR(50),
    BAI_NOME VARCHAR(50),
    CID_NOME VARCHAR(50),
    ID_AGRUPADOR INTEGER,
    ENTREGA_FUTURA CHAR(1),
    ATI_NOME VARCHAR(50),
    REG_NOME VARCHAR(50),
    PSA_EMAIL VARCHAR(80),
    PCT_COMISSAO NUMERIC(18,4),
    HORA TIME,
    NFE_CHAVE VARCHAR(80),
    NFE_SELECIONADO CHAR(1),
    NFE_VALIDADA CHAR(1),
    NFE_ASSINADA CHAR(1),
    NFE_TRANSMITIDA CHAR(1),
    NFE_AUTORIZADA CHAR(1),
    NFE_DANFE_IMPRESSO CHAR(1),
    N_SEQ_ECF CHAR(3),
    N_SERIE_ECF CHAR(20),
    NFE_PROTOCOLO CHAR(200),
    NFE_RECIBO CHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CONT_CARTAO INTEGER,
    CONT_CHEQUE INTEGER,
    VD_CHEQUE FLOAT,
    VD_CARTAO FLOAT,
    VD_DINHEIRO FLOAT,
    VD_ENTRADA FLOAT,
    DIVERG_CARTAO FLOAT,
    DIVERG_CHEQUE FLOAT,
    DT_EMISSAO_NF DATE,
    NFE_IMPRESSAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_COBRANCAS (
    INDICE VARCHAR(57),
    SELECIONADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_REC_CONVENIO_PERIODO (
    CNPJ CHAR(14),
    CONVENIO INTEGER,
    INICIAL DATE,
    FINAL DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_RECEBER (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_RECEBER_LOJA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1),
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SELECIONA_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    OPCAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SEQUENCIA_ETIQUETA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SEQUENCIA_ETIQUETA_IMPRIME (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SETAR_IMP_NF_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    IRRF NUMERIC(18,4),
    ISS NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SINTEGRA_50_ALIQUOTAS_ENT (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TOTAL NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA NUMERIC(18,4),
    CFOP INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SINTEGRA_75 (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO VARCHAR(15),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(4),
    IPI NUMERIC(18,4),
    COD_REDUCAO INTEGER,
    REDUCAO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SINTEGRA_VER_REG_75 (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DINI DATE,
    DFIM DATE)
RETURNS (
    QTDE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SIS_INF_RELACIONAMENTO (
    TABELA VARCHAR(31),
    CAMPO VARCHAR(31))
RETURNS (
    TABELA_REL VARCHAR(31),
    CAMPO_REL VARCHAR(31),
    CAMPO_RES VARCHAR(31))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_BAIXA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CARTAO_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CARTAO_VISTA_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_ABERTOS (
    CNPJ VARCHAR(20))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_ACERTADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_CONCILIADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_DEVOLVIDOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_DEVOLVIDOS_PESSOA (
    CNPJ VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_LANCADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_PLANILHA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CHEQUE_VISTA_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_ENTRADA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_ENTRADA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_FATURA_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_2MESES (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_3MESES (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_DATA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_DATA_ANALITICO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_PAGAR_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_2MESES (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_3MESES (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_CLIENTE (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    RECEBER NUMERIC(18,4),
    DATARECEBER DATE,
    FATURA NUMERIC(18,4),
    DATAFATURA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_CLIENTE_PDV (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    RECEBER NUMERIC(18,4),
    DATARECEBER DATE,
    FATURA NUMERIC(18,4),
    DATAFATURA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_DATA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    ARQ_MORTO CHAR(1))
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_DATA_ANALITICO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    ARQ_MORTO CHAR(1),
    CODREC INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_LOJA_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_LOJA_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_RECEBER_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_SANGRIAS (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    DATA TIMESTAMP)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VALORES_CAIXA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    DINHEIRO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    MOEDAS NUMERIC(18,4),
    CHEQUE_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VALORES_VENDAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    DINHEIRO NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    PRAZO NUMERIC(18,4),
    TROCO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VENDA_SELECIONADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4),
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VENDA_SELECIONADA_AGRUPADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4),
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VENDAS_FRMPAGTO_AGRUPADAS (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SOMA_VENDAS_FRMPAGTO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SP_FORMAT_FLOAT (
    VALOR VARCHAR(30))
RETURNS (
    SAI VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE SP_SUBSTRING (
    SRC VARCHAR(255) CHARACTER SET ISO8859_1,
    START_AT INTEGER,
    NLEN INTEGER)
RETURNS (
    RESULT VARCHAR(255) CHARACTER SET ISO8859_1)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE STRREPLACE (
    TEXTO VARCHAR(255) CHARACTER SET ISO8859_1,
    SEARCH CHAR(1),
    REPLACE CHAR(1))
RETURNS (
    RETORNO VARCHAR(255))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERE_NOTA_ENTRE_CLIENTE (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERE_NOTAFATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    FATURA INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_ATIVIDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_BAIRRO (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_CIDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_LOGRADOURO (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_PESSOA_FJ (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_PRODUTO (
    CNPJ CHAR(14),
    ORIGEM VARCHAR(15),
    DESTINO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TRANSFERIR_PROPRIEDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER,
    PORIGEM INTEGER,
    PDESTINO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TROCA_CENTRO_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    CENTRO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TROCA_PRODUTO_FISCAL (
    CNPJ CHAR(14),
    VENDA INTEGER,
    PRODUTO VARCHAR(15),
    FISCAL VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TROCAS_DIARIA_ENT (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TROCAS_DIARIA_SAI (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE TROCO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMA_CONTA (
    CONTA VARCHAR(15))
RETURNS (
    ULTIMACONTA VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMA_DATA_CAIXA (
    CNPJ VARCHAR(20),
    D DATE)
RETURNS (
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMA_DUPLICATA (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMA_GRADE (
    CNPJ CHAR(14))
RETURNS (
    GRADE CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMO_CAIXA_FECHADO (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER)
RETURNS (
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMO_CHEQUE (
    CNPJ VARCHAR(14),
    CONTA INTEGER)
RETURNS (
    CHEQUE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE ULTIMO_TURNO (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_CLIENTE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    UF CHAR(2),
    COD_VEND INTEGER,
    COD_FPAGTO INTEGER,
    REQUISICAO CHAR(1),
    DIA_PREF_FAT INTEGER,
    LIMITE_TEMPO INTEGER,
    LIMITE_CREDITO NUMERIC(18,4),
    CLASSIF CHAR(1),
    BLOQUEADO CHAR(1),
    CPF_CNPJ VARCHAR(15),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBS2 BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ASSINA_NOTA CHAR(1),
    CONTROLA_PLACA CHAR(1),
    CONTROLA_KM CHAR(1),
    NAO_COBR_JUR_ATE FLOAT,
    TAXA_JUROS FLOAT,
    CLASSIFICACAO INTEGER,
    VALOR_MAXIMO_RETIRADA FLOAT,
    LIMITE_DIARIO_RETIRADA FLOAT,
    ALIQUOTA_DESCONTO FLOAT,
    CONS_REV CHAR(1),
    SENHA_PDV VARCHAR(6))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_CONVENIO (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    CODIGO INTEGER)
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_CPF_CNPJ (
    CNPJ VARCHAR(14),
    CAMPO VARCHAR(14))
RETURNS (
    VALIDO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_FORNECEDOR (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CONTABILIDADE INTEGER,
    UF CHAR(2))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_PESSOA_FJ (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    NOME VARCHAR(50),
    UF CHAR(2),
    CPF_CNPJ VARCHAR(15),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBS2 BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CLASSIFICACAO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    VENDEDOR INTEGER)
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    VALIDA_MULT_QTDE_MIN CHAR(1),
    PRC_VENDA NUMERIC(18,4),
    VENCTO_PRC_VENDA DATE,
    PRC_CUSTO_MED NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO CHAR(1),
    ALIQUOTA_ECF CHAR(5),
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    NEG_QTDADE_2 CHAR(1),
    SUBUNIDADE INTEGER,
    COMPLEMENTO_NF CHAR(1),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    IPI NUMERIC(18,4),
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1),
    MARCA VARCHAR(50),
    MARGEM_BRUTA NUMERIC(18,4),
    QTDADE_CONVERSAO NUMERIC(18,4),
    SERVICO CHAR(1),
    SECUNDARIO VARCHAR(15),
    COMPLEMENTO VARCHAR(100),
    PERC_FRETE NUMERIC(18,4),
    QNTDE_MINIMA_VENDA NUMERIC(18,4),
    UND_PRIMARIA CHAR(4),
    FATOR_CONVERSAO FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALIDA_PRODUTO_SECUNDARIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO CHAR(1),
    ALIQUOTA_ECF CHAR(5),
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    NEG_QTDADE_2 CHAR(1),
    SUBUNIDADE INTEGER,
    COMPLEMENTO_NF CHAR(1),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    IPI INTEGER,
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1),
    MARCA VARCHAR(50),
    MARGEM_BRUTA NUMERIC(18,4),
    QTDADE_CONVERSAO NUMERIC(18,4),
    SERVICO CHAR(1),
    SECUNDARIO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VALOR_SERVICO_MOTOR (
    CNPJ CHAR(14),
    MOTOR INTEGER,
    SERVICO INTEGER)
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDA_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS_CAIXA (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS_GERAL (
    CNPJ CHAR(14),
    DT_CAIXA DATE)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_MENSAIS (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VENDAS_PERIODO_PRODUTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ANALISE_CUSTOS (
    CNPJ CHAR(14),
    VENDA INTEGER,
    NOVO NUMERIC(18,4))
RETURNS (
    CODIGO INTEGER,
    PESSOA INTEGER,
    TOTAL NUMERIC(18,4),
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_2 NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    NOME VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    MARGEM NUMERIC(18,4),
    MARGEM_2 NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_NOTAS_FATURAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_NOTAS_FATURAS_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_BAIXA (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_GERAL (
    CNPJ CHAR(14),
    DATA DATE,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_HISTORICO (
    CNPJ CHAR(14),
    CODIGO_PAGAR INTEGER,
    ANO_PAGAR INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    VLR_PARCIAL NUMERIC(18,4),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_PAGAR_PESSOA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4),
    NUM_NF INTEGER,
    NUM_CF INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_BAIXA (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_CAIXA_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_BAIXA TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    NOMECONVENIADO VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    COBRADOR INTEGER,
    LOCAL INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_FATURA (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    FATURA INTEGER,
    VLR_PARCIAL NUMERIC(18,4),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_PESSOA (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BAIXA_RECEBER_VENDEDOR (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BALANCETE_ANALITICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(60),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BALANCETE_SINTETICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50),
    ANTERIOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BALANCETE_SINTETICO_DIARIO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    GRUPO INTEGER)
RETURNS (
    CODIGOPLANO VARCHAR(15),
    TIPO CHAR(1),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BALANCETE_SINTETICO_GRUPO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15),
    GRUPO INTEGER)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50),
    ANTERIOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_BALANCETE_SINTETICO1 (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    TIPO CHAR(1),
    CODIGO_CONTABIL VARCHAR(15),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CARTAO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    DATA DATE,
    CONTA INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO DATE,
    ADMINISTRADORA INTEGER,
    NOME_ADM VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CARTAO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO DATE,
    ADMINISTRADORA INTEGER,
    NOME_ADM VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CLIENTE (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    EMAIL VARCHAR(80),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER,
    ENDERECO VARCHAR(65),
    PESSOA CHAR(1),
    RG_IE VARCHAR(15),
    REGIAO INTEGER,
    NOME_REGIAO VARCHAR(50),
    ATIVIDADE INTEGER,
    NOME_ATIVIDADE VARCHAR(50),
    BAIRRO INTEGER,
    NOME_BAIRRO VARCHAR(50),
    CIDADE INTEGER,
    NOME_CIDADE VARCHAR(50),
    DT_NASCIMENTO TIMESTAMP,
    CELULAR VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CLIENTE_DADOS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    CONJUGE VARCHAR(50),
    PAI VARCHAR(50),
    MAE VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CLIENTES_CHEQUE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CODIGO_ROTA (
    CNPJ VARCHAR(14),
    CIDADE INTEGER)
RETURNS (
    ROTA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CONTAS_PESSOAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    BANCO CHAR(3),
    NOME_BANCO VARCHAR(50),
    AGENCIA VARCHAR(15),
    CONTA VARCHAR(15),
    DV_AGENCIA CHAR(1),
    DV_CONTA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CONVENIO (
    CNPJ VARCHAR(14),
    CONVENIO INTEGER)
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CONVENIOS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_COTAS_POR_VENDEDOR (
    CNPJ CHAR(14))
RETURNS (
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    VALOR NUMERIC(18,4),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_COTAS_VENDEDORES (
    CNPJ CHAR(14),
    VENDEDOR INTEGER)
RETURNS (
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    VALOR NUMERIC(18,4),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CPF_CNPJ (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CPF_CNPJ VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CRG_CARGAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    MOTORISTA INTEGER,
    NOME_MOTORISTA VARCHAR(50),
    VEICULO CHAR(8),
    ROTA INTEGER,
    NOME_ROTA VARCHAR(50),
    KM_SAIDA NUMERIC(18,4),
    KM_CHEGADA NUMERIC(18,4),
    DATA_SAIDA DATE,
    DATA_CHEGADA DATE,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CTB_CHEQUE (
    CNPJ CHAR(14),
    CONTA INTEGER)
RETURNS (
    CHEQUE INTEGER,
    DATA TIMESTAMP,
    BANCO VARCHAR(50),
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER,
    ORIGEM CHAR(1),
    PLANILHA INTEGER,
    CONTABILIDADE CHAR(1),
    NOME VARCHAR(50),
    NOMINAL CHAR(1),
    PRE_DATE DATE,
    COD_ACERTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_CTB_CONFIGURA_REL_CONTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    CONTA INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_DADOS_BAIXA_VENDA (
    CNPJ CHAR(14),
    VENDA INTEGER)
RETURNS (
    DATA_BAIXA DATE,
    BANCO VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_DADOS_FATURA (
    CNPJ CHAR(14),
    PESSOA INTEGER,
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_DIA NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    DUPLICATA VARCHAR(30),
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14),
    BAIXAS_PARCIAIS NUMERIC(18,4),
    BAIXAS_PARCIAIS_DIA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENT_ITENS_AGRUPADO (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER,
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE FLOAT,
    PRC_CUSTO FLOAT,
    PRC_CUSTO_DIG FLOAT,
    NOME_PRODUTO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENT_ITENS_CONF (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_VENDA FLOAT,
    IPI FLOAT,
    DESCONTOS FLOAT,
    FRETE FLOAT,
    NOME_PRODUTO VARCHAR(50),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENTRADAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    NDOCTO VARCHAR(20),
    PRODUTO VARCHAR(15),
    UNIDADE CHAR(4),
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PERC_LUCRO NUMERIC(12,2),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    IPI_PRODUTO NUMERIC(18,4),
    TAXAS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    EMBALAGEM NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    DATA_NF TIMESTAMP,
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    NATUREZA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENTRADAS_CONFERENTE (
    CNPJ CHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    NDOCTO VARCHAR(20),
    NDOCTOINT INTEGER,
    PESSOA_FJ INTEGER,
    DATA_NF TIMESTAMP,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    TAXAS FLOAT,
    VLR_EMBALAGEM FLOAT,
    VLR_FRETE FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_PRODUTOS FLOAT,
    VLR_SEGURO FLOAT,
    VLR_BC_ICM FLOAT,
    PERC_ICM FLOAT,
    VLR_ICM FLOAT,
    VLR_IPI FLOAT,
    VLR_ICM_SUBS FLOAT,
    PROC_QTD CHAR(1),
    PROC_FIN CHAR(1),
    PROC_CUSTO CHAR(1),
    FRETE_LF CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENTRADAS_MANUAL
RETURNS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    GRUPO INTEGER,
    FORNECEDOR INTEGER,
    NDOCTO VARCHAR(20),
    NOME_GRUPO VARCHAR(50),
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    VLR_CAIXA NUMERIC(18,4),
    VLR_EMBALAGEM NUMERIC(18,4),
    VLR_COMPRA NUMERIC(18,4),
    VLR_IPI NUMERIC(18,4),
    VLR_FRETE_PROPRIO NUMERIC(18,4),
    VLR_FRETE_TERCEIRO NUMERIC(18,4),
    VLR_TRIBUTACAO_CREDITO NUMERIC(18,4),
    VLR_OUTRAS_DESPESAS NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    VLR_VENDA NUMERIC(18,4),
    VLR_LUCRO NUMERIC(18,4),
    VLR_CUSTO_TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    VLR_RENTABILIDADE NUMERIC(18,4),
    VLR_ICM_VENDA NUMERIC(18,4),
    MARGEM_LUCRO NUMERIC(18,4),
    TOT_FRETE_TERCEIRO NUMERIC(18,4),
    TOT_ICM_CREDITO NUMERIC(18,4),
    TOT_ICM_DEBITO NUMERIC(18,4),
    TOT_RENTABILIDADE NUMERIC(18,4),
    TOT_IPI NUMERIC(18,4),
    TOT_DESP_OPERACIONAL NUMERIC(18,4),
    TOT_DESP_FEDERAL NUMERIC(18,4),
    TOT_FRETE_PROPRIO NUMERIC(18,4),
    HORA TIME,
    VLR_VENDA_ANTERIOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENTRADAS_SINTEGRA (
    CNPJ CHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    NDOCTO VARCHAR(20),
    NDOCTOINT INTEGER,
    PESSOA_FJ INTEGER,
    DATA_NF TIMESTAMP,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    TAXAS FLOAT,
    CNPJ_CPF VARCHAR(20),
    IE_RG VARCHAR(20),
    UF CHAR(2),
    VLR_EMBALAGEM FLOAT,
    VLR_FRETE FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_PRODUTOS FLOAT,
    VLR_SEGURO FLOAT,
    VLR_BC_ICM FLOAT,
    PERC_ICM FLOAT,
    VLR_ICM FLOAT,
    VLR_IPI FLOAT,
    VLR_ICM_SUBS FLOAT,
    PROC_QTD CHAR(1),
    PROC_FIN CHAR(1),
    PROC_CUSTO CHAR(1),
    FRETE_LF CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ENTRADAS_SINTEGRA_ITENS (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    UNIDADE CHAR(4),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PERC_LUCRO NUMERIC(12,2),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    IPI_PRODUTO NUMERIC(18,4),
    TAXAS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    EMBALAGEM NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    DATA_NF TIMESTAMP,
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    NATUREZA INTEGER,
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_ESTIQUETA_PRODUTO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    GRUPO VARCHAR(50),
    MARCA VARCHAR(50),
    COR VARCHAR(50),
    SUBGRUPO VARCHAR(50),
    EMPRESA VARCHAR(50),
    VALOR NUMERIC(18,4),
    QUANTIDADE INTEGER,
    SEQUENCIA INTEGER,
    NUMERO VARCHAR(6),
    GRADE CHAR(4),
    CONT_NUMEROS INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_FECHAMENTO_MES (
    CNPJ CHAR(14),
    MES INTEGER,
    ANO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    DATA TIMESTAMP,
    SALDO_INICIAL NUMERIC(18,4),
    ENTRADAS NUMERIC(18,4),
    SAIDAS NUMERIC(18,4),
    GRUPO INTEGER,
    CUSTO NUMERIC(18,4),
    SUB_GRUPO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_GRADES (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_GRADES_ADICIONAL (
    CNPJ CHAR(14),
    GRADE INTEGER)
RETURNS (
    CODIGO VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_GRADES_NUMEROS (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER,
    GRADE VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_POSICAO_DIARIA (
    CNPJ CHAR(14),
    DINICIAL DATE,
    DFINAL DATE)
RETURNS (
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    LEITURA NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VENDA NUMERIC(18,4),
    CONTAGEM NUMERIC(18,4),
    POSICAO NUMERIC(18,4),
    INICIAL NUMERIC(18,4),
    CUSTO NUMERIC(18,4),
    TROCAS_SAI NUMERIC(18,4),
    TROCAS_ENT NUMERIC(18,4),
    GARANTIAS_SAI NUMERIC(18,4),
    GARANTIAS_ENT NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_POSICAO_DIARIA_GRUPO (
    CNPJ CHAR(14),
    DINICIAL DATE,
    DFINAL DATE,
    GRUPO INTEGER)
RETURNS (
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    LEITURA NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VENDA NUMERIC(18,4),
    CONTAGEM NUMERIC(18,4),
    POSICAO NUMERIC(18,4),
    INICIAL NUMERIC(18,4),
    GARANTIAS_SAI NUMERIC(18,4),
    GARANTIAS_ENT NUMERIC(18,4),
    TROCAS_SAI NUMERIC(18,4),
    TROCAS_ENT NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_POSICAO_ESTOQUE_GRADE (
    CNPJ CHAR(14))
RETURNS (
    ESTOQUE NUMERIC(15,4),
    CODIGO VARCHAR(15),
    NUMERO VARCHAR(6),
    ORDEM INTEGER,
    GRADE CHAR(4),
    CODIGO_2 VARCHAR(15),
    ATIVO CHAR(1),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    PRODUTO VARCHAR(50),
    MARCA VARCHAR(50),
    PERFIL VARCHAR(50),
    COR VARCHAR(50),
    CODPERFIL INTEGER,
    CODMARCA INTEGER,
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_PRODUTOS (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    ATUALIZAR CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_PRODUTOS_GRADES (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    PRC_CUSTO_CODIF VARCHAR(15),
    GRADE CHAR(4),
    MATERIAL INTEGER,
    COR INTEGER,
    ULTIMA_COMPRA TIMESTAMP,
    QTDADE_COMPRA NUMERIC(18,4),
    ULTIMA_VENDA TIMESTAMP,
    QTDADE_VENDA NUMERIC(18,4),
    ESTOQUE NUMERIC(18,4),
    PERFIL INTEGER,
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER,
    NOME_PERFIL VARCHAR(50),
    NOME_COR VARCHAR(50),
    NOME_MATERIAL VARCHAR(50),
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_PRODUTOS_GRADES_NUMEROS (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    GRADE CHAR(4))
RETURNS (
    ESTOQUE NUMERIC(18,4),
    NUMERO VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_PRODUTOS_TRIBUT_REVENDA (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CTE INTEGER,
    CTIE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_EST_PROMOCAO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DATA DATE)
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_CAIXA_GERAL_VENDEDOR (
    CNPJ CHAR(14),
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_CAIXAS_MOVIMENTOS (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    DOCUMENTO VARCHAR(20),
    DATA TIMESTAMP,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    NOME VARCHAR(50),
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_CAIXAS_RESUMO_MOVTOS (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_GARANTIAS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_GARANTIAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    VLR_PARC_LC NUMERIC(18,4),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_ORCAMENTOS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    COMPROMETER_ESTOQUE CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_ORCAMENTOS_ITENS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CODIGO INTEGER,
    DESCONTO FLOAT,
    ICM FLOAT,
    ICM_SUBS FLOAT,
    IPI FLOAT,
    PESO FLOAT,
    PORC_DESC FLOAT,
    PRC_CUSTO FLOAT,
    PRC_UNIT_ORIGINAL FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_2 FLOAT,
    PRODUTO VARCHAR(15),
    MARCA VARCHAR(30),
    MARCA_2 VARCHAR(30),
    QUANTIDADE FLOAT,
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    VOLUME FLOAT,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_TROCAS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_TROCAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    VLR_PARC_LC NUMERIC(18,4),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS
RETURNS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ABERTAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_AGRUPADAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER,
    CODIGO_PRODUTO VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ANALISE (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ANALISE_CUSTOS (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ANALISE_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ANALISE_PLACA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    CLIENTE INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    DATA_CAIXA TIMESTAMP,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PLACA VARCHAR(8),
    SOMA NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CAIXA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CAIXA_ABERTAS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER,
    ENVIADA_CX CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CAIXA_AGRUPADA (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CAIXA_CANCELADA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER,
    DATA_CANCELAMENTO TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CAIXA_PERIODO (
    CNPJ VARCHAR(14),
    INI TIMESTAMP,
    FIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CIDADE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    CIDADE INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    CODIGO_CIDADE INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_COMISSAO (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_COMISSAO_GERAL (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_COR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER)
RETURNS (
    COR INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CUSTOS_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CX_AGRUP_PERIODO (
    CNPJ VARCHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_CX_AGRUPADA_VEND (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FATURA_FUTURAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FRMPAGTO_CAIXA (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FRMPAGTO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FUTURAS_CAIXA (
    CNPJ VARCHAR(14),
    D DATE,
    CONTA INTEGER,
    USR INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    AVISTA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    APRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_FUTURAS_GERAL (
    CNPJ VARCHAR(14),
    D DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    MOV_CAIXA CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    AVISTA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    APRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_GARANTIA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    GARANTIA INTEGER)
RETURNS (
    TEXTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    COMPLEMENTO VARCHAR(100))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_GRUPO_SEL (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    NF INTEGER,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    NOME_GRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    COM_VENDA_VLR NUMERIC(18,4),
    COM_VENDA_PCT NUMERIC(18,4),
    TOTAL_PRODUTO NUMERIC(18,4),
    TOTAL_DESCONTO NUMERIC(18,4),
    PARTICIP_LUCRO NUMERIC(18,4),
    COM_VISTA_VENDEDOR NUMERIC(18,4),
    COM_PRAZO_VENDEDOR NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    COMPUTA_VENDA CHAR(1),
    PAGA_COMISSAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_GRUPO_SINTETICO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_HISTORICO (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_CAIXA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    CPF_CGC VARCHAR(20),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_INDICADOS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PORCENTAGEM NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    ALIQUOTA_EST NUMERIC(18,4),
    ALIQUOTA_INT NUMERIC(18,4),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ITENS_ALIQUOTA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA CHAR(3),
    NATUREZA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ITENS_COMISSAO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    VENDEDOR INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ITENS_FISCAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    ALIQUOTA_EST NUMERIC(18,4),
    ALIQUOTA_INT NUMERIC(18,4),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_ITENS_SINTEGRA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    TOTAL NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA NUMERIC(18,4),
    CFOP INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_MAIORES_CLIENTES (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_MARCA_SEL (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    NF INTEGER,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_MARCA_SINT_ADM (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_MARCA_SINTETICO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_NATUREZA (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    COD_NATUREZA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_PARCELAMENTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENCTO TIMESTAMP,
    PARCELA VARCHAR(6),
    VALOR NUMERIC(18,4),
    BOLETO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_POR_GRUPO (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_POR_MARCA (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_POR_MARCA_ADM (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    UNIDADE CHAR(4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_POR_PRODUTO (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    CODIGO_PRODUTO VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_PRODUTOS (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_PRODUTOS_CARGA (
    CNPJ CHAR(14),
    CARGA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_PRODUTOS_FICHA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_SINTEGRA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    CNPJ_CPF VARCHAR(20),
    IE_RG VARCHAR(20),
    SERIE CHAR(3),
    UF CHAR(2),
    PERC_ICMS NUMERIC(18,4),
    MODELO CHAR(3),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    E_S CHAR(1),
    DESPESAS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_SUBGRUPO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    COD_GRUPO INTEGER,
    COD_SUBGRUPO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_VEICULO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    VEICULO INTEGER,
    PLACA CHAR(8),
    KM_ATUAL NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    MODELO VARCHAR(50),
    COMBUSTIVEL VARCHAR(15),
    MEDIA_KM NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_VENDEDOR (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    PAGA_COMISSAO CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    DT_EMISSAO_AGRUPADA TIMESTAMP,
    IRRF NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4),
    ISS NUMERIC(18,4),
    SERIE CHAR(3),
    CONTA_CAIXA INTEGER,
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FAT_VENDAS_VENDEDOR_GERAL (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    PAGA_COMISSAO CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    DT_EMISSAO_AGRUPADA TIMESTAMP,
    IRRF NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4),
    ISS NUMERIC(18,4),
    SERIE CHAR(3),
    CONTA_CAIXA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    DUPLICATA VARCHAR(30),
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_CAIXA (
    CNPJ CHAR(14),
    DATA_CAIXA TIMESTAMP,
    USR INTEGER,
    TURNO INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14),
    ORIGEM CHAR(3),
    CONTA_BANCO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_EMITIDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    BANCO VARCHAR(3),
    BOLETO VARCHAR(30),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    DUPLICATA VARCHAR(30),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_GERAL (
    CNPJ CHAR(14),
    DATA_CAIXA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    ORIGEM CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    LOTE VARCHAR(10),
    CODIGO_LOTE INTEGER,
    VALIDADE_LOTE DATE,
    PRC_CUSTO NUMERIC(18,4),
    CUSTO_MEDIO NUMERIC(18,4),
    LUCRO_ITEM NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_FIS NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_MARCA VARCHAR(50),
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    QTDE_ENTREGUE NUMERIC(18,4),
    QUANTIDADE_FIS NUMERIC(18,4),
    SEQUENCIA INTEGER,
    CFOP INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    COMPLEMENTO VARCHAR(100),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    BCH_CODIGO INTEGER,
    REDUCAO INTEGER,
    SERVICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    GRADE VARCHAR(4),
    NUMERO VARCHAR(6),
    CODIGO_2 VARCHAR(15),
    MENSAGEM_REDUCAO VARCHAR(80),
    VENDEDOR VARCHAR(50),
    ENTREGUE FLOAT,
    CARREGADO FLOAT,
    DEVOLVIDO FLOAT,
    CARGA_CREDITO_UND FLOAT,
    CARGA_CREDITO_REAIS FLOAT)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_ITENS_AGRUPADA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    COMPLEMENTO VARCHAR(100),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    SERVICO BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PERIODO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(20),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    RG_IE VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PERIODO_BAIXADAS (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(20),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    RG_IE VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PERIODO_SINT_ADM (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PERIODO_SINTETICO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PESSOA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_PESSOA_BAIXADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    DUPLICATA VARCHAR(30),
    BOLETO VARCHAR(30),
    BANCO CHAR(3),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FATURA_RECEBER (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    DATA_ULT_BAIXA TIMESTAMP,
    NUM_CUPOM INTEGER,
    COBRADOR INTEGER,
    CONVENIADO INTEGER,
    NOME_CONVENIADO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FICHA_CLIENTE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    VENDAS NUMERIC(18,4),
    RECEBER NUMERIC(18,4),
    FATURAS NUMERIC(18,4),
    CUPOM NUMERIC(18,4),
    NOTAS NUMERIC(18,4),
    TOTAL NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CENTRO_CUSTO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    CODIGO_AGRUPADO INTEGER,
    NOME_AGRUPADO VARCHAR(50),
    AGRUPADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES (
    CNPJ CHAR(14))
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    PROCESSADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_ARQ_MAGNETICO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    PROCESSADO CHAR(1),
    CMC7 VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_CAIXA_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_CAIXA_RECEBER (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_COMISSAO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    VENDEDOR INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_CX_REC_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_PESSOA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE DATE,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_PESSOA_ABERTO (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    RG_IE VARCHAR(20),
    PROCESSADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_CHEQUES_PESSOA_PAGO (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    RG_IE VARCHAR(20),
    PROCESSADO CHAR(1),
    DATA_REAPRES DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_COBRANCAS_PERIODO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    NOME VARCHAR(50),
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_FATURAS_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    VALOR_ATUAL NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_FATURAS_PARCIAL_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    PLANILHA INTEGER,
    FATURA INTEGER,
    NOME VARCHAR(50),
    ORIGEM CHAR(3),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_FATURAS_PARCIAL_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    PLANILHA INTEGER,
    FATURA INTEGER,
    NOME VARCHAR(50),
    ORIGEM CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_FUNCIONARIOS (
    CNPJ CHAR(14))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    DT_ADMISSAO TIMESTAMP,
    CARGO VARCHAR(50),
    CTPS VARCHAR(15),
    SERIE VARCHAR(5),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_MOV_CARTAO_CONCILIACAO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_MOVIMENTO_CARTAO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_MOVTO_CARTAO_REEMBOLSO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_PAGAS_ANALISE (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER,
    TIPO_CENTRO CHAR(3),
    CENTRO_CUSTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FIN_PAGAS_ANALISE_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER,
    TIPO_CENTRO CHAR(3),
    CENTRO_CUSTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FISICA_FINANCEIRA (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    NOME_GRUP0 VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    QTDADE NUMERIC(18,4),
    T_REPOS NUMERIC(18,4),
    T_CUSTO_MED NUMERIC(18,4),
    T_VENDA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_FORNECEDOR (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    UF CHAR(2))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_GARANTIAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    ENVIADA_CX CHAR(1),
    CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    INDICADO INTEGER,
    PORCENTAGEM NUMERIC(18,4),
    NOME VARCHAR(50),
    INICIO TIMESTAMP)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_GLO_VEICULOS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER,
    TIPO_VEICULO INTEGER,
    NOME_TIPO VARCHAR(50),
    MARCA_VEICULO INTEGER,
    MODELO VARCHAR(50),
    NOME_MARCA VARCHAR(50),
    PLACA CHAR(8),
    KM_ATUAL NUMERIC(18,4),
    ATIVO CHAR(1),
    MOTORISTA VARCHAR(50),
    COD_CLIENTE INTEGER,
    NOME_RAZAO VARCHAR(50),
    CPF_CGC VARCHAR(14))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA TIMESTAMP,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_MOVIMENTO_CONTABIL_CREDITO (
    EMPRESA VARCHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(15),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_MOVIMENTO_CONTABIL_DEBITO (
    EMPRESA VARCHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(15),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_NFCF_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERIE CHAR(3))
RETURNS (
    NF INTEGER,
    CF INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_OFC_CTRL_QUALIDADE (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    VIRABREQUIM VARCHAR(15),
    MEDIDA_MANCAL VARCHAR(15),
    MEDIDA_BIELA VARCHAR(15),
    FOLGA_AXIAL_VIRABREQUIM VARCHAR(15),
    CABECOTE VARCHAR(15),
    ALTURA_CABECOTE VARCHAR(15),
    ALTURA_VALV_ADMISSAO VARCHAR(15),
    ALTURA_VALV_ESCAPE VARCHAR(15),
    BLOCO VARCHAR(15),
    FOLGA_CILINDRO VARCHAR(15),
    FOLGA_RADIAL_BLOCO VARCHAR(15),
    BIELA VARCHAR(15),
    FOLGA_RADIAL_BIELA VARCHAR(15),
    FOLGA_PINO VARCHAR(15),
    FOLGA_AXIAL_BIELA VARCHAR(15),
    AJUSTADO VARCHAR(15),
    TORQUE_MANCAL VARCHAR(15),
    TORQUE_BIELA VARCHAR(15),
    ALTURA_PISTAO VARCHAR(15),
    MONTADOR INTEGER,
    NOME_MONTADOR VARCHAR(50),
    PESSOA_FJ INTEGER,
    NOME_CLIENTE VARCHAR(50),
    DATA TIMESTAMP,
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_OFC_ORD_SERV_MOVTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    VALOR NUMERIC(18,4),
    DATA TIMESTAMP,
    HISTORICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO CHAR(1),
    TIPO_DESPESA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ORDEM_SERVICO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_FECHAMENTO TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    COD_STATUS INTEGER,
    COR_STATUS INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ORDEM_SERVICO_ORC (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MOTOR INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    ENVIADA_CAIXA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ORDEM_SERVICO_PERIODO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_FECHAMENTO TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER,
    DT_ULTIMA_BAIXA DATE,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PAGAR_3MESES (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_ULTIMA_BAIXA DATE,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PAGAR_PREVISAO (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PAGAR_VENCIMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER,
    DT_ULTIMA_BAIXA DATE,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PENDENCIAS (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    ORDEM INTEGER,
    FONE_CLIENTE VARCHAR(20),
    FONE_TRABALHO VARCHAR(20))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_CODIGO (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_CONTA (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    AGENCIA VARCHAR(15),
    CONTA VARCHAR(15))
RETURNS (
    PESSOA_FJ INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_CPFCGC (
    CNPJ VARCHAR(14),
    CPFCGC VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_CPFCGC_CHEQUE (
    CNPJ VARCHAR(14),
    CPFCGC VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_FJ (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER,
    ENDERECO VARCHAR(65),
    EMAIL VARCHAR(80))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOA_NOME (
    CNPJ VARCHAR(14),
    NOME VARCHAR(40))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOAS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3),
    CPF VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOAS_CHEQUE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PESSOAS_CONVENIO (
    CNPJ VARCHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3),
    ASSINA_NOTA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PRODUTO_GRUPO (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_GRUPO VARCHAR(50),
    CODIGO_G INTEGER,
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_INDEXADO NUMERIC(18,4),
    MARGEM_BRUTA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PRODUTO_GRUPO_VENDA (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1),
    MINI DATE,
    MFIM DATE)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_GRUPO VARCHAR(50),
    CODIGO_G INTEGER,
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_INDEXADO NUMERIC(18,4),
    MARGEM_BRUTA NUMERIC(18,4),
    VENDA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PRODUTO_MARCA (
    CNPJ VARCHAR(14),
    MARCA_INI VARCHAR(50),
    MARCA_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    COD_GRUPO INTEGER,
    COD_SUB_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    SUB_GRUPO VARCHAR(50),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_MARCA VARCHAR(50),
    CODIGO_M INTEGER,
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    CUSTO_AQUISICAO NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PRODUTOS_APLICACOES (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    APLICACAO VARCHAR(50),
    LOCAL VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PROPRIEDADE (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    PROPRIEDADE INTEGER)
RETURNS (
    NOME VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    CPF VARCHAR(20),
    TECNICO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PROPRIEDADE_IE (
    CNPJ VARCHAR(14),
    IE_SERIE VARCHAR(15))
RETURNS (
    NOME VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    PESSOA_FJ INTEGER,
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_PROPRIEDADES (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    NOME VARCHAR(50),
    PROPRIEDADE INTEGER,
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    CPF VARCHAR(20),
    TECNICO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RAZAO (
    CNPJ CHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CONTA INTEGER,
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RAZAO_DESPESAS (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RAZAO_DESPESAS_ACUMULADAS (
    EMPRESA VARCHAR(14),
    CODIINI VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4),
    INDICE NUMERIC(18,4),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RAZAO_DESPESAS_SINTETICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RAZAO_RECEITAS (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(10),
    SALDO_DESCTO NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_3MESES (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_CLASSE (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    CLASSE INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(80),
    NOMECONVENIADO VARCHAR(80),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_CONVENIO_PERIODO (
    CNPJ CHAR(14),
    CONVENIO INTEGER,
    INICIAL TIMESTAMP,
    FINAL TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    NOMECONVENIADO VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_FATURA (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_LANCAMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_PESSOA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ARQ_MORTO CHAR(1),
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_PESSOA_NFATURADO (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_PREVISAO (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_REGIAO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    REGIAO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_VENCIMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_VENCIMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_RECEBER_VENDEDOR (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    VENDEDOR INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_REDUCOES (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PERC_ESTADUAL NUMERIC(18,4),
    PERC_INTERESTADUAL NUMERIC(18,4),
    PERC_CONTRIBUINTE NUMERIC(18,4),
    MENSAGEM_NF VARCHAR(80),
    MENSAGEM_NF_IE VARCHAR(80))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_SIS_BOLETOBANCARIO (
    CNPJ VARCHAR(14),
    LOCAL INTEGER)
RETURNS (
    BANCO CHAR(3),
    VENCIMENTO_DST INTEGER,
    VENCIMENTO_ALT INTEGER,
    DATA_DST INTEGER,
    DATA_ALT INTEGER,
    DOCUMENTO_DST INTEGER,
    DOCUMENTO_ALT INTEGER,
    ESPECIE_DST INTEGER,
    ESPECIE_ALT INTEGER,
    ACEITE_DST INTEGER,
    ACEITE_ALT INTEGER,
    DTPROCESSAMENTO_DST INTEGER,
    DTPROCESSAMENTO_ALT INTEGER,
    VALOR_DST INTEGER,
    VALOR_ALT INTEGER,
    INSTRUCOES_DST INTEGER,
    INSTRUCOES_ALT INTEGER,
    SACADO_DST INTEGER,
    SACADO_ALT INTEGER,
    CIDADE_DST INTEGER,
    CIDADE_ALT INTEGER,
    PORTA_IMPRESSORA VARCHAR(50),
    TAMANHOPAGINA INTEGER,
    LPP INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_TROCA_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    TIPO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_TROCAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    ENVIADA_CX CHAR(1),
    CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ULTIMAS_ORDENS_SERVICO (
    CNPJ CHAR(14),
    CODIGO_CLIENTE INTEGER,
    PROPRIEDADE INTEGER,
    COD_ATUAL INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    SOLICITANTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    CONTADOR_TOTAL NUMERIC(18,4),
    CONTADOR_COR NUMERIC(18,4),
    CONTADOR_PRETO NUMERIC(18,4),
    CONTADOR_CILINDRO NUMERIC(18,4),
    CONTADOR_REVELADOR NUMERIC(18,4),
    CONTADOR_IMPRESSAO NUMERIC(18,4),
    DEFEITO_RECLAMADO VARCHAR(50),
    TIPO_ATENDIMENTO VARCHAR(50),
    CONDICAO_FINAL_EQUIPAMENTO VARCHAR(50),
    CAUSA_CHAMADO VARCHAR(200))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_ULTIMAS_VENDAS (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CONVENIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VARIACOES_VENDA (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    DATA DATE,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VARIACAO NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VEICULOS (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    TIPO_VEICULO INTEGER,
    NOME_TIPO VARCHAR(50),
    MARCA_VEICULO INTEGER,
    NOME_MARCA VARCHAR(50),
    MODELO VARCHAR(15),
    NOME VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDA_CF (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENDA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_NF_XML VARCHAR(8),
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CARGA INTEGER,
    CANCELADA CHAR(1),
    SERIE CHAR(3),
    SELECIONADA CHAR(1),
    STATUS_CARREGAMENTO INTEGER,
    ORDEM_CARGA INTEGER,
    PSA_ATIVIDADE INTEGER,
    PSA_BAIRRO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_CEP VARCHAR(8),
    PSA_CIDADE INTEGER,
    PSA_COMPLEMENTO VARCHAR(30),
    PSA_CONTATO VARCHAR(30),
    PSA_CONVENIO INTEGER,
    PSA_CPF_CGC VARCHAR(15),
    PSA_DT_CADASTRO TIMESTAMP,
    PSA_DT_NASCIMENTO TIMESTAMP,
    PSA_EMISSOR VARCHAR(6),
    PSA_ENDERECO INTEGER,
    PSA_FANTASIA VARCHAR(50),
    PSA_FAX VARCHAR(20),
    PSA_FONE VARCHAR(20),
    PSA_INSC_MUNIC VARCHAR(15),
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_NUMERO VARCHAR(15),
    PSA_PESSOA CHAR(1),
    PSA_RG_IE VARCHAR(15),
    PSA_UF CHAR(2),
    LGD_NOME VARCHAR(50),
    BAI_NOME VARCHAR(50),
    CID_NOME VARCHAR(50),
    ID_AGRUPADOR INTEGER,
    ENTREGA_FUTURA CHAR(1),
    ATI_NOME VARCHAR(50),
    REG_NOME VARCHAR(50),
    PSA_EMAIL VARCHAR(80),
    PCT_COMISSAO NUMERIC(18,4),
    HORA TIME,
    NFE_CHAVE VARCHAR(80),
    NFE_SELECIONADO CHAR(1),
    NFE_VALIDADA CHAR(1),
    NFE_ASSINADA CHAR(1),
    NFE_TRANSMITIDA CHAR(1),
    NFE_AUTORIZADA CHAR(1),
    NFE_DANFE_IMPRESSO CHAR(1),
    N_SEQ_ECF CHAR(3),
    N_SERIE_ECF CHAR(20),
    NFE_PROTOCOLO CHAR(200),
    NFE_RECIBO CHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CONT_CARTAO INTEGER,
    CONT_CHEQUE INTEGER,
    VD_CHEQUE FLOAT,
    VD_CARTAO FLOAT,
    VD_DINHEIRO FLOAT,
    VD_ENTRADA FLOAT,
    DIVERG_CARTAO FLOAT,
    DIVERG_CHEQUE FLOAT,
    DT_EMISSAO_NF DATE,
    NFE_IMPRESSAO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    VD_CODIGO INTEGER,
    VD_DATA TIMESTAMP,
    VD_FECHADA CHAR(1),
    VD_HISTORICO VARCHAR(100),
    VD_PESSOA_FJ INTEGER,
    VD_PESSOA_RAZAO VARCHAR(50),
    VD_USUARIO INTEGER,
    VD_NATUREZA INTEGER,
    VD_NOME_NATUREZA VARCHAR(50),
    VD_ENVIADA_CX CHAR(1),
    VD_FORMA_PGTO INTEGER,
    VD_NUM_NF INTEGER,
    VD_NUM_CUPOM INTEGER,
    VD_PROPRIEDADE INTEGER,
    VD_CONVENIADO INTEGER,
    VD_TIPO_DOCTO CHAR(3),
    VD_LOCAL_COBRANCA INTEGER,
    VD_DESC_ACRES NUMERIC(18,4),
    VD_ENTRADA NUMERIC(18,4),
    VD_DINHEIRO NUMERIC(18,4),
    VD_CHEQUE NUMERIC(18,4),
    VD_CARTAO NUMERIC(18,4),
    VD_TICKET NUMERIC(18,4),
    VD_TOTAL NUMERIC(18,4),
    VD_VLRLIQUIDO NUMERIC(18,4),
    VD_OBSERVACAO VARCHAR(200),
    VD_VLR_PARC_LC NUMERIC(18,4),
    VD_TERCEIRO INTEGER,
    VD_CARGA INTEGER,
    VD_VOLUME NUMERIC(18,4),
    VD_PESO NUMERIC(18,4),
    VD_REQUISICAO VARCHAR(6),
    VD_DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    VD_TIPO_VENDA CHAR(3),
    VD_NOME_CONSUMIDOR VARCHAR(50),
    VD_ORCAMENTO INTEGER,
    VD_VENDEDO INTEGER,
    VD_NOME_VENDEDOR VARCHAR(50),
    VD_FAT_VINCULADO INTEGER,
    DEV_CODIGO INTEGER,
    DEV_DATA TIMESTAMP,
    DEV_FECHADA CHAR(1),
    DEV_HISTORICO VARCHAR(100),
    DEV_PESSOA_FJ INTEGER,
    DEV_PESSOA_RAZAO VARCHAR(50),
    DEV_USUARIO INTEGER,
    DEV_NATUREZA INTEGER,
    DEV_NOME_NATUREZA VARCHAR(50),
    DEV_ENVIADA_CX CHAR(1),
    DEV_FORMA_PGTO INTEGER,
    DEV_NUM_NF INTEGER,
    DEV_NUM_CUPOM INTEGER,
    DEV_PROPRIEDADE INTEGER,
    DEV_CONVENIADO INTEGER,
    DEV_TIPO_DOCTO CHAR(3),
    DEV_LOCAL_COBRANCA INTEGER,
    DEV_DESC_ACRES NUMERIC(18,4),
    DEV_ENTRADA NUMERIC(18,4),
    DEV_DINHEIRO NUMERIC(18,4),
    DEV_CHEQUE NUMERIC(18,4),
    DEV_CARTAO NUMERIC(18,4),
    DEV_TICKET NUMERIC(18,4),
    DEV_TOTAL NUMERIC(18,4),
    DEV_VLRLIQUIDO NUMERIC(18,4),
    DEV_OBSERVACAO VARCHAR(200),
    DEV_VLR_PARC_LC NUMERIC(18,4),
    DEV_TERCEIRO INTEGER,
    DEV_CARGA INTEGER,
    DEV_VOLUME NUMERIC(18,4),
    DEV_PESO NUMERIC(18,4),
    DEV_REQUISICAO VARCHAR(6),
    DEV_DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    DEV_TIPO_VENDA CHAR(3),
    DEV_NOME_CONSUMIDOR VARCHAR(50),
    DEV_ORCAMENTO INTEGER,
    DEV_VENDEDO INTEGER,
    DEV_NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDAS_MESAS_ABERTAS (
    CNPJ CHAR(14),
    MESA INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDAS_TOTAIS (
    CNPJ CHAR(14))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CANCELADA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VER_VENDAS_VENDEDOR_ABERTAS (
    CNPJ CHAR(14),
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_APLICACAO (
    CNPJ VARCHAR(14),
    NOME VARCHAR(50))
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    ESTADO VARCHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_CAIXA_ABERTO (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    QUANTIDADE INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_CAIXA_RESUMO (
    CNPJ CHAR(14))
RETURNS (
    DATA DATE)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_CPF (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_DESCTOITEM (
    CNPJ VARCHAR(18),
    PRODUTO VARCHAR(15),
    CLIENTE INTEGER,
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER)
RETURNS (
    VALIDO CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_DIREITO (
    EXECUTAVEL VARCHAR(30),
    OBJETO VARCHAR(30),
    PERFIL INTEGER)
RETURNS (
    DIREITO VARCHAR(300))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_EST_FISCAL_AGRUPADA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_ESTADO_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    FECHADA CHAR(1),
    NF INTEGER,
    CF INTEGER,
    DATA_CAIXA TIMESTAMP,
    ENVIADA_CX CHAR(1),
    USUARIO INTEGER,
    CONTA_CAIXA INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_ESTOQUE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    TIPO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_FATURAMENTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_FIN_CHEQUES (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_IE_RG (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_IE_RG_AGRUPADA (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_LIMITE_RECEBER (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE,
    LIMITE_TEMPO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_MODULO (
    EXECUTAVEL VARCHAR(30),
    OBJETO VARCHAR(30),
    DESCRICAO VARCHAR(45),
    ACTIONS VARCHAR(500))
RETURNS (
    OK INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_PRECO_ESPECIAL (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    PORCENTAGEM NUMERIC(15,4))
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    TAG INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERIFICA_SIMILARES (
    PRODUTO_A VARCHAR(13),
    PRODUTO_B VARCHAR(13))
RETURNS (
    RETORNO INTEGER)
AS
BEGIN
  EXIT;
END^


CREATE PROCEDURE VERLANCAMENTO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE,
    D1 DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_CONCILIACAO DATE)
AS
BEGIN
  EXIT;
END^



SET TERM ; ^


/******************************************************************************/
/****                                Tables                                ****/
/******************************************************************************/



CREATE TABLE ACT_ACERTOCONTA (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    DATA           DDATA2,
    DATA_CX        DDATA2,
    HISTORICO      DHISTORICO,
    USUARIO        DCODIGO,
    TIPO_ACERTO    DCODIGO,
    VALOR_PAGAR    DVALOR,
    VALOR_RECEBER  DVALOR,
    PESSOA_RECIBO  DCODIGO
);

CREATE TABLE ACT_CARTEIRAFINANCEIRA (
    CNPJ                           DCNPJ,
    CODIGO                         DCODIGO,
    DESCRICAO                      DNOME,
    PAGAR                          DCHAR,
    PARTICIPAFLUXOCAIXAPROJ        DCHAR,
    LIMITEDELIQUIDACAOCOMPENSACAO  DVALOR,
    FINALVARIACAOVENCIMENTOTITULO  DCHAR,
    OCULTA                         DCHAR
);

CREATE TABLE ACT_CONFIGURACAOTITULO (
    CNPJ                      DCNPJ NOT NULL,
    CODIGO                    DCODIGO NOT NULL,
    DATAINICIOVARIACAO        DDATA2,
    DATAFIMVARIACAO           DDATA2,
    COD_INDEXADOR             DCODIGO,
    QUANTIDADEINDEXADOR       DVALOR,
    JUROSIMPLES               DINTEIRO,
    TAXAMULTA                 DVALOR,
    CARENCIAMULTA             DCODIGO,
    TIPODESCONTO              DCODIGO,
    PERCDESCONTOANTECIPADO    DVALOR,
    PERCDESCONTOPONTUALIDADE  DVALOR,
    COD_JURO_POS_FIXADO       DCODIGO,
    DATAINICIOJUROS           DDATA2,
    CARENCIAJUROS             DINTEIRO,
    TAXARISCO                 DVALOR,
    TAXAJUROS                 DVALOR,
    VIGENCIA                  DINTEIRO
);

CREATE TABLE ACT_EVENTOCONTABIL (
    CNPJ                            DCNPJ NOT NULL,
    CODEVENTOCONTABIL               DCODIGO NOT NULL,
    DESCRICAO                       DNOME,
    CODIGO                          DNOME,
    OBSERVACAO                      DOBS,
    TIPO                            DCHAR,
    MOVIMENTAFLUXODECAIXAREALIZADO  DCHAR,
    CONTABILIZACAOAUXILIAR          DCHAR
);

CREATE TABLE ACT_TITULOGERADO (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    COD_ACERTOCONTA  DCODIGO,
    COD_RECEBER      DCODIGO,
    COD_PAGAR        DCODIGO
);

CREATE TABLE AGR_CATEGORIA_DEFENSIVO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_CLASSE_TOXICOLOGICA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_CLASSIFICACAO_AMBIENTAL (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_CLASSIFICAO_QUIMICA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_CULTURA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DNOME
);

CREATE TABLE AGR_DEFENSIVO_AGRICOLA (
    CNPJ                         DCNPJ NOT NULL,
    CODIGO                       DCODIGO NOT NULL,
    COD_PRODUTO                  DCODIGOPROD,
    NOME_TECNICO                 DVARCHAR80,
    NOME_COMUM                   DVARCHAR80,
    FORMULACAO                   DVARCHAR80,
    INGREDIENTE_ATIVO            DVARCHAR80,
    CONCENTRACAO                 DVALOR,
    FORMULA_BRUTA                DVARCHAR80,
    NUMERO_REGISTRO              DCODIGO,
    COD_CATEGORIA_DEFENSIVO      DCODIGO,
    COD_CLASSE_TOXICOLOGICA      DCODIGO,
    COD_CLASSIFICACAO_AMBIENTAL  DCODIGO,
    COD_CLASSIFICACAO_QUIMICA    DCODIGO,
    COD_FABRICANTE               DCODIGO,
    COD_MAT_EMBALAGEM            DCODIGO,
    COD_ORIENTACAO_TECNICA       DCODIGO,
    COD_ORIENTACAO_COMPLEMENTAR  DCODIGO,
    COD_INFORMACAO_APLICACAO     DCODIGO,
    COD_ORIENTACAO_EQUIPAMENTO   DCODIGO,
    COD_REGISTRANTE              DCODIGO,
    NUMERO_RISCO                 DCODIGO,
    NUMERO_ONU                   DCODIGO,
    CLASSE_RISCO                 DNOME,
    DESCRICAO_CLASSE_RISCO       DNOME,
    GRUPO_EMBALAGEM              DNOME,
    MATERIAL_EMBALAGEM           DCODIGO,
    NOME_APROP_EMBARQUE          DVARCHAR180
);

CREATE TABLE AGR_DEFENSIVOCULTURAPRAGA (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    DOSAGEM              DVALOR,
    VAZAO                DVALOR,
    INTERVALOSEGURANCA   DCODIGO,
    IDMEDIDADOSAGEM      DCODIGO,
    IDMEDIDAVAZAO        DCODIGO,
    IDCULTURA            DCODIGO,
    IDPRAGA              DCODIGO,
    IDDEFENSIVOAGRICOLA  DCODIGO
);

CREATE TABLE AGR_FABRICANTE (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_MAT_EMBALAGEM (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_MEDIDA_DOSAGEM (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    DESCRICAO            DNOME,
    SIGLA                "DVARCHAR(20)",
    IDUNIDADEMEDIDA_DE   DSIGLAUM,
    IDUNIDADEMEDIDA_POR  DSIGLAUM
);

CREATE TABLE AGR_ORIENTACAO_TECNICA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE AGR_PRAGA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DNOME
);

CREATE TABLE AGR_RECEITAS (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    COD_DEFENSIVO    DCODIGO,
    COD_PRAGA        DCODIGO,
    COD_CULTURA      DCODIGO,
    COD_TECNICO      DCODIGO,
    DT_EMISSAO       DDATA2,
    N_RECEITA        DCODIGO,
    IMPRESSA         DCHAR,
    COD_FATURAMENTO  DCODIGO,
    PRODUTO          DCODIGOPROD,
    SEQUENCIA        DCODIGO,
    DATA             DDATA2
);

CREATE TABLE AGR_REGISTRANTE (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DVARCHAR80
);

CREATE TABLE CM_COMISSAO (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    COD_VENDA         DCODIGO,
    COD_VENDEDOR      DCODIGO,
    STATUS            DCHAR,
    DT_GERACAO        DDATA,
    PCT_ANTECIPACAO   DVALOR,
    COD_TROCA         DCODIGO,
    PESSOA_FJ         DCODIGO,
    COD_PERFIL_PAGTO  DCODIGO,
    PCT_LUCRO_ITEM    DVALOR
);

CREATE TABLE CM_COMISSAO_PARC (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    COD_COMISSAO      INTEGER,
    VLR_TOTAL         DVALOR,
    PCT_PAGO          DVALOR,
    PCT_LIBERADO      DVALOR,
    COD_RECEBER       DCODIGO,
    ANO               DCODIGO,
    PARC_CR           DCHAR6,
    VLR_RECEBER       DVALOR,
    STATUS            DCHAR,
    PGT_ATRASO        DCODIGO,
    PGT_FX_PCT_PAGTO  DVALOR,
    PESSOA_FJ         DCODIGO,
    PCT_LUCRO_ITEM    DVALOR,
    COD_PERFIL_PAGTO  DCODIGO
);

CREATE TABLE CM_LOG (
    CODIGO                DCODIGO NOT NULL,
    CNPJ                  DCNPJ NOT NULL,
    COD_TROCA             DCODIGO,
    COD_VENDA             DCODIGO,
    SEQUENCIA             DINTEIRO,
    P_CODIGO              INTEGER,
    P_PERFIL              DNOME,
    P_BASE_CALC           DINTEIRO,
    P_FX_CODIGO           DCODIGO,
    P_FX_VLR_INICIAL      DVALOR,
    P_FX_VLR_FINAL        DVALOR,
    P_FX_D_CODIGO         DCODIGO,
    P_FX_D_PCT_INI        DVALOR,
    P_FX_D_PCT_FIN        DVALOR,
    P_FX_D_PCT_VISTA      DVALOR,
    P_FX_D_PCT_PRAZO      DVALOR,
    P_FX_D_PRD_CODIGO     DCODIGO,
    P_FX_D_PRD_PCT_VISTA  DVALOR,
    P_FX_D_PRD_PCT_PRAZO  DVALOR,
    TTL_FATURAMENTO       DVALOR,
    TTL_DESCTO_ITEM       DVALOR,
    DT_INICIAL            DDATA,
    DT_FINAL              DDATA,
    COM_VISTA             DVALOR,
    COM_PRAZO             DVALOR,
    USUARIO               DCODIGO,
    DT_GERACAO            DDATA,
    HORA                  DTIME,
    COD_PRODUTO           DCODIGOPROD
);

CREATE TABLE CM_PARC_PAGAR (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    COD_PARC_COM  DCODIGO,
    COD_PAGAR     DCODIGO,
    PCT_LIBERADO  DVALOR
);

CREATE TABLE CM_PERFIL (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DNOME,
    BASE_CALC  DINTEIRO
);

CREATE TABLE CM_PERFIL_FAIXA (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       INTEGER NOT NULL,
    COD_PERFIL   INTEGER,
    VLR_INICIAL  DVALOR,
    VLR_FINAL    DVALOR
);

CREATE TABLE CM_PERFIL_FAIXA_DESC (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    COD_PERFIL_FAIXA  DCODIGO,
    PCT_INICIAL       DVALOR,
    PCT_FINAL         DVALOR,
    PCT_VISTA         DVALOR,
    PCT_PRAZO         DVALOR
);

CREATE TABLE CM_PERFIL_FAIXA_PROD (
    CNPJ                DCNPJ NOT NULL,
    CODIGO              DCODIGO NOT NULL,
    COD_PERFIL_FX_DESC  DCODIGO,
    COD_PRODUTO         DCODIGOPROD,
    PCT_PROD_VISTA      DVALOR,
    PCT_PROD_PRAZO      DVALOR
);

CREATE TABLE CM_PERFIL_PAGTO (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    NOME           DNOME,
    PCT_ANT_PRAZO  DVALOR
);

CREATE TABLE CM_PERFIL_PAGTO_FAIXA (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    COD_PERFIL_PAGTO  DCODIGO,
    DIA_INICIAL       DCODIGO,
    DIA_FINAL         DCODIGO,
    PCT_PAGTO         DVALOR
);

CREATE TABLE CM_REL_COM_PGR_REC (
    CODIGO        DCODIGO NOT NULL,
    CNPJ          DCNPJ,
    COD_PAGAR     INTEGER,
    COD_RECEBIDA  INTEGER
);

CREATE TABLE CM2_ACERTO_COMISSAO (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    DT_ACERTO       DDATA2,
    VALOR_PAGAR     DVALOR,
    VALOR_RECEBER   DVALOR,
    SALDO           DVALOR,
    COD_FINANCEIRO  DCODIGO,
    COD_PESSOA      DCODIGO
);

CREATE TABLE CM2_COMISSAO_PARC (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    COD_VENDA       DCODIGO,
    COD_PESSOA      DCODIGO,
    COD_RECEBER     DCODIGO,
    COD_PAGAR       DCODIGO,
    VALOR           DVALOR,
    CM_PCT          DVALOR,
    DT_GERACAO      DDATA2,
    STATUS          DCHAR,
    COD_BX_RECEBER  DCODIGO,
    COD_BX_PAGAR    DCODIGO,
    SELECIONADO     DCHAR
);

CREATE TABLE CM2_PARC_ACERTO (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    COD_COMISSAO  DCODIGO,
    COD_ACERTO    DCODIGO
);

CREATE TABLE CRG_CARGAS (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    MOTORISTA     DCODIGO,
    VEICULO       DPLACA,
    ROTA          DCODIGO,
    KM_SAIDA      DVALOR,
    KM_CHEGADA    DVALOR,
    DATA_SAIDA    DDATA,
    DATA_CHEGADA  DDATA,
    PESO          DVALOR,
    VOLUME        DVALOR
);

CREATE TABLE CRG_FORMAR_CARGA (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    NOME_MOTORISTA  DNOME,
    LOGRADOURO      DENDERECO,
    CIDADE          DNOME,
    BAIRRO          DNOME,
    NUMERO          DNUMERO_END,
    FONE            DFONE,
    STATUS          DCODIGO,
    USUARIO         DCODIGO,
    CNPJ_CPF        DCNPJ,
    IE_RG           DRGIE
);

CREATE TABLE CRG_FORMAR_CARGA_ITENS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    CRG_CARGA  DCODIGO NOT NULL
);

CREATE TABLE CRG_MOTORISTAS (
    CNPJ       DCNPJ NOT NULL,
    PESSOA_FJ  DCODIGO NOT NULL,
    NOME       DNOME,
    N_CNH      DNUMCNH,
    T_CNH      DTIPOCNH
);

CREATE TABLE CRG_ORDEM_CARGA (
    CNPJ            DCNPJ NOT NULL,
    CODIGO_VND      DCODIGO,
    CODIGO          DCODIGO NOT NULL,
    DATA            DDATA,
    STATUS          DCODIGO,
    PESO_BRUTO      DVALOR,
    PESO_LIQUIDO    DVALOR,
    USUARIO         DCODIGO,
    DT_ENTREGA      DDATA,
    HR_ENTREGA      DTIME,
    NOME_RECEBEDOR  DNOME,
    LOGRADOURO      DNOME,
    NUMERO          DNUMERO_END,
    BAIRRO          DNOME,
    COMPLEMENTO     DDESCRICAO,
    CEP             DCEP,
    CIDADE          DNOME,
    UF              DUF,
    OBSERVACAO      DOBS
);

CREATE TABLE CRG_ORDEM_CARGA_ITENS (
    CNPJ           DCNPJ NOT NULL,
    CODIGO_VND     DCODIGO,
    CODIGO         DCODIGO NOT NULL,
    PRODUTO        DCODIGOPROD NOT NULL,
    QUANTIDADE     DVALOR,
    NOME_PRODUTO   DNOME,
    GRADE          DCHAR4,
    NUMERO         DCHAR6,
    SEQUENCIA      DINTEIRO NOT NULL,
    UNIDADE        DSIGLAUM,
    CARREGADO      DVALOR,
    ENTREGUE       DVALOR,
    DEVOLVIDO      DVALOR,
    CODIGO_LOTE    INTEGER,
    LOTE           VARCHAR(10),
    SEQUENCIA_VND  DCODIGO
);

CREATE TABLE CRG_ROTAS (
    CNPJ      DCNPJ NOT NULL,
    CODIGO    DCODIGO NOT NULL,
    NOME      DNOME,
    VENDEDOR  DCODIGO
);

CREATE TABLE CRG_ROTAS_CIDADES (
    CNPJ    DCNPJ NOT NULL,
    ROTA    DCODIGO NOT NULL,
    CIDADE  DCODIGO NOT NULL
);

CREATE TABLE CRG_VEICULOS (
    CNPJ       DCNPJ NOT NULL,
    PLACA      DPLACA NOT NULL,
    DESCRICAO  DNOME,
    KM         DVALOR
);

CREATE TABLE CTB_CHEQUE (
    CNPJ             DCNPJ NOT NULL,
    CHEQUE           DCODIGO NOT NULL,
    CONTA            DCODIGO NOT NULL,
    DATA             DDATA,
    VALOR            DVALOR,
    HISTORICO        DHISTORICO,
    IMPRESSO         DCHAR,
    PESSOA_FJ        DCODIGO,
    ORIGEM           DCHAR DEFAULT 'M',
    PLANILHA         DCODIGO,
    CONTABILIDADE    DCHAR,
    NOME             DNOME,
    PRE_DATE         DDATA,
    NOMINAL          DCHAR DEFAULT 'N',
    COD_ACERTOCONTA  DCODIGO
);

CREATE TABLE CTB_CONFIGURA_RELATORIO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE CTB_CONFIGURA_RELATORIO_CONTAS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    CONTA   DCODIGO NOT NULL
);

CREATE TABLE CTB_CONFIGURACOES (
    CNPJ      DCNPJ NOT NULL,
    ATIVO     DCHAR15,
    PASSIVO   DCHAR15,
    CMV       DCHAR15,
    RECEITAS  DCHAR15,
    DESPESAS  DCHAR15
);

CREATE TABLE CTB_DESDOBRA_MOVIMENTO (
    CNPJ       DCNPJ NOT NULL,
    PLANILHA   DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    HISTORICO  DHISTORICO,
    MES        DCODIGO,
    ANO        DCODIGO,
    VALOR      DVALOR,
    ORIGEM     DCHAR15,
    PESSOA_FJ  DCODIGO
);

CREATE TABLE CTB_DESDOBRA_MOVIMENTO_CONTAS (
    CNPJ      DCNPJ NOT NULL,
    PLANILHA  DCODIGO NOT NULL,
    CONTA     DCODIGO NOT NULL,
    TIPO      DCHAR,
    VALOR     DVALOR,
    NOME      DNOME,
    PROCESSA  DCHAR
);

CREATE TABLE CTB_FLUXO_CAIXA (
    CNPJ           DCNPJ NOT NULL,
    DATA           DDATA NOT NULL,
    SALDO_INICIAL  DVALOR,
    VENDAS_VISTA   DVALOR,
    RECEBER        DVALOR,
    CARTAO         DVALOR,
    CHQ_PRAZO      DVALOR,
    PAGAR          DVALOR,
    SALDO          DVALOR
);

CREATE TABLE CTB_MOVIMENTO_CONTABIL (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    DATA              DDATA2,
    TIPO              DCHAR,
    DOCUMENTO         DDOCUMENTO,
    HISTORICO         DHISTORICO,
    MES               DCODIGO,
    ANO               DCODIGO,
    VALOR             DVALOR,
    CONTA             DCODIGO,
    ORIGEM            DCHAR15,
    PLANILHA          DCODIGO,
    CONTRA_PARTIDA    DCODIGO,
    BANCO             DCHAR3,
    DATA_CONCILIACAO  DDATA2,
    TIPO_LANCAMENTO   DCHAR,
    COD_DOC           DCHAR3,
    FORNECEDOR        DCODIGO,
    EXCLUIR           DCHAR,
    VALOR_INDEXADO    DVALOR,
    COD_ACERTOCONTA   DCODIGO
);

CREATE TABLE CTB_PLANOCONTA (
    CNPJ                  DCNPJ NOT NULL,
    CONTA                 DCODIGO NOT NULL,
    CODIGO                DCHAR15,
    CONTAPAI              DCHAR10,
    NOME                  DNOME,
    BANCO                 DCHAR3,
    ULTIMO_CHEQUE         DCODIGO,
    TIPO                  DCHAR,
    AGENCIA               DCHAR10,
    DV_AGENCIA            DCHAR3,
    CONTA_CORRENTE        DCHAR15,
    DV_CONTA_CORRENTE     DCHAR3,
    DV_AGENCIA_CONTA      DCHAR3,
    CTB_FLUXO_CAIXA       DCHAR,
    GERA_BOLETOS          DCHAR,
    BLT_INSTRUCAO         DMN_BLOB_TEXT,
    BLT_LOCAL_PAGTO       DVARCHAR200,
    BLT_COD_CEDENTE       DCODIGO,
    BLT_DIG_COD_CEDENTE   DCHAR,
    BLT_AGENCIA           DCHAR10,
    BLT_DIG_AGENCIA       DCHAR,
    BLT_CONVENIO          DCODIGO,
    BLT_CONTA             DCHAR10,
    BLT_DIG_CONTA         DCHAR,
    BLT_CARTEIRA          DCHAR10,
    BLT_LAYOUT            DANO,
    BLT_ACEITE_DOCTO      DCHAR,
    BLT_DIAS_ABATIMENTO   DCNPJ,
    BLT_DIAS_DESCONTO     DCODIGO,
    BLT_DIAS_MORA_JUROS   DCODIGO,
    BLT_DIAS_PROTESTO     DCODIGO,
    BLT_PCT_ABATIMENTO    DVALOR,
    BLT_PCT_DESCONTO      DVALOR,
    DESP_BANCARIA         DVALOR,
    MORA_DIARIA           DVALOR,
    BLT_VLR_IOF           DVALOR,
    BLT_VLR_OUTRAS_DESP   DVALOR,
    BLT_DIR_REMESSA       DVARCHAR200,
    BLT_DIR_RETORNO       DVARCHAR200,
    BLT_MULTA             DVALOR,
    BLT_NOSSO_NUM_INI     DCODIGO,
    BLT_NOSSO_NUM_FIM     DCODIGO,
    BLT_NOSSO_NUM_PROX    DCODIGO,
    BLT_MODALIDADE        DCHAR10,
    BLT_LAYOUT_IMPRESSAO  DCHAR,
    BLT_NUM_COPIAS        DCODIGO
);

CREATE TABLE EST_AGRUPADORES (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGOPROD NOT NULL,
    NOME    DNOME
);

CREATE TABLE EST_ALTERA_PRECO (
    CODIGO            DCODIGO NOT NULL,
    CNPJ              DCNPJ,
    DESCRICAO         DNOME,
    DATA              DATE,
    FLT_PRODUTO       DCODIGOPROD,
    FLT_MARCA         DCODIGO,
    FLT_GRUPO         DCODIGO,
    FLT_SUBGRUPO      DCODIGO,
    FECHADA           DCHAR,
    DT_PROCESSAMENTO  DATE
);

CREATE TABLE EST_ALTERA_PRECO_ITEM (
    CODIGO            DCODIGO NOT NULL,
    CNPJ              DCNPJ,
    COD_ALTERA_PRECO  DCODIGO,
    PRODUTO           DCODIGOPROD,
    VLR_ANTERIOR      DVALOR,
    VLR_ATUAL         DVALOR,
    MARGEM            DVALOR,
    VLR_ATUALIZACAO   DVALOR
);

CREATE TABLE EST_ALTERAPRECOS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    FECHADA    DCHAR,
    IPI        DVALOR,
    IMPOSTOS   DVALOR
);

CREATE TABLE EST_ALTERAPRECOS_GRUPO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    FECHADA    DCHAR
);

CREATE TABLE EST_ALTERAPRECOS_GRUPO_PRODUTOS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    GRUPO        DCODIGO NOT NULL,
    PORCENTAGEM  DVALOR,
    NOME         DNOME
);

CREATE TABLE EST_ALTERAPRECOS_MARCA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    FECHADA    DCHAR
);

CREATE TABLE EST_ALTERAPRECOS_MARCA_PRODUTOS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    MARCA        DCODIGO NOT NULL,
    PORCENTAGEM  DVALOR,
    NOME         DNOME
);

CREATE TABLE EST_ALTERAPRECOS_PRODUTOS (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    PRODUTO         DCODIGOPROD NOT NULL,
    VALOR_ANTERIOR  DVALOR,
    PORCENTAGEM     DVALOR,
    VALOR           DVALOR,
    NOME            DNOME,
    CODIGO_INTERNO  DCODIGO,
    CUSTO_LISTA     DVALOR,
    CUSTO_COLOCADO  DVALOR
);

CREATE TABLE EST_ALTERAPRECOS_UNID (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    FECHADA    DCHAR
);

CREATE TABLE EST_ALTERAPRECOS_UNID_PRODUTOS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    UNIDADE      DSIGLAUM NOT NULL,
    PORCENTAGEM  DVALOR,
    NOME         DNOME
);

CREATE TABLE EST_APLICACOES (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE EST_CLASSE_GRAO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DDESCRICAO
);

CREATE TABLE EST_CONTAGEM (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA,
    DOCUMENTO  DDOCUMENTO,
    FECHADA    DCHAR,
    LOCAL      DVALOR
);

CREATE TABLE EST_CONTAGEM_GRADE (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    DT_ABERTURA        DDATA,
    DOCUMENTO          DDOCUMENTO,
    PROCESSADA         DCHAR,
    DT_PROCESSAMENTO   DDATA,
    CODIGO_PROCESSADA  DCODIGO,
    LOCAL              DINTEIRO
);

CREATE TABLE EST_CONTAGEM_GRADE_PRODUTO (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    PRODUTO              DCODIGOPROD,
    CONTAGEM_GRADE       DCODIGO,
    QTDE                 DVALOR,
    GRADE                DCHAR4,
    NUMERO               DCHAR6,
    QUANTIDADE_ANTERIOR  DVALOR
);

CREATE TABLE EST_CONTAGEM_PRODUTOS (
    CNPJ                       DCNPJ,
    CODIGO                     DCODIGO,
    PRODUTO                    DCODIGOPROD,
    QUANTIDADE_ANTERIOR        DVALOR,
    QUANTIDADE                 DVALOR,
    NOME                       DNOME,
    NUMERO                     DCHAR6,
    QUANTIDADE_ANTERIOR_GRADE  DVALOR,
    GRADE                      DCHAR4,
    GRADE1                     DCHAR4
);

CREATE TABLE EST_CONVERSAO_UNID_MED (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    COD_UND_PADRAO     DSIGLAUM,
    COD_UND_CONVERSAO  DSIGLAUM,
    FATOR              INTEGER,
    QTDE               DVALOR
);

CREATE TABLE EST_COR (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE EST_EMAIL_POSICAO_ESTOQUE (
    CNPJ      DCNPJ NOT NULL,
    CODIGO    INTEGER NOT NULL,
    PRODUTO   DCODIGOPROD,
    QTDE      NUMERIC(18,4),
    MINIMO    NUMERIC(18,4),
    MAXIMO    DVALOR,
    SUJESTAO  NUMERIC(18,4),
    DATA      DATE,
    STATUS    CHAR(1)
);

CREATE TABLE EST_ENTRADAS (
    CNPJ             DCNPJ NOT NULL,
    NDOCTO           DDOCUMENTO NOT NULL,
    PESSOA_FJ        DCODIGO NOT NULL,
    DATA_NF          DDATA,
    DATA_REF         DDATA,
    DATA_ENT         DDATA,
    SERIE_NF         DCHAR3,
    NATUREZA         DCODIGO,
    VLR_PRODUTOS     DVALOR,
    VLR_PRODUTOS_LC  DVALOR,
    VLR_DESCONTO     DVALOR,
    VLR_EMBALAGEM    DVALOR,
    FRETE_LF         DCHAR,
    VLR_FRETE        DVALOR,
    VLR_SEGURO       DVALOR,
    VLR_IPI          DVALOR,
    VLR_IPI_LC       DVALOR,
    VLR_BC_ICM       DVALOR,
    PERC_ICM         DVALOR,
    VLR_ICM          DVALOR,
    VLR_ICM_SUBS     DVALOR,
    VLR_PARC_LC      DVALOR,
    TAXAS            DVALOR,
    LOCAL_ESTOQUE    DLOCAL,
    HISTORICO        DMENSAGEM,
    TIPO_DOCTO       DCHAR3,
    PROC_QTD         DCHAR,
    PROC_CUSTO       DCHAR,
    PROC_FIN         DCHAR,
    ENTRADA          DVALOR,
    CENTRO_CUSTO     DCODIGO,
    NOME             DNOME,
    PLANILHA         DCODIGO,
    VLR_FRETE_LC     DVALOR,
    NDOCTOINT        DCODIGO,
    UF               DUF,
    COD_INTERNO      SMALLINT,
    COD_FORMA_PAGTO  DCODIGO,
    COD_INDEXADOR    DCODIGO,
    IDX_DATABASE     DDATA2,
    IDX_COTACAO      DVALOR,
    IDX_QTDE         DVALOR,
    VLR_BC_ICM_SUBS  DVALOR
);

CREATE TABLE EST_ENTRADAS_FATURAMENTO (
    CNPJ          DCNPJ NOT NULL,
    NDOCTO        DDOCUMENTO NOT NULL,
    PESSOA_FJ     DCODIGO NOT NULL,
    DT_VENCTO     DDATA NOT NULL,
    CODIGO_CP     DCODIGO,
    ANO_CP        DCODIGO,
    PARCELA       DCHAR6,
    VALOR         DVALOR,
    DUPLICATA     DCHAR15,
    OBSERVACAO    DHISTORICO,
    CONFERIDA     DCHAR,
    SEQUENCIAL    DCODIGO NOT NULL,
    CENTRO_CUSTO  DCODIGO,
    COD_CREDOR    DCODIGO
);

CREATE TABLE EST_ENTRADAS_ITENS (
    CNPJ                      DCNPJ NOT NULL,
    NDOCTO                    DDOCUMENTO NOT NULL,
    PESSOA_FJ                 DCODIGO NOT NULL,
    PRODUTO                   DCODIGOPROD NOT NULL,
    UNIDADE                   DSIGLAUM,
    QUANTIDADE                DVALOR_EXT,
    PRC_UNITARIO              DVALOR_EXT,
    PERC_LUCRO                DPORCENTAGEM,
    PRC_VENDA                 DVALOR,
    PRC_VENDA_ANT             DVALOR,
    PRC_CUSTO                 DVALOR,
    ICM                       DVALOR,
    ICM_SUBS                  DVALOR,
    IPI                       DVALOR,
    IPI_PRODUTO               DVALOR,
    TAXAS                     DVALOR,
    DESCONTOS                 DVALOR,
    EMBALAGEM                 DVALOR,
    FRETE                     DVALOR,
    SEGURO                    DVALOR,
    NOME_PRODUTO              DNOME,
    SUBUNIDADE                DCODIGO,
    LOTE                      DCODIGO,
    CTE                       DCODIGOTRIB,
    CTIE                      DCODIGOTRIB,
    CODIGO_INTERNO            DCODIGO,
    CONVERSAO                 DQUANTIDADE,
    PRC_UNITARIO_DOLAR        DVALOR,
    ORDEM                     DCODIGO,
    SECUNDARIO                DCODIGOPROD,
    CFOP                      DCODIGO,
    LOG_CUSTO_MEDIO_ANTERIOR  DVALOR,
    LOG_ESTOQUE_ANTERIOR      DVALOR,
    REDUCAO                   DVALOR
);

CREATE TABLE EST_ENTRADAS_ITENS_GRADES (
    CNPJ        DCNPJ NOT NULL,
    NDOCTO      DDOCUMENTO NOT NULL,
    PESSOA_FJ   DCODIGO NOT NULL,
    PRODUTO     DCODIGOPROD NOT NULL,
    GRADE       DCHAR4 NOT NULL,
    NUMERO      DCHAR6 NOT NULL,
    QUANTIDADE  DVALOR,
    ORDEM       DCODIGO,
    COR         DNOME,
    MATERIAL    DNOME
);

CREATE TABLE EST_ENTRADAS_ITENS_LOTES (
    CODIGO      DCODIGO NOT NULL,
    CNPJ        DCNPJ,
    NDOCTO      DDOCUMENTO,
    PESSOA_FJ   DCODIGO,
    PRODUTO     DCODIGOPROD,
    LOTE        DCODIGO,
    QUANTIDADE  DVALOR,
    ORDEM       DCODIGO
);

CREATE TABLE EST_ENTRADAS_MANUAL (
    CNPJ                    DCNPJ NOT NULL,
    CODIGO                  DCODIGO NOT NULL,
    DATA                    DDATA,
    PRODUTO                 DCODIGOPROD,
    NOME                    DNOME,
    VLR_CAIXA               DVALOR,
    VLR_EMBALAGEM           DVALOR,
    VLR_COMPRA              DVALOR,
    VLR_IPI                 DVALOR,
    VLR_FRETE_PROPRIO       DVALOR,
    VLR_FRETE_TERCEIRO      DVALOR,
    VLR_TRIBUTACAO_CREDITO  DVALOR,
    VLR_OUTRAS_DESPESAS     DVALOR,
    QUANTIDADE              DVALOR,
    VLR_VENDA               DVALOR,
    VLR_LUCRO               DVALOR,
    VLR_CUSTO_TOTAL         DVALOR,
    FECHADA                 DCHAR,
    VLR_RENTABILIDADE       DVALOR,
    VLR_ICM_VENDA           DVALOR,
    MARGEM_LUCRO            DVALOR,
    TOT_FRETE_TERCEIRO      DVALOR,
    TOT_ICM_CREDITO         DVALOR,
    TOT_ICM_DEBITO          DVALOR,
    TOT_RENTABILIDADE       DVALOR,
    TOT_IPI                 DVALOR,
    TOT_DESP_OPERACIONAL    DVALOR,
    TOT_DESP_FEDERAL        DVALOR,
    TOT_FRETE_PROPRIO       DVALOR,
    HORA                    DTIME,
    VLR_VENDA_ANTERIOR      DVALOR,
    FORNECEDOR              DCODIGO,
    NDOCTO                  DDOCUMENTO,
    NOME_FORNECEDOR         DNOME
);

CREATE TABLE EST_ESTIQUETA_PRODUTO (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGOPROD NOT NULL,
    NOME        DNOME,
    VALOR       DVALOR,
    QUANTIDADE  DCODIGO,
    SEQUENCIA   DCODIGO NOT NULL,
    NUMERO      DCHAR6,
    NDOCTO      DDOCUMENTO,
    PESSOA_FJ   DINTEIRO,
    GRADE       DCHAR4,
    CODIGO_2    DCODIGOPROD
);

CREATE TABLE EST_ESTIQUETA_PRODUTO_IMPRIME (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGOPROD NOT NULL,
    NOME          DNOME,
    VALOR         DVALOR,
    QUANTIDADE    DCODIGO,
    SEQUENCIA     DCODIGO NOT NULL,
    NUMERO        DCHAR6,
    GRADE         DCHAR4,
    CODIGO_2      DCODIGOPROD,
    MARCA         DCODIGO,
    CONT_NUMEROS  DCODIGO
);

CREATE TABLE EST_FECHAMENTO_MES (
    CNPJ           DCNPJ NOT NULL,
    PRODUTO        DCODIGOPROD NOT NULL,
    DATA           DDATA,
    MES            DCODIGO NOT NULL,
    ANO            DCODIGO NOT NULL,
    SALDO_INICIAL  DVALOR,
    ENTRADAS       DVALOR,
    SAIDAS         DVALOR,
    GRUPO          DCODIGO,
    CUSTO          DVALOR,
    SUB_GRUPO      DCODIGO
);

CREATE TABLE EST_GRADES (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    INICIAL    DCODIGO,
    FINAL      DCODIGO,
    INTERVALO  DCODIGO
);

CREATE TABLE EST_GRADES_ADICIONAL (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCHAR6 NOT NULL,
    GRADE   DCODIGO NOT NULL,
    ORDEM   DCODIGO
);

CREATE TABLE EST_GRUPOS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    BASE         DMESES,
    MINIMO       DMESES,
    MAXIMO       DMESES,
    SELECIONADO  DCHAR
);

CREATE TABLE EST_HISTORICO_PRD_CUSTO (
    CODIGO           DCODIGO NOT NULL,
    CNPJ             DCNPJ,
    COD_PRODUTO      DCODIGOPROD,
    COD_PESSOA_FJ    SMALLINT,
    QTDE             DVALOR,
    CUSTO_MEDIO_NF   DVALOR,
    CUSTO_MEDIO_ANT  DVALOR,
    DATA             DDATA2,
    COD_NF_ENTRADA   DDOCUMENTO,
    HORA             DTIME,
    CUSTO_AQUISICAO  DVALOR,
    PRC_REPOS        DVALOR
);

CREATE TABLE EST_INVENTARIO (
    CNPJ            DCNPJ NOT NULL,
    PRODUTO         DCODIGOPROD NOT NULL,
    DATA            DDATA NOT NULL,
    QUANTIDADE      DQUANTIDADE,
    OBSERVACAO      DMENSAGEM,
    TIPO            DES,
    SALDO_ANTERIOR  DQUANTIDADE,
    SALDO           DQUANTIDADE
);

CREATE TABLE EST_KARDEX (
    CNPJ                 DCNPJ NOT NULL,
    PRODUTO              DCODIGOPROD NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    NDOCTO               DDOCUMENTO,
    DT_MOVTO             DDATA,
    MES                  DMESES,
    ANO                  DMESES,
    ORIGEM               DCHAR6,
    TIPO_ES              DES,
    PESSOA_FJ            DCODIGO,
    QTDADE_ANT           DQUANTIDADE,
    QTDADE               DQUANTIDADE,
    PRC_UNIT             DVALOR,
    DESCONTOS            DVALOR,
    DT_KARDEX            DDATA,
    HR_KARDEX            DTIME,
    CFOP                 DCODIGO,
    CFOP_ESTOQUE         DCHAR,
    PRD_CUSTO_AQUISICAO  DVALOR,
    PRD_PRC_VENDA        DVALOR,
    VDI_CUSTO_MED        DVALOR,
    CUSTO_MEDIO          DVALOR
);

CREATE TABLE EST_LOCALIZACAO (
    CODIGO     DCODIGO NOT NULL,
    CNPJ       DCNPJ,
    DESCRICAO  DNOME
);

CREATE TABLE EST_LOTE (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    NUMERO_LOTE      "DVARCHAR(20)",
    DATA_FABRICACAO  DDATA,
    DATA_VALIDADE    DDATA,
    PRODUTO          DCODIGOPROD
);

CREATE TABLE EST_LOTE_PRODUTO (
    CNPJ              DCNPJ NOT NULL,
    PRODUTO           DCODIGOPROD NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    LOTE              DCHAR10,
    ESTOQUE           DVALOR,
    PENEIRA           DCHAR10,
    ATESTADO          DCHAR6,
    GERMINACAO        DVALOR,
    PUREZA            DVALOR,
    VALIDADE          DDATA,
    DT_ULTIMA_COMPRA  DDATA,
    DT_ULTIMA_VENDA   DDATA,
    PESO              DVALOR
);

CREATE TABLE EST_LOTE_SEMENTES (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    LOTE               DCODIGO,
    AGS                VARCHAR(10),
    GERMINACAO         DVALOR,
    PUREZA             DVALOR,
    NUMERO_REGISTRO    VARCHAR(20),
    OUTROS_CULTIVARES  VARCHAR(20),
    SILVESTRES         VARCHAR(20),
    OUTRAS_ESPECIES    VARCHAR(20),
    TOLERADAS          VARCHAR(20),
    PROIBIDAS          VARCHAR(20),
    VALOR_CULTURAL     DVALOR,
    FK_PENEIRA         DCODIGO,
    FK_TIPO_GRAO       DCODIGO,
    FK_CLASSE_GRAO     DCODIGO,
    FK_FORNECEDOR      DCODIGO
);

CREATE TABLE EST_MARCAS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    SELECIONADO  DCHAR
);

CREATE TABLE EST_MATERIAL (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE EST_NATUREZA (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    NOME                 DNOME,
    ES                   DES,
    PERC_ICMS            DVALOR,
    PERC_ICMS_REV        DVALOR,
    PERC_ISS             DVALOR,
    MOV_CAIXA            DCHAR,
    MOV_ESTOQUE          DCHAR,
    PAGA_COMISSAO        DCHAR,
    COMPUTA_VENDA        DCHAR,
    RESUMO_CONTABIL      DCHAR,
    ALTERA_CUSTO         DCHAR,
    CONSIGNACAO          DCHAR,
    MENSAGEM_1           DNOME,
    MENSAGEM_2           DNOME,
    ATIVA                DCHAR,
    TTL_RES_DIVERSOS     DCHAR DEFAULT 'N',
    TTL_RES_BONIFICACAO  DCHAR,
    DEVOLUCAO            DCHAR,
    REMESSA              DCHAR,
    ENTREGA_FUTURA       DCHAR,
    INTERESTADUAL        DCHAR,
    GERA_FINANCEIRO      DCHAR,
    MSG_FISCAL           DMN_BLOB_TEXT,
    CALC_ICMS            DCHAR,
    CALC_INSS            DCHAR,
    CALC_ISSQN           DCHAR,
    CALC_SEST_SENAT      DCHAR,
    CALC_PIS             DCHAR,
    CALC_COFINS          DCHAR,
    CALC_IPI             DCHAR,
    CALC_IRRF            DCHAR,
    CFOP                 DCODIGO,
    CFOP_DESCRICAO       DNOME,
    MOV_ESTOQUE_FISCAL   DCHAR,
    IMP_PEDIDO           DCHAR,
    REL_GERENCIAL        DCHAR
);

CREATE TABLE EST_PENEIRA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DDESCRICAO
);

CREATE TABLE EST_POSICAO_DIARIA (
    CNPJ           VARCHAR(15) NOT NULL,
    DATA           DDATA NOT NULL,
    PRODUTO        VARCHAR(15) NOT NULL,
    NOME           VARCHAR(50),
    LEITURA        NUMERIC(18,4),
    ENTRADA        NUMERIC(18,4),
    VENDA          NUMERIC(18,4),
    CONTAGEM       NUMERIC(18,4),
    POSICAO        DVALOR,
    INICIAL        DVALOR,
    TIPO_CONTAGEM  DCHAR,
    CUSTO          DVALOR,
    GRUPO          DCODIGO,
    SUB_GRUPO      DCODIGO,
    TURNO          DCODIGO NOT NULL,
    GARANTIAS_ENT  DVALOR,
    GARANTIAS_SAI  DVALOR,
    TROCAS_ENT     DVALOR,
    TROCAS_SAI     DVALOR
);

CREATE TABLE EST_PRODUTOS (
    CNPJ                  DCNPJ NOT NULL,
    CODIGO                DCODIGOPROD NOT NULL,
    CODIGO_2              DCODIGOPROD,
    CNPJ_AGRUP            DCNPJ,
    COD_AGRUP             DCODIGOPROD,
    NOME                  DNOME,
    MARCA                 DCODIGO,
    NOME_MARCA            DNOME,
    GRUPO                 DCODIGO,
    SUBGRUPO              DCODIGO,
    REDUCAO               DCODIGO,
    UNIDADE               DSIGLAUM,
    UND_PRIMARIA          DSIGLAUM,
    CTE                   DCODIGOTRIB,
    CTIE                  DCODIGOTRIB,
    QTDADE_1              DQUANTIDADE,
    QTDADE_2              DQUANTIDADE,
    LOCALIZACAO_1         DDESCRICAO,
    LOCALIZACAO_2         DDESCRICAO,
    LOCALIZACAO_3         DDESCRICAO,
    NEG_QTDADE_2          DCHAR,
    QTDADE_MIN            DQTD,
    QTDADE_MAX            DQTD,
    COMPLEMENTO_NF        DCHAR,
    DT_ULT_COMPRA         DDATA,
    QT_ULT_COMPRA         DQTD,
    DT_ULT_VENDA          DDATA,
    MARGEM_BRUTA          DVALOR,
    PRC_REPOS             DVALOR,
    PRC_CUSTO_ANT         DVALOR,
    PRC_CUSTO_MED         DVALOR,
    PRC_VENDA             DVALOR,
    PRC_VENDA_ANT         DVALOR,
    PRC_VENDA_MED         DVALOR,
    ALIQUOTA_ECF          DALIQUOTAECF,
    ORIGEM                DCODORIGEM,
    PESO_LIQ              DVALOR,
    PERC_FRETE            DVALOR,
    IPI                   DVALOR,
    VOLUME                DVALOR,
    PROD_PESAVEL          DCHAR,
    ETIQUETA_ENT          DCHAR,
    ATIVO                 DCHAR,
    ULTIMO_FORNECEDOR     DCODIGO,
    FORNECEDOR            DCODIGO,
    SUBUNIDADE            DCODIGO,
    PRC_CUSTO_CODIF       DCHAR15,
    CODIGO_INTERNO        DCODIGO,
    DT_ULT_ATU_PRECO      DDATA,
    CUSTO_AQUISICAO       DVALOR,
    VENDE_FRACIONADO      DCHAR,
    QNTDE_EXPOSTA         DVALOR,
    POSSUI_LOTE           DCHAR,
    QNTDE_MAXIMA_VENDA    DVALOR,
    PIS                   DCHAR,
    COFINS                DCHAR,
    COM_VENDA_VLR         DVALOR,
    COM_VENDA_PCT         DVALOR,
    PARTICIP_LUCRO        DVALOR,
    NAO_COBR_JUR_ATE      DCODIGO,
    PREVISAO_ENTREGA      DDATA,
    QNTDE_PEDIDA          DVALOR,
    ATUALIZA_ARQ_EXTERNO  DCHAR,
    SERVICO               DCHAR,
    VALIDADE              DCODIGO,
    CUSTO_INDEXADO        DVALOR,
    COMPLEMENTO           "DMN_VARCHAR(100)",
    ATUALIZAR             DCHAR,
    EST_MIN               DVALOR,
    EST_MAX               DVALOR,
    MODELO                DCODIGO,
    NOME_MODELO           DMENSAGEM,
    SERIE                 "DVARCHAR(30",
    DEBITA_ICMS           DCHAR,
    SECAO                 DCODIGO,
    NFE_EXP               DCHAR,
    SELECIONADO           DCHAR DEFAULT 'N',
    QNTDE_MINIMA_VENDA    DVALOR,
    VALIDA_MULT_QTDE_MIN  DCHAR,
    FATOR_CONVERSAO       DVALOR,
    SINCRONIZA_FILIAIS    DCHAR,
    QNTDE_PDR_CARGA       DVALOR,
    UND_CARREGAMENTO      DSIGLAUM,
    TRIB_ALIQ_EST         DVALOR,
    TRIB_ALIQ_INT         DVALOR,
    TRIB_MODALIDADE       DNOME,
    BCH_CODIGO            DCODIGO,
    CODIGO_NCM            DNOME,
    APLICACAO             DMN_BLOB_TEXT,
    IMG_2                 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_1                 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_3                 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_4                 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    CODIGO_FABRICANTE     DNOME,
    COR                   DCODIGO,
    MATERIAL              DCODIGO,
    TRIB_PIS              DCHAR2,
    TRIB_COFINS           DCHAR2,
    TRIB_IPI              DCHAR2,
    VENCTO_PRC_VENDA      DDATA2,
    CSOSN                 DCODIGO,
    COD_GETIN             DCHAR15,
    COD_LOCALIZACAO_1     DCODIGO,
    COD_LOCALIZACAO_2     DCODIGO,
    COD_LOCALIZACAO_3     DCODIGO
);

CREATE TABLE EST_PRODUTOS_AGREGADOS (
    CNPJ      DCNPJ NOT NULL,
    CODIGO    DCODIGO NOT NULL,
    PRODUTO   DCODIGOPROD,
    PRODUTO2  DCODIGOPROD
);

CREATE TABLE EST_PRODUTOS_APLICACOES (
    CNPJ       DCNPJ NOT NULL,
    PRODUTO    DCODIGOPROD NOT NULL,
    APLICACAO  DCODIGO NOT NULL,
    LOCAL      DNOME
);

CREATE TABLE EST_PRODUTOS_GRADES (
    CNPJ           DCNPJ NOT NULL,
    PRODUTO        DCODIGOPROD NOT NULL,
    GRADE          DCHAR4 NOT NULL,
    MATERIAL       DCODIGO,
    COR            DCODIGO,
    ULTIMA_COMPRA  DDATA,
    QTDADE_COMPRA  DVALOR,
    ULTIMA_VENDA   DDATA,
    QTDADE_VENDA   DVALOR,
    ESTOQUE        DVALOR,
    NOME_MATERIAL  DNOME,
    NOME_COR       DNOME,
    PERFIL         DCODIGO,
    NOME_PERFIL    DNOME
);

CREATE TABLE EST_PRODUTOS_GRADES_NUMEROS (
    CNPJ     DCNPJ NOT NULL,
    PRODUTO  DCODIGOPROD NOT NULL,
    ESTOQUE  DVALOR,
    NUMERO   DCHAR6 NOT NULL,
    ORDEM    DCODIGO,
    GRADE    DCHAR4 NOT NULL
);

CREATE TABLE EST_PRODUTOS_SIMILARES (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    PRODUTO_A  DCODIGOPROD,
    PRODUTO_B  DCODIGOPROD
);

CREATE TABLE EST_PRODUTOS_TRIBUT_REVENDA (
    CNPJ     DCNPJ NOT NULL,
    PRODUTO  DCODIGOPROD NOT NULL,
    CTE      DCODIGO,
    CTIE     DCODIGO
);

CREATE TABLE EST_PROMOCAO (
    CNPJ            DCNPJ NOT NULL,
    PRODUTO         DCODIGOPROD NOT NULL,
    NOME            DNOME,
    VALOR           DVALOR,
    VALIDADE        DDATA NOT NULL,
    VALIDADE_FINAL  DDATA,
    PRC_VENDA       DVALOR
);

CREATE TABLE EST_REDUCOES (
    CNPJ                DCNPJ NOT NULL,
    CODIGO              DCODIGO NOT NULL,
    PERC_ESTADUAL       DVALOR,
    PERC_INTERESTADUAL  DVALOR,
    MENSAGEM_NF         DMENSAGEM,
    MENSAGEM_NF_IE      DMENSAGEM,
    PERC_CONTRIBUINTE   DVALOR
);

CREATE TABLE EST_SECAO (
    CNPJ       DCNPJ NOT NULL,
    COD_SECAO  DCODIGO NOT NULL,
    NOME       DNOME
);

CREATE TABLE EST_SUBGRUPOS (
    CNPJ             DCNPJ NOT NULL,
    GRUPO            DCODIGO NOT NULL,
    SUBGRUPO         DCODIGO NOT NULL,
    NOME             DNOME,
    DESCONTO_MAX     DVALOR,
    DIGITA_PRC       DCHAR,
    COMPRAS_C        DCODIGO,
    COMPRAS_D        DCODIGO,
    TRANSFERENCIA_C  DCODIGO,
    TRANSFERENCIA_D  DCODIGO,
    VENDAS_C         DCODIGO,
    VENDAS_D         DCODIGO,
    ESTOQUE          DCODIGO,
    ESTOQUE_INI      DCODIGO,
    ESTOQUE_FIM      DCODIGO,
    OBS              DMN_BLOB_TEXT
);

CREATE TABLE EST_SUBGRUPOS_COTAS (
    CNPJ            DCNPJ NOT NULL,
    GRUPO           DCODIGO NOT NULL,
    SUBGRUPO        DCODIGO NOT NULL,
    VENDEDOR        DCODIGO NOT NULL,
    VALOR           DVALOR,
    COMISSAO_VISTA  DPORCENTAGEM,
    COMISSAO_PRAZO  DPORCENTAGEM
);

CREATE TABLE EST_SUBUNIDADES (
    CNPJ      DCNPJ NOT NULL,
    SIGLA     DSIGLAUM NOT NULL,
    UNIDADES  DCODIGO NOT NULL
);

CREATE TABLE EST_TIPO_GRAO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DDESCRICAO
);

CREATE TABLE EST_TRANSPORTADORES (
    CNPJ       DCNPJ NOT NULL,
    PESSOA_FJ  DCODIGO NOT NULL,
    NOME       DNOME
);

CREATE TABLE EST_UNIDADES (
    CNPJ      DCNPJ NOT NULL,
    SIGLA     DSIGLAUM NOT NULL,
    NOME      DNOME,
    UNIDADES  DQUANTIDADE
);

CREATE TABLE EXP_CTB_CF_PROSOFT (
    CNPJ                DCNPJ NOT NULL,
    CODIGO              DCODIGO NOT NULL,
    DATA_MOVIMENTO      DDATA2,
    NUM_SEQ_ECF         DCHAR3,
    NUM_SER_ECF         DDOCUMENTO,
    CT_OO_ANT           DCODIGO,
    CT_OO_FIN           DCODIGO,
    CT_RED_Z_FIN        DCODIGO,
    NUM_ULT_DOC_IMP     DCODIGO,
    NUM_CONT_R_OO       DCODIGO,
    TT_GERAL_INI        DVALOR,
    TT_GERAL_FIN        DVALOR,
    MOVIMENTO_DIA       DVALOR,
    CANCELAMENTOS       DVALOR,
    DESCCONTOS          DVALOR,
    TT_OP_ISS           DVALOR,
    ACRESCIMO           DVALOR,
    VALOR_CONTABIL      DVALOR,
    F_SUB_TRIB          DVALOR,
    I_ISENTAS           DVALOR,
    N_INCIDENCIA        DVALOR,
    SUSPENSAO           DVALOR,
    ALIQ_ICMS_01        DVALOR,
    DEBITO_ICMS_01      DVALOR,
    BASE_ICMS_01        DVALOR,
    PCT_REDUCAO_01      DVALOR,
    VALOR_S_REDUCAO_01  DVALOR,
    VALOR_C_REDUCAO_01  DVALOR,
    VALOR_ICMS_01       DVALOR,
    VALOR_OUTRAS_01     DVALOR,
    VALOR_ISENTAS_01    DVALOR
);

CREATE TABLE EXP_CTB_CF_PROSOFT_ALIQ (
    CODIGO                  DCODIGO NOT NULL,
    ALIQUOTA                DCHAR4,
    VALOR                   DVALOR,
    COD_EXP_CTB_CF_PROSOFT  DCODIGO,
    CNPJ                    DCNPJ
);

CREATE TABLE EXT_EST_PRODUTOS (
    CNPJ                DCNPJ,
    CODIGO              DCODIGOPROD,
    CODIGO_2            DCODIGOPROD,
    CNPJ_AGRUP          DCNPJ,
    COD_AGRUP           DCODIGOPROD,
    NOME                DNOME,
    MARCA               DCODIGO,
    GRUPO               DCODIGO,
    SUBGRUPO            DCODIGO,
    REDUCAO             DCODIGO,
    UNIDADE             DSIGLAUM,
    CTE                 DCODIGOTRIB,
    CTIE                DCODIGOTRIB,
    QTDADE_1            DQUANTIDADE,
    QTDADE_2            DQUANTIDADE,
    LOCALIZACAO_1       DDESCRICAO,
    LOCALIZACAO_2       DDESCRICAO,
    LOCALIZACAO_3       DDESCRICAO,
    NEG_QTDADE_2        DCHAR,
    QTDADE_MIN          DQTD,
    QTDADE_MAX          DQTD,
    COMPLEMENTO_NF      DLOGICO,
    DT_ULT_COMPRA       DDATA,
    QT_ULT_COMPRA       DQTD,
    DT_ULT_VENDA        DDATA,
    MARGEM_BRUTA        DVALOR,
    PRC_REPOS           DVALOR,
    PRC_CUSTO_ANT       DVALOR,
    PRC_CUSTO_MED       DVALOR,
    PRC_VENDA           DVALOR,
    PRC_VENDA_ANT       DVALOR,
    PRC_VENDA_MED       DVALOR,
    ALIQUOTA_ECF        DALIQUOTAECF,
    ORIGEM              DCODORIGEM,
    PESO_LIQ            DVALOR,
    PERC_FRETE          DVALOR,
    IPI                 DVALOR,
    VOLUME              DVALOR,
    PROD_PESAVEL        DCHAR,
    ETIQUETA_ENT        DCHAR,
    ATIVO               DCHAR,
    ULTIMO_FORNECEDOR   DCODIGO,
    FORNECEDOR          DCODIGO,
    SUBUNIDADE          DCODIGO,
    NOME_MARCA          DNOME,
    PRC_CUSTO_CODIF     DCHAR15,
    CODIGO_INTERNO      DCODIGO,
    DT_ULT_ATU_PRECO    DDATA,
    CUSTO_AQUISICAO     DVALOR,
    VENDE_FRACIONADO    DCHAR,
    QNTDE_EXPOSTA       DVALOR,
    POSSUI_LOTE         DCHAR,
    QNTDE_MAXIMA_VENDA  DVALOR,
    PIS                 DCHAR,
    COFINS              DCHAR,
    COM_VENDA_VLR       DVALOR,
    COM_VENDA_PCT       DVALOR,
    PARTICIP_LUCRO      DVALOR,
    NAO_COBR_JUR_ATE    DCODIGO,
    PREVISAO_ENTREGA    DDATA,
    QNTDE_PEDIDA        DVALOR
);

CREATE TABLE FAT_CAIXA_GERAL (
    CNPJ                      DCNPJ NOT NULL,
    DATA                      DDATA NOT NULL,
    DINHEIRO                  DVALOR,
    TICKET                    DVALOR,
    CHEQUE                    DVALOR,
    SALDO_ANTERIOR            DVALOR,
    SALDO                     DVALOR,
    FECHADO                   DCHAR,
    TROCO                     DVALOR,
    SANGRIA                   DVALOR,
    BOMBAS                    DVALOR,
    NOTAS                     DVALOR,
    PRODUTOS                  DVALOR,
    CARTAO                    DVALOR,
    RECEBIMENTOS              DVALOR,
    AFERICAO                  DVALOR,
    MOEDAS                    DVALOR,
    CHEQUE_PRAZO              DVALOR,
    OUTRAS_ENTRADAS           DVALOR,
    OUTRAS_SAIDAS             DVALOR,
    TROCO_INICIAL             DVALOR,
    HAVER                     DVALOR,
    BAIXA_HAVER               DVALOR,
    PLANILHA                  DCODIGO,
    DESCONTOS                 DVALOR,
    JUROS                     DVALOR,
    ACRESCIMOS                DVALOR,
    TROCO_VENDAS              DVALOR,
    VENDAS_VISTA              DVALOR,
    VENDAS_PRAZO              DVALOR,
    SALDO_PRAZO               DVALOR,
    SALDO_VISTA               DVALOR,
    PAGAMENTOS                DVALOR,
    SALDO_CHEQUE              DVALOR,
    SALDO_CHEQUE_CONC_DATA    DVALOR,
    SALDO_CONTAS_BANCARIAS    DVALOR,
    SALDO_RECEBER             DVALOR,
    SALDO_PAGAR               DVALOR,
    JUROS_RECEBER             DVALOR,
    DESCONTOS_RECEBER         DVALOR,
    SALDO_CAIXAS_FRENTISTA    DVALOR,
    DESCONTOS_PRODUTOS_BOMBA  DVALOR
);

CREATE TABLE FAT_CAIXA_GERAL_VENDEDOR (
    CNPJ      DCNPJ NOT NULL,
    DATA      DDATA NOT NULL,
    VENDEDOR  DCODIGO NOT NULL,
    NOME      DNOME,
    DINHEIRO  DVALOR,
    CHEQUE    DVALOR,
    CARTAO    DVALOR,
    TICKET    DVALOR,
    PRAZO     DVALOR
);

CREATE TABLE FAT_CAIXAS (
    CNPJ                      DCNPJ NOT NULL,
    USUARIO                   DCODIGO NOT NULL,
    CONTA                     DCODIGO NOT NULL,
    TURNO                     DCODIGO NOT NULL,
    DATA                      DDATA NOT NULL,
    FECHADO                   DCHAR,
    SALDO                     DVALOR,
    SALDO_ANTERIOR            DVALOR,
    DINHEIRO                  DVALOR,
    TICKET                    DVALOR,
    CHEQUE                    DVALOR,
    CARTAO                    DVALOR,
    TROCO                     DVALOR,
    SANGRIA                   DVALOR,
    DESCONTOS                 DVALOR,
    ACRESCIMOS                DVALOR,
    JUROS                     DVALOR,
    NOTAS                     DVALOR,
    PRODUTOS                  DVALOR,
    RECEBIMENTOS              DVALOR,
    MOEDAS                    DVALOR,
    CHEQUE_PRAZO              DVALOR,
    OUTRAS_ENTRADAS           DVALOR,
    OUTRAS_SAIDAS             DVALOR,
    TROCO_INICIAL             DVALOR,
    HAVER                     DVALOR,
    BAIXA_HAVER               DVALOR,
    PLANILHA                  DCODIGO,
    TROCO_VENDAS              DVALOR,
    VENDAS_VISTA              DVALOR,
    VENDAS_PRAZO              DVALOR,
    SALDO_PRAZO               DVALOR,
    SALDO_VISTA               DVALOR,
    PAGAMENTOS                DVALOR,
    SALDO_CHEQUE              DVALOR,
    SALDO_CHEQUE_CONC_DATA    DVALOR,
    SALDO_CONTAS_BANCARIAS    DVALOR,
    SALDO_RECEBER             DVALOR,
    SALDO_PAGAR               DVALOR,
    JUROS_RECEBER             DVALOR,
    DESCONTOS_RECEBER         DVALOR,
    DESCONTOS_PRODUTOS_BOMBA  DVALOR,
    SALDO_FINAL_ESTOQUE       DVALOR
);

CREATE TABLE FAT_CAIXAS_FLUXO (
    CNPJ              DCNPJ NOT NULL,
    USUARIO           DCODIGO NOT NULL,
    CONTA             DCODIGO NOT NULL,
    DATA              DDATA NOT NULL,
    TURNO             DCODIGO NOT NULL,
    SALDO_RECEBER     DVALOR,
    ENTRADA_RECEBER   DVALOR,
    SAIDA_RECEBER     DVALOR,
    SALDO_PAGAR       DVALOR,
    ENTRADA_PAGAR     DVALOR,
    SAIDA_PAGAR       DVALOR,
    SALDO_CHEQUE      DVALOR,
    ENTRADA_CHEQUE    DVALOR,
    SAIDA_CHEQUE      DVALOR,
    SALDO_ESTOQUE     DVALOR,
    ENTRADA_ESTOQUE   DVALOR,
    SAIDA_ESTOQUE     DVALOR,
    ACERTO_CHEQUE     DVALOR,
    DEVOLUCAO_CHEQUE  DVALOR
);

CREATE TABLE FAT_CAIXAS_MOVIMENTOS (
    CNPJ                DCNPJ NOT NULL,
    USUARIO             DCODIGO NOT NULL,
    CONTA               DCODIGO NOT NULL,
    DATA                DDATA NOT NULL,
    DOCUMENTO           DDOCUMENTO NOT NULL,
    HISTORICO           DHISTORICO,
    VALOR               DVALOR,
    TIPO                DDEBITO_CREDITO,
    CONTRA_PARTIDA      DCODIGO,
    NOME_CONTRAPARTIDA  DNOME,
    PESSOA_FJ           DCODIGO,
    NOME                DNOME,
    TURNO               SMALLINT NOT NULL,
    PLANILHA            DCODIGO,
    JUROS               DVALOR,
    DESCONTOS           DVALOR,
    CENTRO_CUSTO        DCODIGO
);

CREATE TABLE FAT_CAIXAS_RESUMO (
    CNPJ              DCNPJ NOT NULL,
    DATA              DDATA NOT NULL,
    CAIXAS            DVALOR,
    ENTRADAS          DVALOR,
    CHEQUE_DEVOLVIDO  DVALOR,
    CHEQUE_PRAZO_ENT  DVALOR,
    DINHEIRO          DVALOR,
    CHEQUE_VISTA      DVALOR,
    SAIDAS            DVALOR,
    CHEQUE_PRAZO_SAI  DVALOR,
    MOEDAS            DVALOR,
    FECHADO           DCHAR,
    PLANILHA          DCODIGO,
    NOME              DNOME
);

CREATE TABLE FAT_CAIXAS_RESUMO_MOVTOS (
    CNPJ                DCNPJ NOT NULL,
    DATA                DDATA NOT NULL,
    DOCUMENTO           DDOCUMENTO NOT NULL,
    HISTORICO           DHISTORICO,
    VALOR               DVALOR,
    TIPO                DDEBITO_CREDITO,
    CONTRA_PARTIDA      DCODIGO,
    NOME_CONTRAPARTIDA  DNOME,
    PESSOA_FJ           DCODIGO,
    NOME                DNOME,
    PLANILHA            DCODIGO
);

CREATE TABLE FAT_CAIXAS_SANGRIAS (
    CNPJ     DCNPJ NOT NULL,
    USUARIO  DCODIGO NOT NULL,
    CONTA    DCODIGO NOT NULL,
    DATA     DDATA NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    VALOR    DVALOR,
    TURNO    DCODIGO NOT NULL
);

CREATE TABLE FAT_CARTA_GARANTIAS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME,
    TEXTO   DOBS
);

CREATE TABLE FAT_COTACOES (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    DATA                 DDATA,
    PESSOA_FJ            DCODIGO,
    USUARIO              DCODIGO,
    FORMA_PGTO           DCODIGO,
    OBSERVACAO           DMENSAGEM,
    TOTAL                DVALOR,
    FECHADO              DCHAR,
    DESC_ACRESC          DVALOR,
    NOME                 DNOME,
    FORMA_COMBINADA      DNOME,
    TRANSPORTADORA       DCODIGO,
    NOME_TRANSPORTADORA  DNOME
);

CREATE TABLE FAT_COTACOES_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO NOT NULL,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    DESCONTO           DVALOR,
    PORC_DESC          DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME_PRODUTO       DNOME,
    SUBUNIDADE         DCODIGO
);

CREATE TABLE FAT_CUPOM (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      INTEGER NOT NULL,
    USUARIO     DCODIGO,
    DATA        DDATA,
    DINHEIRO    DVALOR,
    CHEQUE      DVALOR,
    TICKET      DVALOR,
    CONVENIO    DVALOR,
    CARTAO      DVALOR,
    TOTAL       DVALOR,
    TROCO       DVALOR,
    ACRES_DESC  DVALOR,
    CANCELADO   DCHAR,
    PESSOA_FJ   DCODIGO,
    NOME        DNOME
);

CREATE TABLE FAT_CUPOM_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO NOT NULL,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    DESCONTO           DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME               DNOME,
    ALIQUOTA           DALIQUOTAECF
);

CREATE TABLE FAT_GARANTIAS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    DATA               DDATA,
    PESSOA_FJ          DCODIGO,
    USUARIO            DCODIGO,
    VENDEDOR           DCODIGO,
    FORMA_PGTO         DCODIGO,
    OBSERVACAO         DMENSAGEM,
    NOME_CONSUMIDOR    DNOME,
    TOTAL              DVALOR,
    FECHADO            DCHAR,
    DESC_ACRESC        DVALOR,
    PESO               DVALOR,
    VOLUME             DVALOR,
    NOME               DNOME,
    VALIDADE           DDATA,
    TOTAL_2            DVALOR,
    DESC_ACRESC_2      DVALOR,
    CLIENTE            "DVARCHAR(30",
    ENVIADA_CX         DCHAR,
    DATA_CAIXA         DDATA,
    NOME_VENDEDOR      DNOME,
    NOME_FORMA         DNOME,
    ENTRADA            DVALOR,
    TIPO_DOCTO         DCHAR3,
    LOCAL_COBRANCA     DCODIGO,
    VLR_PARC_LC        DVALOR,
    PGTO_AVISTA        DCHAR,
    CONTA_CAIXA        DCODIGO,
    DINHEIRO           DVALOR,
    CARTAO             DVALOR,
    CHEQUE             DVALOR,
    TICKET             DVALOR,
    CANCELADA          DCHAR,
    DATA_CANCELAMENTO  DDATA,
    TURNO              DCODIGO
);

CREATE TABLE FAT_GARANTIAS_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    ICM                DVALOR,
    ICM_SUBS           DVALOR,
    IPI                DVALOR,
    VOLUME             DVALOR,
    PESO               DVALOR,
    DESCONTO           DVALOR,
    PORC_DESC          DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME_PRODUTO       DNOME,
    SUBUNIDADE         DCODIGO,
    MARCA              "DVARCHAR(30",
    TIPO               DCHAR
);

CREATE TABLE FAT_GARANTIAS_PARCELAMENTO (
    CNPJ     DCNPJ NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    VENCTO   DDATA NOT NULL,
    PARCELA  DCHAR6,
    VALOR    DVALOR,
    BOLETO   DCODIGO
);

CREATE TABLE FAT_ITEMTABELAPRECO (
    CNPJ                        DCNPJ NOT NULL,
    CODIGO                      DCODIGO NOT NULL,
    COD_TABELAPRECO             INTEGER,
    PRODUTO                     DCODIGOPROD,
    VALOR                       NUMERIC(18,4),
    DESCONTOMAXIMO              NUMERIC(18,4),
    COEFICIENTE                 NUMERIC(18,4),
    DATAINICIOVIGENCIA          DATE,
    DATAFIMVIGENCIA             DATE,
    MARGEMUTILIZADO             NUMERIC(18,4),
    COEFICIENTECUSTOUTILIZADO   NUMERIC(18,4),
    PRECOSUGERIDO               NUMERIC(18,4),
    COD_FATURAMENTO             INTEGER,
    DATAPRECIFICACAO            DATE,
    DATAPROJECAOPRECOS          DATE,
    PERCDESCONTOPROJECAO        NUMERIC(18,4),
    TIPOCALCULOPERCDESC         NUMERIC(18,4),
    PERCACRESCIMOPROJECAO       NUMERIC(18,4),
    TIPOCALCULOPERCACRESC       NUMERIC(18,4),
    PRECOCUSTO                  NUMERIC(18,4),
    DATAPROJECAOCUSTO           DATE,
    PERCDESCONTOPROJECAOCUSTO   NUMERIC(18,4),
    TIPOCALCULOPERCDESCCUSTO    INTEGER,
    PERCACRESCIMOPROJECAOCUSTO  NUMERIC(18,4)
);

CREATE TABLE FAT_MESAS (
    CODIGO    DCODIGO NOT NULL,
    CODIGO_2  DCHAR10,
    CNPJ      DCNPJ NOT NULL,
    ATIVO     DCHAR
);

CREATE TABLE FAT_MICRO_TERMINAL (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    PRODUTO         DCODIGOPROD,
    QUANTIDADE      DVALOR,
    PRECO_UNITARIO  DVALOR,
    TOTAL           DVALOR,
    DATA            DDATA2,
    COMANDA         DCODIGO
);

CREATE TABLE FAT_NOTAS_PRAZO (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    DATA             DDATA,
    PESSOA_FJ        DCODIGO,
    USUARIO          DCODIGO,
    VENDEDOR         DCODIGO,
    FORMA_PGTO       DCODIGO,
    OBSERVACAO       DMENSAGEM,
    NOME_CONSUMIDOR  DNOME,
    TOTAL            DVALOR,
    FECHADO          DCHAR,
    DESC_ACRESC      DVALOR,
    PESO             DVALOR,
    VOLUME           DVALOR,
    NOME             DNOME
);

CREATE TABLE FAT_NOTAS_PRAZO_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO NOT NULL,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    ICM                DVALOR,
    ICM_SUBS           DVALOR,
    IPI                DVALOR,
    VOLUME             DVALOR,
    PESO               DVALOR,
    DESCONTO           DVALOR,
    PORC_DESC          DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME_PRODUTO       DNOME,
    SUBUNIDADE         DCODIGO,
    TOTAL              DVALOR
);

CREATE TABLE FAT_ORCAMENTOS (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    DATA                 DDATA,
    PESSOA_FJ            DCODIGO,
    USUARIO              DCODIGO,
    VENDEDOR             DCODIGO,
    FORMA_PGTO           DCODIGO,
    OBSERVACAO           DMENSAGEM,
    NOME_CONSUMIDOR      DNOME,
    TOTAL                DVALOR,
    DESC_ACRESC          DVALOR,
    PESO                 DVALOR,
    VOLUME               DVALOR,
    NOME                 DNOME,
    VALIDADE             DDATA,
    TOTAL_2              DVALOR,
    DESC_ACRESC_2        DVALOR,
    CLIENTE              "DVARCHAR(30",
    EXTERNO              DCHAR,
    MASCARA              DCODIGO,
    COMPROMETER_ESTOQUE  DCHAR DEFAULT 'N',
    STATUS               DCODIGO
);

CREATE TABLE FAT_ORCAMENTOS_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO NOT NULL,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    ICM                DVALOR,
    ICM_SUBS           DVALOR,
    IPI                DVALOR,
    VOLUME             DVALOR,
    PESO               DVALOR,
    DESCONTO           DVALOR,
    PORC_DESC          DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME_PRODUTO       DNOME,
    SUBUNIDADE         DCODIGO,
    MARCA              "DVARCHAR(30",
    QUANTIDADE_2       DVALOR,
    MARCA_2            "DVARCHAR(30",
    PRC_UNITARIO_2     DVALOR,
    EXTERNO            DCHAR,
    NOME_MASCARA       DNOME,
    GRUPO_MASCARA      DCODIGO,
    SUB_GRUPO_MASCARA  DCODIGO,
    MASCARA            DCODIGO,
    QTDE_FATURADA      DVALOR,
    COMPLEMENTO        DHISTORICO,
    GRADE              DCHAR4,
    NUMERO             DCHAR6
);

CREATE TABLE FAT_ORCAMENTOS_ITENS_PECAS (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    PRODUTO     DCODIGOPROD NOT NULL,
    SEQUENCIA   DINTEIRO NOT NULL,
    PECA        DINTEIRO NOT NULL,
    QUANTIDADE  DVALOR,
    UNITARIO    DVALOR,
    NOME        DNOME
);

CREATE TABLE FAT_ORCAMENTOS_MASCARA (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    NOME            DNOME,
    GRUPO           DCODIGO,
    SUB_GRUPO       DCODIGO,
    NOME_GRUPO      DNOME,
    NOME_SUB_GRUPO  DNOME,
    AGRUPADOR       DCODIGO
);

CREATE TABLE FAT_ORCAMENTOS_MASCARA_NOME (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE FAT_ORDEM_SERVICO (
    CNPJ       DCNPJ,
    CODIGO     DCODIGO,
    PESSOA_FJ  DCODIGO,
    DATA       DDATA
);

CREATE TABLE FAT_ORDEM_SERVICO_ITENS (
    CNPJ        DCNPJ,
    CODIGO      DCNPJ,
    SERVICO     DCODIGO,
    QUANTIDADE  DVALOR,
    UNITARIO    DVALOR,
    DESCONTO    DVALOR
);

CREATE TABLE FAT_TABELAPRECO (
    CNPJ                      DCNPJ NOT NULL,
    CODIGO                    DCODIGO NOT NULL,
    DESCRICAO                 DCHAR80,
    IDTIPOTABELAPRECO         DCODIGO,
    INICIOVIGENCIA            DATE,
    FIMVIGENCIA               DATE,
    DATAPROJECAO              DATE,
    QTDEDIASTOLALTVENCIMENTO  NUMERIC(18,4)
);

CREATE TABLE FAT_TBL_VD_TABELA (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    COD_TABELA        INTEGER,
    COD_TBL_VENDEDOR  DCODIGO,
    PCT_COMISSAO      DVALOR
);

CREATE TABLE FAT_TBL_VENDEDOR (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    COD_VENDEDOR  INTEGER,
    PCT_COMISSAO  DVALOR
);

CREATE TABLE FAT_TERCEIROS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    COM_VISTA  DPORCENTAGEM,
    COM_PRAZO  DPORCENTAGEM,
    PESSOA_FJ  DCODIGO
);

CREATE TABLE FAT_TIPOTABELAPRECO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  VARCHAR(80)
);

CREATE TABLE FAT_TROCAS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    DATA               DDATA2,
    PESSOA_FJ          DCODIGO,
    USUARIO            DCODIGO,
    VENDEDOR           DCODIGO,
    FORMA_PGTO         DCODIGO,
    OBSERVACAO         DMENSAGEM,
    NOME_CONSUMIDOR    DNOME,
    TOTAL              DVALOR,
    FECHADO            DCHAR,
    DESC_ACRESC        DVALOR,
    PESO               DVALOR,
    VOLUME             DVALOR,
    NOME               DNOME,
    VALIDADE           DDATA,
    TOTAL_2            DVALOR,
    DESC_ACRESC_2      DVALOR,
    CLIENTE            "DVARCHAR(30",
    ENVIADA_CX         DCHAR,
    DATA_CAIXA         DDATA,
    NOME_VENDEDOR      DNOME,
    NOME_FORMA         DNOME,
    ENTRADA            DVALOR,
    TIPO_DOCTO         DCHAR3,
    LOCAL_COBRANCA     DCODIGO,
    VLR_PARC_LC        DVALOR,
    PGTO_AVISTA        DCHAR,
    CONTA_CAIXA        DCODIGO,
    DINHEIRO           DVALOR,
    CARTAO             DVALOR,
    CHEQUE             DVALOR,
    TICKET             DVALOR,
    CANCELADA          DCHAR,
    DATA_CANCELAMENTO  DDATA,
    TURNO              DCODIGO
);

CREATE TABLE FAT_TROCAS_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PRODUTO            DCODIGOPROD NOT NULL,
    SEQUENCIA          DINTEIRO NOT NULL,
    QUANTIDADE         DVALOR,
    PRC_UNITARIO       DVALOR,
    PRC_CUSTO          DVALOR,
    ICM                DVALOR,
    ICM_SUBS           DVALOR,
    IPI                DVALOR,
    VOLUME             DVALOR,
    PESO               DVALOR,
    DESCONTO           DVALOR,
    PORC_DESC          DVALOR,
    UNIDADE            DSIGLAUM,
    PRC_UNIT_ORIGINAL  DVALOR,
    NOME_PRODUTO       DNOME,
    SUBUNIDADE         DCODIGO,
    MARCA              "DVARCHAR(30",
    TIPO               DCHAR,
    NUMERO             DCHAR6,
    GRADE              DCHAR4,
    COM_GERADA         DCHAR,
    CUSTO_MEDIO        DVALOR,
    LUCRO_ITEM         DVALOR,
    SPRODUTO           "DVARCHAR(16)"
);

CREATE TABLE FAT_TROCAS_PARCELAMENTO (
    CNPJ     DCNPJ NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    VENCTO   DDATA NOT NULL,
    PARCELA  DCHAR6,
    VALOR    DVALOR,
    BOLETO   DCODIGO
);

CREATE TABLE FAT_USUARIOS_CAIXA (
    CNPJ              DCNPJ NOT NULL,
    USUARIO           DCODIGO NOT NULL,
    CONTA             DCODIGO NOT NULL,
    TURNO             DCODIGO,
    ATIVO             DCHAR,
    DATA_ATIVACAO     DDATA,
    DATA_DESATIVACAO  DDATA,
    USR_CAIXA_GERAL   DCHAR,
    CAIXA_EXPORADICO  DCHAR,
    CTB_FLUXO_CAIXA   DCHAR
);

CREATE TABLE FAT_VENDAS (
    CNPJ                   DCNPJ NOT NULL,
    CODIGO                 DCODIGO NOT NULL,
    DATA                   DDATA2,
    FECHADA                DCHAR,
    HISTORICO              DHISTORICO,
    PESSOA_FJ              DCODIGO,
    USUARIO                DCODIGO,
    VENDEDOR               DCODIGO,
    NATUREZA               DCODIGO,
    ENVIADA_CX             DCHAR,
    FORMA_PGTO             DCODIGO,
    NUM_NF                 DCODIGO,
    NUM_CUPOM              DCODIGO,
    PROPRIEDADE            DCODIGO,
    CONVENIADO             DCODIGO,
    TIPO_DOCTO             DCHAR3,
    LOCAL_COBRANCA         DCODIGO,
    DESC_ACRES             DVALOR,
    ENTRADA                DVALOR,
    DINHEIRO               DVALOR,
    CHEQUE                 DVALOR,
    CARTAO                 DVALOR,
    TICKET                 DVALOR,
    TOTAL                  DVALOR,
    OBSERVACAO             DVARCHAR600,
    VLR_PARC_LC            DVALOR,
    TERCEIRO               DCODIGO,
    CARGA                  DCODIGO,
    VOLUME                 DVALOR,
    PESO                   DVALOR,
    REQUISICAO             DCHAR6,
    DESCRICAO              DOBS,
    TIPO_VENDA             DCHAR3,
    NOME_CONSUMIDOR        DNOME,
    ORCAMENTO              DCODIGO,
    TROCO                  DVALOR,
    LOCAL                  DCODIGO,
    NOME                   DNOME,
    DATA_CAIXA             DDATA,
    CONTA_CAIXA            DCODIGO,
    CANCELADA              DCHAR,
    TOTAL_NOTA             DVALOR,
    BASE_ICM               DVALOR,
    ICM                    DVALOR,
    BASE_ICM_SUBST         DVALOR,
    VALOR_ICM_SUBST        DVALOR,
    FRETE                  DVALOR,
    SEGURO                 DVALOR,
    DESPESAS               DVALOR,
    IPI                    DVALOR,
    APRAZO                 DVALOR,
    SELECIONADA            DCHAR,
    DUPLICATA              DCODIGO,
    BANCO                  DCHAR3,
    RECEBIDAS              DVALOR,
    CONTROLA_PLACA         DCHAR,
    CONTROLA_KM            DCHAR,
    ASSINA_NOTA            DCHAR,
    KM_ATUAL               DVALOR,
    NOME_PROPRIEDADE       DNOME,
    NOME_VENDEDOR          DNOME,
    NOME_NATUREZA          DNOME,
    NOME_TERCEIRO          DNOME,
    NOME_FORMA             DNOME,
    UF                     DUF,
    VALIDADE               DDATA,
    MEDIA_KM               DVALOR,
    DOCUMENTOS_CONSUMIDOR  DDOCUMENTO,
    ENDERECO_CONSUMIDOR    DDESCRICAO,
    TURNO                  DCODIGO,
    HORA                   DTIME,
    NAO_COBR_JUR_ATE       DCODIGO,
    SERIE                  DCHAR3,
    DESCONTOS_CONCEDIDOS   DVALOR,
    NOME_CONVENIO          DNOME,
    DT_EMISSAO_AGRUPADA    DDATA,
    TRANSPORTADORA         DCODIGO,
    DATA_CANCELAMENTO      DDATA,
    TOTAL_FISCAL           DVALOR,
    CONS_REV               DCONSMUIDOR_REVENDA,
    IRRF                   DVALOR,
    INSS                   DVALOR,
    PIS_COFINS_CSLL        DVALOR,
    ISS                    DVALOR,
    VALE_TROCO             DCHAR,
    CIDADE_CONSUMIDOR      DNOME,
    PGTO_FRETE             DCHAR,
    BAIRRO_CONSUMIDOR      DNOME,
    FONE_CONSUMIDOR        DFONE,
    MESA                   DCODIGO,
    DESCTO_RES             DVALOR,
    COMPROMETER_ESTOQUE    DCHAR,
    ID_AGRUPADOR           DCODIGO,
    DESCTO_ICMS            DVALOR,
    PCT_DESCTO_ICMS        DVALOR,
    NF_AGRUPADA            DCHAR,
    TRP_QTDE               DVALOR,
    TRP_ESPECIE            DNOME,
    TRP_PESO_BRUTO         DVALOR,
    TRP_PESO_LIQUIDO       DVALOR,
    TRP_NUMERO             DNOME,
    TRP_MARCA              DCODIGO,
    TRP_NOME               DNOME,
    STATUS_CARREGAMENTO    DCODIGO,
    ORDEM_CARGA            DCODIGO,
    ENTREGA_FUTURA         DCHAR,
    PCT_COMISSAO           DVALOR,
    CENTRO_CUSTO           DCODIGO,
    ES                     DCHAR,
    GERA_FINANCEIRO        DCHAR,
    NFE_CHAVE              DVARCHAR80,
    NFE_SELECIONADO        DCHAR,
    DT_PREV_ENTREGA        DDATA2,
    COD_INDEXADOR          DCODIGO,
    IDX_DATABASE           DDATA2,
    IDX_COTACAO            DVALOR,
    IDX_QTDE               DVALOR,
    COD_CONFIGTITULO       DCODIGO,
    NFE_VALIDADA           DCHAR,
    NFE_ASSINADA           DCHAR,
    NFE_TRANSMITIDA        DCHAR,
    NFE_AUTORIZADA         DCHAR,
    NFE_DANFE_IMPRESSO     DCHAR,
    CLI_SUB_TRIBUTARIO     DCHAR,
    DT_EMISSAO_NF          DDATA2,
    DT_EMISSAO_CF          DDATA2,
    N_SEQ_ECF              DCHAR3,
    N_SERIE_ECF            DDOCUMENTO,
    NFE_PROTOCOLO          DVARCHAR200,
    NFE_RECIBO             DVARCHAR200,
    NFE_XML                DMN_BLOB_TEXT,
    NFE_CANC_MOTIVO        DVARCHAR200,
    NFE_CANC_STATUS        DVARCHAR80,
    NFE_CANC_PROTOCOLO     DVARCHAR80,
    NFE_CANC_XML           DMN_BLOB_TEXT,
    PLACA                  DPLACA,
    UF_PLACA               DUF,
    BCH_COD_FILIAL         DCODIGO,
    DESCTO_SERVICO         DVALOR,
    SINTEG_VLR_ISENTO      DVALOR,
    SINTEG_VLR_OUTROS      DVALOR,
    SINTEG_VLR_CONTABIL    DVALOR,
    TRP_CIDADE             DNOME,
    TRP_CPF_CNPJ           DCNPJ,
    NFE_NUMERO             DCHAR10
);

CREATE TABLE FAT_VENDAS_COR (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    COR         DCODIGO NOT NULL,
    QUANTIDADE  DVALOR,
    NOME        DNOME,
    PRODUTO     DCODIGOPROD NOT NULL,
    SEQUENCIA   DCODIGO NOT NULL
);

CREATE TABLE FAT_VENDAS_FRMPAGTO (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    FORMA_PGTO      DCODIGO NOT NULL,
    SEQUENCIA       DCODIGO NOT NULL,
    VALOR_ORIGINAL  DVALOR,
    JUROS           DVALOR,
    TIPO_PAGTO      DDESCRICAO,
    NOME_FORMA      DDESCRICAO,
    BANCO           DCHAR3,
    CONTA           DDOCUMENTO,
    DV_CONTA        DCHAR,
    AGENCIA         DCHAR6,
    DV_AGENCIA      DCHAR,
    CHEQUE          DCHAR6,
    DV_CHEQUE       DCHAR,
    AVISTA          DCHAR,
    DATA_CAIXA      DDATA,
    USUARIO_CAIXA   SMALLINT,
    CONTA_CAIXA     DCODIGO,
    TURNO           DCODIGO
);

CREATE TABLE FAT_VENDAS_GARANTIA (
    CNPJ      DCNPJ NOT NULL,
    CODIGO    DCODIGO NOT NULL,
    GARANTIA  DCODIGO NOT NULL
);

CREATE TABLE FAT_VENDAS_ITENS (
    CNPJ                     DCNPJ NOT NULL,
    CODIGO                   DCODIGO NOT NULL,
    PRODUTO                  DCODIGOPROD NOT NULL,
    SEQUENCIA                DINTEIRO NOT NULL,
    QUANTIDADE               DVALOR,
    PRC_UNITARIO             DVALOR,
    PRC_CUSTO                DVALOR,
    ICM                      DVALOR,
    ICM_SUBS                 DVALOR,
    IPI                      DVALOR,
    VOLUME                   DVALOR,
    PESO                     DVALOR,
    DESCONTO                 DVALOR,
    PORC_DESC                DVALOR,
    UNIDADE                  DSIGLAUM,
    PRC_UNIT_ORIGINAL        DVALOR,
    NOME_PRODUTO             DNOME,
    ALIQUOTA                 DCHAR3,
    PRODUTOFIS               DCODIGOPROD,
    NOME_FIS                 DNOME,
    CTE                      DCODIGO,
    CTIE                     DCODIGO,
    ORIGEM                   DCODIGO,
    REDUCAO                  DCODIGO,
    SUBUNIDADE               DCODIGO,
    TOTAL_DIGITADO           DVALOR,
    VENDEDOR                 DCODIGO,
    FRACIONADO               DCHAR,
    MENSAGEM_REDUCAO         DMENSAGEM,
    BASECALCULOICM           DVALOR,
    BASECALCULOSUBSTITUICAO  DVALOR,
    ALIQUOTA_EST             DVALOR,
    ALIQUOTA_INT             DVALOR,
    CFOP                     DCODIGO,
    COMPLEMENTO              DHISTORICO2,
    NOME_VENDEDOR            DCHAR15,
    SERVICO                  DOBS,
    NUMERO                   DCHAR6,
    LINHA_ABASTECIMENTO      DCODIGO,
    CONTADOR_ARQUIVO         DCODIGO,
    GRADE                    DCHAR4,
    QUANTIDADE_FIS           DVALOR,
    PRC_UNITARIO_FIS         DVALOR,
    LOTE                     DCHAR10,
    CODIGO_LOTE              DCODIGO,
    UTILIZA_LOTE             DCHAR,
    COM_GERADA               DCHAR,
    QTDE_ENTREGUE            DVALOR,
    CUSTO_MEDIO              DVALOR,
    LUCRO_ITEM               DVALOR,
    CARREGAR                 DVALOR,
    CARREGADO                DVALOR,
    ENTREGUE                 DVALOR,
    ENTREGAR                 DVALOR,
    DEVOLVER                 DVALOR,
    DEVOLVIDO                DVALOR,
    SPRODUTO                 "DVARCHAR(16)",
    VLR_LUCRO_ITEM           DVALOR,
    ALIQUOTA_ICMS            DVALOR
);

CREATE TABLE FAT_VENDAS_ITENS_COMISSOES (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    COD_ITEM    DCODIGO,
    PRODUTO     DCODIGOPROD,
    SEQUENCIA   DCODIGO,
    PESSOA_FJ   DCODIGO,
    PERCENTUAL  DVALOR,
    TESTE       DHISTORICO
);

CREATE TABLE FAT_VENDAS_PARCELAMENTO (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    VENCTO         DDATA NOT NULL,
    PARCELA        DCHAR6,
    VALOR          DVALOR,
    BOLETO         DCODIGO,
    VALOR_EXTENSO  DVARCHAR200
);

CREATE TABLE FAT_VENDAS_VEICULO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    VEICULO    DCODIGO NOT NULL,
    PLACA      DPLACA,
    KM_ATUAL   DVALOR,
    PESSOA_FJ  DCODIGO
);

CREATE TABLE FAT_VENDEDOR (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    NOME              DNOME,
    COM_VISTA         DPORCENTAGEM,
    COM_PRAZO         DPORCENTAGEM,
    PESSOA_FJ         DCODIGO,
    SENHA             DCHAR6,
    ATIVO             DCHAR,
    COD_PERFIL        DCODIGO,
    COD_PERFIL_PAGTO  DCODIGO
);

CREATE TABLE FAT_VENDEDOR_FAIXAS (
    CNPJ    DCNPJ,
    CODIGO  DCODIGO,
    VALOR   DVALOR,
    VISTA   DVALOR,
    PRAZO   DVALOR
);

CREATE TABLE FIN_ADMINISTRADORA (
    CNPJ            DCNPJ NOT NULL,
    CODIGO          DCODIGO NOT NULL,
    NOME            DNOME,
    DIASREEMBOLSO   DCODIGO,
    TAXA            DVALOR,
    TAXA_PARCELADO  DVALOR,
    TAXA_DEBITO     DVALOR
);

CREATE TABLE FIN_ANALISE_CUSTO (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    PESSOA_FJ   DCODIGO,
    NOME        DNOME,
    TOTAL       DVALOR,
    NOVO_VALOR  DVALOR,
    DATA        DDATA
);

CREATE TABLE FIN_ANALISE_CUSTO_ITENS (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    PRODUTO        DCODIGOPROD NOT NULL,
    NOME           DNOME,
    QUANTIDADE     DVALOR,
    UNITARIO       DVALOR,
    CUSTO          DVALOR,
    NOVO_UNITARIO  DVALOR
);

CREATE TABLE FIN_AVISOS (
    CNPJ      DCODIGO NOT NULL,
    CODIGO    DCODIGO NOT NULL,
    NOME      DNOME,
    NIVEL     DNIVEL,
    SAUDACAO  DNOME,
    MENSAGEM  DOBS
);

CREATE TABLE FIN_BAIXAS_PAGAR (
    CNPJ                DCNPJ NOT NULL,
    CODIGO              DCODIGO NOT NULL,
    ANO                 DANO,
    CODIGO_PG           DCODIGO,
    ANO_PG              DANO,
    USUARIO             DCODIGO,
    DT_BAIXA            DDATA,
    HISTORICO_BX        DHISTORICO,
    VLR_BAIXA           DVALOR,
    JUROS               DVALOR,
    DESCONTOS           DVALOR,
    PLANILHA            DCODIGO,
    TAXA_JUROS          DVALOR,
    TIPO_JUROS          DTIPOJURO,
    PESSOA_FJ           DCODIGO,
    DT_EMISSAO          DDATA,
    DT_VENCTO           DDATA,
    DT_LANCTO           DDATA DEFAULT 'NOW',
    DOCTO               DDOCUMENTO,
    PARCELA             DCHAR6,
    HISTORICO           DHISTORICO,
    VALOR               DVALOR,
    VLR_PARCIAL         DVALOR,
    JUROS_PAG           DVALOR,
    DESCONTOS_PAG       DVALOR,
    BOLETO              DCHAR,
    ORIGEM              DORIGEM,
    CODIGO_ENT          DCODIGO,
    ANO_ENT             DANO,
    AVISO               DCODIGO,
    DT_AVISO            DDATA,
    NOME                DNOME,
    CENTRO_CUSTO        DCODIGO,
    DUPLICATA           DCHAR15,
    CONFERIDA           DCHAR,
    CONTA               DCODIGO,
    TOTAL_ENTRADA       DVALOR,
    TURNO               DCODIGO,
    CONTABILIDADE       DCODIGO,
    CODIGO_VN           DCODIGO,
    COD_INDEXADOR       DCODIGO,
    IDX_DATABASE        DDATA2,
    IDX_COTACAO         DVALOR,
    IDX_QTDE            DVALOR,
    VARIACAO            DVALOR,
    MULTA               DVALOR,
    BX_IDX_QTDE         DVALOR,
    BX_IDX_COTACAO      DVALOR,
    JURO_CALCULADO      DVALOR,
    VARIACAO_CALCULADA  DVALOR,
    MULTA_CALCULADA     DVALOR,
    DESCONTO_CALCULADO  DVALOR,
    COD_ACERTOCONTA     DCODIGO,
    COD_CONFIG_TITULO   DCODIGO,
    COD_EVENTOCONTABIL  DCODIGO,
    ACT_TIPO_BAIXA      DCHAR,
    VLR_ORIG_ALT        DCHAR
);

CREATE TABLE FIN_BAIXAS_RECEBER (
    CNPJ                DCNPJ NOT NULL,
    CODIGO              DCODIGO NOT NULL,
    ANO                 DANO,
    CODIGO_CR           DCODIGO,
    ANO_CR              DANO,
    USUARIO             DCODIGO,
    DT_BAIXA            DDATA,
    HISTORICO_BX        DHISTORICO,
    VLR_BAIXA           DVALOR,
    JUROS               DVALOR,
    DESCONTOS           DVALOR,
    MULTA               DVALOR,
    VARIACAO            DVALOR,
    PLANILHA            DCODIGO,
    TAXA_JUROS          DVALOR,
    TIPO_JUROS          DTIPOJURO,
    PESSOA_FJ           DCODIGO,
    DT_EMISSAO          DDATA,
    DT_VENCTO           DDATA,
    DT_LANCTO           DDATA DEFAULT 'NOW',
    DOCTO               DDOCUMENTO,
    PARCELA             DCHAR6,
    HISTORICO           DHISTORICO,
    VALOR               DVALOR,
    VLR_PARCIAL         DVALOR,
    JUROS_REC           DVALOR,
    DESCONTOS_REC       DVALOR,
    BOLETO              DCHAR,
    ORIGEM              DORIGEM,
    CODIGO_VN           DCODIGO,
    ANO_VN              DANO,
    AVISO               DCODIGO,
    DT_AVISO            DDATA,
    FATURA              DCODIGO,
    NOME                DNOME,
    NUMBOLETO           DCODIGO,
    NUMDUPLICATA        DCODIGO,
    CONTA               DCODIGO,
    TURNO               DCODIGO,
    COBRADOR            DCODIGO,
    LOCAL_COBRANCA      DCODIGO,
    CODIGO_TRC          DCODIGO,
    VLR_ORIG_ALT        DCHAR,
    BAIXA_BLT           DCHAR,
    BLT_NOSSO_NUM       DMN_BIGINT,
    BLT_BANCO           DCODIGO,
    BLT_REM_GERADA      DCHAR,
    VALOR_NOMINAL       DVALOR,
    PGT_FX_CODIGO       DCODIGO,
    PGT_FX_INI          DCODIGO,
    PGT_FX_FIN          DCODIGO,
    PGT_FX_PCT_PAGTO    DVALOR,
    COD_INDEXADOR       DCODIGO,
    IDX_DATABASE        DDATA2,
    IDX_COTACAO         DVALOR,
    IDX_QTDE            DVALOR,
    BX_IDX_QTDE         DVALOR,
    BX_IDX_COTACAO      DVALOR,
    JURO_CALCULADO      DVALOR,
    DESCONTO_CALCULADO  DVALOR,
    VARIACAO_CALCULADA  DVALOR,
    MULTA_CALCULADA     DVALOR,
    COD_ACERTOCONTA     DCODIGO,
    COD_CONFIG_TITULO   DCODIGO,
    COD_EVENTOCONTABIL  DCODIGO,
    ACT_TIPO_BAIXA      DCHAR
);

CREATE TABLE FIN_BANCO (
    CODIGO                  DCHAR3 NOT NULL,
    NOME                    DNOME,
    BOLETO                  DCODIGO,
    GERA_ARQUIVO_MAGNETICO  DCHAR,
    PADRAO_BOLETO           DCHAR,
    CONFIG_CH               DOBS,
    CONFIG_CHEQUE           DMN_BLOB_TEXT
);

CREATE TABLE FIN_CENTRO_CUSTO (
    CNPJ                            DCNPJ NOT NULL,
    CODIGO                          DCODIGO NOT NULL,
    NOME                            DNOME,
    AGRUPADOR                       DCODIGO,
    TIPO_CENTRO                     DCHAR3,
    EXCLUI_DEMOSTRATIVO_FINANCEIRO  DCHAR,
    CMV                             DCHAR DEFAULT 'N'
);

CREATE TABLE FIN_CHEQUES (
    ID                DCODIGO,
    CNPJ              DCNPJ NOT NULL,
    BANCO             DCHAR3 NOT NULL,
    CONTA             DCHAR15 NOT NULL,
    CHEQUE            DCHAR6 NOT NULL,
    VENDA             DCODIGO,
    EMISSAO           DDATA,
    PRE_DATE          DDATA,
    VALOR             DVALOR,
    CONCILIADO        DCHAR,
    PESSOA_FJ         DCODIGO,
    HISTORICO         DHISTORICO,
    AGENCIA           DCHAR6,
    NOME              DNOME,
    DATA_CONCILIACAO  DDATA,
    JUROS             DVALOR,
    MOEDA1            DVALOR,
    MOEDA2            DVALOR,
    TIPO              DTIPO_CHEQUE,
    DATA_ACERTO       DDATA,
    PLANILHA          DCODIGO,
    DIGITO_AGENCIA    DCHAR,
    DIGITO_CHEQUE     DCHAR,
    DATA_DEVOLUCAO    DDATA,
    MOTIVO_DEVOLUCAO  DCODIGO,
    VEZES_DEVOLUCAO   DCODIGO,
    DATA_CAIXA        DDATA,
    USUARIO           DCODIGO,
    COMPENSACAO       DCHAR3,
    DIGITO_CONTA      DCHAR,
    ORIGEM            DCHAR3,
    TURNO             DCODIGO,
    LOCAIS            DCODIGO,
    PROCESSADO        DPROCESSADO,
    EXCLUIDO          DDATA,
    CMC7              DNOME,
    MARCADO           DCHAR,
    CONTA_CONC        DCODIGO,
    USUARIO_CONC      DCODIGO,
    TURNO_CONC        DCODIGO,
    DATA_REMESSA      DDATA,
    DATA_REAPRES      DDATA,
    INDICE            VARCHAR(40),
    TROCA             DCODIGO,
    FORNECEDOR        DCODIGO,
    NOME_FORNECEDOR   DNOME,
    DT_ALT_MANUAL     DDATA,
    COD_MVT_CTB       DCODIGO,
    COD_ACERTOCONTA   DCODIGO
);

CREATE TABLE FIN_COBRADOR (
    CNPJ     DCNPJ NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    NOME     DNOME,
    INTERNO  DCHAR,
    ATIVO    DCHAR
);

CREATE TABLE FIN_COBRANCAS (
    CNPJ           DCNPJ,
    PESSOA_FJ      DCODIGO,
    DATA_COBRANCA  DDATA,
    RECEBER        DCODIGO,
    ORIGEM         DCHAR3,
    MOTIVO         DCODIGO,
    COBRAR_EM      DDATA,
    HISTORICO      DHISTORICO,
    PAGO_EM        DDATA,
    NOME_MOTIVO    DNOME,
    COBRADOR       DCODIGO,
    NOME_COBRADOR  DNOME,
    ANO            DCODIGO,
    SELECIONADO    DCHAR,
    INDICE         DMN_INDICE_COBRANCA,
    DT_INSERT      DDATA,
    HR_COBRAR_EM   DTIME,
    HR_COBRANCA    DTIME
);

CREATE TABLE FIN_COMISSAO_PRODUTO (
    CNPJ      DCNPJ NOT NULL,
    PRODUTO   DCODIGOPROD NOT NULL,
    VENDEDOR  DCODIGO NOT NULL,
    AVISTA    DVALOR,
    APRAZO    DVALOR
);

CREATE TABLE FIN_CONTAS_PAGAR (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    ANO                DANO,
    PESSOA_FJ          DCODIGO,
    DT_EMISSAO         DDATA,
    DT_VENCTO          DDATA,
    DT_LANCTO          DDATA DEFAULT 'NOW',
    DOCTO              DDOCUMENTO,
    PARCELA            DCHAR6,
    HISTORICO          DHISTORICO,
    VALOR              DVALOR,
    VLR_PARCIAL        DVALOR,
    JUROS_PAG          DVALOR,
    DESCONTOS          DVALOR,
    BOLETO             DCHAR,
    ORIGEM             DORIGEM,
    CODIGO_ENT         DCODIGO,
    ANO_ENT            DANO,
    AVISO              DCODIGO,
    DT_AVISO           DDATA,
    SELECIONADO        DCHAR,
    CENTRO_CUSTO       DCODIGO,
    NOME               DNOME,
    DUPLICATA          DCHAR15,
    CONFERIDA          DCHAR,
    MOEDA1             DVALOR,
    MOEDA2             DVALOR,
    TOTAL_ENTRADA      DVALOR,
    PLANILHA           DCODIGO,
    FLUXO_CAIXA        DDATA,
    CONTABILIDADE      DCODIGO,
    DT_ULTIMA_BAIXA    DDATA,
    TIPO_DOCTO         DCHAR3,
    CODIGO_VN          DCODIGO,
    COD_INDEXADOR      DCODIGO,
    IDX_DATABASE       DDATA2,
    IDX_COTACAO        DVALOR,
    IDX_QTDE           DVALOR,
    ACT_TOTAL_PAGAR    DVALOR,
    IDX_VLR_PARCIAL    DVALOR,
    COD_CONFIG_TITULO  DCODIGO,
    VALOR_EXTENSO      DVARCHAR200
);

CREATE TABLE FIN_CONTAS_RECEBER (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    ANO                DANO,
    PESSOA_FJ          DCODIGO,
    DT_EMISSAO         DDATA,
    DT_VENCTO          DDATA,
    DT_LANCTO          DDATA DEFAULT 'NOW',
    DOCTO              DDOCUMENTO,
    PARCELA            DCHAR6,
    HISTORICO          DHISTORICO,
    VALOR              DVALOR,
    VLR_PARCIAL        DVALOR,
    JUROS_REC          DVALOR,
    DESCONTOS          DVALOR,
    ORIGEM             DORIGEM,
    CODIGO_VN          DCODIGO,
    ANO_VN             DANO,
    AVISO              DCODIGO,
    DT_AVISO           DDATA,
    SELECIONADO        DCHAR,
    FATURA             DCODIGO,
    TIPO_DOCTO         DCHAR3,
    NOME               DNOME,
    NUMDUPLICATA       DCODIGO,
    MOEDA1             DVALOR,
    MOEDA2             DVALOR,
    PARCIAL            DVALOR,
    CODIGO_TRC         DCODIGO,
    JUROS_PARCIAL      DVALOR,
    DATA_ULT_BAIXA     DDATA,
    COBRADOR           DCODIGO,
    FLUXO_CAIXA        DDATA,
    LOCAL_COBRANCA     DCODIGO,
    VLR_ORIG_ALT       DCHAR,
    ARQUIVO_MORTO      DCHAR,
    VALOR_NOMINAL      DVALOR,
    COD_INDEXADOR      DCODIGO,
    IDX_DATABASE       DDATA2,
    IDX_COTACAO        DVALOR,
    IDX_QTDE           DVALOR,
    IDX_VLR_PARCIAL    DVALOR,
    ACT_TOTAL_RECEBER  DVALOR,
    COD_CONFIG_TITULO  DCODIGO,
    NDOC               DMN_BIGINT,
    NUMBOLETO          DCODIGO,
    BOLETO             DCHAR,
    BLT_NOSSO_NUM      DCHAR15,
    BLT_BANCO          DCODIGO,
    BLT_NUM_IMP        DINTEIRO,
    BLT_REM_GERADA     DCHAR,
    VALOR_EXTENSO      DVARCHAR200,
    CONTA_CORRENTE     DCODIGO
);

CREATE TABLE FIN_COTACOES (
    CODIGO     DCODIGO NOT NULL,
    DATA       DDATA2,
    VALOR      DMN_DOUBLE,
    COD_MOEDA  DCODIGO
);

CREATE TABLE FIN_FATURAS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    PESSOA_FJ          DCODIGO,
    DATA               DDATA,
    VALOR              DVALOR,
    DESCONTO           DVALOR,
    JUROS              DVALOR,
    VENCIMENTO         DDATA,
    HISTORICO          DHISTORICO,
    NOME               DNOME,
    BAIXADA            DCHAR,
    DUPLICATA          DDESCRICAO,
    BOLETO             DDESCRICAO,
    BANCO              DCHAR3,
    TIPO               DTIPO_FATURA,
    ENVIADA            DCHAR,
    OBS                DDESCRICAO,
    MOEDA1             DVALOR,
    MOEDA2             DVALOR,
    AGRUPADORA         DCODIGO,
    DATA_BAIXA         DDATA,
    USUARIO            DCNPJ,
    VALOR_ORIGINAL     DVALOR,
    BAIXAS_PARCIAIS    DVALOR,
    ULTIMA_BX_PARCIAL  DDATA,
    TURNO              DCODIGO,
    ORIGEM             DCHAR3,
    COBRADOR           DCODIGO,
    CONTA              DCODIGO
);

CREATE TABLE FIN_FATURAS_ADICIONAL (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DOCUMENTO  DDOCUMENTO NOT NULL,
    HISTORICO  DHISTORICO,
    VALOR      DVALOR
);

CREATE TABLE FIN_FATURAS_PARCELAMENTO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    DATA    DDATA NOT NULL,
    VALOR   DVALOR
);

CREATE TABLE FIN_FATURAS_PARCIAL (
    CNPJ                  DCNPJ NOT NULL,
    CODIGO                DCODIGO NOT NULL,
    SEQUENCIA             DCODIGO NOT NULL,
    HISTORICO             DHISTORICO,
    VALOR                 DVALOR,
    DATA_CAIXA            DDATA,
    USUARIO               DCODIGO,
    CONTA                 DCODIGO,
    PLANILHA              DCODIGO,
    VALOR_ANTERIOR        DVALOR,
    JUROS_RECEBIDOS       DVALOR,
    VALOR_ATUAL           DVALOR,
    TURNO                 DCODIGO,
    DESCONTOS_CONCEDIDOS  DVALOR,
    BANCO                 DCODIGO
);

CREATE TABLE FIN_FOLHA_PAGTO (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    PESSOA_FJ   DCODIGO,
    DT_VENCTO   DDATA2,
    DT_EMISSAO  DDATA2,
    NDOCTO      "DVARCHAR(20)",
    VALOR       DVALOR,
    PARCELA     DCHAR4,
    HISTORICO   DHISTORICO,
    TIPO        DCHAR,
    TIPO_MOVTO  DCODIGO,
    NOME        DNOME
);

CREATE TABLE FIN_FOLHA_TIPO_MOVIMENTO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DNOME
);

CREATE TABLE FIN_FORMAS_PAGTO (
    CNPJ                    DCNPJ NOT NULL,
    CODIGO                  DCODIGO NOT NULL,
    NOME                    DNOME,
    ACRESCIMO               DPORCENTAGEM,
    DESCONTO                DPORCENTAGEM,
    NPARCELAS               DCODIGO,
    COMENTRADA              DCHAR,
    INTERVALO               DQTD,
    AVISTA                  DCHAR,
    FATURA_FUTURA           DCHAR,
    FORMA_ECF               DDESCRICAO,
    TIPO_PAGAMENTO          DDESCRICAO,
    ATIVO                   DCHAR,
    INTERVALO_PRE_DEFINIDO  DCHAR,
    VENCTO_FIXO             DCHAR,
    DT_VENCTO_FIXO          DDATA2,
    OUTROS                  DCHAR
);

CREATE TABLE FIN_FORMAS_PAGTO_PARCELAS (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           INTEGER NOT NULL,
    COD_FORMA_PAGTO  INTEGER,
    PARCELA          INTEGER NOT NULL,
    DIAS_VENCIMENTO  INTEGER
);

CREATE TABLE FIN_FUNCIONARIOS (
    CNPJ         DCNPJ NOT NULL,
    PESSOA_FJ    DCODIGO NOT NULL,
    DT_ADMISSAO  DDATA,
    CARGO        DNOME,
    CTPS         DCPFCGC,
    SERIE        DSERIE,
    OBS          DOBS
);

CREATE TABLE FIN_LOCAL_COBRANCA (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    ENDERECO     DNOME,
    FONE         DFONE,
    CIDADE       DNOME,
    UF           DUF,
    CODIGO_SCPC  DCHAR10,
    BAIRRO       DNOME,
    BANCO        DCHAR3
);

CREATE TABLE FIN_MOEDA (
    CODIGO             DCODIGO NOT NULL,
    SIGLA              DCHAR3,
    NOME               DNOME,
    UTILIZA_INDEXADOR  DCHAR
);

CREATE TABLE FIN_MOTIVO_COBRANCA (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE FIN_MOTIVO_DEVOLUCAO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE FIN_MOV_CARTAO_RECEBER (
    MOV_ID                BIGINT NOT NULL,
    ID_FIN_MOVTO_CARTAO   INTEGER,
    ID_FIN_CONTA_RECEBER  INTEGER,
    DATA_MOVTO            INTEGER
);

CREATE TABLE FIN_MOVIMENTO_CARTAO (
    CNPJ              DCNPJ NOT NULL,
    CODIGO            DCODIGO NOT NULL,
    DATA              DDATA,
    USUARIO           DCODIGO,
    CONTA             DCODIGO,
    CPF_CNPJ          DDOCUMENTO,
    CLIENTE           DNOME,
    REEMBOLSO         DDATA,
    ADMINISTRADORA    DCODIGO,
    VALOR             DVALOR,
    NUM_CARTAO        DDOCUMENTO,
    NUM_BANCO         DCHAR3,
    NUM_CONTA         DDOCUMENTO,
    CONCILIADO        DCHAR,
    TIPO_DOC          DCHAR3,
    DOCUMENTO         DDOCUMENTO,
    VENDA             DCODIGO,
    PESSOA_FJ         DCODIGO,
    TIPO              DCHAR3,
    NUM_PARCELAS      DCODIGO,
    TAXA              DVALOR,
    TURNO             DCODIGO,
    DATA_CONCILIACAO  DDATA,
    PROCESSADO        DCHAR,
    CTR_CODIGO        DCODIGO,
    TROCA             DCODIGO,
    PLANILHA          DCODIGO,
    COD_ACERTOCONTA   DCODIGO
);

CREATE TABLE FIN_RECIBOS (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    FAVORECIDO       DNOME,
    DT_VENCTO        DDATA,
    DOCTO            DDOCUMENTO,
    DT_LANCTO        DDATA,
    VALOR            DVALOR,
    HISTORICO        DHISTORICO,
    IMPRESSO         DCHAR,
    CPF_CNPJ         DCNPJ,
    PESSOA_FJ        DCODIGO,
    EMPRESA          DNOME,
    PLANILHA         DCODIGO,
    INTEGRAL         DCHAR,
    DATA             DDATA,
    COD_ACERTOCONTA  DCODIGO
);

CREATE TABLE FIN_RECIBOS_PAGAS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DT_VENCTO  DDATA,
    DOCTO      DDOCUMENTO,
    DT_LANCTO  DDATA,
    VALOR      DVALOR,
    HISTORICO  DHISTORICO,
    IMPRESSO   DCHAR,
    PESSOA_FJ  DCODIGO
);

CREATE TABLE GLO_ATIVIDADES (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_BAIRROS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_CIDADES (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    UF         DUF,
    COD_IBGE   "DVARCHAR(7)",
    COD_IAGRO  DCODIGO
);

CREATE TABLE GLO_CLASSIFICACAO (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    DIG_SENHA  DCHAR
);

CREATE TABLE GLO_CLIENTE_ENDERECO (
    CODIGO            DCODIGO NOT NULL,
    CNPJ              DCNPJ NOT NULL,
    ID_LOGRADOURO     DCODIGO,
    ID_BAIRRO         DCODIGO,
    ID_CIDADE         DCODIGO,
    UF_SIGLA          DUF,
    DATA_INICIAL      DDATA,
    DATA_FINAL        DDATA,
    NUMERO_END        DNUMERO_END,
    ID_REGIOES        DCODIGO,
    ID_CLIENTE        DCODIGO,
    CEP               DCEP,
    ID_TIPO_ENDERECO  DCODIGO,
    COMPLEMENTO       DCHAR80,
    ENDERECO_PADRAO   DCHAR
);

CREATE TABLE GLO_CLIENTES (
    CNPJ                     DCNPJ NOT NULL,
    PESSOA_FJ                DCODIGO NOT NULL,
    COMPRADOR                DNOME,
    FONE                     DFONE,
    CNPJ_VEND                DCNPJ,
    COD_VEND                 DCODIGO,
    CNPJ_FPAGTO              DCNPJ,
    COD_FPAGTO               DCODIGO,
    REQUISICAO               DCHAR,
    DIA_PREF_FAT             DQTD,
    CLASSIF                  DCHAR,
    LIMITE_TEMPO             DQTD,
    LIMITE_CREDITO           DVALOR,
    REFERENCIAS              DOBS,
    OBS                      DOBS,
    BLOQUEADO                DCHAR,
    ULT_VENDEDOR             DCODIGO,
    FREQUENCIA               DFREQUENCIA,
    ATIVIDADE                DCODIGO,
    CEP_TRABALHO             DCEP,
    CIDADE_PAIS              DCODIGO,
    CONJUGE                  DNOME,
    DT_NASC_CONJUGE          DDATA,
    ENDERECO_PAIS            DCODIGO,
    ENDERECO_TRABALHO        DCODIGO,
    FONE_LOCAL_CONJUGE       DFONE,
    FONE_TRABALHO            DFONE,
    LOCAL_TRAB_CONJUGE       DNOME,
    LOCAL_TRABALHO           DNOME,
    MAE                      DNOME,
    PAI                      DNOME,
    RAMAL_FONE_TRAB          DCHAR3,
    RAMAL_LOCAL_CONJUGE      DCHAR3,
    RENDA_MENSAL             DVALOR,
    TEMPO_SERV_CONJUGE       DCHAR10,
    TEMPO_SERVICO            DCHAR10,
    CNPJ_CLASSIF             DCNPJ,
    COD_CLASSIF              DCODIGO,
    PRAZO                    DCODIGO,
    PERIODO_FATURAMENTO      DPERIODO,
    TOLERANCIA_FATURAMENTO   DCODIGO,
    AJUSTE_AUT_FATURAS       DCHAR,
    TAXA_JUROS               DVALOR,
    MEDIA_COMPRAS_MES        DCODIGO,
    NAO_COBR_JUR_ATE         DCODIGO,
    ASSINA_NOTA              DCHAR,
    CONTROLA_PLACA           DCHAR,
    CONTROLA_KM              DCHAR,
    ADMISSAO                 DDATA,
    ADMISSAO_CONJUGE         DDATA,
    NUMERO_TRABALHO          DNUMERO_END,
    LIMITE_RETIRADAS_DIARIA  DVALOR,
    VALOR_MAXIMO_RETIRADA    DVALOR,
    NUMERO_PAIS              DNUMERO_END,
    CHEQUE                   DCHAR,
    ALIQUOTA_DESCONTO        DVALOR,
    OPTANTE_SIMPLES          DCHAR,
    CONS_REV                 DCONSMUIDOR_REVENDA,
    SENHA_PDV                DCHAR6,
    SUB_TRIBUTARIO           DCHAR,
    RET_PIS                  DCHAR,
    RET_INSS                 DCHAR,
    RET_IRRF                 DCHAR,
    BAIRRO                   DCODIGO,
    NEG_N_VEZES              DINTEIRO,
    COMPLEMENTO              DCHAR80
);

CREATE TABLE GLO_CLIENTES_IMAGENS (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    ID_CLIENTE  DCODIGO,
    DESCRICAO   DCHAR80,
    IMAGEM      BLOB SUB_TYPE 1 SEGMENT SIZE 4096
);

CREATE TABLE GLO_CLIENTES_PRODUTOS (
    CNPJ                    DCNPJ NOT NULL,
    CODIGO                  INTEGER NOT NULL,
    COD_PRODUTO             DCODIGOPROD,
    COD_CLIENTE             DCODIGO,
    COD_CONTRATO            DCODIGO,
    NUM_CONTRATO            "DVARCHAR(30",
    DT_INICIO               DDATA,
    DT_FIM                  DDATA,
    ATIVO                   DCHAR,
    TEMPO_RESPOSTA          DCODIGO,
    INFORMACOES             DMN_BLOB_TEXT,
    MEDIA_COPIAS            INTEGER,
    DIAS_RECHAMADO          INTEGER,
    QTDE_COPIAS_PREVENTIVA  INTEGER,
    VALOR_CONTRATO          DVALOR,
    VALOR_COPIA_EXCEDENTE   DVALOR,
    DATA                    DATE,
    GERA_FATURAMENTO        DCHAR,
    GERA_LEITURA            DCHAR,
    FRANQUIA_COPIAS         INTEGER
);

CREATE TABLE GLO_CLIENTES_PRODUTOS_ITENS (
    CNPJ                    DCNPJ NOT NULL,
    CODIGO                  DCODIGO NOT NULL,
    COD_PRODUTO             DCODIGOPROD,
    CONTRATO                DCODIGO,
    DT_ADICAO               DDATA,
    DATA                    DDATA,
    ATIVO                   DCHAR,
    VALOR                   DVALOR,
    QTDE_COPIAS_PREVENTIVA  INTEGER,
    DIAS_RECHAMADO          INTEGER,
    MEDIA_COPIAS            INTEGER,
    TEMPO_RESPOSTA          INTEGER
);

CREATE TABLE GLO_CONTAS_PESSOAS (
    CNPJ        DCNPJ NOT NULL,
    PESSOA_FJ   DCODIGO NOT NULL,
    BANCO       DCHAR3 NOT NULL,
    AGENCIA     DCHAR15 NOT NULL,
    CONTA       DCHAR15 NOT NULL,
    DV_AGENCIA  DCHAR,
    DV_CONTA    DCHAR
);

CREATE TABLE GLO_CONTATOS (
    CODIGO                 DCODIGO NOT NULL,
    IDCLIENTE_RELACIONADO  DCODIGO,
    IDCLIENTE              DCODIGO,
    TIPO_CONTATO           DCODIGO,
    OBSERVACAO             VARCHAR(80),
    CNPJ                   DCNPJ NOT NULL,
    CELULAR                DFONE,
    RESIDENCIAL            DFONE
);

CREATE TABLE GLO_DECLARACAO_VENDA (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    PESSOA_FJ  DCODIGO,
    DATA       DDATA,
    VALOR      DVALOR,
    SERIE      DDOCUMENTO,
    DESCRICAO  DNOME
);

CREATE TABLE GLO_DEPARTAMENTO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_ESTADOS (
    CNPJ        DCNPJ NOT NULL,
    SIGLA       DUF NOT NULL,
    NOME        DNOME,
    MASCARA_IE  DCHAR15,
    COD_IBGE    "DVARCHAR(2)"
);

CREATE TABLE GLO_FORNECEDORES (
    CNPJ                DCNPJ NOT NULL,
    PESSOA_FJ           DCODIGO NOT NULL,
    VENDEDOR            DNOME,
    FONE_VEN            DFONE,
    FINANCEIRO          DNOME,
    FONE_FIN            DFONE,
    REPRESENTANTE       DNOME,
    FONE_REP            DFONE,
    BANCO_C1            DCHAR3,
    AGENCIA_C1          DCHAR6,
    CC_C1               DCHAR15,
    BANCO_C2            DCHAR3,
    AGENCIA_C2          DCHAR6,
    CC_C2               DCHAR15,
    FORMA_PAGTO         DCODIGO,
    CONTABILIDADE       DCODIGO,
    SINCRONIZA_FILIAIS  DCHAR
);

CREATE TABLE GLO_INDICACOES (
    CNPJ         DCNPJ NOT NULL,
    PESSOA_FJ    DCODIGO NOT NULL,
    INDICADO     DCODIGO NOT NULL,
    PORCENTAGEM  DVALOR,
    NOME         DNOME,
    INICIO       DDATA
);

CREATE TABLE GLO_LOGRADOUROS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_MARCA_VEICULOS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_MENSALIDADES (
    CNPJ         DCNPJ NOT NULL,
    PESSOA_FJ    DCODIGO NOT NULL,
    PRODUTO      DCODIGOPROD,
    VALOR        DVALOR,
    FORMA_PAGTO  DCODIGO,
    NATUREZA     DCODIGO,
    VENDEDOR     DCODIGO,
    NOME         DNOME,
    VENCIMENTO   DCODIGO
);

CREATE TABLE GLO_MODELO_PROPRIEDADE (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_PAIS (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    NOME           DNOME,
    SISCOMEX       "DVARCHAR(20)",
    NACIONALIDADE  "DVARCHAR(20)",
    COD_MOEDA      DCODIGO,
    SIGLA          DCHAR6
);

CREATE TABLE GLO_PATRIMONIO (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    NOME          DNOME,
    PLACA         DPLACA,
    DESCRICAO     DOBS,
    DEPARTAMENTO  DCODIGO,
    SERIE         DDESCRICAO
);

CREATE TABLE GLO_PATRIMONIO_GARANTIAS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    SERIE        DDESCRICAO,
    DATA         DDATA NOT NULL,
    PECA         DCODIGO NOT NULL,
    FUNCIONARIO  DCODIGO,
    DESCRICAO    DOBS,
    GARANTIA     DCODIGO
);

CREATE TABLE GLO_PATRIMONIO_SAIDA (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    KM_SAIDA      DVALOR,
    KM_CHEGADA    DVALOR,
    DATA_SAIDA    DDATA,
    DATA_CHEGADA  DDATA,
    HORA_SAIDA    DTIME NOT NULL,
    FUNCIONARIO   DCODIGO,
    DESCRICAO     DOBS
);

CREATE TABLE GLO_PECAS_PATRIMONIO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_PESSOAS_FJ (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    NOME_RAZAO     DNOME,
    FANTASIA       DNOME,
    ATIVIDADE      DCODIGO,
    ENDERECO       DCODIGO,
    NUMERO         DNUMERO_END,
    COMPLEMENTO    DDESCRICAO,
    BAIRRO         DCODIGO,
    CIDADE         DCODIGO,
    UF             DUF,
    CEP            DCEP,
    FONE           DFONE,
    FAX            DFONE,
    CELULAR        DFONE,
    PESSOA         DCHAR,
    CPF_CGC        DCPFCGC,
    RG_IE          "DVARCHAR(20)",
    CONTATO        DDESCRICAO,
    DT_NASCIMENTO  DDATA,
    DT_CADASTRO    DDATA,
    EMAIL          DEMAIL,
    OBS            DOBS,
    INSC_MUNIC     DCHAR15,
    CONVENIO       DCODIGO,
    EMISSOR        DCHAR6,
    CONTATO1       DNOME,
    CONTATO2       DNOME,
    CONTATO3       DNOME,
    ORDEM          DCODIGO,
    REGIAO         DCODIGO,
    NFE_EXP        DCHAR,
    SELECIONADO    DCHAR,
    CODIGO_2       DCODIGO,
    FJ             DCHAR,
    MAP_LAT        DVARCHAR200,
    MAP_LONG       DVARCHAR200
);

CREATE TABLE GLO_PRECOS_ESPECIAIS (
    CNPJ         DCNPJ NOT NULL,
    PESSOA_FJ    DCODIGO NOT NULL,
    PORCENTAGEM  DVALOR,
    PRODUTO      DCHAR15 NOT NULL,
    ORIGINAL     DVALOR,
    RESULTADO    DVALOR
);

CREATE TABLE GLO_PROPRIEDADES (
    CNPJ           DCNPJ NOT NULL,
    PESSOA_FJ      DCODIGO NOT NULL,
    PROPRIEDADE    DCODIGO NOT NULL,
    NOME           DNOME,
    PROPRIETARIO   DNOME,
    IE             DRGIE,
    ENDERECO       DCODIGO,
    COMPLEMENTO    DDESCRICAO,
    CIDADE         DCODIGO,
    UF             DUF,
    CEP            DCEP,
    AREA_TOTAL     DDESCRICAO,
    OBS            DOBS,
    NUMERO         DNUMERO_END,
    BAIRRO         DCODIGO,
    ATIVA          DCHAR,
    TIPO_CONTRATO  DCODIGO,
    MODELO         DCODIGO,
    GARANTIA       DDATA,
    CPF            DDOCUMENTO,
    VENDEDOR       DCODIGO,
    TECNICO        DCODIGO,
    CONTRATO       DDOCUMENTO,
    REGIAO         DINTEIRO
);

CREATE TABLE GLO_REGIOES (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    VENDEDOR   DCODIGO,
    TERCEIRO   DCODIGO,
    DESCRICAO  DHISTORICO,
    TECNICO    DCODIGO
);

CREATE TABLE GLO_TIPO_CONTATO (
    NOME       VARCHAR(50),
    DESCRICAO  VARCHAR(80),
    CODIGO     DCODIGO NOT NULL,
    CNPJ       DCNPJ NOT NULL
);

CREATE TABLE GLO_TIPO_CONTRATO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_TIPO_ENDERECO (
    CODIGO         INTEGER NOT NULL,
    CNPJ           DCNPJ NOT NULL,
    TIPO_ENDERECO  DNOME
);

CREATE TABLE GLO_TIPO_VEICULOS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE GLO_TIPOS_DOCTO (
    CNPJ           DCNPJ NOT NULL,
    SIGLA          DCHAR3 NOT NULL,
    NOME           DNOME,
    BLT            DCHAR,
    CODIGO_FISCAL  DCHAR4
);

CREATE TABLE GLO_TRANSPORTADORAS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    PLACA        DPLACA,
    UF           DUF,
    CPF_CNPJ     DCPFCGC,
    ENDERECO     DNOME,
    CIDADE       DNOME,
    IE           DRGIE,
    NFE_EXP      DCHAR,
    SELECIONADO  DCHAR
);

CREATE TABLE GLO_VEICULOS (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    PESSOA_FJ      DCODIGO NOT NULL,
    TIPO_VEICULO   DCODIGO,
    MARCA_VEICULO  DCODIGO,
    MODELO         DNOME,
    PLACA          DPLACA,
    KM_ATUAL       DVALOR,
    COMBUSTIVEL    DCODIGOPROD,
    MEDIA_KM       DVALOR,
    ATIVO          DCHAR,
    MOTORISTA      DNOME,
    N_CHASSI       DNOME,
    COR            DNOME,
    ANO            DINTEIRO
);

CREATE TABLE IBE$LOG_BLOB_FIELDS (
    LOG_TABLES_ID   INTEGER,
    FIELD_NAME      VARCHAR(31),
    OLD_CHAR_VALUE  VARCHAR(32000),
    NEW_CHAR_VALUE  VARCHAR(32000),
    OLD_BLOB_VALUE  BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    NEW_BLOB_VALUE  BLOB SUB_TYPE 0 SEGMENT SIZE 80
);

CREATE TABLE IBE$LOG_FIELDS (
    LOG_TABLES_ID  INTEGER,
    FIELD_NAME     VARCHAR(31),
    OLD_VALUE      VARCHAR(255),
    NEW_VALUE      VARCHAR(255)
);

CREATE TABLE IBE$LOG_KEYS (
    LOG_TABLES_ID  INTEGER,
    KEY_FIELD      VARCHAR(31),
    KEY_VALUE      VARCHAR(255)
);

CREATE TABLE IBE$LOG_TABLES (
    ID          INTEGER NOT NULL,
    TABLE_NAME  VARCHAR(31),
    OPERATION   VARCHAR(1),
    DATE_TIME   DATE,
    USER_NAME   VARCHAR(31)
);

CREATE TABLE IBE$PARAMS_HISTORY (
    IBE$PH_PROCEDURE_NAME  VARCHAR(837) CHARACTER SET UNICODE_FSS,
    IBE$PH_PARAMS          BLOB SUB_TYPE 0 SEGMENT SIZE 80
);

CREATE TABLE LOG_FAT_VENDAS (
    ID                     DCODIGO NOT NULL,
    ID_NEXT                DCODIGO,
    CNPJ                   DCNPJ,
    CODIGO                 DCODIGO,
    DATA                   DDATA2,
    FECHADA                DCHAR,
    HISTORICO              DHISTORICO,
    PESSOA_FJ              DCODIGO,
    USUARIO                DCODIGO,
    VENDEDOR               DCODIGO,
    NATUREZA               DCODIGO,
    ENVIADA_CX             DCHAR,
    FORMA_PGTO             DCODIGO,
    NUM_NF                 DCODIGO,
    NUM_CUPOM              DCODIGO,
    PROPRIEDADE            DCODIGO,
    CONVENIADO             DCODIGO,
    TIPO_DOCTO             DCHAR3,
    LOCAL_COBRANCA         DCODIGO,
    DESC_ACRES             DVALOR,
    ENTRADA                DVALOR,
    DINHEIRO               DVALOR,
    CHEQUE                 DVALOR,
    CARTAO                 DVALOR,
    TICKET                 DVALOR,
    TOTAL                  DVALOR,
    OBSERVACAO             DVARCHAR200,
    VLR_PARC_LC            DVALOR,
    TERCEIRO               DCODIGO,
    CARGA                  DCODIGO,
    VOLUME                 DVALOR,
    PESO                   DVALOR,
    REQUISICAO             DCHAR6,
    DESCRICAO              DOBS,
    TIPO_VENDA             DCHAR3,
    NOME_CONSUMIDOR        DNOME,
    ORCAMENTO              DCODIGO,
    TROCO                  DVALOR,
    LOCAL                  DCODIGO,
    NOME                   DNOME,
    DATA_CAIXA             DDATA,
    CONTA_CAIXA            DCODIGO,
    CANCELADA              DCHAR,
    TOTAL_NOTA             DVALOR,
    BASE_ICM               DVALOR,
    ICM                    DVALOR,
    BASE_ICM_SUBST         DVALOR,
    VALOR_ICM_SUBST        DVALOR,
    FRETE                  DVALOR,
    SEGURO                 DVALOR,
    DESPESAS               DVALOR,
    IPI                    DVALOR,
    APRAZO                 DVALOR,
    SELECIONADA            DCHAR,
    DUPLICATA              DCODIGO,
    BANCO                  DCHAR3,
    RECEBIDAS              DVALOR,
    CONTROLA_PLACA         DCHAR,
    CONTROLA_KM            DCHAR,
    ASSINA_NOTA            DCHAR,
    KM_ATUAL               DVALOR,
    NOME_PROPRIEDADE       DNOME,
    NOME_VENDEDOR          DNOME,
    NOME_NATUREZA          DNOME,
    NOME_TERCEIRO          DNOME,
    NOME_FORMA             DNOME,
    UF                     DUF,
    VALIDADE               DDATA,
    MEDIA_KM               DVALOR,
    DOCUMENTOS_CONSUMIDOR  DDOCUMENTO,
    ENDERECO_CONSUMIDOR    DDESCRICAO,
    TURNO                  DCODIGO,
    HORA                   DTIME,
    NAO_COBR_JUR_ATE       DCODIGO,
    SERIE                  DCHAR3,
    DESCONTOS_CONCEDIDOS   DVALOR,
    NOME_CONVENIO          DNOME,
    DT_EMISSAO_AGRUPADA    DDATA,
    TRANSPORTADORA         DCODIGO,
    DATA_CANCELAMENTO      DDATA,
    TOTAL_FISCAL           DVALOR,
    CONS_REV               DCONSMUIDOR_REVENDA,
    IRRF                   DVALOR,
    INSS                   DVALOR,
    PIS_COFINS_CSLL        DVALOR,
    ISS                    DVALOR,
    VALE_TROCO             DCHAR,
    CIDADE_CONSUMIDOR      DNOME,
    PGTO_FRETE             DCHAR,
    BAIRRO_CONSUMIDOR      DNOME,
    FONE_CONSUMIDOR        DFONE,
    MESA                   DCODIGO,
    DESCTO_RES             DVALOR,
    COMPROMETER_ESTOQUE    DCHAR,
    ID_AGRUPADOR           DCODIGO,
    DESCTO_ICMS            DVALOR,
    PCT_DESCTO_ICMS        DVALOR,
    NF_AGRUPADA            DCHAR,
    TRP_QTDE               DVALOR,
    TRP_ESPECIE            DNOME,
    TRP_PESO_BRUTO         DVALOR,
    TRP_PESO_LIQUIDO       DVALOR,
    TRP_NUMERO             DNOME,
    TRP_MARCA              DCODIGO,
    TRP_NOME               DNOME,
    STATUS_CARREGAMENTO    DCODIGO,
    ORDEM_CARGA            DCODIGO,
    ENTREGA_FUTURA         DCHAR,
    PCT_COMISSAO           DVALOR,
    CENTRO_CUSTO           DCODIGO,
    ES                     DCHAR,
    GERA_FINANCEIRO        DCHAR,
    NFE_CHAVE              DVARCHAR80,
    NFE_SELECIONADO        DCHAR,
    LOG_USUARIO            DCODIGO,
    LOG_DATA               DDATA,
    LOG_HORA               DTIME,
    LOG_OPERACAO           "DVARCHAR(20)"
);

CREATE TABLE NFE_XML_LOG (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    COD_FATURAMENTO  DCODIGO,
    DATA             DDATA2,
    HORA             DTIME,
    XML              DMN_BLOB_TEXT,
    USUARIO          DCODIGO
);

CREATE TABLE OFC_CONTRATOS (
    CNPJ                   DCNPJ NOT NULL,
    CODIGO                 INTEGER NOT NULL,
    COD_CLIENTE            DCODIGO,
    COD_CONTRATO           DCODIGO,
    NUM_CONTRATO           "DVARCHAR(30",
    DT_INICIO              DDATA,
    DT_FIM                 DDATA,
    ATIVO                  DCHAR,
    INFORMACOES            DMN_BLOB_TEXT,
    VALOR_CONTRATO         DVALOR,
    VALOR_COPIA_EXCEDENTE  DVALOR,
    DATA                   DATE,
    GERA_FATURAMENTO       DCHAR,
    GERA_LEITURA           DCHAR,
    FRANQUIA_COPIAS        INTEGER,
    DIA_BASE               DINTEIRO,
    GERA_MENSALIDADE       DCHAR
);

CREATE TABLE OFC_CONTRATOS_ITENS (
    CNPJ                    DCNPJ NOT NULL,
    CODIGO                  DCODIGO NOT NULL,
    COD_PRODUTO             DCODIGOPROD,
    CONTRATO                DCODIGO,
    DT_ADICAO               DDATA,
    DT_RETIRADA             DDATA2,
    DATA                    DDATA,
    ATIVO                   DCHAR,
    VALOR                   DVALOR,
    QTDE_COPIAS_PREVENTIVA  INTEGER,
    DIAS_RECHAMADO          INTEGER,
    MEDIA_COPIAS            INTEGER,
    TEMPO_RESPOSTA          INTEGER,
    INFORMACOES_ITENS       DMN_BLOB_TEXT,
    COD_INDEXADOR           DCODIGO,
    DT_VIGENCIA_INICIAL     DDATA2,
    DT_VIGENCIA_FINAL       DDATA2,
    GERA_LEITURA            DCHAR
);

CREATE TABLE OFC_CONTRATOS_ITENS_DESC (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    COD_ITEM             DCODIGO,
    VALOR                DVALOR,
    DT_VIGENCIA_INICIAL  DDATA2,
    DT_VIGENCIA_FINAL    DDATA2
);

CREATE TABLE OFC_CTRL_QUALIDADE (
    CNPJ                       DCNPJ NOT NULL,
    CODIGO                     DCODIGO NOT NULL,
    VIRABREQUIM                DCHAR15,
    MEDIDA_MANCAL              DCHAR15,
    MEDIDA_BIELA               DCHAR15,
    FOLGA_AXIAL_VIRABREQUIM    DCHAR15,
    CABECOTE                   DCHAR15,
    ALTURA_CABECOTE            DCHAR15,
    ALTURA_VALV_ADMISSAO       DCHAR15,
    ALTURA_VALV_ESCAPE         DCHAR15,
    BLOCO                      DCHAR15,
    FOLGA_CILINDRO             DCHAR15,
    FOLGA_RADIAL_BLOCO         DCHAR15,
    BIELA                      DCHAR15,
    FOLGA_RADIAL_BIELA         DCHAR15,
    FOLGA_PINO                 DCHAR15,
    FOLGA_AXIAL_BIELA          DCHAR15,
    AJUSTADO                   DCHAR15,
    TORQUE_MANCAL              DCHAR15,
    TORQUE_BIELA               DCHAR15,
    ALTURA_PISTAO              DCHAR15,
    MONTADOR                   DCODIGO,
    NOME_MONTADOR              DNOME,
    OBSERVACAO                 DOBS,
    MONTADOR_VIRABREQUIM       DCODIGO,
    NOME_MONTADOR_VIRABREQUIM  DNOME,
    MONTADOR_CABECOTE          DCODIGO,
    NOME_MONTADOR_CABECOTE     DNOME,
    MONTADOR_BLOCO             DCODIGO,
    NOME_MONTADOR_BLOCO        DNOME,
    MONTADOR_BIELA             DCODIGO,
    NOME_MONTADOR_BIELA        DNOME,
    MONTADOR_AJUSTE            DCODIGO,
    NOME_MONTADOR_AJUSTE       DNOME
);

CREATE TABLE OFC_DEFEITO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE OFC_GRAVIDADE (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DCHAR80,
    TITULO     "DVARCHAR(30"
);

CREATE TABLE OFC_GRP_CONTRATOS (
    CNPJ                   DCNPJ NOT NULL,
    CODIGO                 INTEGER NOT NULL,
    COD_CLIENTE            DCODIGO,
    COD_CONTRATO           DCODIGO,
    NUM_CONTRATO           "DVARCHAR(30",
    DT_INICIO              DDATA,
    DT_FIM                 DDATA,
    ATIVO                  DCHAR,
    INFORMACOES            DMN_BLOB_TEXT,
    VALOR_CONTRATO         DVALOR,
    VALOR_COPIA_EXCEDENTE  DVALOR,
    DATA                   DATE,
    GERA_FATURAMENTO       DCHAR,
    GERA_LEITURA           DCHAR,
    FRANQUIA_COPIAS        INTEGER,
    DIA_BASE               DINTEIRO,
    GERA_MENSALIDADE       DCHAR
);

CREATE TABLE OFC_GRP_CONTRATOS_ITENS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    COD_GRUPO  DCODIGO,
    DATA       DDATA,
    ATIVO      DCHAR,
    PESSOA_FJ  DCODIGO
);

CREATE TABLE OFC_LEITURAS (
    CNPJ                        DCNPJ NOT NULL,
    CODIGO                      DCODIGO NOT NULL,
    CONTRATO                    DCODIGO,
    DATA_REFERENCIA             DATE,
    DATA                        DDATA2,
    FECHADA                     DCHAR,
    GERA_FATURAMENTO            DCHAR,
    TOTAL_COPIAS                INTEGER,
    COPIAS_EXCESSO              INTEGER,
    VALOR_LEITURA               DVALOR,
    CTR_VALOR                   DVALOR,
    CTR_FRANQUIA                DCODIGO,
    CTR_VALOR_COPIA_EXCEDENTE   DVALOR,
    VENDA                       DCODIGO,
    DESC_ACRESC_CP              DCODIGO,
    VALOR_TOTAL_COPIAS_EXCENTE  DVALOR,
    OBSERVACAO                  DMN_BLOB_TEXT,
    PERIODO                     DHISTORICO
);

CREATE TABLE OFC_LEITURAS_ITENS (
    CNPJ                       DCNPJ NOT NULL,
    CODIGO                     DCODIGO NOT NULL,
    LEITURA                    DCODIGO,
    COD_ITEM_CONTRATO          DCODIGO,
    ULTIMA_LEITURA             INTEGER,
    LEITURA_ATUAL              INTEGER,
    SALDO_LEITURA              INTEGER,
    COD_CLIENTE                DCODIGO,
    TESTE                      DNOME,
    CTR_VALOR                  DVALOR DEFAULT 0,
    CTR_FRANQUIA               DCODIGO,
    CTR_VALOR_COPIA_EXCEDENTE  DVALOR DEFAULT 0,
    HISTORICO                  DHISTORICO
);

CREATE TABLE OFC_LOG_STATUS (
    ID           DCODIGO NOT NULL,
    CNPJ         DCNPJ,
    OLD_STATUS   DCODIGO,
    NEW_STATUS   DCODIGO,
    USUARIO      DCODIGO,
    DATA         DDATA,
    HORA         DTIME,
    COD_ORDEM    DCODIGO,
    COD_CLIENTE  DCODIGO
);

CREATE TABLE OFC_MECANICOS (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DNOME,
    COM_VISTA    DPORCENTAGEM,
    COM_PRAZO    DPORCENTAGEM,
    PESSOA_FJ    DCODIGO,
    SENHA        DCHAR6,
    CREA         "DVARCHAR(20)",
    CTPS         "DVARCHAR(20)",
    EMAIL        DMENSAGEM,
    CUSTO_HORA   DVALOR,
    COD_USUARIO  DCODIGO,
    ASSINATURA   DMN_BLOB_TEXT
);

CREATE TABLE OFC_MENSALIDADES (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    CONTRATO           DCODIGO,
    DATA_REFERENCIA    DATE,
    DATA               DDATA2,
    FECHADA            DCHAR,
    GERA_FATURAMENTO   DCHAR,
    VALOR_MENSALIDADE  DVALOR,
    CTR_VALOR          DVALOR,
    FATURAMENTO        DCODIGO,
    SELECIONADO        DCHAR
);

CREATE TABLE OFC_MENSALIDADES_ITENS (
    CNPJ               DCNPJ NOT NULL,
    CODIGO             DCODIGO NOT NULL,
    COD_MENSALIDADE    DCODIGO,
    COD_ITEM_CONTRATO  DCODIGO,
    VALOR              DVALOR
);

CREATE TABLE OFC_MOTIVO_CHAMADO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE OFC_MOTORES (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    NOME         DMENSAGEM,
    TIPO         DCHAR10,
    CILINDROS    DCHAR15,
    COMBUSTIVEL  "DVARCHAR(30"
);

CREATE TABLE OFC_MOTORES_SERVICOS (
    CNPJ          DCNPJ NOT NULL,
    MOTOR         DCODIGO NOT NULL,
    SERVICO       DCODIGO NOT NULL,
    NOME_SERVICO  DNOME,
    ATIVO         DCHAR,
    VALOR         DVALOR
);

CREATE TABLE OFC_O_S_INTERVALO_EMAIL (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    ASSUNTO        DMENSAGEM,
    DE             DMENSAGEM,
    PARA           DVARCHAR200,
    ENVIADO        DCHAR,
    SEQUENCIA      INTEGER,
    COD_INTERVALO  INTEGER,
    DATA           DDATA,
    TIPO           DCHAR
);

CREATE TABLE OFC_ORDEM_SERVICO (
    CNPJ                        DCNPJ NOT NULL,
    CODIGO                      DCODIGO NOT NULL,
    DATA                        DDATA,
    PESSOA_FJ                   DCODIGO,
    NOME                        DNOME,
    NATUREZA                    DCODIGO,
    MECANICO                    DCODIGO,
    VIAJANTE                    DCODIGO,
    ENTRADA                     DDATA,
    HR_ENTRADA                  DTIME,
    HISTORICO                   DHISTORICO,
    CHASSI                      DDESCRICAO,
    INFORMACOES                 DOBS,
    TOTAL                       DVALOR,
    DESC_ACRESC                 DVALOR,
    CLIENTE                     DNOME,
    FECHADO                     DCHAR,
    NOME_NATUREZA               DNOME,
    NOME_MECANICO               DNOME,
    NOME_VIAJANTE               DNOME,
    MOTOR                       DCODIGO,
    NOME_MOTOR                  DNOME,
    ENVIADA_CAIXA               DCHAR,
    PLACA                       DPLACA,
    DATA_FECHAMENTO             DDATA,
    HR_FECHAMENTO               DTIME,
    OBS_FECHAMENTO              DOBS,
    FORMA_PAGTO                 DCODIGO,
    NOME_FORMA                  DNOME,
    TIPO_DOCTO                  DCHAR3,
    LOCAL_COBRANCA              DCODIGO,
    VLR_PARC_LC                 DVALOR,
    VLR_ENTRADA                 DVALOR,
    CREDITOS                    DVALOR,
    DEBITOS                     DVALOR,
    NF                          DCODIGO,
    ALIQUOTA_ISS                DVALOR,
    ORCAMENTO                   DCODIGO,
    MED_VIRABREQUIM             DDOCUMENTO,
    MED_BIELA                   DDOCUMENTO,
    MED_CILINDRO                DDOCUMENTO,
    MED_CARCACA                 DDOCUMENTO,
    NUMERO_VENDA                DCODIGO,
    DEFEITO_RECLAMADO           DCODIGO,
    CONDICAO_FINAL_EQUIPAMENTO  DNOME,
    HORA_CHEGADA                DTIME,
    HORA_SAIDA                  DTIME,
    CONTADOR_TOTAL              DVALOR,
    CONTADOR_CILINDRO           DVALOR,
    CONTADOR_REVELADOR          DVALOR,
    NOME_DEFEITO                DNOME,
    PROPRIEDADE                 DCODIGO,
    NOME_PROPRIEDADE            DNOME,
    CAUSA_CHAMADO               DVARCHAR200,
    TIPO_ATENDIMENTO            DNOME,
    CONTADOR_COR                DVALOR,
    CONTADOR_PRETO              DVALOR,
    CONTADOR_IMPRESSAO          DVALOR,
    VENDA                       DCODIGO,
    PRODUTO                     DCODIGOPROD,
    ID_MOTIVO_CHAMADO           DCODIGO,
    ID_TIPO_ATENDIMENTO         DCODIGO,
    COD_STATUS                  DCODIGO,
    DT_ATRIBUICAO               DDATA,
    HR_ATRIBUICAO               DTIME,
    DT_INICIALIZACAO            DDATA,
    HR_INICIALIZACAO            DTIME,
    DT_FINALIZACAO              DDATA,
    HR_FINALIZACAO              DTIME,
    CT_REVELADOR                DCODIGO,
    DT_REVELADOR                DDATA,
    DT_CILINDRO                 DDATA,
    CT_CILINDRO                 DCODIGO,
    KM_INICIAL                  DVALOR,
    KM_FINAL                    DVALOR,
    OS_RECHAMADO                DCODIGO,
    KM_RODADO                   DVALOR,
    HORAS_TRABALHADAS           DVALOR,
    TEMPO_RESPOSTA              DVALOR,
    TIPO_TECNICO                DCHAR,
    PREVENTIVO                  DCHAR,
    ID_CONTRATO                 DCODIGO,
    COD_CONTATO                 DCODIGO,
    PRIORIDADE                  DCODIGO,
    CUSTO_OS                    DVALOR,
    CONTROLE                    DCODIGO,
    ASSUNTO                     DVARCHAR200,
    VEICULO                     DCODIGO,
    KM                          DCODIGO,
    PROTOCOLO                   DCHAR15,
    COD_GRAVIDADE               DCODIGO,
    MAP_LAT                     DVARCHAR200,
    MAP_LONG                    DVARCHAR200,
    TAG                         DCHAR
);

CREATE TABLE OFC_ORDEM_SERVICO_INTERVALO (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    SEQUENCIA        DCODIGO NOT NULL,
    DT_INICIO        DDATA2,
    HR_INICIO        DTIME,
    DT_FIM           DDATA2,
    HR_FIM           DTIME,
    QTDE_HORA        DVALOR,
    OBSERVACAO       DMENSAGEM,
    KM_RODADO        DVALOR,
    KM_INICIAL       DVALOR,
    KM_FINAL         DVALOR,
    TEMPO_VIAJEM     DVALOR,
    MSG              DCHAR,
    USUARIO          DCODIGO,
    COD_TECNICO      DCODIGO,
    CUSTO_INTERVALO  DVALOR,
    CUSTO_HORA       DVALOR,
    TIPO             DCHAR,
    DT_LANCTO        DDATA2,
    DT_VENCTO        DDATA2,
    DT_CONCLUSAO     DDATA2,
    COD_STATUS       DCODIGO,
    COD_CONTATO      DCODIGO,
    COD_VEICULO      DPLACA,
    COD_TIPO_MOVTO   DCODIGO,
    OBSERVACAO2      DMN_BLOB_TEXT
);

CREATE TABLE OFC_ORDEM_SERVICO_MOVIMENTO (
    CNPJ          DCNPJ NOT NULL,
    CODIGO        DCODIGO NOT NULL,
    SEQUENCIA     DCODIGO NOT NULL,
    VALOR         DVALOR,
    HISTORICO     DOBS,
    TIPO          DCHAR,
    DATA          DDATA,
    TIPO_DESPESA  DCHAR3
);

CREATE TABLE OFC_ORDEM_SERVICO_ORC (
    CNPJ                 DCNPJ NOT NULL,
    CODIGO               DCODIGO NOT NULL,
    DATA                 DDATA,
    PESSOA_FJ            DCODIGO,
    NOME                 DNOME,
    NATUREZA             DCODIGO,
    MECANICO             DCODIGO,
    VIAJANTE             DCODIGO,
    ENTRADA              DDATA,
    HISTORICO            DHISTORICO,
    CHASSI               DDESCRICAO,
    INFORMACOES          DOBS,
    TOTAL                DVALOR,
    DESC_ACRESC          DVALOR,
    CLIENTE              DNOME,
    FECHADO              DCHAR,
    NOME_NATUREZA        DNOME,
    NOME_MECANICO        DNOME,
    NOME_VIAJANTE        DNOME,
    MOTOR                DCODIGO,
    NOME_MOTOR           DNOME,
    ENVIADA_CAIXA        DCHAR,
    KM_ATUAL_FECHAMENTO  DVALOR,
    PLACA                DPLACA,
    DATA_FECHAMENTO      DDATA,
    OBS_FECHAMENTO       DOBS,
    FORMA_PAGTO          DCODIGO,
    NOME_FORMA           DNOME,
    TIPO_DOCTO           DCHAR3,
    LOCAL_COBRANCA       DCODIGO,
    VLR_PARC_LC          DVALOR,
    VLR_ENTRADA          DVALOR,
    CREDITOS             DVALOR,
    DEBITOS              DVALOR,
    VALIDADE             DDATA,
    NUMERO_ORDEM         DCODIGO,
    NUMERO_VENDA         DCODIGO
);

CREATE TABLE OFC_ORDEM_SERVICO_PARCELAMENTO (
    CNPJ     DCNPJ NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    VENCTO   DDATA NOT NULL,
    PARCELA  DCHAR6,
    VALOR    DVALOR,
    BOLETO   DCODIGO
);

CREATE TABLE OFC_ORDEM_SERVICO_SERVICO (
    CNPJ            DCNPJ,
    CODIGO          DCODIGO,
    PRODUTO         DCODIGOPROD,
    SERVICO         DCODIGO,
    NOME            DNOME,
    QUANTIDADE      DVALOR,
    UNITARIO        DVALOR,
    SELECIONADO     DCHAR,
    CODIGO_TECNICO  DCODIGO
);

CREATE TABLE OFC_ORDEM_SERVICO_SERVICO_ORC (
    CNPJ         DCNPJ NOT NULL,
    CODIGO       DCODIGO NOT NULL,
    SERVICO      DCODIGO NOT NULL,
    NOME         DNOME,
    QUANTIDADE   DVALOR,
    UNITARIO     DVALOR,
    SELECIONADO  DCHAR
);

CREATE TABLE OFC_OS_ANEXOS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    FILENAME   DMENSAGEM NOT NULL,
    ANEXO      BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    SEQUENCIA  DCODIGO,
    TAMANHO    DVALOR
);

CREATE TABLE OFC_PENDENCIA (
    CODIGO           DCODIGO NOT NULL,
    CNPJ             DCNPJ NOT NULL,
    PRODUTO          DCODIGOPROD,
    QTDE_PENDENTE    DVALOR,
    QTDE_CREDITADA   DVALOR,
    ST_SERVICO       DNOME,
    ST_PEDIDO        DNOME,
    OS_VINCULADA     DCODIGO,
    USR_ESTOQUE      DCODIGO,
    USR_RESPONSAVEL  DCODIGO,
    DT_PENDENCIA     DDATA,
    OBS              DOBS
);

CREATE TABLE OFC_SERVICOS (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME,
    VALOR   DVALOR
);

CREATE TABLE OFC_STATUS (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    COR        DCODIGO,
    FECHADO    DCHAR,
    OS         DCHAR,
    MOVIMENTO  DCHAR
);

CREATE TABLE OFC_TIPO_ATENDIMENTO (
    CNPJ     DCNPJ NOT NULL,
    CODIGO   DCODIGO NOT NULL,
    NOME     DNOME,
    RETORNO  DCHAR
);

CREATE TABLE OFC_TIPO_MOVTO (
    CNPJ    DCNPJ NOT NULL,
    CODIGO  DCODIGO NOT NULL,
    NOME    DNOME
);

CREATE TABLE OFC_VIAJANTES (
    CNPJ       DCNPJ NOT NULL,
    CODIGO     DCODIGO NOT NULL,
    NOME       DNOME,
    COM_VISTA  DPORCENTAGEM,
    COM_PRAZO  DPORCENTAGEM,
    PESSOA_FJ  DCODIGO,
    SENHA      DCHAR6
);

CREATE TABLE PST_VENDEDOR_CAIXA (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    CONTA_DIFERENCA  DCODIGO,
    CONTA_DESCONTOS  DCODIGO,
    VENDEDOR         DCODIGO
);

CREATE TABLE SIS_BOLETOBANCARIO (
    CNPJ                 DCNPJ NOT NULL,
    BANCO                DCHAR3 NOT NULL,
    VENCIMENTO_DST       DCODIGO,
    VENCIMENTO_ALT       DCODIGO,
    DATA_DST             DCODIGO,
    DATA_ALT             DCODIGO,
    DOCUMENTO_DST        DCODIGO,
    DOCUMENTO_ALT        DCODIGO,
    ESPECIE_DST          DCODIGO,
    ESPECIE_ALT          DCODIGO,
    ACEITE_DST           DCODIGO,
    ACEITE_ALT           DCODIGO,
    DTPROCESSAMENTO_DST  DCODIGO,
    DTPROCESSAMENTO_ALT  DCODIGO,
    VALOR_DST            DCODIGO,
    VALOR_ALT            DCODIGO,
    INSTRUCOES_DST       DCODIGO,
    INSTRUCOES_ALT       DCODIGO,
    SACADO_DST           DCODIGO,
    SACADO_ALT           DCODIGO,
    TAMANHOPAGINA        DCODIGO,
    CIDADE_DST           DCODIGO,
    CIDADE_ALT           DCODIGO,
    PORTA_IMPRESSORA     DNOME,
    LPP                  DCODIGO
);

CREATE TABLE SIS_CONF_CHEQUE (
    CONTA       DCODIGO NOT NULL,
    VALORALT    DCODIGO,
    VALORDST    DCODIGO,
    EXTENSOALT  DCODIGO,
    EXTENSODST  DCODIGO,
    FAVALT      DCODIGO,
    FAVDST      DCODIGO,
    CIDALT      DCODIGO,
    CIDDST      DCODIGO,
    DIAALT      DCODIGO,
    DIADST      DCODIGO,
    MESALT      DCODIGO,
    MESDST      DCODIGO,
    ANOALT      DCODIGO,
    ANODST      DCODIGO,
    ALTURA      DCODIGO,
    DISTANCIA   DCODIGO,
    PRECISAO    DDOCUMENTO,
    FAVORECIDO  DCHAR,
    NOME        DDESCRICAO,
    DESCRICAO   DDESCRICAO
);

CREATE TABLE SIS_CONF_ETIQUETAS (
    CNPJ           DCNPJ NOT NULL,
    CODIGO         DCODIGO NOT NULL,
    NOME           DNOME,
    LINHAS         DCODIGO,
    COLUNAS        DCODIGO,
    QTDECOL        DCODIGO,
    QTDETQ         DCODIGO,
    LARGURA        DCODIGO,
    ALTURA         DCODIGO,
    ESP_ENTLINHA   DCODIGO,
    ESP_ENTCOL     DCODIGO,
    APARTIR        DCODIGO,
    ESQUERDA       DCODIGO,
    LPP            DCHAR6,
    FONTECODIGO    DCODIGO,
    NEGRITOCODIGO  DCHAR,
    FONTENOME      DCODIGO,
    NEGRITONOME    DCHAR,
    FONTEVALOR     DCODIGO,
    NEGRITOVALOR   DCHAR
);

CREATE TABLE SIS_CONFIG_REL (
    ID         INTEGER NOT NULL,
    CNPJ       DCNPJ NOT NULL,
    RELATORIO  DNOME,
    CONFIG     DMN_BLOB_TEXT
);

CREATE TABLE SIS_CONFIGURACOES (
    CNPJ                          DCNPJ,
    RESUMO_MOEDAS                 DCODIGO,
    VENCTO_FIXO_PRESTACOES        DCHAR,
    TOLERANCIA_JUROS              DCODIGO,
    MULTA_FINANCEIRA              DVALOR,
    INCLUI_VENDA_LIMITE           DCHAR,
    EXCLUI_VENDAS_BX_PARC_PDV     DCHAR,
    UTLIZA_INDEXADOR_CUSTO        DCHAR,
    IMPRIME_ITENS_CUPOM_PDV       DCHAR,
    ITENSORCAMENTO_ORC            DCODIGO,
    CODIGO_SCPC                   DCHAR10,
    PDV_TROCO_MAXIMO              DVALOR,
    ALIQUOTA_ISS                  DVALOR,
    PEDE_SENHAGER_CAIXA           DCHAR,
    IMP_VND_FATURAMENTO           DCHAR,
    CTB_CAIXA_FRENTISTA_GERAL     DCHAR,
    EST_ENTRADAS_DOLAR            DCHAR,
    OFC_ORDEM_VENDEDOR            DCODIGO,
    OFC_ORDEM_NATUREZA            DCODIGO,
    OFC_ORDEM_FRM_PAGTO           DCODIGO,
    OFC_ORDEM_PRODUTO             DCODIGOPROD,
    EST_UTILIZA_GRADES            DCHAR,
    ITENSORDEM_SERVICO            DCODIGO,
    BLOQ_CAD_SEM_CPF              DCHAR,
    PDV_IMP_END_PRAZO             DCHAR,
    OFC_NOME_RAZAO                DNOME,
    OFC_ENDERECO                  DMENSAGEM,
    OFC_FONE                      DFONE,
    OFC_FAX                       DFONE,
    OFC_COR_TELA                  DCHAR15,
    CTB_DIFERENCA_CAIXA           DCODIGO,
    ENT_FRETE_MANUAL              DCHAR,
    CONVENIO_CHEQUE               DCHAR15,
    CODIGO_CONVENIO_BANCO         DCHAR10,
    PATH_ARQUIVO_BANCO            DNOME,
    NOME_ARQUIVO_BANCO            DDESCRICAO,
    GLO_PROPRIEDADE_EQUIPAMENTOS  DCHAR,
    CSLL                          DVALOR,
    UTILIZA_MASCARA_ORCAMENTO     DCHAR,
    VALOR_MINIMO_PARCELAMENTO     DVALOR,
    PDV_OBRIGA_QNTDE              DCHAR,
    PDV_COR_FUNDO                 DCODIGO,
    PDV_COR_FONTE                 DCODIGO,
    DIFERENCIA_FIS_FISC           DCHAR,
    PDV_FATURAMENTO_FIM_MES       DCHAR,
    PDV_FOTO_FUNDO                DMENSAGEM,
    BLOQUEIA_VENDA_SEM_CPF        DCHAR,
    DESPESAS_OPERACIONAIS         DVALOR,
    IMPOSTO_RENDA                 DVALOR,
    EST_REPETE_COD_SEC            DCHAR,
    OFC_USA_CONTADORES            DCHAR,
    CODIFICA_PRODUTOS             DCHAR,
    IMPRIME_CUPOM_NOMINAL         DCHAR,
    IMP_NOME_PROPRIEDADE          DCHAR,
    PDV_VER_ULTIMAS_VENDAS        DCHAR,
    OS_CONFIG_CAMPOS              VARCHAR(3000),
    OFC_CONTATO_POR_CLIENTE       DCHAR,
    CONFIGURA_MODULA              DACTIONS DEFAULT 'ALL'
);

CREATE TABLE SIS_DIREITOS_PERFIL (
    PERFIL   DCODIGO NOT NULL,
    MODULO   DCODIGO NOT NULL,
    DIREITO  DACTIONS
);

CREATE TABLE SIS_DOCUMENTOS (
    CNPJ              DCNPJ NOT NULL,
    CONFIG_DEVOLUCAO  DMN_BLOB_TEXT
);

CREATE TABLE SIS_DUPLICATA (
    CNPJ              DCNPJ NOT NULL,
    VENCIMENTO_DST    DCODIGO,
    VENCIMENTO_ALT    DCODIGO,
    DATA_DST          DCODIGO,
    DATA_ALT          DCODIGO,
    DOCUMENTO_DST     DCODIGO,
    DOCUMENTO_ALT     DCODIGO,
    VALOR_DST         DCODIGO,
    VALOR_ALT         DCODIGO,
    INSTRUCOES_DST    DCODIGO,
    INSTRUCOES_ALT    DCODIGO,
    SACADO_DST        DCODIGO,
    SACADO_ALT        DCODIGO,
    EXTENSO_DST       DCODIGO,
    EXTENSO_ALT       DCODIGO,
    LPP               DCODIGO,
    TAMANHOPAGINA     DCODIGO,
    VENDA_DST         DCODIGO,
    VENDA_ALT         DCODIGO,
    PORTA_IMPRESSORA  DNOME,
    VALOR_DPL_DST     DCODIGO,
    VALOR_DPL_ALT     DCODIGO,
    DPL_GRAFICA       DCHAR,
    CONFIG_DPL        DMN_BLOB_TEXT
);

CREATE TABLE SIS_EMPRESAS (
    CNPJ                            DCNPJ NOT NULL,
    NOME                            DNOME,
    ENDERECO                        DNOME,
    BAIRRO                          DNOME,
    CIDADE                          DNOME,
    UF                              DUF,
    CEP                             DCEP,
    FONE                            DFONE,
    FAX                             DFONE,
    MENS_ECF                        DMENSAGEM,
    ALT_PRC_VND                     DCHAR,
    TX_JUROS_ATE                    DVALOR,
    TX_JUROS_APOS                   DVALOR,
    TIPO_TAXA                       DTIPOJURO,
    MENSAGEM_BOL                    DNOME,
    MENSAGEM_BOL2                   DNOME,
    CLI_VND_VISTA                   DCODIGO,
    DT_ULT_VENDA                    DDATA,
    CUSTO_VARIAVEL                  DVALOR,
    VENDEDOR                        DVALOR,
    PROPAGANDA                      DVALOR,
    DESCONTOS                       DVALOR,
    PG_COM_TERC                     DCHAR,
    PDV_NATUREZA                    DCODIGO,
    PDV_TIPODOCTO                   DCHAR3,
    PDV_LOCALCOBRANCA               DCODIGO,
    DIG_DESC_VENDA                  DCHAR,
    DIG_CHEQUE_VENDA                DCHAR,
    PDV_MSG1                        DMENSAGEM,
    PDV_MSG2                        DMENSAGEM,
    PDV_MSG3                        DMENSAGEM,
    PDV_MSG4                        DMENSAGEM,
    PDV_MSG5                        DMENSAGEM,
    PDV_ECF                         DCHAR,
    PDV_MAIORVALORUNIT              DVALOR,
    PDV_SENHA                       DCHAR10,
    LOCAL_FATURA                    DCHAR,
    ECF_ULTNUMERO                   DCODIGO,
    DIG_UNIDADE_VENDA               DCHAR,
    PDV_PARCELA_VENDA               DCHAR,
    SELAGRUPADOR                    DCHAR,
    PDV_ELIMINA_ZEROS               DCHAR,
    TIPO_CONSULTA_PROD              DCHAR,
    PDV_ACRESCENTA_ZEROS            DCHAR,
    CARREGAR_ARQUIVOS               DCHAR,
    VER_VENDAS_ENVIADAS             DCHAR,
    CHM_LOCPROD_INEXISTENTE         DCHAR,
    PDV_F4_ALTERACLIENTE            DCHAR,
    DIG_SENHA_VENDEDOR              DCHAR,
    COR_FUNDO_SELECIONADO           DCHAR15,
    NUM_REG_LOAD                    DCODIGO,
    PDV_DIGITA_QUANTIDADE           DCHAR,
    COR_FUNDO_DESELECIONADO         DCHAR15,
    CX_PAGAR_CAIXA                  DCHAR,
    CX_RECEBER_CAIXA                DCHAR,
    EXT_LANC_CAIXA_FECHADO          DCHAR,
    NUM_MAX_ITENS                   DCODIGO,
    IMP_UNIT_ORC                    DCHAR,
    DUPLICATA                       DCODIGO,
    BLQQTDEFISCAL                   DCHAR,
    NUM_MAX_ITENS_ORC               DCODIGO,
    ALTERA_PRECO_VENDA_ENT          DCHAR,
    TIPO_EMPRESA                    DDESCRICAO,
    DIG_CARTAO_VENDA                DCHAR,
    PIS                             DVALOR,
    COFINS                          DVALOR,
    DIGITA_NUM_NOTA                 DCHAR,
    DIGITA_COTACOES                 DCHAR,
    FOTO                            DPATH,
    LOJA_DESC_AVISTA                DVALOR,
    ITENS_ORCAMENTO                 DCODIGO,
    IMPRIME_CABEC_2FOL              DCHAR,
    IMPRIME_DESCONTO_AGRUPADO       DCHAR,
    IMPRIME_RODAPE_ORCAMENTO        DCHAR,
    TIPO_CUSTO                      DCHAR,
    TIPO_ORCAMENTO                  DCHAR10,
    SELECIONA_IMPRESSORA            DCHAR,
    CX_COMP_SLD_ANT                 DCHAR,
    CX_IMP_VND_AGRUPADA             DCHAR,
    CX_TRANSP_SLD_ANT               DCHAR,
    MENS2_ECF                       DNOME,
    MENS3_ECF                       DNOME,
    TIPO_CAB_FATURA                 DCHAR3,
    TIPO_CONTAGEM                   DCHAR3,
    IMP_CASAS_QNTDE_FATURA          DCHAR,
    VALIDA_DOCUMENTOS               DCHAR,
    NUMERO_ZEROS                    DCODIGO,
    PST_MOSTRA_ENTRADAS             DCHAR,
    TROCO_MAXIMO                    DVALOR,
    MASCARA_FONE                    "DVARCHAR(30",
    CTB_JUROS_RECEBIDOS_REC         DCODIGO,
    PDV_REPETE_PRODUTOS             DCHAR,
    IMPRIME_SUBTOTAL_ORCAMENTO      DCHAR,
    EMBUTIR_JUROS_IMPRESSOES        DCHAR,
    MASCARA_PRODUTOS_ENT            DCHAR15,
    PDV_IMP_VINC_VALOR              DCHAR,
    PDV_PROPRIEDADE                 DCHAR,
    PST_SENHA_CAIXA                 DCHAR,
    IMPRIMIR_POSICOES               DCHAR,
    SINCRONIZAR_BOL_DPL             DCHAR,
    COMISSAO_POR_FAIXA              DCHAR,
    CONTA_CARTAO_CAIXA              DCODIGO,
    DIGITA_VENDEDOR_PDV             DCHAR,
    COMISSAO_NORMAL                 DCHAR,
    ULTIMO_TURNO                    DCODIGO,
    IP_EXTERNO                      DCHAR15,
    CAMINHO_EXTERNO                 DNOME,
    SENHA_EMPRESA_EXTERNA           DCHAR10,
    UTILIZA_DOCTOS_INT_ENTR         DCHAR,
    CONF_DUPLIC_REC_LANCTO          DCHAR,
    SIS_MENSAGEM_INTERNA            DCHAR,
    MENSAGEM_CONDICIONAL            DNOME,
    FAT_TIPO_PARCELAMENTO           DCHAR3,
    FAZ_FECHAMENTO_DIARIO           DCHAR,
    ATUALIZA_ARQ_EXTERNO            DCHAR,
    CAIXA_SINCRONIZADO              DCHAR,
    ICM_PRESUMIDO_IPI               DVALOR,
    ICM_PRESUMIDO_SEM_IPI           DVALOR,
    ALT_PRCVEND_MARGEM              DCHAR,
    BLQ_VENDA_SEM_IERG              DCHAR,
    PDV_UNITARIO_ZERADO             DCHAR,
    DIRETORIO_TEF                   DNOME,
    IMPRIME_NF_BALCAO               DCHAR,
    TRANSF_VLRS_CAIXA               DCHAR,
    LOCAL_FATURA_TROCA              DCHAR,
    EST_ET_PROD_GRD1                DMN_BLOB_TEXT,
    EST_ET_PROD_GRD2                DMN_BLOB_TEXT,
    EST_ET_PROD_GRD3                DMN_BLOB_TEXT,
    EST_ET_PROD_GRD3_PARC           DMN_BLOB_TEXT,
    EST_ET_PROD_GRD3_DESCTO         DMN_BLOB_TEXT,
    EST_ET_PROD_GRD4                DMN_BLOB_TEXT,
    CH_INFLUENCIA_VENDA             DCHAR DEFAULT 'S',
    CRT_INFLUENCIA_VENDA            DCHAR DEFAULT 'S',
    IMP_SERIE_NF                    DCHAR DEFAULT 'N',
    CONFIG_SERIE_NF                 DMN_BLOB_TEXT,
    CONFIG_CT13                     DMN_BLOB_TEXT,
    CONFIG_MALADIRETA               DMN_BLOB_TEXT,
    GERA_BOLETOS                    DCHAR,
    BLT_INSTRUCAO                   DMN_BLOB_TEXT,
    BLT_LOCAL_PAGTO                 DVARCHAR200,
    BLT_COD_CEDENTE                 DCODIGO,
    BLT_DIG_COD_CEDENTE             DCHAR,
    BLT_AGENCIA                     DCHAR10,
    BLT_DIG_AGENCIA                 DCHAR,
    BLT_CONVENIO                    DCODIGO,
    BLT_CONTA                       DCHAR10,
    BLT_DIG_CONTA                   DCHAR,
    BLT_CARTEIRA                    DCHAR10,
    BLT_LAYOUT                      DANO,
    BLT_ACEITE_DOCTO                DCHAR,
    BLT_DIAS_ABATIMENTO             DCNPJ,
    BLT_DIAS_DESCONTO               DCODIGO,
    BLT_DIAS_MORA_JUROS             DCODIGO,
    BLT_DIAS_PROTESTO               DCODIGO,
    BLT_PCT_ABATIMENTO              DVALOR,
    BLT_PCT_DESCONTO                DVALOR,
    DESP_BANCARIA                   DVALOR,
    MORA_DIARIA                     DVALOR,
    BLT_VLR_IOF                     DVALOR,
    BLT_VLR_OUTRAS_DESP             DVALOR,
    BLT_DIR_REMESSA                 DVARCHAR200,
    BLT_DIR_RETORNO                 DVARCHAR200,
    DESCONTO_MAXIMO                 DVALOR,
    CONFIG_NF_SERV                  DMN_BLOB_TEXT,
    DIG_ITENS_NF                    DINTEIRO,
    VALIDA_ABERTURA_CX              DCHAR DEFAULT 'N',
    CONTROLE_PEDIDO_RESTAURANTE     DCHAR DEFAULT 'N',
    DB_VERSAO                       DCODIGO,
    TAXA_ACRESC_PDV                 DVALOR,
    MSG_PDVTELA                     DVARCHAR200,
    CONTAGEM_INCREMENTAL            DCHAR DEFAULT 'N',
    EXIBE_MOD                       DCHAR DEFAULT 'S',
    EXIBE_PENDENCIA                 DCHAR DEFAULT 'N',
    KEY_RELEASE                     DNOME,
    EXIBE_MESAS                     DCHAR,
    EXIBE_CTB                       DCHAR,
    EXIBE_CB                        DCHAR,
    EXIBE_SRV                       DCHAR,
    CARREGAMENTO_PARCIAL            DCEP,
    CONFIG_NF_GRAF                  DMN_BLOB_TEXT,
    BLT_EMAIL_SERVIDOR              DNOME,
    BLT_EMAIL_PORTA                 DINTEIRO,
    BLT_EMAIL_USER                  DNOME,
    BLT_EMAIL_SENHA                 DNOME,
    BLT_NOSSO_NUM_INI               DCODIGO,
    BLT_NOSSO_NUM_FIM               DCODIGO,
    BLT_NOSSO_NUM_PROX              DCODIGO,
    EMAIL                           DNOME,
    BLT_MULTA                       DVALOR,
    CONFIG_COPIA_CHEQUE             DMN_BLOB_TEXT,
    CONFIG_SERIE_ORC_NF             DMN_BLOB_TEXT,
    CONFIG_REQUISICAO               DMN_BLOB_TEXT,
    CONFIG_CARTA_SCPC               DMN_BLOB_TEXT,
    ATIVA_AGENTE                    DCHAR,
    NF_CONTINUO_COM_MESMO_NUM_NF    DCHAR,
    NF_CONTINUO_NOME_CAMPO_TRUE     VARCHAR(50),
    CONFIG_CONVENIO_PDV             DMN_BLOB_TEXT,
    IMP_CONVENIO_GRAF               DCHAR,
    CONFIG_RECIBO                   DMN_BLOB_TEXT,
    NUM_ITENS_NF                    DINTEIRO,
    NUM_ITENS_PDD                   DINTEIRO,
    CONFIG_OS                       DMN_BLOB_TEXT,
    OFC_LT_PRODUTO_COPIAS           DCODIGOPROD,
    EXIBE_AGR                       DCHAR,
    IE                              DCHAR15,
    COD_CIDADE                      DCODIGO,
    COD_LOGRADOURO                  DCODIGO,
    COD_BAIRRO                      DCODIGO,
    END_NUMERO                      DCODIGO,
    EXIBE_CARGA                     DCHAR,
    EXIBE_NFE                       DCHAR,
    EXIBE_SINTEGRA                  DCHAR,
    NFE_AMBIENTE                    DCHAR,
    NFE_VERSAO_APP                  "DVARCHAR(20)",
    NFE_DIR_EXPORTACAO              DVARCHAR200,
    NFE_LEIAUTE_DANFE               DCHAR,
    LOCAL_PADRAO                    DCHAR,
    CONFIG_AGR_RECEITA              DMN_BLOB_TEXT,
    CONFIG_ACERTO_1                 DMN_BLOB_TEXT,
    DESC_BX_PARCIAL                 DCHAR,
    CM_AGR                          DCHAR,
    CM_VDT                          DCHAR,
    CMD_VDT_PCT                     DVALOR,
    PDV_FORMA_PAGTO                 DCODIGO,
    EXIBE_TBL                       DCHAR,
    EXIBE_ACERTO_CONTAS             DCHAR,
    EMAIL_PADRAO                    DMENSAGEM,
    SMTP                            "DVARCHAR(20)",
    LOGIN                           "DVARCHAR(20)",
    SENHA                           "DVARCHAR(20)",
    NOME_USUARIO                    DMENSAGEM,
    EMAIL_CONTROLE                  DMENSAGEM,
    EXIBE_MESALIDADES               DCHAR,
    FORMA_PAGTO_MENSALIDADE         DCODIGO,
    NFE_CERT_CAMINHO                DVARCHAR80,
    NFE_CERT_SENHA                  DVARCHAR80,
    NFE_CERT_NUM_SERIE              DVARCHAR80,
    NFE_GER_TP_DANFE                DCHAR,
    NFE_GER_FORMA_EMISSAO           DCHAR,
    NFE_GER_PATH_LOGS               DVARCHAR80,
    NFE_GER_IMG_DANFE               DVARCHAR80,
    NFE_WS_UF                       "DVARCHAR(2)",
    NFE_WS_AMBIENTE                 DCHAR,
    NFE_WS_PROXY_HOST               "DVARCHAR(20)",
    NFE_WS_PROXY_PORTA              "DVARCHAR(20)",
    NFE_WS_PROXY_USUARIO            "DVARCHAR(20)",
    NFE_WS_PROXY_SENHA              "DVARCHAR(20)",
    NFE_EMIT_CNPJ                   DVARCHAR80,
    NFE_EMIT_INSC_ESTADUAL          DVARCHAR80,
    NFE_EMIT_FANTASIA               DVARCHAR80,
    NFE_EMIT_FONE                   "DVARCHAR(20)",
    NFE_EMIT_CEP                    "DVARCHAR(20)",
    NFE_EMIT_LOGRADOURO             DVARCHAR80,
    NFE_EMIT_BAIRRO                 DVARCHAR80,
    NFE_EMIT_COMPLEMENTO            DVARCHAR80,
    NFE_EMIT_NUMERO                 DCODIGO,
    NFE_EMIT_COD_CIDADE             DCODIGO,
    NFE_EMIT_CIDADE                 DVARCHAR80,
    NFE_EMIT_UF                     "DVARCHAR(2)",
    NFE_EMIT_EMAIL                  DVARCHAR80,
    NFE_EMAIL_PORTA                 DCODIGO,
    NFE_EMAIL_USUARIO               DVARCHAR80,
    NFE_EMAIL_SENHA                 "DVARCHAR(20)",
    NFE_EMAIL_SMTP_SEGURA           DCHAR,
    NFE_EMAIL_SMTP                  "DVARCHAR(20)",
    NFE_EMIT_RAZAO_SOCIAL           DVARCHAR80,
    EXIBE_INDICE_PDV                DCHAR,
    NFE_PATH_LEIAUTE_DANFE          DVARCHAR200,
    BCH_FILIAL                      DCODIGO,
    BCH_INS_MUN                     SMALLINT,
    BCH_NOMECONTATO                 VARCHAR(50),
    BCH_PATH                        DVARCHAR200,
    OFC_EXIBE_COPIAS                DCHAR,
    OFC_EXIBE_MOVTO_AVULSO          DCHAR,
    OFC_EXIBE_VISUALIZACAO          DCHAR,
    OFC_EXIBE_VISITA_PREVENTIVA     DCHAR,
    OFC_EXIBE_MOVIMENTOS_OS         DCHAR,
    OFC_ENVIO_EMAIL_AUTOMATICO      DCHAR,
    OFC_CONTROLA_TEMPO_RESPOSTA     DCHAR,
    CM_LIB_PCT_VD_VISTA             DVALOR,
    CM_LIB_PCT_VD_PRAZO             DVALOR,
    PDV_QTDE_COD_BARRAS             DCHAR,
    OFC_EXIBE_DADOS_COMPLEMENTARES  DCHAR,
    OFC_EXIBE_NOTIFICACAO           DCHAR,
    PDV_IMP_CONVENIO                DCHAR,
    BLOQUEIA_MVB                    DCHAR,
    CM_TX_ADMISTRACAO               DVALOR,
    IMP_PROD_DUPLICATA              DCHAR,
    BCH_AUTO_IMPORTA                DCHAR,
    ACT_MULTI_SELETOR               DCHAR,
    EDITA_NUM_NF                    DCHAR,
    ELIMINA_ZERO_PRD_SEM_GRADE      DCHAR,
    BCH_PATH_PEDIDOS                DVARCHAR200,
    BCH_ATIVO                       DCHAR,
    BCH_CONC_CODIGO_PRODUTO         DCHAR,
    BCH_HABILITA_SINC_AUT           DCHAR,
    ALTERA_VLR_CNT_PAGAR            DCHAR,
    CTB_DT_AVISO_BANCARIO           DCHAR,
    DT_CX_MOVTO_ANTERIOR            DCHAR,
    BCH_EXIBE_DESCONTO              DCHAR,
    NFE_DESTACA_ICMS_SUB            DCHAR,
    NFE_CNAE                        "DVARCHAR(20)",
    REGIME_TRIBUTARIO               DNOME,
    FONES_SUPORTE                   VARCHAR(100),
    EST_MIN_CONTA_EMAIL_ENVIO       VARCHAR(100),
    EST_MIN_SMTP_EMAIL_ENVIO        DNOME,
    EST_MIN_LOGIN_EMAIL_ENVIO       DNOME,
    EST_MIN_PASSWORD_EMAIL_ENVIO    DNOME,
    EST_MIN_DESTINOS_EMAIL_ENVIO    DVARCHAR600,
    MAP_HTML_VIEW                   DMN_BLOB_TEXT
);

CREATE TABLE SIS_LOG_TRANSACOES (
    CNPJ        DCNPJ NOT NULL,
    CODIGO      DCODIGO NOT NULL,
    DOCUMENTO   DDOCUMENTO,
    USUARIO     DCODIGO,
    DATA        DDATA,
    HORA        DTIME,
    COMPUTADOR  DNOME,
    ORIGEM      DCHAR6
);

CREATE TABLE SIS_MENSAGENS (
    CODIGO        DCODIGO NOT NULL,
    ANO           DCODIGO NOT NULL,
    REMETENTE     DLOGIN,
    DESTINATARIO  DLOGIN,
    RESERVADO     DCHAR,
    ASSUNTO       DNOME,
    MENSAGEM      DSYSMSG,
    DT_ENVIO      DDATA,
    DT_RESPOSTA   DDATA,
    DT_AVISO      DDATA,
    DT_LEITURA    DDATA,
    DT_RESP       DDATA,
    DT_VALIDADE   DDATA
);

CREATE TABLE SIS_MENU (
    CNPJ        DCNPJ NOT NULL,
    CATEGORIA   VARCHAR(50) NOT NULL,
    NOME        VARCHAR(50),
    CODIGO      DCODIGO,
    COMPUTADOR  DNOME NOT NULL
);

CREATE TABLE SIS_MENU_ITEM (
    CNPJ        DCNPJ NOT NULL,
    CATEGORIA   VARCHAR(50) NOT NULL,
    COMPUTADOR  DNOME NOT NULL,
    NOME        VARCHAR(50) NOT NULL,
    CODIGO      DCODIGO,
    CAPTION     DNOME,
    VISIVEL     DCHAR
);

CREATE TABLE SIS_MODULOS (
    CODIGO      DCODIGO NOT NULL,
    EXECUTAVEL  "DVARCHAR(30",
    OBJETO      "DVARCHAR(30",
    DESCRICAO   DNOME,
    RESTRITO    DCHAR,
    ACTIONS     DACTIONS
);

CREATE TABLE SIS_NOTAPROMISSORIA (
    CNPJ                 DCNPJ NOT NULL,
    VENDA1_DST           DCODIGO,
    VENDA1_ALT           DCODIGO,
    PARCELA1_DST         DCODIGO,
    PARCELA1_ALT         DCODIGO,
    VENCIMENTO1_DST      DCODIGO,
    VENCIMENTO1_ALT      DCODIGO,
    SACADO1_DST          DCODIGO,
    SACADO1_ALT          DCODIGO,
    VALOR1_DST           DCODIGO,
    VALOR1_ALT           DCODIGO,
    VENDA2_DST           DCODIGO,
    VENDA2_ALT           DCODIGO,
    PARCELA2_DST         DCODIGO,
    PARCELA2_ALT         DCODIGO,
    VENCIMENTO2_DST      DCODIGO,
    VENCIMENTO2_ALT      DCODIGO,
    SACADO2_DST          DCODIGO,
    SACADO2_ALT          DCODIGO,
    VALOR2_DST           DCODIGO,
    VALOR2_ALT           DCODIGO,
    DATA_DST             DCODIGO,
    DATA_ALT             DCODIGO,
    DOCUMENTO_DST        DCODIGO,
    DOCUMENTO_ALT        DCODIGO,
    INSTRUCOES_DST       DCODIGO,
    INSTRUCOES_ALT       DCODIGO,
    EXTENSO_DST          DCODIGO,
    EXTENSO_ALT          DCODIGO,
    LPP                  DCODIGO,
    TAMANHOPAGINA        DCODIGO,
    VECTO_EXT_DST        DCODIGO,
    VECTO_EXT_ALT        DCODIGO,
    EMPRESA_DST          DCODIGO,
    EMPRESA_ALT          DCODIGO,
    EMPRESA              DNOME,
    PORTA                DNOME,
    CODIGO_DST           DCODIGO,
    CODIGO_ALT           DCODIGO,
    CODIGO2_DST          DCODIGO,
    CODIGO2_ALT          DCODIGO,
    DATA2_DST            DCODIGO,
    DATA2_ALT            DCODIGO,
    TAMANHO_NOME         DCODIGO,
    DATA3_DST            DCODIGO,
    DATA3_ALT            DCODIGO,
    IMPRIME_TOTALIZADOR  DCHAR,
    DESCRICAO_CANHOTO    DCHAR,
    VENDEDOR_DST         DCODIGO,
    VENDEDOR_ALT         DCODIGO,
    VENDEDOR1_DST        DCODIGO,
    VENDEDOR1_ALT        DCODIGO,
    MENSAGEM_NP          DVARCHAR200,
    MENSAGEM_DST         DCODIGO,
    MENSAGEM_ALT         DCODIGO,
    PR_GRAF              DCHAR,
    PR_GRAF_LEIAUTE      DMN_BLOB_TEXT,
    CAN_PARC_DST         DCODIGO,
    CAN_PARC_ALT         DCODIGO,
    CAN_VALOR_DST        DCODIGO,
    CAN_VALOR_ALT        DCODIGO,
    CAN_COD_CLI_DST      DCODIGO,
    CAN_COD_CLI_ALT      DCODIGO,
    CAN_COD_VENDA_DST    DCODIGO,
    CAN_COD_VENDA_ALT    DCODIGO,
    CAN_VENCTO_DST       DCODIGO,
    CAN_VENCTO_ALT       DCODIGO
);

CREATE TABLE SIS_PERFIL (
    CODIGO     DCODIGO NOT NULL,
    DESCRICAO  DNOME,
    USUARIOS   DQTD
);

CREATE TABLE SIS_PERFIL_COMPUTADOR (
    CNPJ                          DCNPJ NOT NULL,
    COMPUTADOR                    DDOCUMENTO NOT NULL,
    FOLHA_VISTA_CONDICIONAL       DCHAR3,
    FOLHA_PRAZO_CONDICIONAL       DCHAR3,
    FOLHA_VISTA_PEDIDO            DCHAR3,
    FOLHA_PRAZO_PEDIDO            DCHAR3,
    TIPO_IMP_CONDICIONAL          DDOCUMENTO,
    TIPO_IMP_PEDIDO               DDOCUMENTO,
    PORTA_IMP_CONDICIONAL_VISTA   DDOCUMENTO,
    PORTA_IMP_PEDIDO_VISTA        DDOCUMENTO,
    PORTA_IMP_CONDICIONAL_PRAZO   DDOCUMENTO,
    PORTA_IMP_PEDIDO_PRAZO        DDOCUMENTO,
    VIAS_CONDICIONAL_VISTA        INTEGER,
    VIAS_CONDICIONAL_PRAZO        INTEGER,
    VIAS_PEDIDO_VISTA             INTEGER,
    VIAS_PEDIDO_PRAZO             INTEGER,
    IMPRIME_PROMISSORIA           DCHAR,
    IMP_FORCADO_PROD_PED          DCHAR,
    VIAS_RECIBO                   DCODIGO,
    PORTA_RECIBO                  DDOCUMENTO,
    FOLHA_PENDENCIAS              DCHAR3,
    PORTA_PENDENCIAS              DDOCUMENTO,
    IMP_NEGRITO_EMPRESA_36        DCHAR,
    PDV_T01                       DCHAR6,
    PDV_T02                       DCHAR6,
    PDV_T03                       DCHAR6,
    PDV_T04                       DCHAR6,
    PDV_T05                       DCHAR6,
    PDV_T06                       DCHAR6,
    PDV_FF                        DCHAR6,
    PDV_II                        DCHAR6,
    TIPO_IMP_PDV                  DDOCUMENTO,
    PORTA_PDV                     DDOCUMENTO,
    EMITE_COMPROVANTE_PDV         DCHAR,
    PORTALEITORCHEQUE             DCEP,
    LEITOR_BITSPORSEGUNDO         DCHAR6,
    LEITOR_BITSDADOS              DCHAR,
    LEITOR_PARIDADE               DCHAR6,
    LEITOR_BITSPARADA             DCHAR3,
    LEITOR_FLUXO                  DCHAR10,
    TIPO_FOLHA_CADASTROS          DCHAR3,
    FOLHA_VISTA_TROCA             DCHAR3,
    PDV_EMITE_COMPROVANTE_NF      DCHAR,
    PDV_CONFIRMA_IMPRESSAO        DCHAR,
    PDV_AGENTE                    DDOCUMENTO,
    PDV_CONTRA_VALE               DCHAR,
    AUTENTICAR                    DCHAR,
    PDV_LINHA_RECIBO              DCHAR3,
    PDV_CONFIRMA_IMPRESSAO_VISTA  DCHAR,
    PDV_EMITE_ECF_FIM             DCHAR,
    PDV_EMITE_ECF_FIM_MODELO      DCHAR15,
    BAL_BITSPORSEGUNDO            DCHAR6,
    BAL_BITSDADOS                 DCHAR,
    BAL_PARIDADE                  DCHAR6,
    BAL_BITSPARADA                DCHAR3,
    BAL_FLUXO                     DCHAR10,
    PORTABALANCA                  DCEP,
    LET_BITSPORSEGUNDO            DCHAR6,
    LET_BITSDADOS                 DCHAR,
    LET_PARIDADE                  DCHAR6,
    LET_BITSPARADA                DCHAR3,
    LET_FLUXO                     DCHAR10,
    PORTALEITOR                   DCEP,
    EST_MIN_ENVIA_AUTOMATICO      DCHAR,
    EXIBE_MAPA                    DCHAR
);

CREATE TABLE SIS_RELACIONAMENTOS (
    TABELA      DNOMETABELA NOT NULL,
    CAMPO       DNOMETABELA NOT NULL,
    TABELA_REL  DNOMETABELA NOT NULL,
    CAMPO_REL   DNOMETABELA NOT NULL,
    CAMPO_RES   DNOMETABELA
);

CREATE TABLE SIS_RELEASE (
    CODIGO     INTEGER NOT NULL,
    TICKET     INTEGER,
    CLIENTE    VARCHAR(50),
    "RELEASE"  VARCHAR(50),
    TIPO       DINTEIRO,
    COD_PAI    DINTEIRO,
    RESUMO     VARCHAR(500),
    CNPJ       DDOCUMENTO,
    DESCRICAO  VARCHAR(500)
);

CREATE TABLE SIS_SERIENF (
    CNPJ                      DCNPJ NOT NULL,
    SERIE                     DCHAR3 NOT NULL,
    ULTIMO_NUMERO             DCODIGO,
    TIPO                      DCHAR DEFAULT 'P',
    NOTA_NUM_DST              DCODIGO,
    NOTA_NUM_ALT              DCODIGO,
    NOTA_NUMRECIBO_DST        DCODIGO,
    NOTA_NUMRECIBO_ALT        DCODIGO,
    NOTA_ENT_SAI_DST          DCODIGO,
    NOTA_ENT_SAI_ALT          DCODIGO,
    NOTA_NATUREZA_DST         DCODIGO,
    NOTA_NATUREZA_ALT         DCODIGO,
    NOTA_CFOP_DST             DCODIGO,
    NOTA_CFOP_ALT             DCODIGO,
    NOTA_SUBS_TRIB_DST        DCODIGO,
    NOTA_SUBS_TRIB_ALT        DCODIGO,
    NOTA_CNDPG_DST            DCODIGO,
    NOTA_CNDPG_ALT            DCODIGO,
    CLI_NOME_DST              DCODIGO,
    CLI_NOME_ALT              DCODIGO,
    CLI_CGCCPF_DST            DCODIGO,
    CLI_CGCCPF_ALT            DCODIGO,
    CLI_END_DST               DCODIGO,
    CLI_END_ALT               DCODIGO,
    CLI_BAIRRO_DST            DCODIGO,
    CLI_BAIRRO_ALT            DCODIGO,
    CLI_CEP_DST               DCODIGO,
    CLI_CEP_ALT               DCODIGO,
    CLI_CID_DST               DCODIGO,
    CLI_CID_ALT               DCODIGO,
    CLI_FONE_DST              DCODIGO,
    CLI_FONE_ALT              DCODIGO,
    CLI_FAX_DST               DCODIGO,
    CLI_FAX_ALT               DCODIGO,
    CLI_UF_DST                DCODIGO,
    CLI_UF_ALT                DCODIGO,
    CLI_INSCEST_DST           DCODIGO,
    CLI_INSCEST_ALT           DCODIGO,
    CLI_DATEMIS_DST           DCODIGO,
    CLI_DATEMIS_ALT           DCODIGO,
    CLI_DATENTSAI_DST         DCODIGO,
    CLI_DATENTSAI_ALT         DCODIGO,
    CLI_HORASAI_DST           DCODIGO,
    CLI_HORASAI_ALT           DCODIGO,
    CLI_PEDNUM_DST            DCODIGO,
    CLI_PEDNUM_ALT            DCODIGO,
    CLI_INSCMUN_DST           DCODIGO,
    CLI_INSCMUN_ALT           DCODIGO,
    CLI_DUPLNUM_DST           DCODIGO,
    CLI_DUPLNUM_ALT           DCODIGO,
    CLI_DUPLVENC_DST          DCODIGO,
    CLI_DUPLVENC_ALT          DCODIGO,
    CLI_DUPLVALOR_DST         DCODIGO,
    CLI_DUPLVALOR_ALT         DCODIGO,
    PROD_COD_DST              DCODIGO,
    PROD_COD_ALT              DCODIGO,
    PROD_PROD_DST             DCODIGO,
    PROD_PROD_ALT             DCODIGO,
    PROD_CF_DST               DCODIGO,
    PROD_CF_ALT               DCODIGO,
    PROD_SITTRIB_DST          DCODIGO,
    PROD_SITTRIB_ALT          DCODIGO,
    PROD_UNIDADE_DST          DCODIGO,
    PROD_UNIDADE_ALT          DCODIGO,
    PROD_QUANT_DST            DCODIGO,
    PROD_QUANT_ALT            DCODIGO,
    PROD_VALORUNIT_DST        DCODIGO,
    PROD_VALORUNIT_ALT        DCODIGO,
    PROD_VALORTOT_DST         DCODIGO,
    PROD_VALORTOT_ALT         DCODIGO,
    PROD_ICMS_DST             DCODIGO,
    PROD_ICMS_ALT             DCODIGO,
    PROD_IPI_DST              DCODIGO,
    PROD_IPI_ALT              DCODIGO,
    PROD_VALORIPI_DST         DCODIGO,
    PROD_VALORIPI_ALT         DCODIGO,
    FEC_BASEICMS_DST          DCODIGO,
    FEC_BASEICMS_ALT          DCODIGO,
    FEC_VALORFRETE_DST        DCODIGO,
    FEC_VALORFRETE_ALT        DCODIGO,
    FEC_VALORICMS_DST         DCODIGO,
    FEC_VALORICMS_ALT         DCODIGO,
    FEC_VALORSEGURO_DST       DCODIGO,
    FEC_VALORSEGURO_ALT       DCODIGO,
    FEC_BASECALCICMS_DST      DCODIGO,
    FEC_BASECALCICMS_ALT      DCODIGO,
    FEC_DESPESAS_DST          DCODIGO,
    FEC_DESPESAS_ALT          DCODIGO,
    FEC_VALORICMSSUB_DST      DCODIGO,
    FEC_VALORICMSSUB_ALT      DCODIGO,
    FEC_IPI_DST               DCODIGO,
    FEC_IPI_ALT               DCODIGO,
    FEC_VALORTOTAL_DST        DCODIGO,
    FEC_ISS_DST               DCODIGO,
    FEC_VALORTOTAL_ALT        DCODIGO,
    FEC_ISS_ALT               DCODIGO,
    FEC_VALORNOTA_DST         DCODIGO,
    FEC_VALORNOTA_ALT         DCODIGO,
    TRANS_NOME_DST            DCODIGO,
    TRANS_NOME_ALT            DCODIGO,
    TRANS_END_DST             DCODIGO,
    TRANS_END_ALT             DCODIGO,
    TRANS_QUANTIDADE_DST      DCODIGO,
    TRANS_QUANTIDADE_ALT      DCODIGO,
    TRANS_ESPECIE_DST         DCODIGO,
    TRANS_ESPECIE_ALT         DCODIGO,
    TRANS_MARCA_DST           DCODIGO,
    TRANS_MARCA_ALT           DCODIGO,
    TRANS_FRETECONTA_DST      DCODIGO,
    TRANS_FRETECONTA_ALT      DCODIGO,
    TRANS_CID_DST             DCODIGO,
    TRANS_CID_ALT             DCODIGO,
    TRANS_NUMERO_DST          DCODIGO,
    TRANS_NUMERO_ALT          DCODIGO,
    TRANS_PLACA_DST           DCODIGO,
    TRANS_PLACA_ALT           DCODIGO,
    TRANS_UFVEI_DST           DCODIGO,
    TRANS_UFVEIALT            DCODIGO,
    TRANS_UF_DST              DCODIGO,
    TRANS_UF_ALT              DCODIGO,
    TRANS_CGCCPF_DST          DCODIGO,
    TRANS_CGCCPF_ALT          DCODIGO,
    TRANS_INSCEST_DST         DCODIGO,
    TRANS_INSCEST_ALT         DCODIGO,
    TRANS_PESBRT_DST          DCODIGO,
    TRANS_PESOBRT_ALT         DCODIGO,
    TRANS_PESOLIQ_DST         DCODIGO,
    TRANS_PESOLIQ_ALT         DCODIGO,
    TRANS_OBS_DST             DCODIGO,
    TRANS_OBS_ALT             DCODIGO,
    IMPRESSORA_PULO           DCODIGO,
    IMPRESSORA_LPP            DCHAR10,
    PRODUTOSNOTA              DCODIGO,
    LOCALDUPLICATAS           DCHAR,
    NUMERODELINHASDANOTA      DCODIGO,
    PROD_DESC_DST             DCODIGO,
    PROD_DESC_ALT             DCODIGO,
    DATA_ANO_ALT              DCODIGO,
    DATA_ANO_DST              DCODIGO,
    DATA_DIA_ALT              DCODIGO,
    DATA_DIA_DST              DCODIGO,
    DATA_MES_ALT              DCODIGO,
    DATA_MES_DST              DCODIGO,
    OBS_ALT                   DCODIGO,
    OBS_DST                   DCODIGO,
    NOTA_VENDEDOR_DST         DCODIGO,
    NOTA_VENDEDOR_ALT         DCODIGO,
    NOTA_ECF_DST              DCODIGO,
    NOTA_ECF_ALT              DCODIGO,
    NOTA_DESCONTO_DST         DCODIGO,
    NOTA_DESCONTO_ALT         DCODIGO,
    NOTA_INDCOMPL_DST         DCODIGO,
    NOTA_INFCOMPL_ALT         DCODIGO,
    CLI_DUPLLARGURA_COLUNA    DCODIGO,
    CLI_DUPLNUM_COLUNA        DCODIGO,
    NOTA_MSGNAT_DST           DCODIGO,
    NOTA_MSGNAT_ALT           DCODIGO,
    NOTA_NUMRDP_DST           DCODIGO,
    NOTA_NUMRDP_ALT           DCODIGO,
    PORTA_IMPRESSAO           DDESCRICAO,
    NOTA_DESCONTO_ALT2        DCODIGO,
    NOTA_DESCONTO_DST2        DCODIGO,
    PROD_QNTD_UNID_ALT        DCODIGO,
    PROD_QNTD_UNID_DST        DCODIGO,
    PROD_TIPO_UNID_ALT        DCODIGO,
    PROD_TIPO_UNID_DST        DCODIGO,
    MODELO                    DCHAR3,
    NOTA_IRRF_DST             DCODIGO,
    NOTA_IRRF_ALT             DCODIGO,
    NOTA_INSS_DST             DCODIGO,
    NOTA_INSS_ALT             DCODIGO,
    NOTA_PIS_DST              DCODIGO,
    NOTA_PIS_ALT              DCODIGO,
    NOTA_ISS_SUBST_DST        DCODIGO,
    NOTA_ISS_SUBST_ALT        DCODIGO,
    PROD_TAM_NOME             DCODIGO,
    CLI_NOME_RODAPE_DST       DCODIGO,
    CLI_NOME_RODAPE_ALT       DCODIGO,
    CLI_DATENTSAI_RODAPE_DST  DCODIGO,
    CLI_DATENTSAI_RODAPE_ALT  DCODIGO,
    FEC_VALORNOTA_RODAPE_ALT  DCODIGO,
    FEC_VALORNOTA_RODAPE_DST  DCODIGO,
    NOTA_DUPLICA_NUMERO       DCHAR,
    NF_GRAFICA                DCHAR DEFAULT 'S',
    NOTA_EMPRESA_ALT          DCODIGO,
    NOTA_EMPRESA_DST          DCODIGO,
    PROD_MARCA_ALT            DCODIGO,
    PROD_MARCA_DST            DCODIGO,
    PROD_LOTE_ALT             DCODIGO,
    PROD_LOTE_DST             DCODIGO,
    NOTA_EMPRESA_UF_ALT       DCODIGO,
    NOTA_EMPRESA_UF_DST       DCODIGO,
    CLI_CID_PROP_DST          DCODIGO,
    CLI_CID_PROP_ALT          DCODIGO,
    CLI_UF_PROP_DST           DCODIGO,
    CLI_UF_PROP_ALT           DCODIGO,
    PROD_LOTE_VALIDADE_ALT    DCODIGO,
    PROD_LOTE_VALIDADE_DST    DCODIGO,
    CLI_END_PROP_ALT          DCODIGO,
    CLI_END_PROP_DST          DCODIGO,
    CLI_NOME_PROP_ALT         DCODIGO,
    CLI_NOME_PROP_DST         DCODIGO,
    NFSERV_GRAFICA            DLOGICO,
    NF_GRAFICA2               DLOGICO,
    CONFIG_NF_GRAF            DMN_BLOB_TEXT,
    INDICE                    "DVARCHAR(20)",
    TIPO_DOCTO                DCHAR3,
    NFE_IMPRESSAO             DCHAR
);

CREATE TABLE SIS_TABELAS_SISTEMA (
    TABELA  DNOME NOT NULL,
    NOME    DNOME
);

CREATE TABLE SIS_TABELAS_SISTEMA_CAMPOS (
    TABELA      DNOME NOT NULL,
    CAMPO       DNOME NOT NULL,
    NOME        DNOME,
    TIPO_CAMPO  DDESCRICAO,
    MASCARA     DCHAR15,
    NULO        DCHAR,
    "DISPLAY"   DNOME
);

CREATE TABLE SIS_USUARIOS (
    CODIGO  DCODIGO NOT NULL,
    LOGIN   DLOGIN,
    NOME    DNOME,
    PERFIL  DCODIGO,
    SENHA   "DVARCHAR(20)",
    EXIBIR  DLOGICO
);

CREATE TABLE TABELAPRECOCONDPAGAMENTO (
    CNPJ             DCNPJ NOT NULL,
    CODIGO           DCODIGO NOT NULL,
    COD_FORMA_PAGTO  INTEGER,
    COD_TABELAPRECO  INTEGER,
    TAXAFINANCEIRA   NUMERIC(18,4)
);

CREATE TABLE TBL_TESTE (
    CODIGO  INTEGER NOT NULL,
    TESTE   VARCHAR(10)
);

CREATE TABLE TEMP_CUSTO_MEDIO (
    CODIGO       DCODIGO NOT NULL,
    QTDE         DFLOAT,
    CUSTO        DFLOAT,
    TOTAL        DFLOAT,
    DT_ENT       DDATA2,
    NDOCTO       "DVARCHAR(20)",
    CUSTO_MEDIO  DFLOAT
);



/* Check constraints definition */

ALTER TABLE GLO_CLIENTES ADD CHECK(DIA_PREF_FAT BETWEEN 0 AND 31);
ALTER TABLE GLO_CLIENTES ADD CHECK(CLASSIF IN ('B', 'M', 'R'));
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CHECK (TIPO IN ( 'C', 'D' ));
ALTER TABLE FIN_CHEQUES ADD CHECK (CONCILIADO IN ( 'S' , 'N' ));
ALTER TABLE SIS_SERIENF ADD CHECK (LOCALDUPLICATAS IN ('C', 'R'));
ALTER TABLE SIS_EMPRESAS ADD CHECK (LOCAL_FATURA IN ( 'B', 'C' ));
ALTER TABLE GLO_CLIENTES ADD CHECK(DIA_PREF_FAT BETWEEN 0 AND 31);
ALTER TABLE GLO_CLIENTES ADD CHECK(CLASSIF IN ('B', 'M', 'R'));
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CHECK (TIPO IN ( 'C', 'D' ));
ALTER TABLE FIN_CHEQUES ADD CHECK (CONCILIADO IN ( 'S' , 'N' ));
ALTER TABLE SIS_SERIENF ADD CHECK (LOCALDUPLICATAS IN ('C', 'R'));
ALTER TABLE SIS_EMPRESAS ADD CHECK (LOCAL_FATURA IN ( 'B', 'C' ));


/******************************************************************************/
/****                             Primary Keys                             ****/
/******************************************************************************/

ALTER TABLE ACT_ACERTOCONTA ADD CONSTRAINT FK_ACT_ACERTOCONTA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE ACT_CONFIGURACAOTITULO ADD CONSTRAINT PK_ACT_CONFIGURACAOTITULO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE ACT_EVENTOCONTABIL ADD CONSTRAINT PK_ACT_EVENTOCONTABIL PRIMARY KEY (CNPJ, CODEVENTOCONTABIL);
ALTER TABLE ACT_TITULOGERADO ADD CONSTRAINT FK_ACT_TITULOGERADO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_CATEGORIA_DEFENSIVO ADD CONSTRAINT PK_AGR_CATEGORIA_DEFENSIVO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_CLASSE_TOXICOLOGICA ADD CONSTRAINT FK_AGR_CLASSE_TOXICOLOGICA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_CLASSIFICACAO_AMBIENTAL ADD CONSTRAINT FK_AGR_CLASSIFICACAO_AMBIENTAL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_CLASSIFICAO_QUIMICA ADD CONSTRAINT FK_AGR_CLASSIFICAO_QUIMICA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_CULTURA ADD CONSTRAINT FK_AGR_CULTURA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT PK_AGR_DEFENSIVOCULTURAPRAG PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT PK_AGR_DEFENSIVO_AGRICOLA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_FABRICANTE ADD CONSTRAINT PK_AGR_FABRICANTE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_MAT_EMBALAGEM ADD CONSTRAINT FK_AGR_MAT_EMBALAGEM PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_MEDIDA_DOSAGEM ADD CONSTRAINT PK_AGR_MEDIDA_DOSAGEM PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_ORIENTACAO_TECNICA ADD CONSTRAINT PK_AGR_ORIENTACAO_TECNICA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_PRAGA ADD CONSTRAINT FK_AGR_PRAGA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE AGR_REGISTRANTE ADD CONSTRAINT FK_AGR_REGISTRANTE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM2_ACERTO_COMISSAO ADD CONSTRAINT FK_CM2_ACERTO_COMISSAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM2_COMISSAO_PARC ADD CONSTRAINT FK_CM2_COMISSAO_PARC PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM2_PARC_ACERTO ADD CONSTRAINT FK_CM2_PARC_ACERTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_COMISSAO ADD CONSTRAINT FK_CM_COMISSAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_COMISSAO_PARC ADD CONSTRAINT FK_CM_COMISSAO_PARC PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_LOG ADD CONSTRAINT FK_CM_LOG PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PARC_PAGAR ADD CONSTRAINT PK_CM_PARC_PAGAR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL ADD CONSTRAINT FK_CM_PERFIL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA ADD CONSTRAINT FK_CM_PERFIL_FAIXA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA_DESC ADD CONSTRAINT FK_CM_PERFIL_FAIXA_DESC PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA_PROD ADD CONSTRAINT FK_CM_PERFIL_FAIXA_PROD PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_PAGTO ADD CONSTRAINT FK_CM_PERFIL_PAGTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_PAGTO_FAIXA ADD CONSTRAINT PK_CM_PERFIL_PAGTO_FAIXA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CM_REL_COM_PGR_REC ADD CONSTRAINT FK_CM_REL_COM_PGR_REC PRIMARY KEY (CODIGO);
ALTER TABLE CRG_CARGAS ADD CONSTRAINT CRG_CARGAS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CRG_FORMAR_CARGA ADD CONSTRAINT FK_CRG_FORMAR_CARGA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CRG_FORMAR_CARGA_ITENS ADD CONSTRAINT FK_CRG_FORMAR_CARGA_ITENS PRIMARY KEY (CNPJ, CODIGO, CRG_CARGA);
ALTER TABLE CRG_MOTORISTAS ADD CONSTRAINT CRG_MOTORISTAS_PK PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE CRG_ORDEM_CARGA ADD CONSTRAINT FK_CRG_ORDEM_CARGA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CRG_ORDEM_CARGA_ITENS ADD CONSTRAINT FK_CRG_ORDEM_CARGA_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE CRG_ROTAS ADD CONSTRAINT CRG_ROTAS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CRG_ROTAS_CIDADES ADD CONSTRAINT CRG_ROTAS_CIDADES_PK PRIMARY KEY (CNPJ, ROTA, CIDADE);
ALTER TABLE CRG_VEICULOS ADD CONSTRAINT CRG_VEICULOS_PK PRIMARY KEY (CNPJ, PLACA);
ALTER TABLE CTB_CHEQUE ADD CONSTRAINT PK_CTB_CHEQUE PRIMARY KEY (CNPJ, CHEQUE, CONTA);
ALTER TABLE CTB_CONFIGURACOES ADD PRIMARY KEY (CNPJ);
ALTER TABLE CTB_CONFIGURA_RELATORIO ADD CONSTRAINT PK_CTB_CONFIGURA_RELATORIO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CTB_CONFIGURA_RELATORIO_CONTAS ADD CONSTRAINT K_CTB_CONFIGURA_REL_CONTAS PRIMARY KEY (CNPJ, CODIGO, CONTA);
ALTER TABLE CTB_DESDOBRA_MOVIMENTO ADD CONSTRAINT PK_CTB_DESDOBRA_MOVIMENTO PRIMARY KEY (CNPJ, PLANILHA);
ALTER TABLE CTB_DESDOBRA_MOVIMENTO_CONTAS ADD CONSTRAINT PK_CTB_DESDOBRA_MOVIMENTO_C PRIMARY KEY (CNPJ, PLANILHA, CONTA);
ALTER TABLE CTB_FLUXO_CAIXA ADD CONSTRAINT PK_CTB_FLUXO_CAIXA PRIMARY KEY (CNPJ, DATA);
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CONSTRAINT PK_CTB_MOVIMENTO_CONTABIL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE CTB_PLANOCONTA ADD CONSTRAINT PK_CTB_PLANOCONTA PRIMARY KEY (CNPJ, CONTA);
ALTER TABLE EST_AGRUPADORES ADD CONSTRAINT FK_EST_AGRUPADORES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS ADD CONSTRAINT PK_EST_ALTERAPRECOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_GRUPO ADD CONSTRAINT PK_EST_ALTERAPRECOS_GRUPO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_GRUPO_PRODUTOS ADD CONSTRAINT PK_EST_ALTPRECOS_GRUPO_PROD PRIMARY KEY (CNPJ, CODIGO, GRUPO);
ALTER TABLE EST_ALTERAPRECOS_MARCA ADD CONSTRAINT PK_EST_ALTERAPRECOS_MARCA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_MARCA_PRODUTOS ADD CONSTRAINT PK_EST_ALTPRECOS_MARCA_PROD PRIMARY KEY (CNPJ, CODIGO, MARCA);
ALTER TABLE EST_ALTERAPRECOS_PRODUTOS ADD CONSTRAINT PK_EST_ALTERAPRECOS_PRODUTOS PRIMARY KEY (CNPJ, CODIGO, PRODUTO);
ALTER TABLE EST_ALTERAPRECOS_UNID ADD CONSTRAINT PK_EST_ALTERAPRECOS_UNID PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_UNID_PRODUTOS ADD CONSTRAINT PK_EST_ALTPRECOS_UNID_PROD PRIMARY KEY (CNPJ, CODIGO, UNIDADE);
ALTER TABLE EST_ALTERA_PRECO ADD CONSTRAINT FK_EST_ALTERA_PRECO PRIMARY KEY (CODIGO);
ALTER TABLE EST_ALTERA_PRECO_ITEM ADD CONSTRAINT FK_EST_ALTERA_PRECO_ITEM PRIMARY KEY (CODIGO);
ALTER TABLE EST_APLICACOES ADD CONSTRAINT EST_APLICACOES_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_CLASSE_GRAO ADD CONSTRAINT FK_EST_CLASSE_GRAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_CONTAGEM ADD CONSTRAINT PK_EST_CONTAGEM PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_CONTAGEM_GRADE ADD CONSTRAINT PK_EST_CONTAGEM_GRADE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_CONTAGEM_GRADE_PRODUTO ADD CONSTRAINT PK_EST_CONTAGEM_GRADE_PRODU PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_CONVERSAO_UNID_MED ADD CONSTRAINT FK_EST_CONVERSAO_UNID_MED PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_COR ADD CONSTRAINT FK_EST_COR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_EMAIL_POSICAO_ESTOQUE ADD CONSTRAINT PK_EST_EMAIL_POSICAO_ESTOQUE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT EST_ENTRADAS_PK PRIMARY KEY (CNPJ, NDOCTO, PESSOA_FJ);
ALTER TABLE EST_ENTRADAS_ITENS ADD CONSTRAINT EST_ENTRADAS_ITENS_PK PRIMARY KEY (CNPJ, NDOCTO, PESSOA_FJ, PRODUTO);
ALTER TABLE EST_ENTRADAS_ITENS_GRADES ADD CONSTRAINT PK_EST_ENTRADAS_ITENS_GRADE PRIMARY KEY (CNPJ, NDOCTO, PESSOA_FJ, PRODUTO, GRADE, NUMERO);
ALTER TABLE EST_ENTRADAS_ITENS_LOTES ADD CONSTRAINT PK_EST_ENTRADAS_ITENS_LOTES PRIMARY KEY (CODIGO);
ALTER TABLE EST_ENTRADAS_MANUAL ADD CONSTRAINT FK_EST_ENTRADAS_MANUAL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_ESTIQUETA_PRODUTO ADD CONSTRAINT PK_EST_ESTIQUETA_PRODUTO PRIMARY KEY (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE EST_ESTIQUETA_PRODUTO_IMPRIME ADD CONSTRAINT FK_EST_ESTIQUETA_PRODUTO_IM PRIMARY KEY (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE EST_FECHAMENTO_MES ADD CONSTRAINT PK_EST_FECHAMENTO_MES PRIMARY KEY (CNPJ, PRODUTO, MES, ANO);
ALTER TABLE EST_GRADES ADD CONSTRAINT EST_GRADES_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_GRADES_ADICIONAL ADD CONSTRAINT PK_EST_GRADES_ADICIONAL PRIMARY KEY (CNPJ, CODIGO, GRADE);
ALTER TABLE EST_GRUPOS ADD CONSTRAINT EST_GRUPOS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_HISTORICO_PRD_CUSTO ADD CONSTRAINT FK_EST_HISTORICO_PRD_CUSTO PRIMARY KEY (CODIGO);
ALTER TABLE EST_INVENTARIO ADD CONSTRAINT EST_INVENTARIO_PK PRIMARY KEY (CNPJ, PRODUTO, DATA);
ALTER TABLE EST_KARDEX ADD CONSTRAINT EST_KARDEX_PK PRIMARY KEY (CNPJ, PRODUTO, CODIGO);
ALTER TABLE EST_LOCALIZACAO ADD CONSTRAINT FK_EST_LOCALIZACAO PRIMARY KEY (CODIGO);
ALTER TABLE EST_LOTE ADD CONSTRAINT FK_EST_LOTE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_LOTE_PRODUTO ADD CONSTRAINT PK_EST_LOTE_PRODUTO PRIMARY KEY (CNPJ, PRODUTO, CODIGO);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_MARCAS ADD CONSTRAINT EST_MARCAS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_MATERIAL ADD CONSTRAINT PK_EST_MATERIAL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_NATUREZA ADD CONSTRAINT EST_NATUREZA_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_PENEIRA ADD CONSTRAINT FK_EST_PENEIRA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_POSICAO_DIARIA ADD CONSTRAINT FK_EST_POSICAO_DIARIA PRIMARY KEY (CNPJ, DATA, PRODUTO, TURNO);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT EST_PRODUTOS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_AGREGADOS ADD CONSTRAINT FK_EST_PRODUTOS_AGREGADOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_APLICACOES ADD CONSTRAINT EST_PRODUTOS_APLICACOES_PK PRIMARY KEY (CNPJ, PRODUTO, APLICACAO);
ALTER TABLE EST_PRODUTOS_GRADES ADD CONSTRAINT PK_EST_PRODUTOS_GRADES PRIMARY KEY (CNPJ, PRODUTO, GRADE);
ALTER TABLE EST_PRODUTOS_GRADES_NUMEROS ADD CONSTRAINT PK_EST_PRODUTOS_GRADES_NUME PRIMARY KEY (CNPJ, PRODUTO, GRADE, NUMERO);
ALTER TABLE EST_PRODUTOS_SIMILARES ADD CONSTRAINT FK_EST_PRODUTOS_SIMILARES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_TRIBUT_REVENDA ADD CONSTRAINT FK_EST_PRODUTOS_TRIBUT_REVE PRIMARY KEY (CNPJ, PRODUTO);
ALTER TABLE EST_PROMOCAO ADD CONSTRAINT PK_EST_PROMOCAO PRIMARY KEY (CNPJ, PRODUTO, VALIDADE);
ALTER TABLE EST_REDUCOES ADD CONSTRAINT EST_REDUCOES_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_SECAO ADD CONSTRAINT FK_EST_SECAO PRIMARY KEY (CNPJ, COD_SECAO);
ALTER TABLE EST_SUBGRUPOS ADD CONSTRAINT EST_SUBGRUPOS_PK PRIMARY KEY (CNPJ, GRUPO, SUBGRUPO);
ALTER TABLE EST_SUBGRUPOS_COTAS ADD CONSTRAINT EST_SUBGRUPOS_COTAS_PK PRIMARY KEY (CNPJ, GRUPO, SUBGRUPO, VENDEDOR);
ALTER TABLE EST_SUBUNIDADES ADD CONSTRAINT PK_EST_SUBUNIDADES PRIMARY KEY (CNPJ, SIGLA, UNIDADES);
ALTER TABLE EST_TIPO_GRAO ADD CONSTRAINT FK_EST_TIPO_GRAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EST_TRANSPORTADORES ADD CONSTRAINT EST_TRANSPORTADORES_PK PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE EST_UNIDADES ADD CONSTRAINT EST_UNIDADES_PK PRIMARY KEY (CNPJ, SIGLA);
ALTER TABLE EXP_CTB_CF_PROSOFT ADD CONSTRAINT FK_EXP_CTB_CF_PROSOFT PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE EXP_CTB_CF_PROSOFT_ALIQ ADD CONSTRAINT FK_EXP_CTB_CF_PROSOFT_ALIQ PRIMARY KEY (CODIGO);
ALTER TABLE FAT_CAIXAS ADD CONSTRAINT PK_FAT_CAIXAS PRIMARY KEY (CNPJ, USUARIO, CONTA, DATA, TURNO);
ALTER TABLE FAT_CAIXAS_FLUXO ADD CONSTRAINT PK_FAT_CAIXAS_FLUXO PRIMARY KEY (CNPJ, USUARIO, CONTA, DATA, TURNO);
ALTER TABLE FAT_CAIXAS_MOVIMENTOS ADD CONSTRAINT PK_FAT_CAIXAS_MOVIMENTOS PRIMARY KEY (CNPJ, USUARIO, CONTA, DATA, DOCUMENTO, TURNO);
ALTER TABLE FAT_CAIXAS_RESUMO ADD CONSTRAINT PK_FAT_CAIXAS_RESUMO PRIMARY KEY (CNPJ, DATA);
ALTER TABLE FAT_CAIXAS_RESUMO_MOVTOS ADD CONSTRAINT PK_FAT_CAIXAS_RESUMO_MOVTOS PRIMARY KEY (CNPJ, DATA, DOCUMENTO);
ALTER TABLE FAT_CAIXAS_SANGRIAS ADD CONSTRAINT PK_FAT_CAIXAS_SANGRIAS PRIMARY KEY (CNPJ, USUARIO, CONTA, DATA, CODIGO, TURNO);
ALTER TABLE FAT_CAIXA_GERAL ADD CONSTRAINT PK_FAT_CAIXA_GERAL PRIMARY KEY (CNPJ, DATA);
ALTER TABLE FAT_CAIXA_GERAL_VENDEDOR ADD CONSTRAINT PK_FAT_CAIXA_GERAL_VENDEDOR PRIMARY KEY (CNPJ, DATA, VENDEDOR);
ALTER TABLE FAT_CARTA_GARANTIAS ADD CONSTRAINT PK_FAT_CARTA_GARANTIAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES ADD CONSTRAINT PK_FAT_COTACOES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES_ITENS ADD CONSTRAINT PK_FAT_COTACOES_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_CUPOM ADD CONSTRAINT PK_FAT_CUPOM PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_CUPOM_ITENS ADD CONSTRAINT PK_FAT_CUPOM_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_GARANTIAS ADD CONSTRAINT PK_FAT_GARANTIAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_GARANTIAS_ITENS ADD CONSTRAINT PK_FAT_GARANTIAS_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO);
ALTER TABLE FAT_GARANTIAS_PARCELAMENTO ADD CONSTRAINT PK_FAT_GARANTIAS_PARCELAMENTO PRIMARY KEY (CNPJ, CODIGO, VENCTO);
ALTER TABLE FAT_ITEMTABELAPRECO ADD CONSTRAINT PK_FAT_ITEMTABELAPRECO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_MESAS ADD CONSTRAINT FK_FAT_MESAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_MICRO_TERMINAL ADD CONSTRAINT FK_FAT_MICRO_TERMINAL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_NOTAS_PRAZO ADD CONSTRAINT PK_FAT_NOTAS_PRAZO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_NOTAS_PRAZO_ITENS ADD CONSTRAINT PK_FAT_NOTAS_PRAZO_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_ORCAMENTOS ADD CONSTRAINT PK_FAT_ORCAMENTOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS_ITENS ADD CONSTRAINT PK_FAT_ORCAMENTOS_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_ORCAMENTOS_ITENS_PECAS ADD CONSTRAINT PK_FAT_ORCAMENTOS_ITENS_PEC PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA, PECA);
ALTER TABLE FAT_ORCAMENTOS_MASCARA ADD CONSTRAINT FK_FAT_ORCAMENTOS_MASCARA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS_MASCARA_NOME ADD CONSTRAINT FK_FAT_ORCAMENTOS_MASCARA_N PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TABELAPRECO ADD CONSTRAINT PK_FAT_TABELAPRECO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TBL_VD_TABELA ADD CONSTRAINT FK_FAT_TBL_VD_TABELA1 PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TBL_VENDEDOR ADD CONSTRAINT PK_FAT_TBL_VENDEDOR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TERCEIROS ADD CONSTRAINT PK_FAT_TERCEIROS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TIPOTABELAPRECO ADD CONSTRAINT PK_FAT_TIPOTABELAPRECO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TROCAS ADD CONSTRAINT PK_FAT_TROCAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_TROCAS_ITENS ADD CONSTRAINT "pK_FAT_TROCAS_ITENS" PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_TROCAS_PARCELAMENTO ADD CONSTRAINT PK_FAT_TROCAS_PARCELAMENTO PRIMARY KEY (CNPJ, CODIGO, VENCTO);
ALTER TABLE FAT_USUARIOS_CAIXA ADD CONSTRAINT PK_FAT_CAIXA PRIMARY KEY (CNPJ, USUARIO, CONTA);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT PK_FAT_VENDAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_COR ADD CONSTRAINT PK_FAT_VENDAS_COR PRIMARY KEY (CNPJ, CODIGO, COR, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_VENDAS_FRMPAGTO ADD CONSTRAINT PK_FAT_VENDAS_FRMPAGTO PRIMARY KEY (CNPJ, CODIGO, FORMA_PGTO, SEQUENCIA);
ALTER TABLE FAT_VENDAS_GARANTIA ADD CONSTRAINT PK_FAT_VENDAS_GARANTIA PRIMARY KEY (CNPJ, CODIGO, GARANTIA);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT PK_FAT_VENDAS_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_VENDAS_ITENS_COMISSOES ADD CONSTRAINT FK_FAT_VENDAS_ITENS_COMISSOES PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE FAT_VENDAS_PARCELAMENTO ADD CONSTRAINT PK_FAT_VENDAS_PARCELAMENTO PRIMARY KEY (CNPJ, CODIGO, VENCTO);
ALTER TABLE FAT_VENDAS_VEICULO ADD CONSTRAINT PK_FAT_VENDAS_VEICULO PRIMARY KEY (CNPJ, CODIGO, VEICULO);
ALTER TABLE FAT_VENDEDOR ADD CONSTRAINT PK_FAT_VENDEDOR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_ADMINISTRADORA ADD CONSTRAINT PK_FIN_ADMINISTRADORA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_ANALISE_CUSTO ADD CONSTRAINT PK_FIN_ANALISE_CUSTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_ANALISE_CUSTO_ITENS ADD CONSTRAINT PK_FIN_ANALISE_CUSTO_ITENS PRIMARY KEY (CNPJ, CODIGO, PRODUTO);
ALTER TABLE FIN_AVISOS ADD CONSTRAINT FIN_AVISOS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT PK_FIN_BAIXAS_PAGAR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT PK_FIN_BAIXAS_RECEBER PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_BANCO ADD CONSTRAINT PK_FIN_BANCO PRIMARY KEY (CODIGO);
ALTER TABLE FIN_CENTRO_CUSTO ADD CONSTRAINT PK_FIN_CENTRO_CUSTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT PK_FIN_CHEQUES PRIMARY KEY (CNPJ, BANCO, CONTA, CHEQUE);
ALTER TABLE FIN_COBRADOR ADD CONSTRAINT PK_FIN_COBRADOR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_COMISSAO_PRODUTO ADD CONSTRAINT PK_FIN_COMISSAO_PRODUTO PRIMARY KEY (CNPJ, PRODUTO, VENDEDOR);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT PK_FIN_CONTAS_PAGAR PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT PK_FIN_CONTAS_RECEBER PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_COTACOES ADD CONSTRAINT FK_FIN_COTACOES PRIMARY KEY (CODIGO);
ALTER TABLE FIN_FATURAS ADD CONSTRAINT PK_FIN_FATURAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_FATURAS_ADICIONAL ADD CONSTRAINT PK_FIN_FATURAS_ADICIONAL PRIMARY KEY (CNPJ, CODIGO, DOCUMENTO);
ALTER TABLE FIN_FATURAS_PARCELAMENTO ADD CONSTRAINT PK_FIN_FATURAS_PARCELAMENTO PRIMARY KEY (CNPJ, CODIGO, DATA);
ALTER TABLE FIN_FATURAS_PARCIAL ADD CONSTRAINT FK_FIN_FATURAS_PARCIAL PRIMARY KEY (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE FIN_FOLHA_PAGTO ADD CONSTRAINT FK_FIN_FOLHA_PAGTO PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE FIN_FOLHA_TIPO_MOVIMENTO ADD CONSTRAINT FK_FIN_FOLHA_TIPO_MOVIMENTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_FORMAS_PAGTO ADD CONSTRAINT PK_FIN_FORMAS_PAGTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_FORMAS_PAGTO_PARCELAS ADD CONSTRAINT PK_FIN_FORMAS_PAGTO_PARCELA PRIMARY KEY (CNPJ, CODIGO, PARCELA);
ALTER TABLE FIN_FUNCIONARIOS ADD CONSTRAINT PK_FIN_FUNCIONARIOS PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE FIN_LOCAL_COBRANCA ADD CONSTRAINT PK_FIN_LOCAL_COBRANCA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_MOEDA ADD CONSTRAINT FK_FIN_MOEDA PRIMARY KEY (CODIGO);
ALTER TABLE FIN_MOTIVO_COBRANCA ADD CONSTRAINT FK_FIN_MOTIVO_COBRANCA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_MOTIVO_DEVOLUCAO ADD CONSTRAINT PK_FIN_MOTIVO_DEVOLUCAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_MOVIMENTO_CARTAO ADD CONSTRAINT PK_FIN_MOVIMENTO_CARTAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_MOV_CARTAO_RECEBER ADD CONSTRAINT FK_FIN_MOV_CARTAO_RECEBER PRIMARY KEY (MOV_ID);
ALTER TABLE FIN_RECIBOS ADD CONSTRAINT PK_FIN_RECIBOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE FIN_RECIBOS_PAGAS ADD CONSTRAINT PK_FIN_RECIBOS_PAGAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_ATIVIDADES ADD CONSTRAINT GLO_ATIVIDADES_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_BAIRROS ADD CONSTRAINT GLO_BAIRROS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_CIDADES ADD CONSTRAINT GLO_CIDADES_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_CLASSIFICACAO ADD CONSTRAINT PK_GLO_CLASSIFICACAO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES ADD CONSTRAINT GLO_CLIENTES_PK PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE GLO_CLIENTES_IMAGENS ADD CONSTRAINT PK_GLO_CLIENTES_IMAGENS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES_PRODUTOS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE GLO_CLIENTES_PRODUTOS_ITENS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS_ITENS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT PK_GLO_CLIENTE_ENDERECO PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE GLO_CONTAS_PESSOAS ADD CONSTRAINT PK_GLO_CONTAS_PESSOAS PRIMARY KEY (CNPJ, PESSOA_FJ, BANCO, AGENCIA, CONTA);
ALTER TABLE GLO_CONTATOS ADD CONSTRAINT PK_GLO_CONTATOS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE GLO_DECLARACAO_VENDA ADD CONSTRAINT PK_GLO_DECLARACAO_VENDA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_DEPARTAMENTO ADD CONSTRAINT PK_GLO_DEPARTAMENTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_ESTADOS ADD CONSTRAINT GLO_ESTADOS_PK PRIMARY KEY (CNPJ, SIGLA);
ALTER TABLE GLO_FORNECEDORES ADD CONSTRAINT GLO_FORNECEDORES_PK PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE GLO_INDICACOES ADD CONSTRAINT PK_GLO_INDICACOES PRIMARY KEY (CNPJ, PESSOA_FJ, INDICADO);
ALTER TABLE GLO_LOGRADOUROS ADD CONSTRAINT GLO_LOGRADOUROS_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_MARCA_VEICULOS ADD CONSTRAINT PK_GLO_MARCA_VEICULOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_MENSALIDADES ADD CONSTRAINT PK_GLO_MENSALIDADES PRIMARY KEY (CNPJ, PESSOA_FJ);
ALTER TABLE GLO_MODELO_PROPRIEDADE ADD CONSTRAINT GLO_MODELO_PROPRIEDADE_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_PAIS ADD CONSTRAINT FK_GLO_PAIS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_PATRIMONIO ADD CONSTRAINT PK_GLO_PATRIMONIO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_PATRIMONIO_GARANTIAS ADD CONSTRAINT PK_GLO_PATRIMONIO_GARANTIAS PRIMARY KEY (CNPJ, CODIGO, PECA, DATA);
ALTER TABLE GLO_PATRIMONIO_SAIDA ADD CONSTRAINT PK_GLO_PATRIMONIO_SAIDA PRIMARY KEY (CNPJ, CODIGO, HORA_SAIDA);
ALTER TABLE GLO_PECAS_PATRIMONIO ADD CONSTRAINT PK_GLO_PECAS_PATRIMONIO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_PRECOS_ESPECIAIS ADD CONSTRAINT PK_GLO_PRECOS_ESPECIAIS PRIMARY KEY (CNPJ, PESSOA_FJ, PRODUTO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_PK PRIMARY KEY (CNPJ, PESSOA_FJ, PROPRIEDADE);
ALTER TABLE GLO_REGIOES ADD CONSTRAINT FK_GLO_REGIOES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_TIPOS_DOCTO ADD CONSTRAINT GLO_TIPOS_DOCTO_PK PRIMARY KEY (CNPJ, SIGLA);
ALTER TABLE GLO_TIPO_CONTATO ADD CONSTRAINT PK_GLO_TIPO_CONTATO PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE GLO_TIPO_CONTRATO ADD CONSTRAINT GLO_TIPO_CONTRATO_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_TIPO_ENDERECO ADD CONSTRAINT PK_GLO_TIPO_ENDERECO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_TIPO_VEICULOS ADD CONSTRAINT PK_GLO_TIPO_VEICULOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_TRANSPORTADORAS ADD CONSTRAINT PK_GLO_TRANSPORTADORAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE GLO_VEICULOS ADD CONSTRAINT PK_GLO_VEICULOS PRIMARY KEY (CNPJ, CODIGO, PESSOA_FJ);
ALTER TABLE IBE$LOG_TABLES ADD PRIMARY KEY (ID);
ALTER TABLE LOG_FAT_VENDAS ADD CONSTRAINT FK_LOG_FAT_VENDAS PRIMARY KEY (ID);
ALTER TABLE NFE_XML_LOG ADD CONSTRAINT FK_NFE_XML_LOG PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_CONTRATOS ADD CONSTRAINT PK_OFC_CONTRATOS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE OFC_CONTRATOS_ITENS ADD CONSTRAINT PK_OFC_CONTRATOS_ITENS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE OFC_CONTRATOS_ITENS_DESC ADD CONSTRAINT FK_OFC_CONTRATOS_ITENS_DESC PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_CTRL_QUALIDADE ADD CONSTRAINT PK_OFC_CTRL_QUALIDADE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_DEFEITO ADD CONSTRAINT OFC_DEFEITO_PK PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_GRAVIDADE ADD CONSTRAINT PK_OFC_GRAVIDADE PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_GRP_CONTRATOS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_GRP_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS_ITENS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_LEITURAS ADD CONSTRAINT PK_OFC_LEITURAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_LEITURAS_ITENS ADD CONSTRAINT PK_OFC_LEITURAS_ITENS PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE OFC_LOG_STATUS ADD CONSTRAINT FK_OFC_LOG_STATUS PRIMARY KEY (ID);
ALTER TABLE OFC_MECANICOS ADD CONSTRAINT PK_OFC_MECANICOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_MENSALIDADES ADD CONSTRAINT PK_OFC_MENSALIDADES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_MENSALIDADES_ITENS ADD CONSTRAINT PK_OFC_MENSALIDADES_ITENS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_MOTIVO_CHAMADO ADD CONSTRAINT FK_OFC_MOTIVO_CHAMADO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_MOTORES ADD CONSTRAINT PK_OFC_MOTORES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_MOTORES_SERVICOS ADD CONSTRAINT PK_OFC_MOTORES_SERVICOS PRIMARY KEY (CNPJ, MOTOR, SERVICO);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT PK_OFC_ORDEM_SERVICO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTERVALO PRIMARY KEY (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE OFC_ORDEM_SERVICO_MOVIMENTO ADD CONSTRAINT PK_OFC_ORDEM_SERVICO_MOVIME PRIMARY KEY (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE OFC_ORDEM_SERVICO_ORC ADD CONSTRAINT PK_OFC_ORD_SERV_ORC PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_PARCELAMENTO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_PARCEL PRIMARY KEY (CNPJ, CODIGO, VENCTO);
ALTER TABLE OFC_ORDEM_SERVICO_SERVICO_ORC ADD CONSTRAINT FK_OFC_ORDEM_SERV_SERV_ORC PRIMARY KEY (CNPJ, CODIGO, SERVICO);
ALTER TABLE OFC_OS_ANEXOS ADD CONSTRAINT FK_OFC_OS_ANEXOS12 PRIMARY KEY (CNPJ, CODIGO, FILENAME);
ALTER TABLE OFC_O_S_INTERVALO_EMAIL ADD CONSTRAINT FK_OFC_O_S_INTERVALO_EMAIL PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_PENDENCIA ADD CONSTRAINT FK_OFC_PENDENCIA PRIMARY KEY (CODIGO, CNPJ);
ALTER TABLE OFC_SERVICOS ADD CONSTRAINT PK_OFC_SERVICOS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_STATUS ADD CONSTRAINT FK_OFC_STATUS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_TIPO_ATENDIMENTO ADD CONSTRAINT FK_OFC_TIPO_ATENDIMENTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_TIPO_MOVTO ADD CONSTRAINT FK_OFC_TIPO_MOVTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE OFC_VIAJANTES ADD CONSTRAINT PK_OFC_VIAJANTES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE PST_VENDEDOR_CAIXA ADD CONSTRAINT PK_PST_VENDEDOR_CAIXA PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE SIS_BOLETOBANCARIO ADD CONSTRAINT PK_SIS_BOLETOBANCARIO PRIMARY KEY (CNPJ, BANCO);
ALTER TABLE SIS_CONFIG_REL ADD CONSTRAINT FK_SIS_CONFIG_REL PRIMARY KEY (ID, CNPJ);
ALTER TABLE SIS_CONF_CHEQUE ADD CONSTRAINT PK_SIS_CONF_CHEQUE PRIMARY KEY (CONTA);
ALTER TABLE SIS_CONF_ETIQUETAS ADD CONSTRAINT PK_SIS_CONF_ETIQUETAS PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE SIS_DIREITOS_PERFIL ADD CONSTRAINT SIS_DIREITOS_PERFIL_PK PRIMARY KEY (PERFIL, MODULO);
ALTER TABLE SIS_DOCUMENTOS ADD CONSTRAINT FK_SIS_DOCUMENTOS PRIMARY KEY (CNPJ);
ALTER TABLE SIS_DUPLICATA ADD CONSTRAINT PK_SIS_DUPLICATA PRIMARY KEY (CNPJ);
ALTER TABLE SIS_EMPRESAS ADD CONSTRAINT SIS_EMPRESAS_PK PRIMARY KEY (CNPJ);
ALTER TABLE SIS_LOG_TRANSACOES ADD CONSTRAINT PK_SIS_LOG_TRANSACOES PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE SIS_MENSAGENS ADD CONSTRAINT SIS_MENSAGENS_PK PRIMARY KEY (CODIGO, ANO);
ALTER TABLE SIS_MENU ADD CONSTRAINT FK_SIS_MENU PRIMARY KEY (CNPJ, CATEGORIA, COMPUTADOR);
ALTER TABLE SIS_MENU_ITEM ADD CONSTRAINT FK_SIS_MENU_ITEM PRIMARY KEY (CNPJ, CATEGORIA, COMPUTADOR, NOME);
ALTER TABLE SIS_MODULOS ADD CONSTRAINT SIS_MODULOS_PK PRIMARY KEY (CODIGO);
ALTER TABLE SIS_NOTAPROMISSORIA ADD CONSTRAINT PK_SIS_NOTAPROMISSORIA PRIMARY KEY (CNPJ);
ALTER TABLE SIS_PERFIL ADD CONSTRAINT SIS_PERFIL_PK PRIMARY KEY (CODIGO);
ALTER TABLE SIS_PERFIL_COMPUTADOR ADD CONSTRAINT FK_SIS_PERFIL_COMPUTADOR PRIMARY KEY (CNPJ, COMPUTADOR);
ALTER TABLE SIS_RELACIONAMENTOS ADD CONSTRAINT SIS_RELACIONAMENTOS_PK PRIMARY KEY (TABELA, CAMPO, TABELA_REL, CAMPO_REL);
ALTER TABLE SIS_RELEASE ADD CONSTRAINT FK_SIS_RELEASE PRIMARY KEY (CODIGO);
ALTER TABLE SIS_SERIENF ADD CONSTRAINT FK_SIS_SERIENF PRIMARY KEY (CNPJ, SERIE);
ALTER TABLE SIS_TABELAS_SISTEMA ADD PRIMARY KEY (TABELA);
ALTER TABLE SIS_TABELAS_SISTEMA_CAMPOS ADD CONSTRAINT PK_SIS_TABELAS_SISTEMA_CAMPOS PRIMARY KEY (TABELA, CAMPO);
ALTER TABLE SIS_USUARIOS ADD CONSTRAINT SIS_USUARIOS_PK PRIMARY KEY (CODIGO);
ALTER TABLE TABELAPRECOCONDPAGAMENTO ADD CONSTRAINT PK_TABELAPRECOCONDPAGAMENTO PRIMARY KEY (CNPJ, CODIGO);
ALTER TABLE TBL_TESTE ADD CONSTRAINT FK_TBL_TESTE PRIMARY KEY (CODIGO);
ALTER TABLE TEMP_CUSTO_MEDIO ADD CONSTRAINT FK_TEMP_CUSTO_MEDIO PRIMARY KEY (CODIGO);


/******************************************************************************/
/****                             Foreign Keys                             ****/
/******************************************************************************/

ALTER TABLE ACT_ACERTOCONTA ADD CONSTRAINT FK_ACT_ACERTOCONTA_RE FOREIGN KEY (CNPJ, PESSOA_RECIBO) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE ACT_CONFIGURACAOTITULO ADD CONSTRAINT FK_ACT_CONFIGURACAOTITULO FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE ACT_CONFIGURACAOTITULO ADD CONSTRAINT FK_ACT_CONFIGURACAOTITULO2 FOREIGN KEY (COD_JURO_POS_FIXADO) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE ACT_TITULOGERADO ADD CONSTRAINT FK_ACT_TITULOGERADO2 FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT FK_AGR_DEFENSIVOCULTURAPRA1 FOREIGN KEY (CNPJ, IDCULTURA) REFERENCES AGR_CULTURA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT FK_AGR_DEFENSIVOCULTURAPRA2 FOREIGN KEY (CNPJ, IDPRAGA) REFERENCES AGR_PRAGA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT FK_AGR_DEFENSIVOCULTURAPRA3 FOREIGN KEY (CNPJ, IDMEDIDADOSAGEM) REFERENCES AGR_MEDIDA_DOSAGEM (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT FK_AGR_DEFENSIVOCULTURAPRA4 FOREIGN KEY (CNPJ, IDMEDIDAVAZAO) REFERENCES AGR_MEDIDA_DOSAGEM (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVOCULTURAPRAGA ADD CONSTRAINT FK_AGR_DEFENSIVOCULTURAPRAG FOREIGN KEY (CNPJ, IDDEFENSIVOAGRICOLA) REFERENCES AGR_DEFENSIVO_AGRICOLA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA FOREIGN KEY (CNPJ, COD_CLASSIFICACAO_AMBIENTAL) REFERENCES AGR_CLASSIFICACAO_AMBIENTAL (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA1 FOREIGN KEY (CNPJ, COD_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA10 FOREIGN KEY (CNPJ, COD_FABRICANTE) REFERENCES AGR_FABRICANTE (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA11 FOREIGN KEY (CNPJ, COD_MAT_EMBALAGEM) REFERENCES AGR_MAT_EMBALAGEM (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA2 FOREIGN KEY (CNPJ, COD_CATEGORIA_DEFENSIVO) REFERENCES AGR_CATEGORIA_DEFENSIVO (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA3 FOREIGN KEY (CNPJ, COD_CLASSE_TOXICOLOGICA) REFERENCES AGR_CLASSE_TOXICOLOGICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA4 FOREIGN KEY (CNPJ, COD_CLASSIFICACAO_QUIMICA) REFERENCES AGR_CLASSIFICAO_QUIMICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA5 FOREIGN KEY (CNPJ, COD_ORIENTACAO_TECNICA) REFERENCES AGR_ORIENTACAO_TECNICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA6 FOREIGN KEY (CNPJ, COD_ORIENTACAO_COMPLEMENTAR) REFERENCES AGR_ORIENTACAO_TECNICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA7 FOREIGN KEY (CNPJ, COD_INFORMACAO_APLICACAO) REFERENCES AGR_ORIENTACAO_TECNICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA8 FOREIGN KEY (CNPJ, COD_ORIENTACAO_EQUIPAMENTO) REFERENCES AGR_ORIENTACAO_TECNICA (CNPJ, CODIGO);
ALTER TABLE AGR_DEFENSIVO_AGRICOLA ADD CONSTRAINT FK_AGR_DEFENSIVO_AGRICOLA9 FOREIGN KEY (CNPJ, COD_REGISTRANTE) REFERENCES AGR_REGISTRANTE (CNPJ, CODIGO);
ALTER TABLE AGR_MEDIDA_DOSAGEM ADD CONSTRAINT FK_AGR_MEDIDA_DOSAGEM FOREIGN KEY (CNPJ, IDUNIDADEMEDIDA_DE) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE AGR_MEDIDA_DOSAGEM ADD CONSTRAINT FK_AGR_MEDIDA_DOSAGEM1 FOREIGN KEY (CNPJ, IDUNIDADEMEDIDA_POR) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS1 FOREIGN KEY (CNPJ, COD_FATURAMENTO, PRODUTO, SEQUENCIA) REFERENCES FAT_VENDAS_ITENS (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS2 FOREIGN KEY (CNPJ, COD_PRAGA) REFERENCES AGR_PRAGA (CNPJ, CODIGO);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS3 FOREIGN KEY (CNPJ, COD_CULTURA) REFERENCES AGR_CULTURA (CNPJ, CODIGO);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS4 FOREIGN KEY (CNPJ, COD_DEFENSIVO) REFERENCES AGR_DEFENSIVO_AGRICOLA (CNPJ, CODIGO);
ALTER TABLE AGR_RECEITAS ADD CONSTRAINT FK_AGR_RECEITAS5 FOREIGN KEY (CNPJ, COD_TECNICO) REFERENCES OFC_MECANICOS (CNPJ, CODIGO);
ALTER TABLE CM2_COMISSAO_PARC ADD CONSTRAINT FK_CM2_COMISSAO_PARC1 FOREIGN KEY (CNPJ, COD_PESSOA) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE CM2_COMISSAO_PARC ADD CONSTRAINT FK_CM2_COMISSAO_PARC2 FOREIGN KEY (CNPJ, COD_VENDA) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE CM2_PARC_ACERTO ADD CONSTRAINT FK_CM2_PARC_ACERTO1 FOREIGN KEY (CNPJ, COD_COMISSAO) REFERENCES CM2_COMISSAO_PARC (CNPJ, CODIGO);
ALTER TABLE CM2_PARC_ACERTO ADD CONSTRAINT FK_CM2_PARC_ACERTO2 FOREIGN KEY (CNPJ, COD_ACERTO) REFERENCES CM2_ACERTO_COMISSAO (CNPJ, CODIGO);
ALTER TABLE CM_COMISSAO_PARC ADD CONSTRAINT FK_CM_COMISSAO_PARC_1 FOREIGN KEY (CNPJ, COD_COMISSAO) REFERENCES CM_COMISSAO (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA ADD CONSTRAINT FK_CM_PERFIL_FAIXA_1 FOREIGN KEY (CNPJ, COD_PERFIL) REFERENCES CM_PERFIL (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA_DESC ADD CONSTRAINT FK_CM_PERFIL_FAIXA_DESC_1 FOREIGN KEY (CNPJ, COD_PERFIL_FAIXA) REFERENCES CM_PERFIL_FAIXA (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA_PROD ADD CONSTRAINT FK_CM_PERFIL_FAIXA_PROD_1 FOREIGN KEY (CNPJ, COD_PERFIL_FX_DESC) REFERENCES CM_PERFIL_FAIXA_DESC (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_FAIXA_PROD ADD CONSTRAINT FK_CM_PERFIL_FAIXA_PROD_2 FOREIGN KEY (CNPJ, COD_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE CM_PERFIL_PAGTO_FAIXA ADD CONSTRAINT FK_CM_PERFIL_PAGTO_FAIXA FOREIGN KEY (CNPJ, COD_PERFIL_PAGTO) REFERENCES CM_PERFIL_PAGTO (CNPJ, CODIGO);
ALTER TABLE CRG_CARGAS ADD CONSTRAINT CRG_CARGAS_FK0 FOREIGN KEY (CNPJ, MOTORISTA) REFERENCES CRG_MOTORISTAS (CNPJ, PESSOA_FJ);
ALTER TABLE CRG_CARGAS ADD CONSTRAINT CRG_CARGAS_FK1 FOREIGN KEY (CNPJ, VEICULO) REFERENCES CRG_VEICULOS (CNPJ, PLACA);
ALTER TABLE CRG_CARGAS ADD CONSTRAINT CRG_CARGAS_FK2 FOREIGN KEY (CNPJ, ROTA) REFERENCES CRG_ROTAS (CNPJ, CODIGO);
ALTER TABLE CRG_CARGAS ADD CONSTRAINT FK_CRG_CARGAS_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CRG_FORMAR_CARGA_ITENS ADD CONSTRAINT FK_CRG_FORMAR_CARGA_ITENS2 FOREIGN KEY (CNPJ, CODIGO) REFERENCES CRG_FORMAR_CARGA (CNPJ, CODIGO);
ALTER TABLE CRG_MOTORISTAS ADD CONSTRAINT CRG_MOTORISTAS_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE CRG_MOTORISTAS ADD CONSTRAINT FK_CRG_MOTORISTAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CRG_ORDEM_CARGA ADD CONSTRAINT FK_CRG_ORDEM_CARGA3434 FOREIGN KEY (CNPJ, CODIGO_VND) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE CRG_ORDEM_CARGA_ITENS ADD CONSTRAINT FK_CRG_ORDEM_CARGA_ITENS33 FOREIGN KEY (CNPJ, CODIGO_VND) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE CRG_ROTAS ADD CONSTRAINT CRG_ROTAS_FK0 FOREIGN KEY (CNPJ, VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE CRG_ROTAS ADD CONSTRAINT FK_CRG_ROTAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CRG_ROTAS_CIDADES ADD CONSTRAINT CRG_ROTAS_CIDADES_FK0 FOREIGN KEY (CNPJ, ROTA) REFERENCES CRG_ROTAS (CNPJ, CODIGO);
ALTER TABLE CRG_ROTAS_CIDADES ADD CONSTRAINT CRG_ROTAS_CIDADES_FK1 FOREIGN KEY (CNPJ, CIDADE) REFERENCES GLO_CIDADES (CNPJ, CODIGO);
ALTER TABLE CRG_VEICULOS ADD CONSTRAINT FK_CRG_VEICULOS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CTB_CHEQUE ADD CONSTRAINT FK_CTB_CHEQUE FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CTB_CHEQUE ADD CONSTRAINT FK_CTB_CHEQUE_ACT FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE CTB_CONFIGURA_RELATORIO_CONTAS ADD CONSTRAINT FK_CTB_CONFIGURA_RELATORIO FOREIGN KEY (CNPJ, CODIGO) REFERENCES CTB_CONFIGURA_RELATORIO (CNPJ, CODIGO);
ALTER TABLE CTB_DESDOBRA_MOVIMENTO ADD CONSTRAINT FK_CTB_DESDOBRA_MOVIMENTO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CTB_DESDOBRA_MOVIMENTO_CONTAS ADD CONSTRAINT FK_CTB_DESDOBRA_MOVIMENTO_C FOREIGN KEY (CNPJ, PLANILHA) REFERENCES CTB_DESDOBRA_MOVIMENTO (CNPJ, PLANILHA);
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CONSTRAINT FK_CTB_MOVIMENTO_CONTABIL FOREIGN KEY (CNPJ, CONTA) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CONSTRAINT FK_CTB_MOVIMENTO_CONTABIL_2 FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE CTB_MOVIMENTO_CONTABIL ADD CONSTRAINT FK_CTB_MOVIMENTO_CONTABIL_EMPRE FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE CTB_PLANOCONTA ADD CONSTRAINT FK_CTB_PLANOCONTA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_AGRUPADORES ADD CONSTRAINT FK_EST_AGRUPADORES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ALTERAPRECOS ADD CONSTRAINT FK_EST_ALTERAPRECOS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ALTERAPRECOS_MARCA_PRODUTOS ADD CONSTRAINT FK_EST_ALTPRECOS_MARCA_PROD FOREIGN KEY (CNPJ, CODIGO) REFERENCES EST_ALTERAPRECOS_MARCA (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_PRODUTOS ADD CONSTRAINT FK_EST_ALTERAPRECOS_PRODUTOS FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_ALTERAPRECOS_PRODUTOS ADD CONSTRAINT FK_EST_ALTERAPRE_PROD_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ALTERAPRECOS_UNID_PRODUTOS ADD CONSTRAINT FK_EST_ALTPRECOS_UNID_PROD_UNID FOREIGN KEY (CNPJ, UNIDADE) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_ALTERA_PRECO ADD CONSTRAINT FK_EST_ALTERA_PRECO_2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ALTERA_PRECO ADD CONSTRAINT FK_EST_ALTERA_PRECO_3 FOREIGN KEY (CNPJ, FLT_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_ALTERA_PRECO ADD CONSTRAINT FK_EST_ALTERA_PRECO_4 FOREIGN KEY (CNPJ, FLT_MARCA) REFERENCES EST_MARCAS (CNPJ, CODIGO);
ALTER TABLE EST_ALTERA_PRECO ADD CONSTRAINT FK_EST_ALTERA_PRECO_5 FOREIGN KEY (CNPJ, FLT_GRUPO) REFERENCES EST_GRUPOS (CNPJ, CODIGO);
ALTER TABLE EST_ALTERA_PRECO_ITEM ADD CONSTRAINT FK_EST_ALTERA_PRECO_ITEM_1 FOREIGN KEY (COD_ALTERA_PRECO) REFERENCES EST_ALTERA_PRECO (CODIGO);
ALTER TABLE EST_CLASSE_GRAO ADD CONSTRAINT FK_EST_CLASSE_GRAO2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_CONTAGEM ADD CONSTRAINT FK_EST_CONTAGEM_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_CONTAGEM_PRODUTOS ADD CONSTRAINT FK_EST_CONTAGEM_PRODUTOS FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_CONVERSAO_UNID_MED ADD CONSTRAINT FK_EST_CONVERSAO_UNID_MED1 FOREIGN KEY (CNPJ, COD_UND_PADRAO) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_CONVERSAO_UNID_MED ADD CONSTRAINT FK_EST_CONVERSAO_UNID_MED2 FOREIGN KEY (CNPJ, COD_UND_CONVERSAO) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_COR ADD CONSTRAINT FK_EST_COR_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_EMAIL_POSICAO_ESTOQUE ADD CONSTRAINT FK_EST_EMAIL_POSICAO_ESTOQUE_1 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT EST_ENTRADAS_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT EST_ENTRADAS_FK1 FOREIGN KEY (CNPJ, NATUREZA) REFERENCES EST_NATUREZA (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT EST_ENTRADAS_FK2 FOREIGN KEY (CNPJ, TIPO_DOCTO) REFERENCES GLO_TIPOS_DOCTO (CNPJ, SIGLA);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT FK_EST_ENTRADAS_3 FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT FK_EST_ENTRADAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ENTRADAS ADD CONSTRAINT FK_EST_ENTRADAS_FPGTO FOREIGN KEY (CNPJ, COD_FORMA_PAGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS_FATURAMENTO ADD CONSTRAINT EST_ENTRADAS_FATURAMENTO_FK0 FOREIGN KEY (CNPJ, NDOCTO, PESSOA_FJ) REFERENCES EST_ENTRADAS (CNPJ, NDOCTO, PESSOA_FJ);
ALTER TABLE EST_ENTRADAS_FATURAMENTO ADD CONSTRAINT FK_EST_ENTRADAS_CREDOR FOREIGN KEY (CNPJ, COD_CREDOR) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS_FATURAMENTO ADD CONSTRAINT FK_EST_ENTRADAS_FATU_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_ENTRADAS_ITENS ADD CONSTRAINT EST_ENTRADAS_ITENS_FK1 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_ENTRADAS_ITENS ADD CONSTRAINT FK_EST_ENTRADAS_ITENS FOREIGN KEY (CNPJ, UNIDADE) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_ENTRADAS_ITENS ADD CONSTRAINT FK_EST_ENTRADAS_ITENS3 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE EST_ESTIQUETA_PRODUTO ADD CONSTRAINT FK_EST_ESTIQUETA_PRODUTO FOREIGN KEY (CNPJ, CODIGO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO) ON UPDATE CASCADE;
ALTER TABLE EST_GRUPOS ADD CONSTRAINT EST_GRUPOS_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE EST_INVENTARIO ADD CONSTRAINT EST_INVENTARIO_FK1 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_INVENTARIO ADD CONSTRAINT FK_EST_INVENTARIO_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_KARDEX ADD CONSTRAINT EST_KARDEX_FK0 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_KARDEX ADD CONSTRAINT EST_KARDEX_FK1 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE EST_KARDEX ADD CONSTRAINT FK_EST_KARDEX_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_LOCALIZACAO ADD CONSTRAINT FK_EST_LOCALIZACAO_1 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_LOTE ADD CONSTRAINT FK_EST_LOTE2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_LOTE ADD CONSTRAINT FK_EST_LOTE3 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_LOTE_PRODUTO ADD CONSTRAINT FK_EST_LOTE_PRODUTO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES3 FOREIGN KEY (CNPJ, FK_PENEIRA) REFERENCES EST_PENEIRA (CNPJ, CODIGO);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES4 FOREIGN KEY (CNPJ, FK_TIPO_GRAO) REFERENCES EST_TIPO_GRAO (CNPJ, CODIGO);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES5 FOREIGN KEY (CNPJ, FK_CLASSE_GRAO) REFERENCES EST_CLASSE_GRAO (CNPJ, CODIGO);
ALTER TABLE EST_LOTE_SEMENTES ADD CONSTRAINT FK_EST_LOTE_SEMENTES6 FOREIGN KEY (CNPJ, FK_FORNECEDOR) REFERENCES GLO_FORNECEDORES (CNPJ, PESSOA_FJ);
ALTER TABLE EST_MARCAS ADD CONSTRAINT EST_MARCAS_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE EST_MATERIAL ADD CONSTRAINT FK_EST_MATERIAL FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_PENEIRA ADD CONSTRAINT FK_EST_PENEIRA2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_12 FOREIGN KEY (CNPJ, SECAO) REFERENCES EST_SECAO (CNPJ, COD_SECAO);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_13 FOREIGN KEY (CNPJ, UND_PRIMARIA) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_14 FOREIGN KEY (CNPJ, UND_CARREGAMENTO) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_15 FOREIGN KEY (CNPJ, COR) REFERENCES EST_COR (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_16 FOREIGN KEY (CNPJ, MATERIAL) REFERENCES EST_MATERIAL (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS ADD CONSTRAINT FK_EST_PRODUTOS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_PRODUTOS_AGREGADOS ADD CONSTRAINT FK_EST_PRODUTOS_AGREGADOS2 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_AGREGADOS ADD CONSTRAINT FK_EST_PRODUTOS_AGREGADOS3 FOREIGN KEY (CNPJ, PRODUTO2) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_APLICACOES ADD CONSTRAINT EST_PRODUTOS_APLICACOES_FK0 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO) ON UPDATE CASCADE;
ALTER TABLE EST_PRODUTOS_APLICACOES ADD CONSTRAINT EST_PRODUTOS_APLICACOES_FK1 FOREIGN KEY (CNPJ, APLICACAO) REFERENCES EST_APLICACOES (CNPJ, CODIGO) ON UPDATE CASCADE;
ALTER TABLE EST_PRODUTOS_GRADES ADD CONSTRAINT FK_EST_PRODUTOS_GRADES_COR FOREIGN KEY (CNPJ, COR) REFERENCES EST_COR (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_GRADES ADD CONSTRAINT FK_EST_PRODUTOS_GRADES_MATE FOREIGN KEY (CNPJ, MATERIAL) REFERENCES EST_MATERIAL (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_SIMILARES ADD CONSTRAINT EST_PRODUTOS_SIMILARES_FK0 FOREIGN KEY (CNPJ, PRODUTO_A) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_PRODUTOS_SIMILARES ADD CONSTRAINT EST_PRODUTOS_SIMILARES_FK1 FOREIGN KEY (CNPJ, PRODUTO_B) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE EST_REDUCOES ADD CONSTRAINT FK_EST_REDUCOES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_SECAO ADD CONSTRAINT FK_EST_SECAO1 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_SUBGRUPOS ADD CONSTRAINT EST_SUBGRUPOS_FK0 FOREIGN KEY (CNPJ, GRUPO) REFERENCES EST_GRUPOS (CNPJ, CODIGO);
ALTER TABLE EST_SUBGRUPOS ADD CONSTRAINT EST_SUBGRUPOS_FK1 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE EST_SUBGRUPOS_COTAS ADD CONSTRAINT EST_SUBGRUPOS_COTAS_FK0 FOREIGN KEY (CNPJ, GRUPO, SUBGRUPO) REFERENCES EST_SUBGRUPOS (CNPJ, GRUPO, SUBGRUPO);
ALTER TABLE EST_SUBGRUPOS_COTAS ADD CONSTRAINT EST_SUBGRUPOS_COTAS_FK1 FOREIGN KEY (CNPJ, VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE EST_SUBGRUPOS_COTAS ADD CONSTRAINT FK_EST_SUBGRUPOS_COTAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_SUBUNIDADES ADD CONSTRAINT FK_EST_SUBUNIDADES FOREIGN KEY (CNPJ, SIGLA) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE EST_SUBUNIDADES ADD CONSTRAINT FK_EST_SUBUNIDADES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_TIPO_GRAO ADD CONSTRAINT FK_EST_TIPO_GRAO2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_TRANSPORTADORES ADD CONSTRAINT EST_TRANSPORTADORES_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE EST_TRANSPORTADORES ADD CONSTRAINT FK_EST_TRANSPORTADORES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EST_UNIDADES ADD CONSTRAINT FK_EST_UNIDADES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE EXP_CTB_CF_PROSOFT_ALIQ ADD CONSTRAINT FK_EXP_CTB_CF_PROSOFT_ALIQ1 FOREIGN KEY (CNPJ, COD_EXP_CTB_CF_PROSOFT) REFERENCES EXP_CTB_CF_PROSOFT (CNPJ, CODIGO);
ALTER TABLE FAT_CAIXAS ADD CONSTRAINT FK_FAT_CAIXAS_CONTA FOREIGN KEY (CNPJ, CONTA) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE FAT_CAIXAS_FLUXO ADD CONSTRAINT FK_FAT_CAIXAS_FLUXO FOREIGN KEY (CNPJ, USUARIO, CONTA, DATA, TURNO) REFERENCES FAT_CAIXAS (CNPJ, USUARIO, CONTA, DATA, TURNO);
ALTER TABLE FAT_CAIXAS_MOVIMENTOS ADD CONSTRAINT FK_FAT_CAIXAS_MOVIMENTOS FOREIGN KEY (CNPJ, CONTA) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE FAT_CAIXAS_MOVIMENTOS ADD CONSTRAINT FK_FAT_CAIXAS_MOVIMENTOS2 FOREIGN KEY (CNPJ, CENTRO_CUSTO) REFERENCES FIN_CENTRO_CUSTO (CNPJ, CODIGO);
ALTER TABLE FAT_CAIXAS_MOVIMENTOS ADD CONSTRAINT FK_FAT_CAIXAS_MOVIMENTOS_CX FOREIGN KEY (CNPJ, USUARIO, CONTA, DATA, TURNO) REFERENCES FAT_CAIXAS (CNPJ, USUARIO, CONTA, DATA, TURNO);
ALTER TABLE FAT_CAIXAS_MOVIMENTOS ADD CONSTRAINT FK_FAT_CAIXAS_MOVTOS_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES ADD CONSTRAINT FK_FAT_COTACOES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_COTACOES ADD CONSTRAINT FK_FAT_COTACOES_FORMAS FOREIGN KEY (CNPJ, FORMA_PGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES ADD CONSTRAINT FK_FAT_COTACOES_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES ADD CONSTRAINT FK_FAT_COTACOES_TRANSPORT FOREIGN KEY (CNPJ, TRANSPORTADORA) REFERENCES GLO_TRANSPORTADORAS (CNPJ, CODIGO);
ALTER TABLE FAT_COTACOES_ITENS ADD CONSTRAINT FK_FAT_COTACOES_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_COTACOES (CNPJ, CODIGO);
ALTER TABLE FAT_CUPOM ADD CONSTRAINT FK_FAT_CUPOM_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_CUPOM ADD CONSTRAINT FK_FAT_CUPOM_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_CUPOM_ITENS ADD CONSTRAINT FK_FAT_CUPOM_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_CUPOM (CNPJ, CODIGO);
ALTER TABLE FAT_GARANTIAS_ITENS ADD CONSTRAINT FK_FAT_GARANTIAS_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_GARANTIAS (CNPJ, CODIGO);
ALTER TABLE FAT_GARANTIAS_PARCELAMENTO ADD CONSTRAINT FK_FAT_GARANTIAS_PARCELAMEN FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_GARANTIAS (CNPJ, CODIGO);
ALTER TABLE FAT_ITEMTABELAPRECO ADD CONSTRAINT FK_FAT_ITEMTABELAPREC2 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE FAT_ITEMTABELAPRECO ADD CONSTRAINT FK_FAT_ITEMTABELAPRECO FOREIGN KEY (CNPJ, COD_TABELAPRECO) REFERENCES FAT_TABELAPRECO (CNPJ, CODIGO);
ALTER TABLE FAT_MICRO_TERMINAL ADD CONSTRAINT FK_FAT_MICRO_TERMINAL1 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE FAT_NOTAS_PRAZO ADD CONSTRAINT FK_FAT_NOTAS_PRAZO_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_NOTAS_PRAZO ADD CONSTRAINT FK_FAT_NOTAS_PRAZO_FORMAS FOREIGN KEY (CNPJ, FORMA_PGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE FAT_NOTAS_PRAZO ADD CONSTRAINT FK_FAT_NOTAS_PRAZO_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_NOTAS_PRAZO_ITENS ADD CONSTRAINT FK_FAT_NOTAS_PRAZO_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_NOTAS_PRAZO (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS ADD CONSTRAINT FK_FAT_ORCAMENTOS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_ORCAMENTOS ADD CONSTRAINT FK_FAT_ORCAMENTOS_FORMAS FOREIGN KEY (CNPJ, FORMA_PGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS ADD CONSTRAINT FK_FAT_ORCAMENTOS_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS_ITENS ADD CONSTRAINT FK_FAT_ORCAMENTOS_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_ORCAMENTOS (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS_ITENS ADD CONSTRAINT FK_FAT_ORCAMENTOS_ITENS_PROD FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE FAT_ORCAMENTOS_ITENS_PECAS ADD CONSTRAINT FK_FAT_ORCAMENTOS_ITENS_PEC FOREIGN KEY (CNPJ, CODIGO, PRODUTO, SEQUENCIA) REFERENCES FAT_ORCAMENTOS_ITENS (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_ORCAMENTOS_MASCARA ADD CONSTRAINT FK_FAT_ORC_MASCARA_GRUPO FOREIGN KEY (CNPJ, GRUPO) REFERENCES EST_GRUPOS (CNPJ, CODIGO);
ALTER TABLE FAT_TABELAPRECO ADD CONSTRAINT FK_FAT_TABELAPRECO FOREIGN KEY (CNPJ, IDTIPOTABELAPRECO) REFERENCES FAT_TIPOTABELAPRECO (CNPJ, CODIGO);
ALTER TABLE FAT_TBL_VD_TABELA ADD CONSTRAINT FK_FAT_TBL_ FOREIGN KEY (CNPJ, COD_TABELA) REFERENCES FAT_TABELAPRECO (CNPJ, CODIGO);
ALTER TABLE FAT_TBL_VD_TABELA ADD CONSTRAINT FK_FAT_TBL_VD_TABELA FOREIGN KEY (CNPJ, COD_TBL_VENDEDOR) REFERENCES FAT_TBL_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE FAT_TBL_VENDEDOR ADD CONSTRAINT FK_FAT_TBL_VENDEDOR1 FOREIGN KEY (CNPJ, COD_VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE FAT_TERCEIROS ADD CONSTRAINT FK_FAT_TERCEIROS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_TERCEIROS ADD CONSTRAINT FK_FAT_TERCEIROS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_USUARIOS_CAIXA ADD CONSTRAINT FK_FAT_USUARIOS_CAIXA_CONTA FOREIGN KEY (CNPJ, CONTA) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE FAT_USUARIOS_CAIXA ADD CONSTRAINT FK_FAT_USUARIOS_CAIXA_USUARIO FOREIGN KEY (USUARIO) REFERENCES SIS_USUARIOS (CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS FOREIGN KEY (CNPJ, ID_AGRUPADOR) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_2 FOREIGN KEY (CNPJ, LOCAL_COBRANCA) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_CCT FOREIGN KEY (CNPJ, CENTRO_CUSTO) REFERENCES FIN_CENTRO_CUSTO (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_CLI FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_CONFIG_TITULO FOREIGN KEY (CNPJ, COD_CONFIGTITULO) REFERENCES ACT_CONFIGURACAOTITULO (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_FORMAS FOREIGN KEY (CNPJ, FORMA_PGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_MESAS FOREIGN KEY (CNPJ, MESA) REFERENCES FAT_MESAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_MOEDA FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_NATUREZA FOREIGN KEY (CNPJ, NATUREZA) REFERENCES EST_NATUREZA (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_PROPRIEDADES FOREIGN KEY (CNPJ, PESSOA_FJ, PROPRIEDADE) REFERENCES GLO_PROPRIEDADES (CNPJ, PESSOA_FJ, PROPRIEDADE);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_TERCEIROS FOREIGN KEY (CNPJ, TERCEIRO) REFERENCES FAT_TERCEIROS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS ADD CONSTRAINT FK_FAT_VENDAS_TRANSPORTADOR FOREIGN KEY (CNPJ, TRANSPORTADORA) REFERENCES GLO_TRANSPORTADORAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_FRMPAGTO ADD CONSTRAINT FK_FAT_VENDAS_FRMPAGTO FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT FK_FAT_VENDAS_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT FK_FAT_VENDAS_ITENS1 FOREIGN KEY (CNPJ, UNIDADE) REFERENCES EST_UNIDADES (CNPJ, SIGLA);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT FK_FAT_VENDAS_ITENS_PROD FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT FK_FAT_VENDAS_ITENS_PRODFIS FOREIGN KEY (CNPJ, PRODUTOFIS) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_ITENS ADD CONSTRAINT FK_FAT_VENDAS_ITENS_VENDEDOR FOREIGN KEY (CNPJ, VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_ITENS_COMISSOES ADD CONSTRAINT FK__ITENS_COMISSO FOREIGN KEY (CNPJ, COD_ITEM, PRODUTO, SEQUENCIA) REFERENCES FAT_VENDAS_ITENS (CNPJ, CODIGO, PRODUTO, SEQUENCIA);
ALTER TABLE FAT_VENDAS_ITENS_COMISSOES ADD CONSTRAINT FK__ITENS_COMISSO_2 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_PARCELAMENTO ADD CONSTRAINT FK_FAT_VENDAS_PARCELAMENTO FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDAS_PARCELAMENTO ADD CONSTRAINT FK_FAT_VENDAS_PARCELAMENTO_EMPR FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FAT_VENDAS_VEICULO ADD CONSTRAINT FK_FAT_VENDAS_VEICULO FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FAT_VENDEDOR ADD CONSTRAINT FK_FAT_VENDEDOR_COMISSAO FOREIGN KEY (CNPJ, COD_PERFIL) REFERENCES CM_PERFIL (CNPJ, CODIGO);
ALTER TABLE FAT_VENDEDOR ADD CONSTRAINT FK_FAT_VENDEDOR_COMISSAO2 FOREIGN KEY (CNPJ, COD_PERFIL_PAGTO) REFERENCES CM_PERFIL_PAGTO (CNPJ, CODIGO);
ALTER TABLE FAT_VENDEDOR ADD CONSTRAINT FK_FAT_VENDEDOR_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FAT_VENDEDOR ADD CONSTRAINT FK_FAT_VENDEDOR_VENDEDOR FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_ADMINISTRADORA ADD CONSTRAINT FK_FIN_ADMINISTRADORA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_ANALISE_CUSTO ADD CONSTRAINT FK_FIN_ANALISE_CUSTO_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_ANALISE_CUSTO ADD CONSTRAINT FK_FIN_ANALISE_CUSTO_VENDA FOREIGN KEY (CNPJ, CODIGO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FIN_ANALISE_CUSTO_ITENS ADD CONSTRAINT FK_FIN_ANALISE_CUSTO_ITENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES FIN_ANALISE_CUSTO (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_ACERTO FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_CFG FOREIGN KEY (CNPJ, COD_CONFIG_TITULO) REFERENCES ACT_CONFIGURACAOTITULO (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_EVENTO FOREIGN KEY (CNPJ, COD_EVENTOCONTABIL) REFERENCES ACT_EVENTOCONTABIL (CNPJ, CODEVENTOCONTABIL);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_MOEDAS FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FIN_BAIXAS_PAGAR ADD CONSTRAINT FK_FIN_BAIXAS_PAGAR_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBEREVENTO FOREIGN KEY (CNPJ, COD_EVENTOCONTABIL) REFERENCES ACT_EVENTOCONTABIL (CNPJ, CODEVENTOCONTABIL);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBER_ACERT FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBER_CFG FOREIGN KEY (CNPJ, COD_CONFIG_TITULO) REFERENCES ACT_CONFIGURACAOTITULO (CNPJ, CODIGO);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBER_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBER_MOEDA FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FIN_BAIXAS_RECEBER ADD CONSTRAINT FK_FIN_BAIXAS_RECEBER_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_CENTRO_CUSTO ADD CONSTRAINT FK_FIN_CENTRO_CUSTO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES FOREIGN KEY (CNPJ, FORNECEDOR) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_ACT FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_BANCO FOREIGN KEY (BANCO) REFERENCES FIN_BANCO (CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_TROCAS FOREIGN KEY (CNPJ, TROCA) REFERENCES FAT_TROCAS (CNPJ, CODIGO);
ALTER TABLE FIN_CHEQUES ADD CONSTRAINT FK_FIN_CHEQUES_VENDA FOREIGN KEY (CNPJ, VENDA) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FIN_COBRADOR ADD CONSTRAINT FK_FIN_COBRADOR FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_COBRANCAS ADD CONSTRAINT FK_FIN_COBRANCAS_MOTIVO FOREIGN KEY (CNPJ, MOTIVO) REFERENCES FIN_MOTIVO_COBRANCA (CNPJ, CODIGO);
ALTER TABLE FIN_COBRANCAS ADD CONSTRAINT FK_FIN_COBRANCAS_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_COMISSAO_PRODUTO ADD CONSTRAINT FK_FIN_COMISSAO_PRODUTO_VEN FOREIGN KEY (CNPJ, VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR FOREIGN KEY (CNPJ, CODIGO_VN) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR_CENTROCUSTO FOREIGN KEY (CNPJ, CENTRO_CUSTO) REFERENCES FIN_CENTRO_CUSTO (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR_CFG FOREIGN KEY (CNPJ, COD_CONFIG_TITULO) REFERENCES ACT_CONFIGURACAOTITULO (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR_MOEDA FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FIN_CONTAS_PAGAR ADD CONSTRAINT FK_FIN_CONTAS_PAGAR_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER FOREIGN KEY (CNPJ, LOCAL_COBRANCA) REFERENCES FIN_LOCAL_COBRANCA (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_2 FOREIGN KEY (CNPJ, CONTA_CORRENTE) REFERENCES CTB_PLANOCONTA (CNPJ, CONTA);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_CFG FOREIGN KEY (CNPJ, COD_CONFIG_TITULO) REFERENCES ACT_CONFIGURACAOTITULO (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_FATURA FOREIGN KEY (CNPJ, FATURA) REFERENCES FIN_FATURAS (CNPJ, CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_MOEDA FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FIN_CONTAS_RECEBER ADD CONSTRAINT FK_FIN_CONTAS_RECEBER_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_COTACOES ADD CONSTRAINT FK_FIN_COTACOES1 FOREIGN KEY (COD_MOEDA) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE FIN_FATURAS ADD CONSTRAINT FK_FIN_FATURAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_FATURAS ADD CONSTRAINT FK_FIN_FATURAS_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_FATURAS_ADICIONAL ADD CONSTRAINT FK_FIN_FATURAS_ADICIONAL FOREIGN KEY (CNPJ, CODIGO) REFERENCES FIN_FATURAS (CNPJ, CODIGO);
ALTER TABLE FIN_FATURAS_PARCIAL ADD CONSTRAINT FK_FIN_FATURAS_PARCIAL_FATU FOREIGN KEY (CNPJ, CODIGO) REFERENCES FIN_FATURAS (CNPJ, CODIGO);
ALTER TABLE FIN_FOLHA_PAGTO ADD CONSTRAINT FK_FIN_FOLHA_PAGTO1 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_FOLHA_PAGTO ADD CONSTRAINT FK_FIN_FOLHA_PAGTO2 FOREIGN KEY (CNPJ, TIPO_MOVTO) REFERENCES FIN_FOLHA_TIPO_MOVIMENTO (CNPJ, CODIGO);
ALTER TABLE FIN_FORMAS_PAGTO ADD CONSTRAINT FK_FIN_FORMAS_PAGTO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_FORMAS_PAGTO_PARCELAS ADD CONSTRAINT FK_FIN_FORMAS_PAGTO_PARCELA FOREIGN KEY (CNPJ, COD_FORMA_PAGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);
ALTER TABLE FIN_FUNCIONARIOS ADD CONSTRAINT FK_FIN_FUNCIONARIOS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_LOCAL_COBRANCA ADD CONSTRAINT FK_FIN_LOCAL_COBRANCA_EMPRE FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_MOTIVO_DEVOLUCAO ADD CONSTRAINT FK_FIN_MOTIVO_DEVOLUCAO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_MOVIMENTO_CARTAO ADD CONSTRAINT FK_FIN_MOVIMENTO_CARTAO_ACT FOREIGN KEY (CNPJ, COD_ACERTOCONTA) REFERENCES ACT_ACERTOCONTA (CNPJ, CODIGO);
ALTER TABLE FIN_MOVIMENTO_CARTAO ADD CONSTRAINT FK_FIN_MOVIMENTO_CARTAO_ADM FOREIGN KEY (CNPJ, ADMINISTRADORA) REFERENCES FIN_ADMINISTRADORA (CNPJ, CODIGO);
ALTER TABLE FIN_MOVIMENTO_CARTAO ADD CONSTRAINT FK_FIN_MOVIMENTO_CARTAO_PESSOA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE FIN_MOVIMENTO_CARTAO ADD CONSTRAINT FK_FIN_MOVIMENTO_CARTAO_VENDA FOREIGN KEY (CNPJ, VENDA) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE FIN_RECIBOS ADD CONSTRAINT FK_FIN_RECIBOS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE FIN_RECIBOS_PAGAS ADD CONSTRAINT FK_FIN_RECIBOS_PAGAS_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_ATIVIDADES ADD CONSTRAINT FK_GLO_ATIVIDADES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_BAIRROS ADD CONSTRAINT GLO_BAIRROS_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_CIDADES ADD CONSTRAINT GLO_CIDADES_FK FOREIGN KEY (CNPJ, UF) REFERENCES GLO_ESTADOS (CNPJ, SIGLA);
ALTER TABLE GLO_CIDADES ADD CONSTRAINT GLO_CIDADES_FK1 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_CLASSIFICACAO ADD CONSTRAINT FK_GLO_CLASSIFICACAO_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_CLIENTES ADD CONSTRAINT FK_GLO_CLIENTES3 FOREIGN KEY (CNPJ, BAIRRO) REFERENCES GLO_BAIRROS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES ADD CONSTRAINT GLO_CLIENTES_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES ADD CONSTRAINT GLO_CLIENTES_FK1 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_CLIENTES ADD CONSTRAINT GLO_CLIENTES_FK2 FOREIGN KEY (CNPJ_CLASSIF, COD_CLASSIF) REFERENCES GLO_CLASSIFICACAO (CNPJ, CODIGO) ON UPDATE CASCADE;
ALTER TABLE GLO_CLIENTES_IMAGENS ADD CONSTRAINT FK_GLO_CLIENTES_IMAGENS FOREIGN KEY (CNPJ, CODIGO) REFERENCES GLO_CLIENTES (CNPJ, PESSOA_FJ);
ALTER TABLE GLO_CLIENTES_PRODUTOS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS1 FOREIGN KEY (CNPJ, COD_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES_PRODUTOS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS2 FOREIGN KEY (CNPJ, COD_CLIENTE) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES_PRODUTOS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS3 FOREIGN KEY (CNPJ, COD_CONTRATO) REFERENCES GLO_TIPO_CONTRATO (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTES_PRODUTOS_ITENS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS_2 FOREIGN KEY (CONTRATO, CNPJ) REFERENCES GLO_CLIENTES_PRODUTOS (CODIGO, CNPJ);
ALTER TABLE GLO_CLIENTES_PRODUTOS_ITENS ADD CONSTRAINT FK_GLO_CLIENTES_PRODUTOS_IT FOREIGN KEY (CNPJ, COD_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT FK_GLO_CLIENTE_ENDERECO FOREIGN KEY (CNPJ, CODIGO) REFERENCES GLO_LOGRADOUROS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT FK_GLO_CLIENTE_ENDERECO2 FOREIGN KEY (CNPJ, ID_LOGRADOURO) REFERENCES GLO_LOGRADOUROS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT FK_GLO_CLIENTE_ENDERECO3 FOREIGN KEY (CNPJ, UF_SIGLA) REFERENCES GLO_ESTADOS (CNPJ, SIGLA);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT FK_GLO_CLIENTE_ENDERECO4 FOREIGN KEY (CNPJ, ID_BAIRRO) REFERENCES GLO_BAIRROS (CNPJ, CODIGO);
ALTER TABLE GLO_CLIENTE_ENDERECO ADD CONSTRAINT FK_GLO_CLIENTE_ENDERECO5 FOREIGN KEY (CNPJ, ID_CIDADE) REFERENCES GLO_CIDADES (CNPJ, CODIGO);
ALTER TABLE GLO_CONTAS_PESSOAS ADD CONSTRAINT FK_GLO_CONTAS_PESSOAS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_CONTAS_PESSOAS ADD CONSTRAINT FK_GLO_CONTAS_PESSOAS_BANCO FOREIGN KEY (BANCO) REFERENCES FIN_BANCO (CODIGO);
ALTER TABLE GLO_CONTATOS ADD CONSTRAINT FK_GLO_CONTATOS FOREIGN KEY (CNPJ, IDCLIENTE) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_DECLARACAO_VENDA ADD CONSTRAINT FK_GLO_DECLARACAO_VENDA FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_ESTADOS ADD CONSTRAINT GLO_ESTADOS_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_FORNECEDORES ADD CONSTRAINT FK_GLO_FORNECEDORES_EMPRESAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_FORNECEDORES ADD CONSTRAINT GLO_FORNECEDORES_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_INDICACOES ADD CONSTRAINT FK_GLO_INDICACOES FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_INDICACOES ADD CONSTRAINT FK_GLO_INDICACOES_IND FOREIGN KEY (CNPJ, INDICADO) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_LOGRADOUROS ADD CONSTRAINT GLO_LOGRADOUROS_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_MARCA_VEICULOS ADD CONSTRAINT FK_GLO_MARCA_VEICULOS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_MODELO_PROPRIEDADE ADD CONSTRAINT GLO_MODELO_PROPRIEDADE_FK0 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_PAIS ADD CONSTRAINT FK_GLO_PAIS2 FOREIGN KEY (COD_MOEDA) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE GLO_PATRIMONIO ADD CONSTRAINT FK_GLO_PATRIMONIO_DEPARTAME FOREIGN KEY (CNPJ, DEPARTAMENTO) REFERENCES GLO_DEPARTAMENTO (CNPJ, CODIGO);
ALTER TABLE GLO_PATRIMONIO_GARANTIAS ADD CONSTRAINT FK_GLO_PATRIMONIO_GAR_PECAS FOREIGN KEY (CNPJ, PECA) REFERENCES GLO_PECAS_PATRIMONIO (CNPJ, CODIGO);
ALTER TABLE GLO_PATRIMONIO_SAIDA ADD CONSTRAINT FK_GLO_PATRIMONIO_SAIDA_FUN FOREIGN KEY (CNPJ, FUNCIONARIO) REFERENCES FIN_FUNCIONARIOS (CNPJ, PESSOA_FJ);
ALTER TABLE GLO_PATRIMONIO_SAIDA ADD CONSTRAINT FK_GLO_PATRIMONIO_SAIDA_PAT FOREIGN KEY (CNPJ, CODIGO) REFERENCES GLO_PATRIMONIO (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT FK_GLO_PESSOAS_FJ6 FOREIGN KEY (CNPJ, REGIAO) REFERENCES GLO_REGIOES (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT FK_GLO_PESSOAS_FJ_CONVENIO FOREIGN KEY (CNPJ, CONVENIO) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK0 FOREIGN KEY (CNPJ, ENDERECO) REFERENCES GLO_LOGRADOUROS (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK1 FOREIGN KEY (CNPJ, BAIRRO) REFERENCES GLO_BAIRROS (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK2 FOREIGN KEY (CNPJ, CIDADE) REFERENCES GLO_CIDADES (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK3 FOREIGN KEY (CNPJ, UF) REFERENCES GLO_ESTADOS (CNPJ, SIGLA);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK4 FOREIGN KEY (CNPJ, ATIVIDADE) REFERENCES GLO_ATIVIDADES (CNPJ, CODIGO);
ALTER TABLE GLO_PESSOAS_FJ ADD CONSTRAINT GLO_PESSOAS_FJ_FK5 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ) ON UPDATE CASCADE;
ALTER TABLE GLO_PRECOS_ESPECIAIS ADD CONSTRAINT FK_GLO_PRECOS_ESPECIAIS FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_PRECOS_ESPECIAIS ADD CONSTRAINT FK_GLO_PRECOS_ESPECIAIS_CLI FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT FK_GLO_PROPRIEDADES_BAIRRO FOREIGN KEY (CNPJ, BAIRRO) REFERENCES GLO_BAIRROS (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT FK_GLO_PROPRIEDADES_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT FK_GLO_PROPRIEDADES_MODELO FOREIGN KEY (CNPJ, MODELO) REFERENCES GLO_MODELO_PROPRIEDADE (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT FK_GLO_PROPRIEDADES_TP_CONT FOREIGN KEY (CNPJ, TIPO_CONTRATO) REFERENCES GLO_TIPO_CONTRATO (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_FK0 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_FK1 FOREIGN KEY (CNPJ, ENDERECO) REFERENCES GLO_LOGRADOUROS (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_FK3 FOREIGN KEY (CNPJ, CIDADE) REFERENCES GLO_CIDADES (CNPJ, CODIGO);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_FK4 FOREIGN KEY (CNPJ, UF) REFERENCES GLO_ESTADOS (CNPJ, SIGLA);
ALTER TABLE GLO_PROPRIEDADES ADD CONSTRAINT GLO_PROPRIEDADES_FK5 FOREIGN KEY (CNPJ, REGIAO) REFERENCES GLO_REGIOES (CNPJ, CODIGO);
ALTER TABLE GLO_REGIOES ADD CONSTRAINT FK_GLO_REGIOES1 FOREIGN KEY (CNPJ, VENDEDOR) REFERENCES FAT_VENDEDOR (CNPJ, CODIGO);
ALTER TABLE GLO_REGIOES ADD CONSTRAINT FK_GLO_REGIOES2 FOREIGN KEY (CNPJ, TERCEIRO) REFERENCES FAT_TERCEIROS (CNPJ, CODIGO);
ALTER TABLE GLO_REGIOES ADD CONSTRAINT FK_GLO_REGIOES3 FOREIGN KEY (CNPJ, TECNICO) REFERENCES OFC_MECANICOS (CNPJ, CODIGO);
ALTER TABLE GLO_TRANSPORTADORAS ADD CONSTRAINT FK_GLO_TRANSPORTADORAS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE LOG_FAT_VENDAS ADD CONSTRAINT FK_LOG_FAT_VENDAS2 FOREIGN KEY (ID_NEXT) REFERENCES LOG_FAT_VENDAS (ID);
ALTER TABLE NFE_XML_LOG ADD CONSTRAINT FK_NFE_XML_LOG1 FOREIGN KEY (CNPJ, COD_FATURAMENTO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE OFC_CONTRATOS ADD CONSTRAINT FK_OFC_CONTRATOS2 FOREIGN KEY (CNPJ, COD_CLIENTE) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_CONTRATOS ADD CONSTRAINT FK_OFC_CONTRATOS3 FOREIGN KEY (CNPJ, COD_CONTRATO) REFERENCES GLO_TIPO_CONTRATO (CNPJ, CODIGO);
ALTER TABLE OFC_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_CONTRATOS_ITENS3 FOREIGN KEY (COD_INDEXADOR) REFERENCES FIN_MOEDA (CODIGO);
ALTER TABLE OFC_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_CONTRATOS_ITENS_1 FOREIGN KEY (CNPJ, COD_PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE OFC_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_CONTRATOS_ITENS_2 FOREIGN KEY (CONTRATO, CNPJ) REFERENCES OFC_CONTRATOS (CODIGO, CNPJ);
ALTER TABLE OFC_CONTRATOS_ITENS_DESC ADD CONSTRAINT FK_OFC_CONTRATOS_ITENS_333 FOREIGN KEY (COD_ITEM, CNPJ) REFERENCES OFC_CONTRATOS_ITENS (CODIGO, CNPJ);
ALTER TABLE OFC_CTRL_QUALIDADE ADD CONSTRAINT FK_OFC_CTRL_QUALIDADE FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_DEFEITO ADD CONSTRAINT FK_OFC_DEFEITO FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE OFC_GRP_CONTRATOS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS2 FOREIGN KEY (CNPJ, COD_CLIENTE) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_GRP_CONTRATOS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS3 FOREIGN KEY (CNPJ, COD_CONTRATO) REFERENCES GLO_TIPO_CONTRATO (CNPJ, CODIGO);
ALTER TABLE OFC_GRP_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS_ITENS2 FOREIGN KEY (CNPJ, COD_GRUPO) REFERENCES OFC_GRP_CONTRATOS (CNPJ, CODIGO);
ALTER TABLE OFC_GRP_CONTRATOS_ITENS ADD CONSTRAINT FK_OFC_GRP_CONTRATOS_ITENS3 FOREIGN KEY (CNPJ, PESSOA_FJ) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_LEITURAS ADD CONSTRAINT FK_OFC_LEITURAS FOREIGN KEY (CNPJ, CONTRATO) REFERENCES OFC_GRP_CONTRATOS (CNPJ, CODIGO);
ALTER TABLE OFC_LEITURAS_ITENS ADD CONSTRAINT FK_OFC_LEITURAS_ITENS FOREIGN KEY (CNPJ, LEITURA) REFERENCES OFC_LEITURAS (CNPJ, CODIGO);
ALTER TABLE OFC_LEITURAS_ITENS ADD CONSTRAINT FK_OFC_LEITURAS_ITENS2 FOREIGN KEY (COD_ITEM_CONTRATO, CNPJ) REFERENCES OFC_CONTRATOS_ITENS (CODIGO, CNPJ);
ALTER TABLE OFC_LEITURAS_ITENS ADD CONSTRAINT FK_OFC_LEITURAS_ITENS3 FOREIGN KEY (CNPJ, COD_CLIENTE) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_MECANICOS ADD CONSTRAINT FK_OFC_MECANICOS1 FOREIGN KEY (COD_USUARIO) REFERENCES SIS_USUARIOS (CODIGO);
ALTER TABLE OFC_MENSALIDADES ADD CONSTRAINT FK_OFC_MENSALIDADES FOREIGN KEY (CNPJ, FATURAMENTO) REFERENCES FAT_VENDAS (CNPJ, CODIGO);
ALTER TABLE OFC_MENSALIDADES_ITENS ADD CONSTRAINT FK_OFC_MENSALIDADES_ITENS FOREIGN KEY (CNPJ, COD_MENSALIDADE) REFERENCES OFC_MENSALIDADES (CNPJ, CODIGO);
ALTER TABLE OFC_MENSALIDADES_ITENS ADD CONSTRAINT FK_OFC_MENSALIDADES_ITENS2 FOREIGN KEY (COD_ITEM_CONTRATO, CNPJ) REFERENCES OFC_CONTRATOS_ITENS (CODIGO, CNPJ);
ALTER TABLE OFC_MOTIVO_CHAMADO ADD CONSTRAINT FK_OFC_MOTIVO_CHAMADO2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO2 FOREIGN KEY (CNPJ, ID_MOTIVO_CHAMADO) REFERENCES OFC_MOTIVO_CHAMADO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO3 FOREIGN KEY (CNPJ, ID_TIPO_ATENDIMENTO) REFERENCES OFC_TIPO_ATENDIMENTO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO4 FOREIGN KEY (CNPJ, COD_STATUS) REFERENCES OFC_STATUS (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO5 FOREIGN KEY (CNPJ, COD_CONTATO) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_6 FOREIGN KEY (CNPJ, VEICULO, PESSOA_FJ) REFERENCES GLO_VEICULOS (CNPJ, CODIGO, PESSOA_FJ);
ALTER TABLE OFC_ORDEM_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_MOTOR FOREIGN KEY (CNPJ, MOTOR) REFERENCES OFC_MOTORES (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_22 FOREIGN KEY (CNPJ, COD_TECNICO) REFERENCES OFC_MECANICOS (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTER3 FOREIGN KEY (CNPJ, COD_CONTATO) REFERENCES GLO_PESSOAS_FJ (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTER4 FOREIGN KEY (CNPJ, COD_STATUS) REFERENCES OFC_STATUS (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTER5 FOREIGN KEY (CNPJ, COD_VEICULO) REFERENCES CRG_VEICULOS (CNPJ, PLACA);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTER6 FOREIGN KEY (CNPJ, COD_TIPO_MOVTO) REFERENCES OFC_TIPO_MOVTO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_INTERVALO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_INTERV FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_MOVIMENTO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_MOVIME FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_ORC ADD CONSTRAINT FK_OFC_ORD_SERV_MOTOR_ORC FOREIGN KEY (CNPJ, MOTOR) REFERENCES OFC_MOTORES (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_PARCELAMENTO ADD CONSTRAINT FK_OFC_ORDEM_SER_PARCELAS FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_2 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_SERVICO ADD CONSTRAINT FK_OFC_ORDEM_SERVICO_SERVI FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_SERVICO_ORC ADD CONSTRAINT FK_OFC_ORD_SERV_SERVIC_ITEN FOREIGN KEY (CNPJ, SERVICO) REFERENCES OFC_SERVICOS (CNPJ, CODIGO);
ALTER TABLE OFC_ORDEM_SERVICO_SERVICO_ORC ADD CONSTRAINT FK_OFC_ORD_SERV_SERVIC_ORC FOREIGN KEY (CNPJ, CODIGO) REFERENCES OFC_ORDEM_SERVICO_ORC (CNPJ, CODIGO);
ALTER TABLE OFC_OS_ANEXOS ADD CONSTRAINT FK_OFC_OS_ANEXOS1 FOREIGN KEY (CNPJ, CODIGO, SEQUENCIA) REFERENCES OFC_ORDEM_SERVICO_INTERVALO (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE OFC_O_S_INTERVALO_EMAIL ADD CONSTRAINT FK_OFC_O_S_INTERVALO_EMAIL2 FOREIGN KEY (CNPJ, COD_INTERVALO, SEQUENCIA) REFERENCES OFC_ORDEM_SERVICO_INTERVALO (CNPJ, CODIGO, SEQUENCIA);
ALTER TABLE OFC_PENDENCIA ADD CONSTRAINT FK_OFC_PENDENCIA1 FOREIGN KEY (CNPJ, PRODUTO) REFERENCES EST_PRODUTOS (CNPJ, CODIGO);
ALTER TABLE OFC_PENDENCIA ADD CONSTRAINT FK_OFC_PENDENCIA2 FOREIGN KEY (CNPJ, OS_VINCULADA) REFERENCES OFC_ORDEM_SERVICO (CNPJ, CODIGO);
ALTER TABLE OFC_SERVICOS ADD CONSTRAINT FK_OFC_SERVICOS FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE OFC_STATUS ADD CONSTRAINT FK_OFC_STATUS2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE OFC_TIPO_ATENDIMENTO ADD CONSTRAINT FK_OFC_TIPO_ATENDIMENTO4 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE SIS_BOLETOBANCARIO ADD CONSTRAINT FK_SIS_BOLETOBANCARIO FOREIGN KEY (BANCO) REFERENCES FIN_BANCO (CODIGO);
ALTER TABLE SIS_DIREITOS_PERFIL ADD CONSTRAINT SIS_DIREITOS_PERFIL_FK0 FOREIGN KEY (PERFIL) REFERENCES SIS_PERFIL (CODIGO);
ALTER TABLE SIS_DIREITOS_PERFIL ADD CONSTRAINT SIS_DIREITOS_PERFIL_FK1 FOREIGN KEY (MODULO) REFERENCES SIS_MODULOS (CODIGO);
ALTER TABLE SIS_DOCUMENTOS ADD CONSTRAINT FK_SIS_DOCUMENTOS2 FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE SIS_DUPLICATA ADD CONSTRAINT FK_SIS_DUPLICATA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE SIS_LOG_TRANSACOES ADD CONSTRAINT FK_SIS_LOG_TRANSACOES FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE SIS_SERIENF ADD CONSTRAINT FK_SIS_SERIENF_DOCTO FOREIGN KEY (CNPJ, TIPO_DOCTO) REFERENCES GLO_TIPOS_DOCTO (CNPJ, SIGLA);
ALTER TABLE SIS_SERIENF ADD CONSTRAINT FK_SIS_SERIENF_EMPRESA FOREIGN KEY (CNPJ) REFERENCES SIS_EMPRESAS (CNPJ);
ALTER TABLE SIS_TABELAS_SISTEMA_CAMPOS ADD CONSTRAINT FK_SIS_TABELAS_SISTEMA_CAMPOS FOREIGN KEY (TABELA) REFERENCES SIS_TABELAS_SISTEMA (TABELA);
ALTER TABLE SIS_USUARIOS ADD CONSTRAINT SIS_USUARIOS_FK0 FOREIGN KEY (PERFIL) REFERENCES SIS_PERFIL (CODIGO);
ALTER TABLE TABELAPRECOCONDPAGAMENTO ADD CONSTRAINT FK_TABELAPRECOCONDPAGAMENT2 FOREIGN KEY (CNPJ, COD_TABELAPRECO) REFERENCES FAT_TABELAPRECO (CNPJ, CODIGO);
ALTER TABLE TABELAPRECOCONDPAGAMENTO ADD CONSTRAINT FK_TABELAPRECOCONDPAGAMENTO FOREIGN KEY (CNPJ, COD_FORMA_PAGTO) REFERENCES FIN_FORMAS_PAGTO (CNPJ, CODIGO);


/******************************************************************************/
/****                               Indices                                ****/
/******************************************************************************/

CREATE INDEX CTB_CHEQUE_IDX_PLANILHA ON CTB_CHEQUE (CNPJ, PLANILHA);
CREATE INDEX CTB_MOVIMENTO_CONTABIL_CRED ON CTB_MOVIMENTO_CONTABIL (CNPJ, DATA, TIPO);
CREATE INDEX CTB_MOVIMENTO_CONTABIL_IDX_DATA ON CTB_MOVIMENTO_CONTABIL (DATA);
CREATE INDEX IDX_CTB_MOVIMENTO_CONTABIL_PLAN ON CTB_MOVIMENTO_CONTABIL (CNPJ, PLANILHA);
CREATE UNIQUE INDEX CTB_PLANOCONTA_CONTA_IDX ON CTB_PLANOCONTA (CNPJ, CODIGO);
CREATE UNIQUE INDEX CTB_PLANOCONTA_NOME_IDX ON CTB_PLANOCONTA (CNPJ, NOME);
CREATE INDEX EST_ENTRADAS_DIARIA ON EST_ENTRADAS (CNPJ, DATA_REF);
CREATE INDEX IDX_EST_ENTRADAS_ITENS_PESSOA ON EST_ENTRADAS_ITENS (CNPJ, PESSOA_FJ);
CREATE INDEX EST_ESTIQUETA_PRODUTO_ENTRADA ON EST_ESTIQUETA_PRODUTO (CNPJ, NDOCTO, PESSOA_FJ);
CREATE INDEX EST_GRADES_IDX1 ON EST_GRADES (CODIGO);
CREATE INDEX EST_GRADES_IDX2 ON EST_GRADES (CODIGO, NOME);
CREATE INDEX IDX_EST_GRADES ON EST_GRADES (NOME);
CREATE INDEX EST_GRUPOS_NOME ON EST_GRUPOS (CNPJ, NOME);
CREATE INDEX IDX_EST_MARCAS ON EST_MARCAS (NOME);
CREATE INDEX EST_POSICAO_DIARIA_DATA ON EST_POSICAO_DIARIA (CNPJ, DATA);
CREATE INDEX EST_POSICAO_DIARIA_SUB_GRUPO ON EST_POSICAO_DIARIA (CNPJ, DATA, GRUPO, SUB_GRUPO);
CREATE INDEX IDX_EST_PRODUTOS_ARQUIV_EXT ON EST_PRODUTOS (CNPJ, CODIGO, ATUALIZA_ARQ_EXTERNO);
CREATE UNIQUE INDEX IDX_EST_PRODUTOS_ATIVO ON EST_PRODUTOS (CNPJ, CODIGO, ATIVO);
CREATE UNIQUE DESCENDING INDEX IDX_EST_PRODUTOS_ATIVOD ON EST_PRODUTOS (CNPJ, CODIGO, ATIVO);
CREATE INDEX IDX_EST_PRODUTOS_COD ON EST_PRODUTOS (CODIGO);
CREATE INDEX IDX_EST_PRODUTOS_CODINT ON EST_PRODUTOS (CNPJ, CODIGO_INTERNO);
CREATE UNIQUE DESCENDING INDEX IDX_EST_PRODUTOS_DESCCOD ON EST_PRODUTOS (CNPJ, CODIGO);
CREATE INDEX IDX_EST_PRODUTOS_NOMEATIVO ON EST_PRODUTOS (CNPJ, NOME, ATIVO);
CREATE DESCENDING INDEX IDX_EST_PRODUTOS_NOMEATIVOD ON EST_PRODUTOS (CNPJ, NOME, ATIVO);
CREATE INDEX IDX_EST_PRODUTOS_NOMEEMP ON EST_PRODUTOS (CNPJ, NOME);
CREATE INDEX EST_PRODUTOS_GRADES_NUMERO_IDX1 ON EST_PRODUTOS_GRADES_NUMEROS (PRODUTO);
CREATE INDEX EST_PROMOCAO_PRODUTO ON EST_PROMOCAO (CNPJ, PRODUTO);
CREATE INDEX FAT_CUPOM_ITENS_ITEM ON FAT_CUPOM_ITENS (CNPJ, CODIGO, PRODUTO);
CREATE INDEX FAT_VENDAS_CAIXA ON FAT_VENDAS (CNPJ, DATA_CAIXA, CODIGO);
CREATE INDEX FAT_VENDAS_DUPLICATA ON FAT_VENDAS (CNPJ, DUPLICATA);
CREATE INDEX FAT_VENDAS_IDX1 ON FAT_VENDAS (PESSOA_FJ);
CREATE INDEX FAT_VENDAS_IDX2 ON FAT_VENDAS (CNPJ, NUM_NF, CODIGO);
CREATE INDEX FAT_VENDAS_ORCAMENTO ON FAT_VENDAS (CNPJ, ORCAMENTO);
CREATE INDEX FAT_VENDAS_TIPO_VENDA ON FAT_VENDAS (CNPJ, DATA, FECHADA, TIPO_VENDA, CANCELADA, DUPLICATA);
CREATE INDEX IDX_FAT_VENDAS_CF ON FAT_VENDAS (CNPJ, NUM_CUPOM, SERIE);
CREATE INDEX IDX_FAT_VENDAS_NF ON FAT_VENDAS (CNPJ, NUM_NF, SERIE);
CREATE INDEX IDX_FAT_VENDAS_SELECIONADAS ON FAT_VENDAS (CNPJ, PESSOA_FJ, SELECIONADA);
CREATE INDEX FAT_VENDAS_FRMPAGTO_CAIXA ON FAT_VENDAS_FRMPAGTO (CNPJ, DATA_CAIXA, USUARIO_CAIXA, CONTA_CAIXA);
CREATE INDEX FAT_VENDAS_FRMPAGTO_TIPO ON FAT_VENDAS_FRMPAGTO (CNPJ, CODIGO, AVISTA);
CREATE INDEX IDX_FIN_ADMINISTRADORA ON FIN_ADMINISTRADORA (CNPJ, NOME);
CREATE INDEX FIN_BAIXAS_PAGAR_PAGAR ON FIN_BAIXAS_PAGAR (CNPJ, CODIGO_PG, ANO_PG);
CREATE INDEX FIN_BAIXAS_RECEBER_FATURA ON FIN_BAIXAS_RECEBER (CNPJ, FATURA);
CREATE INDEX FIN_BAIXAS_RECEBER_RECEBER ON FIN_BAIXAS_RECEBER (CNPJ, CODIGO_CR, ANO_CR);
CREATE INDEX FIN_BAIXAS_RECEBER_VENDA ON FIN_BAIXAS_RECEBER (CNPJ, CODIGO_VN);
CREATE INDEX FIN_CHEQUES_CAIXA ON FIN_CHEQUES (CNPJ, DATA_CAIXA, USUARIO);
CREATE INDEX FIN_CHEQUES_CONCILIADO ON FIN_CHEQUES (CNPJ, CONCILIADO);
CREATE INDEX FIN_CHEQUES_CONCILIADO_PESSOA ON FIN_CHEQUES (CNPJ, PESSOA_FJ, CONCILIADO);
CREATE INDEX FIN_CHEQUES_DATA_CONCILIACAO ON FIN_CHEQUES (CNPJ, DATA_CONCILIACAO);
CREATE INDEX FIN_CHEQUES_PLANILHA ON FIN_CHEQUES (CNPJ, PLANILHA);
CREATE INDEX FIN_CONTAS_PAGAR_PLANILHA ON FIN_CONTAS_PAGAR (CNPJ, PLANILHA);
CREATE INDEX IDX_FIN_CONTAS_PAGAR_DPL ON FIN_CONTAS_PAGAR (PESSOA_FJ, DUPLICATA);
CREATE INDEX FIN_CONTAS_RECEBER_DOCTO ON FIN_CONTAS_RECEBER (CNPJ, DOCTO, TIPO_DOCTO);
CREATE INDEX FIN_CONTAS_RECEBER_FLUXO ON FIN_CONTAS_RECEBER (CNPJ, FLUXO_CAIXA);
CREATE INDEX FIN_CONTAS_RECEBER_TRC ON FIN_CONTAS_RECEBER (CNPJ, CODIGO_TRC);
CREATE INDEX FIN_CONTAS_RECEBER_VND ON FIN_CONTAS_RECEBER (CNPJ, CODIGO_VN);
CREATE INDEX FIN_FATURAS_AGRUPADORA ON FIN_FATURAS (CNPJ, AGRUPADORA);
CREATE INDEX FIN_FATURAS_CAIXA ON FIN_FATURAS (CNPJ, DATA_BAIXA, USUARIO, TURNO);
CREATE INDEX IDX_FIN_FATURAS_PESSOA_EST ON FIN_FATURAS (CNPJ, PESSOA_FJ, BAIXADA);
CREATE INDEX FIN_FATURAS_ADICIONAL_DOC ON FIN_FATURAS_ADICIONAL (CNPJ, DOCUMENTO);
CREATE INDEX FIN_FATURAS_PARCIAL_IDX1 ON FIN_FATURAS_PARCIAL (CNPJ, PLANILHA);
CREATE INDEX FIN_FATURAS_PARCIAL_IDX2 ON FIN_FATURAS_PARCIAL (CNPJ, DATA_CAIXA, USUARIO, CONTA, TURNO);
CREATE INDEX FIN_MOVIMENTO_CARTAO_CAIXA ON FIN_MOVIMENTO_CARTAO (CNPJ, DATA, USUARIO, CONTA, TURNO);
CREATE INDEX GLO_CLIENTES_PESSOA ON GLO_CLIENTES (CNPJ, PESSOA_FJ);
CREATE INDEX IDX_GLO_CLIENTES ON GLO_CLIENTES (CNPJ, PERIODO_FATURAMENTO);
CREATE INDEX GLO_PESSOAS_FJ_CODIGO ON GLO_PESSOAS_FJ (CNPJ, CODIGO);
CREATE INDEX GLO_PESSOAS_FJ_IDX1 ON GLO_PESSOAS_FJ (MAP_LAT, MAP_LONG);
CREATE INDEX IDX_GLO_PESSOAS_FJ ON GLO_PESSOAS_FJ (CNPJ, CPF_CGC);
CREATE INDEX IDX_GLO_PESSOAS_FJ1 ON GLO_PESSOAS_FJ (CNPJ, NOME_RAZAO);
CREATE INDEX IDX_GLO_PESSOAS_FJ2 ON GLO_PESSOAS_FJ (NOME_RAZAO);
CREATE UNIQUE INDEX GLO_VEICULOS_PLACA ON GLO_VEICULOS (CNPJ, PESSOA_FJ, PLACA);
CREATE INDEX IBE$LOG_BLOB_FIELDS_IDX1 ON IBE$LOG_BLOB_FIELDS (LOG_TABLES_ID);
CREATE INDEX IBE$LOG_FIELDS_IDX1 ON IBE$LOG_FIELDS (LOG_TABLES_ID);
CREATE INDEX IBE$LOG_KEYS_IDX1 ON IBE$LOG_KEYS (LOG_TABLES_ID);
CREATE INDEX OFC_ORDEM_SERVICO_IDX1 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO, PESSOA_FJ, TIPO_TECNICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX10 ON OFC_ORDEM_SERVICO (CNPJ, PESSOA_FJ);
CREATE INDEX OFC_ORDEM_SERVICO_IDX11 ON OFC_ORDEM_SERVICO (CNPJ, TEMPO_RESPOSTA);
CREATE INDEX OFC_ORDEM_SERVICO_IDX12 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA);
CREATE INDEX OFC_ORDEM_SERVICO_IDX13 ON OFC_ORDEM_SERVICO (CNPJ, OS_RECHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX14 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX15 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX16 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ);
CREATE INDEX OFC_ORDEM_SERVICO_IDX17 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX18 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX19 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX2 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO, TIPO_TECNICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX20 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX21 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX22 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX23 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX24 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX25 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX26 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX27 ON OFC_ORDEM_SERVICO (CNPJ, ENTRADA, PESSOA_FJ, PRODUTO, ID_MOTIVO_CHAMADO, COD_STATUS, MECANICO, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX28 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ);
CREATE INDEX OFC_ORDEM_SERVICO_IDX29 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX3 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX30 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX31 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX32 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX33 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX34 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX35 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX36 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX37 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX38 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX39 ON OFC_ORDEM_SERVICO (CNPJ, DT_ATRIBUICAO, PESSOA_FJ, PRODUTO, ID_MOTIVO_CHAMADO, COD_STATUS, MECANICO, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX4 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO, PESSOA_FJ);
CREATE INDEX OFC_ORDEM_SERVICO_IDX40 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ);
CREATE INDEX OFC_ORDEM_SERVICO_IDX41 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX42 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX43 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX44 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX45 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX46 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX47 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, ID_MOTIVO_CHAMADO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX48 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, COD_STATUS);
CREATE INDEX OFC_ORDEM_SERVICO_IDX49 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, MECANICO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX5 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO, PESSOA_FJ, TEMPO_RESPOSTA);
CREATE INDEX OFC_ORDEM_SERVICO_IDX50 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX51 ON OFC_ORDEM_SERVICO (CNPJ, DATA_FECHAMENTO, PESSOA_FJ, PRODUTO, ID_MOTIVO_CHAMADO, COD_STATUS, MECANICO, ID_TIPO_ATENDIMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX52 ON OFC_ORDEM_SERVICO (MAP_LAT, MAP_LONG);
CREATE INDEX OFC_ORDEM_SERVICO_IDX6 ON OFC_ORDEM_SERVICO (CNPJ, DATA, PRODUTO, TEMPO_RESPOSTA);
CREATE INDEX OFC_ORDEM_SERVICO_IDX7 ON OFC_ORDEM_SERVICO (CNPJ, DATA);
CREATE INDEX OFC_ORDEM_SERVICO_IDX8 ON OFC_ORDEM_SERVICO (CNPJ, PRODUTO);
CREATE INDEX OFC_ORDEM_SERVICO_IDX9 ON OFC_ORDEM_SERVICO (CNPJ, TIPO_TECNICO);
CREATE INDEX OFC_ORDEM_SERVICO_ORCAMENTO ON OFC_ORDEM_SERVICO (CNPJ, ORCAMENTO);
CREATE INDEX OFC_ORDEM_SERVICO_VENDA ON OFC_ORDEM_SERVICO (CNPJ, VENDA);
CREATE INDEX OFC_ORDEM_SERVICO_SERVICO_IDX1 ON OFC_ORDEM_SERVICO_SERVICO (CNPJ, SERVICO);
CREATE INDEX OFC_ORDEM_SERVICO_SERV_ORC_IDX1 ON OFC_ORDEM_SERVICO_SERVICO_ORC (CNPJ, SERVICO);
CREATE INDEX IDX_SIS_TABELAS_SISTEMA_CAMPOS ON SIS_TABELAS_SISTEMA_CAMPOS (CAMPO);


/******************************************************************************/
/****                               Triggers                               ****/
/******************************************************************************/


SET TERM ^ ;


/******************************************************************************/
/****                         Triggers for tables                          ****/
/******************************************************************************/



/* Trigger: ACT_ACERTOCONTA_BI */
CREATE TRIGGER ACT_ACERTOCONTA_BI FOR ACT_ACERTOCONTA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_ACT_ACERTOCONTA_ID,1);
END
^

/* Trigger: ACT_CONFIGURACAOTITULO_BI */
CREATE TRIGGER ACT_CONFIGURACAOTITULO_BI FOR ACT_CONFIGURACAOTITULO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_ACT_CONFIGURACAOTITULO_ID,1);
END
^

/* Trigger: ACT_EVENTOCONTABIL_BI */
CREATE TRIGGER ACT_EVENTOCONTABIL_BI FOR ACT_EVENTOCONTABIL
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODEVENTOCONTABIL IS NULL) THEN
    NEW.CODEVENTOCONTABIL = GEN_ID(GEN_ACT_EVENTOCONTABIL_ID,1);
END
^

/* Trigger: ACT_TITULOGERADO_BI */
CREATE TRIGGER ACT_TITULOGERADO_BI FOR ACT_TITULOGERADO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_ACT_TITULOGERADO_ID,1);
END
^

/* Trigger: AGR_CATEGORIA_DEFENSIVO_BI */
CREATE TRIGGER AGR_CATEGORIA_DEFENSIVO_BI FOR AGR_CATEGORIA_DEFENSIVO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_CATEGORIA_DEFENSIVO_ID,1);
END
^

/* Trigger: AGR_CLASSE_TOXICOLOGICA_BI */
CREATE TRIGGER AGR_CLASSE_TOXICOLOGICA_BI FOR AGR_CLASSE_TOXICOLOGICA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_CLASSE_TOXICOLOGICA_ID,1);
END
^

/* Trigger: AGR_CLASSIFICAO_QUIMICA_BI */
CREATE TRIGGER AGR_CLASSIFICAO_QUIMICA_BI FOR AGR_CLASSIFICAO_QUIMICA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_CLASSIFICAO_QUIMICA_ID,1);
END
^

/* Trigger: AGR_CULTURA_BI */
CREATE TRIGGER AGR_CULTURA_BI FOR AGR_CULTURA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_CULTURA_ID,1);
END
^

/* Trigger: AGR_DEFENSIVOCULTURAPRAGA_BI */
CREATE TRIGGER AGR_DEFENSIVOCULTURAPRAGA_BI FOR AGR_DEFENSIVOCULTURAPRAGA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_DEFENSIVOCULTURAPRAGA_ID,1);
END
^

/* Trigger: AGR_DEFENSIVO_AGRICOLA_BI */
CREATE TRIGGER AGR_DEFENSIVO_AGRICOLA_BI FOR AGR_DEFENSIVO_AGRICOLA
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable existe integer;
BEGIN
  select count(*) from agr_defensivo_agricola def
  where def.cod_produto = new.cod_produto
  into :existe;

  if (:existe > 0) then
    exception VALIDA_PROD_DEFENSIVO;


  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_DEFENSIVO_AGRICOLA_ID,1);
END
^

/* Trigger: AGR_FABRICANTE_BI */
CREATE TRIGGER AGR_FABRICANTE_BI FOR AGR_FABRICANTE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_FABRICANTE_ID,1);
END
^

/* Trigger: AGR_MAT_EMBALAGEM_BI */
CREATE TRIGGER AGR_MAT_EMBALAGEM_BI FOR AGR_MAT_EMBALAGEM
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_MAT_EMBALAGEM_ID,1);
END
^

/* Trigger: AGR_MEDIDA_DOSAGEM_BI */
CREATE TRIGGER AGR_MEDIDA_DOSAGEM_BI FOR AGR_MEDIDA_DOSAGEM
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_MEDIDA_DOSAGEM_ID,1);
END
^

/* Trigger: AGR_PRAGA_BI */
CREATE TRIGGER AGR_PRAGA_BI FOR AGR_PRAGA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_PRAGA_ID,1);
END
^

/* Trigger: AGR_RECEITAS_BI */
CREATE TRIGGER AGR_RECEITAS_BI FOR AGR_RECEITAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_RECEITAS_ID,1);

  new.data = current_date;
END
^

/* Trigger: AGR_RECEITAS_BU0 */
CREATE TRIGGER AGR_RECEITAS_BU0 FOR AGR_RECEITAS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
begin
  select count(*) from agr_receitas rc
  where rc.cnpj = new.cnpj and rc.n_receita = new.n_receita and rc.codigo <> new.codigo
  into :existe;

  if (:existe > 0) then
    exception valida_n_receita;
end
^

/* Trigger: AGR_REGISTRANTE_BI */
CREATE TRIGGER AGR_REGISTRANTE_BI FOR AGR_REGISTRANTE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_AGR_REGISTRANTE_ID,1);
END
^

/* Trigger: CM2_ACERTO_COMISSAO_BI */
CREATE TRIGGER CM2_ACERTO_COMISSAO_BI FOR CM2_ACERTO_COMISSAO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM2_ACERTO_COMISSAO_ID,1);
END
^

/* Trigger: CM2_COMISSAO_PARC_BI */
CREATE TRIGGER CM2_COMISSAO_PARC_BI FOR CM2_COMISSAO_PARC
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM2_COMISSAO_PARC_ID,1);
END
^

/* Trigger: CM2_PARC_ACERTO_BI */
CREATE TRIGGER CM2_PARC_ACERTO_BI FOR CM2_PARC_ACERTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM2_PARC_ACERTO_ID,1);
END
^

/* Trigger: CM_COMISSAO_BI */
CREATE TRIGGER CM_COMISSAO_BI FOR CM_COMISSAO
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable existe integer;
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_COMISSAO_ID,1);

 if (new.cod_venda is not null) then
  begin
      select count(*) from fat_vendas vd
      where vd.cnpj = new.cnpj and vd.codigo = new.cod_venda and vd.pessoa_fj = new.pessoa_fj
      into :existe;
    
      if (:existe = 0) then
         exception CM_RELACAO;
  end

  /* if (new.cod_vendedor is not null) then
  begin
     select count(*) from fat_vendedor vdd
     where vdd.cnpj = new.cnpj and vdd.codigo = new.cod_vendedor
     into :existe;

     if (:existe = 0) then
     exception CM_RELACAO;
  end */

  if (new.cod_troca is not null) then
  begin
     select count(*) from fat_trocas tr
     where tr.cnpj = new.cnpj and tr.codigo = new.cod_troca and tr.pessoa_fj = new.pessoa_fj
     into :existe;

     if (:existe = 0) then
     exception CM_RELACAO;
  end

  if (new.pessoa_fj is not null) then
  begin
     select count(*) from glo_pessoas_fj psa
     where psa.cnpj = new.cnpj and psa.codigo = new.pessoa_fj
     into :existe;

     if (:existe = 0) then
     exception CM_RELACAO;
  end

  if (new.dt_geracao is null) then
     new.dt_geracao = cast ('today' as date);
END
^

/* Trigger: CM_COMISSAO_PARC_AD0 */
CREATE TRIGGER CM_COMISSAO_PARC_AD0 FOR CM_COMISSAO_PARC
ACTIVE AFTER DELETE POSITION 0
AS
declare variable cont integer;
begin
  /*no estorno de geradas para abertas, caso sejam uma venda à vista esta
  terá somente um registro de parcelamento que será excluido ao se
  fazer o estorno, portanto o cabeçalho tambem terá de ser excluido*/
  select count(*) from cm_comissao_parc cmp
  where cmp.cnpj = old.cnpj and cmp.cod_comissao = old.cod_comissao
  into :cont;

  if (:cont = 0) then
   delete from cm_comissao cm where cm.cnpj = old.cnpj and cm.codigo = old.cod_comissao;
END
^

/* Trigger: CM_COMISSAO_PARC_AU0 */
CREATE TRIGGER CM_COMISSAO_PARC_AU0 FOR CM_COMISSAO_PARC
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable cont integer;
begin
  if (new.status <> old.status) then
  begin
    select count(*) from cm_comissao_parc cmp
    where cmp.cnpj = new.cnpj and cmp.cod_comissao = new.cod_comissao
    and coalesce(cmp.status,'A') <> new.status
    into cont;

    if (cont = 0) then
       update cm_comissao set status = new.status where cnpj = new.cnpj and codigo = new.cod_comissao;
  end
END
^

/* Trigger: CM_COMISSAO_PARC_BI */
CREATE TRIGGER CM_COMISSAO_PARC_BI FOR CM_COMISSAO_PARC
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_COMISSAO_PARC_ID,1);
END
^

/* Trigger: CM_COMISSAO_PARC_BU0 */
CREATE TRIGGER CM_COMISSAO_PARC_BU0 FOR CM_COMISSAO_PARC
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable cont integer;
declare variable existereceber integer;
begin
  /*isso valida apenas o cancelamento da comissão*/
  if ((new.status <> old.status) and (new.status = 'C')) then
  begin
    /*se tem ou teve referencia com pagar*/
    select count(*) from cm_parc_pagar p
    where p.cnpj = new.cnpj and p.cod_parc_com = new.codigo
    into :cont;

    if (:cont > 0 ) then
    begin

      select count(*) from fin_contas_pagar pgr
      inner join cm_parc_pagar cpp on (cpp.cnpj = pgr.cnpj and pgr.codigo = cpp.cod_pagar)
      where cpp.cod_parc_com = new.codigo and cpp.cnpj = new.cnpj
      into :cont;

      /*se ainda possui referencia com pagar*/
      if (:cont > 0) then
         exception CM_PG_EXISTE;

      select count(*) from fin_baixas_pagar bx
      inner join cm_parc_pagar cpp on (cpp.cnpj = bx.cnpj and bx.codigo_pg = cpp.cod_pagar)
      where cpp.cod_parc_com = new.codigo and cpp.cnpj = new.cnpj
      into :cont;

      /*se ainda possui referencia com pagar*/
      if (:cont > 0) then
         exception CM_PG_BAIXADA;
    end

       
  end
  /*atualizado após gerado o contas à pagar*/
  if ((new.pct_liberado = 0) and (old.pct_liberado > 0)) then
  begin
    select count(*) from fin_contas_receber rec
    where rec.cnpj = new.cnpj and rec.codigo = new.cod_receber
    into :existereceber;

    /*se já foi toda quitada a conta..
    neste caso ou totalizou o pagamento da comissão.. com o pct.. pago
    ou não pagou 100 pcento pois foi dado desconto mas o receber foi baixado automaticamente*/
    if ((new.pct_pago = 100) or ((:existereceber = 0) and (new.cod_receber is not null))) then
       new.status = 'Q';
  end
  /*validação.. quando é feito um crédito de comissão, e esta é quitada, o pct liberado
  vai para '0', no entanto se a conta à pagar vier a ser excluida e for realizado o
  estorno do recebimento, o pct liberado irá ficar negativo*/
  if (new.pct_liberado < 0) then
     new.pct_liberado = 0;
END
^

/* Trigger: CM_LOG_BI */
CREATE TRIGGER CM_LOG_BI FOR CM_LOG
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_LOG_ID,1);

  new.dt_geracao = cast ('today' as date);

  new.hora = cast ('now' as time);
END
^

/* Trigger: CM_PARC_PAGAR_BI */
CREATE TRIGGER CM_PARC_PAGAR_BI FOR CM_PARC_PAGAR
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PARC_PAGAR_ID,1);
END
^

/* Trigger: CM_PERFIL_BI */
CREATE TRIGGER CM_PERFIL_BI FOR CM_PERFIL
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_ID,1);
END
^

/* Trigger: CM_PERFIL_FAIXA_BI */
CREATE TRIGGER CM_PERFIL_FAIXA_BI FOR CM_PERFIL_FAIXA
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable aux float;
begin
  if (new.vlr_inicial is null) then
  begin

    select max(cm.vlr_final) from cm_perfil_faixa cm
    where cm.cnpj = new.cnpj and cm.cod_perfil = new.cod_perfil
    into :aux;

    if (:aux is null) then
      new.vlr_inicial = 0;
    else
      new.vlr_inicial = (aux + 0.01);
  end

  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_FAIXA_ID,1);
END
^

/* Trigger: CM_PERFIL_FAIXA_BU0 */
CREATE TRIGGER CM_PERFIL_FAIXA_BU0 FOR CM_PERFIL_FAIXA
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable aux float;
begin
  if (new.vlr_inicial is null) then
  begin

    select max(cm.vlr_final) from cm_perfil_faixa cm
    where cm.cnpj = new.cnpj and cm.cod_perfil = new.cod_perfil
    into :aux;

    if (:aux is null) then
      new.vlr_inicial = 0;
    else
      new.vlr_inicial = (aux + 0.01);
  end
END
^

/* Trigger: CM_PERFIL_FAIXA_DESC_BI */
CREATE TRIGGER CM_PERFIL_FAIXA_DESC_BI FOR CM_PERFIL_FAIXA_DESC
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_FAIXA_DESC_ID,1);
END
^

/* Trigger: CM_PERFIL_FAIXA_PROD_BI */
CREATE TRIGGER CM_PERFIL_FAIXA_PROD_BI FOR CM_PERFIL_FAIXA_PROD
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_FAIXA_PROD_ID,1);
END
^

/* Trigger: CM_PERFIL_PAGTO_BI */
CREATE TRIGGER CM_PERFIL_PAGTO_BI FOR CM_PERFIL_PAGTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_PAGTO_ID,1);
END
^

/* Trigger: CM_PERFIL_PAGTO_FAIXA_BI */
CREATE TRIGGER CM_PERFIL_PAGTO_FAIXA_BI FOR CM_PERFIL_PAGTO_FAIXA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_PERFIL_PAGTO_FAIXA_ID,1);
END
^

/* Trigger: CM_REL_COM_PGR_REC_BI */
CREATE TRIGGER CM_REL_COM_PGR_REC_BI FOR CM_REL_COM_PGR_REC
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CM_REL_COM_PGR_REC_ID,1);
END
^

/* Trigger: CRG_FORMAR_CARGA_BI */
CREATE TRIGGER CRG_FORMAR_CARGA_BI FOR CRG_FORMAR_CARGA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CRG_FORMAR_CARGA_ID,1);
END
^

/* Trigger: CRG_ORDEM_CARGA_AI0 */
CREATE TRIGGER CRG_ORDEM_CARGA_AI0 FOR CRG_ORDEM_CARGA
ACTIVE AFTER INSERT POSITION 0
AS
DECLARE VARIABLE FTI_CARREGAR NUMERIC(18,4);
DECLARE VARIABLE FTI_ENTREGAR NUMERIC(18,4);
DECLARE VARIABLE FTI_DEVOLVER NUMERIC(18,4);
DECLARE VARIABLE FTI_GRADE VARCHAR(4);
DECLARE VARIABLE FTI_NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE FTI_NUMERO VARCHAR(6);
DECLARE VARIABLE FTI_PRODUTO VARCHAR(15);
DECLARE VARIABLE FTI_UNIDADE CHAR(4);
DECLARE VARIABLE FTI_CNPJ CHAR(14);
DECLARE VARIABLE FTI_CODIGO_LOTE INTEGER;
DECLARE VARIABLE FTI_LOTE VARCHAR(10);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE SEQUENCIA_VND INTEGER;
begin
     SEQUENCIA = 0;
     for select fti.cnpj, fti.entregar, fti.carregar, fti.devolver, fti.grade, fti.nome_produto,
         fti.numero, fti.produto, fti.unidade, fti.codigo_lote, fti.lote, fti.sequencia
         from fat_vendas_itens fti
         where (fti.codigo = new.codigo_vnd)and((coalesce(fti.carregar,0)+coalesce(fti.entregar,0)+coalesce(fti.devolver,0))>0)
         into :fti_cnpj, :fti_entregar, :fti_carregar, :fti_devolver, :fti_grade, :fti_nome_produto,
         :fti_numero, :fti_produto, :fti_unidade, fti_codigo_lote, fti_lote, :sequencia_vnd
     do
     begin
        sequencia = sequencia + 1;
        insert into crg_ordem_carga_itens(cnpj, codigo, codigo_vnd, sequencia, entregue, quantidade, devolvido,
        grade, nome_produto, numero, produto, unidade, codigo_lote, lote, sequencia_vnd)
        values (:fti_cnpj, new.codigo, new.codigo_vnd, :sequencia, :fti_entregar ,:fti_carregar,:fti_devolver,
        :fti_grade, :fti_nome_produto, :fti_numero, :fti_produto, :fti_unidade, :fti_codigo_lote, :fti_lote, :sequencia_vnd);
     end
END
^

/* Trigger: CRG_ORDEM_CARGA_BI */
CREATE TRIGGER CRG_ORDEM_CARGA_BI FOR CRG_ORDEM_CARGA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CRG_ORDEM_CARGA_ID,1);
END
^

/* Trigger: CRG_ORDEM_CARGA_ITENS_BI */
CREATE TRIGGER CRG_ORDEM_CARGA_ITENS_BI FOR CRG_ORDEM_CARGA_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_CRG_ORDEM_CARGA_ITENS_ID,1);
END
^

/* Trigger: CTB_CHEQUE_BI0 */
CREATE TRIGGER CTB_CHEQUE_BI0 FOR CTB_CHEQUE
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
BEGIN
     if (new.impresso is null) then
       new.impresso = 'N';

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
END
^

/* Trigger: CTB_CHEQUE_BU0 */
CREATE TRIGGER CTB_CHEQUE_BU0 FOR CTB_CHEQUE
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable NOME VARCHAR(50);
BEGIN
     if (new.impresso is null) then
       new.impresso = 'N';

     IF ((NEW.NOME IS NULL) AND ( NEW.PESSOA_FJ <> OLD.PESSOA_FJ ))
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
END
^

/* Trigger: CTB_MOVIMENTO_CONTABIL_BD0 */
CREATE TRIGGER CTB_MOVIMENTO_CONTABIL_BD0 FOR CTB_MOVIMENTO_CONTABIL
ACTIVE BEFORE DELETE POSITION 0
AS
DECLARE VARIABLE PLN INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
begin
  select count(*) from ctb_cheque ch
  where ('CH: '||ch.cheque) = old.documento and ch.cnpj = old.cnpj
  into :existe;


 if (coalesce(:existe,0) > 0) then
   exception VALIDA_CTB_EXCLUSAO;

 select count(planilha)
 from ctb_movimento_contabil
 where ( cnpj = old.cnpj ) and (planilha = old.planilha) and
 ((old.excluir <> 'S') or ( excluir is null ))
 into :pln ;

 if (pln is null) then
     pln = 0;

/*     IF ( PLN > 0 )
     THEN BEGIN
          EXCEPTION EXCLUSAO_PLANILHA ;
     END*/
END
^

/* Trigger: CTB_MOVIMENTO_CONTABIL_BI */
CREATE TRIGGER CTB_MOVIMENTO_CONTABIL_BI FOR CTB_MOVIMENTO_CONTABIL
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE BANCO CHAR(3);
DECLARE VARIABLE COD   INTEGER;
DECLARE VARIABLE CONT  INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE EXISTE INTEGER;
declare variable bloqueia char;
BEGIN

     /*MOVIMENTO CONTABIL*/
     NEW.ANO = EXTRACT (YEAR FROM NEW.DATA) ;
     NEW.MES = EXTRACT (MONTH FROM NEW.DATA);

     select sis_empresas.bloqueia_mvb from sis_empresas
     where(sis_empresas.cnpj = new.cnpj)
     into :bloqueia;
     /*Nao deixa incluir movimento bancario com documento repetido*/
     IF (:bloqueia = 'S') THEN
         SELECT COUNT(*) FROM  ctb_movimento_contabil ctb
         WHERE ctb.cnpj = NEW.cnpj AND ctb.documento = NEW.documento AND
          ctb.conta = NEW.conta
         INTO :existe;

    IF (existe > 0) THEN
        EXCEPTION   MOVIMENTO_BANCARIO_DUPLICADO;

     /* VERIFICA SE A CONTA TEM O BANCO E SE O BANCO ESTA NULO */
     IF ( NEW.BANCO IS NULL )
     THEN BEGIN
          SELECT BANCO FROM CTB_PLANOCONTA C
          WHERE CNPJ = NEW.CNPJ AND C.CONTA = NEW.conta
          INTO :BANCO ;

          IF ( NOT BANCO IS NULL )
          THEN
             NEW.BANCO = :BANCO ;
     END

     /* LANCA A CONTRAPARTIDA */
/*     IF ((NEW.TIPO = 'C') AND (NEW.CONTRA_PARTIDA IS NOT NULL) AND (NEW.TIPO_LANCAMENTO <> 'A'))
     THEN BEGIN
          /* CODIGO PARA O NOVO LANCAMENTO */
/*          SELECT CODIGO FROM GERAR_CODIGO ('MOVCONTABIL',1)
          into :COD;

          INSERT INTO CTB_MOVIMENTO_CONTABIL
          (CNPJ, ANO, MES, CODIGO, PLANILHA, DATA,
          DOCUMENTO, HISTORICO, VALOR, TIPO,
          CONTA, ORIGEM, CONTRA_PARTIDA )
          VALUES
          (NEW.CNPJ, NEW.ANO, NEW.MES, :COD, NEW.PLANILHA,
          NEW.DATA, NEW.DOCUMENTO, NEW.HISTORICO,
          NEW.VALOR, 'D', NEW.CONTRA_PARTIDA,
          NEW.ORIGEM, NEW.CONTA ) ;
     END

     /* ARMAZENA AS COTACOES
     IF ( NEW.DATA IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DATA
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.VALOR_INDEXADO = NEW.VALOR / :VALOR ;
               END

               CONT = CONT + 1;
          END
     END */
END
^

/* Trigger: CTB_MOVIMENTO_CONTABIL_BU0 */
CREATE TRIGGER CTB_MOVIMENTO_CONTABIL_BU0 FOR CTB_MOVIMENTO_CONTABIL
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE CONT  INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE bloqueia char(1);
DECLARE VARIABLE EXISTE  INTEGER;
begin
     /* SO ALTERAR QUEM AINDA NAO FOI CONCILIADO */
     IF (( OLD.DATA_CONCILIACAO IS NOT NULL ) AND ( NEW.DATA_CONCILIACAO IS NOT NULL ))
     THEN BEGIN
          EXCEPTION MOVIMENTO_CONCILIADO ;
     END

     
     select sis_empresas.bloqueia_mvb from sis_empresas
     where(sis_empresas.cnpj = new.cnpj)
     into :bloqueia;
     /*Nao deixa incluir movimento bancario com documento repetido*/
     IF (:bloqueia = 'S') THEN
     begin
         SELECT COUNT(*) FROM  ctb_movimento_contabil ctb
         WHERE ctb.cnpj = NEW.cnpj AND ctb.documento = NEW.documento AND
          ctb.conta = NEW.conta and ctb.codigo <> new.codigo
         INTO :existe;

        IF (existe > 0) THEN
            EXCEPTION   MOVIMENTO_BANCARIO_DUPLICADO;
     end

     /* ARMAZENA AS COTACOES
     IF ( NEW.DATA IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DATA
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.VALOR_INDEXADO = NEW.VALOR / :VALOR ;
               END

               CONT = CONT + 1;
          END
     END */
END
^

/* Trigger: CTB_PLANOCONTA_BI */
CREATE TRIGGER CTB_PLANOCONTA_BI FOR CTB_PLANOCONTA
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE LEN INTEGER;
BEGIN
     /* Transferido p/aplicação
     NEW.CODIGO = PLNCTAFRMT (NEW.CODIGO, '9.99.99.99.9999');

     IF ( NEW.CODIGO IS NULL )
     THEN
         EXCEPTION EXCLUSAO ;

     LEN = UDF_LENGTH( NEW.CODIGO );

     IF ( LEN > 1 )
     THEN BEGIN
          NEW.ContaPai = PLNCTAMAIN( NEW.CODIGO );
     END*/
POST_EVENT '$$IBE$$';
END
^

/* Trigger: CTB_PLANOCONTA_BU */
CREATE TRIGGER CTB_PLANOCONTA_BU FOR CTB_PLANOCONTA
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE LEN INTEGER;
BEGIN
     /* Transferido p/aplicação
     NEW.CODIGO = PlnCtaFrMt(NEW.CODIGO, '9.99.99.99.9999');

     IF (NEW.CODIGO IS NULL)
     THEN
         EXCEPTION exclusao;

     LEN = UDF_LENGTH( NEW.CODIGO );

     IF ( LEN > 1 )
     THEN BEGIN
          NEW.ContaPai = PLNCTAMAIN( NEW.CODIGO );
     END*/
POST_EVENT '$$IBE$$';
END
^

/* Trigger: EST_ALTERA_PRECO_AU0 */
CREATE TRIGGER EST_ALTERA_PRECO_AU0 FOR EST_ALTERA_PRECO
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable PRODUTO varchar(15);
declare variable VLR_ATUALIZACAO numeric(18,4);
declare variable PRC_VENDA_ANT numeric(18,4);
begin
  if ((old.fechada = 'N') and (new.fechada = 'S')) then
  begin
    /*atualizando o valor do produto*/
    for select PRODUTO, VLR_ATUALIZACAO from est_altera_preco_item ati
      where ati.cod_altera_preco = new.codigo
      into :produto, :vlr_atualizacao
    do
    begin
      /*transformando o preço atual do produto em preço anterio*/
      select prc_venda from est_produtos prd1
      where prd1.cnpj = new.cnpj and prd1.codigo = :produto
      into :prc_venda_ant;

      update est_produtos prd set prd.prc_venda_ant = :prc_venda_ant, prd.prc_venda = :vlr_atualizacao
      where prd.cnpj = new.cnpj and prd.codigo = :produto;
    end
  end
END
^

/* Trigger: EST_ALTERA_PRECO_BI */
CREATE TRIGGER EST_ALTERA_PRECO_BI FOR EST_ALTERA_PRECO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_ALTERA_PRECO_ID,1);

  new.fechada = 'N';
END
^

/* Trigger: EST_ALTERA_PRECO_BU0 */
CREATE TRIGGER EST_ALTERA_PRECO_BU0 FOR EST_ALTERA_PRECO
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  if (new.fechada = 'S' and coalesce(old.fechada,'N') = 'N') then
     new.dt_processamento = cast ('today' as date);
END
^

/* Trigger: EST_ALTERA_PRECO_ITEM_BI */
CREATE TRIGGER EST_ALTERA_PRECO_ITEM_BI FOR EST_ALTERA_PRECO_ITEM
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE EXISTE INTEGER;
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_ALTERA_PRECO_ITEM_ID,1);

  select count(*) from est_altera_preco_item eti
  where eti.cod_altera_preco = new.cod_altera_preco and eti.produto = new.produto
  into :existe;

  if (:existe > 0) then
   exception ALT_PRC_PRD_DUPLICADO;

  /*dados de preço do produto*/
  select coalesce(prd.prc_venda,0), coalesce(prd.prc_custo_ant,0) from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.vlr_atual, new.vlr_anterior;

  new.vlr_atualizacao = coalesce(new.vlr_atual,0)+(coalesce(new.vlr_atual,0)*coalesce(new.margem,0)/100.00);
END
^

/* Trigger: EST_ALTERA_PRECO_ITEM_BU0 */
CREATE TRIGGER EST_ALTERA_PRECO_ITEM_BU0 FOR EST_ALTERA_PRECO_ITEM
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  new.vlr_atualizacao = coalesce(new.vlr_atual,0)+(coalesce(new.vlr_atual,0)*coalesce(new.margem,0)/100.00);
END
^

/* Trigger: EST_CLASSE_GRAO_BI */
CREATE TRIGGER EST_CLASSE_GRAO_BI FOR EST_CLASSE_GRAO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_CLASSE_GRAO_ID,1);
END
^

/* Trigger: EST_CONTAGEM_AU0 */
CREATE TRIGGER EST_CONTAGEM_AU0 FOR EST_CONTAGEM
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable produto varchar(15);
declare variable ndocto varchar(20);
declare variable ano integer;
declare variable mes integer;
declare variable quant_ant numeric(18,4);
declare variable quantidade numeric(18,4);
declare variable customedio numeric(18,4);
declare variable quantidade2 numeric(18,4);
declare variable tipo_kdx char(1);
declare variable grade varchar(4);
declare variable numero varchar(6);

/* Contagem Fiscal */
declare variable quant1_ant numeric(18,4);
declare variable quantidade1 numeric(18,4);
declare variable local integer;
declare variable origem char(1);

begin
  /*gerando tabela do kardex após fechado a contagem*/
  if ((new.fechada = 'S') and (coalesce(old.fechada,'N')='N')) then
  begin
        ano = extract (year from new.data);
        mes = extract (month from new.data);
        ndocto = cast(new.codigo as varchar(20));
        local  = new.local;
    
        /*percorrendo todos os itens da contagem*/
        for select etp.produto, etp.quantidade, coalesce(etp.grade,'0'), coalesce(etp.numero,'0')
            from est_contagem_produtos etp
            where etp.cnpj = new.cnpj and etp.codigo = new.codigo
            into :produto, :quantidade, :grade, :numero
        do
        begin
            /*========[ Atualiza qtde fiscal]================*/
            if( :local = 1 )then
            begin
                quantidade1 = quantidade;
                origem = 'F';
                /*achando a qtde anterior*/
                select coalesce(prd.qtdade_1,0) from est_produtos prd
                where prd.cnpj = new.cnpj and prd.codigo = :produto
                into :quant_ant;
            end
            else begin
            /*========[ Atualiza qtde fisico]================*/
                quantidade2 = quantidade;
                origem = '';
                /*achando a qtde anterior*/
                select coalesce(prd.qtdade_2,0) from est_produtos prd
                where prd.cnpj = new.cnpj and prd.codigo = :produto
                into :quant_ant;
            end
  
            /*--------Verificando se o estoque vai incrementar ou decremendar--------*/
            if (:quant_ant < :quantidade)then
            begin
              quantidade = (:quantidade - :quant_ant);
              tipo_kdx = 'E'; /*Registro como movimento de entrada*/
            end
            else if (:quant_ant > :quantidade) then
            begin
             quantidade = (:quant_ant - :quantidade);
             tipo_kdx = 'S'; /*Registro como movimento de saída*/
            end
            else
            begin
              quantidade = 0;
              tipo_kdx = 'N'; /*Neutro*/
            end
  

            /*----------------------------inserindo no kardex------------------------*/
            insert into est_kardex (cnpj, produto, ndocto,
                              dt_movto, mes, ano,
                              origem, tipo_es,
                              qtdade_ant, qtdade, prc_unit,
                              descontos, custo_medio)
            values              (new.cnpj, :produto, :ndocto,
                              new.data, :mes, :ano,
                              'CNT'||:origem, :tipo_kdx,
                              :quant_ant, :quantidade, 0,
                              0, :customedio);
      
            if ((:grade <> '0' ) and (:numero <> '0')) then
            begin
                /*========[ Atualiza qtde fiscal]================*/
                if(:local = 1)then
                begin
                    update est_produtos set qtdade_1 = :quantidade1
                    where cnpj = new.cnpj and codigo = :produto ;
                 end
                 else begin
                    /* atualiza a grade e os numeros*/
                    update est_produtos_grades_numeros
                    set estoque = :quantidade2
                    where cnpj = new.cnpj and produto = :produto and grade = :grade and
                    numero = :numero;
                 end
            end
            else
            begin
                /*========[ Atualiza qtde fiscal]================*/
                if(:local = 1)then
                begin
                    update est_produtos set qtdade_1 = :quantidade1
                    where cnpj = new.cnpj and codigo = :produto ;
                end
                else
                begin
               /*=========[ Atualiza qtde fisico]================*/
                    update est_produtos set qtdade_2 = :quantidade2
                    where cnpj = new.cnpj and codigo = :produto ;
                 end
            end
      
            grade  = null;
            numero = null;

            update est_contagem_grade_produto ctp set ctp.quantidade_anterior = :quant_ant
            where ctp.cnpj  = new.cnpj and ctp.codigo = new.codigo;
        end
  end
END
^

/* Trigger: EST_CONTAGEM_GRADE_AU0 */
CREATE TRIGGER EST_CONTAGEM_GRADE_AU0 FOR EST_CONTAGEM_GRADE
ACTIVE AFTER UPDATE POSITION 0
AS
begin
  if (old.processada = 'N' and new.processada = 'S') then
    execute procedure pcd_est_processa_contagem_grade(new.cnpj,new.codigo);
END
^

/* Trigger: EST_CONTAGEM_GRADE_BU0 */
CREATE TRIGGER EST_CONTAGEM_GRADE_BU0 FOR EST_CONTAGEM_GRADE
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  /* Trigger text */
  new.dt_processamento = cast('now' as timestamp);
END
^

/* Trigger: EST_CONTAGEM_GRADE_PRODUTO_BI0 */
CREATE TRIGGER EST_CONTAGEM_GRADE_PRODUTO_BI0 FOR EST_CONTAGEM_GRADE_PRODUTO
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable local integer;
begin
  select coalesce(et.local,2) from est_contagem_grade et
  where et.cnpj = new.cnpj and et.codigo = new.contagem_grade
  into :local;

  if (:local = 2) then
  begin
    if ((coalesce(new.grade,'000') <> '000') and (coalesce(new.numero,'000000') <> '000000')) then
    begin
      select coalesce(prd.estoque,0) from est_produtos_grades_numeros prd
      where prd.cnpj = new.cnpj and prd.grade = new.grade and prd.numero = new.numero and prd.produto = new.produto
      into new.quantidade_anterior;
    end
    begin
      select coalesce(prd.qtdade_2,0) from est_produtos prd
      where prd.cnpj = new.cnpj and prd.codigo = new.produto
      into new.quantidade_anterior;
    end
  end
  else
  begin
    select coalesce(prd.qtdade_1,0) from est_produtos prd
    where prd.cnpj = new.cnpj and prd.codigo = new.produto
    into new.quantidade_anterior;
  end
END
^

/* Trigger: EST_CONVERSAO_UNID_MED_BI */
CREATE TRIGGER EST_CONVERSAO_UNID_MED_BI FOR EST_CONVERSAO_UNID_MED
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_CONVERSAO_UNID_MED_ID,1);
END
^

/* Trigger: EST_EMAIL_POSICAO_ESTOQUE_BI */
CREATE TRIGGER EST_EMAIL_POSICAO_ESTOQUE_BI FOR EST_EMAIL_POSICAO_ESTOQUE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_EMAIL_ESTOQUE_ID,1);
END
^

/* Trigger: EST_ENTRADAS_BI */
CREATE TRIGGER EST_ENTRADAS_BI FOR EST_ENTRADAS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR (50);
BEGIN
     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END

     NEW.COD_INTERNO = GEN_ID(gen_est_entradas_cod_interno,1);
END
^

/* Trigger: EST_ENTRADAS_BI1 */
CREATE TRIGGER EST_ENTRADAS_BI1 FOR EST_ENTRADAS
ACTIVE BEFORE INSERT POSITION 1
AS
declare variable NOME VARCHAR (50);
BEGIN
     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
END
^

/* Trigger: EST_ENTRADAS_ITENS_BU0 */
CREATE TRIGGER EST_ENTRADAS_ITENS_BU0 FOR EST_ENTRADAS_ITENS
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
declare variable existe integer;
declare variable logue_custo_medio numeric(18,4);
declare variable log_estoque numeric(18,4);
declare variable und_primaria char(4);
begin
  /*verificando se a unidade selecionada esta relacionada com o produto
  ou se esta cadastrado na conversão de medidas */
  select coalesce(prd.qtdade_2,0), coalesce(prd.prc_custo_med,0) from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.log_estoque_anterior, new.log_custo_medio_anterior;

  select count(*) from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto and prd.unidade = new.unidade
  into existe;

  /*se a unidade não esta definida no cadastro de produtos, então ela deverá
  estar necessariamente definida no cadastro de conversãoa*/
  if (coalesce(existe,0) = 0) then
  begin
    select prd.und_primaria from est_produtos prd
    where prd.cnpj = new.cnpj and prd.codigo = new.produto
    into :und_primaria;

    select count(*) from est_conversao_unid_med cv
    where cv.cod_und_conversao = new.unidade and cv.cod_und_padrao = :und_primaria
    into existe;

    if (coalesce(existe,0) = 0) then
       exception VALIDA_UNIDADE;
  end
end
^

/* Trigger: EST_ENTRADAS_ITENS_GRADES_BI0 */
CREATE TRIGGER EST_ENTRADAS_ITENS_GRADES_BI0 FOR EST_ENTRADAS_ITENS_GRADES
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE ORD INTEGER;
DECLARE VARIABLE NUM VARCHAR(6);
begin
     /*  */
     ORD = NULL;
     NUM = NULL;

     SELECT ORDEM, NUMERO
     FROM EST_PRODUTOS_GRADES_NUMEROS
     WHERE CNPJ = NEW.CNPJ AND PRODUTO = NEW.PRODUTO
     AND GRADE = NEW.GRADE AND NUMERO = NEW.NUMERO
     INTO :ORD, :NUM ;

     IF (( :ORD IS NULL ) AND ( NUM IS NOT NULL ))
     THEN BEGIN
          ORD = CAST(:NUM AS INTEGER) + 100;
     END

     NEW.ORDEM = :ORD;
END
^

/* Trigger: EST_ENTRADAS_ITENS_LOTES_BI */
CREATE TRIGGER EST_ENTRADAS_ITENS_LOTES_BI FOR EST_ENTRADAS_ITENS_LOTES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_ENTRADAS_ITENS_LOTES_ID,1);
END
^

/* Trigger: EST_ESTIQUETA_PRODUTO_BI0 */
CREATE TRIGGER EST_ESTIQUETA_PRODUTO_BI0 FOR EST_ESTIQUETA_PRODUTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
     IF ( NEW.GRADE IS NULL )
     THEN
         NEW.GRADE = '0';

     IF ( NEW.NUMERO IS NULL )
     THEN
         NEW.NUMERO = 0;

     SELECT EST_PRODUTOS.CODIGO_2
     FROM EST_PRODUTOS
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.CODIGO
     INTO NEW.CODIGO_2 ;
END
^

/* Trigger: EST_ESTIQUETA_PRODUTO_IMP_BI0 */
CREATE TRIGGER EST_ESTIQUETA_PRODUTO_IMP_BI0 FOR EST_ESTIQUETA_PRODUTO_IMPRIME
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE AUX VARCHAR(15);
DECLARE VARIABLE AC_ZEROS CHAR(1);
DECLARE VARIABLE ZEROS INTEGER;
DECLARE VARIABLE MARCA INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TAM INTEGER;

begin
     SELECT SIS_EMPRESAS.PDV_ACRESCENTA_ZEROS, SIS_EMPRESAS.NUMERO_ZEROS
     FROM SIS_EMPRESAS
     WHERE CNPJ = NEW.CNPJ
     INTO :AC_ZEROS, :ZEROS ;

     AUX = NEW.CODIGO ;

     select tamanho from getlength(:AUX) into :tam;
     IF ( :AC_ZEROS ='S' )
     THEN BEGIN
          WHILE ( :tam < ZEROS ) DO
          BEGIN
               AUX = '0' || :AUX ;
               select * from getlength(:AUX) into :tam;
          END
     END

     IF ( NEW.GRADE IS NULL )
     THEN
         NEW.GRADE = '0';

     IF ( NEW.NUMERO IS NULL )
     THEN
         NEW.NUMERO = 0;

     SELECT EST_PRODUTOS.CODIGO_2, MARCA, PRC_VENDA
     FROM EST_PRODUTOS
     WHERE CNPJ = NEW.CNPJ AND CODIGO = :AUX
     INTO NEW.CODIGO_2, :MARCA, :VALOR ;

     NEW.MARCA = :MARCA;

     IF (( NEW.VALOR = 0 ) OR ( NEW.VALOR IS NULL ))
     THEN BEGIN
          NEW.VALOR = :VALOR ;
     END
END
^

/* Trigger: EST_FECHAMENTO_MES_BI0 */
CREATE TRIGGER EST_FECHAMENTO_MES_BI0 FOR EST_FECHAMENTO_MES
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE MES1 SMALLINT;
DECLARE VARIABLE ANO1 SMALLINT;
DECLARE VARIABLE INICIAL NUMERIC(18,4);
begin

     IF ( NEW.MES = 1 )
     THEN BEGIN
          MES1 = 12 ;
          ANO1 = NEW.ANO - 1;
     END
     ELSE BEGIN
          MES1 = NEW.MES - 1;
          ANO1 = NEW.ANO ;
     END

     /* SALDO INICIAL */
     SELECT SUM(SALDO_INICIAL+ENTRADAS-SAIDAS)
     FROM EST_FECHAMENTO_MES
     WHERE CNPJ = NEW.CNPJ AND MES = :MES1  AND ANO = :ANO1 AND PRODUTO = NEW.PRODUTO
     INTO :INICIAL ;

     IF ( INICIAL IS NULL )
     THEN BEGIN
          INICIAL = 0;
     END

     NEW.SALDO_INICIAL = INICIAL ;
END
^

/* Trigger: EST_HISTORICO_PRD_CUSTO_BI */
CREATE TRIGGER EST_HISTORICO_PRD_CUSTO_BI FOR EST_HISTORICO_PRD_CUSTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_HISTORICO_PRD_CUSTO_ID,1);

  NEW.hora = CURRENT_TIME;
END
^

/* Trigger: EST_KARDEX_AU0 */
CREATE TRIGGER EST_KARDEX_AU0 FOR EST_KARDEX
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable prox_codigo integer;
declare variable saldo numeric(18,4);
declare variable cont integer;
declare variable existe integer;
declare variable sequencia integer;
declare variable qtde_lote numeric(18,4);
declare variable ndocto varchar(20);

declare variable cod_lote integer;
begin
  if (new.qtdade <> old.qtdade) then
  begin
    /*achando o registro logo a frente para ser atualizado*/
    select min(k.codigo) from est_kardex k
    where k.cnpj = new.cnpj and k.produto = new.produto and k.codigo > new.codigo
    into :prox_codigo;

    /*definindo o valor da qtde anterior*/
    if (new.tipo_es = 'S') then
      saldo = (new.qtdade_ant - new.qtdade);
    else
      saldo = (new.qtdade_ant + new.qtdade);

    /*atualizando o proximo registro*/
    update est_kardex k set k.qtdade_ant = :saldo
    where k.codigo = :prox_codigo;
  end

  /*mudando as qtdes anterios à frente*/
  if (new.qtdade_ant <> old.qtdade_ant) then
  begin
    /*achando o registro logo a frente para ser atualizado*/
    select min(k.codigo) from est_kardex k
    where k.cnpj = new.cnpj and k.produto = new.produto and k.codigo > new.codigo
    into :prox_codigo;

    /*definindo o valor da qtde anterior*/
    if (new.tipo_es = 'S') then
    begin
      saldo = (new.qtdade_ant - new.qtdade);
      qtde_lote = (-1 * new.qtdade);
    end
    else
    begin
      saldo = (new.qtdade_ant + new.qtdade);
      qtde_lote = (new.qtdade);
    end

     /*encontrando o código do faturamento */
      select k.ndocto from est_kardex k
      where k.codigo = new.codigo
      into :ndocto;

      /*Atualizando estoque Fiscal*/
      if (
            (new.origem = 'VDF') or (new.origem = 'VDF-C') or (new.origem = 'VDF-E')
            or (new.origem = 'ENTF') or (new.origem = 'ENTF-C') or (new.origem = 'ENTF-E')

         )then
      begin
        update est_produtos prd set prd.qtdade_1 = :saldo
        where prd.codigo = new.produto;
      end


      /*vem de faturamento, ou seja posso igualar a vdi sem erros  */
      if (substring(new.origem from 1 for 2) = 'VD') then
      begin
        /*Unica forma encontrada para solucinar o caso de se utilizar o msmo produto c/qtde iguais no mesmo faturamento
        conforme aconteceu na fert flora no reprocesso do produto 114, no entanto esta opcao funciona somente para 2 items no
        faturamento*/

        /*Sinal que existe um outro item exatamente igual no faturamento*/
        select count(*) from est_kardex k
        where k.cnpj = new.cnpj and k.ndocto = new.ndocto
        and k.produto = new.produto and k.qtdade = new.qtdade
        and k.codigo > new.codigo
        into :existe;

        if (:existe > 0) then
        begin
          select min(sequencia) from fat_vendas_itens vdi
          where vdi.cnpj = new.cnpj and vdi.codigo = :ndocto and vdi.produto = new.produto
          and vdi.quantidade = new.qtdade
          into :sequencia;

        end
        else
        begin
          select max(sequencia) from fat_vendas_itens vdi
          where vdi.cnpj = new.cnpj and vdi.codigo = :ndocto and vdi.produto = new.produto
          and vdi.quantidade = new.qtdade
          into :sequencia;
        end


        select vdi.codigo_lote from fat_vendas_itens vdi
        where vdi.cnpj = new.cnpj and vdi.codigo = :ndocto and vdi.produto = new.produto
        and vdi.quantidade = new.qtdade and vdi.sequencia = :sequencia
        into :cod_lote;

         /*Atualizando lote*/
        update est_lote_produto lt set lt.estoque =  lt.estoque +  :qtde_lote
        where lt.produto = new.produto and lt.codigo = :cod_lote;

      end
      else if (substring(new.origem from 1 for 2) = 'EN') then
      begin
        /*no caso das entradas, um unico item pode ter varios lotes vinculados*/
        for select eti.lote, eti.quantidade from est_entradas_itens_lotes eti
            where eti.cnpj = new.cnpj and eti.ndocto = :ndocto
            and eti.produto = new.produto
            into :cod_lote, :qtde_lote
        do
        begin
          /*Atualizando lote*/
          if (new.tipo_es = 'S') then
            qtde_lote = (-1 * :qtde_lote);
          else
            qtde_lote = (:qtde_lote);

          update est_lote_produto lt set lt.estoque =  lt.estoque +  :qtde_lote
          where lt.produto = new.produto and lt.codigo = :cod_lote;
        end

        /*select count(*) from est_entradas_itens_lotes eti
        where eti.cnpj = new.cnpj and eti.ndocto = :ndocto
        and eti.produto = new.produto
        into :cont;

        if (:cont > 1 ) then
          update est_produtos set complemento = new.produto||'-'||coalesce(:ndocto,'nulo')  where codigo = 130;*/
      end


    /*atualizando o proximo registro*/
    if (:prox_codigo is null) then
    begin
      update est_produtos prd set prd.qtdade_2 = :saldo
      where prd.codigo = new.produto;
    end
    else
    begin
      update est_kardex k set k.qtdade_ant = :saldo
      where k.codigo = :prox_codigo;
    end
  end
END
^

/* Trigger: EST_KARDEX_BI */
CREATE TRIGGER EST_KARDEX_BI FOR EST_KARDEX
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  new.dt_kardex = cast('today' as date);
  new.hr_kardex = cast('now' as time);

  /*salvando dados de produto no kardex*/
  select prd.prc_venda, prd.custo_aquisicao, prd.prc_custo_med from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.prd_prc_venda, new.prd_custo_aquisicao, new.vdi_custo_med;

  IF (NEW.CODIGO IS NULL) THEN
     NEW.CODIGO = GEN_ID(EST_KARDEX_GE, 1);
END
^

/* Trigger: EST_LOCALIZACAO_BI */
CREATE TRIGGER EST_LOCALIZACAO_BI FOR EST_LOCALIZACAO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_LOCALIZACAO_ID,1);
END
^

/* Trigger: EST_LOTE_BI */
CREATE TRIGGER EST_LOTE_BI FOR EST_LOTE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_LOTE_ID,1);
END
^

/* Trigger: EST_LOTE_SEMENTES_BI */
CREATE TRIGGER EST_LOTE_SEMENTES_BI FOR EST_LOTE_SEMENTES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_LOTE_SEMENTES_ID,1);
END
^

/* Trigger: EST_MARCAS_AU */
CREATE TRIGGER EST_MARCAS_AU FOR EST_MARCAS
ACTIVE AFTER UPDATE POSITION 0
AS
BEGIN
     UPDATE EST_PRODUTOS
     SET NOME_MARCA = NEW.NOME
     WHERE EST_PRODUTOS.CNPJ = NEW.CNPJ AND EST_PRODUTOS.MARCA = new.CODIGO ;
END
^

/* Trigger: EST_NATUREZA_BI0 */
CREATE TRIGGER EST_NATUREZA_BI0 FOR EST_NATUREZA
ACTIVE BEFORE INSERT POSITION 0
AS
begin
 /*Caso seja uma naturza de saida então movimentos com
  com esta natureza não poderão aparecer como devolução
  no resumo contábil(criado somente para evitar que o usuário
  marque os dois parametros e cause confusão nos totalizadores do
  fechamento)
  if (new.es = 'S') then
    new.devolucao = 'N'; */
  if (new.ttl_res_bonificacao is null) then
     new.ttl_res_bonificacao = 'N';

  if (new.ttl_res_diversos is null) then
     new.ttl_res_diversos = 'N';

  if (new.ativa is null) then
     new.ativa = 'N';

  if (new.altera_custo is null) then
      new.altera_custo = 'N';

  if (new.computa_venda is null) then
      new.computa_venda = 'N';

  if (new.consignacao is null) then
      new.consignacao = 'N';

  if (new.devolucao is null) then
      new.devolucao = 'N';

  if (new.entrega_futura is null) then
      new.entrega_futura = 'N';

  if (new.mov_caixa is null) then
      new.mov_caixa = 'N';

  if (new.mov_estoque is null) then
      new.mov_estoque = 'N';





  if (new.entrega_futura = 'S') then
  begin
    new.devolucao = 'N';
    new.remessa = 'N';
  end

  if (new.devolucao = 'S') then
  begin
    new.entrega_futura = 'N';
    new.remessa = 'N';
  end

  if (new.remessa = 'S') then
  begin
    new.entrega_futura = 'N';
    new.devolucao = 'N';
  end
END
^

/* Trigger: EST_NATUREZA_BU0 */
CREATE TRIGGER EST_NATUREZA_BU0 FOR EST_NATUREZA
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  if (new.ttl_res_bonificacao is null) then
     new.ttl_res_bonificacao = 'N';

  if (new.ttl_res_diversos is null) then
     new.ttl_res_diversos = 'N';

  if (new.ativa is null) then
     new.ativa = 'N';

  if (new.altera_custo is null) then
      new.altera_custo = 'N';

  if (new.computa_venda is null) then
      new.computa_venda = 'N';

  if (new.consignacao is null) then
      new.consignacao = 'N';

  if (new.devolucao is null) then
      new.devolucao = 'N';

  if (new.entrega_futura is null) then
      new.entrega_futura = 'N';

  if (new.mov_caixa is null) then
      new.mov_caixa = 'N';

  if (new.mov_estoque is null) then
      new.mov_estoque = 'N';


  /*Caso seja uma naturza de saida então movimentos com
  com esta natureza não poderão aparecer como devolução
  no resumo contábil(criado somente para evitar que o usuário
  marque os dois parametros e cause confusão nos totalizadores do
  fechamento)
  if (new.es = 'S') then
    new.ttl_res_devolucao = 'N'; */
END
^

/* Trigger: EST_PENEIRA_BI */
CREATE TRIGGER EST_PENEIRA_BI FOR EST_PENEIRA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_PENEIRA_ID,1);
END
^

/* Trigger: EST_PRODUTOS_AGREGADOS_BI */
CREATE TRIGGER EST_PRODUTOS_AGREGADOS_BI FOR EST_PRODUTOS_AGREGADOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_PRODUTOS_AGREGADOS_ID,1);
END
^

/* Trigger: EST_PRODUTOS_AI0 */
CREATE TRIGGER EST_PRODUTOS_AI0 FOR EST_PRODUTOS
ACTIVE AFTER INSERT POSITION 0
AS
declare variable CNPJ_DESTINO       VARCHAR(14);
declare variable PRODUTO       VARCHAR(15);
begin
  if (coalesce(new.sincroniza_filiais,'N') = 'S')  then
  begin
    for select e.cnpj from sis_empresas e
        where e.cnpj <> new.cnpj
        into :cnpj_destino
    do
    begin
      execute procedure pcd_exp_insere_produto(new.cnpj, :cnpj_destino,new.codigo);
    end
  end
end
^

/* Trigger: EST_PRODUTOS_AU0 */
CREATE TRIGGER EST_PRODUTOS_AU0 FOR EST_PRODUTOS
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable CNPJ_DESTINO VARCHAR(14);
declare variable PRODUTO VARCHAR(15);
begin
  if (coalesce(new.qtdade_2,0) > coalesce(old.qtdade_2,0)) then
     execute procedure PCD_CREDITA_PENDENCIA(new.cnpj, new.codigo,new.qtdade_2,old.qtdade_2);

  if ((coalesce(new.sincroniza_filiais,'N') = 'S') and (coalesce(old.sincroniza_filiais,'N') = 'N')) then
  begin
    for select e.cnpj from sis_empresas e
        where e.cnpj <> new.cnpj
        into :cnpj_destino
    do
    begin
      execute procedure pcd_exp_insere_produto(new.cnpj, :cnpj_destino,new.codigo);
    end
  end
     
END
^

/* Trigger: EST_PRODUTOS_BI */
CREATE TRIGGER EST_PRODUTOS_BI FOR EST_PRODUTOS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME_MARCA VARCHAR(50);
declare variable CST       NUMERIC(18,4);
declare variable V         VARCHAR(15);
declare variable G         VARCHAR(15);
declare variable EST_REPETE_COD_SEC       VARCHAR(15);
declare variable AUX       VARCHAR(15);
declare variable I         INTEGER;
declare variable LEN       INTEGER;
declare variable existe       INTEGER;
declare variable bch_codigo   INTEGER;
BEGIN
    if (new.bch_codigo is null) then
    begin
      select max(bch_codigo) from est_produtos prd
      where prd.cnpj = new.cnpj
      into :bch_codigo;
      
      new.bch_codigo = coalesce(:bch_codigo,0) + 1;
    end

    if (new.qntde_pdr_carga is null) then
      NEW.qntde_pdr_carga = 1;

    if (coalesce(new.serie,'') <> '') then
    begin
      select count(*) from est_produtos prd
      where prd.codigo <> new.codigo
      and prd.serie = new.serie and prd.cnpj = new.cnpj
      into :existe;

      if (:existe > 0) then
         exception valida_serie;
    end

    SELECT EST_REPETE_COD_SEC FROM SIS_CONFIGURACOES
    WHERE CNPJ = NEW.CNPJ INTO :EST_REPETE_COD_SEC ;

    IF ( EST_REPETE_COD_SEC IS NULL )
    THEN
        EST_REPETE_COD_SEC = 'S' ;

     IF ( EST_REPETE_COD_SEC = 'N' )
     THEN BEGIN
        SELECT count(*) FROM EST_PRODUTOS WHERE CNPJ = NEW.CNPJ AND
        CODIGO_2 = NEW.CODIGO_2 AND MARCA = NEW.marca
        into :existe;

        if (:existe > 0) then
            EXCEPTION CODIGO_SECUNDARIO_DUPLICADO;
     END

     if (new.qtdade_1  is null) then
         new.qtdade_1 = 0 ;

     if (new.qtdade_2  is null) then
         new.qtdade_2 = 0 ;

     if (new.aliquota_ecf is null) then
         new.aliquota_ecf = 'T1' ;
         
     select nome from est_marcas where cnpj = new.cnpj and codigo = new.marca
     into :nome_marca ;
         
     new.nome_marca = :nome_marca;
     
     
     /*PRECO DE CUSTO CODIFICADO */
     select * from round2(NEW.PRC_CUSTO_CODIF) into :cst;

     V   = CAST(CST AS VARCHAR(15));
        
     select * from getlength(:V) into :LEN;
        
     I = 1;
        
     G   = '' ;

     AUX = '' ;
        
     WHILE ( I <= 15 ) DO
     BEGIN
       select * from  sp_substring(:V, :I, 1) into :g;

          IF (G = '0')THEN
              AUX = AUX || 'O' ;
                 
          IF (G = '1')THEN
              AUX = AUX || 'A' ;

          IF (G = '2')THEN
              AUX = AUX || 'B' ;

          IF (G = '3')THEN
              AUX = AUX || 'C' ;

          IF (G = '4')THEN
              AUX = AUX || 'D' ;

          IF (G = '5')THEN
              AUX = AUX || 'E' ;
                 
          IF (G = '6')THEN
              AUX = AUX || 'F' ;

          IF (G = '7')THEN
              AUX = AUX || 'G' ;

          IF (G = '8')THEN
              AUX = AUX || 'H' ;

          IF (G = '9')THEN
              AUX = AUX || 'I' ;
                 
          IF (G = '.')THEN
              AUX = AUX || '.' ;

                 
          I = I + 1;
     END

     select * from getlength(:AUX) into :i;

     select * from sp_substring(:AUX,1,:I-2) into :aux;

     NEW.PRC_CUSTO_CODIF = AUX;
END
^

/* Trigger: EST_PRODUTOS_BU */
CREATE TRIGGER EST_PRODUTOS_BU FOR EST_PRODUTOS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable NOME_MARCA VARCHAR(50);
declare variable CST       NUMERIC(18,4);
declare variable V         VARCHAR(15);
declare variable G         VARCHAR(15);
declare variable AUX       VARCHAR(15);
declare variable EST_REPETE_COD_SEC       VARCHAR(15);
declare variable I         INTEGER;
declare variable LEN       INTEGER;
declare variable existe       INTEGER;
declare variable diferencia_fis_fisc char(1);
BEGIN
    select coalesce(cfg.DIFERENCIA_FIS_FISC,'N') from sis_configuracoes cfg
    inner join sis_empresas e on (e.cnpj = cfg.cnpj)
    where e.cnpj = new.cnpj
    into :diferencia_fis_fisc;

    if (:diferencia_fis_fisc = 'N') then
    begin
      if (new.qtdade_2 <> old.qtdade_2) then
        new.qtdade_1 = new.qtdade_2;
    end

    /*validando para que o produto nunca fique sem um grupo, pois influencia no relatorio
    de vendas de grupo por seleção*/
    if (new.grupo is null) then
    begin
      select min(gr.codigo) from est_grupos gr
      where gr.cnpj = new.cnpj
      into new.grupo;
    end

    if (coalesce(new.serie,'') <> '') then
    begin
      select count(*) from est_produtos prd
      where prd.codigo <> new.codigo
      and prd.serie = new.serie and prd.cnpj = new.cnpj
      into :existe;

      if (:existe > 0) then
         exception valida_serie;
    end

    SELECT EST_REPETE_COD_SEC FROM SIS_CONFIGURACOES
    WHERE CNPJ = NEW.CNPJ INTO :EST_REPETE_COD_SEC ;

    IF ( EST_REPETE_COD_SEC IS NULL )
    THEN
        EST_REPETE_COD_SEC = 'S' ;

    IF ( EST_REPETE_COD_SEC = 'N' )
    THEN BEGIN
        SELECT count(*) FROM EST_PRODUTOS WHERE CNPJ = NEW.CNPJ AND
        CODIGO_2 = NEW.CODIGO_2 and old.codigo_2 <> new.codigo_2
        AND MARCA = OLD.MARCA
        into :existe;

        if (:existe > 0) then
            EXCEPTION CODIGO_SECUNDARIO_DUPLICADO;
     END

     /* VERIFICA SE O PRODUTO FOI ATUALIZADO O PRECO */
     IF ( NEW.PRC_VENDA <> OLD.PRC_VENDA )
     THEN BEGIN
          NEW.ATUALIZAR = 'N' ;
     END

     IF (NEW.ALIQUOTA_ECF IS NULL)
     THEN
         NEW.ALIQUOTA_ECF = 'T1' ;
         
     SELECT NOME FROM EST_MARCAS WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MARCA
     INTO :NOME_MARCA ;
         
     NEW.NOME_MARCA = :NOME_MARCA;
     
     /*PRECO DE CUSTO CODIFICADO */
     select sai from round2(NEW.prc_repos) into :cst;

     V   = CAST(CST AS VARCHAR(15));
        
     select TAMANHO from getlength(:V) into :LEN;
        
     I = 1;
        
     G   = '' ;

     AUX = '' ;
        
     WHILE ( I <= 15 ) DO
     BEGIN
          select result from sp_substring(:V, :I, 1) into :g;


          IF (G = '0')
          THEN
              AUX = AUX || 'O' ;
                 
          IF (G = '1')
          THEN
              AUX = AUX || 'A' ;

          IF (G = '2')
          THEN
              AUX = AUX || 'B' ;

          IF (G = '3')
          THEN
              AUX = AUX || 'C' ;

          IF (G = '4')
          THEN
              AUX = AUX || 'D' ;

          IF (G = '5')
          THEN
              AUX = AUX || 'E' ;
                 
          IF (G = '6')
          THEN
              AUX = AUX || 'F' ;

          IF (G = '7')
          THEN
              AUX = AUX || 'G' ;

          IF (G = '8')
          THEN
              AUX = AUX || 'H' ;

          IF (G = '9')
          THEN
              AUX = AUX || 'I' ;
                 
          IF (G = '.')
          THEN
              AUX = AUX || '.' ;

                 
          I = I + 1;
     END
        
     select tamanho from getlength(:AUX) into :i;
        
     select result from sp_substring(:AUX,1,:I-2) into :aux;

     NEW.PRC_CUSTO_CODIF = :aux;


END
^

/* Trigger: EST_PRODUTOS_GRADES_AI0 */
CREATE TRIGGER EST_PRODUTOS_GRADES_AI0 FOR EST_PRODUTOS_GRADES
ACTIVE AFTER INSERT POSITION 0
AS
DECLARE VARIABLE INICIAL   INTEGER;
DECLARE VARIABLE FINAL     INTEGER;
DECLARE VARIABLE INTERVALO INTEGER;
DECLARE VARIABLE CODIGO    INTEGER;
DECLARE VARIABLE ORDEM     INTEGER;
DECLARE VARIABLE ORDEM_AUX INTEGER;
DECLARE VARIABLE GRADE     VARCHAR(6);
begin
     /* CRIANDO A NUMERACAO */
 
     SELECT INICIAL, FINAL, INTERVALO, CODIGO
     FROM EST_GRADES
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PERFIL
     INTO :INICIAL, :FINAL, :INTERVALO, :CODIGO ;
 
     IF ( INTERVALO IS NULL )
     THEN
         INTERVALO = 1;
 
     IF ( INICIAL < FINAL )
     THEN BEGIN
          WHILE ( :INICIAL <= :FINAL ) DO
          BEGIN
              IF ( NOT EXISTS
              (
              SELECT PRODUTO FROM EST_PRODUTOS_GRADES_NUMEROS
              WHERE CNPJ = NEW.CNPJ AND PRODUTO = NEW.produto AND
              GRADE = NEW.GRADE AND NUMERO = CAST(:INICIAL AS VARCHAR(6))
              ) )
              THEN BEGIN
                 INSERT INTO EST_PRODUTOS_GRADES_NUMEROS
                 ( CNPJ, PRODUTO, GRADE, NUMERO )
                 VALUES
                 ( NEW.CNPJ, NEW.PRODUTO, NEW.GRADE, CAST(:INICIAL AS VARCHAR(6)) );
              end
 
              INICIAL = :INICIAL + :INTERVALO;
          END
     END
 
     ORDEM_AUX = 1;
 
     /* BUSCANDO O INTERVALO P, M, G, GG XGG*/
     FOR SELECT CODIGO, ORDEM
     FROM EST_GRADES_ADICIONAL
     WHERE CNPJ = NEW.CNPJ AND GRADE = :CODIGO
     INTO :GRADE, :ORDEM
     DO BEGIN
        IF ( ORDEM IS NULL )
        THEN
            ORDEM = ORDEM_AUX ;
 
         IF ( NOT EXISTS
         (
          SELECT PRODUTO FROM EST_PRODUTOS_GRADES_NUMEROS
          WHERE CNPJ = NEW.CNPJ AND PRODUTO = NEW.produto AND
          GRADE = NEW.GRADE AND NUMERO = :GRADE
         ) )
         THEN BEGIN
              INSERT INTO EST_PRODUTOS_GRADES_NUMEROS
              ( CNPJ, PRODUTO, GRADE, NUMERO, ORDEM )
              VALUES
              ( NEW.CNPJ, NEW.PRODUTO, NEW.GRADE, :GRADE, :ORDEM );
         END
 
         ORDEM_AUX = ORDEM_AUX + 1;
     END
END
^

/* Trigger: EST_PRODUTOS_GRADES_AU0 */
CREATE TRIGGER EST_PRODUTOS_GRADES_AU0 FOR EST_PRODUTOS_GRADES
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable estoque numeric(18,4);
begin
  /*atualizando qtde-2 pois a qtde da grade foi atualizada*/
  if (new.estoque <> old.estoque) then
  begin
    select sum(gr.estoque) from est_produtos_grades gr
    where gr.cnpj = new.cnpj and gr.produto = new.produto
    into :estoque;

    update est_produtos prd set prd.qtdade_2 = :estoque
    where prd.cnpj = new.cnpj and prd.codigo = new.produto;
  end
END
^

/* Trigger: EST_PRODUTOS_GRADES_BI0 */
CREATE TRIGGER EST_PRODUTOS_GRADES_BI0 FOR EST_PRODUTOS_GRADES
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM EST_MATERIAL
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MATERIAL
     INTO :NOME ;

     NEW.NOME_MATERIAL = NOME ;

     SELECT NOME FROM EST_COR
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.COR
     INTO :NOME ;

     NEW.NOME_COR = NOME ;

     SELECT NOME FROM EST_GRADES
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PERFIL
     INTO :NOME ;

     NEW.NOME_PERFIL = NOME ;
END
^

/* Trigger: EST_PRODUTOS_GRADES_BU0 */
CREATE TRIGGER EST_PRODUTOS_GRADES_BU0 FOR EST_PRODUTOS_GRADES
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM EST_MATERIAL
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MATERIAL
     INTO :NOME ;

     NEW.NOME_MATERIAL = NOME ;

     SELECT NOME FROM EST_COR
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.COR
     INTO :NOME ;

     NEW.NOME_COR = NOME ;

     SELECT NOME FROM EST_GRADES
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PERFIL
     INTO :NOME ;

     NEW.NOME_PERFIL = NOME ;
END
^

/* Trigger: EST_PRODUTOS_GRADES_NUMEROS_AU0 */
CREATE TRIGGER EST_PRODUTOS_GRADES_NUMEROS_AU0 FOR EST_PRODUTOS_GRADES_NUMEROS
ACTIVE AFTER UPDATE POSITION 0
AS
DECLARE VARIABLE ESTOQUE NUMERIC(18,4);
begin
  /*se atualizar numero ele vai atualizar grade*/
  if (new.estoque <> old.estoque) then
  begin
    select sum(grn.estoque) from est_produtos_grades_numeros grn
    where grn.cnpj = new.cnpj and grn.produto = new.produto and grn.grade = new.grade
    into :estoque;

    update est_produtos_grades set estoque = :estoque
    where cnpj = new.cnpj and produto = new.produto and grade = new.grade;
  end
END
^

/* Trigger: EST_PRODUTOS_SIMILARES_BI */
CREATE TRIGGER EST_PRODUTOS_SIMILARES_BI FOR EST_PRODUTOS_SIMILARES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_PRODUTOS_SIMILARES_ID,1);
END
^

/* Trigger: EST_PROMOCAO_BI0 */
CREATE TRIGGER EST_PROMOCAO_BI0 FOR EST_PROMOCAO
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM EST_PRODUTOS
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PRODUTO
     INTO :NOME ;

     NEW.NOME = :NOME ;
END
^

/* Trigger: EST_SECAO_BI */
CREATE TRIGGER EST_SECAO_BI FOR EST_SECAO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_SECAO IS NULL) THEN
    NEW.COD_SECAO = GEN_ID(GEN_EST_SECAO_ID,1);
END
^

/* Trigger: EST_TIPO_GRAO_BI */
CREATE TRIGGER EST_TIPO_GRAO_BI FOR EST_TIPO_GRAO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EST_TIPO_GRAO_ID,1);
END
^

/* Trigger: EST_UNIDADES_BI */
CREATE TRIGGER EST_UNIDADES_BI FOR EST_UNIDADES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     if ((NEW.UNIDADES IS NULL)OR(NEW.UNIDADES =0))
     then
         NEW.UNIDADES = 1 ;
END
^

/* Trigger: EST_UNIDADES_BI1 */
CREATE TRIGGER EST_UNIDADES_BI1 FOR EST_UNIDADES
ACTIVE AFTER INSERT POSITION 1
AS
DECLARE VARIABLE A INTEGER;
BEGIN
     A = 1;
     INSERT INTO EST_SUBUNIDADES
     (CNPJ, SIGLA, UNIDADES)
     VALUES
     (NEW.CNPJ, NEW.SIGLA, 1);
END
^

/* Trigger: EXP_CTB_CF_PROSOFT_AI0 */
CREATE TRIGGER EXP_CTB_CF_PROSOFT_AI0 FOR EXP_CTB_CF_PROSOFT
ACTIVE AFTER INSERT POSITION 0
AS
begin
  insert into EXP_CTB_CF_PROSOFT_ALIQ(ALIQUOTA,
                                      VALOR,
                                      COD_EXP_CTB_CF_PROSOFT,
                                      CNPJ)
                               values('F',
                                      0,
                                      new.codigo,
                                      new.cnpj);


  insert into EXP_CTB_CF_PROSOFT_ALIQ(ALIQUOTA,
                                      VALOR,
                                      COD_EXP_CTB_CF_PROSOFT,
                                      CNPJ)
                               values('I',
                                      0,
                                      new.codigo,
                                      new.cnpj);

  insert into EXP_CTB_CF_PROSOFT_ALIQ(ALIQUOTA,
                                      VALOR,
                                      COD_EXP_CTB_CF_PROSOFT,
                                      CNPJ)
                               values('CANC',
                                      0,
                                      new.codigo,
                                      new.cnpj);

  insert into EXP_CTB_CF_PROSOFT_ALIQ(ALIQUOTA,
                                      VALOR,
                                      COD_EXP_CTB_CF_PROSOFT,
                                      CNPJ)
                               values('DESC',
                                      0,
                                      new.codigo,
                                      new.cnpj);

  insert into EXP_CTB_CF_PROSOFT_ALIQ(ALIQUOTA,
                                      VALOR,
                                      COD_EXP_CTB_CF_PROSOFT,
                                      CNPJ)
                               values('ISS',
                                      0,
                                      new.codigo,
                                      new.cnpj);
end
^

/* Trigger: EXP_CTB_CF_PROSOFT_ALIQ_BI */
CREATE TRIGGER EXP_CTB_CF_PROSOFT_ALIQ_BI FOR EXP_CTB_CF_PROSOFT_ALIQ
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EXP_CTB_CF_PROSOFT_ALIQ_ID,1);
END
^

/* Trigger: EXP_CTB_CF_PROSOFT_BI */
CREATE TRIGGER EXP_CTB_CF_PROSOFT_BI FOR EXP_CTB_CF_PROSOFT
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable data date;
declare variable ct_oo_ini integer;
declare variable ct_ttl_geral_ant integer;
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_EXP_CTB_CF_PROSOFT_ID,1);

 /*pegando a maior data ja lançada pra tabela*/
 select max(t.data_movimento) from EXP_CTB_CF_PROSOFT t
 where t.cnpj = new.cnpj and t.num_ser_ecf = new.num_ser_ecf and
 t.data_movimento < new.data_movimento
 into :data;

 select coalesce(t.ct_oo_fin,0), coalesce(t.tt_geral_fin,0)  from EXP_CTB_CF_PROSOFT t
 where t.cnpj = new.cnpj and t.num_ser_ecf = new.num_ser_ecf
 and t.data_movimento = :data
 into :ct_oo_ini, :ct_ttl_geral_ant;

 new.ct_oo_ant = coalesce(:ct_oo_ini,0);
 new.tt_geral_ini = coalesce(:ct_ttl_geral_ant,0);
END
^

/* Trigger: FAT_CAIXAS_BI0 */
CREATE TRIGGER FAT_CAIXAS_BI0 FOR FAT_CAIXAS
ACTIVE BEFORE INSERT POSITION 0
AS
declare  variable valor Numeric(18,4);
declare  variable contcx integer;
declare  variable validacx char(1);
declare  variable cx_comp_sld_ant char(1);
begin

  /*Verificando se será permitida a abertura de um novo caixa tendo um predecessor aberto*/
  select coalesce(emp.valida_abertura_cx,'N')  from sis_empresas emp where emp.cnpj = new.cnpj into :validacx;
  if (:validacx = 'S') then
  begin
    select count(*) from fat_caixas cx where cx.cnpj = new.cnpj
    and cx.usuario = new.usuario  and coalesce(cx.fechado,'N') = 'N' and cx.conta = new.conta
    into :contcx;
    if (:contcx > 0) then
      exception abrir_cx;

  end


  /*Verificando se computa saldo anterior no caixa*/
  select coalesce(cx_comp_sld_ant,'N') from sis_empresas
  where cnpj = new.cnpj
  into :cx_comp_sld_ant;

  if (:cx_comp_sld_ant = 'S') then
  begin
    select saldo from saldo_anterior_caixa(new.cnpj, new.usuario,new.conta, new.data, new.turno)
    into :valor;
  end
  else
    valor = 0;
  
  if (:valor is null) then
    valor = 0;

  new.saldo_anterior = :valor;

  if (new.fechado is null) then
     new.fechado = 'N';
END
^

/* Trigger: FAT_CAIXAS_BU0 */
CREATE TRIGGER FAT_CAIXAS_BU0 FOR FAT_CAIXAS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable saldo_ant numeric(18,4);
declare variable cx_comp_sld_ant char(1);
begin
  if ((new.fechado = 'S') and (old.fechado = 'N')) then
  begin
    /*Verificando se computa saldo anterior no caixa*/
    select coalesce(cx_comp_sld_ant,'N') from sis_empresas
    where cnpj = new.cnpj
    into :cx_comp_sld_ant;

    if (:cx_comp_sld_ant = 'S') then
    begin
      select coalesce(saldo,0) from saldo_anterior_caixa(new.cnpj, new.usuario,new.conta, new.data, new.turno)
      into :saldo_ant;
      new.saldo_anterior = :saldo_ant;
    end
  end

  /*tem uma locura na aplicação que atualizar o saldo anterior com zero..
  eu não sei exatamente a onde, e estou sem tempo para procurar
  por isso vou fazer este ajuste técnico*/
  if ((new.saldo_anterior = 0) and (old.saldo_anterior > 0)) then
    new.saldo_anterior = old.saldo_anterior;
END
^

/* Trigger: FAT_CAIXAS_MOVIMENTOS_AD0 */
CREATE TRIGGER FAT_CAIXAS_MOVIMENTOS_AD0 FOR FAT_CAIXAS_MOVIMENTOS
ACTIVE AFTER DELETE POSITION 0
AS
begin
  delete from ctb_movimento_contabil
  where cnpj = old.cnpj and planilha = old.planilha;
END
^

/* Trigger: FAT_CAIXAS_MOVIMENTOS_AI0 */
CREATE TRIGGER FAT_CAIXAS_MOVIMENTOS_AI0 FOR FAT_CAIXAS_MOVIMENTOS
ACTIVE AFTER INSERT POSITION 0
AS
declare variable tipo_cred char(1);
begin
  if (new.contra_partida is not null) then
  begin
    if (new.tipo = 'C') then
      tipo_cred = 'D';
    else
      tipo_cred = 'C';

    execute procedure insere_ctb_movimento_contabil(new.cnpj, new.data, :tipo_cred, new.documento, new.historico,
      new.valor, new.contra_partida, 'MOV-CAIXA',new.planilha, null, null, 'A', null, null);
  end
END
^

/* Trigger: FAT_CAIXAS_MOVIMENTOS_AU0 */
CREATE TRIGGER FAT_CAIXAS_MOVIMENTOS_AU0 FOR FAT_CAIXAS_MOVIMENTOS
ACTIVE AFTER UPDATE POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.CONTRA_PARTIDA IS NOT NULL )
     THEN BEGIN
          SELECT NOME FROM CTB_PLANOCONTA WHERE CNPJ = NEW.CNPJ AND
          CONTA = NEW.CONTRA_PARTIDA
          INTO :NOME;

/*          NEW.NOME_CONTRAPARTIDA = NOME; */

          /* ATUALIZANDO OS MOVIMENTOS BANCÁRIOS QDO ALTERA O MOVIMENTO */
          UPDATE ctb_movimento_contabil C
          SET C.DOCUMENTO = NEW.DOCUMENTO, C.historico = NEW.HISTORICO, C.valor = NEW.VALOR,
          C.TIPO = NEW.TIPO, C.contra_partida = :nome
          WHERE C.PLANILHA = NEW.PLANILHA AND C.CNPJ = NEW.CNPJ ;
     END
END
^

/* Trigger: FAT_CAIXAS_MOVIMENTOS_BI0 */
CREATE TRIGGER FAT_CAIXAS_MOVIMENTOS_BI0 FOR FAT_CAIXAS_MOVIMENTOS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.CONTRA_PARTIDA IS NOT NULL )
     THEN BEGIN
          SELECT NOME FROM CTB_PLANOCONTA WHERE CNPJ = NEW.CNPJ AND
          CONTA = NEW.CONTRA_PARTIDA
          INTO :NOME;

          NEW.NOME_CONTRAPARTIDA = NOME;

     END
     if (new.planilha is null) then
       select * from gerar_codigo('PLANILHA',1)
       into new.planilha;
END
^

/* Trigger: FAT_CAIXAS_RESUMO_BI0 */
CREATE TRIGGER FAT_CAIXAS_RESUMO_BI0 FOR FAT_CAIXAS_RESUMO
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM SIS_EMPRESAS
     WHERE CNPJ = NEW.CNPJ
     INTO :NOME ;

     NEW.NOME = :NOME ;
END
^

/* Trigger: FAT_CAIXAS_RESUMO_MOVTOS_AU0 */
CREATE TRIGGER FAT_CAIXAS_RESUMO_MOVTOS_AU0 FOR FAT_CAIXAS_RESUMO_MOVTOS
ACTIVE AFTER UPDATE POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.CONTRA_PARTIDA IS NOT NULL )
     THEN BEGIN
          SELECT NOME FROM CTB_PLANOCONTA WHERE CNPJ = NEW.CNPJ AND
          CONTA = NEW.CONTRA_PARTIDA
          INTO :NOME;
     END
END
^

/* Trigger: FAT_CAIXAS_RESUMO_MOVTOS_BI0 */
CREATE TRIGGER FAT_CAIXAS_RESUMO_MOVTOS_BI0 FOR FAT_CAIXAS_RESUMO_MOVTOS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.CONTRA_PARTIDA IS NOT NULL )
     THEN BEGIN
          SELECT NOME FROM CTB_PLANOCONTA WHERE CNPJ = NEW.CNPJ AND
          CONTA = NEW.CONTRA_PARTIDA
          INTO :NOME;

          NEW.NOME_CONTRAPARTIDA = NOME;
     END
END
^

/* Trigger: FAT_CAIXAS_RESUMO_MOVTOS_BU0 */
CREATE TRIGGER FAT_CAIXAS_RESUMO_MOVTOS_BU0 FOR FAT_CAIXAS_RESUMO_MOVTOS
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.CONTRA_PARTIDA IS NOT NULL )
     THEN BEGIN
          SELECT NOME FROM CTB_PLANOCONTA WHERE CNPJ = NEW.CNPJ AND
          CONTA = NEW.CONTRA_PARTIDA
          INTO :NOME;

          NEW.NOME_CONTRAPARTIDA = NOME;
     END
END
^

/* Trigger: FAT_ITEMTABELAPRECO_BI */
CREATE TRIGGER FAT_ITEMTABELAPRECO_BI FOR FAT_ITEMTABELAPRECO
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable existe integer;
BEGIN
  if (new.codigo is null) then
    new.codigo = gen_id(gen_fat_itemtabelapreco_id,1);

  select count(*) from fat_itemtabelapreco tbl
  where tbl.cnpj = new.cnpj and tbl.produto = new.produto
        and TBL.COD_TABELAPRECO = NEW.COD_TABELAPRECO
  and tbl.codigo <> new.codigo
  into :existe;

  if (:existe > 0) then
    exception VALIDA_PRD_REPETIDO;

  /*dados de preço do produto*/
  select coalesce(prd.prc_venda,0) from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.valor;

  new.valor = coalesce(new.valor,0)+(coalesce(new.valor,0)*coalesce(new.margemutilizado,0)/100.00);
END
^

/* Trigger: FAT_ITEMTABELAPRECO_BU0 */
CREATE TRIGGER FAT_ITEMTABELAPRECO_BU0 FOR FAT_ITEMTABELAPRECO
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  /*dados de preço do produto*/
  select coalesce(prd.prc_venda,0) from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.valor;

  new.valor = coalesce(new.valor,0)+(coalesce(new.valor,0)*coalesce(new.margemutilizado,0)/100.00);
end
^

/* Trigger: FAT_MICRO_TERMINAL_BI */
CREATE TRIGGER FAT_MICRO_TERMINAL_BI FOR FAT_MICRO_TERMINAL
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FAT_MICRO_TERMINAL_ID,1);
END
^

/* Trigger: FAT_MICRO_TERMINAL_BU0 */
CREATE TRIGGER FAT_MICRO_TERMINAL_BU0 FOR FAT_MICRO_TERMINAL
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable prc_unitario float;
declare variable qtde float;
begin
  /* Trigger text */

  if (new.produto is not null) then
  begin
    select coalesce(prd.prc_venda,0) from est_produtos prd
    where prd.cnpj = new.produto
    into :prc_unitario;

    new.data = current_date;
    new.preco_unitario = :prc_unitario;
    new.total = (coalesce(new.quantidade,0) * :prc_unitario);
  end
end
^

/* Trigger: FAT_ORCAMENTOS_BU0 */
CREATE TRIGGER FAT_ORCAMENTOS_BU0 FOR FAT_ORCAMENTOS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
begin
  if (new.comprometer_estoque <> old.comprometer_estoque) then
  begin
    select count(*) from fat_vendas vd
    where vd.orcamento = new.codigo and cnpj = new.cnpj
    into :existe;

    if (:existe > 0) then
      exception EST_COMPROMETIDO;
  end
END
^

/* Trigger: FAT_ORCAMENTOS_ITENS_BD0 */
CREATE TRIGGER FAT_ORCAMENTOS_ITENS_BD0 FOR FAT_ORCAMENTOS
ACTIVE BEFORE DELETE POSITION 0
AS
declare variable cont integer;
declare variable carregamento_parcial char(1);
begin
  /* Excluira a venda caso ela nao tenha mais items fabiano 20/09/2005*/
  select coalesce(e.carregamento_parcial,'N')  from sis_empresas e
  where e.cnpj = old.cnpj
  into :carregamento_parcial;

  /* verificando se o orçamento já gerou vendas*/
  if (:carregamento_parcial = 'S') then
  begin
    select count(*)  from fat_vendas vd
    where vd.cnpj = old.cnpj and vd.orcamento = old.codigo
    into :cont;
  end

  if (:cont > 0) then
    exception EXCLUI_ORCAMENTO;
END
^

/* Trigger: FAT_TABELAPRECO_BI */
CREATE TRIGGER FAT_TABELAPRECO_BI FOR FAT_TABELAPRECO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FAT_TABELAPRECO_ID,1);
END
^

/* Trigger: FAT_TBL_VD_TABELA_BI */
CREATE TRIGGER FAT_TBL_VD_TABELA_BI FOR FAT_TBL_VD_TABELA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FAT_TBL_VD_TABELA_ID,1);
END
^

/* Trigger: FAT_TBL_VENDEDOR_BI */
CREATE TRIGGER FAT_TBL_VENDEDOR_BI FOR FAT_TBL_VENDEDOR
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FAT_TBL_VENDEDOR_ID,1);
END
^

/* Trigger: FAT_TROCAS_AU0 */
CREATE TRIGGER FAT_TROCAS_AU0 FOR FAT_TROCAS
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable produto varchar(15);
declare variable origem varchar(6);
declare variable ndocto varchar(20);
declare variable ano integer;
declare variable mes integer;
declare variable quant_ant numeric(18,4);
declare variable quantidade numeric(18,4);
declare variable tipo_kdx char(1);
declare variable entsaid char(1);
declare variable preco_unt numeric(18,4);
declare variable desconto numeric(18,4);
declare variable unidade char(4);
declare variable grade char(4);
declare variable subunidade integer;
declare variable numero char(6);
declare variable data date;
declare variable cod_comissao integer;
declare variable cont integer;
begin

  /*Excluindo registros de comissões*/
  if ((coalesce(new.fechado,'N') = 'N') and (coalesce(old.fechado,'N') = 'S')) then
  begin
    /*troca estava fechada e voltou a estar aberta*/
    for select cm.codigo from cm_comissao cm
      where cm.cod_troca = new.codigo and cm.cnpj = new.cnpj
      into :cod_comissao
    do
    begin

      /*verificando se existe alguma comissão quitada */
      select count(*) from cm_comissao_parc cmp
      where cmp.cod_comissao = :cod_comissao and cmp.cnpj = new.cnpj and cmp.status = 'Q'
      into :cont;

      if (:cont > 0) then
        exception COMISSAO_QUITADA;

      /*deletando os parcelamentos de comissão*/
      delete from cm_comissao_parc cmp
      where cmp.cod_comissao = :cod_comissao and cmp.cnpj = new.cnpj ;

      /*excluindo o cabeçalho da comissão*/
      delete from cm_comissao cm
      where cm.codigo = :cod_comissao and cm.cnpj = new.cnpj ;
    end

   /* update fat_vendas_itens vdi set vdi.com_gerada = 'N'
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo;*/
  end




  /*se houve mudança no status da troca, ou ela foi cancelada*/
  if ((coalesce(new.fechado,'N') <> coalesce(old.fechado,'N')) or (coalesce(old.cancelada,'N') <> coalesce(new.cancelada,'N'))) then
  begin
    /*se a troca acabou de ser fechada*/
    if ((new.fechado = 'S') and (coalesce(old.fechado,'N')='N')) then
      origem = 'TRC';
    else if ((coalesce(new.fechado,'N')= 'N') and (coalesce(old.fechado,'N')='S')) then /*mudança de status, ms o contrario de fechamento(Estorno)*/
      origem = 'TRC-E';
    else
      origem = 'TRC-C'; /*Cancelada*/

    ano = extract (year from new.data);
    mes = extract (month from new.data);
    ndocto = cast(new.codigo as varchar(20));

    for select prd.codigo, coalesce(tri.quantidade,0),
        coalesce(prd.qtdade_2,0), coalesce(tri.prc_unitario,0),
        coalesce(tri.desconto,0), tri.unidade, tri.subunidade,
        tri.grade, tri.numero, tri.tipo
      from fat_trocas_itens tri
      inner join est_produtos prd on (prd.codigo = tri.produto and prd.cnpj = tri.cnpj)
      where tri.codigo = new.codigo and tri.cnpj = new.cnpj
      into :produto, :quantidade,
           :quant_ant, :preco_unt, :desconto, :unidade,
           :subunidade, :grade, :numero, :entsaid
    do
    begin
      /*Moviemnto normal de troca*/
      if (:origem = 'TRC') then
      begin
        if(entsaid = 'S') then
          tipo_kdx = 'S';
        else
          tipo_kdx = 'E';
     end
     else /*Moviemnto de estorno de troca*/
     begin
       if(entsaid = 'S') then
          tipo_kdx = 'E';
       else
          tipo_kdx = 'S';
     end

      /*atualizando kardex*/
      insert into est_kardex (cnpj, produto, ndocto,
                                dt_movto, mes, ano,
                                origem, tipo_es, pessoa_fj,
                                qtdade_ant, qtdade, prc_unit,
                                descontos)
      values                  (new.cnpj, :produto, :ndocto,
                                new.data, :mes, :ano,
                                :origem, :tipo_kdx, new.pessoa_fj,
                                :quant_ant, :quantidade, :preco_unt,
                                :desconto);

       /*estou invertendo o sinal, dependendo do tipo de movimento que
       teremos*/
       if ((:origem = 'TRC') and (:tipo_kdx = 'S')) then
         data = new.data;
       else   
         data = null;

       /*modificando o valor dependendo do tipo de movimento*/
       if (tipo_kdx = 'S') then
         quantidade = (:quantidade ) * -1;
       else
         quantidade = (:quantidade );

       update est_produtos prd set prd.qtdade_2 = coalesce(prd.qtdade_2,0) + :quantidade, dt_ult_venda = :data
       where prd.cnpj = new.cnpj and prd.codigo = :produto;
          

       IF ((grade <> '000') and (numero <> '000000')) then
       begin
          update est_produtos_grades
          set estoque = estoque + :quantidade
          where cnpj = new.cnpj and produto = :produto and grade = :grade ;


          update est_produtos_grades_numeros
          set estoque = estoque + :quantidade
          where cnpj = new.cnpj and produto = :produto and grade = :grade and
          numero = :numero;

          grade  = null ;
          numero = null ;
       end
    end
  end /*temos de acertar o estoque pois feito uma devolução ou um estorno da venda*/
END
^

/* Trigger: FAT_TROCAS_ITENS_BI0 */
CREATE TRIGGER FAT_TROCAS_ITENS_BI0 FOR FAT_TROCAS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  /*atribuindo preço de custo */
  select prd.prc_custo_med from est_produtos prd
  where prd.cnpj = new.cnpj and prd.codigo = new.produto
  into new.custo_medio;

   /*salvando o percentual de lucro no item, código copiado do procedure que gera comissão    */
  new.lucro_item =  ((new.quantidade * new.custo_medio * 100)/ (new.quantidade * new.prc_unitario));
  new.lucro_item = (100 - new.lucro_item);
END
^

/* Trigger: FAT_TROCAS_ITENS_BU0 */
CREATE TRIGGER FAT_TROCAS_ITENS_BU0 FOR FAT_TROCAS_ITENS
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
/*salvando o percentual de lucro no item, código copiado do procedure que gera comissão    */
     if (new.custo_medio is not null) then
     begin
       new.lucro_item =  ((new.quantidade * new.custo_medio * 100)/ (new.quantidade * new.prc_unitario));
       new.lucro_item = (100 - new.lucro_item);
     end
END
^

/* Trigger: FAT_USUARIOS_CAIXA_BI0 */
CREATE TRIGGER FAT_USUARIOS_CAIXA_BI0 FOR FAT_USUARIOS_CAIXA
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.turno = 1; /* Trigger text */
END
^

/* Trigger: FAT_VENDAS_AD0 */
CREATE TRIGGER FAT_VENDAS_AD0 FOR FAT_VENDAS
ACTIVE AFTER DELETE POSITION 0
AS
begin
  update ofc_ordem_servico ofc set ofc.venda = null
  where ofc.venda = old.codigo and ofc.cnpj = old.cnpj;
end
^

/* Trigger: FAT_VENDAS_AU0 */
CREATE TRIGGER FAT_VENDAS_AU0 FOR FAT_VENDAS
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable entsaid char(1);
declare variable movest char(1);
declare variable old_cancelada char(1);
declare variable new_cancelada char(1);
declare variable old_fechada char(1);
declare variable new_fechada char(1);
declare variable old_enviada char(1);
declare variable new_enviada char(1);
begin

  old_cancelada =   coalesce(old.cancelada, 'N');
  new_cancelada =   coalesce(new.cancelada, 'N');
  old_fechada   =   coalesce(old.fechada,   'N');
  new_fechada   =   coalesce(new.fechada,   'N');
  old_enviada   =   coalesce(old.enviada_cx,'N');
  new_enviada   =   coalesce(new.enviada_cx,'N');

  /*Dados sobre a Nat, Verifiando se movimenta estoque*/
  select nat.es, nat.mov_estoque from est_natureza nat
  where nat.cnpj = new.cnpj and nat.codigo = new.natureza
  into :entsaid, :movest ;

  /*executando o procedimento que seta o saldo do orçamento                 */
  execute procedure pcd_set_saldo_orcamento(new.cnpj,new.codigo,new.orcamento,old.fechada,new.fechada);

  /*executando o procedimento que gera o receiturário agronomico ou o exclui*/
  execute procedure pcd_executa_receituario(new.cnpj,new.codigo,NEW.enviada_cx,OLD.enviada_cx,NEW.cancelada,OLD.cancelada);

  /*executando o procedimento de verificação de remessa*/
  execute procedure pcd_executa_remessa(new.cnpj,new.id_agrupador,new.pessoa_fj,new.codigo,new.natureza, new.propriedade,
                                       old_enviada,new_enviada,
                                       old_cancelada,new_cancelada);

  /*executando o procedimento de verificação de devolução*/
  execute procedure pcd_executa_devolucao(new.cnpj,new.id_agrupador,new.pessoa_fj,new.vendedor, new.codigo,new.natureza,
                                         old_enviada,new_enviada,old_cancelada,new_cancelada);

  /*excluindo registros de comissões - Fert Flora
  execute procedure pcd_exclui_comissao(new.cnpj,new.codigo,
                                        old_fechada,new_fechada); */

  /*excluindo registros de comissões - America Agrosseds*/
  execute procedure pcd_exclui_comissao_2(new.cnpj,new.codigo,
                                        old_fechada,new_fechada);

  /*atualizando data da ultima venda*/
  execute procedure pcd_atualiza_ult_venda(new.cnpj,new.codigo, old_fechada,new_fechada,:entsaid,:movest,new.data);

 /*gerando kardex e atualizações de estoque.. grade etc.. */
  execute procedure pcd_gera_est_kardex(new.cnpj,new.pessoa_fj,new.codigo,old_enviada,new_enviada,
                                        old_cancelada,new_cancelada,:movest,:entsaid,new.data, new.num_nf, old.num_nf,new.local,old.local);
END
^

/* Trigger: FAT_VENDAS_BD0 */
CREATE TRIGGER FAT_VENDAS_BD0 FOR FAT_VENDAS
ACTIVE BEFORE DELETE POSITION 0
AS
DECLARE VARIABLE NUM INTEGER;
DECLARE VARIABLE AUX INTEGER;
begin
 /*    AUX = 0;

     /* VERIFICA SE TEM CONTAS A RECEBER OU RECEBIDA
     SELECT COUNT(CODIGO_VN) FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = OLD.CNPJ AND CODIGO_VN = OLD.CODIGO
     INTO :NUM ;

     IF ( NUM IS NULL )
     THEN
       NUM = 0;

     AUX = NUM ;

     SELECT COUNT(CODIGO_VN) FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = OLD.CNPJ AND CODIGO_VN = OLD.CODIGO
     INTO :NUM ;

     IF ( NUM IS NULL )
     THEN
       NUM = 0;

     AUX = AUX + NUM ;

     IF ( AUX > 0 ) THEN
       EXCEPTION VENDA_FATURADA ;

     if (coalesce(old.fechada,'N') = 'S' or coalesce(old.enviada_cx,'N') = 'S') then
       EXCEPTION VALIDA_VENDA_FATURADA ;*/
END
^

/* Trigger: FAT_VENDAS_BI */
CREATE TRIGGER FAT_VENDAS_BI FOR FAT_VENDAS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE H TIME;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE REMESSA CHAR(1);
DECLARE VARIABLE DEVOLUCAO CHAR(1);
DECLARE VARIABLE FAT_CAIXA CHAR(1);
BEGIN
     select count(*) from fat_usuarios_caixa u
     where u.cnpj = new.cnpj and u.usuario = new.usuario
     and u.ativo = 'S'
     into :existe;

     select coalesce(e.local_fatura,'N') from sis_empresas e where e.cnpj = new.cnpj
     into :fat_caixa;

     if ((coalesce(:existe,0) <= 0) and (new.usuario > 0) and (:fat_caixa = 'N')) then
       exception VALIDA_FAT_SEM_USER_VALIDO;

     select coalesce(cli.sub_tributario,'N') from glo_clientes cli
     where cli.cnpj = new.cnpj and cli.pessoa_fj = new.pessoa_fj
     into new.cli_sub_tributario;

     /*--------------------------Verificando relacionamento inter-vendas(remssa ou devolucao)---------------------------*/
     select nat.remessa, nat.devolucao from est_natureza nat
     where nat.cnpj = new.cnpj and nat.codigo = new.natureza
     into :remessa, :devolucao;

     if (((:remessa = 'S') or (:devolucao = 'S')) and (new.id_agrupador is null)) then
        exception NF_RELACAO;


     /*verificando se número NF esta duplicado
     if ((new.num_nf is not null) and (new.num_nf <> 0) and coalesce(new.nf_agrupada,'N') = 'N') then
     begin
      select count(*) from fat_vendas vd
      where vd.num_nf = NEW.NUM_NF and vd.codigo <> new.codigo and vd.cnpj = new.cnpj
      into :existe;
      if (:existe > 0) then
       exception NF_DUPLICADO;
     end */

     select psa.convenio from glo_pessoas_fj psa
     where psa.codigo = new.pessoa_fj and psa.cnpj = new.cnpj
     into new.conveniado;

     if (new.local is null) then
       new.local = 1;

     if (new.cons_rev is null) then
       new.cons_rev = 'C' ;


     select cast('now' as time)
     from rdb$database
     into :h;

     new.hora = :h;
END
^

/* Trigger: FAT_VENDAS_BU0 */
CREATE TRIGGER FAT_VENDAS_BU0 FOR FAT_VENDAS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
declare variable existe4 integer;
declare variable validalote integer;
declare variable reteminss char(1);
declare variable retemirrf char(1);
declare variable retempis char(1);
declare variable subtrib char(1);
declare variable tipo char(1);
declare variable pctDesconto numeric(18,4);
declare variable h time;
declare variable aux varchar(80);
DECLARE VARIABLE REMESSA CHAR(1);
DECLARE VARIABLE FAT_CAIXA CHAR(1);
declare variable devolucao char(1);
declare variable vista char(1);
declare variable gerafin char(1);
declare variable parcelamentos integer;
declare variable calc_issqn char(1);
declare variable ICMS FLOAT;
declare variable ICMS_SUB FLOAT;
declare variable BASE_ICMS FLOAT;
declare variable BASE_ICMS_SUB FLOAT;
declare variable DESC_REP FLOAT;
declare variable NOME_TEMP VARCHAR(50);
declare variable PCT_REDUCAO FLOAT;
declare variable TIPO_EMPRESA VARCHAR(30);
declare variable CLIENTE_UF VARCHAR(30);
declare variable tamanho integer;
declare variable DESCTO_SERVICO_AUX FLOAT;
declare variable VLR_ISENTO FLOAT;
declare variable VLR_CONTABIL FLOAT;
declare variable VLR_OUTROS FLOAT;
declare variable NUMERO_NFE VARCHAR(10);
begin
  if (coalesce(new.nfe_chave,'') <> '') then
  begin
    select num_nfe from pcd_extrai_num_nfe(new.nfe_chave)
    into :numero_nfe;
    new.nfe_numero = :numero_nfe;
  end

  existe = 0;
  select count(*) from fat_usuarios_caixa u
  where u.cnpj = new.cnpj and u.usuario = new.usuario
  and u.ativo = 'S'
  into :existe;

  select coalesce(e.local_fatura,'N') from sis_empresas e where e.cnpj = new.cnpj
  into :fat_caixa;

  if ((coalesce(:existe,0) <= 0) and (new.usuario > 0) and (:fat_caixa = 'N')) then
    exception VALIDA_FAT_SEM_USER_VALIDO;

  if (new.num_cupom > 0) then
    new.dt_emissao_cf = current_date;

  /*Calculando valor de Base de Calculo de ICMS, Outros ou Isentos - Sintegra RD*/
  /*calculando valor de isento*/
  if ((new.uf = 'MS') and (new.total > 0)) then
  begin
    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and vdi.cte = 3
    into :vlr_isento;
    new.sinteg_vlr_isento = coalesce(:vlr_isento,0);

    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and vdi.cte = 1
    into :vlr_contabil;
    new.sinteg_vlr_contabil = coalesce(:vlr_contabil,0);

    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and ((vdi.cte <> 1) and (vdi.cte <> 3))
    into :vlr_outros;
    new.sinteg_vlr_outros = coalesce(:vlr_outros,0);
  end
  else if ((new.total > 0)) then
  begin
    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and vdi.ctie = 3
    into :vlr_isento;
    new.sinteg_vlr_isento = coalesce(:vlr_isento,0);

    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and vdi.ctie = 1
    into :vlr_contabil;
    new.sinteg_vlr_contabil = coalesce(:vlr_contabil,0);

    select sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/new.total)* new.desc_acres)/100))
    from fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo and ((vdi.ctie <> 1) and (vdi.ctie <> 3))
    into :vlr_outros;
    new.sinteg_vlr_outros = coalesce(:vlr_outros,0);
  end

  /*calculo utilizado para se determinar o valor a ser liquido no caso de clientes que possuem retenção de ISS, ICMS ou IRRF*/
  select desconto from PCD_DESCONTOS_NF_SERVICO(new.cnpj,new.pessoa_fj,new.codigo)
  into :descto_servico_aux;

  new.DESCTO_SERVICO = coalesce(:descto_servico_aux,0);

  select * from GETLENGTH(cast(new.num_nf as varchar(5)))
  into :tamanho;

  if ((new.num_nf <> old.num_nf) and (new.num_nf > 0)) then
  begin
    existe = 0;
    select vd.codigo from fat_vendas vd
    where vd.cnpj = new.cnpj and vd.codigo <> new.codigo and vd.serie = new.serie
    and (vd.nfe_numero  = cast (new.num_nf as varchar(10)))
    into :existe;

   /* insert into tbl_teste  (teste)
    values (:existe); */
    if (coalesce(:existe,0) > 0) then
      exception EXP_NFE1;

    if ((coalesce(new.nfe_numero,'')<> '') and (new.num_nf > 0)) then
    begin
        /*if (new.num_nf <>  new.nfe_numero)  then
         exception EXP_NFE2;*/
    end
  end

if (new.nfe_numero  <> old.nfe_numero) then
  begin
     /*se houver numeracao de nf e ela for diferente da chave nfe */
     if ((new.num_nf > 0) and (new.num_nf <>  new.nfe_numero)) then
         exception EXP_NFE5;

     /*se a numeracao de nfe tiver zerada mas tivermos chave nfe*/
     if ((coalesce(new.num_nf,'') = '0') and (new.nfe_numero  <> '')) then
--         exception EXP_NFE6;

     existe = 0;
     select vd.codigo from fat_vendas vd
     where vd.cnpj = new.cnpj and (vd.nfe_numero = new.nfe_numero) and (vd.codigo <> new.codigo) and vd.serie = new.serie
     into :existe;


     if (coalesce(:existe,0) > 0) then
     begin

       insert into tbl_teste(teste)
       values (:existe);
       exception exp_nfe3;

     end
     existe = 0;
     select vd.codigo from fat_vendas vd
     where vd.cnpj = new.cnpj and (vd.num_nf = new.nfe_numero) and vd.codigo <> new.codigo and vd.serie = new.serie
     into :existe4;

     if (:existe4 > 0) then
     BEGIN
       exception exp_nfe4;
       insert into tbl_teste  (teste)
       values ((new.nfe_numero));
     END
  end


  /*Validacao implementada para solucionar de imediato a questao do beef beef (PDV)*/
  select e.TIPO_EMPRESA from sis_empresas e
  where e.cnpj = new.cnpj
  into :TIPO_EMPRESA;

  select coalesce(c.sub_tributario,'N'), psa.nome_razao from glo_clientes c
  inner join glo_pessoas_fj psa on (psa.cnpj = c.cnpj and c.pessoa_fj = psa.codigo)
  where c.cnpj = new.cnpj and c.pessoa_fj = new.pessoa_fj
  into new.cli_sub_tributario, :nome_temp;

  if (new.nome is null) then
    new.nome = :nome_temp;

  /*atualizando o icms do faturmento
  select sum(vdi.icm), sum(vdi.icm_subs), sum(vdi.basecalculoicm), sum(vdi.basecalculosubstituicao)
  from fat_vendas_itens vdi
  where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo
  into :icms, :icms_sub, :base_icms, :base_icms_sub;

  desc_rep = 0;
  if (new.total > 0 ) then
   desc_rep = (coalesce(new.desc_acres,0)/new.total);

  new.icm = :icms + (:icms * :desc_rep);
  new.valor_icm_subst = :icms_sub + (:icms_sub * :desc_rep);
  new.base_icm = :base_icms + (:base_icms * :desc_rep);
  new.base_icm_subst = :base_icms_sub + (:base_icms_sub * :desc_rep);

  /*Assumindo a configurão financeira do faturmento vinculado*/
     if (new.id_agrupador <> old.id_agrupador ) then
     begin
       select vd.idx_cotacao, vd.idx_database, vd.cod_indexador from
       fat_vendas vd where vd.cnpj = new.cnpj and vd.codigo = new.id_agrupador
       into new.idx_cotacao, new.idx_database, new.cod_indexador;

       if (new.idx_cotacao > 0) then
          new.idx_qtde = ((new.total + new.desc_acres)/new.idx_cotacao);
     end


     /*vou exigir que o financeiro esteja gerado*/
     if ((coalesce(new.fechada,'N') = 'S') and (coalesce(old.fechada,'N') = 'N')) then
     begin
       if ((new.usuario = 0) or (new.conta_caixa = 0)) then
          exception VALIDA_FAT_SEM_CAIXA;

       /*verificando se nat gera financeiro*/
       select coalesce(nat.gera_financeiro,'N'), nat.ES
       from est_natureza nat where nat.codigo = new.natureza and nat.cnpj = new.cnpj
       into :gerafin,:tipo;

       /*verificando se nat gera financeiro*/
       select coalesce(pg.avista,'N') from fin_formas_pagto pg
       where pg.cnpj = new.cnpj and pg.codigo = new.forma_pgto
       into :vista;

       if ((:gerafin = 'S') and (:vista = 'N') and (:tipo = 'S')) then
       begin
         select count(*) from fin_contas_receber rec
         where rec.cnpj = new.cnpj and rec.codigo_vn = new.codigo
         into :parcelamentos;

         if (:parcelamentos <= 0) then
           exception VALIDA_RECEBER2;
       end
     end
     /*validando para que vendas não venham a ser fechadas sem o devido parcelemento*/
     if (((coalesce(new.fechada,'N') = 'S') and (coalesce(old.fechada,'N') = 'N')) or ((coalesce(new.enviada_cx,'N') = 'S') and (coalesce(old.enviada_cx,'N') = 'N'))) then
     begin
       select coalesce(pg.avista,'N') from fin_formas_pagto pg
       where pg.cnpj = new.cnpj and pg.codigo = new.forma_pgto
       into :vista;

       if (:vista = 'N') then
       begin
         select count(*) from fat_vendas_parcelamento pc
         where pc.cnpj = new.cnpj and pc.codigo = new.codigo
         into :parcelamentos;

         if ((:parcelamentos <= 0) and (TIPO_EMPRESA <> 'SuperMercado')) then
          exception VALIDA_PARCELAMENTO;
       end
     end

     /*---------[ validando a relação pessoas->vendas-->orçamentos ]--------------------------------*/
     if (new.orcamento > 0) then
     begin
       existe = 0;
       select count(*) from fat_orcamentos oc
       where oc.cnpj = new.cnpj and oc.codigo = new.orcamento
       into :existe;
       if (coalesce(:existe,0) = 0) then
          exception valida_orcamento;
     end

     /*----------[ Se foi gerado NF então local de débito do estoque deverá ser fiscal ]----------------*/
     if( coalesce(new.num_nf,0) > 0 )then
        new.local = 1;


     /*---------------[ Verificando relacionamento inter-vendas ]-----------------------------------------*/
     select nat.remessa, nat.devolucao, nat.entrega_futura from est_natureza nat
     where nat.cnpj = new.cnpj and nat.codigo = new.natureza
     into :remessa, :devolucao, new.comprometer_estoque;

     if (((:remessa = 'S') or (:devolucao = 'S')) and (new.id_agrupador is null)) then
        exception NF_RELACAO;

     /*---------------[ Caso estiver fechado é pq já foi enviado para o caixa ]----------------------------*/
     if (new.fechada = 'S') then
       new.enviada_cx = 'S';

     /*------------[ Validando p/ q vendas não sejam fechadas com lotes ñ definidos p/prd q o utilizam ]--------*/
     if ((coalesce(new.enviada_cx,'N') = 'S') or (coalesce(new.fechada,'N') = 'S')) then
     begin
       select count(*) from fat_vendas_itens vdi
       inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
       where prd.possui_lote = 'S' and vdi.codigo_lote is null
       and vdi.codigo = new.codigo and vdi.cnpj = new.cnpj
       into :validalote;

       if (:validalote > 0) then
          exception VALIDA_LOTE;
     end


     if (new.hora is null) then
     begin
       select cast('now' as time)
       from rdb$database
       into :h ;

       new.hora = :h;
     end


     pctdesconto = 0;
     /*verificando se número NF esta duplicado*/
     if ((new.num_nf is not null) and (new.num_nf <> 0) and coalesce(new.nf_agrupada,'N') = 'N') then
     begin
      existe = 0;
      select count(*) from fat_vendas vd
      where vd.num_nf = NEW.NUM_NF and vd.codigo <> new.codigo
      and vd.serie = new.serie
      into :existe;

--      if (coalesce(:existe,0) > 0) then
--      exception NF_DUPLICADO;
     end

     select nat.calc_issqn from est_natureza nat where nat.cnpj = new.cnpj and nat.codigo = new.natureza
     into :calc_issqn;

     /*validando somente para serviço*/
     if (coalesce(:calc_issqn,'N') = 'S') then
     begin
       /*verificando e descontano impostos retidos do total da venda*/
       select coalesce(cli.ret_inss,'N'), coalesce(cli.ret_irrf,'N'),coalesce(cli.ret_pis,'N'), coalesce(cli.sub_tributario,'N')
       from glo_clientes cli where cli.pessoa_fj = new.pessoa_fj and cli.cnpj = new.cnpj
       into :reteminss, :retemirrf, :retempis, :subtrib;
     end



     if(:reteminss = 'S') then
       pctdesconto = pctdesconto + coalesce(new.inss,0);
    
     if(:retemirrf = 'S') then
       pctdesconto = pctdesconto + coalesce(new.irrf,0);
    
     if(:retempis = 'S')then
       pctdesconto = pctdesconto + coalesce(new.pis_cofins_csll,0);
    
     if(:subtrib = 'S') then
       pctdesconto = pctdesconto + coalesce(new.iss,0);
    
     new.media_km = coalesce(new.media_km,0) + 1;

     /*fechamento de venda ou estorno*/
--     if (((coalesce(new.iss,0) <> coalesce(old.iss,0)) or (coalesce(new.inss,0) <> coalesce(old.inss,0))) and (coalesce(new.fechada,'N') = 'S'))  then
     if ((old.fechada = 'N') and  (new.fechada= 'S')) then
       tipo = 'F';
     else if ((old.fechada = 'S') and  (new.fechada= 'N'))  then
       tipo = 'E';

     new.total_fiscal = (new.total + new.desc_acres) - (((new.total + new.desc_acres) * :pctdesconto)/100.00) + coalesce(new.ipi,0);
     new.total_nota = new.total_fiscal;

     /*o percentual tem de ser maior q 0 e o tipo estorno ou fechamento
     if ((:pctdesconto > 0) and ((tipo = 'F') or (tipo = 'E'))) then
     begin
         /*negativando o percentual para o fechamento
         if (:tipo = 'F') then
         begin
           update fin_contas_receber rec set rec.valor = (rec.valor - ((rec.valor * :pctdesconto)/100.00))
           where rec.codigo_vn = new.codigo and rec.pessoa_fj = new.pessoa_fj and rec.cnpj = new.cnpj;
           
           new.total_fiscal = new.total_fiscal - ((new.total_fiscal * :pctdesconto)/100.00);
           new.total_nota = new.total_nota - ((new.total_nota * :pctdesconto)/100.00);
           new.total = new.total - ((new.total * :pctdesconto)/100.00);
           new.historico = 'Vlr. Venda modificada: Vlr. Antigo: '||cast(old.total as varchar(12))||', Vlr. Atual: '||cast(new.total as varchar(15))||' Tipo:'||:tipo;
    
           /*o desconto tambem precisa ser modificado pois ele é dado em cima do valor bruto da nf,que é modificado
           new.desc_acres = new.desc_acres - ((new.desc_acres * :pctdesconto)/100.00);

           /*atualizando parcelamento
           update fat_vendas_parcelamento p set p.valor = (p.valor  - (:pctdesconto * p.valor)/100.00)
           where p.cnpj = new.cnpj and p.codigo = new.codigo;
    
           /*Vendas Itens
           update fat_vendas_itens vdi
           set vdi.prc_unitario = (vdi.prc_unitario  - (:pctdesconto * vdi.prc_unitario)/100.00)
           where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo;
         end
         else if (:tipo = 'E') then /*estorno
         begin
           update fin_contas_receber rec set rec.valor = ((rec.valor * 100)/(100.00 - :pctdesconto))
           where rec.codigo_vn = new.codigo and rec.pessoa_fj = new.pessoa_fj and rec.cnpj = new.cnpj;
    
           new.total_fiscal = ((new.total_fiscal * 100)/(100.00 - :pctdesconto));
           new.total_nota = ((new.total_nota * 100)/(100.00 - :pctdesconto));
           new.total = ((new.total * 100)/(100.00 - :pctdesconto));
           /*o desconto tambem precisa ser modificado pois ele é dado em cima do valor bruto da nf,que é modificado
           new.desc_acres = ((new.desc_acres * 100)/(100.00 - :pctdesconto));
           new.historico = '';
    
           /*atualizando parcelamento
           update fat_vendas_parcelamento p set p.valor = ((p.valor * 100)/(100.00 - :pctdesconto))
           where p.cnpj = new.cnpj and p.codigo = new.codigo;
    
           /*Vendas Itens
           update fat_vendas_itens vdi
           set vdi.prc_unitario = ((vdi.prc_unitario * 100)/(100.00 - :pctdesconto))
           where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo;
         end
     end*/

     if(new.cons_rev is null)then
       new.cons_rev = 'C' ;

     /*se for um estorno precisarei zerar os valores de impostos, pois é através deles que
     tomo como parametro para a impressao da NF de serviço*/

END
^

/* Trigger: FAT_VENDAS_ITENS_AI0 */
CREATE TRIGGER FAT_VENDAS_ITENS_AI0 FOR FAT_VENDAS_ITENS
ACTIVE AFTER INSERT POSITION 0
AS
declare variable pessoa_fj integer;
begin

  /*criando o percentual de comissão para o vendedor automaticamente
  select vdd.pessoa_fj from fat_vendas vd
  inner join fat_vendedor vdd on  (vdd.codigo = vd.vendedor and vdd.cnpj = vd.cnpj)
  where vd.cnpj = new.cnpj and vd.codigo = new.codigo
  into :pessoa_fj;

  insert into fat_vendas_itens_comissoes (CNPJ,
                                          COD_ITEM,
                                          PRODUTO     ,
                                          SEQUENCIA   ,
                                          PESSOA_FJ   ,
                                          PERCENTUAL)
                            values (new.CNPJ,
                                    new.CODIGO,
                                    new.PRODUTO     ,
                                    new.SEQUENCIA   ,
                                    :PESSOA_FJ   ,
                                    100); */
end
^

/* Trigger: FAT_VENDAS_ITENS_AU0 */
CREATE TRIGGER FAT_VENDAS_ITENS_AU0 FOR FAT_VENDAS_ITENS
ACTIVE AFTER UPDATE POSITION 0
AS
begin
 /* if ((old.custo_medio <> new.custo_medio) or (new.vlr_lucro_item <> old.vlr_lucro_item)) then
    execute procedure pcd_cm2_atualiza_comissao(new.cnpj,new.codigo,null,null,null);  */
end
^

/* Trigger: FAT_VENDAS_ITENS_BD0 */
CREATE TRIGGER FAT_VENDAS_ITENS_BD0 FOR FAT_VENDAS_ITENS
ACTIVE AFTER DELETE POSITION 0
AS
declare variable cont integer;
declare variable tipo_venda char(3);
begin
  /* Excluira a venda caso ela nao tenha mais items fabiano 20/09/2005*/
   select count(*) from fat_vendas_itens vd where vd.cnpj = old.cnpj and vd.codigo = old.codigo
   into :cont;

   select vd2.tipo_venda from fat_vendas vd2 where vd2.cnpj = old.cnpj and vd2.codigo = old.codigo
   into :tipo_venda;

   if ((cont = 0) and (:tipo_venda = 'Con')) then
    delete from fat_vendas vd2 where vd2.cnpj = old.cnpj and vd2.codigo = old.codigo;
END
^

/* Trigger: FAT_VENDAS_ITENS_BD01 */
CREATE TRIGGER FAT_VENDAS_ITENS_BD01 FOR FAT_VENDAS_ITENS
ACTIVE BEFORE DELETE POSITION 0
AS
begin
  delete from fat_vendas_itens_comissoes cmi
  where cmi.cod_item = old.codigo and cmi.produto = old.produto
  and cmi.sequencia = old.sequencia and cmi.cnpj = old.cnpj;
end
^

/* Trigger: FAT_VENDAS_ITENS_BI */
CREATE TRIGGER FAT_VENDAS_ITENS_BI FOR FAT_VENDAS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE AGRUPADOR    VARCHAR(15);
DECLARE VARIABLE AGRUPADORFIS VARCHAR(15);
DECLARE VARIABLE MSG_REDUCAO VARCHAR(80);
DECLARE VARIABLE MSG_REDUCAO_IE VARCHAR(80);
DECLARE VARIABLE SEQ INTEGER;
DECLARE VARIABLE CT INTEGER;
DECLARE VARIABLE BASECALCULOICM NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE ICMSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE PERC_ESTADUAL NUMERIC(18,4);
DECLARE VARIABLE PERC_INTERESTADUAL NUMERIC(18,4);
DECLARE VARIABLE REDUCAO NUMERIC(18,4);
DECLARE VARIABLE UF_VENDA CHAR(2);
DECLARE VARIABLE UF_EMPRESA CHAR(2);
DECLARE VARIABLE DIFERENCIA_FIS_FISC CHAR(1);
DECLARE VARIABLE CONS_REV CHAR(1);
DECLARE VARIABLE VALOR1 NUMERIC(18,4);
DECLARE VARIABLE VALOR2 NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE TOTALFISCAL NUMERIC(18,4);
DECLARE VARIABLE TOTALFORCALC NUMERIC(18,4);
DECLARE VARIABLE TOTAL_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE ALIQUOTA NUMERIC(18,4);
DECLARE VARIABLE ICM_PRESUMIDO_SEM_IPI NUMERIC(18,4);
DECLARE VARIABLE DESP_OPERACIONAL NUMERIC(18,4);
DECLARE VARIABLE ENTREGA_FUTURA CHAR(1);
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE ID_AGRUPADOR INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
BEGIN
    SELECT MAX(VDI.SEQUENCIA) FROM fat_vendas_itens vdi
    where vdi.cnpj = new.cnpj and vdi.codigo = new.codigo
    into :sequencia;

    new.sequencia = coalesce(:sequencia,0) + 1;

    select cfg.despesas_operacionais from sis_configuracoes cfg
    where cfg.cnpj = new.cnpj
    into :desp_operacional;

    desp_operacional = coalesce(:desp_operacional,0);

    /*atribuindo preço de custo */
    select prd.prc_custo_med, prd.trib_aliq_est, prd.trib_aliq_int, prd.nome, prd.cte, prd.ctie from est_produtos prd
    where prd.cnpj = new.cnpj and prd.codigo = new.produto
    into new.custo_medio, new.aliquota_est, new.aliquota_int, new.nome_produto, new.cte, new.ctie;

    if (new.sproduto is null) then
      new.sproduto = new.produto;

    if (coalesce(new.quantidade_fis,0) <= 0) then
      new.quantidade_fis = new.quantidade;

    if (coalesce(new.prc_unitario_fis,0) <= 0) then
       new.prc_unitario_fis = new.prc_unitario;

    if (new.aliquota_est is null) then
    begin
      select nat.perc_icms from est_natureza nat
      inner join fat_vendas vd on (vd.cnpj = nat.cnpj and vd.natureza = nat.codigo)
      where nat.cnpj = new.cnpj  and vd.codigo = new.codigo
      into new.aliquota_est;
    end

     if (new.aliquota_int is null) then
     begin
        select nat.perc_icms from est_natureza nat
        inner join fat_vendas vd on (vd.cnpj = nat.cnpj and vd.natureza = nat.codigo)
        where nat.cnpj = new.cnpj  and vd.codigo = new.codigo
        into new.aliquota_int;
     end

    /*salvando o percentual de lucro no item, código copiado do procedure que gera comissão    */
    total_unitario = coalesce(new.quantidade,0) * coalesce(new.prc_unitario,0);
    if (total_unitario > 0) then
    begin
       new.lucro_item =  ((new.quantidade * (new.custo_medio + ((new.custo_medio * :desp_operacional)/100)) * 100)/ total_unitario);
       new.lucro_item = (100 - new.lucro_item);
    end
    else
      new.lucro_item = 0;

    select vd.natureza, vd.uf, vd.cons_rev, VD.id_agrupador from fat_vendas vd
    where vd.cnpj = new.cnpj and vd.codigo = new.codigo
    into :cfop, :uf_venda, :CONS_REV, :id_agrupador;

    /*-----------------------------------Carregamento------------------------------------------------------*/
    select coalesce(nat.entrega_futura,'N') from est_natureza nat where nat.cnpj  = new.cnpj and nat.codigo = :cfop
    into :entrega_futura;

    if (:entrega_futura <> 'S') then
      new.qtde_entregue = new.quantidade;

    /*--------------verificando se vinculo entre vendas (remessa e devolução não possui inconsistencias)--------------*/
    execute procedure PCD_VERIFICA_VENDA_VINCULADA(new.cnpj,:id_agrupador,:cfop,NEW.produto,NEW.quantidade);

    /*--------------------------------Cauculando Impostos--------------------------------------------------*/
    basecalculoicm = 0;
    basecalculosubstituicao = 0;
    icmsubstituicao = 0;

    select emp.uf, emp.icm_presumido_sem_ipi from sis_empresas emp where emp.cnpj = new.cnpj
    into :uf_empresa, :icm_presumido_sem_ipi;

    select coalesce(cf.diferencia_fis_fisc,'N') from sis_configuracoes cf where cf.cnpj = new.cnpj
    into :diferencia_fis_fisc;

    /*redução do produto*/
    select coalesce(r.perc_estadual,0), coalesce(r.perc_interestadual,0), r.mensagem_nf, r.mensagem_nf_ie
    from est_reducoes r
    where r.cnpj = new.cnpj and r.codigo = new.reducao
    into :perc_estadual, :perc_interestadual, :msg_reducao, :msg_reducao_ie;

    /*definindo de onde será a redução*/
    if (upper(:uf_empresa) = upper(:uf_venda)) then
    begin
      new.aliquota_icms = coalesce(new.aliquota_est,0);
      ct = new.cte;

      if (new.cte = 2) then
      begin
        reducao = :perc_estadual;
        new.mensagem_reducao = :msg_reducao;
      end
    end
    else
    begin
      new.aliquota_icms = coalesce(new.aliquota_int,0);
      ct = new.ctie;
      if (new.ctie = 2) then
      begin
        reducao = :perc_interestadual;
        new.mensagem_reducao = :msg_reducao_ie;
      end
    end

    if (coalesce(diferencia_fis_fisc,'N') = 'N') then
    begin
      total = (coalesce(new.quantidade,0) * coalesce(new.prc_unitario,0));
      totalforcalc = :total;
    end
    else
    begin
      totalfiscal = (coalesce(new.quantidade_fis,0) * coalesce(new.prc_unitario_fis,0));
      totalforcalc = totalfiscal;
    end

     /* Integral */
    if((ct = 1 ) or (ct = 6 )) then
       basecalculoicm = :totalforcalc;

    /*base de calculo reduzida*/
    if ((ct = 2) or (ct = 2)) then
      basecalculoicm = :totalforcalc - ((:totalforcalc * :reducao)/100.00);
--      basecalculoicm = (:totalforcalc * :reducao)/new.aliquota_icms;

    /*isento
    if (ct = 3) then
    begin
      /*nao modifica nada
    end   */

    /*substituicao*/
    if (ct = 6) then
    begin
       new.basecalculosubstituicao = :totalforcalc;
       new.icm_subs =  ((new.basecalculosubstituicao * new.aliquota_icms)/100.00);
     end
     else /*não substituto*/
     begin
        new.basecalculoicm = :basecalculoicm;
       new.icm = ((new.basecalculoicm * new.aliquota_icms)/100.00);
     end

    if (new.vendedor is null) then
    begin
       select vd.vendedor from fat_vendas vd
       where vd.cnpj = new.cnpj and vd.codigo = new.codigo
       into new.vendedor;
    end

     /*marcando que o produto deve possuir lote*/
     select prd.possui_lote from est_produtos prd
     where prd.cnpj = new.cnpj and prd.codigo = new.produto
     into new.utiliza_lote;


     /*setando o nome do lote*/
     select lote from est_lote_produto where cnpj = new.cnpj and produto = new.produto and codigo = new.codigo_lote
     into new.lote;


     /*Adicionando o valor de preço unitário original nos itens
     em qualquer circunstancias*/
     if (coalesce(new.prc_unit_original,0) = 0) then
     begin
       select prd.prc_venda from est_produtos prd where
       prd.cnpj = new.cnpj and prd.codigo = new.produto
       into new.prc_unit_original;
     end

     IF (NEW.CFOP IS NULL)THEN
     BEGIN
       SELECT NATUREZA
       FROM FAT_VENDAS
       WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.CODIGO
       INTO NEW.CFOP ;
     END

     if (new.produto <> new.produtofis)
     then begin
          /* verifica quem é o agruapador do fiscal*/
          select cod_agrup from est_produtos
          where cnpj = new.cnpj and codigo = new.produtofis
          into :agrupadorfis ;
     
          /* verifica quem é o agrupador*/
          select cod_agrup from est_produtos
          where cnpj = new.cnpj and codigo = new.produto
          into :agrupador ;

          if ((agrupador <> agrupadorfis ) or (agrupadorfis is null) or (agrupador is null))
          then begin
               exception agrupadorfiscal ;
          end
     end
END
^

/* Trigger: FAT_VENDAS_ITENS_BU0 */
CREATE TRIGGER FAT_VENDAS_ITENS_BU0 FOR FAT_VENDAS_ITENS
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE AGRUPADOR    VARCHAR(15);
DECLARE VARIABLE AGRUPADORFIS VARCHAR(15);
DECLARE VARIABLE MSG_REDUCAO VARCHAR(80);
DECLARE VARIABLE MSG_REDUCAO_IE VARCHAR(80);
DECLARE VARIABLE SEQ INTEGER;
DECLARE VARIABLE CT INTEGER;
DECLARE VARIABLE BASECALCULOICM NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE ICMSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE PERC_ESTADUAL NUMERIC(18,4);
DECLARE VARIABLE PERC_INTERESTADUAL NUMERIC(18,4);
DECLARE VARIABLE REDUCAO NUMERIC(18,4);
DECLARE VARIABLE UF_VENDA CHAR(2);
DECLARE VARIABLE UF_EMPRESA CHAR(2);
DECLARE VARIABLE DIFERENCIA_FIS_FISC CHAR(1);
DECLARE VARIABLE CONS_REV CHAR(1);
DECLARE VARIABLE VALOR1 NUMERIC(18,4);
DECLARE VARIABLE VALOR2 NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE TOTALFISCAL NUMERIC(18,4);
DECLARE VARIABLE TOTALFORCALC NUMERIC(18,4);
DECLARE VARIABLE ALIQUOTA NUMERIC(18,4);
DECLARE VARIABLE TOTAL_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE ICM_PRESUMIDO_SEM_IPI NUMERIC(18,4);
DECLARE VARIABLE ENTREGA_FUTURA CHAR(1);
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE ID_AGRUPADOR INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE DESP_OPER NUMERIC(18,4);
DECLARE VARIABLE VLR_DESP_OPER NUMERIC(18,4);
DECLARE VARIABLE NEW_CUSTO_MEDIO NUMERIC(18,4);
begin
     /*################### Tributação do produto (Identico ao código que havia na aplicacao)###########################*/
     /*atribuindo preço de custo */
     select prd.prc_custo_med, prd.trib_aliq_est, prd.trib_aliq_int from est_produtos prd
     where prd.cnpj = new.cnpj and prd.codigo = new.produto
     into new_custo_medio, new.aliquota_est, new.aliquota_int;

     /*salvando o valor de lucro do item - América Agorsseds*/
       select cfg.despesas_operacionais from sis_configuracoes cfg
       where cnpj = new.cnpj
       into :desp_oper;

     if (coalesce(new.custo_medio,0) = 0) then
       new.custo_medio = :new_custo_medio;

     if (new.aliquota_est is null) then
     begin
        select nat.perc_icms from est_natureza nat
        inner join fat_vendas vd on (vd.cnpj = nat.cnpj and vd.natureza = nat.codigo)
        where nat.cnpj = new.cnpj  and vd.codigo = new.codigo
        into new.aliquota_est;
     end

     if (new.aliquota_int is null) then
     begin
        select nat.perc_icms from est_natureza nat
        inner join fat_vendas vd on (vd.cnpj = nat.cnpj and vd.natureza = nat.codigo)
        where nat.cnpj = new.cnpj  and vd.codigo = new.codigo
        into new.aliquota_int;
     end


     /*salvando o percentual de lucro no item, código copiado do procedure que gera comissão    */
     total_unitario = coalesce(new.quantidade,0) * coalesce(new.prc_unitario,0);
     if (total_unitario > 0) then
     begin
       new.lucro_item =  ((new.quantidade * (new.custo_medio + ((new.custo_medio * :desp_oper)/100)) * 100)/ total_unitario);
      /* new.lucro_item =  ((new.quantidade * new.custo_medio * 100)/ total_unitario);*/
       new.lucro_item = (100 - new.lucro_item);


       vlr_desp_oper = ((:desp_oper * coalesce(new.custo_medio,0) )/100.00);

       new.vlr_lucro_item = ((new.prc_unitario - (coalesce(:vlr_desp_oper,0) + coalesce(new.custo_medio,0))) * new.quantidade);
     end
     else
       new.lucro_item = 0;

     select vd.natureza, vd.uf, vd.cons_rev, VD.id_agrupador from fat_vendas vd where vd.cnpj = new.cnpj and vd.codigo = new.codigo
     into :cfop, :uf_venda, :CONS_REV, :id_agrupador;

     /*-----------------------------------Carregamento------------------------------------------------------*/
     select coalesce(nat.entrega_futura,'N') from est_natureza nat where nat.cnpj  = new.cnpj and nat.codigo = :cfop
     into :entrega_futura;

     if (:entrega_futura <> 'S') then
      new.qtde_entregue = new.quantidade;

     /*--------------verificando se vinculo entre vendas (remessa e devolução não possui inconsistencias)--------------*/
     execute procedure PCD_VERIFICA_VENDA_VINCULADA(new.cnpj,:id_agrupador,:cfop,NEW.produto,NEW.quantidade);

     /*--------------------------------Cauculando Impostos--------------------------------------------------*/
     basecalculoicm = 0;
     basecalculosubstituicao = 0;
     icmsubstituicao = 0;

     select emp.uf, emp.icm_presumido_sem_ipi from sis_empresas emp where emp.cnpj = new.cnpj
     into :uf_empresa, :icm_presumido_sem_ipi;

     select coalesce(cf.diferencia_fis_fisc,'N') from sis_configuracoes cf where cf.cnpj = new.cnpj
     into :diferencia_fis_fisc;


     /*redução do produto*/
     select coalesce(r.perc_estadual,0), coalesce(r.perc_interestadual,0), r.mensagem_nf, r.mensagem_nf_ie
     from est_reducoes r
     where r.cnpj = new.cnpj and r.codigo = new.reducao
     into :perc_estadual, :perc_interestadual, :msg_reducao, :msg_reducao_ie;


     /*definindo de onde será a redução*/
     new.mensagem_reducao = '';
     if ((upper(:uf_empresa) = upper(:uf_venda)) ) then
     begin
       new.aliquota_icms = coalesce(new.aliquota_est,0);
       ct = new.cte;
       if (new.cte = 2) then
       begin
         reducao = :perc_estadual;
         new.mensagem_reducao = :msg_reducao;
         new.mensagem_reducao = 'TESTE MENSAGEM';
       end

     end
     else if ((upper(:uf_empresa) <> upper(:uf_venda)) ) then
     begin
       new.aliquota_icms = coalesce(new.aliquota_int,0);
       ct = new.ctie;
       if (new.ctie = 2) then
       begin
         reducao = :perc_interestadual;
         new.mensagem_reducao = :msg_reducao_ie;
       end
     end


     if (diferencia_fis_fisc = 'N') then
     begin
       total = (coalesce(new.quantidade,0) * coalesce(new.prc_unitario,0));
       totalforcalc = :total;
     end
     else
     begin
       totalfiscal = (coalesce(new.quantidade_fis,0) * coalesce(new.prc_unitario_fis,0));
       totalforcalc = totalfiscal;
     end

     /* Integral */
     if((ct = 1 ) or (ct = 6 )) then
        basecalculoicm = :totalforcalc;

     /*base de calculo reduzida*/
   if ((ct = 2) or (ct = 2)) then
      basecalculoicm = :totalforcalc - ((:totalforcalc * :reducao)/100.00);
--       basecalculoicm = (:totalforcalc * :reducao)/new.aliquota_icms;

    /*isento
    if (ct = 3) then
    begin
      /*nao modifica nada
    end   */

     /*substituicao*/
     if (ct = 6) then
     begin
       new.basecalculosubstituicao = :totalforcalc;
       new.icm_subs =  ((new.basecalculosubstituicao * new.aliquota_icms)/100.00);
     end
     else /*não substituto*/
     begin
       new.icm = ((new.basecalculoicm * new.aliquota_icms)/100.00);
       new.basecalculoicm = :basecalculoicm;
     end

     if (new.vendedor is null) then
     begin
       select vd.vendedor from fat_vendas vd
       where vd.cnpj = new.cnpj and vd.codigo = new.codigo
       into new.vendedor;
     end

     /*marcando que o produto deve possuir lote*/
     select prd.possui_lote from est_produtos prd
     where prd.cnpj = new.cnpj and prd.codigo = new.produto
     into new.utiliza_lote;


     /*setando o nome do lote*/
     select lote from est_lote_produto where cnpj = new.cnpj and produto = new.produto and codigo = new.codigo_lote
     into new.lote;


     /*Adicionando o valor de preço unitário original nos itens
     em qualquer circunstancias*/
     if (coalesce(new.prc_unit_original,0) = 0) then
     begin
       select prd.prc_venda from est_produtos prd where
       prd.cnpj = new.cnpj and prd.codigo = new.produto
       into new.prc_unit_original;
     end

     if (new.cfop is null)then
     begin
       select natureza
       from fat_vendas
       where cnpj = new.cnpj and codigo = new.codigo
       into new.cfop ;
     end

     if (new.produto <> new.produtofis) then
     begin
          /* verifica quem é o agruapador do fiscal*/
          select cod_agrup from est_produtos
          where cnpj = new.cnpj and codigo = new.produtofis
          into :agrupadorfis ;
     
          /* verifica quem é o agrupador*/
          select cod_agrup from est_produtos
          where cnpj = new.cnpj and codigo = new.produto
          into :agrupador ;

          if ((agrupador <> agrupadorfis ) or (agrupadorfis is null) or (agrupador is null))
          then begin
               exception agrupadorfiscal ;
          end
     end

     /*salvando o complemento do produto automaticamente mesmo que este não tenha sido definido no item da venda*/
     if (new.complemento is null) then
     begin
       select prd.complemento from est_produtos prd
       where prd.cnpj = new.cnpj and prd.codigo = new.produto
       into new.complemento;
     end

     /*-----------------------------------Carregamento------------------------------------------------------*/
      select vd.natureza from fat_vendas vd where vd.cnpj = new.cnpj and vd.codigo = new.codigo
      into :cfop;

      select coalesce(nat.entrega_futura,'N') from est_natureza nat where nat.cnpj  = new.cnpj and nat.codigo = :cfop
      into :entrega_futura;

     if (:entrega_futura <> 'S') then
       new.qtde_entregue = new.quantidade;

     if (coalesce(new.prc_unit_original,0) = 0) then
     begin
       select prd.prc_venda from est_produtos prd where
       prd.cnpj = new.cnpj and prd.codigo = new.produto
       into new.prc_unit_original;
     end

     IF ( NEW.produtofis <> OLD.produtofis )
     THEN BEGIN
          SELECT NOME FROM EST_PRODUTOS
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PRODUTOFIS
          INTO :NOME ;

          NEW.nome_fis = :NOME ;
     END
END
^

/* Trigger: FAT_VENDAS_ITENS_COMISSOES_BI */
CREATE TRIGGER FAT_VENDAS_ITENS_COMISSOES_BI FOR FAT_VENDAS_ITENS_COMISSOES
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable total float;
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_ITENS_COMISSOES_ID,1);

  select sum(cmi.percentual) from fat_vendas_itens_comissoes cmi
  where cmi.cnpj = new.cnpj and cmi.cod_item = new.cod_item
  and cmi.produto = new.produto and cmi.sequencia = new.sequencia
  and cmi.codigo <> new.codigo
  into :total;

  if ((:total + new.percentual) > 100) then
      new.teste = new.cod_item;
--    exception valida_com_item;
END
^

/* Trigger: FAT_VENDAS_ITENS_COMISSOES_BU0 */
CREATE TRIGGER FAT_VENDAS_ITENS_COMISSOES_BU0 FOR FAT_VENDAS_ITENS_COMISSOES
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable total float;
begin
  select sum(cmi.percentual) from fat_vendas_itens_comissoes cmi
  where cmi.cnpj = new.cnpj and cmi.cod_item = new.cod_item
  and cmi.produto = new.produto and cmi.sequencia = new.sequencia
  and cmi.codigo <> new.codigo
  into :total;

  if ((:total + new.percentual) > 100) then
  begin
     new.teste = new.cod_item;
--    exception valida_com_item;
  end
end
^

/* Trigger: FIN_BAIXAS_PAGAR_AD0 */
CREATE TRIGGER FIN_BAIXAS_PAGAR_AD0 FOR FIN_BAIXAS_PAGAR
ACTIVE AFTER DELETE POSITION 0
AS
declare variable paga integer;
begin
  select count(*) from cm2_comissao_parc c
  where c.cnpj = old.cnpj and c.cod_pagar = old.codigo_pg and c.cod_bx_pagar = old.codigo
  and c.status = 'P'
  into :paga;

  if (:paga > 0) then
    exception COMISSAO_QUITADA;


  /*excluindo comissões por conta de estorto de recebimento*/
  delete from cm2_comissao_parc c
  where c.cnpj = old.cnpj and c.cod_pagar = old.codigo_pg and c.cod_bx_pagar = old.codigo;
end
^

/* Trigger: FIN_BAIXAS_PAGAR_AI0 */
CREATE TRIGGER FIN_BAIXAS_PAGAR_AI0 FOR FIN_BAIXAS_PAGAR
ACTIVE AFTER INSERT POSITION 0
AS
declare variable cod_pessoa integer;
declare variable codigo_cm integer;
declare variable cm_pct numeric(18,4);
declare variable cm_vlr numeric(18,4);
declare variable cod_baixa integer;
declare variable bx_pct_rep numeric(18,4);
begin
  /*descobrindo quanto da baixa foi efetuado para descobri quanto da comissão
  será liberado*/
  cod_baixa = new.codigo;
  bx_pct_rep = ((new.vlr_baixa - new.juros)/new.valor);
  for select c2.cod_pessoa, c2.codigo, c2.cm_pct, c2.valor from cm2_comissao_parc c2
      where c2.cnpj = new.cnpj and c2.cod_pagar = new.codigo_pg and c2.status = 'F'
      into :cod_pessoa, :codigo_cm, :cm_pct, :cm_vlr
  do
  begin
    insert into CM2_COMISSAO_PARC (CNPJ,
                                   COD_VENDA,
                                   COD_PESSOA,
                                   COD_RECEBER,
                                   COD_PAGAR,
                                   VALOR,
                                   cm_pct,
                                   STATUS,
                                   cod_bx_receber,
                                   dt_geracao)
                          values   (new.cnpj,
                                   new.codigo_vn,
                                   :cod_pessoa,
                                   null,
                                   new.codigo_pg,
                                   (:cm_vlr * :bx_pct_rep),
                                   :cm_pct,
                                   'L',
                                   :cod_baixa,
                                   new.dt_baixa);
  end
end
^

/* Trigger: FIN_BAIXAS_PAGAR_BI */
CREATE TRIGGER FIN_BAIXAS_PAGAR_BI FOR FIN_BAIXAS_PAGAR
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable USA_CAIXA CHAR(1);
begin
     /* VERIFICA SE O CLIENTE BAIXA CONTAS A PAGAR PELO CAIXA */

    USA_CAIXA = 'S';

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NOME = :NOME ;
     END

     if (:usa_caixa <> 'S') then
     begin
       new.conta = null;
       new.turno = null;
     end
     else IF (( USA_CAIXA = 'S' )AND ( NEW.dt_baixa is not null ) and (new.usuario = 0)) THEN
        exception SEM_CAIXA_SELECIONADO;
END
^

/* Trigger: FIN_BAIXAS_PAGAR_BU0 */
CREATE TRIGGER FIN_BAIXAS_PAGAR_BU0 FOR FIN_BAIXAS_PAGAR
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable USA_CAIXA CHAR(1);
begin
    USA_CAIXA = 'S';

     if (:usa_caixa <> 'S') then
     begin
        new.conta = null;
        new.turno = null;
     end
     else if (( USA_CAIXA = 'S' ) AND ( NEW.dt_baixa is not null ) AND ( NEW.usuario = 0 ) and (USA_CAIXA = 'S'))then
        exception SEM_CAIXA_SELECIONADO ;
END
^

/* Trigger: FIN_BAIXAS_RECEBER_AD0 */
CREATE TRIGGER FIN_BAIXAS_RECEBER_AD0 FOR FIN_BAIXAS_RECEBER
ACTIVE AFTER DELETE POSITION 0
as
declare variable representa_lib numeric(18,4);
declare variable representa_pg numeric(18,4);
declare variable atraso integer;
declare variable reducao integer;
declare variable paga integer;
declare variable vlr_baixa numeric(18,4);
declare variable gamb varchar(20);
declare variable perfil integer;
declare variable codigo_cm integer;
declare variable vendedor integer;
begin

  select count(*) from cm2_comissao_parc c
  where c.cnpj = old.cnpj and c.cod_receber = old.codigo_cr and c.cod_bx_receber = old.codigo
  and c.status = 'P'
  into :paga;

  if (:paga > 0) then
    exception COMISSAO_QUITADA;


  /*excluindo comissões por conta de estorto de recebimento*/
  delete from cm2_comissao_parc c
  where c.cnpj = old.cnpj and c.cod_receber = old.codigo_cr and c.cod_bx_receber = old.codigo;


  /*select count(*) from cm_comissao_parc c
  where c.cnpj = old.cnpj and c.cod_receber = old.codigo_cr and c.ano = old.ano_cr
  and c.status = 'Q'
  into :paga;

  if (:paga > 0) then
    exception COMISSAO_QUITADA;

  descobriremos aqui os dias de atraso
  atraso = (old.dt_baixa - old.dt_vencto);
  if (:atraso < 0) then
    gamb = 0;
  else
    gamb = atraso;

  /*descobrindo qual o perfil de pagamento o vendedor
  "da venda" esta relacionado, se itens tivem mais de um vendedor....
  for select c2.cod_perfil_pagto, c2.codigo from cm_comissao_parc c2
      where c2.cnpj = old.cnpj and c2.cod_receber = old.codigo_cr and c2.ano = old.ano_cr
      into :perfil, :codigo_cm
  do
  begin
       /*O perfil esta sendo salvo no ato da geração das comissoes, no entanto na fert flora
       tinhamos registros antigos de comissionamentos que não possuim o perfil vinculado,
       por isso estou dando "um jeito" para fazer com que o perfil seja identificado, esse bloco de codigo
       só será utils nestes casos
       if (:perfil is null) then
       begin
          select vdd.vendedor from fat_vendas vdd
          where vdd.codigo = old.codigo_vn and vdd.cnpj = old.cnpj
          into :vendedor;

          select vdd.cod_perfil_pagto from fat_vendedor vdd
          where vdd.codigo = :vendedor and vdd.cnpj = old.cnpj
          into :perfil;
       end

    select (pfx.pct_pagto) from cm_perfil_pagto_faixa pfx
    where (:gamb between pfx.dia_inicial and pfx.dia_final) and pfx.cnpj = old.cnpj and pfx.cod_perfil_pagto = :perfil
    into :reducao;

    vlr_baixa = (old.vlr_baixa - old.juros);

    /*se o valor da baixa é real.. pois pode ser somente uma baixa de parte dos juros
    if (:vlr_baixa > 0) then
    begin
      if (old.vlr_baixa >= old.valor) then
        representa_lib = 100;
      else
        representa_lib = ((old.vlr_baixa * 100.00)/old.valor);
    
      /*o percentual pago não vai sofrer qualquer redução na base de cálculo
      representa_pg = :representa_lib;
    
      /*o percentual o percentual liberado pode sofrer decrésimo em caso de pagto em atraso
      representa_lib = ((:representa_lib * :reducao)/100.00);
    
    
      update cm_comissao_parc c set
           c.pct_liberado = (coalesce(c.pct_liberado,0) - coalesce(:representa_lib,0)),
           c.pct_pago = (coalesce(c.pct_pago,0) - coalesce(:representa_pg,0))
      where c.cnpj = old.cnpj and c.codigo = :codigo_cm;
    end
  end*/
END
^

/* Trigger: FIN_BAIXAS_RECEBER_AI0 */
CREATE TRIGGER FIN_BAIXAS_RECEBER_AI0 FOR FIN_BAIXAS_RECEBER
ACTIVE AFTER INSERT POSITION 0
AS
declare variable representa_lib numeric(18,4);
declare variable representa_pg numeric(18,4);
declare variable representa_bx numeric(18,4);
declare variable atraso integer;
declare variable reducao integer;
declare variable pgt_fx_codigo integer;
declare variable pgt_fx_ini integer;
declare variable pgt_fx_fin integer;
declare variable pgt_fx_pct_pagto numeric(18,4);
declare variable vlr_baixa numeric(18,4);
declare variable pct_pagto numeric(18,4);
declare variable gamb varchar(20);
declare variable perfil integer;
declare variable codigo_cm integer;
declare variable vendedor integer;
declare variable cod_pessoa integer;
declare variable cm_pct numeric(18,4);
declare variable cm_vlr numeric(18,4);
declare variable bx_pct_rep numeric(18,4);
declare variable cod_baixa integer;
begin

  /*descobrindo quanto da baixa foi efetuado para descobri quanto da comissão
  será liberado*/
  cod_baixa = new.codigo;
  bx_pct_rep = ((new.vlr_baixa - new.juros)/new.valor);
  for select c2.cod_pessoa, c2.codigo, c2.cm_pct, c2.valor from cm2_comissao_parc c2
      where c2.cnpj = new.cnpj and c2.cod_receber = new.codigo_cr and c2.status = 'F'
      into :cod_pessoa, :codigo_cm, :cm_pct, :cm_vlr
  do
  begin
    insert into CM2_COMISSAO_PARC (CNPJ,
                                   COD_VENDA,
                                   COD_PESSOA,
                                   COD_RECEBER,
                                   COD_PAGAR,
                                   VALOR,
                                   cm_pct,
                                   STATUS,
                                   cod_bx_receber,
                                   DT_GERACAO)
                          values   (new.cnpj,
                                   new.codigo_vn,
                                   :cod_pessoa,
                                   new.codigo_cr,
                                   null,
                                   (:cm_vlr * :bx_pct_rep),
                                   :cm_pct,
                                   'L',
                                   :cod_baixa,
                                   new.dt_baixa);
  end


  /* Comissão - Fert Flora ---
  descobriremos aqui os dias de atraso
  atraso = (new.dt_baixa - new.dt_vencto);
  if (atraso < 0) then
     atraso = 0;

  gamb = atraso;


  for select c2.cod_perfil_pagto, c2.codigo from cm_comissao_parc c2
      where c2.cnpj = new.cnpj and c2.cod_receber = new.codigo_cr
      into :perfil, :codigo_cm
  do
  begin
       /*O perfil esta sendo salvo no ato da geração das comissoes, no entanto na fert flora
       tinhamos registros antigos de comissionamentos que não possuim o perfil vinculado,
       por isso estou dando "um jeito" para fazer com que o perfil seja identificado, esse bloco de codigo
       só será utils nestes casos
       if (:perfil is null) then
       begin
          select vdd.vendedor from fat_vendas vdd
          where vdd.codigo = new.codigo_vn and vdd.cnpj = new.cnpj
          into :vendedor;

          select vdd.cod_perfil_pagto from fat_vendedor vdd
          where vdd.codigo = :vendedor and vdd.cnpj = new.cnpj
          into :perfil;
       end

       select pfx.pct_pagto from cm_perfil_pagto_faixa pfx
       where (:gamb between pfx.dia_inicial and pfx.dia_final) and pfx.cnpj = new.cnpj and pfx.cod_perfil_pagto = :perfil
       into :pct_pagto;

       vlr_baixa = (new.vlr_baixa - coalesce(new.juros,0));

       /*está baixando um percentual da conta
       if (:vlr_baixa > 0) then
       begin
         if (new.vlr_baixa >= new.valor) then
           representa_bx = 100;
         else
           representa_bx = ((new.vlr_baixa * 100.00)/new.valor);

         /*o vlr. que será debitado do vlr. total da comissão
         representa_pg = representa_bx;

         /*o valor percentual que será liberado já descontado o vlr. de redução
         representa_lib = ((:representa_bx * :pct_pagto)/100.00);

         update cm_comissao_parc c set  c.pct_liberado = coalesce(c.pct_liberado,0) + :representa_lib,
         c.pct_pago = coalesce(c.pct_pago,0) + coalesce(:representa_pg,0),
         c.pgt_atraso = :atraso, c.pgt_fx_pct_pagto = :pct_pagto
         where c.cnpj = new.cnpj and c.codigo = :codigo_cm;
       end
  end*/

  /*gerando a relação para impedir o estorno de recebimento que já tenham gerados
  registros de contas à pagar para o vendedor
  insert into cm_rel_com_pgr_rec(cnpj, cod_recebida)
  values (new.cnpj, new.codigo); */
END
^

/* Trigger: FIN_BAIXAS_RECEBER_BD0 */
CREATE TRIGGER FIN_BAIXAS_RECEBER_BD0 FOR FIN_BAIXAS_RECEBER
ACTIVE BEFORE DELETE POSITION 0
AS
declare variable cod_pagar integer;
declare variable cont integer;
begin
  /*validando estorno de recebimentos que já possuem relção com contas
  à pagar. por conta das comissões que são pagas aos vendedore*/
  select rel.cod_pagar from cm_rel_com_pgr_rec rel
  where rel.cnpj = old.cnpj and rel.cod_recebida = old.codigo
  into :cod_pagar;

  select count(*) from fin_contas_pagar pgr
  where pgr.codigo = :cod_pagar and pgr.cnpj = old.cnpj
  into :cont;

  /*se ainda possui referencia com pagar*/
  if (:cont > 0) then
     exception CM_PG_EXISTE;

  select count(*) from fin_baixas_pagar bx
  where bx.codigo_pg = :cod_pagar and bx.cnpj = old.cnpj
  into :cont;

  /*se ainda possui referencia com pagar*/
  if (:cont > 0) then
     exception CM_PG_BAIXADA;
END
^

/* Trigger: FIN_BAIXAS_RECEBER_BI */
CREATE TRIGGER FIN_BAIXAS_RECEBER_BI FOR FIN_BAIXAS_RECEBER
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable USA_CAIXA CHAR(1);
declare variable ATRASO INTEGER;
declare variable perfil integer;
declare variable vendedor integer;
begin
  /*parametros de redução da comissão*/
  atraso = (new.dt_baixa - new.dt_vencto);

  if (:atraso < 0) then
   atraso = 0;

  /*descobrindo qual o perfil de pagamento o vendedor
  "da venda" esta relacionado, se itens tivem mais de um vendedor....*/
  select vdd.vendedor from fat_vendas vdd
  where vdd.codigo = new.codigo_vn
  into :vendedor;

  select vdd.cod_perfil_pagto from fat_vendedor vdd
  where vdd.codigo = :vendedor
  into :perfil;

  select pfx.codigo, pfx.dia_inicial, pfx.dia_final, pfx.pct_pagto from cm_perfil_pagto_faixa pfx
  where (:atraso between pfx.dia_inicial and pfx.dia_final) and pfx.cnpj = new.cnpj and pfx.cod_perfil_pagto = :perfil
  into new.pgt_fx_codigo, new.pgt_fx_ini, new.pgt_fx_fin, new.pgt_fx_pct_pagto;


     USA_CAIXA = 'S';

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NOME = :NOME ;
     END

     if (:usa_caixa <> 'S') then
     begin
        new.conta = null;
        new.turno = null;
     end
     else if ((new.dt_baixa is not null ) and ( new.usuario = 0 )) then
        exception SEM_CAIXA_SELECIONADO ;
END
^

/* Trigger: FIN_BAIXAS_RECEBER_BU0 */
CREATE TRIGGER FIN_BAIXAS_RECEBER_BU0 FOR FIN_BAIXAS_RECEBER
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable USA_CAIXA CHAR(1);
begin
     /* VERIFICA SE O CLIENTE BAIXA CONTAS A RECEBER PELO CAIXA */
     USA_CAIXA = 'S';

     if (:usa_caixa <> 'S') then
     begin
       new.conta = null;
       new.turno = null;
     end
     else IF (( USA_CAIXA = 'S' ) AND ( NEW.dt_baixa is not null ) AND ( NEW.usuario = 0 ) and (USA_CAIXA = 'S')) then
        exception SEM_CAIXA_SELECIONADO ;
END
^

/* Trigger: FIN_BANCO_AU0 */
CREATE TRIGGER FIN_BANCO_AU0 FOR FIN_BANCO
ACTIVE AFTER UPDATE POSITION 0
AS
begin
  /*definindo o antigo padrão como "não padrão"*/
  if ((coalesce(new.padrao_boleto,'N') = 'S') and (coalesce(old.padrao_boleto,'N') ='N')) then
  begin
    update fin_banco bc set bc.padrao_boleto = 'N'
    where coalesce(bc.padrao_boleto,'N') = 'S' and bc.codigo <> new.codigo;
  end
END
^

/* Trigger: FIN_CENTRO_CUSTO_AU0 */
CREATE TRIGGER FIN_CENTRO_CUSTO_AU0 FOR FIN_CENTRO_CUSTO
ACTIVE AFTER UPDATE POSITION 0
AS
begin
  /*Autalizando todos os filhos para estes conbilizarem
  no Custos de venda*/

  update fin_centro_custo cct set cct.cmv = new.cmv
  where cct.agrupador = new.codigo and cct.cnpj = new.cnpj;
END
^

/* Trigger: FIN_CENTRO_CUSTO_BI0 */
CREATE TRIGGER FIN_CENTRO_CUSTO_BI0 FOR FIN_CENTRO_CUSTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
     IF ( NEW.TIPO_CENTRO IS NULL )
     THEN
         NEW.TIPO_CENTRO = 'Fin' ;
END
^

/* Trigger: FIN_CENTRO_CUSTO_BU0 */
CREATE TRIGGER FIN_CENTRO_CUSTO_BU0 FOR FIN_CENTRO_CUSTO
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable cont integer;
begin
  /*contando para ver o centro de custo possui movimentos
  relacionados a ele*/
  select count(*) from fin_baixas_pagar pgr
  where pgr.centro_custo = new.codigo and pgr.cnpj = new.cnpj
  into :cont;
  /*se ele possui registro em pagas, então ele não pode ser agrupador*/
  if (:cont > 0) then 
  begin
    select count(*) from fin_centro_custo cct
    where cct.agrupador = new.codigo and cct.codigo <> new.codigo
    into :cont;

    if (:cont > 0) then
        exception MOV_CTCUSTO;
  end
END
^

/* Trigger: FIN_CHEQUES_AI0 */
CREATE TRIGGER FIN_CHEQUES_AI0 FOR FIN_CHEQUES
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  /* fabiano criando um indice composto para a tabela de  cheques,  */
  new.indice = (coalesce(new.cnpj,'')||coalesce(new.banco,'')||coalesce(new.conta,'')||coalesce(new.cheque,''));
END
^

/* Trigger: FIN_CHEQUES_BD0 */
CREATE TRIGGER FIN_CHEQUES_BD0 FOR FIN_CHEQUES
ACTIVE BEFORE DELETE POSITION 0
AS
begin
     IF ( OLD.PROCESSADO = 'S' )
     THEN BEGIN
          EXCEPTION MOVIMENTO_CONCILIADO ;
     END
END
^

/* Trigger: FIN_CHEQUES_BI */
CREATE TRIGGER FIN_CHEQUES_BI FOR FIN_CHEQUES
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOM   VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
BEGIN
   /* fabiano criando um indice composto para a tabela de  cheques,  */
  new.indice = (coalesce(new.cnpj,'')||coalesce(new.banco,'')||coalesce(new.conta,'')||coalesce(new.cheque,''));

  if (new.id is null) then
    select gen_id(gnr_fin_cheques_id,1) from rdb$database
    into new.id;

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOM;
          
          NEW.NOME = :NOM ;
     END
     
     /* ARMAZENA AS COTACOES
     IF ( NEW.EMISSAO IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.EMISSAO
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END  */
END
^

/* Trigger: FIN_CHEQUES_BU */
CREATE TRIGGER FIN_CHEQUES_BU FOR FIN_CHEQUES
ACTIVE BEFORE UPDATE POSITION 1
AS
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
BEGIN
     /* NOME DO FORNECEDOR */
     IF (( NEW.FORNECEDOR IS NOT NULL ) AND ( NEW.NOME_FORNECEDOR IS NULL ))
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CODIGO = NEW.FORNECEDOR AND CNPJ = NEW.CNPJ
          INTO NEW.NOME_FORNECEDOR ;
     END

     /* ARMAZENA AS COTACOES
     IF ( NEW.EMISSAO IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.EMISSAO
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END

               CONT = CONT + 1;
          END
     END*/
                                            /*pra poder desmarcar*/
     IF (( OLD.PROCESSADO = 'S' ) AND ( NEW.TIPO = OLD.TIPO ))
     THEN BEGIN
          if ( (coalesce(old.marcado,'') <> 'S') and (coalesce(new.marcado,'') <> 'N') ) then
            EXCEPTION MOVIMENTO_CONCILIADO ;
     END

   if ((new.data_conciliacao is not null) and (new.processado <> 'S')) then
     new.processado = 'S';

   /*Tetando organizar o estado do cheque $%#$##@@$@!!!!*/


   /*Validando a alteração de estado*/
   if (old.tipo <> new.tipo) then
   begin
     new.dt_alt_manual = cast ('today' as date);
     if(new.tipo = 'NO') then
     begin
       new.processado = 'N';
       new.vezes_devolucao = 0;
       new.data_devolucao = Null;
       new.data_conciliacao = NULl;
       new.conciliado = 'N';
       new.motivo_devolucao = NULL;
       new.data_reapres = null;
       new.data_acerto = null;
       /*retirando o cheque do movimento bancário*/
       delete from CTB_MOVIMENTO_CONTABIL mv
       where mv.origem = 'CHQ' and mv.planilha = new.planilha
       and mv.cnpj = new.cnpj;

     end
     else
     if (new.tipo = 'DE') then
     begin
       new.processado = 'S';
       new.vezes_devolucao = coalesce(new.vezes_devolucao,0) + 1;
       new.conciliado = 'N';
     end

   end

   if (new.vezes_devolucao > 1) then
     new.tipo = 'D2';

   IF (new.data_acerto is not null) then
     new.tipo = 'AC';
END
^

/* Trigger: FIN_COBRADOR_BD0 */
CREATE TRIGGER FIN_COBRADOR_BD0 FOR FIN_COBRADOR
ACTIVE BEFORE DELETE POSITION 0
AS
declare variable existe integer;
begin
  select count(*) from fin_cobrancas cb
  where cb.cnpj = old.cnpj and cb.cobrador = old.codigo
  into :existe;

  if (existe > 0) then
    exception  valida_cobrador;
END
^

/* Trigger: FIN_COBRANCAS_AI0 */
CREATE TRIGGER FIN_COBRANCAS_AI0 FOR FIN_COBRANCAS
ACTIVE AFTER INSERT POSITION 0
AS
begin
     IF ( NEW.ORIGEM = 'REC' )
     THEN BEGIN
          /* ATUALIZANDO O RECEBER  */
          UPDATE FIN_CONTAS_RECEBER
          SET COBRADOR = NEW.COBRADOR
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.RECEBER ;
     END
     ELSE BEGIN
          /* ATUALIZANDO O RECEBER  */
          UPDATE FIN_FATURAS
          SET COBRADOR = NEW.COBRADOR
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.RECEBER ;
     END
END
^

/* Trigger: FIN_COBRANCAS_BI0 */
CREATE TRIGGER FIN_COBRANCAS_BI0 FOR FIN_COBRANCAS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE LOCAL INTEGER;
begin
     new.indice = coalesce(new.cnpj,'')||cast (new.pessoa_fj as varchar(7))||cast (coalesce(new.data_cobranca,'') as varchar(25))||cast (new.receber as varchar(7))||coalesce(new.origem,'');

     /*pegando o local de cobrança do receber
     select rec.local_cobranca from fin_contas_receber rec
     where rec.codigo = new.receber and rec.cnpj = new.cnpj and rec.pessoa_fj = new.pessoa_fj
     into :local;

     new.local_cobranca = :local; */

     /*FbLL descobre o nome do motivo de acordo com o cod q se passou*/
     SELECT NOME FROM FIN_MOTIVO_COBRANCA
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MOTIVO
     INTO :NOME ;

     NEW.NOME_MOTIVO = :NOME ;

     /*FbLL descobre o nome do cobrador de acordo com o cod q se passou*/
     SELECT NOME FROM FIN_COBRADOR
     WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.COBRADOR
     INTO :NOME ;

     NEW.NOME_COBRADOR = :NOME ;

     IF ( NEW.ORIGEM = 'REC' )
     THEN BEGIN
          /* ATUALIZANDO O RECEBER  */
          UPDATE FIN_CONTAS_RECEBER
          SET COBRADOR = NEW.COBRADOR
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.RECEBER ;
     END
     ELSE BEGIN
          /* ATUALIZANDO O RECEBER  */
          UPDATE FIN_FATURAS
          SET COBRADOR = NEW.COBRADOR
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.RECEBER ;
     END

     new.dt_insert = cast('today' as date);
END
^

/* Trigger: FIN_COBRANCAS_BU0 */
CREATE TRIGGER FIN_COBRANCAS_BU0 FOR FIN_COBRANCAS
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  /* Trigger text */
  if (new.indice is null) then
    new.indice = coalesce(new.cnpj,'')||cast (new.pessoa_fj as varchar(7))||cast (coalesce(new.data_cobranca,'') as varchar(25))||cast (new.receber as varchar(7))||coalesce(new.origem,'');
END
^

/* Trigger: FIN_CONTAS_PAGAR_BI */
CREATE TRIGGER FIN_CONTAS_PAGAR_BI FOR FIN_CONTAS_PAGAR
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
declare variable CONTABILIDADE INTEGER;
declare variable EXISTE  INTEGER;
BEGIN
  select count(*) from fin_baixas_pagar bx /*esse ultimo where ira validar os estornos*/
  where bx.codigo_pg = new.codigo and bx.pessoa_fj <> new.pessoa_fj
  into :existe;

  if (:existe > 0) then
    exception BLOQUEIA_PAGAR;

  select count(*) from fin_contas_pagar pg /*esse ultimo where ira validar os estornos*/
  where pg.docto = new.docto and pg.pessoa_fj = new.pessoa_fj and pg.dt_vencto = new.dt_vencto
  into :existe;

  if (:existe > 0) then
    exception NDOCTO_DUPLICADO;



     if (new.dt_lancto is null) then
        new.dt_lancto = cast ('today' as date);

     if (new.DT_EMISSAO is null) then
        new.dt_emissao = cast ('today' as date);

     IF ( NEW.CONTABILIDADE IS NULL )
     THEN BEGIN
          SELECT CONTABILIDADE FROM GLO_FORNECEDORES
          WHERE CNPJ = NEW.CNPJ AND PESSOA_FJ = NEW.PESSOA_FJ
          ORDER BY CNPJ, PESSOA_FJ
          INTO :CONTABILIDADE ;

          IF ( :CONTABILIDADE IS NOT NULL )
          THEN BEGIN
               NEW.CONTABILIDADE = :CONTABILIDADE ;
          END
     END

     NEW.ANO = EXTRACT ( YEAR FROM NEW.DT_EMISSAO );
     
     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
     
     /* ARMAZENA AS COTACOES
     IF ( NEW.DT_LANCTO IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DT_LANCTO
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END */
END
^

/* Trigger: FIN_CONTAS_PAGAR_BU */
CREATE TRIGGER FIN_CONTAS_PAGAR_BU FOR FIN_CONTAS_PAGAR
ACTIVE BEFORE UPDATE POSITION 1
AS
declare variable NOME VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
declare variable EXISTE  INTEGER;
BEGIN
     /*caso tenha havido uma alteração no valor parcila para mais,
     então é sinal que houve uma baixa e vou lançar a data de ultima baixa*/
     IF (coalesce(NEW.vlr_parcial,0) > coalesce(old.vlr_parcial,0)) then
        new.dt_ultima_baixa = cast ('today' as date);


     IF ((NEW.NOME IS NULL) AND ( NEW.PESSOA_FJ <> OLD.PESSOA_FJ ))
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
     
      select count(*) from fin_contas_pagar pg /*esse ultimo where ira validar os estornos*/
  where pg.docto = new.docto and pg.pessoa_fj = new.pessoa_fj and pg.dt_vencto = new.dt_vencto and new.codigo <> pg.codigo
  into :existe;

  if (:existe > 0) then
    exception NDOCTO_DUPLICADO;

     /* ARMAZENA AS COTACOES
     IF ( NEW.DT_LANCTO IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DT_LANCTO
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END     */
end
^

/* Trigger: FIN_CONTAS_RECEBER_AI0 */
CREATE TRIGGER FIN_CONTAS_RECEBER_AI0 FOR FIN_CONTAS_RECEBER
ACTIVE AFTER INSERT POSITION 0
AS
declare variable vendedor integer;
declare variable cod_comissao integer;
declare variable cont integer;
declare variable cod_perfil_pagto integer;
begin

  if (new.codigo_vn > 0) then
  begin
      /*------------------------------------gerando o cabeçalho da comissão-------------------------------*/
      for select distinct vdi.vendedor  from fat_vendas vd
          inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vdi.codigo = vd.codigo)
          where vd.codigo = new.codigo_vn and vd.pessoa_fj = new.pessoa_fj and vd.cnpj = new.cnpj
          into :vendedor
      do
      begin
        /*salvando o perfil de pagamento diretamente na parcela de comissão, para podermos
        encontrar possíveis reduções no percentual de comissão por conta de atraso de pagamento,
        não realizamos isso no contas à receber porque não temos condições de encontrar o correto
        perfil de pagamento pelo vendedor que esta relacionado com o registro de venda pois
        uma venda pode ter + de um vendedor*/

        select vdd.cod_perfil_pagto from fat_vendedor vdd
        where vdd.cnpj = new.cnpj and vdd.codigo = :vendedor
        into :cod_perfil_pagto;

        /*verificando se existe o cabeçalho da comissão gerado*/
        select c.codigo from cm_comissao c
        where c.cnpj = new.cnpj and c.cod_venda = new.codigo_vn and c.cod_vendedor = :vendedor
        into :cod_comissao;
    
        if (:cod_comissao is null) then
        begin
            cod_comissao = GEN_ID(GEN_CM_COMISSAO_ID,1);
            insert into cm_comissao(cnpj,codigo,cod_venda,cod_vendedor, pessoa_fj, cod_perfil_pagto)
                         values(new.cnpj, :cod_comissao, new.codigo_vn, :vendedor, new.pessoa_fj, :cod_perfil_pagto);
        end
    
        /*verificando se esta parcela já não existe.. pois esta inserção pode ser fruto de
        um estorno*/
        select count(*) from cm_comissao_parc c
        where c.cnpj = new.cnpj and c.cod_receber = new.codigo and c.ano = new.ano and c.parc_cr = new.parcela
        into :cont;
    
    
        /*gerando comissões mas sem valores, apenas pra vincular com receber*/
        if (cont = 0) then
        begin
            insert into cm_comissao_parc(cnpj,cod_comissao,cod_receber,pct_liberado,status,ano, parc_cr, vlr_receber, pessoa_fj,cod_perfil_pagto)
                                  values(new.cnpj,:cod_comissao,new.codigo, 0, 'A', new.ano, new.parcela, new.valor, new.pessoa_fj, :cod_perfil_pagto);
        end
      end
  end
  else if (new.codigo_trc > 0) then
  begin
    /*------------------------------------gerando o cabeçalho da comissão-------------------------------*/
    for select distinct tr.vendedor  from fat_trocas tr
        where tr.codigo = new.codigo_trc and tr.pessoa_fj = new.pessoa_fj and tr.cnpj = new.cnpj
        into :vendedor
    do
    begin
       /*verificando se existe o cabeçalho da comissão gerado*/
        select c.codigo from cm_comissao c
        where c.cnpj = new.cnpj and c.cod_troca = new.codigo_trc and c.cod_vendedor = :vendedor
        into :cod_comissao;
    
        if (:cod_comissao is null) then
        begin
            cod_comissao = GEN_ID(GEN_CM_COMISSAO_ID,1);
            insert into cm_comissao(cnpj,codigo,cod_troca,cod_vendedor, pessoa_fj)
                         values(new.cnpj, :cod_comissao, new.codigo_trc, :vendedor, new.pessoa_fj);
        end
    
        /*verificando se esta parcela já não existe.. pois esta inserção pode ser fruto de
        um estorno*/
        select count(*) from cm_comissao_parc c
        where c.cnpj = new.cnpj and c.cod_receber = new.codigo and c.ano = new.ano and c.parc_cr = new.parcela
        into :cont;
    
    
        /*gerando comissões mas sem valores, apenas pra vincular com receber*/
        if (cont = 0) then
        begin
            insert into cm_comissao_parc(cnpj,cod_comissao,cod_receber,pct_liberado,status,ano, parc_cr, vlr_receber, pessoa_fj)
                                  values(new.cnpj,:cod_comissao,new.codigo, 0, 'A', new.ano, new.parcela, new.valor, new.pessoa_fj);
        end
    end
  end
END
^

/* Trigger: FIN_CONTAS_RECEBER_BI */
CREATE TRIGGER FIN_CONTAS_RECEBER_BI FOR FIN_CONTAS_RECEBER
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
declare variable banco  INTEGER;
declare variable convenio  INTEGER;
declare variable existe integer;
declare variable duplicado integer;
declare variable TipoBoleto char(1);
declare variable NossoNum Integer;
declare variable Gerablt char(1);
BEGIN
     select count(*) from fin_contas_receber rec
     where rec.cnpj = new.cnpj and rec.parcela = new.parcela and
     rec.pessoa_fj = new.pessoa_fj and rec.codigo_vn = new.codigo_vn
     into :duplicado;

     if (:duplicado > 0) then
       exception VALIDA_RECEBER;

     /*salvando como 'backup' o vlr  nominal*/
     new.valor_nominal = new.valor;

     NEW.arquivo_morto = 'N' ;
     /*
     select emp.gera_boletos, emp.blt_convenio from sis_empresas emp where emp.cnpj = new.cnpj
     into :gerablt, :convenio;
  
       select cast(bc.codigo as integer), coalesce(bc.boleto,0)  from fin_banco bc where bc.padrao_boleto = 'S'
       into :banco, :nossonum;
  
       if (:banco is null) then
        exception blt_banco_padrao;
  
       nossonum = :nossonum + 1;
       update fin_banco bc set bc.boleto = :nossonum where cast (bc.codigo as integer) = :banco;
  
       new.blt_banco = :banco;
  
       new.blt_nosso_num = (:convenio || :nossonum);
     end */

     if (new.ano is null) then
         new.ano = extract ( year from new.dt_emissao );
     
     if (new.nome is null)
     then begin
          select nome_razao from glo_pessoas_fj
          where cnpj = new.cnpj and codigo = new.pessoa_fj
          into :nome;
          
          new.nome = :nome ;
     end



END
^

/* Trigger: FIN_CONTAS_RECEBER_BU */
CREATE TRIGGER FIN_CONTAS_RECEBER_BU FOR FIN_CONTAS_RECEBER
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
declare variable EXISTE  INTEGER;
BEGIN
    select psa.nome_razao from glo_pessoas_fj psa
    where psa.cnpj = new.cnpj and psa.codigo = new.pessoa_fj
    into new.nome;


    if (new.blt_nosso_num is not null) then
    begin
      /*validando o nosso número*/
      select count(*) from fin_contas_receber rec where
      rec.cnpj = new.cnpj and rec.blt_banco = new.blt_banco
      and rec.blt_nosso_num = new.blt_nosso_num and rec.codigo <> new.codigo
      into :existe;

      if (:existe >= 1) then
        exception BLT_NOSSONUMERO;
    end

     /*quando este valor fica negativo, então la na aqui*/
     if (new.juros_parcial < 0)then
     begin
       new.vlr_parcial = (new.juros_parcial * -1);
       new.juros_parcial = 0;
     end

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
     
     /* ARMAZENA AS COTACOES
     IF ( NEW.DT_LANCTO IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DT_LANCTO
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END   */
END
^

/* Trigger: FIN_COTACOES_BI */
CREATE TRIGGER FIN_COTACOES_BI FOR FIN_COTACOES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FIN_COTACOES_ID,1);
END
^

/* Trigger: FIN_COTACOES_BIU0 */
CREATE TRIGGER FIN_COTACOES_BIU0 FOR FIN_COTACOES
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
declare variable existe integer;
begin
  select count(*) from fin_cotacoes ct
  where ct.data = new.data and ct.cod_moeda = new.cod_moeda and ct.codigo <> new.codigo
  into :existe;

  if (:existe > 0) then
   exception VALIDA_COTACAO_MOEDA;
end
^

/* Trigger: FIN_FATURAS_BI */
CREATE TRIGGER FIN_FATURAS_BI FOR FIN_FATURAS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
BEGIN
     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END
     

     /* ARMAZENA AS COTACOES
     IF ( NEW.DATA IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DATA
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END  */
     
     NEW.VALOR_ORIGINAL = NEW.VALOR ;
     NEW.DATA_BAIXA = NULL ;
     NEW.ultima_bx_parcial = NULL ;

     IF ( NEW.ORIGEM IS NULL )
     THEN BEGIN
          NEW.ORIGEM = 'MAN' ;
     END
END
^

/* Trigger: FIN_FATURAS_BU */
CREATE TRIGGER FIN_FATURAS_BU FOR FIN_FATURAS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable VALOR NUMERIC(18,4);
declare variable CONT  INTEGER;
declare variable NOME  VARCHAR(50);
BEGIN
     NEW.BAIXAS_PARCIAIS = NEW.VALOR_ORIGINAL - NEW.VALOR;

     IF (NEW.NOME IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.NOME = :NOME ;
     END

     /* ARMAZENA AS COTACOES
     IF ( NEW.DATA IS NOT NULL )
     THEN BEGIN
          CONT = 0;
          
          FOR SELECT VALOR FROM FIN_COTACOES
          WHERE DATA = NEW.DATA
          INTO :VALOR DO
          BEGIN
               IF ((CONT = 0)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA1 = NEW.VALOR / :VALOR ;
               END
               
               IF ((CONT = 1)AND(VALOR > 0))
               THEN BEGIN
                    NEW.MOEDA2 = NEW.VALOR / :VALOR ;
               END
               
               CONT = CONT + 1;
          END
     END */
END
^

/* Trigger: FIN_FOLHA_PAGTO_BI */
CREATE TRIGGER FIN_FOLHA_PAGTO_BI FOR FIN_FOLHA_PAGTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FIN_FOLHA_PAGTO_ID,1);
END
^

/* Trigger: FIN_FOLHA_TIPO_MOVIMENTO_BI */
CREATE TRIGGER FIN_FOLHA_TIPO_MOVIMENTO_BI FOR FIN_FOLHA_TIPO_MOVIMENTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FIN_FOLHA_TIPO_MOVIMENTO_ID,1);
END
^

/* Trigger: FIN_FORMAS_PAGTO_BI0 */
CREATE TRIGGER FIN_FORMAS_PAGTO_BI0 FOR FIN_FORMAS_PAGTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
     IF ( NEW.avista = 'S' )
     THEN BEGIN
          NEW.nparcelas = 0;
     END
END
^

/* Trigger: FIN_FORMAS_PAGTO_BU0 */
CREATE TRIGGER FIN_FORMAS_PAGTO_BU0 FOR FIN_FORMAS_PAGTO
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
     IF ( NEW.avista = 'S' )
     THEN BEGIN
          NEW.nparcelas = 0;
     END
END
^

/* Trigger: FIN_FORMAS_PAGTO_PARCELAS_BI */
CREATE TRIGGER FIN_FORMAS_PAGTO_PARCELAS_BI FOR FIN_FORMAS_PAGTO_PARCELAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FORMAS_PAGTO_PARC_ID,1);
END
^

/* Trigger: FIN_FORMAS_PAGTO_PARCELAS_BU0 */
CREATE TRIGGER FIN_FORMAS_PAGTO_PARCELAS_BU0 FOR FIN_FORMAS_PAGTO_PARCELAS
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
declare variable existe integer;
begin
  /*verificando se a parcela ja foi lançada*/
  select count(*) from FIN_FORMAS_PAGTO_PARCELAS pc
  where pc.cnpj = new.cnpj and pc.parcela = new.parcela and pc.cod_forma_pagto = new.cod_forma_pagto
  and pc.codigo <> new.codigo
  into :existe;

  if (coalesce(:existe,0) > 0 )  then
    exception VALIDA_PARC_VD_PC;


  /* verificando se existe parcela inferior a minha atual e que possua dia de vencimento
  maior do que o definido por mim  */
  select count(*) from FIN_FORMAS_PAGTO_PARCELAS pc
  where pc.cnpj = new.cnpj and pc.parcela < new.parcela and pc.cod_forma_pagto = new.cod_forma_pagto
  and pc.dias_vencimento > new.dias_vencimento
  and pc.codigo <> new.codigo
  into :existe;

  if (coalesce(:existe,0) > 0 )  then
    exception VALIDA_PARC_VD_DIAS;

end
^

/* Trigger: FIN_MOEDA_BI */
CREATE TRIGGER FIN_MOEDA_BI FOR FIN_MOEDA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_FIN_MOEDA_ID,1);
END
^

/* Trigger: FIN_MOVIMENTO_CARTAO_BD0 */
CREATE TRIGGER FIN_MOVIMENTO_CARTAO_BD0 FOR FIN_MOVIMENTO_CARTAO
ACTIVE BEFORE DELETE POSITION 0
AS
begin
  if (OLD.conciliado = 'S') then
     exception movimento_conciliado;
END
^

/* Trigger: FIN_MOVIMENTO_CARTAO_BI0 */
CREATE TRIGGER FIN_MOVIMENTO_CARTAO_BI0 FOR FIN_MOVIMENTO_CARTAO
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable taxa numeric(18,4);
begin
  if (new.tipo = 'Deb') then
  begin
     select coalesce(adm.taxa_debito,0) from fin_administradora adm
     where adm.codigo = new.administradora and adm.cnpj = new.cnpj
     into :taxa;
  end
  else if (new.tipo = 'Cre') then
  begin
     select coalesce(adm.taxa,0) from fin_administradora adm
     where adm.codigo = new.administradora and adm.cnpj = new.cnpj
     into :taxa;
  end
  else if (new.tipo = 'Par') then
  begin
     select coalesce(adm.taxa_parcelado,0) from fin_administradora adm
     where adm.codigo = new.administradora and adm.cnpj = new.cnpj
     into :taxa;
  end

  new.taxa = :taxa;


     NEW.PROCESSADO = 'N' ;
     NEW.DATA_CONCILIACAO = NULL ;

     if (new.venda = 0) then
     new.venda = null;
END
^

/* Trigger: FIN_MOVIMENTO_CARTAO_BU0 */
CREATE TRIGGER FIN_MOVIMENTO_CARTAO_BU0 FOR FIN_MOVIMENTO_CARTAO
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  if ((coalesce(new.conciliado,'N') = 'S') and (coalesce(old.conciliado,'N') = 'N')) then
    new.processado = 'S';
END
^

/* Trigger: FIN_MOV_CARTAO_RECEBER_BI0 */
CREATE TRIGGER FIN_MOV_CARTAO_RECEBER_BI0 FOR FIN_MOV_CARTAO_RECEBER
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  /* Trigger text */
  if (new.data_movto is null) then
    new.data_movto = cast ('today' as date);
END
^

/* Trigger: FIN_RECIBOS_BI */
CREATE TRIGGER FIN_RECIBOS_BI FOR FIN_RECIBOS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
BEGIN
     IF (NEW.FAVORECIDO IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.FAVORECIDO = :NOME ;
     END

     new.data = cast('today' as date);
END
^

/* Trigger: FIN_RECIBOS_PAGAS_BI */
CREATE TRIGGER FIN_RECIBOS_PAGAS_BI FOR FIN_RECIBOS_PAGAS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOME VARCHAR(50);
BEGIN
/*     IF (NEW.FAVORECIDO IS NULL)
     THEN BEGIN
          SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;
          
          NEW.FAVORECIDO = :NOME ;
     END */
POST_EVENT '$$IBE$$';
END
^

/* Trigger: GLO_CIDADES_BI0 */
CREATE TRIGGER GLO_CIDADES_BI0 FOR GLO_CIDADES
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable cnpj varchar(14);
begin
  if (new.cnpj is null) then
  begin
    select max(emp.cnpj) from sis_empresas emp
    into :cnpj;

    new.cnpj = :cnpj;
  end

  if (new.codigo is null) then
    new.codigo = gen_id(GLO_CIDADES_GE,1);
END
^

/* Trigger: GLO_CLIENTES_BI0 */
CREATE TRIGGER GLO_CLIENTES_BI0 FOR GLO_CLIENTES
ACTIVE BEFORE INSERT POSITION 0
AS
  declare variable ceppadrao varchar(8);
  declare variable class integer;
begin
  /*validando cep do trabalho*/
  select coalesce(emp.cep,'11111111') from sis_empresas emp
  where cnpj = new.cnpj
  into :ceppadrao;

  if (coalesce(new.cep_trabalho,'') = '')then
     new.cep_trabalho = ceppadrao;

  /*validando frequencia*/
  if (coalesce(new.frequencia,'') = '') then
    new.frequencia = 'Eve';

  /*validando classificacao*/
  if (coalesce(new.classif,'') = '') then
    new.classif = 'R';

  IF (new.CONS_REV is null ) then
      new.CONS_REV = 'C';
END
^

/* Trigger: GLO_CLIENTES_BU0 */
CREATE TRIGGER GLO_CLIENTES_BU0 FOR GLO_CLIENTES
ACTIVE BEFORE UPDATE POSITION 0
AS
  declare variable ceppadrao varchar(8);
  declare variable class integer;
begin
  select coalesce(emp.cep,'11111111') from sis_empresas emp
  where cnpj = new.cnpj
  into :ceppadrao;

  if (coalesce(new.cep_trabalho,'') = '')then
     new.cep_trabalho = ceppadrao;

  /*validando frequencia*/
  if (coalesce(new.frequencia,'') = '') then
    new.frequencia = 'Eve';

  /*validando classificacao*/
  if (coalesce(new.classif,'') = '') then
    new.classif = 'R';

  IF ( new.CONS_REV is null ) then
      new.CONS_REV = 'C';
END
^

/* Trigger: GLO_CLIENTES_PRODUTOS_AU0 */
CREATE TRIGGER GLO_CLIENTES_PRODUTOS_AU0 FOR GLO_CLIENTES_PRODUTOS
ACTIVE AFTER UPDATE POSITION 0
AS
begin
  /*se o contrato for desativado, tods os itens
  também serao desativados*/
  if ((new.ativo = 'N') and (old.ativo = 'S')) then
  begin
    update glo_clientes_produtos_itens clp set clp.ativo = 'N'
    where clp.cnpj = new.cnpj and clp.contrato = new.codigo;
  end
END
^

/* Trigger: GLO_CLIENTES_PRODUTOS_BD0 */
CREATE TRIGGER GLO_CLIENTES_PRODUTOS_BD0 FOR GLO_CLIENTES_PRODUTOS
ACTIVE BEFORE DELETE POSITION 0
AS
declare variable existe integer;
begin
     select count(*) from ofc_ordem_servico os
     where os.id_contrato = old.codigo
     into :existe;

     if (:existe > 0) then
        exception VALIDA_CONTRATO;
END
^

/* Trigger: GLO_CLIENTES_PRODUTOS_BI */
CREATE TRIGGER GLO_CLIENTES_PRODUTOS_BI FOR GLO_CLIENTES_PRODUTOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_GLO_CLIENTES_PRODUTOS_ID,1);

  new.data = cast ('today' as date);
END
^

/* Trigger: GLO_CLIENTES_PRODUTOS_ITENS_BI */
CREATE TRIGGER GLO_CLIENTES_PRODUTOS_ITENS_BI FOR GLO_CLIENTES_PRODUTOS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_GLO_CLI_PROD_ITENS_ID,1);

  if (new.dt_adicao is null) then
    new.dt_adicao = cast('today' as date);

  new.data = cast('today' as date);
  NEW.ativo = 'S';
END
^

/* Trigger: GLO_CONTATOS_BI */
CREATE TRIGGER GLO_CONTATOS_BI FOR GLO_CONTATOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_GLO_CONTATOS_ID,1);
END
^

/* Trigger: GLO_ESTADOS_BI0 */
CREATE TRIGGER GLO_ESTADOS_BI0 FOR GLO_ESTADOS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable cnpj varchar(14);
begin
  if (new.cnpj is null) then
  begin
    select max(emp.cnpj) from sis_empresas emp
    into :cnpj;

    new.cnpj = :cnpj;
  end
END
^

/* Trigger: GLO_FORNECEDORES_AU0 */
CREATE TRIGGER GLO_FORNECEDORES_AU0 FOR GLO_FORNECEDORES
INACTIVE AFTER INSERT OR UPDATE POSITION 0
AS
DECLARE VARIABLE CNPJ_DESTINO VARCHAR(14);
begin
  if ((coalesce(new.sincroniza_filiais,'N') = 'S') and (coalesce(old.sincroniza_filiais,'N') = 'N')) then
  begin
    for select e.cnpj from sis_empresas e
        where e.cnpj <> new.cnpj
        into :cnpj_destino
    do
    begin
--      execute procedure pcd_exp_insere_pessoas(new.cnpj, :cnpj_destino,new.pessoa_fj,'F');
    end
  end
end
^

/* Trigger: GLO_FORNECEDORES_BI0 */
CREATE TRIGGER GLO_FORNECEDORES_BI0 FOR GLO_FORNECEDORES
ACTIVE BEFORE INSERT POSITION 0
AS
declare existe integer;
begin
  select count(*) from glo_fornecedores f
  where f.pessoa_fj = new.pessoa_fj and f.cnpj = new.cnpj
  into :existe;

  if (coalesce(existe,0) > 0) then
    exception VALIDA_FORNECEDOR;


  if (coalesce(new.vendedor,'') = '') then
    new.vendedor = 'VENDEDOR-PADRAO';
END
^

/* Trigger: GLO_FORNECEDORES_BU0 */
CREATE TRIGGER GLO_FORNECEDORES_BU0 FOR GLO_FORNECEDORES
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
 if (coalesce(new.vendedor,'') = '') then
    new.vendedor = 'VENDEDOR-PADRAO';
END
^

/* Trigger: GLO_PESSOAS_FJ_BI0 */
CREATE TRIGGER GLO_PESSOAS_FJ_BI0 FOR GLO_PESSOAS_FJ
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable ceppadrao varchar(8);
declare variable existe integer;
declare variable valida char(1);
begin
  select coalesce(emp.cep,'11111111'), emp.valida_documentos from sis_empresas emp
  where emp.cnpj = new.cnpj
  into :ceppadrao, :valida;

  if (:valida = 'S') then
  begin
    select count(*) from glo_pessoas_fj p
    where p.codigo <> new.codigo and p.cnpj = new.cnpj and p.cpf_cgc = new.cpf_cgc
    into :existe ;

    if (:existe > 0) then
      exception VALIDA_DOCUMENTO;
  end

  if (coalesce(new.cep,'') = '')then
     new.cep = ceppadrao;

  if (coalesce(new.numero,'') = '')then
     new.numero = 'S/N';
END
^

/* Trigger: GLO_PESSOAS_FJ_BU0 */
CREATE TRIGGER GLO_PESSOAS_FJ_BU0 FOR GLO_PESSOAS_FJ
ACTIVE BEFORE UPDATE POSITION 0
AS
  declare variable ceppadrao varchar(8);
  declare variable existe integer;
  declare variable valida char(1);
begin
  select coalesce(emp.cep,'11111111'), emp.valida_documentos from sis_empresas emp
  where emp.cnpj = new.cnpj
  into :ceppadrao, : valida;

  if (coalesce(new.cep,'') = '')then
     new.cep = ceppadrao;

   if (coalesce(new.numero,'') = '')then
     new.numero = 'S/N';


  if (:valida = 'S') then
  begin
    select count(*) from glo_pessoas_fj p
    where p.codigo <> new.codigo and p.cnpj = new.cnpj and p.cpf_cgc = new.cpf_cgc
    into :existe ;

    if (:existe > 0) then
      exception VALIDA_DOCUMENTO;
  end
END
^

/* Trigger: GLO_PROPRIEDADES_BI */
CREATE TRIGGER GLO_PROPRIEDADES_BI FOR GLO_PROPRIEDADES
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable NOMEP VARCHAR(50);
BEGIN
     IF ( NEW.NOME IS NULL )
     THEN BEGIN
          SELECT NOME FROM glo_logradouros
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.ENDERECO
          INTO :NOMEP ;

          NEW.NOME = :NOMEP ;
     END
END
^

/* Trigger: GLO_VEICULOS_BI */
CREATE TRIGGER GLO_VEICULOS_BI FOR GLO_VEICULOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_GLO_VEICULOS_ID,1);
END
^

/* Trigger: IBE$LOG_TABLES_BD */
CREATE TRIGGER IBE$LOG_TABLES_BD FOR IBE$LOG_TABLES
ACTIVE BEFORE DELETE POSITION 0
AS
BEGIN
  DELETE FROM IBE$LOG_FIELDS WHERE LOG_TABLES_ID = OLD.ID;
  DELETE FROM IBE$LOG_BLOB_FIELDS WHERE LOG_TABLES_ID = OLD.ID;
  DELETE FROM IBE$LOG_KEYS WHERE LOG_TABLES_ID = OLD.ID;
END
^

/* Trigger: LOG_FAT_VENDAS_AI0 */
CREATE TRIGGER LOG_FAT_VENDAS_AI0 FOR LOG_FAT_VENDAS
ACTIVE AFTER INSERT POSITION 0
AS
declare variable penultimoregistro integer;
begin
  select max(id) from log_fat_vendas lvd
  where lvd.id < new.id and lvd.cnpj = new.cnpj and lvd.codigo = new.codigo
  into :penultimoregistro;

  /*fazendo o penultimo registro a refereciar este registro*/
  update log_fat_vendas set id_next = new.id
  where id = :penultimoregistro;

end
^

/* Trigger: LOG_FAT_VENDAS_BI */
CREATE TRIGGER LOG_FAT_VENDAS_BI FOR LOG_FAT_VENDAS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable existe INTEGER;
BEGIN
  IF (NEW.ID IS NULL) THEN
    NEW.ID = GEN_ID(GEN_LOG_FAT_VENDAS_ID,1);

  select count(*) from log_fat_vendas lvd
  where lvd.codigo = new.codigo and lvd.cnpj = new.cnpj
  into :existe;

  if (coalesce(:existe,0) = 0) then
    new.log_operacao = 'INSERÇÃO';
END
^

/* Trigger: NFE_XML_LOG_BI */
CREATE TRIGGER NFE_XML_LOG_BI FOR NFE_XML_LOG
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_NFE_XML_LOG_ID,1);
END
^

/* Trigger: OFC_CONTRATOS_BI */
CREATE TRIGGER OFC_CONTRATOS_BI FOR OFC_CONTRATOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_CONTRATOS_ID,1);

  new.data = cast ('today' as date);

  if (new.dt_inicio is null) then
   new.dt_inicio = cast ('today' as date);
     
END
^

/* Trigger: OFC_CONTRATOS_ITENS_BD0 */
CREATE TRIGGER OFC_CONTRATOS_ITENS_BD0 FOR OFC_CONTRATOS_ITENS
ACTIVE BEFORE DELETE POSITION 0
AS
declare variable existe integer;
begin
 /*no caso de trocar o código do produto no item do contrato*/
  select count(*) from ofc_ordem_servico os
  where os.produto = old.cod_produto and os.id_contrato = old.contrato
  into :existe;

    /*se existe movimentações deste produto neste contrato em atendimento
    qualquer alteração é vedada*/
  if (:existe > 0) then
    exception VALIDA_DELETE_ITEN_CONTRATO;
end
^

/* Trigger: OFC_CONTRATOS_ITENS_BI */
CREATE TRIGGER OFC_CONTRATOS_ITENS_BI FOR OFC_CONTRATOS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable existe integer;
BEGIN
  /*pegando todos os 'equipamentos' dos contratos que estejam ativos e que sejam realmente equipamentos*/
  select count(*) from ofc_contratos_itens osi
  inner join est_produtos prd on (prd.codigo = osi.cod_produto and prd.cnpj = osi.cnpj)
  where osi.cnpj = new.cnpj and osi.cod_produto = new.cod_produto and osi.ativo = 'S'
  and coalesce(prd.servico,'N') = 'N'
  into :existe;

  if ((:existe > 0) and (new.ativo = 'S')) then
    exception VALIDA_INSERT_ITEN_CONTRATO;


  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_CONTRATOS_ITENS_ID,1);

  if (new.dt_adicao is null) then
    new.dt_adicao = cast('today' as date);

  new.data = cast('today' as date);

END
^

/* Trigger: OFC_CONTRATOS_ITENS_BU0 */
CREATE TRIGGER OFC_CONTRATOS_ITENS_BU0 FOR OFC_CONTRATOS_ITENS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
begin
  if ((coalesce(new.ativo,'S') = 'N') and (coalesce(old.ativo,'S') = 'S')) then
    new.dt_retirada = cast ('today' as date);
  else if ((coalesce(new.ativo,'S') = 'S') and (coalesce(old.ativo,'S') = 'N')) then
    new.dt_retirada = null;

  /*no caso de trocar o código do produto no item do contrato*/
  if (new.cod_produto <> old.cod_produto) then
  begin
    select count(*) from ofc_ordem_servico os
    where os.produto = new.cod_produto and os.id_contrato = new.contrato
    into :existe;

    /*se existe movimentações deste produto neste contrato em atendimento
    qualquer alteração é vedada*/
    if (:existe > 0) then
      exception VALIDA_ALT_PROD_ITEN_CONTRATO;
  end

  /*caso o usuário esteja tentando reativar um produto é necessário verificar
  se o mesmo jã não esta sendo utilizado*/
  if ((coalesce(new.ativo,'S') = 'S') and (coalesce(old.ativo,'N') = 'N')) then
  begin

    /*pegando todos os 'equipamentos' dos contratos que estejam ativos e que sejam realmente equipamentos*/
    select count(*) from ofc_contratos_itens osi
    inner join est_produtos prd on (prd.codigo = osi.cod_produto and prd.cnpj = osi.cnpj)
    where osi.cnpj = new.cnpj and osi.cod_produto = new.cod_produto and osi.ativo = 'S'
    and coalesce(prd.servico,'N') = 'N'
    into :existe;

    if (:existe > 0) then
      exception VALIDA_INSERT_ITEN_CONTRATO;
  end
end
^

/* Trigger: OFC_CONTRATOS_ITENS_DESC_BI */
CREATE TRIGGER OFC_CONTRATOS_ITENS_DESC_BI FOR OFC_CONTRATOS_ITENS_DESC
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_CONTRATOS_ITENS_DESC_ID,1);
END
^

/* Trigger: OFC_CONTRATOS_ITENS_DESC_BU0 */
CREATE TRIGGER OFC_CONTRATOS_ITENS_DESC_BU0 FOR OFC_CONTRATOS_ITENS_DESC
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
begin
  select count(*) from OFC_CONTRATOS_ITENS_DESC o
  where o.cnpj = new.cnpj and o.codigo <> new.codigo and o.cod_item = new.cod_item
  and
  (  /*se existe algum registro q possua dt. vigencia inicial entre as datas do novo cadastro*/
    (o.dt_vigencia_inicial between new.dt_vigencia_inicial and new.dt_vigencia_final)
    or /*se existe algum registro q possua dt. vigencia final entre as datas do novo cadastro*/
    (o.dt_vigencia_final between new.dt_vigencia_inicial and new.dt_vigencia_final)
   )
   into :existe;

   if (coalesce(:existe,0) > 0) then
     exception VALIDA_DT_VIGENCIA;
end
^

/* Trigger: OFC_GRP_CONTRATOS_BI */
CREATE TRIGGER OFC_GRP_CONTRATOS_BI FOR OFC_GRP_CONTRATOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_GRP_CONTRATOS_ID,1);
END
^

/* Trigger: OFC_GRP_CONTRATOS_ITENS_BI */
CREATE TRIGGER OFC_GRP_CONTRATOS_ITENS_BI FOR OFC_GRP_CONTRATOS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE existe integer;
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_GRP_CONTRATOS_ITENS_ID,1);


  select count(*) from ofc_grp_contratos_itens gpi
  where gpi.cnpj = new.cnpj and gpi.pessoa_fj = new.pessoa_fj and gpi.cod_grupo = new.cod_grupo
  into :existe;

  if (:existe > 0) then
    exception OFC_EXP_GRUPO_EMP;
  new.data = current_date;
END
^

/* Trigger: OFC_LEITURAS_AU0 */
CREATE TRIGGER OFC_LEITURAS_AU0 FOR OFC_LEITURAS
ACTIVE AFTER UPDATE POSITION 0
AS
begin
  if ((new.fechada = 'S') and old.fechada <> 'S' ) then
     execute procedure pcd_ofc_media_copia(new.cnpj,new.codigo, new.data_referencia);
end
^

/* Trigger: OFC_LEITURAS_BI */
CREATE TRIGGER OFC_LEITURAS_BI FOR OFC_LEITURAS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE SDTPERIODO1 VARCHAR(20);
DECLARE VARIABLE DTPERIODO1 DATE;
DECLARE VARIABLE SDTPERIODO2 VARCHAR(20);
DECLARE VARIABLE PERIODO VARCHAR(100);
DECLARE VARIABLE CONTRATO INTEGER;
DECLARE VARIABLE SDIA CHAR(2);
DECLARE VARIABLE DIA INTEGER;
DECLARE VARIABLE NUM_CONTRATO VARCHAR(30);
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_LEITURAS_ID,1);

  new.data = cast('today' as date);

  /*verificando o periodo  */

  select ct.franquia_copias, ct.valor_copia_excedente, ct.valor_contrato, CT.informacoes, ct.NUM_CONTRATO
  from ofc_grp_contratos ct
  where ct.codigo = new.contrato and ct.cnpj = new.cnpj
  into new.ctr_franquia, new.ctr_valor_copia_excedente, new.ctr_valor, NEW.observacao, :num_contrato;

  /*verificando ultima leitura realizada*/
  select max(lt.data) from ofc_leituras lt
  where lt.cnpj = NEW.cnpj and lt.contrato = NEW.contrato and
  lt.data < NEW.data
  into :dtperiodo1;

  /*se ela nao existir então considerarei a propria leitura como sendo a ultima*/
  if (:dtperiodo1 is null) then
   dtperiodo1 = NEW.data;

  /*extraindo o dia para compor a mensagem do periodo*/
  dia = extract(day from :dtperiodo1);
  IF (:dia < 9) THEN
   sdia = '0'||:dia;
  ELSE
   sdia = :dia;

  /*todo o processo apenas para montar a mensagem a ser impressa do recibo*/
  sdtperiodo1 = :sdia||'/'||extract(month from :dtperiodo1)||'/'||extract(year from :dtperiodo1);

  dia = extract(day from NEW.data);
  IF (:dia < 9) THEN
   sdia = '0'||:dia;
  ELSE
   sdia = :dia;

  /*iden*/
  sdtperiodo2 = :sdia||'/'||extract(month from NEW.data)||'/'||extract(year from NEW.data);

  NEW.periodo = 'REF AO PER. '||:sdtperiodo1||' à '||:sdtperiodo2||'   ';
  IF (NEW.observacao IS NOT NULL) THEN
    NEW.observacao = NEW.periodo||' CTR: '||COALESCE(:num_contrato,'')||NEW.observacao ;
  ELSE
    NEW.observacao = NEW.periodo||' CTR: '||COALESCE(:num_contrato,'');
END
^

/* Trigger: OFC_LEITURAS_BU0 */
CREATE TRIGGER OFC_LEITURAS_BU0 FOR OFC_LEITURAS
ACTIVE BEFORE UPDATE POSITION 0
AS
declare variable existe integer;
begin

  if (coalesce(new.contrato,0) <> coalesce(old.contrato,0)) then
  begin
    select count(*) from ofc_leituras_itens lti
    where lti.leitura = new.codigo and lti.cnpj = new.cnpj
    into :existe;

    if (:existe > 0) then
      exception VALIDA_ALTERA_CONTRATO;
  end
end
^

/* Trigger: OFC_LEITURAS_ITENS_AD0 */
CREATE TRIGGER OFC_LEITURAS_ITENS_AD0 FOR OFC_LEITURAS_ITENS
ACTIVE AFTER DELETE POSITION 0
AS
begin
  execute procedure pcd_ofc_leitura_upd_total(old.cnpj, old.leitura, OLD.codigo);
end
^

/* Trigger: OFC_LEITURAS_ITENS_AI0 */
CREATE TRIGGER OFC_LEITURAS_ITENS_AI0 FOR OFC_LEITURAS_ITENS
ACTIVE AFTER INSERT POSITION 0
AS
begin
  execute procedure pcd_ofc_leitura_upd_total(new.cnpj, new.leitura,NEW.codigo);
end
^

/* Trigger: OFC_LEITURAS_ITENS_AU0 */
CREATE TRIGGER OFC_LEITURAS_ITENS_AU0 FOR OFC_LEITURAS_ITENS
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable franquia integer;
begin
  execute procedure pcd_ofc_leitura_upd_total(new.cnpj, new.leitura, NEW.codigo);
end
^

/* Trigger: OFC_LEITURAS_ITENS_BI */
CREATE TRIGGER OFC_LEITURAS_ITENS_BI FOR OFC_LEITURAS_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable data_leitura date;
declare variable codigo_item_leitura integer;
declare variable vlr_ultima_leitura integer;
declare variable CTR_VALOR   NUMERIC(18,4);
declare variable CTR_FRANQUIA INTEGER;
declare variable CTR_VALOR_COPIA_EXCEDENTE NUMERIC(18,4);
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_LEITURAS_ITENS_ID,1);

  /*pegando a data da leitura atual*/
  select lt.data_referencia, lt.ctr_valor, lt.ctr_franquia, lt.ctr_valor_copia_excedente  from ofc_leituras lt
  where lt.codigo = new.leitura
  into :data_leitura, :ctr_valor, :ctr_franquia, :ctr_valor_copia_excedente;

  new.ctr_valor = coalesce(:ctr_valor,0);
  new.ctr_franquia = coalesce(:ctr_franquia,0);
  new.ctr_valor_copia_excedente = coalesce(:ctr_valor_copia_excedente,0);
  /*pegando a data da ultima leitura realizada que não seja a propria ("lt.codigo < new.leitura") obviamente,
  não sei se isso é necessário no before insert..mas emfim..*/
  select max(lti.codigo) from ofc_leituras lt
  inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
  where lti.cod_item_contrato = new.cod_item_contrato and lt.data_referencia <= :data_leitura
  and lt.codigo < new.leitura and lt.fechada = 'S'
  into :codigo_item_leitura;

  /*salvando o código da ultima leitura*/
  select coalesce(lti.leitura_atual,0) from ofc_leituras_itens lti
  where lti.codigo = :codigo_item_leitura
  into :vlr_ultima_leitura;

  new.ultima_leitura = coalesce(:vlr_ultima_leitura,0);

END
^

/* Trigger: OFC_LEITURAS_ITENS_BU0 */
CREATE TRIGGER OFC_LEITURAS_ITENS_BU0 FOR OFC_LEITURAS_ITENS
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
   if (new.leitura_atual >= new.ultima_leitura) then
    new.saldo_leitura = (new.leitura_atual - new.ultima_leitura);
  else
    new.saldo_leitura = new.leitura_atual;
end
^

/* Trigger: OFC_LOG_STATUS_BI */
CREATE TRIGGER OFC_LOG_STATUS_BI FOR OFC_LOG_STATUS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.ID IS NULL) THEN
    NEW.ID = GEN_ID(GEN_OFC_LOG_STATUS_ID,1);
END
^

/* Trigger: OFC_MENSALIDADES_BI */
CREATE TRIGGER OFC_MENSALIDADES_BI FOR OFC_MENSALIDADES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_MENSALIDADES_ID,1);
END
^

/* Trigger: OFC_MENSALIDADES_ITENS_BI */
CREATE TRIGGER OFC_MENSALIDADES_ITENS_BI FOR OFC_MENSALIDADES_ITENS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_MENSALIDADES_ITENS_ID,1);
END
^

/* Trigger: OFC_MOTIVO_CHAMADO_BI */
CREATE TRIGGER OFC_MOTIVO_CHAMADO_BI FOR OFC_MOTIVO_CHAMADO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_MOTIVO_CHAMADO_ID,1);
END
^

/* Trigger: OFC_MOTORES_SERVICOS_BI0 */
CREATE TRIGGER OFC_MOTORES_SERVICOS_BI0 FOR OFC_MOTORES_SERVICOS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM OFC_SERVICOS
     WHERE CNPJ = NEW.CNPJ AND
     CODIGO = NEW.SERVICO
     INTO :NOME ;

     NEW.NOME_SERVICO = :NOME ;
END
^

/* Trigger: OFC_MOTORES_SERVICOS_BU0 */
CREATE TRIGGER OFC_MOTORES_SERVICOS_BU0 FOR OFC_MOTORES_SERVICOS
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     SELECT NOME FROM OFC_SERVICOS
     WHERE CNPJ = NEW.CNPJ AND
     CODIGO = NEW.SERVICO
     INTO :NOME ;

     NEW.NOME_SERVICO = :NOME ;
END
^

/* Trigger: OFC_ORDEM_SERVICO_AU0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_AU0 FOR OFC_ORDEM_SERVICO
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable item_contrato integer;
begin
  /* ----------------------- BLOCO ATUALIZA A MEDIA DE CÓPIAS DO PRODUTO --------------------------------------------------*/
  select cti.codigo from ofc_contratos_itens cti
  inner join ofc_contratos ct on (cti.cnpj = ct.cnpj and cti.contrato = ct.codigo)
  where cti.cod_produto = new.produto and ct.cod_cliente = new.pessoa_fj
  and cti.ativo = 'S' and ct.ativo = 'S'
  into :item_contrato;

  if (:item_contrato is not null) then
     execute procedure PCD_CALC_MED_COPIA(new.cnpj,new.pessoa_fj,new.produto,:item_contrato);


END
^

/* Trigger: OFC_ORDEM_SERVICO_BI0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_BI0 FOR OFC_ORDEM_SERVICO
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable prioridade integer;
begin
  if (new.id_contrato is null) then
  begin
    select max(ct.codigo)
    from est_produtos prd
    inner join ofc_contratos_itens cti on (cti.cnpj = prd.cnpj and cti.cod_produto = prd.codigo)
    inner join ofc_contratos ct on (ct.cnpj = cti.cnpj and ct.codigo = cti.contrato)
    inner join glo_pessoas_fj psa on (psa.codigo = ct.cod_cliente and psa.cnpj = ct.cnpj)
    where ct.cnpj = new.cnpj and cti.cod_produto = new.produto
    and ct.cod_cliente = new.pessoa_fj and cti.ativo = 'S'
    into new.id_contrato;

    if (new.id_contrato is null) then
    begin
      select max(ct.codigo)
      from est_produtos prd
      inner join ofc_contratos_itens cti on (cti.cnpj = prd.cnpj and cti.cod_produto = prd.codigo)
      inner join ofc_contratos ct on (ct.cnpj = cti.cnpj and ct.codigo = cti.contrato)
      inner join glo_pessoas_fj psa on (psa.codigo = ct.cod_cliente and psa.cnpj = ct.cnpj)
      where ct.cnpj = new.cnpj and cti.cod_produto = new.produto
      and ct.cod_cliente = new.pessoa_fj and cti.ativo = 'N'
      into new.id_contrato;
    end
  end

  /*if (new.prioridade is null) then
  begin
    select max(os.prioridade) from ofc_ordem_servico os
    where os.cnpj = new.cnpj and os.pessoa_fj = new.pessoa_fj and os.data_fechamento is null
    into :prioridade;

    prioridade = coalesce(:prioridade,0)+1;
    new.prioridade = :prioridade;
  end */
end
^

/* Trigger: OFC_ORDEM_SERVICO_BU0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_BU0 FOR OFC_ORDEM_SERVICO
ACTIVE BEFORE UPDATE POSITION 0
AS
/* variaveis do laco */
/* variaveis rechamado */
declare variable dias_rechamado integer;
declare variable dias integer;
declare variable dt_ult_os date;
declare variable cod_os integer;
declare variable tecnico integer;
declare variable retorno char(1);
BEGIN
  if (coalesce(new.map_lat,'') = '') then
  begin
    select coalesce(psa.map_lat,''), coalesce(psa.map_long,'') from glo_pessoas_fj psa
    where psa.codigo = new.pessoa_fj and psa.cnpj = new.cnpj
    into new.map_lat, new.map_long;
  end


  /*verificando se o atendimento esta sendo realizado pelo técnico titular ou substituto*/
  if ((coalesce(new.mecanico,0) <> coalesce(old.mecanico,0)) and coalesce(new.mecanico,0) <> 0)  then
  begin
    select coalesce(reg.tecnico,0) from glo_regioes reg
    inner join glo_pessoas_fj psa on (psa.regiao = reg.codigo and psa.cnpj = reg.cnpj)
    where psa.codigo = new.pessoa_fj
    into :tecnico;

    /*técnico da regiao do cliente não é o mesmo que esta tomando conta da OS*/
    if (:tecnico <> new.mecanico) then
      new.tipo_tecnico = 'S';
    else
      new.tipo_tecnico = 'T';
  end

  /*salvando o Codigo do contrato na ordem de serviço,
  processo tem por finalidade permitir a listagem de todos os atendimentos
  realizados para determinado contrato*/
  if (new.id_contrato is null) then
  begin
    select max(ct.codigo)
    from est_produtos prd
    inner join ofc_contratos_itens cti on (cti.cnpj = prd.cnpj and cti.cod_produto = prd.codigo)
    inner join ofc_contratos ct on (ct.cnpj = cti.cnpj and ct.codigo = cti.contrato)
    inner join glo_pessoas_fj psa on (psa.codigo = ct.cod_cliente and psa.cnpj = ct.cnpj)
    where ct.cnpj = new.cnpj and cti.cod_produto = new.produto
    and ct.cod_cliente = new.pessoa_fj and cti.ativo = 'S'
    into new.id_contrato;

    if (new.id_contrato is null) then
    begin
      select max(ct.codigo)
      from est_produtos prd
      inner join ofc_contratos_itens cti on (cti.cnpj = prd.cnpj and cti.cod_produto = prd.codigo)
      inner join ofc_contratos ct on (ct.cnpj = cti.cnpj and ct.codigo = cti.contrato)
      inner join glo_pessoas_fj psa on (psa.codigo = ct.cod_cliente and psa.cnpj = ct.cnpj)
      where ct.cnpj = new.cnpj and cti.cod_produto = new.produto
      and ct.cod_cliente = new.pessoa_fj and cti.ativo = 'N'
      into new.id_contrato;
    end
  end

  /*no caso do tipo de atendimento ser um retorno não se contabiliza rechamado*/
  select coalesce(tpa.retorno,'N') from ofc_tipo_atendimento tpa
  where tpa.codigo = new.id_tipo_atendimento
  into :retorno;

  if (:retorno = 'N') then
  begin
    /* ----------------------- BLOCO ATUALIZA CAMPO ID RECHAMADO -------------------------------------------------- */
    /* PEGA A DATA DA ULTIMA OS */
    select max(ofc.entrada) ofc_entrada
    from ofc_ordem_servico ofc
    where ofc.cnpj = new.cnpj and ofc.pessoa_fj = new.pessoa_fj and ofc.produto = new.produto
    and ofc.codigo <> new.codigo  and cast(ofc.entrada as date) <= cast(new.entrada as date)
    into :DT_ULT_OS;

    /* PEGA A QTDE DE DIAS QUE SERA CONSIDERADO RECHAMADO   */
    select max(coalesce(cti.dias_rechamado,15))
    from ofc_contratos_itens cti
    where cti.contrato = new.id_contrato and cti.cod_produto = new.produto
    into :DIAS_RECHAMADO;

    /* CASO A DATA DA NOVA OS FOR > QUE A DATA DA ULTIMA OS */
    new.os_rechamado = null;
    if (new.entrada >= :dt_ult_os) then
    begin
      dias = cast((cast(new.entrada as date)-:dt_ult_os) as integer);
      if( :dias <= :dias_rechamado )then
      begin
        select max(ofc.codigo)
        from ofc_ordem_servico ofc
        where ofc.cnpj = new.cnpj and ofc.pessoa_fj = new.pessoa_fj and ofc.produto = new.produto
        and ofc.codigo < new.codigo
        into :cod_os;

        new.os_rechamado = :cod_os;
      end
    end
  end
  /* ----------------------- BLOCO ATUALIZA CAMPO KM RODADO E HORAS TRABALHADAS -------------------------------------------------- */
  select sum(coalesce(ofc_i.km_rodado,0))/*, sum(coalesce(ofc_i.qtde_hora,0))*/
  from ofc_ordem_servico_intervalo ofc_i
  where (ofc_i.cnpj = new.cnpj)and(ofc_i.codigo = new.codigo)
  into new.km_rodado/*, new.horas_trabalhadas*/;
END
^

/* Trigger: OFC_ORDEM_SERVICO_INTERVALO_AU0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_INTERVALO_AU0 FOR OFC_ORDEM_SERVICO_INTERVALO
ACTIVE AFTER INSERT OR UPDATE POSITION 0
as
declare variable km_rodado integer;
declare variable horas_trab float;
declare variable custo_os float;
begin

  select sum(coalesce(ofc_i.km_rodado,0)),sum(coalesce(ofc_i.custo_intervalo,0)) , sum(coalesce(ofc_i.qtde_hora,0))
  from ofc_ordem_servico_intervalo ofc_i
  where (ofc_i.cnpj = new.cnpj) and (ofc_i.codigo = new.codigo)
  into :km_rodado, :custo_os, :horas_trab;

  update ofc_ordem_servico ofc set ofc.km_rodado = :km_rodado, ofc.custo_os = :custo_os, ofc.horas_trabalhadas = :horas_trab
  where ofc.cnpj = new.cnpj and ofc.codigo = new.codigo;
END
^

/* Trigger: OFC_ORDEM_SERVICO_INTERVALO_BU0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_INTERVALO_BU0 FOR OFC_ORDEM_SERVICO_INTERVALO
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
begin
  if (new.tipo is null) then
    new.tipo = 'M';/*movimento*/

  select coalesce(t.custo_hora,0) from ofc_mecanicos t
  where t.cnpj = new.cnpj and t.codigo = new.cod_tecnico
  into new.custo_hora;

  new.custo_intervalo = (new.custo_hora * new.qtde_hora);
end
^

/* Trigger: OFC_ORDEM_SERVICO_ORC_BI0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_ORC_BI0 FOR OFC_ORDEM_SERVICO_ORC
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.NOME IS NULL )
     THEN BEGIN
          SELECT substring(NOME_RAZAO from 1 for 50) FROM GLO_PESSOAS_FJ
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.PESSOA_FJ
          INTO :NOME ;

          NEW.NOME = :NOME;
     END

     IF ( NEW.NOME_FORMA IS NULL )
     THEN BEGIN
          SELECT substring(NOME from 1 for 50) FROM FIN_FORMAS_PAGTO
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.FORMA_PAGTO
          INTO :NOME ;

          NEW.NOME_FORMA = :NOME;
     END

     IF ( NEW.NOME_MECANICO IS NULL )
     THEN BEGIN
          SELECT substring(NOME from 1 for 50) FROM OFC_MECANICOS
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MECANICO
          INTO :NOME ;

          NEW.NOME_MECANICO = NOME;
     END

     IF ( NEW.NOME_MOTOR IS NULL )
     THEN BEGIN
          SELECT substring(NOME from 1 for 50) FROM OFC_MOTORES
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.MOTOR
          INTO :NOME ;

          NEW.NOME_MOTOR = :NOME;
     END
END
^

/* Trigger: OFC_ORDEM_SERVICO_SERVICO_BI0 */
CREATE TRIGGER OFC_ORDEM_SERVICO_SERVICO_BI0 FOR OFC_ORDEM_SERVICO_SERVICO
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.NOME IS NULL )
     THEN BEGIN
          SELECT NOME FROM OFC_SERVICOS
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.SERVICO
          INTO :NOME ;

          NEW.NOME = :NOME ;
     END
END
^

/* Trigger: OFC_ORDEM_SERV_SERVICO_ORC_BI0 */
CREATE TRIGGER OFC_ORDEM_SERV_SERVICO_ORC_BI0 FOR OFC_ORDEM_SERVICO_SERVICO_ORC
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE NOME VARCHAR(50);
begin
     IF ( NEW.NOME IS NULL )
     THEN BEGIN
          SELECT NOME FROM OFC_SERVICOS
          WHERE CNPJ = NEW.CNPJ AND CODIGO = NEW.SERVICO
          INTO :NOME ;

          NEW.NOME = :NOME ;
     END
END
^

/* Trigger: OFC_O_S_INTERVALO_EMAIL_BI */
CREATE TRIGGER OFC_O_S_INTERVALO_EMAIL_BI FOR OFC_O_S_INTERVALO_EMAIL
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  if (new.tipo is null) then
    new.tipo = 'M';

  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_O_S_INTERVALO_EMAIL_ID,1);
END
^

/* Trigger: OFC_PENDENCIA_AI0 */
CREATE TRIGGER OFC_PENDENCIA_AI0 FOR OFC_PENDENCIA
ACTIVE AFTER INSERT POSITION 0
AS
declare variable remetente varchar(10);
declare variable destinatario varchar(10);
declare variable assunto varchar(50);
declare variable mensagem varchar(120);
begin
  select usr1.login from sis_usuarios usr1
  where usr1.codigo = new.usr_responsavel
  into :remetente;

  select usr2.login from sis_usuarios usr2
  where usr2.codigo = new.usr_estoque
  into :destinatario;

  assunto = 'P. de Estoque: Nº '||new.codigo||' ('||new.produto||')';
                                                                                                 /* */
  mensagem = 'P. de Estoque: Produto - '||new.produto||' Qtde: '||cast (new.qtde_pendente as varchar(15));
  insert into sis_mensagens (REMETENTE, DESTINATARIO,RESERVADO, ASSUNTO,
                             MENSAGEM, DT_ENVIO, DT_AVISO, DT_VALIDADE)
                             values (:remetente, :destinatario, 'S', :assunto,
                            :mensagem, cast('today' as date), cast('today' as date),'01.01.2015');
END
^

/* Trigger: OFC_PENDENCIA_AU0 */
CREATE TRIGGER OFC_PENDENCIA_AU0 FOR OFC_PENDENCIA
ACTIVE AFTER UPDATE POSITION 0
AS
declare variable remetente varchar(10);
declare variable destinatario varchar(10);
declare variable assunto varchar(50);
declare variable mensagem varchar(120);
begin
  if (coalesce(new.qtde_creditada,0) <> coalesce(old.qtde_creditada,0)) then
  begin
    select usr1.login from sis_usuarios usr1
    where usr1.codigo = new.usr_responsavel
    into :destinatario;

    select usr2.login from sis_usuarios usr2
    where usr2.codigo = new.usr_estoque
    into :remetente;

    assunto = 'P. de Estoque: Nº '||new.codigo||' ('||new.produto||')';
                                                                                                 /* */
    mensagem = 'P. de Estoque: Produto - '||new.produto||' Qtde: '||cast (new.qtde_pendente as varchar(15))||' (Estoque Creditado)';
    insert into sis_mensagens (REMETENTE, DESTINATARIO,RESERVADO, ASSUNTO,
                               MENSAGEM, DT_ENVIO, DT_AVISO, DT_VALIDADE)
                               values (:remetente, :destinatario, 'S', :assunto,
                              :mensagem, cast('today' as date), cast('today' as date),'01.01.2015');

  end
END
^

/* Trigger: OFC_PENDENCIA_BI */
CREATE TRIGGER OFC_PENDENCIA_BI FOR OFC_PENDENCIA
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_PENDENCIA_ID,1);
END
^

/* Trigger: OFC_STATUS_BI */
CREATE TRIGGER OFC_STATUS_BI FOR OFC_STATUS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_STATUS_ID,1);
END
^

/* Trigger: OFC_TIPO_ATENDIMENTO_BI */
CREATE TRIGGER OFC_TIPO_ATENDIMENTO_BI FOR OFC_TIPO_ATENDIMENTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_TIPO_ATENDIMENTO_ID,1);
END
^

/* Trigger: OFC_TIPO_MOVTO_BI */
CREATE TRIGGER OFC_TIPO_MOVTO_BI FOR OFC_TIPO_MOVTO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_OFC_TIPO_MOVTO_ID,1);
END
^

/* Trigger: SIS_CONFIG_REL_BI */
CREATE TRIGGER SIS_CONFIG_REL_BI FOR SIS_CONFIG_REL
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.ID IS NULL) THEN
    NEW.ID = GEN_ID(GEN_SIS_CONFIG_REL_ID,1);
END
^

/* Trigger: SIS_EMPRESAS_AI */
CREATE TRIGGER SIS_EMPRESAS_AI FOR SIS_EMPRESAS
ACTIVE AFTER INSERT POSITION 0
AS
DECLARE VARIABLE A INTEGER;
BEGIN
  A = 1;

  /*  */
  INSERT INTO EST_MARCAS
  (CNPJ, CODIGO, NOME, SELECIONADO)
  VALUES (NEW.CNPJ, 0, '< NAO ESPECIFICADO >','N');

  /*  */
  INSERT INTO EST_GRUPOS
  (CNPJ, CODIGO, NOME, BASE, MINIMO, MAXIMO, SELECIONADO)
  VALUES
  (NEW.CNPJ, 0, '< NAO ESPECIFICADO >', 0, 0, 0, 'N');
  /*  */

/*  INSERT INTO EST_SUBGRUPOS VALUES (NEW.CNPJ, 0, 0, '< NAO ESPECIFICADO >', 0, 'N',0,0,0,0,0,0);

  /*  */
  INSERT INTO GLO_ATIVIDADES
  (CNPJ, CODIGO, NOME)
  VALUES (NEW.CNPJ, 0, '< NAO ESPECIFICADO >');

  /*  */
  INSERT INTO GLO_LOGRADOUROS
  (CNPJ, CODIGO, NOME)
  VALUES (NEW.CNPJ, 0, '< NAO ESPECIFICADO >');

  /*  */
  INSERT INTO GLO_BAIRROS
  (CNPJ, CODIGO, NOME)
  VALUES (NEW.CNPJ, 0, '< NAO ESPECIFICADO >');

  /* DEVE-SE INSERIR TODOS OS ESTADOS */
  INSERT INTO GLO_ESTADOS
  (CNPJ, SIGLA, NOME,MASCARA_IE)
  VALUES (NEW.CNPJ, 'MS', 'MATO GROSSO DO SUL','');

  /*  */
  INSERT INTO GLO_CIDADES
  (CNPJ, CODIGO, NOME, UF)
  VALUES (NEW.CNPJ, 0, '< NAO ESPECIFICADO >', 'MS');
  /*  */
END
^

/* Trigger: SIS_LOG_TRANSACOES_BI0 */
CREATE TRIGGER SIS_LOG_TRANSACOES_BI0 FOR SIS_LOG_TRANSACOES
ACTIVE BEFORE INSERT POSITION 0
AS
begin
     IF ( NEW.DATA IS NULL )
     THEN
       NEW.DATA = cast('TODAY' as date);

     IF ( NEW.HORA IS NULL )
     THEN
       NEW.HORA = 'NOW';
END
^

/* Trigger: SIS_MENSAGENS_AI */
CREATE TRIGGER SIS_MENSAGENS_AI FOR SIS_MENSAGENS
ACTIVE AFTER INSERT POSITION 0
AS
BEGIN
     POST_EVENT 'NovaMensagem_' || new.destinatario ;
END
^

/* Trigger: SIS_MENSAGENS_BD */
CREATE TRIGGER SIS_MENSAGENS_BD FOR SIS_MENSAGENS
ACTIVE BEFORE DELETE POSITION 1
AS
BEGIN /*
     POST_EVENT 'ExcluirMensagem_' || Sis_Mensagens.destinatario ;*/

END
^

/* Trigger: SIS_MENSAGENS_BI */
CREATE TRIGGER SIS_MENSAGENS_BI FOR SIS_MENSAGENS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  /*  */
  IF ((coalesce(NEW.CODIGO,0) = 0) AND (coalesce(NEW.ANO,0) = 0)) THEN
     SELECT CODIGO, ANO
     FROM GERAR_CODIGO_MENSAGEM(1)
     INTO NEW.CODIGO, NEW.ANO;
END
^

/* Trigger: SIS_MODULOS_AI */
CREATE TRIGGER SIS_MODULOS_AI FOR SIS_MODULOS
ACTIVE AFTER INSERT POSITION 0
as
declare variable perfil integer;
begin
    for select p.codigo from sis_perfil p
        into :perfil
    do
    begin
        /*perfil supervisor*/
        if (:perfil = 1) then
        begin
          if (not exists ( select perfil from sis_direitos_perfil where perfil = :perfil and Modulo = new.codigo )) then
             insert into sis_direitos_perfil(perfil,modulo,direito) values (:perfil, new.codigo, new.actions);
        end
        else /*outro perfil*/
        begin
          if (not exists ( select perfil from sis_direitos_perfil where perfil = :perfil and modulo = new.codigo )) then
              insert into sis_direitos_perfil(perfil,modulo,direito) values (:perfil, new.codigo, '');
        end
    end
END
^

/* Trigger: SIS_MODULOS_BD */
CREATE TRIGGER SIS_MODULOS_BD FOR SIS_MODULOS
ACTIVE BEFORE DELETE POSITION 0
AS
BEGIN
  /* Trigger body */
  delete from SIS_DIREITOS_PERFIL
  where MODULO = OLD.CODIGO;
END
^

/* Trigger: SIS_PERFIL_AI */
CREATE TRIGGER SIS_PERFIL_AI FOR SIS_PERFIL
ACTIVE AFTER INSERT POSITION 0
AS
DECLARE VARIABLE modulo INTEGER;
BEGIN
      FOR SELECT codigo FROM sis_modulos INTO :modulo DO
      BEGIN
           IF (NOT EXISTS ( SELECT modulo FROM SIS_DIREITOS_PERFIL
           WHERE modulo = :modulo AND perfil = NEW.CODIGO ))
           THEN BEGIN
                 INSERT INTO sis_direitos_perfil
                 VALUES (NEW.codigo, :modulo, '');
           END
      END
END
^

/* Trigger: SIS_PERFIL_BD */
CREATE TRIGGER SIS_PERFIL_BD FOR SIS_PERFIL
ACTIVE BEFORE DELETE POSITION 0
AS
BEGIN
     /* Trigger body */
     delete from sis_direitos_perfil
     where perfil = old.codigo;
END
^

/* Trigger: SIS_RELEASE_BI */
CREATE TRIGGER SIS_RELEASE_BI FOR SIS_RELEASE
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_SIS_RELEASE_ID,1);

  if (new.tipo is null) then
    new.tipo = 1;
/*   IF (NEW.COD_PAI IS NULL) THEN
    NEW.COD_PAI = 1;


  new.resumo = substring(new.descricao from 1 for 400)||'[ '||new.ticket||' ]';*/
END
^

/* Trigger: SIS_SERIENF_BI0 */
CREATE TRIGGER SIS_SERIENF_BI0 FOR SIS_SERIENF
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.indice = new.cnpj||new.serie;
end
^

/* Trigger: SIS_SERIENF_BU0 */
CREATE TRIGGER SIS_SERIENF_BU0 FOR SIS_SERIENF
ACTIVE BEFORE UPDATE POSITION 0
AS
begin
  new.indice = new.cnpj||new.serie;
end
^

/* Trigger: TBL_TESTE_BI */
CREATE TRIGGER TBL_TESTE_BI FOR TBL_TESTE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_TBL_TESTE_ID,1);
END
^

/* Trigger: TEMP_CUSTO_MEDIO_BI */
CREATE TRIGGER TEMP_CUSTO_MEDIO_BI FOR TEMP_CUSTO_MEDIO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO IS NULL) THEN
    NEW.CODIGO = GEN_ID(GEN_TEMP_CUSTO_MEDIO_ID,1);
END
^

SET TERM ; ^



/******************************************************************************/
/****                          Stored Procedures                           ****/
/******************************************************************************/


SET TERM ^ ;

ALTER PROCEDURE ACERTA_FIN_CHEQUE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    BANCO CHAR(3),
    CHEQUE VARCHAR(6),
    DATA_ACERTO TIMESTAMP,
    JUROS NUMERIC(18,4))
AS
BEGIN
     UPDATE FIN_CHEQUES
     SET DATA_ACERTO = :DATA_ACERTO,
     TIPO = 'NO',
     JUROS = :JUROS
     WHERE CNPJ   = :CNPJ
     AND   CONTA  = :CONTA
     AND   BANCO  = :BANCO
     AND   CHEQUE = :CHEQUE ;
END
^

ALTER PROCEDURE ACOMPANHAMENTO_VENDAS (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CAIXA TIMESTAMP,
    VALOR FLOAT)
AS
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
begin
     /* EXTRAI DIA, MES E ANO*/
     MES = EXTRACT ( MONTH FROM :DATA );
     ANO = EXTRACT ( YEAR  FROM :DATA );

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO */
     FOR SELECT SUM ( VENDAS_VISTA + VENDAS_PRAZO ), DATA
     FROM FAT_CAIXAS
     WHERE EXTRACT  (MONTH FROM DATA) = :MES
     AND EXTRACT  (YEAR  FROM DATA) = :ANO
     AND CNPJ = :CNPJ
     GROUP BY DATA
     INTO :VALOR, :CAIXA
     DO BEGIN
        IF ( VALOR IS NULL )
        THEN BEGIN
             VALOR = 0;
        END

        suspend;
     END
END
^

ALTER PROCEDURE ADM_CX_VER_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    NOME VARCHAR(50))
AS
DECLARE VARIABLE EXIBE_ACERTO CHAR(1);
DECLARE VARIABLE ACT_TIPO_BAIXA CHAR(1);
BEGIN
    select coalesce(emp.exibe_acerto_contas,'N')
    from sis_empresas emp
    where emp.cnpj = :cnpj
    into :exibe_acerto;

     for select codigo, pessoa_fj,
            dt_vencto,docto,
            valor, vlr_baixa, vlr_parcial,
            juros, descontos, coalesce(act_tipo_baixa,'1')
     from fin_baixas_pagar p
     where (cnpj = :cnpj and dt_baixa = :data and usuario = :usuario
     and turno = :trn and conta = :conta)
     into
            :codigo, :pessoa_fj,
            :dt_vencto,:docto,
            :valor, :vlr_baixa, :vlr_parcial, :juros, :descontos, :act_tipo_baixa
     do begin
        /* pessoas fj */
        select nome_razao
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome;

        nome = cast (:pessoa_fj as varchar(12))||'-'||substring(:nome from 1 for 38);

        /*Consulta utilizada para listagem no caixa, em nenhuma destas condições os registros de baixa deverão ser listados
        3 - Aviso bancario e 4 - renegociacao*/
        if ((:act_tipo_baixa <> '2') and (:act_tipo_baixa <> '3') and (:act_tipo_baixa <> '4')) then
          suspend;

     end
END
^

ALTER PROCEDURE ADM_CX_VER_FAT_TROCAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CLIENTE VARCHAR(30),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    PRAZO NUMERIC(18,4),
    TTL_ENTRADA NUMERIC(18,4),
    TTL_SAIDA NUMERIC(18,4),
    TTL_LIQUIDO NUMERIC(18,4))
AS
DECLARE VARIABLE DATA_LANCTO_CH DATE;
DECLARE VARIABLE DATA_PRE_CH DATE;
DECLARE VARIABLE DATA_REEMB_CRT DATE;
DECLARE VARIABLE DATA_LANCTO_CRT DATE;
DECLARE VARIABLE CARTAO_VISTA CHAR(1);
DECLARE VARIABLE CHEQUE_VISTA CHAR(1);
DECLARE VARIABLE CRT_INFLUENCIA CHAR(1);
DECLARE VARIABLE CH_INFLUENCIA CHAR(1);
BEGIN
  select emp.crt_influencia_venda, emp.ch_influencia_venda
  from sis_empresas emp
  where emp.cnpj = :cnpj
  into :ch_influencia, :crt_influencia;

  /* procedimento inspirado no Ver_Fat_Trocas , esse foi isolado para somente
  ser utilizado na listagem do caixa
  */
  for select pessoa_fj, codigo, fechado, vendedor, (coalesce(total,0) + coalesce(desc_acresc,0)),
      (coalesce(total_2,0) + coalesce(desc_acresc_2,0)), cliente, enviada_cx, entrada, dinheiro,
      cheque, cartao, ticket
  from fat_trocas trc
     where cnpj = :cnpj and trc.usuario = :usuario and trc.data_caixa = :data
     and trc.turno = :turno and trc.fechado = 'S' and trc.enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
     and ((trc.cancelada <> 'S') or (trc.cancelada is null)) /*e que não estiverem canceladas*/
  into :pessoa_fj, :codigo,:fechado, :vendedor,
       :ttl_entrada,:ttl_saida,:cliente, :enviada_cx, :
       entrada, :dinheiro,:cheque, :cartao, :ticket
  do
  begin
     cheque_vista = 'S';
     cartao_vista = 'S';
     vista = 0;
     prazo = 0;

     if ((:cheque > 0) and (:ch_influencia = 'S')) then
     begin
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
            where ch.troca = :codigo and ch.cnpj = :cnpj
            into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
     end

     if (:cheque_vista = 'N') then
       vista = :vista + :dinheiro + :ticket;
     else
       vista = :vista + :dinheiro + :cheque + :ticket;


     /*verificando se o cartão é prazo ou a vista*/
     if ((:cartao > 0) and (:crt_influencia = 'S')) then
     begin
        for select crt.data, crt.reembolso from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
            cartao_vista = 'N';
        end
     end

     /*se for a vista o cartao entao acrescendo o valor dele no total a vista
     pois ja estarao: Ticket + dinheiro e talvez o chque*/
     if (cartao_vista = 'S') then
       vista = :vista + :cartao;

     /*diferença do saiu e do que entrou(devolvido)*/
     ttl_liquido = (:ttl_saida - :ttl_entrada);
     /*é o a vista menos o total*/
     prazo = :ttl_liquido - :vista;

     select nome_razao from glo_pessoas_fj
     where cnpj = :cnpj and codigo = :pessoa_fj
     plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
     order by cnpj, codigo
     into :nome_razao ;

     select nome from fat_vendedor
     where cnpj = :cnpj and codigo = :vendedor
     into :nome_vendedor ;

     suspend;
   end
END
^

ALTER PROCEDURE ADM_CX_VER_FAT_VENDAS_CAIXA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    VALE_TROCO NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    NOME VARCHAR(50),
    DOCTO VARCHAR(20),
    TIPO CHAR(6),
    TOTAL_BRUTO NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    NOME_VENDEDOR VARCHAR(50))
AS
DECLARE VARIABLE VISTA NUMERIC(18,4);
DECLARE VARIABLE PRAZO NUMERIC(18,4);
DECLARE VARIABLE TTLPRAZO NUMERIC(18,4);
DECLARE VARIABLE VLRCRT NUMERIC(18,4);
DECLARE VARIABLE VLRCH NUMERIC(18,4);
DECLARE VARIABLE MOV_CAIXA CHAR(1);
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE TIPO_VENDA CHAR(3);
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE CARTAO_VISTA INTEGER;
DECLARE VARIABLE DATA_LANCTO_CRT DATE;
DECLARE VARIABLE DATA_REEMB_CRT DATE;
DECLARE VARIABLE DATA_LANCTO_CH DATE;
DECLARE VARIABLE DATA_PRE_CH DATE;
DECLARE VARIABLE CARTAO_VISTA_AUX CHAR(1);
DECLARE VARIABLE CHEQUE_VISTA CHAR(1);
DECLARE VARIABLE CONT_CH INTEGER;
DECLARE VARIABLE CONT_CRT INTEGER;
DECLARE VARIABLE TRC_VALE CHAR(1); /* VAI DIZER SE TEM VALE TROCO OU NÃO */
DECLARE VARIABLE CRT_INFLUENCIA CHAR(1);
DECLARE VARIABLE CH_INFLUENCIA CHAR(1);
DECLARE VARIABLE A_VISTA CHAR(1);
DECLARE VARIABLE DESCTO_SERVICO NUMERIC(18,4);
BEGIN
  select emp.crt_influencia_venda, emp.ch_influencia_venda
  from sis_empresas emp
  where emp.cnpj = :cnpj
  into :crt_influencia, :ch_influencia;


  /*Procedimento derivado do VER_FAT_VENDAS_CAIXA, e isolado para ser utilizado somente
  na listagem de Caixa (F5)*/
  for select vd.codigo, historico, pessoa_fj, vendedor, natureza,
  coalesce(desc_acres,0),coalesce(DESCTO_SERVICO,0), coalesce(entrada,0), coalesce(dinheiro,0),
  coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0),
  coalesce(total,0), tipo_venda, coalesce(troco,0), coalesce(vale_troco,''),
  coalesce(vd.num_nf,0), coalesce(vd.num_cupom,0), vd.forma_pgto
  from fat_vendas vd/*pego as vendas que estemjam na data de caixa */
  inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
  where vd.cnpj = :cnpj and usuario = :usuario and data_caixa = :data
  and turno = :turno and fechada = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  and nat.computa_venda = 'S' and nat.es = 'S'
  into :codigo, :historico, :pessoa_fj, :vendedor, :natureza,
       :desc_acres, :descto_servico, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :tipo_venda, :troco,:trc_vale, :num_nf, :num_cupom, :forma_pagto
  do
  begin
    if (:codigo = 81316) then
     codigo = :codigo;

    select pgt.avista from fin_formas_pagto pgt
    where pgt.codigo = :forma_pagto and pgt.cnpj = :cnpj
    into :a_vista;

    select vdd.nome from fat_vendedor vdd
    where vdd.cnpj = :cnpj and vdd.codigo = :vendedor
    into :nome_vendedor;
    /*setando o nº do documento cupom fiscal e Nota*/
    docto = '';

    if (:num_nf <> 0) then
      docto = ('NF-'|| cast (:num_nf as varchar(12)));
    else if (:num_cupom <> 0) then
      docto = ('CP-'|| cast (:num_cupom as varchar(15)));

    /*identeficando se é uma venda a vista ou a prazo, codigo inspirado na aplicação
    VendasAVISTA.VALUE  := VendasDINHEIRO.VALUE + VendasCARTAO.VALUE + VendasCHEQUE.VALUE +
    VendasTICKET.VALUE + VendasTROCO.VALUE ;
    VendasAPRAZO.Value  := TOTAL - VendasAVISTA.VALUE ;
    ---------------------------------------------------
    IF (( ARREDONDA(DmCaixa.VendasAVISTA.Value,2) > 0 ) AND ( DmCaixa.VendasTIPO_VENDA.Value <> 'FFT' ))
    OR ( (ARREDONDA(DmCaixa.VendasAVISTA.Value,2) = 0 ) AND (ARREDONDA(DmCaixa.VendasAPRAZO.Value,2) = 0 ))
    */
    if (:trc_vale = 'S') then
    begin
      vale_troco = :troco;
      troco = 0;
    end
    else
      vale_troco = 0;

    total_bruto = (:total + :desc_acres - :descto_servico);
    vista = :dinheiro + :cartao + :cheque + :ticket + :troco + :vale_troco;

    /*por conta do faturamento no caixa*/
    if ((:a_vista = 'S')) then
    begin
      vista = (:total + :desc_acres - :descto_servico);
      dinheiro = vista;
    end

    if (:vista = (:total + :desc_acres - :descto_servico)) then
      prazo = 0;
    else
      prazo = (:total + :desc_acres - :descto_servico) - :vista; /*desconto acrescimo ja vem negativo se for desconto por isso somo*/

    ttlprazo = 0;
    /*arredondamento*/
    if (:prazo <= 0.03) then
     prazo = 0;

    if (((:vista > 0) and (:tipo_venda <> 'FFT') and (:prazo <= 0)) or ((:vista=0) and (:prazo = 0))) then
      tipo = 'Vista';
    else
    begin
      tipo = 'Prazo';
      total_bruto = :total_bruto - :entrada;
    end


    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if ((:cartao > 0) and (:crt_influencia = 'S'))then
      begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso, crt.valor from fin_movimento_cartao crt
          where crt.venda = :codigo and crt.cnpj = :cnpj
          into :data_lancto_crt, :data_reemb_crt, :vlrcrt
          do
          begin
            if (:data_reemb_crt > :data_lancto_crt) then
            begin
              cartao_vista_aux = 'N';
              ttlprazo = ttlprazo + :vlrcrt;
            end
          end
      end

      if ((:cheque > 0) and (:ch_influencia = 'S')) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        for select ch.data_caixa, ch.pre_date, ch.valor from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :vlrch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            cheque_vista = 'N';
            ttlprazo = ttlprazo + :vlrch;
          end
        end
      end

      /*se o status da venda foi modificado para a prazo por conta dos docs,
      pré-datados nós devemos considerar o valor em dinheiro como uma
      entrada do crediário*/
      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
      begin
        tipo = 'Prazo';
        entrada = :vista - :ttlprazo;
        total = :total - :entrada;
      end
    end

    select mov_caixa
    from est_natureza
    where cnpj = :cnpj and codigo = :natureza
    into :mov_caixa ;

    select nome_razao from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :nome ;

    suspend;
  end
END
^

ALTER PROCEDURE AGENDAR_COBRANCAS_AGRUPADA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    COBRAR_EM DATE,
    COBRADOR INTEGER,
    DATA_SERVIDOR DATE,
    MOTIVO INTEGER,
    HISTORICO VARCHAR(100))
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE RECEBER INTEGER;
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE ANO INTEGER;
BEGIN
     FOR SELECT PESSOA_FJ, RECEBER, ORIGEM, ANO
     FROM FIN_COBRANCAS
     WHERE CNPJ = :CNPJ AND SELECIONADO = 'S'
     INTO :PESSOA_FJ, :RECEBER, :ORIGEM, :ANO
     DO BEGIN
        EXECUTE PROCEDURE AGENDAR_COBRANCAS_PESSOA
        ( :CNPJ, :INI, :FIM, :PESSOA_FJ,
          :HISTORICO, :MOTIVO, :DATA_SERVIDOR, :COBRAR_EM,
          :COBRADOR, :RECEBER, :ORIGEM, :ANO  );

        SUSPEND;
     END
END
^

ALTER PROCEDURE AGENDAR_COBRANCAS_PESSOA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    PESSOA INTEGER,
    HISTORICO VARCHAR(100),
    MOTIVO INTEGER,
    DATA_SERVIDOR DATE,
    COBRAR DATE,
    COBRADOR INTEGER,
    RECEBER INTEGER,
    ORIGEM CHAR(3),
    ANO INTEGER)
AS
DECLARE VARIABLE COBRAR_EM DATE;
BEGIN
     IF ( ORIGEM = 'REC' )
     THEN BEGIN
          FOR SELECT CODIGO
          FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
          AND FATURA IS NULL AND PESSOA_FJ = :PESSOA AND ( (CODIGO <> :RECEBER) AND (ANO <> :ANO))
          INTO :RECEBER
          DO BEGIN
             /* AGENDAMENTO DE COBRANCAS */
             SELECT MAX(COBRAR_EM)
             FROM FIN_COBRANCAS
             WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND RECEBER = :RECEBER
             AND PAGO_EM IS NULL AND ORIGEM = 'REC'
             INTO :COBRAR_EM ;

             IF (( COBRAR_EM <= :DATA_SERVIDOR  ) OR ( COBRAR_EM IS NULL ))
             THEN BEGIN
                  /* VERIFICA SE EXISTE AGENDAMENTO */
                  IF
                  (NOT(EXISTS (
                    SELECT CNPJ FROM FIN_COBRANCAS
                    WHERE (CNPJ = :CNPJ) AND  (PESSOA_FJ = :PESSOA)
                    AND ( DATA_COBRANCA = :DATA_SERVIDOR ) AND ( RECEBER = :RECEBER )
                    AND ( ORIGEM = 'REC' )
                  )
                  )
                  )
                  THEN BEGIN
                       /* MARCAR AGENDAMENTO AUTOMATICO */
                      INSERT INTO FIN_COBRANCAS
                      (
                      CNPJ,
                      PESSOA_FJ,
                      DATA_COBRANCA,
                      MOTIVO,
                      COBRAR_EM,
                      HISTORICO,
                      COBRADOR,
                      RECEBER,
                      PAGO_EM,
                      ANO
                      )
                      VALUES
                      (
                      :CNPJ,
                      :PESSOA,
                      :DATA_SERVIDOR,
                      :MOTIVO,
                      :COBRAR,
                      :HISTORICO,
                      :COBRADOR,
                      :RECEBER,
                      NULL,
                      :ANO

                      );
                  END
             END
          END

          FOR SELECT CODIGO
          FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
          AND FATURA IS NULL AND PESSOA_FJ = :PESSOA AND ((CODIGO <> :RECEBER) AND (ANO <> :ANO))
          INTO :RECEBER
          DO BEGIN
             /* AGENDAMENTO DE COBRANCAS */
             SELECT MAX(COBRAR_EM)
             FROM FIN_COBRANCAS
             WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND RECEBER = :RECEBER
             AND PAGO_EM IS NULL AND ORIGEM = 'REC'
             INTO :COBRAR_EM ;

             IF (( COBRAR_EM <= :DATA_SERVIDOR  ) OR ( COBRAR_EM IS NULL ))
             THEN BEGIN
                  /* VERIFICA SE EXISTE AGENDAMENTO */
                  IF( NOT( EXISTS (
                  SELECT CNPJ FROM FIN_COBRANCAS
                  WHERE (CNPJ = :CNPJ) AND  (PESSOA_FJ = :PESSOA)
                  AND ( DATA_COBRANCA = :DATA_SERVIDOR ) AND ( RECEBER = :RECEBER )
                  AND ( ORIGEM = 'REC' )
                  )
                  )
                  )
                  THEN BEGIN
                       /* MARCAR AGENDAMENTO AUTOMATICO */
                       INSERT INTO FIN_COBRANCAS
                       (
                       CNPJ,
                       PESSOA_FJ,
                       DATA_COBRANCA,
                       MOTIVO,
                       COBRAR_EM,
                       HISTORICO,
                       COBRADOR,
                       RECEBER,
                       PAGO_EM,
                       ANO
                       )
                       VALUES
                       (
                       :CNPJ,
                       :PESSOA,
                       :DATA_SERVIDOR,
                       :MOTIVO,
                       :COBRAR,
                       :HISTORICO,
                       :COBRADOR,
                       :RECEBER,
                       NULL,
                       :ANO
                       );
                  END
             END
         END
     END

     IF ( ORIGEM = 'FAT' )
     THEN BEGIN
          FOR SELECT CODIGO
          FROM FIN_FATURAS
          WHERE CNPJ = :CNPJ AND VENCIMENTO >= :INI AND VENCIMENTO <= :FIM
          AND PESSOA_FJ = :PESSOA AND CODIGO <> :RECEBER
          INTO :RECEBER
          DO BEGIN
             /* AGENDAMENTO DE COBRANCAS */
             SELECT MAX(COBRAR_EM)
             FROM FIN_COBRANCAS
             WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND RECEBER = :RECEBER
             AND PAGO_EM IS NULL AND ORIGEM = 'FAT'
             INTO :COBRAR_EM ;

             IF (( COBRAR_EM <= :DATA_SERVIDOR  ) OR ( COBRAR_EM IS NULL ))
             THEN BEGIN
                  /* VERIFICA SE EXISTE AGENDAMENTO */
                  IF
                  (NOT(EXISTS (
                    SELECT CNPJ FROM FIN_COBRANCAS
                    WHERE (CNPJ = :CNPJ) AND  (PESSOA_FJ = :PESSOA)
                    AND ( DATA_COBRANCA = :DATA_SERVIDOR ) AND ( RECEBER = :RECEBER )
                    AND ( ORIGEM = 'FAT' )
                  )
                  )
                  )
                  THEN BEGIN
                       /* MARCAR AGENDAMENTO AUTOMATICO */
                      INSERT INTO FIN_COBRANCAS
                      (
                      CNPJ,
                      PESSOA_FJ,
                      DATA_COBRANCA,
                      MOTIVO,
                      COBRAR_EM,
                      HISTORICO,
                      COBRADOR,
                      RECEBER,
                      PAGO_EM,
                      ANO
                      )
                      VALUES
                      (
                      :CNPJ,
                      :PESSOA,
                      :DATA_SERVIDOR,
                      :MOTIVO,
                      :COBRAR,
                      :HISTORICO,
                      :COBRADOR,
                      :RECEBER,
                      NULL,
                      0
                      );
                  END
             END
          END

          FOR SELECT CODIGO
          FROM FIN_FATURAS
          WHERE CNPJ = :CNPJ AND VENCIMENTO >= :INI AND VENCIMENTO <= :FIM
          AND PESSOA_FJ = :PESSOA AND CODIGO <> :RECEBER
          INTO :RECEBER
          DO BEGIN
             /* AGENDAMENTO DE COBRANCAS */
             SELECT MAX(COBRAR_EM)
             FROM FIN_COBRANCAS
             WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND RECEBER = :RECEBER
             AND PAGO_EM IS NULL AND ORIGEM = 'FAT'
             INTO :COBRAR_EM ;

             IF (( COBRAR_EM <= :DATA_SERVIDOR  ) OR ( COBRAR_EM IS NULL ))
             THEN BEGIN
                  /* VERIFICA SE EXISTE AGENDAMENTO */
                  IF( NOT( EXISTS (
                  SELECT CNPJ FROM FIN_COBRANCAS
                  WHERE (CNPJ = :CNPJ) AND  (PESSOA_FJ = :PESSOA)
                  AND ( DATA_COBRANCA = :DATA_SERVIDOR ) AND ( RECEBER = :RECEBER )
                  AND ( ORIGEM = 'FAT' )
                  )
                  )
                  )
                  THEN BEGIN
                       /* MARCAR AGENDAMENTO AUTOMATICO */
                       INSERT INTO FIN_COBRANCAS
                       (
                       CNPJ,
                       PESSOA_FJ,
                       DATA_COBRANCA,
                       MOTIVO,
                       COBRAR_EM,
                       HISTORICO,
                       COBRADOR,
                       RECEBER,
                       PAGO_EM,
                       ANO
                       )
                       VALUES
                       (
                       :CNPJ,
                       :PESSOA,
                       :DATA_SERVIDOR,
                       :MOTIVO,
                       :COBRAR,
                       :HISTORICO,
                       :COBRADOR,
                       :RECEBER,
                       NULL,
                       :ANO
                       );
                  END
             END
         END
     END
END
^

ALTER PROCEDURE AGRUPA_FATURAS (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
RETURNS (
    MENSAGEM VARCHAR(50))
AS
DECLARE VARIABLE CLIENTEOR INTEGER;
DECLARE VARIABLE CLIENTEDEST INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE SOMA NUMERIC(18,4);
begin
     MENSAGEM = '' ;
     SOMA     = 0  ;

     SELECT PESSOA_FJ FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM
     INTO :CLIENTEOR ;

     SELECT PESSOA_FJ FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM
     INTO :CLIENTEDEST ;

     IF (CLIENTEOR IS NULL)
     THEN BEGIN
          MENSAGEM = 'Nota de Origem Inexistente';
     END

     IF (CLIENTEDEST IS NULL)
     THEN BEGIN
          MENSAGEM = 'Nota de Destino Inexistente';
     END

     IF ( CLIENTEOR <> CLIENTEDEST )
     THEN BEGIN
          MENSAGEM = 'Cliente de Origem Diferente do Cliente de Destino';
     END

     IF (MENSAGEM = '')
     THEN BEGIN
          UPDATE FIN_CONTAS_RECEBER
          SET FATURA = :DESTINO
          WHERE CNPJ = :CNPJ AND FATURA = :ORIGEM ;

          UPDATE FIN_FATURAS_ADICIONAL
          SET CODIGO = :DESTINO
          WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;

          DELETE FROM FIN_FATURAS
          WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;

          /* SOMA OS VALORES */
          SELECT SUM( VALOR - VLR_PARCIAL + JUROS_REC - DESCONTOS ) FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ AND FATURA = :DESTINO
          INTO :VALOR ;

          IF ( VALOR IS NULL )
          THEN BEGIN
               VALOR = 0;
          END

          SOMA = SOMA + VALOR ;

          SELECT SUM( VALOR ) FROM FIN_FATURAS_ADICIONAL
          WHERE CNPJ = :CNPJ AND CODIGO = :DESTINO
          INTO :VALOR ;

          IF ( VALOR IS NULL )
          THEN BEGIN
               VALOR = 0;
          END

          SOMA = SOMA + VALOR ;

          UPDATE FIN_FATURAS SET VALOR = :SOMA
          WHERE CNPJ = :CNPJ AND CODIGO = :DESTINO;
     END

     suspend;
END
^

ALTER PROCEDURE AGRUPADOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    AGRUPADOR VARCHAR(15))
AS
BEGIN
     UPDATE EST_PRODUTOS
     SET COD_AGRUP = :AGRUPADOR, CNPJ_AGRUP = :CNPJ
     WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO ;
     
     SUSPEND;
END
^

ALTER PROCEDURE ALTERA_PRECOS_ARQ_EXT_PRODUTOS (
    CNPJ CHAR(14),
    DESTINO CHAR(14))
AS
DECLARE VARIABLE CODIGO VARCHAR(15);
DECLARE VARIABLE CODIGO_2 VARCHAR(15);
DECLARE VARIABLE CNPJ_AGRUP CHAR(14);
DECLARE VARIABLE COD_AGRUP CHAR(14);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE MARCA INTEGER;
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUBGRUPO INTEGER;
DECLARE VARIABLE REDUCAO INTEGER;
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE QTDADE_1 NUMERIC(18,4);
DECLARE VARIABLE QTDADE_2 NUMERIC(18,4);
DECLARE VARIABLE LOCALIZACAO_1 VARCHAR(30);
DECLARE VARIABLE LOCALIZACAO_2 VARCHAR(30);
DECLARE VARIABLE LOCALIZACAO_3 VARCHAR(30);
DECLARE VARIABLE NEG_QTDADE_2 CHAR(1);
DECLARE VARIABLE QTDADE_MIN INTEGER;
DECLARE VARIABLE QTDADE_MAX INTEGER;
DECLARE VARIABLE COMPLEMENTO_NF CHAR(1);
DECLARE VARIABLE DT_ULT_COMPRA TIMESTAMP;
DECLARE VARIABLE QT_ULT_COMPRA INTEGER;
DECLARE VARIABLE DT_ULT_VENDA TIMESTAMP;
DECLARE VARIABLE MARGEM_BRUTA NUMERIC(18,4);
DECLARE VARIABLE PRC_REPOS NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO_ANT NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO_MED NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA_ANT NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA_MED NUMERIC(18,4);
DECLARE VARIABLE ALIQUOTA_ECF CHAR(5);
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE PESO_LIQ NUMERIC(18,4);
DECLARE VARIABLE PERC_FRETE NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE VOLUME NUMERIC(18,4);
DECLARE VARIABLE PROD_PESAVEL CHAR(1);
DECLARE VARIABLE ETIQUETA_ENT CHAR(1);
DECLARE VARIABLE ATIVO CHAR(1);
DECLARE VARIABLE ULTIMO_FORNECEDOR INTEGER;
DECLARE VARIABLE FORNECEDOR INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE NOME_MARCA VARCHAR(50);
DECLARE VARIABLE PRC_CUSTO_CODIF VARCHAR(15);
DECLARE VARIABLE CODIGO_INTERNO INTEGER;
DECLARE VARIABLE DT_ULT_ATU_PRECO TIMESTAMP;
DECLARE VARIABLE CUSTO_AQUISICAO NUMERIC(18,4);
DECLARE VARIABLE VENDE_FRACIONADO CHAR(1);
DECLARE VARIABLE QNTDE_EXPOSTA NUMERIC(18,4);
DECLARE VARIABLE POSSUI_LOTE CHAR(1);
DECLARE VARIABLE QNTDE_MAXIMA_VENDA NUMERIC(18,4);
DECLARE VARIABLE PIS CHAR(1);
DECLARE VARIABLE COFINS CHAR(1);
DECLARE VARIABLE COM_VENDA_VLR NUMERIC(18,4);
DECLARE VARIABLE COM_VENDA_PCT NUMERIC(18,4);
DECLARE VARIABLE PARTICIP_LUCRO NUMERIC(18,4);
DECLARE VARIABLE NAO_COBR_JUR_ATE INTEGER;
DECLARE VARIABLE PREVISAO_ENTREGA TIMESTAMP;
DECLARE VARIABLE QNTDE_PEDIDA NUMERIC(18,4);
begin
     /* MIGRA OS DADOS PARA A TABELA EXTERNA */
     FOR SELECT
         CODIGO,CODIGO_2,CNPJ_AGRUP,COD_AGRUP,NOME,MARCA,GRUPO,SUBGRUPO,REDUCAO,
         UNIDADE,CTE,CTIE,QTDADE_1,QTDADE_2,LOCALIZACAO_1,LOCALIZACAO_2,LOCALIZACAO_3,
         NEG_QTDADE_2,QTDADE_MIN,QTDADE_MAX,COMPLEMENTO_NF,DT_ULT_COMPRA,QT_ULT_COMPRA,
         DT_ULT_VENDA,MARGEM_BRUTA,PRC_REPOS,PRC_CUSTO_ANT,PRC_CUSTO_MED,PRC_VENDA,
         PRC_VENDA_ANT,PRC_VENDA_MED,ALIQUOTA_ECF,ORIGEM,PESO_LIQ,PERC_FRETE,IPI,
         VOLUME,PROD_PESAVEL,ETIQUETA_ENT,ATIVO,ULTIMO_FORNECEDOR,FORNECEDOR,
         SUBUNIDADE,NOME_MARCA,PRC_CUSTO_CODIF,CODIGO_INTERNO,DT_ULT_ATU_PRECO,
         CUSTO_AQUISICAO,VENDE_FRACIONADO,QNTDE_EXPOSTA,POSSUI_LOTE,QNTDE_MAXIMA_VENDA,
         PIS,COFINS,COM_VENDA_VLR,COM_VENDA_PCT,PARTICIP_LUCRO,NAO_COBR_JUR_ATE,PREVISAO_ENTREGA,
         QNTDE_PEDIDA
     FROM EXT_EST_PRODUTOS
     WHERE CNPJ = :CNPJ
     INTO
         :CODIGO,:CODIGO_2,:CNPJ_AGRUP,:COD_AGRUP,:NOME,:MARCA,:GRUPO,:SUBGRUPO,:REDUCAO,
         :UNIDADE,:CTE,:CTIE,:QTDADE_1,:QTDADE_2,:LOCALIZACAO_1,:LOCALIZACAO_2,:LOCALIZACAO_3,
         :NEG_QTDADE_2,:QTDADE_MIN,:QTDADE_MAX,:COMPLEMENTO_NF,:DT_ULT_COMPRA,:QT_ULT_COMPRA,
         :DT_ULT_VENDA,:MARGEM_BRUTA,:PRC_REPOS,:PRC_CUSTO_ANT,:PRC_CUSTO_MED,:PRC_VENDA,
         :PRC_VENDA_ANT,:PRC_VENDA_MED,:ALIQUOTA_ECF,:ORIGEM,:PESO_LIQ,:PERC_FRETE,:IPI,
         :VOLUME,:PROD_PESAVEL,:ETIQUETA_ENT,:ATIVO,:ULTIMO_FORNECEDOR,:FORNECEDOR,
         :SUBUNIDADE,:NOME_MARCA,:PRC_CUSTO_CODIF,:CODIGO_INTERNO,:DT_ULT_ATU_PRECO,
         :CUSTO_AQUISICAO,:VENDE_FRACIONADO,:QNTDE_EXPOSTA,:POSSUI_LOTE,:QNTDE_MAXIMA_VENDA,
         :PIS,:COFINS,:COM_VENDA_VLR,:COM_VENDA_PCT,:PARTICIP_LUCRO,:NAO_COBR_JUR_ATE,:PREVISAO_ENTREGA,
         :QNTDE_PEDIDA
     DO BEGIN
        INSERT INTO EXT_EST_PRODUTOS
        (
         CNPJ, CODIGO,CODIGO_2,CNPJ_AGRUP,COD_AGRUP,NOME,MARCA,GRUPO,SUBGRUPO,REDUCAO,
         UNIDADE,CTE,CTIE,QTDADE_1,QTDADE_2,LOCALIZACAO_1,LOCALIZACAO_2,LOCALIZACAO_3,
         NEG_QTDADE_2,QTDADE_MIN,QTDADE_MAX,COMPLEMENTO_NF,DT_ULT_COMPRA,QT_ULT_COMPRA,
         DT_ULT_VENDA,MARGEM_BRUTA,PRC_REPOS,PRC_CUSTO_ANT,PRC_CUSTO_MED,PRC_VENDA,
         PRC_VENDA_ANT,PRC_VENDA_MED,ALIQUOTA_ECF,ORIGEM,PESO_LIQ,PERC_FRETE,IPI,
         VOLUME,PROD_PESAVEL,ETIQUETA_ENT,ATIVO,ULTIMO_FORNECEDOR,FORNECEDOR,
         SUBUNIDADE,NOME_MARCA,PRC_CUSTO_CODIF,CODIGO_INTERNO,DT_ULT_ATU_PRECO,
         CUSTO_AQUISICAO,VENDE_FRACIONADO,QNTDE_EXPOSTA,POSSUI_LOTE,QNTDE_MAXIMA_VENDA,
         PIS,COFINS,COM_VENDA_VLR,COM_VENDA_PCT,PARTICIP_LUCRO,NAO_COBR_JUR_ATE,PREVISAO_ENTREGA,
         QNTDE_PEDIDA
        )
        VALUES
        (
         :DESTINO, :CODIGO,:CODIGO_2,:CNPJ_AGRUP,:COD_AGRUP,:NOME,:MARCA,:GRUPO,:SUBGRUPO,:REDUCAO,
         :UNIDADE,:CTE,:CTIE,:QTDADE_1,:QTDADE_2,:LOCALIZACAO_1,:LOCALIZACAO_2,:LOCALIZACAO_3,
         :NEG_QTDADE_2,:QTDADE_MIN,:QTDADE_MAX,:COMPLEMENTO_NF,:DT_ULT_COMPRA,:QT_ULT_COMPRA,
         :DT_ULT_VENDA,:MARGEM_BRUTA,:PRC_REPOS,:PRC_CUSTO_ANT,:PRC_CUSTO_MED,:PRC_VENDA,
         :PRC_VENDA_ANT,:PRC_VENDA_MED,:ALIQUOTA_ECF,:ORIGEM,:PESO_LIQ,:PERC_FRETE,:IPI,
         :VOLUME,:PROD_PESAVEL,:ETIQUETA_ENT,:ATIVO,:ULTIMO_FORNECEDOR,:FORNECEDOR,
         :SUBUNIDADE,:NOME_MARCA,:PRC_CUSTO_CODIF,:CODIGO_INTERNO,:DT_ULT_ATU_PRECO,
         :CUSTO_AQUISICAO,:VENDE_FRACIONADO,:QNTDE_EXPOSTA,:POSSUI_LOTE,:QNTDE_MAXIMA_VENDA,
         :PIS,:COFINS,:COM_VENDA_VLR,:COM_VENDA_PCT,:PARTICIP_LUCRO,:NAO_COBR_JUR_ATE,:PREVISAO_ENTREGA,
         :QNTDE_PEDIDA
        );
     END
END
^

ALTER PROCEDURE ANALISE_CLIENTE (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    QUANTIDADE_COMPRAS INTEGER,
    VALORES_ABERTOS NUMERIC(18,4),
    VALORES_PAGOS NUMERIC(18,4),
    ENTRADAS_PAGAS NUMERIC(18,4),
    NEGATIVADO_N_VEZES INTEGER,
    ULTIMA_CONSULTA DATE,
    REABILITADO_DIA DATE,
    MEDIA_ATRASO INTEGER,
    MAIOR_ATRASO INTEGER,
    MAIOR_COMPRA NUMERIC(18,4),
    MEDIA_MENSAL NUMERIC(18,4),
    LIMITE_CREDITO NUMERIC(18,4),
    LIMITE_DISPONIVEL NUMERIC(18,4))
AS
begin
     /*  */
     SELECT COUNT(PESSOA_FJ), MAX(TOTAL+DESC_ACRES), SUM(ENTRADA)
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     AND FECHADA = 'S' AND ENVIADA_CX = 'S'
     INTO :QUANTIDADE_COMPRAS, :MAIOR_COMPRA, :ENTRADAS_PAGAS ;

     /*  */
     SELECT SUM( VALOR - (VLR_PARCIAL + DESCONTOS))
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     INTO :VALORES_ABERTOS ;

     /*  */
     SELECT SUM( VLR_BAIXA ), AVG(DT_BAIXA - DT_VENCTO), MAX(DT_BAIXA - DT_VENCTO)
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     INTO :VALORES_PAGOS, :MEDIA_ATRASO, :MAIOR_ATRASO ;

     /*  */
     SELECT MEDIA
     FROM MEDIA_MENSAL_PAGAMENTOS ( :CNPJ, :CLIENTE )
     INTO :MEDIA_MENSAL ;
        
     /*  */
     SELECT LIMITE_CREDITO, NEG_N_VEZES
     FROM GLO_CLIENTES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     INTO :LIMITE_CREDITO, :negativado_n_vezes;

     LIMITE_DISPONIVEL = :LIMITE_CREDITO - :VALORES_ABERTOS ;

     /* Procedure Text */
     suspend;
END
^

ALTER PROCEDURE ANALISE_CUSTOS (
    CNPJ CHAR(14),
    VENDA INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DATA TIMESTAMP;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMERO INTEGER;
begin
     FOR SELECT CODIGO, PESSOA_FJ, TOTAL, NOME, DATA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA
     ORDER BY CNPJ, CODIGO
     INTO :CODIGO, :PESSOA, :TOTAL, :NOME, :DATA
     DO BEGIN
        SELECT NUMERO FROM EXISTE_ANALISE_CUSTO ( :CNPJ, :VENDA )
        INTO :NUMERO ;

        IF ( :NUMERO > 0 )
        THEN BEGIN
             UPDATE FIN_ANALISE_CUSTO
             SET PESSOA_FJ = :PESSOA, TOTAL = :TOTAL, NOVO_VALOR = :TOTAL
             WHERE CNPJ = :CNPJ AND CODIGO = :VENDA ;
        END
        ELSE BEGIN
             INSERT INTO FIN_ANALISE_CUSTO
             (
             CNPJ, CODIGO, PESSOA_FJ, NOME, TOTAL, NOVO_VALOR, DATA
             )
             VALUES
             (
             :CNPJ, :VENDA, :PESSOA, :NOME, :TOTAL, :TOTAL, :DATA
             );
        END
     END


     FOR SELECT
        PRODUTO, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, NOME_PRODUTO
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     ORDER BY CNPJ, CODIGO
     INTO :PRODUTO, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO, :NOME
     DO BEGIN
        SELECT NUMERO FROM EXISTE_ANALISE_CUSTO_ITENS ( :CNPJ, :VENDA, :PRODUTO )
        INTO :NUMERO ;

        IF ( :NUMERO > 0 )
        THEN BEGIN
             UPDATE FIN_ANALISE_CUSTO_ITENS
             SET
             QUANTIDADE = :QUANTIDADE, UNITARIO = :PRC_UNITARIO, CUSTO = :PRC_CUSTO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO ;
        END
        ELSE BEGIN
             INSERT INTO FIN_ANALISE_CUSTO_ITENS
             ( CNPJ, CODIGO, PRODUTO, NOME, QUANTIDADE, UNITARIO, CUSTO )
             VALUES
             ( :CNPJ, :CODIGO, :PRODUTO, :NOME, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO ) ;
        END
     END
END
^

ALTER PROCEDURE ANALISE_CUSTOS_VENDAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
     AND FECHADA = 'S'
     INTO  :CODIGO
     DO BEGIN
        FOR SELECT PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO,
            PRC_CUSTO, DESCONTO, PORC_DESC, UNIDADE
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO,
             :PRC_CUSTO, :DESCONTO, :PORC_DESC, :UNIDADE
        DO BEGIN
           SELECT NOME, GRUPO FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO NOME_PRODUTO, :GRUPO ;

           SELECT NOME
           FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
           INTO :NOME_GRUPO ;

           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE ANALISE_INADIMPLENCIA (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    LANCADO NUMERIC(18,4),
    PAGO NUMERIC(18,4),
    ABERTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    PARCIAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;
     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO     = ANO - 1;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

/*          SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS) */
          SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
          FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_EMISSAO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_EMISSAO )  = :ANO
          INTO :ABERTO ;

          IF ( ABERTO IS NULL )
          THEN
              ABERTO = 0;

/*          SELECT SUM(VLR_BAIXA-JUROS_REC+DESCONTOS), */
          SELECT SUM(VLR_BAIXA+DESCONTOS),
          SUM(VLR_PARCIAL), SUM(JUROS_REC), SUM(DESCONTOS)
          FROM FIN_BAIXAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_EMISSAO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_EMISSAO )  = :ANO
          INTO :LANCADO , :PARCIAL, :JUROS, :DESCONTOS ;

          IF ( LANCADO IS NULL )
          THEN
              LANCADO = 0;

          LANCADO = LANCADO + ABERTO ;

/*          SELECT SUM(VLR_BAIXA+DESCONTOS-JUROS) */
          SELECT SUM(VLR_BAIXA+DESCONTOS)
          FROM FIN_BAIXAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_EMISSAO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_EMISSAO )  = :ANO
          INTO :PAGO ;

          IF ( PAGO IS NULL )
          THEN
              PAGO = 0;

          IF ( LANCADO > 0 )
          THEN BEGIN
              PORCENTAGEM = PAGO / LANCADO * 100;
          END
          ELSE BEGIN
              PORCENTAGEM = 0;
          END

          SUSPEND;

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE ANALISE_INADIMPLENCIA_VENCTO (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    LANCADO NUMERIC(18,4),
    PAGO NUMERIC(18,4),
    ABERTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    PARCIAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;
     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO     = ANO - 1;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

/*          SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS) */
          SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
          FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_VENCTO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_VENCTO )  = :ANO
          INTO :ABERTO ;

          IF ( ABERTO IS NULL )
          THEN
              ABERTO = 0;

/*          SELECT SUM(VLR_BAIXA-JUROS_REC+DESCONTOS), */
          SELECT SUM(VLR_BAIXA+DESCONTOS),
          SUM(VLR_PARCIAL), SUM(JUROS_REC), SUM(DESCONTOS)
          FROM FIN_BAIXAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_VENCTO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_VENCTO )  = :ANO
          INTO :LANCADO , :PARCIAL, :JUROS, :DESCONTOS ;

          IF ( LANCADO IS NULL )
          THEN
              LANCADO = 0;

          LANCADO = LANCADO + ABERTO ;

/*          SELECT SUM(VLR_BAIXA+DESCONTOS-JUROS) */
          SELECT SUM(VLR_BAIXA+DESCONTOS)
          FROM FIN_BAIXAS_RECEBER
          WHERE CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM DT_VENCTO ) = :MES_FIM
          AND EXTRACT ( YEAR FROM DT_VENCTO )  = :ANO
          INTO :PAGO ;

          IF ( PAGO IS NULL )
          THEN
              PAGO = 0;

          IF ( LANCADO > 0 )
          THEN BEGIN
              PORCENTAGEM = PAGO / LANCADO * 100;
          END
          ELSE BEGIN
              PORCENTAGEM = 0;
          END

          SUSPEND;

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE APAGA_CLIENTES_MARCADOS
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE VENDA  INTEGER;
begin
     FOR SELECT CODIGO FROM
     GLO_PESSOAS_FJ
     WHERE GLO_PESSOAS_FJ.FANTASIA = 'APAGAR'
     INTO :CODIGO
     DO BEGIN
        DELETE FROM FIN_CONTAS_RECEBER
        WHERE PESSOA_FJ = :CODIGO ;

        DELETE FROM FIN_BAIXAS_RECEBER
        WHERE PESSOA_FJ = :CODIGO ;

        FOR SELECT CODIGO FROM FAT_VENDAS
        WHERE PESSOA_FJ = :CODIGO
        INTO :VENDA
        DO BEGIN
            DELETE FROM FAT_VENDAS_ITENS
            WHERE CODIGO = :VENDA ;

            DELETE FROM FAT_VENDAS_PARCELAMENTO
            WHERE CODIGO = :VENDA ;
        END

        DELETE FROM FAT_VENDAS
        WHERE PESSOA_FJ = :CODIGO ;

     END
END
^

ALTER PROCEDURE APAGA_ETIQUETAS_IMPRESSAS (
    CNPJ CHAR(14))
AS
BEGIN
     DELETE FROM EST_ESTIQUETA_PRODUTO_IMPRIME
     WHERE (CNPJ = :CNPJ);
END
^

ALTER PROCEDURE APAGA_ETIQUETAS_MATRIZ (
    CNPJ CHAR(14))
AS
BEGIN
     DELETE FROM EST_ESTIQUETA_PRODUTO
     WHERE (CNPJ = :CNPJ);
END
^

ALTER PROCEDURE APAGA_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
      DELETE FROM FAT_VENDAS_FRMPAGTO
      WHERE
      (CNPJ = :CNPJ) AND (CODIGO = :CODIGO) ;
END
^

ALTER PROCEDURE APAGA_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    INDICADO INTEGER)
AS
BEGIN
  DELETE FROM GLO_INDICACOES
  WHERE
    (CNPJ = :CNPJ) AND 
    (PESSOA_FJ = :PESSOA_FJ) AND 
    (INDICADO = :INDICADO);
END
^

ALTER PROCEDURE APAGA_ORDEM_SERVICO_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SERVICO INTEGER)
AS
BEGIN
  /*modificação implementada para permitir a compatibilidade
  com a base antiga da sistemaq*/
  if (servico > 0) then
  begin
    delete from ofc_ordem_servico_servico
    where (cnpj = :cnpj) and (codigo = :codigo) and (servico = :servico);
  end
  else
  begin
    delete from ofc_ordem_servico_servico
    where (cnpj = :cnpj) and (codigo = :codigo) and (produto = :produto);   
  end
END
^

ALTER PROCEDURE APAGA_ORDEM_SERVICO_SERVICO_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER)
AS
BEGIN
  DELETE FROM OFC_ORDEM_SERVICO_SERVICO_ORC
  WHERE (CNPJ = :CNPJ) AND (CODIGO = :CODIGO) AND (SERVICO = :SERVICO);
END
^

ALTER PROCEDURE APAGA_PARCELAS_GARANTIAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_GARANTIAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE APAGA_PARCELAS_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* PARCELAS */
     DELETE FROM
     OFC_ORDEM_SERVICO_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE APAGA_PARCELAS_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_TROCAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE APAGA_PARCELAS_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_VENDAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE AT_NF_ENT_CUSTO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE ALTERA_CUSTO CHAR(1);
DECLARE VARIABLE UTLIZA_INDEXADOR_CUSTO CHAR(1);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE QTDADE_ENT NUMERIC(18,4);
DECLARE VARIABLE QTDADE_PROD NUMERIC(18,4);
DECLARE VARIABLE TT_CUSTO_ANT NUMERIC(18,4);
DECLARE VARIABLE TT_CUSTO NUMERIC(18,4);
DECLARE VARIABLE UNITARIO FLOAT;
DECLARE VARIABLE INDEXADOR NUMERIC(18,4);
DECLARE VARIABLE CUSTO_MEDIO NUMERIC(18,4);
DECLARE VARIABLE CUSTO_MEDIO_ANT NUMERIC(18,4);
DECLARE VARIABLE CUSTO_AQUISICAO NUMERIC(18,4);
DECLARE VARIABLE PRC_REPOS NUMERIC(18,4);
DECLARE VARIABLE PERC_LUCRO NUMERIC(18,4);
DECLARE VARIABLE DATA_REF DATE;
DECLARE VARIABLE FATOR_CONVERSAO INTEGER;
DECLARE VARIABLE QTDE_CONVERSAO FLOAT;
DECLARE VARIABLE UNIDADE_PADRAO CHAR(4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE UND_PRIMARIA CHAR(4);
DECLARE VARIABLE FATOR_CONV_PRIMARIA FLOAT;
BEGIN
  /*  */
  TAG = 0;

  /*verificando se utiliza indexador.. nao sei oque é isso*/
  select utliza_indexador_custo
  from sis_configuracoes
  where cnpj = :cnpj
  into :utliza_indexador_custo ;

  /*tipo de natureza de operação*/
  select natureza, data_ref from est_entradas
  where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
  into :natureza, :data_ref;


  /* somente dolar
  select valor  from fin_cotacoes
  where data = :data_ref and sigla = 'U$'
  into :indexador ;

  if (indexador is null) then
      indexador = 0; */

  /* verificando se altera preco custo */
  select altera_custo from est_natureza
  where cnpj = :cnpj and codigo = :natureza
  into :altera_custo;

  /*Percorrendo os itens*/
  for select unidade, produto, prc_custo, quantidade, prc_unitario, eti.perc_lucro  from est_entradas_itens eti
      where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
      into :unidade, :produto, :prc_custo, :qtdade_ent, :unitario, :perc_lucro
      do
      begin


       /*---------------[ unidade de conversao ]---------------------------------*/
      select prd.unidade, und_primaria, prd.fator_conversao from est_produtos prd
      where prd.codigo = :produto and prd.cnpj = :cnpj
      into :unidade_padrao, :und_primaria, :FATOR_CONV_PRIMARIA;

      /*unidade padrão diferente da unidade de utilizada no fechamento*/
      if (:unidade <> :UNIDADE_PADRAO) then
      begin
        select cv.fator, cv.qtde from est_conversao_unid_med cv
        where cv.cnpj = :cnpj and cv.cod_und_padrao = :und_primaria and cv.cod_und_conversao = :unidade
        into :fator_conversao, :qtde_conversao;

        if (:fator_conversao = 1) then
        begin
          qtdade_ent = (:qtdade_ent / :qtde_conversao);
          unitario = (:unitario * :qtde_conversao);
        end
        else
        begin
          qtdade_ent = (:qtdade_ent * :qtde_conversao);
          unitario  =(unitario / :qtde_conversao);
        end

        qtdade_ent = (:qtdade_ent / :FATOR_CONV_PRIMARIA);
        unitario = (:unitario * :FATOR_CONV_PRIMARIA);
      end


        /*Armazenando o valor do custo médio anterior*/
        select prd.prc_custo_med, prd.custo_aquisicao, prd.prc_repos from est_produtos prd
        where prd.cnpj = :cnpj and prd.codigo = :produto
        into :custo_medio_ant, :custo_aquisicao, :prc_repos;




        /*total do custo das compras dos produtos*/
        tt_custo = (:prc_custo * :qtdade_ent);



        /*  */
        tag = 1;

        /*pegando dados da tabela produtos, tal como qtde atual dos produtos e preço-custo-medio,
        aparentemente temos o custo do estoque..  */
        select (coalesce(qtdade_2,0) * coalesce(prc_custo_med,0)), coalesce(qtdade_2,0) from est_produtos
        where cnpj = :cnpj and codigo = :produto
        into :tt_custo_ant, :qtdade_prod;

        /* atualizando preco de custo dos produtos */
        if (:altera_custo = 'S') then
        begin
          if (:qtdade_prod <= 0) then
            custo_medio = :prc_custo;
          else
            custo_medio = ((:tt_custo + :tt_custo_ant) / (:qtdade_ent + :qtdade_prod));


         insert into est_historico_prd_custo(CNPJ,
                                             COD_PRODUTO,
                                             QTDE,
                                             CUSTO_MEDIO_NF,
                                             CUSTO_MEDIO_ANT,
                                             DATA,
                                             COD_NF_ENTRADA,
                                             COD_PESSOA_FJ,
                                             CUSTO_AQUISICAO,
                                             PRC_REPOS)
                                      values(:cnpj,
                                             :produto,
                                             :qtdade_ent,
                                             :custo_medio,
                                             :custo_medio_ant,
                                             current_date,
                                             :ndocto,
                                             :pessoa_fj,
                                             :custo_aquisicao,
                                             :prc_repos);
         /* indexa o custo do produto */
         if (( utliza_indexador_custo = 'S' ) and ( indexador > 0 )) then
         begin
           update est_produtos prd set
           prc_custo_ant = prc_repos,
           prc_repos = :prc_custo,
           custo_aquisicao = :unitario,
           prc_custo_med = :custo_medio,
           prd.margem_bruta = :perc_lucro,
           custo_indexado = :unitario / :indexador
           where cnpj = :cnpj and codigo = :produto;
         end
         else
         begin
           update est_produtos prd set
           prc_custo_ant = prc_repos,
           prc_repos = :prc_custo,
           custo_aquisicao = :unitario,
           prc_custo_med = :custo_medio,
           prd.margem_bruta = :perc_lucro
           where cnpj = :cnpj and codigo = :produto;
         end
        end
      end

      if (tag = 1) then
      begin
        update est_entradas
        set proc_custo = 'S'
        where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj ;
      end
  
      suspend;
END
^

ALTER PROCEDURE AT_NF_ENT_FINANCEIRO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER,
    DATA_CAIXA DATE)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE DATA_NF TIMESTAMP;
DECLARE VARIABLE DATA_REF DATE;
DECLARE VARIABLE CODIGO_CP INTEGER;
DECLARE VARIABLE CENTRO INTEGER;
DECLARE VARIABLE ANO_CP INTEGER;
DECLARE VARIABLE DT_VENCTO TIMESTAMP;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE DUPLICATA VARCHAR(15);
DECLARE VARIABLE CONFERIDA VARCHAR(1);
DECLARE VARIABLE ANO_AT INTEGER;
DECLARE VARIABLE FRETE_LF VARCHAR(1);
DECLARE VARIABLE VLR_PRODUTOS NUMERIC(18,4);
DECLARE VARIABLE VLR_EMBALAGEM NUMERIC(18,4);
DECLARE VARIABLE VLR_SEGURO NUMERIC(18,4);
DECLARE VARIABLE VLR_FRETE NUMERIC(18,4);
DECLARE VARIABLE VLR_IPI NUMERIC(18,4);
DECLARE VARIABLE TAXAS NUMERIC(18,4);
DECLARE VARIABLE VLR_DESCONTO NUMERIC(18,4);
DECLARE VARIABLE VLR_ICM_SUBS NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NF NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUB_GRUPO INTEGER;
DECLARE VARIABLE COMPRAS_C INTEGER;
DECLARE VARIABLE COMPRAS_D INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE CENTRO_AUX INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE COD_CREDOR INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
DECLARE VARIABLE VLR_TOTAL_NF NUMERIC(18,4);
BEGIN
  /*  */
  TAG = 0;

  /*  */
  SELECT DATA_NF, CENTRO_CUSTO, VLR_PRODUTOS, VLR_EMBALAGEM, VLR_SEGURO, VLR_FRETE,
  VLR_IPI, TAXAS, VLR_DESCONTO, VLR_ICM_SUBS, FRETE_LF, DATA_REF, ENTRADA,
  COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE, VLR_PARC_LC
  FROM EST_ENTRADAS
  WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
  INTO :DATA_NF, :CENTRO, :VLR_PRODUTOS, :VLR_EMBALAGEM, :VLR_SEGURO, :VLR_FRETE,
  :VLR_IPI, :TAXAS, :VLR_DESCONTO, :VLR_ICM_SUBS, :FRETE_LF, :DATA_REF, :ENTRADA,
  :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE, :VLR_TOTAL_NF;

  IF ( :FRETE_LF = 'S' )
  THEN BEGIN
       TOTAL_NF = VLR_PRODUTOS + VLR_EMBALAGEM + VLR_SEGURO + VLR_FRETE +
       VLR_IPI + TAXAS + VLR_DESCONTO + VLR_ICM_SUBS ;
  END
  ELSE BEGIN
       TOTAL_NF = VLR_PRODUTOS + VLR_EMBALAGEM + VLR_SEGURO +
       VLR_IPI + TAXAS + VLR_DESCONTO + VLR_ICM_SUBS ;
  END

  /* PLANILHA GERADA NESTE MOMENTO PARA Q LANCE TBM NO CONTAS A PAGAR */
  SELECT CODIGO FROM GERAR_CODIGO ('PLANILHA',1)
  INTO :PLANILHA;

  /*  */
  FOR SELECT DT_VENCTO, PARCELA, VALOR, OBSERVACAO, DUPLICATA, CONFERIDA,
  CENTRO_CUSTO, COD_CREDOR
  FROM EST_ENTRADAS_FATURAMENTO f
  WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND
  PESSOA_FJ = :PESSOA_FJ
  INTO :DT_VENCTO, :PARCELA, :VALOR, :HISTORICO, :DUPLICATA, :CONFERIDA,
  :CENTRO_AUX, :cod_credor
  DO BEGIN
        /*  */
        TAG = 1;
        /*  */

        SELECT EXTRACT(YEAR FROM CURRENT_TIMESTAMP)
        FROM RDB$DATABASE INTO :ANO_AT;
  
        IF (:ANO_AT = GEN_ID(FIN_PAGAR_ANO_GE, 0))
        THEN BEGIN
             ANO_CP    = GEN_ID(FIN_PAGAR_ANO_GE, 0);
             CODIGO_CP = GEN_ID(FIN_PAGAR_COD_GE, :TAG);
        END
        IF (:ANO_AT > GEN_ID(FIN_PAGAR_ANO_GE, 0))
        THEN BEGIN
             ANO_CP    = GEN_ID(FIN_PAGAR_ANO_GE, :ANO_AT - GEN_ID(FIN_PAGAR_ANO_GE, 0));
             CODIGO_CP = GEN_ID(FIN_PAGAR_COD_GE, 0       - GEN_ID(FIN_PAGAR_COD_GE, 0));
        END

        IF (:ANO_AT < GEN_ID(FIN_PAGAR_ANO_GE, 0))
        THEN BEGIN
             ANO_CP = 0;
             CODIGO_CP = 0;
        END

        if (coalesce(:COD_CREDOR,0) = 0) then
           cod_credor = :pessoa_fj;

        idx_qtde = (:valor/:vlr_total_nf);

        if (centro_aux is null) then
        begin
             insert into fin_contas_pagar ( cnpj,     codigo,     ano,  pessoa_fj, dt_emissao,  dt_vencto, dt_lancto,   docto,  parcela,  historico,  valor, origem, centro_custo, duplicata, conferida, total_entrada, planilha,
                                            cod_indexador, idx_database, idx_cotacao, idx_qtde)
             values (:cnpj, :codigo_cp, :ano_cp, :cod_credor,   :data_nf, :dt_vencto,   :data_ref , :ndocto, :parcela, :historico, :valor, 'ent', :centro, :duplicata, :conferida, :total_nf, :planilha,
                                            :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde);
        END
        ELSE BEGIN
             insert into fin_contas_pagar ( cnpj,     codigo,     ano,  pessoa_fj, dt_emissao,  dt_vencto, dt_lancto,   docto,  parcela,  historico,  valor, origem, centro_custo, duplicata, conferida, total_entrada, planilha,
                                            cod_indexador, idx_database, idx_cotacao, idx_qtde )
             values (:cnpj, :codigo_cp, :ano_cp, :cod_credor,   :data_nf, :dt_vencto,   :data_ref , :ndocto, :parcela, :historico, :valor, 'ent', :centro_aux, :duplicata, :conferida, :total_nf, :planilha,
                     :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde);
        END

        /*  */
        UPDATE EST_ENTRADAS_FATURAMENTO
           SET CODIGO_CP = :CODIGO_CP,
               ANO_CP = :ANO_CP
         WHERE CNPJ = :CNPJ AND
               NDOCTO = :NDOCTO AND
               PESSOA_FJ = :PESSOA_FJ AND
               DT_VENCTO = :DT_VENCTO;
  END

  /* NOTA FISCAL FECHADA TODA A VISTA */
  IF ( TAG = 0 )
  THEN BEGIN
       select * from round2(:total_nf) into :total_nf;
       select * from round2(:ENTRADA) into :ENTRADA;
       IF (TOTAL_NF = ENTRADA) THEN
        TAG = 1;
  END
      
  IF ( TAG = 1 )
  THEN BEGIN
       UPDATE EST_ENTRADAS
       SET PROC_FIN = 'S', PLANILHA = :PLANILHA, DATA_REF = :DATA_CAIXA
       WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ ;
  END
      
  SUSPEND;
END
^

ALTER PROCEDURE AT_NF_ENT_QTD (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE DATA_ENT TIMESTAMP;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE UND_PRIMARIA CHAR(4);
DECLARE VARIABLE UNIDADE_PADRAO CHAR(4);
DECLARE VARIABLE UNIDADES INTEGER;
DECLARE VARIABLE QTDE_UNIDADE NUMERIC(18,4);
DECLARE VARIABLE FATOR_CONV_PRIMARIA FLOAT;
DECLARE VARIABLE LOTE INTEGER;
DECLARE VARIABLE QTDADE_ANT NUMERIC(18,4);
DECLARE VARIABLE QTDADE_ANT1 NUMERIC(18,4);
DECLARE VARIABLE QTDADE FLOAT;
DECLARE VARIABLE QTDADE_FISCAL FLOAT;
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE PRC_UNIT NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE ESTLOTE NUMERIC(18,4);
DECLARE VARIABLE LOC_ESTOQUE SMALLINT;
DECLARE VARIABLE ALT_PRC_VND CHAR(1);
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE MOV_ESTOQUE_FISCAL CHAR(1);
DECLARE VARIABLE TIPO_KDX CHAR(1);
DECLARE VARIABLE ETIQUETA CHAR(1);
DECLARE VARIABLE GERGRADE CHAR(1);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO_GRADE VARCHAR(6);
DECLARE VARIABLE QUANTIDADE_GRADE NUMERIC(18,4);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE RET_CODIGO INTEGER;
DECLARE VARIABLE LT_CODIGO INTEGER;
DECLARE VARIABLE QUANTIDADE_LOTE NUMERIC(18,4);
DECLARE VARIABLE LT_PRODUTO VARCHAR(15);
DECLARE VARIABLE RET_DATA DATE;
DECLARE VARIABLE RET_QTDADE NUMERIC(18,4);
DECLARE VARIABLE RET_QTDADE_ANT NUMERIC(18,4);
DECLARE VARIABLE RET_SALDO_ACERT NUMERIC(18,4);
DECLARE VARIABLE RET_TIPO_ES CHAR(1);
DECLARE VARIABLE ORIGEM_FISCAL CHAR(1);
DECLARE VARIABLE FATOR_CONVERSAO INTEGER;
DECLARE VARIABLE QTDE_CONVERSAO FLOAT;
DECLARE VARIABLE CUSTOMEDIO FLOAT;
BEGIN
  /*  */
  TAG = 0;

/*---------------[ pegando o registro de entrada ]------------------------------*/
  select ndocto, data_ent, local_estoque, natureza
  from est_entradas where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
  into :ndocto, :data_ent, :loc_estoque, :natureza;
  if( :loc_estoque = 1)then
    ORIGEM_FISCAL = 'F';
  else
    ORIGEM_FISCAL = '';

/*---------------[ verificando se altera prc de venda ]-------------------------*/
  select altera_preco_venda_ent from sis_empresas where cnpj = :cnpj  into :alt_prc_vnd;

/*---------------[ verificando se movimenta estoque ]---------------------------*/
  select coalesce(mov_estoque,'N'), coalesce(mov_estoque_fiscal,'N') from est_natureza where cnpj = :cnpj and codigo = :natureza
  into :mov_estoque, :mov_estoque_fiscal;

/*---------------[ Percorre ITENS ENTRADA ]-------------------------------------*/
  for select produto, unidade, quantidade, prc_unitario, descontos, prc_venda, lote, prc_custo
      from est_entradas_itens where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
      into :produto, :unidade, :qtdade, :prc_unit, :descontos, :prc_venda, :lote, :prc_custo
  do
  begin
      tag = 1;

      /*---------------[ unidade de conversao ]---------------------------------*/
      select prd.unidade, und_primaria, prd.fator_conversao from est_produtos prd
      where prd.codigo = :produto and prd.cnpj = :cnpj
      into :unidade_padrao, :und_primaria, :fator_conv_primaria;

      /*unidade padrão diferente da unidade de utilizada no fechamento*/
      if (:unidade <> :UNIDADE_PADRAO) then
      begin
        select cv.fator, cv.qtde from est_conversao_unid_med cv
        where cv.cnpj = :cnpj and cv.cod_und_padrao = :und_primaria and cv.cod_und_conversao = :unidade
        into :fator_conversao, :qtde_conversao;

        /*aqui neste caso teremos apenas o valor convertido para unidade primaria*/
        if (:fator_conversao = 1) then
          qtdade = (:qtdade / :qtde_conversao);
        else
          qtdade = (:qtdade * :qtde_conversao);

        /*valor unidade convertida para unidade padrão*/
        qtdade = (:qtdade / :fator_conv_primaria);
      end
  
      /*---------------[ montando o tipo de kardex ]----------------------------*/
      if (:mov_estoque = 'S') then
         tipo_kdx = 'E';
  
      if (:mov_estoque = 'N') then
         tipo_kdx = 'N';


      /* resgatando a qtdade atual do produto */
      select qtdade_2, qtdade_1, etiqueta_ent, nome from est_produtos
      where cnpj = :cnpj and codigo = :produto
      into :qtdade_ant, :qtdade_ant1, :etiqueta, :nome;
      
      if (qtdade_ant is null) then
        qtdade_ant = 0;
      if (qtdade_ant1 is null) then
        qtdade_ant1 = 0;
  
      ano = extract(year from :data_ent);
      mes = extract(month from :data_ent);
  
      if (etiqueta = 'S') then
         gergrade = 'N';
  
      select max(sequencia) from est_estiqueta_produto
      where cnpj = :cnpj into :sequencia ;
      if (sequencia is null) then
         sequencia = 0;


    /* grades */
    for select grade, numero, quantidade from est_entradas_itens_grades
         where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj and produto = :produto
    into :grade, :numero_grade, :quantidade_grade
    do
    begin
      if (quantidade_grade > 0) then
      begin
         /* atualiza a grade */
         update est_produtos_grades
         set estoque = estoque + :quantidade_grade
         where cnpj = :cnpj and produto = :produto and grade = :grade ;

         /* atualiza a grade e os numeros */
         update est_produtos_grades_numeros
         set estoque = estoque + :quantidade_grade
         where cnpj = :cnpj and produto = :produto and grade = :grade and
         numero = :numero_grade;

         gergrade = 'S';

         sequencia = sequencia + 1;

         /* gerou grade */
         insert into est_estiqueta_produto
         ( cnpj, codigo, nome, valor, quantidade, sequencia, grade, numero, ndocto, pessoa_fj)
         values
         ( :cnpj, :produto, :nome, :prc_venda, :quantidade_grade, :sequencia, :grade, :numero_grade, :ndocto, :pessoa_fj);
      end
    end

    /*este produto nao teve grade*/
    if (gergrade = 'N') then
    begin
      sequencia = sequencia + 1;

      insert into est_estiqueta_produto
      ( cnpj, codigo, nome, valor, quantidade, sequencia, ndocto, pessoa_fj )
      values
      ( :cnpj, :produto, :nome, :prc_venda, :qtdade, :sequencia, :ndocto, :pessoa_fj );
    end

    sequencia = :sequencia + 1;

    /* atualizando kardex */


    insert into est_kardex(cnpj, produto, ndocto, dt_movto, mes, ano, origem, tipo_es, pessoa_fj, qtdade_ant, qtdade, prc_unit, descontos, cfop, cfop_estoque, custo_medio)
    values (:cnpj, :produto, :ndocto, :data_ent, :mes, :ano,'ENT'||:ORIGEM_FISCAL, :tipo_kdx, :pessoa_fj, :qtdade_ant, :qtdade, :prc_unit, :descontos, :natureza, :mov_estoque, :customedio);
                        
    /*se movimenta fiscal, entao qtde fiscal recebe qtde*/
    if (:mov_estoque_fiscal = 'S') then
      qtdade_fiscal = :qtdade;

    /*se não movimenta fisico então zeramos o valor*/
    if (:mov_estoque = 'N')then
      qtdade = 0;

  /* atualizando produtos */

    update est_produtos set
           qtdade_1 = :qtdade_ant1 + :qtdade_fiscal,
           qtdade_2 = :qtdade_ant + :qtdade,
           ultimo_fornecedor = :pessoa_fj,
           fornecedor = :pessoa_fj,
           dt_ult_compra = :data_ent,
           qt_ult_compra = :qtdade
           where cnpj = :cnpj and
           codigo = :produto;

         
  /* Lotes */
  for select lt.lote, lt.quantidade from est_entradas_itens_lotes lt
     where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj and produto = :produto
     into :lt_codigo, :quantidade_lote
  do
  begin
    if (quantidade_lote > 0) then
    begin
      /* atualiza a grade */
      update est_lote_produto ltp
      set ltp.estoque = ltp.estoque + :quantidade_lote
      where ltp.cnpj = :cnpj and ltp.produto = :produto and ltp.codigo = :lt_codigo;
    end
  end

    /* atualizando preco de venda */
    if (:alt_prc_vnd = 'S')then
    begin
      update est_produtos set
          prc_venda_ant = prc_venda,
          prc_venda = :prc_venda,
          ultimo_fornecedor = :pessoa_fj
      where cnpj = :cnpj and codigo = :produto;
    end
  end/*fim for*/

  if (tag = 1) then
  begin
    update est_entradas set proc_qtd = 'S'
    where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj ;
  end
END
^

ALTER PROCEDURE ATUALIZA_BOLETO (
    CODIGO CHAR(3))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
     /* Buscando nº do boleto no banco*/
     select (coalesce(boleto,0) + 1) from  fin_banco
     where (codigo = :codigo)
     into :numero ;

     update fin_banco set boleto = :numero
     where (codigo = :codigo);
     
     suspend ;
END
^

ALTER PROCEDURE ATUALIZA_ESTOQUE_PRODUTO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4))
AS
begin
     UPDATE EST_PRODUTOS
     SET EST_PRODUTOS.qtdade_2 = :QUANTIDADE
     WHERE CNPJ =:CNPJ AND CODIGO = :PRODUTO ;

     suspend;
END
^

ALTER PROCEDURE ATUALIZA_GRUPOS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOMEG VARCHAR(50),
    NOMES VARCHAR(50))
AS
DECLARE VARIABLE QNTDE INTEGER;
begin
     SELECT COUNT(*) FROM
     EST_GRUPOS
     WHERE CNPJ = :CNPJ AND
     CODIGO = :GRUPO
     INTO :QNTDE ;

     IF ( QNTDE IS NULL )
     THEN BEGIN
          INSERT INTO EST_GRUPOS
          (CNPJ, CODIGO, NOME, BASE, MINIMO, MAXIMO )
          VALUES
          (:CNPJ, :CODIGO, :NOMEG, 3, 1, 2 );
     END

     SELECT COUNT(*) FROM
     EST_SUBGRUPOS
     WHERE CNPJ = :CNPJ AND
     GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
     INTO :QNTDE ;

     IF ( QNTDE IS NULL )
     THEN BEGIN
          INSERT INTO EST_SUBGRUPOS
          (CNPJ, GRUPO, SUBGRUPO, NOME, DESCONTO_MAX, DIGITA_PRC )
          VALUES
          (:CNPJ, :GRUPO, :SUBGRUPO, :NOMES, 0, 'N' );
     END

     UPDATE EST_PRODUTOS
     SET GRUPO = :GRUPO, SUBGRUPO = :SUBGRUPO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     suspend;
END
^

ALTER PROCEDURE ATUALIZA_ORCAMENTOS
AS
begin
     UPDATE FAT_ORCAMENTOS
     SET EXTERNO = 'N';

     UPDATE FAT_ORCAMENTOS_ITENS
     SET EXTERNO = 'N';

     suspend;
END
^

ALTER PROCEDURE ATUALIZA_ULTIMO_CHEQUE (
    CNPJ VARCHAR(14),
    CONTA INTEGER,
    CHEQUE INTEGER)
AS
BEGIN
     Update CTB_PLANOCONTA SET ULTIMO_CHEQUE = :CHEQUE
     Where CONTA = :CONTA and  CNPJ = :CNPJ;

     SUSPEND;
END
^

ALTER PROCEDURE ATUALIZA_VENDAS_FATURA_FUTURA
AS
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE FORMA INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE FFT CHAR(1);
begin
  /* ESTE PROCEDIMENTO SERA UTILIZADO APENAS PARA TRANSFORMAR AS VENDAS QUE AINDA NAO
  ESTO MARCADAS COMO FATURA FUTURA FFT E QUE ESTAO COM UMA FORMA DE PAGAMENTO DE FFT
  PARA O TIPO_VENDA = FFT */
  FOR SELECT CNPJ, CODIGO, FORMA_PGTO
  FROM FAT_VENDAS
  INTO :CNPJ, :VENDA, :FORMA DO
  BEGIN
       SELECT FATURA_FUTURA FROM FIN_FORMAS_PAGTO
       WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
       INTO :FFT ;

       IF ( FFT = 'S' )
       THEN BEGIN
            UPDATE FAT_VENDAS SET TIPO_VENDA = 'FFT'
            WHERE CNPJ = :CNPJ AND CODIGO = :VENDA ;
       END
  END

  /* REORDENA AS FATURAS ERRADAS */
  UPDATE FIN_FATURAS
  SET TIPO = 'PROTOCOLO'
  WHERE TIPO IS NULL ;

  /* REORDENA AS FATURAS ERRADAS */
  UPDATE FIN_FATURAS
  SET ENVIADA = 'N'
  WHERE ENVIADA IS NULL ;
END
^

ALTER PROCEDURE AUTENTICA_USUARIO (
    LOGIN VARCHAR(10),
    SENHA VARCHAR(20))
RETURNS (
    NOME VARCHAR(50),
    PERFIL INTEGER)
AS
begin
     FOR SELECT
     NOME, PERFIL FROM SIS_USUARIOS
     WHERE LOGIN = :LOGIN AND SENHA = :SENHA
     INTO :NOME, :PERFIL
     DO BEGIN
        suspend;
     END
END
^

ALTER PROCEDURE BAIXA_FATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANOREC SMALLINT;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE PORCENTAGEM NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CODIGOAUX INTEGER;
DECLARE VARIABLE AGRUPADORA INTEGER;
Begin
     /*empresa*/
     select tx_juros_ate, tipo_taxa from sis_empresas
     where cnpj = :cnpj
     into :taxa_juros, :tipo_juros ;

     /*dados da baixa*/
     ano = extract ( year from :data_baixa );
     
     select coalesce(ft.agrupadora,0) from fin_faturas ft
     where ft.codigo = :codigo and ft.cnpj = :cnpj
     into :agrupadora;

     if (:agrupadora > 0) then
       codigoaux = :agrupadora;
     else
       codigoaux = :codigo;

     /*apaga o contas recebidas parcial
     delete from  fin_baixas_receber
     where cnpj = :cnpj and fatura = :codigo ;*/

     /*contas a receber*/
     for select
          codigo, ano, pessoa_fj, dt_emissao, fatura,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, juros_rec, descontos, boleto, origem, codigo_vn,
          ano_vn, aviso, dt_aviso, vlr_parcial, nome, local_cobranca
     from fin_contas_receber
     where cnpj = :cnpj and fatura = :codigoaux
     into
          :codrec, :anorec, :pessoa_fj, :dt_emissao, :fatura,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :juros_rec, :descontos, :boleto, :origem, :codigo_vn, :ano_vn,
          :aviso, :dt_aviso, :vlr_parcial, :nome, :local_cobranca
     do begin
        /*origem = fft*/
        origem = 'FFT';

        /*codigo da baixa*/
        select codigo from gerar_codigo ('BAIXA_RECEBER', 1)
        into :codbx;
        
        /* porcentagem dos juros e dos descontos */
        PORCENTAGEM = ( :VALOR + :JUROS_REC - :DESCONTOS ) / :VALOR_BX ;
        
        IF ( :JUROS_REC IS NULL ) THEN
            JUROS_REC = 0;
        
        IF ( :DESCONTOS IS NULL )
        THEN
            DESCONTOS = 0;

        JUROS_REC = :JUROS_REC + ( :JUROS * :PORCENTAGEM );

        DESCONTOS = :DESCONTOS + ( :DESCONTO * :PORCENTAGEM );

        IF ( BANCO > 0 )
        THEN BEGIN
            INSERT INTO FIN_BAIXAS_RECEBER
            ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
            HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
            TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, FATURA, NOME, USUARIO, TURNO, CONTA, LOCAL_COBRANCA
            )
            VALUES
            (
            :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
            :HISTORICOBX, :valor_bx /*+ :JUROS_REC - :DESCONTOS*/, :JUROS_REC,
            :DESCONTOS, :PLANILHA,
            :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_VN,
            :ANO_VN, :AVISO, :DT_AVISO, :FATURA, :NOME, :USUARIO, :TURNO, :BANCO, :LOCAL_COBRANCA
            );
        END
        ELSE BEGIN
            INSERT INTO FIN_BAIXAS_RECEBER
            ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
            HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
            TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, FATURA, NOME, USUARIO, TURNO, CONTA, LOCAL_COBRANCA
            )
            VALUES
            (
            :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
            :HISTORICOBX, :valor_bx, :JUROS_REC,
            :DESCONTOS, :PLANILHA,
            :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_VN,
            :ANO_VN, :AVISO, :DT_AVISO, :FATURA, :NOME, :USUARIO, :TURNO, :CONTA, :LOCAL_COBRANCA
            );
        END
     

        /* APAGA O CONTAS A RECEBER
        Não pode apagar!! senão não da pra baixar mais
        DELETE FROM  FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC ;*/
        
     END /* FINAL DO LACO NO CONTAS A RECEBER */
     
     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF ((BANCO > 0) AND (BANCO <> CONTA))
     THEN BEGIN
          DOCTO = CAST(CODIGO AS VARCHAR(20));

          CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

          INSERT INTO CTB_MOVIMENTO_CONTABIL
          (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
          VALUES
          (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VALOR_BX + :JUROS - :DESCONTO , :BANCO, 'FAT', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );
     END

     /* ATUALIZA A FATURA */
     UPDATE FIN_FATURAS
     SET BAIXADA = 'S',
     DESCONTO = :DESCONTO,
     JUROS = :JUROS,
     DATA_BAIXA = :DATA_BAIXA, USUARIO = :USUARIO, TURNO = :TURNO,
     CONTA = :BANCO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO;
END
^

ALTER PROCEDURE BAIXA_FATURA_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4),
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE AGRUPADORA INTEGER;
DECLARE VARIABLE CODIGOAUX INTEGER;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE VALOR_ATUAL NUMERIC(18,4);
Begin
     /* BAIXA FATURA PARCIAL */
     CODBX = GEN_ID(FIN_FATURA_PARCIAL_GE, 1);

     VALOR_ATUAL = :VALOR_ANTERIOR + JUROS_RECEBIDOS - :VALOR_BX ;

     INSERT INTO FIN_FATURAS_PARCIAL (
     CNPJ,
     CODIGO,
     SEQUENCIA,
     HISTORICO,
     VALOR,
     DATA_CAIXA,
     USUARIO,
     CONTA,
     PLANILHA,
     VALOR_ANTERIOR,
     JUROS_RECEBIDOS,
     VALOR_ATUAL,
     TURNO,
     DESCONTOS_CONCEDIDOS)
     VALUES (
     :CNPJ,
     :CODIGO,
     :CODBX,
     :HISTORICOBX,
     :VALOR_BX,
     :DATA_BAIXA,
     :USUARIO,
     :CONTA,
     :PLANILHA,
     :VALOR_ANTERIOR,
     :JUROS_RECEBIDOS,
     :VALOR_ATUAL,
     :TURNO,
     :DESCONTOS_CONCEDIDOS
     );

     select coalesce(ft.agrupadora,0) from fin_faturas ft
     where ft.codigo = :codigo and ft.cnpj = :cnpj
     into :agrupadora;

     /*-----------código usado para manipular contas à receber------------*/
     if (:agrupadora > 0) then
      codigoaux = :agrupadora;
     else
      codigoaux = :codigo;
      
     select rec.codigo from fin_contas_receber rec
     where rec.fatura = :codigoaux
     into :codigoaux;

     /* FAZ A BAIXA PARCIAL DAS FATURAS
     EXECUTE PROCEDURE BAIXA_RECEBER_FATURA_PARC o IAL */
     EXECUTE PROCEDURE baixa_fatura_parcial_adm
     (
      :CNPJ, :HISTORICOBX, :USUARIO, :DATA_BAIXA, :JUROS_RECEBIDOS, :DESCONTOS_CONCEDIDOS,
      :VALOR_BX, :PLANILHA, :TURNO, :codigoaux, :CONTA,:banco );

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF ((BANCO > 0) AND (BANCO <> CONTA))
     THEN BEGIN
          CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

          DOCTO = CAST(:CODIGO AS VARCHAR(20));

          INSERT INTO CTB_MOVIMENTO_CONTABIL
          (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC )
          VALUES
          (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VALOR_BX , :BANCO, 'FAT', :PLANILHA, 'A', 'DPL' );
     END

     /* ATUALIZA A FATURA */
     UPDATE FIN_FATURAS
     SET VALOR = VALOR - :VALOR_BX + :JUROS_RECEBIDOS - :DESCONTOS_CONCEDIDOS,
     ULTIMA_BX_PARCIAL = :DATA_BAIXA
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO;
END
^

ALTER PROCEDURE BAIXA_FATURA_PARCIAL_ADM (
    CNPJ CHAR(14),
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    CODIGO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE CONTROLARECEBER CHAR(1);
DECLARE VARIABLE ANO INTEGER;
begin
    /*Dados sobre juros*/
    select tx_juros_ate, tipo_taxa from sis_empresas emp
    where cnpj = :cnpj
    into :taxa_juros, :tipo_juros;

    /* Se Controla contas à Receber no Caixa para cadastrarmos a dt. baixa
    igual a dt. do Caixa*/
    select coalesce(emp.cx_receber_caixa,'N') from sis_empresas emp
    into :controlareceber;

    ano = extract ( year from :data_baixa );

    /* soma total baixada */
    /* valor q ainda poderá ser usado para baixar */
    EXECUTE PROCEDURE  BAIXA_RECEBER_PARCIAL_ADM
    (
     :CNPJ,
     :CODIGO,
     :ANO,
     :HISTORICOBX,
     :USUARIO,
     :DATA_BAIXA,
     :TOTAL,
     :juros,
     :DESCONTOS,
     :PLANILHA,
     :CONTA,
     :TURNO,
     :BANCO
     );
END
^

ALTER PROCEDURE BAIXA_PAGAR (
    CNPJ CHAR(14),
    CODPAG INTEGER,
    ANOPAG SMALLINT,
    HISTORICOBX VARCHAR(100),
    DATA_BAIXA DATE,
    USUARIO INTEGER,
    VALOR_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_PGR NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_ENT INTEGER;
DECLARE VARIABLE ANO_ENT SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE DUPLICATA VARCHAR(15);
DECLARE VARIABLE CONFERIDA CHAR(1);
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE CODIGO_CONTABIL INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* BANCO DA BAIXA */
     CODIGO_CONTABIL = :BANCO ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* CONTAS A PAGAR */
     SELECT
          PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, JUROS_PAG, DESCONTOS, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT,
          AVISO, DT_AVISO,  VLR_PARCIAL, NOME, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
          TOTAL_ENTRADA, CONTABILIDADE, codigo_vn,
          cod_indexador, idx_database, idx_cotacao, idx_qtde
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODPAG AND ANO = :ANOPAG
     INTO
          :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :JUROS_PGR, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT,
          :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :CENTRO_CUSTO,
          :DUPLICATA, :CONFERIDA, :TOTAL_ENTRADA, :CODIGO_CONTABIL, :codigo_vn,
          :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde ;

     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_PAGAR',1)
     into :CODBX;

     INSERT INTO FIN_BAIXAS_PAGAR
     ( CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, DT_BAIXA,
       HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
       TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
       DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
       VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT,
       ANO_ENT, AVISO, DT_AVISO, NOME, CENTRO_CUSTO, USUARIO, DUPLICATA, CONFERIDA,
       CONTA, TOTAL_ENTRADA, TURNO, CONTABILIDADE, codigo_vn,
       cod_indexador, idx_database, idx_cotacao, idx_qtde
     )
     VALUES
     (
       :CNPJ, :CODBX, :ANO, :CODPAG, :ANOPAG, :DATA_BAIXA,
       :HISTORICOBX, :VALOR_BX + :JUROS - :DESCONTO, :JUROS, :DESCONTO, :PLANILHA,
       :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
       :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
       :VALOR, :VLR_PARCIAL, :JUROS_PGR, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_ENT,
       :ANO_ENT, :AVISO, :DT_AVISO, :NOME, :CENTRO_CUSTO, :USUARIO, :DUPLICATA, :CONFERIDA,
       :CONTA, :TOTAL_ENTRADA,  :TURNO, :CODIGO_CONTABIL, :codigo_vn,
       :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     );
     

     execute procedure pcd_ctb_lanca_contab_pagar(:cnpj,
       :codpag, :anopag, :VALOR_BX + :JUROS - :DESCONTO, :data_baixa, :docto,
       :historicobx, :conta, :planilha, :pessoa_fj);
     
     /* APAGA O CONTAS A PAGAR */
     DELETE FROM  FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODPAG AND ANO = :ANOPAG ;

     suspend;
END
^

ALTER PROCEDURE BAIXA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODPAG INTEGER,
    ANOPAG SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_BX_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_PAG NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_PAG NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_ENT INTEGER;
DECLARE VARIABLE ANO_ENT SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE CODIGO_CONTABIL INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     if(:banco is null) then
       banco = 0;
     /* CONTAS A PAGAR */
     SELECT
          PESSOA_FJ, DT_EMISSAO, VALOR, JUROS_PAG, DESCONTOS,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO, VLR_PARCIAL,
          NOME, CENTRO_CUSTO, TOTAL_ENTRADA, codigo_vn
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODPAG AND ANO = :ANOPAG
     INTO
          :PESSOA_FJ, :DT_EMISSAO, :VALOR, :JUROS_PAG, :DESCONTOS_PAG,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO, :PARCIAL,
          :NOME, :CENTRO_CUSTO, :TOTAL_ENTRADA, :codigo_vn;
          
     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_PAGAR',1)
     into :CODBX;

     INSERT INTO FIN_BAIXAS_PAGAR
     ( CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, DT_BAIXA,
       HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
       TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
       DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
       VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
       DT_AVISO, VLR_BAIXA, JUROS_PAG, DESCONTOS_PAG, NOME, CENTRO_CUSTO,
       USUARIO, CONTA, TOTAL_ENTRADA, TURNO, CONTABILIDADE, codigo_vn
     )
     VALUES
     (
       :CNPJ, :CODBX, :ANO, :CODPAG, :ANOPAG, :DATA_BAIXA,
       :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
       :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
       :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
       :VALOR, :PARCIAL, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
       :DT_AVISO, :VLR_BX_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :NOME, :CENTRO_CUSTO,
       :USUARIO, :CONTA, :TOTAL_ENTRADA, :TURNO, :BANCO, :codigo_vn
     );
     
     execute procedure pcd_ctb_lanca_contab_pagar(:cnpj,
       :codpag, :anopag, :vlr_BX_parcial, :data_baixa, :docto,
       :historicobx, :BANCO, :planilha, :pessoa_fj);

     /* APAGA O CONTAS A PAGAR */
     UPDATE FIN_CONTAS_PAGAR SET VLR_PARCIAL = VLR_PARCIAL + :VLR_BX_PARCIAL + :DESCONTO,
     JUROS_PAG = JUROS_PAG + :JUROS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODPAG AND ANO = :ANOPAG ;

     suspend;
END
^

ALTER PROCEDURE BAIXA_PAGAR_SELECAO (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    CHEQUE INTEGER,
    BANCO CHAR(3),
    TURNO INTEGER,
    CONTA_BANCO INTEGER,
    CAIXA CHAR(1))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE PORCENT NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODPAG INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_PAG NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_PAG NUMERIC(18,4);
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_ENT INTEGER;
DECLARE VARIABLE ANO_ENT SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE DOCTOBAIXA VARCHAR(20);
DECLARE VARIABLE CHEQUESTR VARCHAR(6);
DECLARE VARIABLE CODIGO_CONTABIL INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /* EMPRESA */
     select tx_juros_ate, tipo_taxa from sis_empresas E
     where cnpj = :cnpj into :taxa_juros, :tipo_juros;

     /* DADOS DA BAIXA */
     ano = extract ( year from :data_baixa );

     /* BANCO DA BAIXA */
     if (conta_banco > 0) THEN
       codigo_contabil = :conta_banco;
     else
       codigo_contabil = 0;

     doctobaixa = '' ;

     if (tipo = 'Lancamento') then
     begin
          /* CONTAS A PAGAR */
          for select codigo, ano, pessoa_fj, dt_emissao,
              dt_vencto, dt_lancto, docto, parcela, historico,
              (valor), juros_pag, descontos, boleto, origem, codigo_ent, ano_ent,
              aviso, dt_aviso, vlr_parcial, nome, centro_custo, total_entrada,
              contabilidade, CODIGO_VN,
               cod_indexador, idx_database, idx_cotacao, idx_qtde
          from fin_contas_pagar
              where cnpj = :cnpj and pessoa_fj = :cliente  and
              selecionado = 'S' and dt_lancto >= :data_inicial and
              dt_lancto <= :data_final
          into
               :codpag, :ano, :pessoa_fj, :dt_emissao,
               :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
               :valor, :juros_pag, :descontos_pag, :boleto, :origem, :codigo_ent, :ano_ent,
               :aviso, :dt_aviso, :vlr_parcial, :nome, :centro_custo, :total_entrada,
               :codigo_contabil, :CODIGO_VN,
               :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
          do
          begin
             if (( cheque is null ) or ( cheque = 0 )) then
                doctobaixa = :docto;
             else
             begin
                  chequestr = cast ( cheque as varchar(6));

                  select str from completaesq (:chequestr, '0', 6)
                  into :chequestr ;

                  select str from completa (:docto, ' ', 13)
                  into :docto ;

                  doctobaixa = substring(:docto || ' ' || :chequestr from 1 for 20);
                  doctobaixa = substring(:doctobaixa from 1 for 20);
             end

             /* total = 100%, entao o valor da conta é igual a x % */
             porcent = (:valor * 100.00) / :total ;
             valor_bx = (:valor - :vlr_parcial);
             juros_bx = (:juros * :porcent)/100.00 ;
             desc_bx  = (:desconto * :porcent)/100.00 ;
             soma     = (:valor_bx + :juros_bx - :desc_bx) ;


             /* codigo da baixa */
             select codigo from gerar_codigo ('BAIXA_PAGAR',1)
             into :codbx;

             insert into fin_baixas_pagar
             ( cnpj, codigo, ano, codigo_pg, ano_pg, dt_baixa,
             historico_bx, vlr_baixa, juros, descontos, planilha,
             taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
             dt_vencto, dt_lancto, docto, parcela, historico,
             valor, vlr_parcial, juros_pag, descontos_pag, boleto, origem, codigo_ent,
             ano_ent, aviso, dt_aviso, nome, centro_custo, usuario, conta, total_entrada,
             turno, contabilidade, codigo_vn,
             cod_indexador, idx_database, idx_cotacao, idx_qtde
             )
             values
             (
             :cnpj, :codbx, :ano, :codpag, :ano, :data_baixa,
             :historicobx, :valor_bx + :juros_bx - :desc_bx, :juros_bx, :desc_bx, :planilha,
             :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
             :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
             :valor, :vlr_parcial, :juros_pag, :descontos_pag, :boleto, :origem, :codigo_ent,
             :ano_ent, :aviso, :dt_aviso, :nome, :centro_custo, :usuario, :conta, :total_entrada,
             :turno, :codigo_contabil, :codigo_vn,
             :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
             );
             
             /* APAGA O CONTAS A PAGAR */
             delete from  fin_contas_pagar
             where cnpj = :cnpj and codigo = :codpag and ano = :ano ;
        END
     END
     ELSE BEGIN
          /* CONTAS A PAGAR */
          FOR SELECT
              CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
              DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
              VALOR, JUROS_PAG, DESCONTOS, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO,
              VLR_PARCIAL, NOME, CENTRO_CUSTO, TOTAL_ENTRADA, CONTABILIDADE, codigo_vn,
              cod_indexador, idx_database, idx_cotacao, idx_qtde
          FROM FIN_CONTAS_PAGAR
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
          SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
          DT_VENCTO <= :DATA_FINAL
          INTO
               :CODPAG, :ANO, :PESSOA_FJ, :DT_EMISSAO,
               :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
               :VALOR, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT,
               :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :CENTRO_CUSTO, :TOTAL_ENTRADA,
               :CODIGO_CONTABIL, :codigo_vn,
               :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
          DO BEGIN
             IF (( CHEQUE IS NULL ) OR ( CHEQUE = 0 ))
             THEN BEGIN
                  DOCTOBAIXA = :docto;
             END
             ELSE BEGIN
                  CHEQUESTR = CAST ( CHEQUE AS VARCHAR(6));

                  SELECT STR FROM COMPLETAESQ (:CHEQUESTR, '0', 6)
                  INTO :CHEQUESTR ;

                  SELECT STR FROM COMPLETA (:DOCTO, ' ', 13)
                  INTO :DOCTO ;

                  DOCTOBAIXA = substring(:docto || ' ' || :CHEQUESTR from 1 for 20);

                  DOCTOBAIXA = substring(:DOCTOBAIXA from 1 for 20);
             END
             /* TOTAL = 100%, ENTAO O VALOR DA CONTA É IGUAL A X % */
             PORCENT = (:VALOR * 100.00) / :TOTAL ;

             VALOR_BX = (:valor - :vlr_parcial);

             JUROS_BX = (:JUROS * :PORCENT)/100.00 ;
             
             DESC_BX  = (:DESCONTO * :PORCENT)/100.00 ;

             SOMA     = (:VALOR_BX + :JUROS_BX - :DESC_BX) ;

            /* execute procedure pcd_ctb_lanca_contab_pagar(:cnpj, :codpag, :ano,
               :soma, :data_baixa, :doctobaixa, :historicobx, :conta, :planilha, :pessoa_fj);  */

             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_PAGAR',1)
             into :CODBX;

             INSERT INTO FIN_BAIXAS_PAGAR
             ( CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, DT_BAIXA,
             HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
             TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
             DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
             VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT,
             ANO_ENT, AVISO, DT_AVISO, NOME, CENTRO_CUSTO, USUARIO, CONTA, TOTAL_ENTRADA ,
             TURNO, CONTABILIDADE, codigo_vn,
             cod_indexador, idx_database, idx_cotacao, idx_qtde
             )
             VALUES
             (
             :CNPJ, :CODBX, :ANO, :CODPAG, :ANO, :DATA_BAIXA,
             :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
             :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
             :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
             :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT,
             :ANO_ENT, :AVISO, :DT_AVISO, :NOME, :CENTRO_CUSTO, :USUARIO, :CONTA, :TOTAL_ENTRADA,
             :TURNO, :CODIGO_CONTABIL, :codigo_vn,
             :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
             );
             /* APAGA O CONTAS A PAGAR */
             DELETE FROM  FIN_CONTAS_PAGAR
             WHERE CNPJ = :CNPJ AND CODIGO = :CODPAG AND ANO = :ANO ;
        END
     END
     /* INSERE NOS MOVIMENTOS BANCARIOS */
     /* O VALOR TOTAL DA BAIXA, POIS ACIMA ELE DESDOBRA NO CENTRO DE CUSTO */
     if (caixa = 'N') then
     begin
       SOMA = :TOTAL + :JUROS - :DESCONTO ;

       CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

       INSERT INTO CTB_MOVIMENTO_CONTABIL
       (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR, BANCO, DATA_CONCILIACAO )
       VALUES
       (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'D', :DOCTOBAIXA, :HISTORICOBX, :SOMA, :conta, 'PGR', :PLANILHA, 'A', 'DPL', :PESSOA_FJ, :BANCO, NULL );

    END
   suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VALOR_BX NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* CONTAS A RECEBER */
     SELECT
          PESSOA_FJ, DT_EMISSAO, FATURA,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
          VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR, LOCAL_COBRANCA, CODIGO_TRC,
          cod_indexador, idx_database, idx_cotacao, idx_qtde
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC
     INTO
          :PESSOA_FJ, :DT_EMISSAO, :FATURA,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
          :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
          :LOCAL_COBRANCA, CODIGO_TRC,
          :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde;

     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
     into :CODBX;

     IF ( BANCO > 0 )
     THEN BEGIN
        INSERT INTO FIN_BAIXAS_RECEBER
        ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
          ANO_VN, AVISO, DT_AVISO, FATURA, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
          CONTA, TURNO, COBRADOR, LOCAL_COBRANCA, CODIGO_TRC,
          cod_indexador, idx_database, idx_cotacao, idx_qtde
        )
        VALUES
        (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :VALOR_BX + :JUROS - :DESCONTO, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_VN,
          :ANO_VN, :AVISO, :DT_AVISO, :FATURA, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
          :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA, :CODIGO_TRC,
          :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
        );
     END
     ELSE BEGIN
        INSERT INTO FIN_BAIXAS_RECEBER
        ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
          ANO_VN, AVISO, DT_AVISO, FATURA, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
          CONTA, TURNO, COBRADOR, LOCAL_COBRANCA, codigo_trc,
          cod_indexador, idx_database, idx_cotacao, idx_qtde
        )
        VALUES
        (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :VALOR_BX + :JUROS - :DESCONTO, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM, :CODIGO_VN,
          :ANO_VN, :AVISO, :DT_AVISO, :FATURA, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
          :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA, :codigo_trc,
          :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
        );
     END

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF (( BANCO > 0) AND ( BANCO <> CONTA ))THEN
     BEGIN
      CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

      INSERT INTO CTB_MOVIMENTO_CONTABIL
      (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
      VALUES
      (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :DINHEIRO , :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );

     END
     
     /* APAGA O CONTAS A RECEBER */
     DELETE FROM  FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC ;

     suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE PORCENT NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF ((BANCO > 0) AND ( BANCO <> CONTA )) THEN
     BEGIN
       CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

      INSERT INTO CTB_MOVIMENTO_CONTABIL
      (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
      VALUES
      (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :TOTAL, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );

     END

     FOR SELECT CODIGO FROM GLO_PESSOAS_FJ
     WHERE ( CNPJ = :CNPJ AND CODIGO = :CLIENTE )
     INTO :PESSOA_FJ DO
     BEGIN
         /* CONTAS A RECEBER */
         FOR SELECT
             CODIGO, ANO, DT_EMISSAO,
             DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
             VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
             VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR, LOCAL_COBRANCA
         FROM FIN_CONTAS_RECEBER
         WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ  AND
         SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
         DT_VENCTO <= :DATA_FINAL AND FATURA IS NULL
         INTO
             :CODREC, :ANO, :DT_EMISSAO,
             :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
             :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
             :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR, :LOCAL_COBRANCA
         DO BEGIN
             /* TOTAL = 100%, ENTAO O VALOR DA CONTA É IGUAL A X % */
             PORCENT = (:VALOR) / :TOTAL ;
             
             VALOR_BX = :TOTAL * :PORCENT ;
             
             JUROS_BX = :JUROS * :PORCENT ;
             
             DESC_BX  = :DESCONTO * :PORCENT ;
          
             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             into :CODBX;

             IF ( BANCO > 0 )
             THEN BEGIN
                 INSERT INTO FIN_BAIXAS_RECEBER
                 ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                 HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                 TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                 DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                 VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                 ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                 CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                 )
                 VALUES
                 (
                 :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                 :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                 :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                 :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                 :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                 :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                 :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                 );
             END
             ELSE BEGIN
                 INSERT INTO FIN_BAIXAS_RECEBER
                 ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                 HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                 TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                 DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                 VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                 ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                 CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                 )
                 VALUES
                 (
                 :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                 :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                 :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                 :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                 :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                 :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                 :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                 );
             END
             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;
        END
     END

     /* CONVENIADOS AO CLIENTE SELECIONADO */
     FOR SELECT CODIGO FROM GLO_PESSOAS_FJ
     WHERE ( CNPJ = :CNPJ AND CONVENIO = :CLIENTE )
     INTO :PESSOA_FJ DO
     BEGIN
         /* CONTAS A RECEBER */
         FOR SELECT
             CODIGO, ANO, DT_EMISSAO,
             DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
             VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
             VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR, LOCAL_COBRANCA
         FROM FIN_CONTAS_RECEBER
         WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ  AND
         SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
         DT_VENCTO <= :DATA_FINAL AND FATURA IS NULL
         INTO
             :CODREC, :ANO, :DT_EMISSAO,
             :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
             :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
             :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
             :LOCAL_COBRANCA
         DO BEGIN
             /* TOTAL = 100%, ENTAO O VALOR DA CONTA É IGUAL A X % */
             PORCENT = (:VALOR) / :TOTAL ;

             VALOR_BX = :TOTAL * :PORCENT ;
             
             JUROS_BX = :JUROS * :PORCENT ;
             
             DESC_BX  = :DESCONTO * :PORCENT ;
          
             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             into :CODBX;
                
             IF ( BANCO > 0 )
             THEN BEGIN
                 INSERT INTO FIN_BAIXAS_RECEBER
                 ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                 HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                 TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                 DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                 VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                 ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                 TURNO, COBRADOR, CONTA, LOCAL_COBRANCA
                 )
                 VALUES
                 (
                 :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                 :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                 :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                 :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                 :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                 :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                 :TURNO, :COBRADOR, :BANCO, :LOCAL_COBRANCA
                 );
             END
             ELSE BEGIN
                 INSERT INTO FIN_BAIXAS_RECEBER
                 ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                 HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                 TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                 DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                 VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                 ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                 TURNO, COBRADOR, CONTA, LOCAL_COBRANCA
                 )
                 VALUES
                 (
                 :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                 :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                 :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                 :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                 :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                 :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                 :TURNO, :COBRADOR, :CONTA, :LOCAL_COBRANCA
                 );
             END


             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;
        END
    END

  suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER_FATURA_PARCIAL (
    CNPJ CHAR(14),
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    TURNO INTEGER,
    FATURA INTEGER,
    CONTA INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE SOMATOTAL NUMERIC(18,4);
DECLARE VARIABLE RESTANTE NUMERIC(18,4);
DECLARE VARIABLE NUM_PARCELAS INTEGER;
DECLARE VARIABLE PORC NUMERIC(18,4);
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* SOMA TOTAL BAIXADA */
     SOMATOTAL = 0;

     /* VALOR Q AINDA PODERA SER BAIXADO */
     RESTANTE = TOTAL;

     /* VERIFICA SE A FATURA TINHA NO MINIMO UMA NOTA PARA QUITAÇÃO */
     NUM_PARCELAS = 0;

     /* CONTAS A RECEBER */
     FOR SELECT
         CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
         DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
         VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN,
         AVISO, DT_AVISO, VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR,
         LOCAL_COBRANCA
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FATURA
     INTO
         :CODREC, :ANO, :PESSOA_FJ, :DT_EMISSAO,
         :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
         :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
         :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
         :LOCAL_COBRANCA
     DO BEGIN
        VALOR_BX = :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS ;

        /* CALCULANDO A PORCENTAGEM */
        PORC = VALOR_BX / TOTAL ;

        JUROS_BX = PORC * JUROS ;
        DESC_BX  = PORC * DESCONTOS ;

        IF ( :RESTANTE >= :VALOR_BX )
        THEN BEGIN

             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             INTO :CODBX;

             IF ( VALOR_BX > 0 )
             THEN BEGIN   
                  IF ( BANCO > 0 )
                  THEN BEGIN
                       INSERT INTO FIN_BAIXAS_RECEBER
                       ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                       HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                       TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                       DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                       VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                       ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                       CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                       )
                       VALUES
                       (
                       :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                       :HISTORICOBX, :VALOR_BX , :JUROS_BX, :DESC_BX, :PLANILHA,
                       :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                       :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                       :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                       :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                       :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                       );
                  END
                  ELSE BEGIN
                       INSERT INTO FIN_BAIXAS_RECEBER
                       ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                       HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                       TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                       DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                       VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                       ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                       CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                       )
                       VALUES
                       (
                       :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                       :HISTORICOBX, :VALOR_BX , :JUROS_BX, :DESC_BX, :PLANILHA,
                       :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                       :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                       :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                       :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                       :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                       );
                  END
             END
             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;

             /* ACUMULA O TOTAL BAIXADO */
             SOMATOTAL = :SOMATOTAL + :VALOR_BX;

             RESTANTE = :RESTANTE - :VALOR_BX ;
        END
        ELSE BEGIN
             IF ( RESTANTE > 0 )
             THEN BEGIN
                  /* CALCULANDO A PORCENTAGEM */
                  PORC = RESTANTE / TOTAL ;

                  JUROS_BX = PORC * JUROS ;
                  DESC_BX  = PORC * DESCONTOS ;

                  EXECUTE PROCEDURE  BAIXA_RECEBER_PARCIAL
                  (
                  :CNPJ,
                  :CODREC,
                  :ANO,
                  :HISTORICOBX,
                  :USUARIO,
                  :DATA_BAIXA,
                  :RESTANTE,
                  :JUROS_BX,
                  :DESC_BX,
                  :PLANILHA,
                  :CONTA,
                  :TURNO,
                  :BANCO
                  );

                  RESTANTE = 0;
             END
        END

        NUM_PARCELAS = NUM_PARCELAS + 1;

     END
END
^

ALTER PROCEDURE BAIXA_RECEBER_PARCIAL (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* CONTAS A RECEBER */
     SELECT
          PESSOA_FJ, DT_EMISSAO, VALOR, JUROS_REC, DESCONTOS,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_PARCIAL, FATURA, NOME, NUMBOLETO, NUMDUPLICATA,
          COBRADOR, LOCAL_COBRANCA
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC
     INTO
          :PESSOA_FJ, :DT_EMISSAO, :VALOR, :JUROS_REC, :DESCONTOS_REC,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO,
          :PARCIAL, :FATURA, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
          :LOCAL_COBRANCA;
     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
     INTO :CODBX;

     IF ( :BANCO > 0 )
     THEN BEGIN
          INSERT INTO FIN_BAIXAS_RECEBER
          ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_BAIXA, JUROS_REC, DESCONTOS_REC, FATURA, NOME,
          USUARIO, NUMBOLETO, NUMDUPLICATA, CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
          )
          VALUES
          (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
          :DT_AVISO, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :FATURA, :NOME,
          :USUARIO, :NUMBOLETO, :NUMDUPLICATA, :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA
          );
     END
     ELSE BEGIN
          INSERT INTO FIN_BAIXAS_RECEBER
          ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_BAIXA, JUROS_REC, DESCONTOS_REC, FATURA, NOME,
          USUARIO, NUMBOLETO, NUMDUPLICATA, CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
          )
          VALUES
          (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
          :DT_AVISO, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :FATURA, :NOME,
          :USUARIO, :NUMBOLETO, :NUMDUPLICATA, :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA
          );
     END

     
     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF (( BANCO > 0) AND ( BANCO <> CONTA )) THEN
     BEGIN
       CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

       INSERT INTO CTB_MOVIMENTO_CONTABIL
       (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
       VALUES
       (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VLR_PARCIAL, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );

     END

     /* APAGA O CONTAS A RECEBER */
     UPDATE FIN_CONTAS_RECEBER SET VLR_PARCIAL = VLR_PARCIAL + :VLR_PARCIAL,
     JUROS_REC = JUROS_REC + :JUROS, DESCONTOS = DESCONTOS + :DESCONTO,
     DATA_ULT_BAIXA = :DATA_BAIXA
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC ;
END
^

ALTER PROCEDURE BAIXA_RECEBER_PARCIAL_ADM (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_BX_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE JUROS_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE VALOR_MULTA NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE ALT_VLR_ORIG CHAR(1);
DECLARE VARIABLE DESTINO INTEGER;
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
Begin
     /* EMPRESA */
     select tx_juros_ate, tipo_taxa from sis_empresas
     where cnpj = :cnpj
     into :taxa_juros, :tipo_juros ;

     /* dados da baixa */
     ano = extract ( year from :data_baixa );

     /* contas a receber */
     select
          pessoa_fj, dt_emissao, valor, juros_rec, descontos,
          dt_vencto, dt_lancto, docto, parcela, historico,
          boleto, origem, codigo_vn, ano_vn, aviso, dt_aviso,
          vlr_parcial, fatura, nome, numboleto, numduplicata,
          cobrador, local_cobranca, juros_parcial,codigo_trc
     from fin_contas_receber
     where cnpj = :cnpj and codigo = :codrec and ano = :anorec
     into
          :pessoa_fj, :dt_emissao, :valor, :juros_rec, :descontos_rec,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :boleto, :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso,
          :parcial, :fatura, :nome, :numboleto, :numduplicata,
          :cobrador, :local_cobranca, :juros_parcial,:codigo_trc ;
          
     /* CODIGO DA BAIXA */
     select codigo from gerar_codigo ('BAIXA_RECEBER',1)
     into :codbx;

     /*quando o juros a ser baixado for mairo que o vlr. que temos em mãos p/realizar a baixa*/
     if (:juros_parcial > :vlr_BX_parcial) then
      alt_vlr_orig = 'S';
     else
      alt_vlr_orig = 'N';

      
     if ( :banco > 0 ) then
       destino = :banco;
     else
       destino = :conta;



     INSERT INTO FIN_BAIXAS_RECEBER
     ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
     HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
     TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
     DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
     VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
     DT_AVISO, VLR_BAIXA, JUROS_REC, DESCONTOS_REC, FATURA, NOME,
     USUARIO, NUMBOLETO, NUMDUPLICATA, CONTA, TURNO, COBRADOR, LOCAL_COBRANCA,codigo_trc, vlr_orig_alt
     )
     VALUES
     (
     :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
     :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
     :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
     :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
     :VALOR, :PARCIAL, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
     :DT_AVISO, :VLR_BX_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :FATURA, :NOME,
     :USUARIO, :NUMBOLETO, :NUMDUPLICATA, :destino, :TURNO, :COBRADOR, :LOCAL_COBRANCA,:codigo_trc, :alt_vlr_orig
     );


     /*A multa já e calculada na função da aplicação que seta o vlr. :juros-bx portanto já esta embutida
     mas não quero excluir o código, por isso estou gerando*/
     valor_multa = 0;

      /*se o juro devido e maior que vlr que temos p/baixar entao vamos baixar primeiro os juro, acrescentando o valor da baixa
     aos juros recebidos*/
     if (:juros_parcial > :vlr_bx_parcial) then
     begin
       /*atualizo o vlr da conta, para podermos utilizar a dt. ult baixa*/
       UPDATE FIN_CONTAS_RECEBER r SET
       JUROS_REC = JUROS_REC + :vlr_bx_parcial, DESCONTOS = DESCONTOS + :DESCONTO, /*Temos de Acrescer a multa ao recompor o valor da conta*/
       DATA_ULT_BAIXA = :DATA_BAIXA, vlr_orig_alt = 'S', r.valor = ((r.valor + :valor_multa) + (:juros_parcial - :vlr_bx_parcial))
       WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC ;
     end
     else /*se o vlr que temos e maior que os juros entao*/
     begin
       select sai from Round2(:valor_multa)
       into :valor_multa;

       select sai from Round2(:vlr_bx_parcial)
       into :vlr_bx_parcial;

       /*Desconto porque depois que eu pagar parte da  conta o jrs. e multa desaparecerão*/
       vlr_parcial = :vlr_bx_parcial - :juros_parcial - :valor_multa;

       /* Pago todo o juro, e o que sobra pago a conta*/
       update fin_contas_receber rec set rec.vlr_parcial = (rec.vlr_parcial + :vlr_parcial + :desconto),
       rec.data_ult_baixa = :data_baixa,
       juros_rec = juros_rec + :juros
       where cnpj = :cnpj and codigo = :codrec and ano = :anorec ;
     end
END
^

ALTER PROCEDURE BAIXA_RECEBER_PARCIAL_PDV (
    CNPJ CHAR(14),
    CODREC INTEGER,
    ANOREC SMALLINT,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* CONTAS A RECEBER */
     SELECT
          PESSOA_FJ, DT_EMISSAO, VALOR, JUROS_REC, DESCONTOS,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_PARCIAL, FATURA, NOME, NUMBOLETO, NUMDUPLICATA,
          COBRADOR, LOCAL_COBRANCA, CODIGO_TRC
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC
     INTO
          :PESSOA_FJ, :DT_EMISSAO, :VALOR, :JUROS_REC, :DESCONTOS_REC,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO,
          :PARCIAL, :FATURA, :NOME, :NUMBOLETO, :NUMDUPLICATA,
          :COBRADOR, :LOCAL_COBRANCA, :CODIGO_TRC ;
          
     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
     INTO :CODBX;

     IF ( :BANCO > 0 )
     THEN BEGIN
          INSERT INTO FIN_BAIXAS_RECEBER
          ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_BAIXA, JUROS_REC, DESCONTOS_REC, FATURA, NOME,
          USUARIO, NUMBOLETO, NUMDUPLICATA, CONTA, TURNO, COBRADOR,
          LOCAL_COBRANCA, CODIGO_TRC
          )
          VALUES
          (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
          :DT_AVISO, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :FATURA, :NOME,
          :USUARIO, :NUMBOLETO, :NUMDUPLICATA, :BANCO, :TURNO, :COBRADOR,
          :LOCAL_COBRANCA, :CODIGO_TRC
          );
     END
     ELSE BEGIN
          INSERT INTO FIN_BAIXAS_RECEBER
          ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
          HISTORICO_BX, JUROS, DESCONTOS, PLANILHA,
          TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
          DT_AVISO, VLR_BAIXA, JUROS_REC, DESCONTOS_REC, FATURA, NOME,
          USUARIO, NUMBOLETO, NUMDUPLICATA, CONTA, TURNO, COBRADOR,
          LOCAL_COBRANCA, CODIGO_TRC
          )
          VALUES
          (
          :CNPJ, :CODBX, :ANO, :CODREC, :ANOREC, :DATA_BAIXA,
          :HISTORICOBX, :JUROS, :DESCONTO, :PLANILHA,
          :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
          :DT_AVISO, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :FATURA, :NOME,
          :USUARIO, :NUMBOLETO, :NUMDUPLICATA, :CONTA, :TURNO, :COBRADOR,
          :LOCAL_COBRANCA,:CODIGO_TRC
          );
     END
     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF (( BANCO > 0) AND ( BANCO <> CONTA ))
     THEN BEGIN
          CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

          INSERT INTO CTB_MOVIMENTO_CONTABIL
          (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
          VALUES
          (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VLR_PARCIAL, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );
     END

     /* APAGA O CONTAS A RECEBER */
     /*VLR_PARCIAL = VLR_PARCIAL + :VLR_PARCIAL, passei a baixa o vlr de juros e nao o da conta*/
     UPDATE FIN_CONTAS_RECEBER SET
     JUROS_REC = JUROS_REC + :vlr_parcial, DESCONTOS = DESCONTOS + :DESCONTO/*,
     DATA_ULT_BAIXA = :DATA_BAIXA e retirei tambem a ultima baixa, q inibe o calculo de juros*/
     WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANOREC ;

     /* O VALOR MINIMO COBRADO DEVE SER O VALOR DOS JUROS ATE HOJE */
     /* este código fazia com que todas as contas a receber recebessem a ultima data de baixa,
     acabando assim com juros cobrado sobre elas ... não é codigo meu fabiano 04/11/2005
     UPDATE FIN_CONTAS_RECEBER
     SET DATA_ULT_BAIXA = :DATA_BAIXA
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ */
END
^

ALTER PROCEDURE BAIXA_RECEBER_SELECAO (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE PORCENT NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE JUROS_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;

DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     IF ( TIPO = 'Lancamento')
     THEN BEGIN
          /* CONTAS A RECEBER */
          FOR SELECT
              CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
              DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
              VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
              VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR, LOCAL_COBRANCA, juros_parcial
          FROM FIN_CONTAS_RECEBER RE
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
          SELECIONADO = 'S' AND DT_LANCTO >= :DATA_INICIAL AND
          DT_LANCTO <= :DATA_FINAL AND FATURA IS NULL
          INTO
               :CODREC, :ANO, :PESSOA_FJ, :DT_EMISSAO,
               :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
               :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
               :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
               :LOCAL_COBRANCA,:juros_parcial
          DO BEGIN
             VALOR = :VALOR - :VLR_PARCIAL ;

             /* TOTAL = 100%, ENTAO O VALOR DA CONTA É IGUAL A X % */
             PORCENT = (:VALOR) / :TOTAL ;
             
             VALOR_BX = :TOTAL * :PORCENT ;
             
             JUROS_BX = :juros_parcial;
             
             DESC_BX  = :DESCONTO * :PORCENT ;
          
             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             into :CODBX;

             IF ( :BANCO > 0 )
             THEN BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                  );
             END
             ELSE BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                  );
             END
             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;
        END
     END
     ELSE BEGIN
          /* CONTAS A RECEBER */
          FOR SELECT
              CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
              DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
              VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
              VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, COBRADOR, LOCAL_COBRANCA, juros_parcial
          FROM FIN_CONTAS_RECEBER
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
          SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
          DT_VENCTO <= :DATA_FINAL AND FATURA IS NULL
          INTO
               :CODREC, :ANO, :PESSOA_FJ, :DT_EMISSAO,
               :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
               :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
               :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR,
               :LOCAL_COBRANCA, :juros_parcial
          DO BEGIN
             VALOR = :VALOR - :VLR_PARCIAL ;

             /* TOTAL = 100%, ENTAO O VALOR DA CONTA É IGUAL A X % */
             PORCENT = (:VALOR) / :TOTAL ;
             
             VALOR_BX = :TOTAL * :PORCENT ;
             
             JUROS_BX = juros_parcial;
             
             DESC_BX  = :DESCONTO * :PORCENT ;
          
             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             into :CODBX;

             IF ( :BANCO > 0 )
             THEN BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                  );
             END
             ELSE BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX + :JUROS_BX - :DESC_BX, :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA
                  );
             END
     
             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;
        END
     END

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF (( BANCO > 0) AND ( BANCO <> CONTA )) THEN
     BEGIN
       CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);
       INSERT INTO CTB_MOVIMENTO_CONTABIL
       (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
       VALUES
       (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VALOR_BX, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );
     END
     
    suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER_SELECAO_ADM (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    PDV CHAR(1),
    BANCO INTEGER,
    DATA_BAIXA DATE,
    DESCONTO NUMERIC(18,4))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TX_JUROS_APOS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE SOMATOTAL NUMERIC(18,4);
DECLARE VARIABLE RESTANTE NUMERIC(18,4);
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE VALOR_MULTA NUMERIC(18,4);
DECLARE VARIABLE DESTINO INTEGER;
DECLARE VARIABLE JUROS NUMERIC(18,4);
Begin
    /*alguns calculos foram feitos pra acertar so o pdv*/
    if (:pdv is null) then
      pdv = 'N';

    /*Dados sobre juros*/
    select tx_juros_ate,  tipo_taxa from sis_empresas empe
    where cnpj = :cnpj
    into :taxa_juros, :tipo_juros ;

    ano = extract ( year from :data_baixa );
    /* soma total baixada */
    somatotal = 0;

    /* valor q ainda poderá ser usado para baixar */
    restante = total;

    /* insere nos movimentos bancarios */
    if (( banco > 0) and ( banco <> conta )) then
    begin
      codigo_cont = gen_id(mov_contabil_ge, 1);

      insert into ctb_movimento_contabil
          (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, fornecedor )
      values
          (:cnpj, :codigo_cont, :data_baixa, 'C', :docto, :historicobx, :dinheiro, :banco, 'REC', :planilha, 'A', 'DPL', :pessoa_fj );
      
      destino = :banco;
    end
    else
      destino = :conta;

    /* Percorrendo o Contas à Receber e pegando todas as contas que foram selecionadas*/
    for select
         codigo, ano, pessoa_fj, dt_emissao,
         dt_vencto, dt_lancto, docto, parcela, historico,
         (coalesce(valor,0)-coalesce(vlr_parcial,0)), juros_rec, descontos, boleto, origem, codigo_vn, ano_vn,
         aviso, dt_aviso, vlr_parcial, nome, numboleto, numduplicata,
         juros_parcial, cobrador, local_cobranca, codigo_trc, data_ult_baixa
     from fin_contas_receber rec
     where cnpj = :cnpj and pessoa_fj = :cliente  and
     selecionado = 'S' and dt_vencto >= :data_inicial and
     dt_vencto <= :data_final and fatura is null
     order by dt_vencto
     into
         :codrec, :ano, :pessoa_fj, :dt_emissao,
         :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn,
         :aviso, :dt_aviso, :vlr_parcial, :nome, :numboleto, :numduplicata,
         :juros_bx, :cobrador, :local_cobranca,:codigo_trc, :data_ult_baixa
     do
     begin

       /* A multa já e calculada na função da aplicação que seta o vlr. :juros-bx portanto já esta embutida
       mas não quero excluir o código, por isso estou gerando*/
       valor_multa = 0;

        /* ----Só entrará neste bloco quando o dinheiro que 'temos' for suficiente para pagar toda a dívida.
        Restante é o valor que vc tem p/pagar as contas..)*/
        if (:restante >= (:valor + :juros_bx + valor_multa - :desconto)) then
        begin
           /*Este será o valor que será gerado no caixa*/
           valor_bx = :valor + :juros_bx + valor_multa - :desconto;

           /*aparentemente isso acontece quando o cliente paga adiantado e os se tornam negativos e o juros tambem
           e viram desconto ..mas nao tenho certeza*/
           if (juros_bx < 0) then
           begin
             desc_bx  = juros_bx ;
             juros_bx = 0;
           end
           else
             desc_bx  = 0;

           /* codigo da baixa */
           select codigo from gerar_codigo ('BAIXA_RECEBER',1)
           into :codbx;

           insert into fin_baixas_receber
           (cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
           historico_bx, vlr_baixa, juros, descontos, planilha,
           taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
           dt_vencto, dt_lancto, docto, parcela, historico,
           valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
           ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
           conta, turno, cobrador, local_cobranca ,codigo_trc)
           values
           (:cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
           :historicobx, :valor_bx , :juros_bx, :desc_bx, :planilha,
           :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
           :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
           :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
           :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
           :destino, :turno, :cobrador, :local_cobranca,:codigo_trc);

     
           /* apaga o contas a receber */
           delete from  fin_contas_receber
           where cnpj = :cnpj and codigo = :codrec and ano = :ano ;
      
           /* acumula o total baixado */
           somatotal = :somatotal + :valor_bx;
      
           restante = :restante - :valor_bx;
        end
        else
        begin
          if ( restante > -1 ) then
          begin
            /*quando o valor é maior do que o juros. usado em baixa parcial em que o valor tem q ser > juros */

            /*:JUROS_REC, mudei isso , pois não estava salvando o juros cobrado, fabiano 03/11/2005 p/aparecer na baixa parcial do caixa*/
            if (:Restante > :juros_bx) then
              juros = :juros_bx;
            else /*usado no pdv em que as vezes o juro é maior do que o vlr a baixar*/
              juros = :juros_bx;/* paleativo juros = :juros_rec;*/

            EXECUTE PROCEDURE  BAIXA_RECEBER_PARCIAL_ADM
            (
             :CNPJ,
             :CODREC,
             :ANO,
             :HISTORICOBX,
             :USUARIO,
             :DATA_BAIXA,
             :RESTANTE,
             :juros,
             :DESCONTO,
             :PLANILHA,
             :CONTA,
             :TURNO,
             :BANCO
             );

            restante = 0;
          end /*end restante maior que 0*/
        end /*end else Restante < (Jur.+Multa+Correcoao)*/
     end /*end for*/
END
^

ALTER PROCEDURE BAIXA_RECEBER_SELECAO_LOJA (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    TOTAL NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    BANCO INTEGER,
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DIF_JUROS NUMERIC(18,4))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER; /* Armazenará o código da troca */
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE PERCENTUAL NUMERIC(18,4);
DECLARE VARIABLE VALORTOTAL NUMERIC(18,4);
DECLARE VARIABLE DESCONTOBAIXA NUMERIC(18,4);
DECLARE VARIABLE ULTDESCONTO NUMERIC(18,4);
DECLARE VARIABLE SOMADESCONTO NUMERIC(18,4);
DECLARE VARIABLE ULTJUROS NUMERIC(18,4);
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE DIF_DESC NUMERIC(18,4);
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /*Procedimento só realiza baixas integrais nunca parciais*/
     somadesconto = 0;
     ultdesconto = 0;
     ultjuros = 0;

     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* pega o valor total para calculo da porcentagem */
     select sum(coalesce(r.valor,0)-coalesce(r.vlr_parcial,0))
     from fin_contas_receber r
     where cnpj = :cnpj and pessoa_fj = :cliente  and
     selecionado = 'S' and dt_vencto >= :data_inicial and
     dt_vencto <= :data_final and fatura is null
     group by r.pessoa_fj
     into :valortotal;

     for select codigo, ano, pessoa_fj, dt_emissao, dt_vencto, dt_lancto, docto, parcela, historico,
          coalesce(valor,0), juros_rec, descontos, boleto, origem, codigo_vn, ano_vn, aviso, dt_aviso,
          coalesce(vlr_parcial,0), nome, numboleto, numduplicata, juros_parcial, parcial, cobrador,
          local_cobranca, codigo_trc, cod_indexador, idx_database, idx_cotacao, idx_qtde

     from fin_contas_receber
     where cnpj = :cnpj and pessoa_fj = :cliente  and
     selecionado = 'S' and dt_vencto >= :data_inicial and
     dt_vencto <= :data_final and fatura is null
     into
         :codrec, :ano, :pessoa_fj, :dt_emissao, :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn,:aviso, :dt_aviso,
         :vlr_parcial, :nome, :numboleto, :numduplicata, :juros_bx, :valor_bx, :cobrador,
         :local_cobranca,:codigo_trc, :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     do
     begin
        /*através do parametro :dif_juros nos teremos condições de saber se foi dado um desconto no total de juros ex:
          acontece no caso de os clientes selecionarem as contas e baixa-las c/f9 no baixareceber, no formulario de baixa
          que se abre tem o controle de edit com o juros sugeridos e ele podemodificar este valor, no entanto
          os juros que serão creditados no baixa a receber "já foram definidos" na tela anterior (quando o individuo)
          teclou f11 pra selecionar todos. então essa diferença que existe no juro sugerido que é o que realmente vale
          p/o banco e o que ele quer cobrar tem de ser tirada por isso temos essa :dif_juros que nos informa se isso
          aconteceu ou não.
         */
         /*vlr. de juros foi diminuito*/
         if (:juros_bx > 0) then     /*aqui existe uma inversão de sinais... qndo o juro foi diminuido a dif vem negativo*/
          juros_bx = :juros_bx + ((:dif_juros *:juros_bx )/100);


         if (juros_bx < 0)then
         begin
           desc_bx  = juros_bx ;
           juros_bx = 0;
         end
         else
           desc_bx  = 0;



         /* proporção a ser dada de desconto para a baixa */
         percentual = cast((((:valor - :vlr_parcial) * 100) / :valortotal)  as numeric(9,4));
         /*select * from round2(:percentual) into :percentual;*/

         descontobaixa = (desconto * percentual) /100;
         /*select * from round2(:descontobaixa) into :descontobaixa;*/

         somadesconto = somadesconto + descontobaixa;

         valor_bx = ( :valor - :vlr_parcial) + :juros_bx - descontobaixa;

         /* codigo da baixa */
         select codigo from gerar_codigo ('BAIXA_RECEBER',1)
         into :codbx;

         if ( banco > 0 )
         then begin
              insert into fin_baixas_receber
              ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
              historico_bx, vlr_baixa, juros, descontos, planilha,
              taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
              dt_vencto, dt_lancto, docto, parcela, historico,
              valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
              ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
              conta, turno, cobrador, local_cobranca, codigo_trc,
              cod_indexador, idx_database, idx_cotacao, idx_qtde
              )
              values
              (
              :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
              :historicobx, :valor_bx, :juros_bx /*+ :jurosbaixa*/, :descontobaixa, :planilha,
              :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
              :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
              :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
              :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
              :banco, :turno, :cobrador, :local_cobranca,:codigo_trc,
              :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
              );
         end
         else begin
              insert into fin_baixas_receber
              ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
              historico_bx, vlr_baixa, juros, descontos, planilha,
              taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
              dt_vencto, dt_lancto, docto, parcela, historico,
              valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
              ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
              conta, turno, cobrador, local_cobranca, codigo_trc,
              cod_indexador, idx_database, idx_cotacao, idx_qtde
              )
              values
              (
              :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
              :historicobx, :valor_bx, :juros_bx , :descontobaixa, :planilha,
              :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
              :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
              :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
              :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
              :conta, :turno, :cobrador, :local_cobranca,:codigo_trc,
              :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde

              );
         end
 
         /* APAGA O CONTAS A RECEBER */
         delete from  fin_contas_receber
         where cnpj = :cnpj and codigo = :codrec and ano = :ano;
     end


     /*Pode acontecer que no rateio de descontos nós termos
     diferêncas mínimas por conta de arredondamento*/
     dif_desc = (somadesconto - :desconto);
     if (:dif_desc < 0) then
       dif_desc = (:dif_desc * -1);

     /*Não sei ao certo pra que serve este bloco, ms é 'codigo não me toque!'*/
     if ((somadesconto <> :desconto) and (:dif_desc > 0.2)) then
     begin /*só irei dar consideração a diferenças maiores que 20 centavos*/
       ultdesconto = somadesconto - descontobaixa;
       update fin_baixas_receber r
       set descontos = :ultdesconto, vlr_baixa = :VALOR - :VLR_PARCIAL + :JUROS_REC -:DESCONTOS_REC + :JUROS_BX - :ultdesconto +  :ultjuros
       where r.codigo = :codbx and r.cnpj = :cnpj;
     end

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     if (( banco > 0) and ( banco <> conta ))  then
     begin
          CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);


         INSERT INTO CTB_MOVIMENTO_CONTABIL
         (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
         VALUES
         (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :dinheiro, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );

     END
     
     suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER_SELECAO_LOJA_ADM (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    TOTAL NUMERIC(18,4),
    BANCO INTEGER,
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DIF_JUROS NUMERIC(18,4))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE PERCENTUAL NUMERIC(18,4);
DECLARE VARIABLE VALORTOTAL NUMERIC(18,4);
DECLARE VARIABLE ULTDESCONTO NUMERIC(18,4);
DECLARE VARIABLE SOMADESCONTO NUMERIC(18,4);
DECLARE VARIABLE ULTJUROS NUMERIC(18,4);
DECLARE VARIABLE USA_CTB CHAR(1);
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
  /*--------NESTE PROCEDIMENTO INVARIAVELMENTE AS BAIXAS SERÃO INTEGRAIS--------*/

  /*Dados de Configuração de empresa */
  select tx_juros_ate, tipo_taxa from sis_empresas
  where cnpj = :cnpj
  into :taxa_juros, :tipo_juros;
  
  
  ano = extract ( year from :data_baixa);
  
  /*Tipificando o intervalo de pesquisa Lancamento ou Vencimento*/
  if (tipo = 'Lancamento') then
  begin
    /* pega o valor total para calculo da porcentagem
    seleciona o total das contas*/
    select sum(valor)
    from fin_contas_receber r
    where cnpj = :cnpj and pessoa_fj = :cliente  and
    selecionado = 'S' and dt_lancto >= :data_inicial AND
    dt_lancto <= :data_final and fatura is null
    group by r.pessoa_fj
    into :valortotal;

    /*Selecinando todas as contas selecionadas*/
    for select
        codigo, ano, pessoa_fj, dt_emissao,
        dt_vencto, dt_lancto, docto, parcela, historico,
        valor, juros_rec, descontos, boleto, origem,
        codigo_vn, ano_vn, aviso, dt_aviso,
        vlr_parcial, nome, numboleto, numduplicata,
        juros_parcial, parcial, cobrador, local_cobranca,codigo_trc
    from fin_contas_receber
    where cnpj = :cnpj and pessoa_fj = :cliente  and
    selecionado = 'S' and dt_lancto >= :data_inicial and
    dt_lancto <= :data_final and fatura is null
    into
         :codrec, :ano, :pessoa_fj, :dt_emissao,
         :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn,:aviso, :dt_aviso,
         :vlr_parcial, :nome, :numboleto, :numduplicata,
         :juros_bx, :valor_bx, :cobrador, :local_cobranca,:codigo_trc
    do
    begin
      /*não sei o q é isso*/
      if ( juros_bx < 0 ) then
      begin
        desc_bx  = juros_bx ;
        juros_bx =0 ;
      end
      else
        desc_bx  = 0 ;

      valor_bx = ( :valor - :vlr_parcial) + :juros_bx + - desc_bx;


     /* codigo da baixa */
     codbx = GEN_ID(FIN_BAIXA_PAGAR_GE,1);

     /*select codigo from gerar_codigo ('baixa_receber',1)
     into :codbx;*/
          
      /*baixa através do banco*/
      if ( :banco > 0 ) then
      begin
          insert into fin_baixas_receber
          ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
          historico_bx, vlr_baixa, juros, descontos, planilha,
          taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
          ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
          conta, turno, cobrador, local_cobranca, codigo_trc
          )
          values
          (
          :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
          :historicobx, :valor_bx, :juros_bx, :desc_bx, :planilha,
          :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
          :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
          :banco, :turno, :cobrador, :local_cobranca,:codigo_trc
          );
      end
      else
      begin
          insert into fin_baixas_receber
          ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
          historico_bx, vlr_baixa, juros, descontos, planilha,
          taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
          ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
          conta, turno, cobrador, local_cobranca, codigo_trc
          )
          values
          (
          :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
          :historicobx, :valor_bx, :juros_bx  , :desc_bx, :planilha,
          :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
          :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
          :conta, :turno, :cobrador, :local_cobranca, :codigo_trc
          );
      end
 
      /* apaga o contas a receber */
      delete from  fin_contas_receber
      where cnpj = :cnpj and codigo = :codrec and ano = :ano ;
    end
  end
  else
  begin
    /* pega o valor total para calculo da porcentagem */
    select sum(valor)
    from fin_contas_receber r
    where cnpj = :cnpj and pessoa_fj = :cliente  and
    selecionado = 'S' and dt_vencto >= :data_inicial and
    dt_vencto <= :data_final and fatura is null
    group by r.pessoa_fj
    into :valortotal;

    for select
        codigo, ano, pessoa_fj, dt_emissao,
        dt_vencto, dt_lancto, docto, parcela, historico,
        valor, juros_rec, descontos, boleto, origem,
        codigo_vn, ano_vn, aviso, dt_aviso,
        vlr_parcial, nome, numboleto, numduplicata,
        juros_parcial, parcial, cobrador, local_cobranca,codigo_trc
    from fin_contas_receber
    where cnpj = :cnpj and pessoa_fj = :cliente  and
    selecionado = 'S' and dt_vencto >= :data_inicial and
    dt_vencto <= :data_final and fatura is null
    into
         :codrec, :ano, :pessoa_fj, :dt_emissao,
         :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :juros_rec, :descontos_rec, :boleto, :origem,
         :codigo_vn, :ano_vn,:aviso, :dt_aviso,
         :vlr_parcial, :nome, :numboleto, :numduplicata,
         :juros_bx, :valor_bx, :cobrador, :local_cobranca,:codigo_trc
    do
    begin
      /*através do parametro :dif_juros nos teremos condições de saber se foi dado um desconto no total de juros ex:
       Acontece no caso de os clientes selecionarem as contas e baixa-las c/f9 no baixareceber, no formulario de baixa
       que se abre tem o controle de edit com o juros sugeridos e ele podemodificar este valor, no entanto
       os juros que serão creditados no baixa a receber "já foram definidos" na tela anterior (Quando o Individuo)
       teclou F11 pra selecionar todos. Então essa diferença que existe no juro sugerido que é o que realmente vale
       p/o banco e o que ele quer cobrar tem de ser tirada por isso temos essa :dif_juros que nos informa se isso
       aconteceu ou não.
      
      /*vlr. de juros foi diminuito*/
      /*Verificar esta unit pois o cara pode tirar todo o juros da conta*/
      if (:juros_bx > 0) then
      begin
        if (:dif_juros < 0) then   /*porq a diferença pode vir c/valores negativos*/
          juros_bx = :juros_bx - (( ((-1) * :dif_juros) * :juros_bx)/100);
        else /*juros foi aumentado*/
          juros_bx = :juros_bx + ((:dif_juros * :juros_bx)/100);
      end

      if (juros_bx < 0)then
      begin
       desc_bx  = juros_bx ;
       juros_bx = 0;
      end
      else
       desc_bx  = 0;

    


     valor_bx = ( :valor - :vlr_parcial) + :juros_bx - desc_bx;

    /* codigo da baixa */
     codbx = GEN_ID(FIN_BAIXA_PAGAR_GE,1);

     /*select codigo from gerar_codigo ('baixa_receber',1)
     into :codbx;*/
       if ( banco > 0 ) then
       begin
          insert into fin_baixas_receber
          ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
          historico_bx, vlr_baixa, juros, descontos, planilha,
          taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
          ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
          conta, turno, cobrador, local_cobranca,codigo_trc
          )
          values
          (
          :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
          :historicobx, :valor_bx, :juros_bx , :desc_bx, :planilha,
          :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
          :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
          :banco, :turno, :cobrador, :local_cobranca,:codigo_trc
          );
       end
       else
       begin
          insert into fin_baixas_receber
          ( cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
          historico_bx, vlr_baixa, juros, descontos, planilha,
          taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
          ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
          conta, turno, cobrador, local_cobranca, codigo_trc
          )
          values
          (
          :cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
          :historicobx, :valor_bx, :juros_bx , :desc_bx, :planilha,
          :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
          :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
          :conta, :turno, :cobrador, :local_cobranca, :codigo_trc
          );
      end
 
     /* apaga o contas a receber */
     delete from  fin_contas_receber
     where cnpj = :cnpj and codigo = :codrec and ano = :ano ;
   end
 end

      /* insere nos movimentos bancarios */
     if (( banco > 0) and ( banco <> conta )) then
     begin
       codigo_cont = gen_id(mov_contabil_ge, 1);
      
       insert into ctb_movimento_contabil
       (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, fornecedor )
       values
       (:cnpj, :codigo_cont, :data_baixa, 'C', :docto, :historicobx, :total, :banco, 'REC', :planilha, 'A', 'DPL', :pessoa_fj );

     end
  suspend;
END
^

ALTER PROCEDURE BAIXA_RECEBER_SELECAO_PDV (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    USUARIO INTEGER,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    PLANILHA INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    PDV CHAR(1),
    BANCO INTEGER)
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE JUROS_BX NUMERIC(18,4);
DECLARE VARIABLE DESC_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE SOMATOTAL NUMERIC(18,4);
DECLARE VARIABLE RESTANTE NUMERIC(18,4);
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
Begin
     /*alguns calculos foram feitos pra acertar so o pdv*/
     if (:pdv is null) then
      pdv = 'N';

     /* EMPRESA */
     SELECT TX_JUROS_ATE, TIPO_TAXA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TAXA_JUROS, :TIPO_JUROS ;

     /* DADOS DA BAIXA */
     ANO = EXTRACT ( YEAR FROM :DATA_BAIXA );

     /* SOMA TOTAL BAIXADA */
     SOMATOTAL = 0;

     /* VALOR Q AINDA PODERA SER BAIXADO */
     RESTANTE = TOTAL;

     /* CONTAS A RECEBER */
     FOR SELECT
         CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
         DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
         VALOR, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO,
         VLR_PARCIAL, NOME, NUMBOLETO, NUMDUPLICATA, JUROS_PARCIAL, PARCIAL, COBRADOR,
         LOCAL_COBRANCA,CODIGO_TRC
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
     SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
     DT_VENCTO <= :DATA_FINAL AND FATURA IS NULL
     order by dt_vencto
     INTO
         :CODREC, :ANO, :PESSOA_FJ, :DT_EMISSAO,
         :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
         :VALOR, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN,
         :AVISO, :DT_AVISO, :VLR_PARCIAL, :NOME, :NUMBOLETO, :NUMDUPLICATA,
         :JUROS_BX, :VALOR_BX, :COBRADOR, :LOCAL_COBRANCA,:CODIGO_TRC
     DO BEGIN
        /*quando este é chamado do pdv o restante vem sem juros descontados*/
        if (:pdv = 'S') then
         VALOR_BX = :valor_bx + :juros_bx;

        /*restante é o valor que vc tem p/pagar as contas..)*/
        IF ( :RESTANTE >= :VALOR_BX)
        THEN BEGIN
             /*aparentemente isso acontece quando o cliente paga adiantado e os se tornam negativos e o juros tambem
             e viram desconto mas nao tenho certeza*/
             IF ( JUROS_BX < 0 ) THEN
             BEGIN
                 DESC_BX  = JUROS_BX ;
                 JUROS_BX =0 ;
             END
             ELSE
                DESC_BX  = 0 ;

             /* CODIGO DA BAIXA */
             SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_RECEBER',1)
             INTO :CODBX;

             IF ( :BANCO > 0 )
             THEN BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA,CODIGO_TRC
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX , :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :BANCO, :TURNO, :COBRADOR, :LOCAL_COBRANCA,:CODIGO_TRC
                  );
             END
             ELSE BEGIN
                  INSERT INTO FIN_BAIXAS_RECEBER
                  ( CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, DT_BAIXA,
                  HISTORICO_BX, VLR_BAIXA, JUROS, DESCONTOS, PLANILHA,
                  TAXA_JUROS, TIPO_JUROS, PESSOA_FJ, DT_EMISSAO,
                  DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
                  ANO_VN, AVISO, DT_AVISO, NOME, USUARIO, NUMBOLETO, NUMDUPLICATA,
                  CONTA, TURNO, COBRADOR, LOCAL_COBRANCA, CODIGO_TRC
                  )
                  VALUES
                  (
                  :CNPJ, :CODBX, :ANO, :CODREC, :ANO, :DATA_BAIXA,
                  :HISTORICOBX, :VALOR_BX , :JUROS_BX, :DESC_BX, :PLANILHA,
                  :TAXA_JUROS, :TIPO_JUROS, :PESSOA_FJ, :DT_EMISSAO,
                  :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
                  :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN,
                  :ANO_VN, :AVISO, :DT_AVISO, :NOME, :USUARIO, :NUMBOLETO, :NUMDUPLICATA,
                  :CONTA, :TURNO, :COBRADOR, :LOCAL_COBRANCA,:CODIGO_TRC
                  );
             END
     
             /* APAGA O CONTAS A RECEBER */
             DELETE FROM  FIN_CONTAS_RECEBER
             WHERE CNPJ = :CNPJ AND CODIGO = :CODREC AND ANO = :ANO ;

             /* ACUMULA O TOTAL BAIXADO */
             SOMATOTAL = :SOMATOTAL + :VALOR_BX;

             RESTANTE = :RESTANTE - :VALOR_BX ;
        END
        ELSE BEGIN
             IF ( RESTANTE > 0 )
             THEN BEGIN
               /*quando o valor é maior do que o juros. usado em baixa parcial em que o valor tem q ser > juros */
               if (:Restante > :juros_bx) then
               begin
                 /*:JUROS_REC, mudei isso , pois não estava salvando o juros cobrado, fabiano 03/11/2005 p/aparecer na baixa parcial do caixa*/
                 EXECUTE PROCEDURE  BAIXA_RECEBER_PARCIAL_PDV
                 (
                 :CNPJ,
                 :CODREC,
                 :ANO,
                 :HISTORICOBX,
                 :USUARIO,
                 :DATA_BAIXA,
                 :RESTANTE,
                 :juros_bx,
                 :DESCONTOS_REC,
                 :PLANILHA,
                 :CONTA,
                 :TURNO,
                 :BANCO
                 );
               end
               else
               begin
                  /*usado no pdv em que as vezes o juro é maior do que o vlr a baixar*/
                 EXECUTE PROCEDURE  BAIXA_RECEBER_PARCIAL_PDV
                 (
                 :CNPJ,
                 :CODREC,
                 :ANO,
                 :HISTORICOBX,
                 :USUARIO,
                 :DATA_BAIXA,
                 :RESTANTE,
                 :juros_rec,
                 :DESCONTOS_REC,
                 :PLANILHA,
                 :CONTA,
                 :TURNO,
                 :BANCO
                 );
               end


                  RESTANTE = 0;
             END
        END
     END

     /* INSERE NOS MOVIMENTOS BANCARIOS */
     IF (( BANCO > 0) AND ( BANCO <> CONTA ))
     THEN BEGIN
          CODIGO_CONT = GEN_ID(MOV_CONTABIL_GE, 1);

          INSERT INTO CTB_MOVIMENTO_CONTABIL
          (CNPJ, CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, VALOR, CONTA, ORIGEM, PLANILHA, TIPO_LANCAMENTO, COD_DOC, FORNECEDOR )
          VALUES
          (:CNPJ, :CODIGO_CONT, :DATA_BAIXA, 'C', :DOCTO, :HISTORICOBX, :VALOR_BX, :BANCO, 'REC', :PLANILHA, 'A', 'DPL', :PESSOA_FJ );
     END
END
^

ALTER PROCEDURE BCH_ATUALIZA_CUPOM (
    CNPJ VARCHAR(14),
    PEDIDO INTEGER,
    CUPOM INTEGER)
RETURNS (
    EXISTE INTEGER)
AS
begin
  select vd.codigo from fat_vendas vd
  where
  /*vd.fechada = 'S' and vd.enviada_cx = 'S' */
   vd.codigo = :pedido /*and vd.cnpj = :cnpj*/
  into :existe;

  update fat_vendas vd set vd.num_cupom = :cupom
  where /*vd.fechada = 'S' and vd.enviada_cx = 'S'
  and*/ vd.codigo = :pedido /*and vd.cnpj = :cnpj*/;

  existe = coalesce(:existe,0);

  suspend;
end
^

ALTER PROCEDURE BCH_CANCELA_CUPOM (
    CNPJ VARCHAR(14),
    CUPOM INTEGER)
RETURNS (
    EXISTE INTEGER)
AS
begin
  select vd.codigo from fat_vendas vd
  where
  /*vd.fechada = 'S' and vd.enviada_cx = 'S' */
   vd.num_cupom = :cupom /*and vd.cnpj = :cnpj*/
  into :existe;

  update fat_vendas vd set vd.cancelada = 'S'
  where /*vd.fechada = 'S' and vd.enviada_cx = 'S'
  and*/ vd.num_cupom = :cupom /*and vd.cnpj = :cnpj*/;

  existe = coalesce(:existe,0);

  suspend;
end
^

ALTER PROCEDURE BCH_DEFINE_COD_PRODUTO
AS
DECLARE VARIABLE CODIGO_BCH INTEGER;
DECLARE VARIABLE CODIGO VARCHAR(15);
begin
  /* Procedure Text */
  CODIGO_BCH = 1;

  for select p.codigo from est_produtos p
  INTO :Codigo
  do
  begin
     update est_produtos p set p.bch_codigo = :CODIGO_BCH
     where  p.codigo =  :codigo;

     CODIGO_BCH = :CODIGO_BCH +1;
  end

  suspend;
end
^

ALTER PROCEDURE CAIXA_SALDOS (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER)
AS
BEGIN
/*     SELECT SUM(DINHEIRO) DINHEIRO, SUM(CHEQUE) CHEQUE,
     SUM(CARTAO) CARTAO, SUM(TICKET) TICKET, SUM(TROCO) TROCO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND USUARIO = :USUARIO
*/

  SUSPEND;
END
^

ALTER PROCEDURE CALCULA_IMPOSTOS
AS
DECLARE VARIABLE MensagemReducao VARCHAR (80);
DECLARE VARIABLE BASECALCULOICM  NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE PERC_ESTADUAL NUMERIC(18,4);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE REDUCAO INTEGER;
DECLARE VARIABLE SOMABASEICM NUMERIC(18,4);
DECLARE VARIABLE SOMABASEICMSUBST NUMERIC(18,4);

/* */
DECLARE VARIABLE CNPJ      CHAR(14);
DECLARE VARIABLE PRODUTO   VARCHAR(14);
DECLARE VARIABLE CODIGO    INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
begin
     FOR SELECT  CNPJ, PRODUTO, CODIGO, SEQUENCIA
     FROM FAT_VENDAS_ITENS
     INTO :CNPJ, :PRODUTO , :CODIGO, :SEQUENCIA
     DO BEGIN
        SELECT CTE, REDUCAO  FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO :CTE, :REDUCAO;

        /* ATUALIZA OS PRODUTOS */
        UPDATE FAT_VENDAS_ITENS
        SET CTE = :CTE, REDUCAO = :REDUCAO
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO AND SEQUENCIA = :SEQUENCIA ;

     END

     FOR SELECT CTE,
                CTIE,
                (QUANTIDADE * (PRC_UNITARIO - DESCONTO)),
                REDUCAO,
                CNPJ,
                CODIGO,
                PRODUTO,
                SEQUENCIA
     FROM FAT_VENDAS_ITENS
     INTO :CTE, :CTIE, :TOTAL, :REDUCAO,
          :CNPJ, :CODIGO, :PRODUTO, :SEQUENCIA
     DO BEGIN
          MensagemReducao = '' ;

          BASECALCULOICM          = 0;
          BASECALCULOSUBSTITUICAO = 0;

          /*ESTADUAL*/
          IF ( CTE = 1 ) /*integral*/
          then begin
               BASECALCULOICM = :BASECALCULOICM + :TOTAL ;
          end

          IF ( CTE = 2 ) /*Base de Calculo Reduzida*/
          then begin
               /*BUSCAR O VALOR DA REDUCAO*/
               SELECT PERC_ESTADUAL FROM EST_REDUCOES
               WHERE CODIGO = :REDUCAO
               INTO :PERC_ESTADUAL ;

               BASECALCULOICM  = BASECALCULOICM + ( :TOTAL - (( :TOTAL * :PERC_ESTADUAL)/100)) ;
          end

          IF ( CTE = 6 ) /*SUBSTITUICAO*/
          then begin
               BASECALCULOSUBSTITUICAO = :BASECALCULOSUBSTITUICAO + :TOTAL ;
          End

          /* ATUALIZA OS PRODUTOS */
          UPDATE FAT_VENDAS_ITENS
          SET BASECALCULOICM = :BASECALCULOICM, BASECALCULOSUBSTITUICAO  = :BASECALCULOSUBSTITUICAO,
              MENSAGEM_REDUCAO = ''
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO AND SEQUENCIA = :SEQUENCIA ;
     END
     
     /* ATUALIZANDO AS FATURAS */
     FOR SELECT CNPJ, CODIGO FROM FAT_VENDAS
     INTO :CNPJ, :CODIGO
     DO BEGIN
        SOMABASEICM = 0;
        SOMABASEICMSUBST = 0;
        FOR SELECT BASECALCULOICM, BASECALCULOSUBSTITUICAO
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :BASECALCULOICM, :BASECALCULOSUBSTITUICAO
        DO BEGIN
           SOMABASEICM     = SOMABASEICM + :BASECALCULOICM ;
           SOMABASEICMSUBST = SOMABASEICMSUBST + :BASECALCULOSUBSTITUICAO ;
        END
        
        UPDATE FAT_VENDAS
        SET BASE_ICM = :SOMABASEICM, ICM = ((:SOMABASEICM * 17) / 100 )
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END
END
^

ALTER PROCEDURE CALCULA_JUROS (
    CNPJ VARCHAR(14),
    VENCIMENTO DATE,
    BAIXA DATE,
    VALOR NUMERIC(18,4),
    TAXA_PASSADA NUMERIC(18,4))
RETURNS (
    RESULT NUMERIC(18,4))
AS
DECLARE VARIABLE TIPO CHAR(1); /* tipo de juro cobrado */
DECLARE VARIABLE TAXA NUMERIC(18,4); /* taxa de juros cobrado */
DECLARE VARIABLE ATRASO NUMERIC(18,4); /* DIAS DE ATRASO */
DECLARE VARIABLE DIA DATE; /* DATA INICIADA NO VENCIMENTO E ANDA ATE A DATA DA BAIXA PARA */
DECLARE VARIABLE CONTADOR INTEGER;
DECLARE VARIABLE SALDO NUMERIC(18,4); /* SALDO ACUMULADO */
DECLARE VARIABLE TX_JUROS NUMERIC(18,4);
DECLARE VARIABLE TOLERANCIA_JUROS NUMERIC(18,4);
DECLARE VARIABLE MULTA_FINANCEIRA NUMERIC(18,4);
begin
     /* TAXA DE JUROS */
     SELECT TIPO_TAXA, TX_JUROS_APOS
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TIPO, TX_JUROS ;

     IF ( :TX_JUROS IS NULL )
     THEN BEGIN
          TX_JUROS = 0;
     END

     SELECT TOLERANCIA_JUROS, MULTA_FINANCEIRA
     FROM SIS_CONFIGURACOES
     WHERE CNPJ = :CNPJ
     INTO :TOLERANCIA_JUROS, :MULTA_FINANCEIRA ;

     IF ( :TOLERANCIA_JUROS IS NULL )
     THEN BEGIN
          TOLERANCIA_JUROS = 0;
     END

     IF ( TAXA_PASSADA = 0 )
     THEN BEGIN
          TAXA = TX_JUROS ;
     END
     ELSE BEGIN
          TAXA = TAXA_PASSADA ;
     END


     IF ( TOLERANCIA_JUROS > 0 )
     THEN BEGIN
          IF ( VENCIMENTO + TOLERANCIA_JUROS >= BAIXA )
          THEN BEGIN
               VENCIMENTO = VENCIMENTO + TOLERANCIA_JUROS;
          END
          ELSE BEGIN
               select * from round2(:multa_financeira) into :multa_financeira;
               IF (MULTA_FINANCEIRA  > 0 )
               THEN BEGIN
                    VALOR = VALOR + ( VALOR * :MULTA_FINANCEIRA)/100;
               END
          END
     END
     ELSE BEGIN
          select * from round2(:multa_financeira) into :multa_financeira;
          IF (MULTA_FINANCEIRA > 0 )
          THEN BEGIN
               VALOR = VALOR + ( VALOR * MULTA_FINANCEIRA)/100;
          END
     END


     IF ( TIPO = 'S' )/*JUROS SIMPLES*/
     THEN BEGIN
          ATRASO = BAIXA - VENCIMENTO ;

          IF ( ATRASO <= 0 )/*PAGAMENTO EM DIA*/
          THEN BEGIN
               RESULT = 0;
          END
          ELSE BEGIN
               RESULT = (((TAXA/30)*ATRASO)*VALOR)/100;
          END
     END
     ELSE BEGIN
          ATRASO = BAIXA - VENCIMENTO ;

          IF ( ATRASO <= 0 )/*PAGAMENTO EM DIA*/
          THEN BEGIN
               RESULT = 0;
          END
          ELSE BEGIN
               CONTADOR = 0;

               ATRASO   = BAIXA - VENCIMENTO ;

               SALDO    = VALOR;

               IF ( ATRASO <= 0 )/*PAGAMENTO EM DIA*/
               THEN BEGIN
                    RESULT = 0;
               END
               ELSE BEGIN
                    DIA = VENCIMENTO ;

                    WHILE ( DIA <> BAIXA ) DO
                    BEGIN
                         CONTADOR = CONTADOR + 1;
                         DIA      = DIA + 1 ;
                         IF ( CONTADOR = 30 )
                         THEN BEGIN
                              SALDO    = SALDO + (TAXA*SALDO)/100;
                              CONTADOR = 0;
                         END
                    END

                    IF ( CONTADOR <> 0 )/*ALGUNS DIAS FORA DE UM MES*/
                    THEN BEGIN
                         SALDO = SALDO + (((TAXA/30)*CONTADOR)*SALDO)/100;
                    END

                    RESULT = SALDO - VALOR;
               END
          END
     END

     /*Procedure Text */
     suspend;
END
^

ALTER PROCEDURE CANCELA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA DATE)
AS
BEGIN
     /* DEVOLVE TROCA PARA O BALCAO */
     EXECUTE PROCEDURE DEVOLVE_GARANTIA_BALCAO ( :CNPJ, :CODIGO );

     /* CONTAS A RECEBER */
/*     DELETE FROM
     FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_TRC = :CODIGO ;
     
     /* TROCA FECHADA */
     UPDATE FAT_GARANTIAS
     SET CANCELADA = 'S',
     DATA_CANCELAMENTO = :DATA,
     ENTRADA = 0, DINHEIRO = 0,
     CHEQUE = 0, CARTAO = 0,
     TICKET = 0, DATA_CAIXA = NULL,
     USUARIO = 0,
     CONTA_CAIXA = NULL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE CANCELA_ITEM_GENERICO_PDV (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CUPOM INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    UNIDADE CHAR(4),
    NOME VARCHAR(50))
AS
begin
     SELECT MAX(SEQUENCIA) FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CUPOM AND PRODUTO = :CODIGO
     INTO :SEQUENCIA ;

     SELECT PRODUTO, QUANTIDADE, PRC_UNITARIO,
     UNIDADE, NOME_PRODUTO
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CUPOM AND PRODUTO = :CODIGO
     AND SEQUENCIA = :SEQUENCIA
     INTO :PRODUTO, :QUANTIDADE, :PRC_UNITARIO,
     :UNIDADE, :NOME ;

     DELETE FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CUPOM AND PRODUTO = :CODIGO
     AND SEQUENCIA = :SEQUENCIA ;

     suspend;
END
^

ALTER PROCEDURE CANCELA_NOTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA_CANCELAMENTO DATE)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
BEGIN
     /* verifica a natureza de operação */
     select natureza, data, num_nf, num_cupom from fat_vendas
     where codigo = :codigo and cnpj = :cnpj
     into :natureza, :data, :num_nf, :num_cupom ;

     delete from fin_cheques  where cnpj = :cnpj and venda = :codigo ;

     delete from fin_movimento_cartao where cnpj = :cnpj and venda = :codigo ;

     /* APAGA DO CONTAS A RECEBER */
     delete from fin_contas_receber
     where cnpj = :cnpj and codigo_vn = :codigo ;

     /* APAGA DO CONTAS A PAGAR - NECESSARIO POR CAUSA DAS DEVOLUCOES*/
     delete from fin_contas_pagar
     where cnpj = :cnpj and codigo_vn = :codigo ;

     update fat_vendas set cancelada = 'S',
     data_cancelamento = :data_cancelamento
     where cnpj = :cnpj and codigo = :codigo ;
END
^

ALTER PROCEDURE CANCELA_PEDIDO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA_CANCELAMENTO DATE)
AS
BEGIN
     /* APAGA DO CONTAS A RECEBER */
     delete from fin_cheques  where cnpj = :cnpj and venda = :codigo ;

     delete from fin_movimento_cartao where cnpj = :cnpj and venda = :codigo ;

     /* APAGA DO CONTAS A RECEBER */
     delete from fin_contas_receber
     where cnpj = :cnpj and codigo_vn = :codigo ;

     /* APAGA DO CONTAS A PAGAR - NECESSARIO POR CAUSA DAS DEVOLUCOES*/
     delete from fin_contas_pagar
     where cnpj = :cnpj and codigo_vn = :codigo ;


     UPDATE FAT_VENDAS SET CANCELADA = 'S',
     DATA_CANCELAMENTO = :DATA_CANCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE CANCELA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA DATE)
AS
BEGIN
     /* DEVOLVE TROCA PARA O BALCAO */
     EXECUTE PROCEDURE DEVOLVE_TROCA_BALCAO ( :CNPJ, :CODIGO );

     /* CONTAS A RECEBER */
     DELETE FROM
     FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_TRC = :CODIGO ;
     
     /* TROCA FECHADA */
     UPDATE FAT_TROCAS
     SET CANCELADA = 'S',
     DATA_CANCELAMENTO = :DATA,
     ENTRADA = 0, DINHEIRO = 0,
     CHEQUE = 0, CARTAO = 0,
     TICKET = 0, DATA_CAIXA = NULL,
     USUARIO = 0,
     CONTA_CAIXA = NULL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE CARREGAR_FATURA (
    CNPJ CHAR(14),
    CARGA INTEGER,
    FATURA INTEGER,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
     /* ATUALIZA A VENDA */
     UPDATE FAT_VENDAS
     SET CARGA = :CARGA
     WHERE CNPJ = :CNPJ AND CODIGO = :FATURA ;
     
     /* ATUALIZA A CARGA */
     UPDATE CRG_CARGAS
     SET VOLUME =
     VOLUME + :VOLUME,
     PESO = PESO + :PESO
     WHERE CNPJ = :CNPJ AND CODIGO = :CARGA ;
     
     SUSPEND;
END
^

ALTER PROCEDURE CLIENTES_INATIVOS_PERIODO (
    CNPJ CHAR(14),
    TEMPO INTEGER,
    MOVIMENTO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    ULTIMA_COMPRA DATE,
    FONE VARCHAR(20),
    FONE1 VARCHAR(20),
    FONE2 VARCHAR(20),
    RECEBER NUMERIC(18,4))
AS
DECLARE VARIABLE ULT_DATA DATE;
DECLARE VARIABLE DATA DATE;
begin
   /* todos os clientes independenente se compraram ou não */
   if ((:movimento = 'N') or (:movimento is null)) then
   begin
     for select codigo, nome_razao, psa.fone, psa.fax, psa.celular
         from glo_pessoas_fj psa
         inner join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
         where psa.cnpj = :cnpj
         into :codigo, :nome, :fone, :fone1, :fone2
     do
     begin
        /*pega a data da ultima venda*/
        select max(vd.data)
        from fat_vendas vd
        inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
        where vd.cnpj = :cnpj and vd.pessoa_fj = :codigo and
        coalesce(vd.fechada,'N') = 'S' and coalesce(vd.cancelada,'N')='N'
        and nat.es = 'S' and nat.computa_venda = 'S'
        into :ult_data;

        data = cast('today' as date);
        /*resgatando se o cliente deve alguma coiisa na loja*/
        select sum(coalesce(rec.valor,0) - (coalesce(rec.parcial,0) + coalesce(rec.descontos,0)))
        from fin_contas_receber rec where rec.cnpj = :cnpj and rec.pessoa_fj = :codigo
        into :receber;

        ultima_compra = :ult_data;

        if ((:data - :ult_data) > :tempo) then
          suspend;
     end
   end
   else
   begin
     for select codigo, nome_razao, psa.fone, fax, celular
     from glo_pessoas_fj psa  /*pegando somente os clientes que não tem movimentação de venda no bd*/
     inner join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
     WHERE psa.cnpj = :cnpj and psa.codigo not in (select vd.pessoa_fj from fat_vendas vd where vd.cnpj = :cnpj)
     INTO :CODIGO, :NOME, :FONE, :FONE1, :FONE2
     do
     begin
        suspend;
     end
   end
END
^

ALTER PROCEDURE COMPLETA (
    S VARCHAR(50),
    P VARCHAR(1),
    N INTEGER)
RETURNS (
    STR VARCHAR(50))
AS
BEGIN
 STR = '';
 SUSPEND;
END
^

ALTER PROCEDURE COMPLETAESQ (
    S VARCHAR(50),
    P VARCHAR(1),
    N INTEGER)
RETURNS (
    STR VARCHAR(50))
AS
BEGIN
 STR = '';
 suspend;
END
^

ALTER PROCEDURE COMPOE_ROTA (
    CNPJ VARCHAR(14),
    ROTA INTEGER,
    CIDADE INTEGER)
RETURNS (
    CONT INTEGER)
AS
begin
     SELECT COUNT(CIDADE)
     FROM CRG_ROTAS_CIDADES
     WHERE CNPJ = :CNPJ AND ROTA = :ROTA AND CIDADE = :CIDADE
     INTO :CONT ;

     IF ( CONT IS NULL )
     THEN
       CONT = 0;

     suspend;
END
^

ALTER PROCEDURE CONCILIA_BANCO (
    CODIGO INTEGER,
    DATA DATE)
AS
begin
     Update CTB_MOVIMENTO_CONTABIL
     SET DATA_CONCILIACAO = :DATA
     WHERE CODIGO = :CODIGO ;
  suspend;
END
^

ALTER PROCEDURE CONCILIA_CARTAO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1),
    DATA DATE)
AS
BEGIN
     IF (TIPO = 'S')
     THEN BEGIN
          UPDATE FIN_MOVIMENTO_CARTAO
          SET CONCILIADO = 'S', DATA_CONCILIACAO = :DATA
          WHERE
          (CNPJ = :CNPJ) AND
          (CODIGO = :CODIGO);
     END
     ELSE BEGIN
          UPDATE FIN_MOVIMENTO_CARTAO
          SET CONCILIADO = 'N', DATA_CONCILIACAO = NULL
          WHERE
          (CNPJ = :CNPJ) AND
          (CODIGO = :CODIGO);
     END
END
^

ALTER PROCEDURE CONCILIA_CHEQUE (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    TIPO CHAR(1),
    DATA DATE)
AS
DECLARE VARIABLE PROCESSADO CHAR(1);
BEGIN
     IF ( TIPO = 'S' )
     THEN BEGIN
          UPDATE FIN_CHEQUES
          SET CONCILIADO = 'S', DATA_CONCILIACAO = :DATA
          WHERE
          (CNPJ = :CNPJ) AND
          (BANCO = :BANCO) AND
          (CONTA = :CONTA) AND
          (CHEQUE = :CHEQUE);
     END
     ELSE BEGIN
          SELECT PROCESSADO
          FROM FIN_CHEQUES
          WHERE
          (CNPJ = :CNPJ) AND
          (BANCO = :BANCO) AND
          (CONTA = :CONTA) AND
          (CHEQUE = :CHEQUE)
          INTO :PROCESSADO ;

          IF ( :PROCESSADO = 'S' )
          THEN BEGIN
               EXCEPTION MOVIMENTO_CONCILIADO ;
          END
          ELSE BEGIN
               UPDATE FIN_CHEQUES
               SET CONCILIADO = 'N', DATA_CONCILIACAO = NULL
               WHERE
               (CNPJ = :CNPJ) AND
               (BANCO = :BANCO) AND
               (CONTA = :CONTA) AND
               (CHEQUE = :CHEQUE);
          END
     END
END
^

ALTER PROCEDURE CONCILIADOSPERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE,
    D1 DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_CONCILIACAO DATE)
AS
begin
     FOR SELECT ctb.data_conciliacao, COD_DOC, DOCUMENTO, substring(HISTORICO from 1 for 80), VALOR, TIPO,
     DATA_CONCILIACAO
     FROM CTB_MOVIMENTO_CONTABIL ctb
     WHERE CNPJ = :CNPJ AND CONTA = :CONTA AND DATA_CONCILIACAO IS NOT NULL AND
     DATA_CONCILIACAO >= :D AND DATA_CONCILIACAO <= :D1
     ORDER BY ctb.DATA_CONCILIACAO, COD_DOC, DOCUMENTO
     INTO :DATA, :COD_DOC, :DOCUMENTO, :HISTORICO, :VALOR, :TIPO, :DATA_CONCILIACAO
     DO BEGIN
        suspend;
     END
END
^

ALTER PROCEDURE CONFERE_DOCTO_PAGAR (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DOCTO VARCHAR(20),
    CODIGO INTEGER,
    ANO INTEGER)
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
     SELECT COUNT(*)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ
     AND DOCTO = :DOCTO
     AND PESSOA_FJ = :PESSOA_FJ
     AND ( CODIGO <> :CODIGO AND ANO <> :ANO )
     INTO :NUMERO ;

     SUSPEND;
END
^

ALTER PROCEDURE CONFERE_DOCTO_RECEBER (
    CNPJ CHAR(14),
    TIPO_DOCTO VARCHAR(3),
    DOCTO VARCHAR(20))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
     SELECT COUNT(*)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ
     AND DOCTO = :DOCTO
     AND TIPO_DOCTO = :TIPO_DOCTO
     INTO :NUMERO ;

     SUSPEND;
END
^

ALTER PROCEDURE CONFERE_ESTOQUE_GRADE (
    CNPJ CHAR(14))
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    QUANTIDADE_GRADE NUMERIC(18,4))
AS
begin
     FOR SELECT QTDADE_2, CODIGO, NOME
     FROM EST_PRODUTOS
     WHERE CNPJ = :CNPJ
     INTO :QUANTIDADE, :PRODUTO, :NOME
     DO BEGIN
        SELECT SUM(ESTOQUE)
        FROM EST_PRODUTOS_GRADES_NUMEROS
        WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
        INTO :QUANTIDADE_GRADE ;
        /*nao sei pra q este calculo.. fb*/
        IF ((QUANTIDADE) <>
        (QUANTIDADE))
        THEN
            SUSPEND ;
     END
END
^

ALTER PROCEDURE CONFEREPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
RETURNS (
    CONFERE CHAR(1))
AS
DECLARE VARIABLE C NUMERIC(18,4);
DECLARE VARIABLE D NUMERIC(18,4);
begin
     SELECT SUM(VALOR) FROM CTB_DESDOBRA_MOVIMENTO_CONTAS
     WHERE TIPO =  'C' AND PLANILHA = :PLANILHA AND CNPJ = :CNPJ
     INTO :C;

     IF ( C IS NULL )
     THEN
         C = 0 ;

     SELECT SUM(VALOR) FROM CTB_DESDOBRA_MOVIMENTO_CONTAS
     WHERE TIPO =  'D' AND PLANILHA = :PLANILHA
     INTO :D;

     IF ( D IS NULL )
     THEN
         D = 0 ;

     select * from round2(:C) into :c;
     select * from round2(:D) into :d;
     IF (C <> D) THEN
     BEGIN
          CONFERE = 'N';
     END
     ELSE BEGIN
          CONFERE = 'S';
     END
END
^

ALTER PROCEDURE CONFIGURA_DIREITOS
AS
DECLARE VARIABLE PERFIL INTEGER;
DECLARE VARIABLE MODULO INTEGER;
DECLARE VARIABLE CONT   INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM SIS_PERFIL
     WHERE CODIGO <> 1
     INTO :PERFIL
     DO BEGIN
        /* DESCOBRINDO O CODIGO DO MODULO */
        FOR SELECT MODULO
        FROM SIS_DIREITOS_PERFIL
        WHERE PERFIL = 1
        INTO :MODULO
        DO BEGIN
           SELECT COUNT(*) FROM SIS_DIREITOS_PERFIL
           WHERE PERFIL = :PERFIL AND MODULO = :MODULO
           INTO :CONT ;

           IF (( CONT = 0 ) OR ( CONT IS NULL ))
           THEN BEGIN
                INSERT INTO SIS_DIREITOS_PERFIL
                ( PERFIL, MODULO, DIREITO )
                VALUES
                (:PERFIL, :MODULO, '' );
           END
        END
     END

  /* TCHAU */
  SUSPEND;
END
^

ALTER PROCEDURE CONSULTA_COBRANCA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    VLR_NOMINAL NUMERIC(18,4),
    VLR_BAIXADO NUMERIC(18,4),
    SALDO_NOMINAL NUMERIC(18,4),
    INDICE VARCHAR(70),
    DATA DATE,
    ULTIMA_BAIXA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    ENDERECO_TRABALHO VARCHAR(50),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    NUMERO_TRABALHO VARCHAR(15),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    CPF_CGC VARCHAR(15),
    AGENDADO_PARA TIMESTAMP,
    COBRAR_EM TIMESTAMP,
    MOTIVO VARCHAR(50),
    HISTORICO VARCHAR(100),
    COBRADOR INTEGER,
    CONTPAGAS INTEGER,
    CONTAGENDAMENTOS INTEGER,
    LOCAL_COBRANCA INTEGER,
    NOME_COBRADOR VARCHAR(50),
    RECEBER INTEGER,
    ANO INTEGER,
    DOCTO VARCHAR(20),
    ORIGEM CHAR(3),
    LANCAMENTO TIMESTAMP,
    VENDA INTEGER,
    SELECIONADO CHAR(1),
    ARQ_MORTO CHAR(1),
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
DECLARE VARIABLE TOTALRECEBER NUMERIC(18,4);
DECLARE VARIABLE COD_MOTIVO INTEGER;
DECLARE VARIABLE END_TRAB INTEGER;
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE TX_JUROS_APOS NUMERIC(18,8);
DECLARE VARIABLE TX_JUROS_ATE NUMERIC(18,8);
DECLARE VARIABLE TOLERANCIA_JUROS INTEGER;
DECLARE VARIABLE MULTA_FINANCEIRA NUMERIC(18,4);
DECLARE VARIABLE VALOR_ACRESCIMO NUMERIC(18,8);
DECLARE VARIABLE TIPO CHAR(1);
DECLARE VARIABLE VLR_RECEBER NUMERIC(18,4);
BEGIN
     /*soma o total de contas a receber*/
     select sum(valor-vlr_parcial)
     from fin_contas_receber
     where cnpj = :cnpj
     and fatura is null
     into :totalreceber;

     /*tolerância de multa*/
     select e.tx_juros_apos, e.tx_juros_ate, e.tipo_taxa
     from sis_empresas e
     where cnpj = :cnpj
     into :tx_juros_apos, :tx_juros_ate, :tipo;

     /*tolerância de juros*/
     select coalesce(c.tolerancia_juros,0), coalesce(c.multa_financeira,0)
     from sis_configuracoes c
     where cnpj = :cnpj
     into :tolerancia_juros, :multa_financeira;

     /*Percorrendo Todas as contas a receber*/
     for select (coalesce(valor,0)-coalesce(vlr_parcial,0)), coalesce(juros_rec,0),
         coalesce(descontos,0), dt_vencto, pessoa_fj, codigo, docto, dt_emissao,
         ano, codigo_vn, DATA_ULT_BAIXA, coalesce(rec.arquivo_morto,'N'),rec.local_cobranca,
         rec.valor, rec.vlr_parcial
         from fin_contas_receber rec
         where cnpj = :cnpj and fatura is null
         into :soma, :juros_rec,
               :descontos, :data, :pessoa_fj, :receber, :docto, :lancamento,
               :ano, :venda, :ULTIMA_BAIXA, :arq_morto, :local_cobranca,
               :vlr_nominal, :vlr_baixado
     do
     begin
        saldo_nominal = :soma;
        vlr_receber = :soma;

        /*------------------------------------Calculando ACréscimos-------------------------------------- */
        if (:ULTIMA_BAIXA > :data) then
            data = :ULTIMA_BAIXA;
    
        /* */select coalesce(valor_multa,0) from pcd_calcula_multa_rec(:cnpj,:receber,:pessoa_fj,:venda,:dt_cx,:tolerancia_juros, :multa_financeira)
        into :valor_acrescimo;

        multa = :valor_acrescimo;

        soma = :soma + :valor_acrescimo;
    
        select coalesce(valor_juros,0) from pcd_calcula_juros(:cnpj,:SOMA,:DATA,:dt_cx,:tx_juros_ate,:tx_juros_apos,:tipo,:tolerancia_juros)
        into :valor_acrescimo;

        juros = :valor_acrescimo;
        /*No antigo codigo soma = soma + :valor_acrescimo, o codigo computava a multa 2 vezes,
        embora "vantajoso" fazia diferente na aplicação causando inconsistencia de valores,
        por "retiro" a multa deste calculo de procedure somando o vlr. de juros ao valor do contas à receber,
        embora este valor de juros tenha sido calculado com o vlr. de multa embutido no vlr. de receber #$%@$@!!!!*/
        soma = :vlr_receber + :valor_acrescimo;

        select count(*) from fin_baixas_receber rec
        where rec.cnpj = :cnpj and rec.codigo_cr = :receber and rec.pessoa_fj = :pessoa_fj
        into :contpagas;

        contagendamentos = 0;
        cod_motivo = null;
        agendado_para = null;
        cobrar_em = null;
        historico = null;
        cod_motivo = null;
        motivo = null;
        cod_end = null;
        cod_cid = null;
        cod_bai = null;
        fone = null;
        fax = null;
        celular = null;
        local_trabalho = null;
        fone_trabalho = null;
        agendado_para = null;
        cobrar_em = null;
        nome_cobrador = null;
        cobrador = null;
        origem = 'REC';
        indice = null;

        /*Percorrendo as Cobranças DESTA CONTA, e ordenando por data de cobrança*/
        for select data_cobranca, cobrar_em, historico, motivo, cobrador, selecionado, indice,
            hr_cobrar_em, hr_cobranca
        from fin_cobrancas
        where cnpj = :cnpj and pessoa_fj = :pessoa_fj and receber = :receber
        and pago_em is null and origem = 'REC'
        order by data_cobranca
        into :agendado_para, :cobrar_em, :historico, :cod_motivo, :cobrador, :selecionado,:indice,
        :hr_cobrar_em, :hr_cobranca
        do begin
           /*dados do cobrandor*/
           select nome from fin_cobrador
           where cnpj = :cnpj and codigo = :cobrador
           into :nome_cobrador ;

           /*motivo de conbrança*/
           select nome from fin_motivo_cobranca
           where cnpj = :cnpj and codigo = :cod_motivo
           into :motivo ;

           contagendamentos = contagendamentos + 1;
        end


        /*Selecionando dados da pessoa   */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf, fax, celular
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
             :numero, :cep, :uf, :fax, :celular;
               
        /*Selecionando dados do cliente */
        select local_trabalho, fone_trabalho,
        endereco_trabalho, numero_trabalho
        from glo_clientes where cnpj = :cnpj and pessoa_fj = :pessoa_fj
        into :local_trabalho, :fone_trabalho, :end_trab, :numero_trabalho;

        /*logradouros do trabalho  */
        select nome from glo_logradouros
        where codigo = :end_trab and cnpj = :cnpj
        into :endereco_trabalho ;

        /*logradoutos     */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /*cidades  */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /*bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;
        
        soma = coalesce(soma,0);
        /*if (totalreceber > 0) then
          porcentagem = (soma / totalreceber) * 100;*/

        /* o suspende deve ficar fora do laco acima pois se
        uma parcela ainda nao foi agendada ela tbm devera aparecer
        e como foi colocado em ordem de data_cobranca
        aparecera apenas a ultima cobranca feita  */
        if (cobrar_em is null) then
        begin
           /*como não tem conbrança, verifico se a data de vencto
           está dentro do periodo especificado*/
           if (data between :ini and :fim)then
            suspend;

        end
        else
        begin
          /*Verificando se está na hora de fazer uma nova cobrança
          para esta conta*/
          if (cobrar_em between :ini and :fim) then
            suspend;
        end
     end
END
^

ALTER PROCEDURE CONSULTA_COBRANCA_PESSOA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    PESSOA INTEGER)
RETURNS (
    EMP_EMPRESA VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_CNPJ VARCHAR(20),
    EMP_ENDERECO VARCHAR(80),
    EMP_CEP VARCHAR(20),
    EMP_BAIRRO VARCHAR(50),
    EMP_FONE VARCHAR(20),
    REC_ANO_VN SMALLINT,
    REC_CODIGO_TRC INTEGER,
    REC_CODIGO_VN INTEGER,
    REC_DATA_ULT_BAIXA TIMESTAMP,
    REC_DOCTO VARCHAR(20),
    REC_DT_AVISO TIMESTAMP,
    REC_DT_EMISSAO TIMESTAMP,
    REC_DT_LANCTO TIMESTAMP,
    REC_DT_VENCTO DATE,
    REC_HISTORICO VARCHAR(100),
    REC_JUROS_PARCIAL FLOAT,
    REC_JUROS_REC FLOAT,
    REC_ORIGEM CHAR(3),
    REC_PARCELA VARCHAR(6),
    REC_PARCIAL FLOAT,
    REC_TIPO_DOCTO CHAR(3),
    REC_VALOR FLOAT,
    REC_VALOR_NOMINAL FLOAT,
    REC_VLR_ORIG_ALT CHAR(1),
    REC_VLR_PARCIAL FLOAT,
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA TIMESTAMP,
    ULTIMA_BAIXA TIMESTAMP,
    NOME VARCHAR(50),
    PESSOA_FJ INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    ENDERECO_TRABALHO VARCHAR(50),
    NUMERO_TRABALHO VARCHAR(15),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    CPF_CGC VARCHAR(15),
    AGENDADO_PARA TIMESTAMP,
    COBRAR_EM TIMESTAMP,
    MOTIVO VARCHAR(50),
    HISTORICO VARCHAR(100),
    COBRADOR INTEGER,
    FANTASIA VARCHAR(50),
    RG_IE VARCHAR(15),
    DT_NASCIMENTO TIMESTAMP,
    NOME_COBRADOR VARCHAR(50),
    RECEBER INTEGER,
    ANO INTEGER,
    ATRASO INTEGER,
    DOCTO VARCHAR(20),
    ORIGEM CHAR(3),
    LANCAMENTO TIMESTAMP,
    VENDA INTEGER,
    SELECIONADO CHAR(1),
    TOTALRECEBER NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4))
AS
DECLARE VARIABLE END_TRAB INTEGER;
DECLARE VARIABLE COD_MOTIVO INTEGER;
BEGIN
    /* DADOS DA EMPRESA */
    SELECT E.NOME, E.FONE, E.ENDERECO, E.CEP, E.BAIRRO, E.CIDADE  FROM SIS_EMPRESAS E
    WHERE E.CNPJ = :CNPJ
    INTO :EMP_EMPRESA , :EMP_FONE, :EMP_ENDERECO, :EMP_CEP, :EMP_BAIRRO, :EMP_CIDADE;
    EMP_CNPJ = SUBSTRING(:CNPJ FROM 1 FOR 2)||'.'||SUBSTRING(:CNPJ FROM 3 FOR 3)||'.'||SUBSTRING(:CNPJ FROM 6 FOR 3)||'/'||SUBSTRING(:CNPJ FROM 9 FOR 4)||'-'||SUBSTRING(:CNPJ FROM 13 FOR 2);

     /* SOMA O TOTAL DE CONTAS A RECEBER */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ/* AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM*/
     AND FATURA IS NULL
     INTO :TOTALRECEBER;

     FOR SELECT VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, DT_VENCTO, CODIGO, PESSOA_FJ,
     DOCTO, DT_EMISSAO, ANO, CODIGO_VN, DATA_ULT_BAIXA,

     /* DADOS RECEBER */
     REC.ANO_VN,        REC.CODIGO_TRC, REC.CODIGO_VN,     REC.DATA_ULT_BAIXA, REC.DOCTO,
     REC.DT_AVISO,      REC.DT_EMISSAO, REC.DT_LANCTO,     REC.DT_VENCTO,      REC.HISTORICO,
     REC.JUROS_PARCIAL, REC.JUROS_REC,  REC.ORIGEM,        REC.PARCELA,        REC.PARCIAL,
     REC.TIPO_DOCTO,    REC.VALOR,      REC.VALOR_NOMINAL, REC.VLR_ORIG_ALT,   REC.VLR_PARCIAL
     FROM FIN_CONTAS_RECEBER REC
     WHERE CNPJ = :CNPJ /*AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM*/
     AND FATURA IS NULL AND PESSOA_FJ = :PESSOA
     INTO :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :DATA, :RECEBER, :PESSOA_FJ,
     :DOCTO, :LANCAMENTO, :ANO, :VENDA, :ULTIMA_BAIXA,
     /* DADOS RECEBER */
     :REC_ANO_VN, :REC_CODIGO_TRC, :REC_CODIGO_VN, :REC_DATA_ULT_BAIXA, :REC_DOCTO,
     :REC_DT_AVISO, :REC_DT_EMISSAO, :REC_DT_LANCTO, :REC_DT_VENCTO, :REC_HISTORICO,
     :REC_JUROS_PARCIAL, :REC_JUROS_REC, :REC_ORIGEM, :REC_PARCELA, :REC_PARCIAL,
     :REC_TIPO_DOCTO, :REC_VALOR, :REC_VALOR_NOMINAL, :REC_VLR_ORIG_ALT, :REC_VLR_PARCIAL
     DO BEGIN
        ORIGEM         = 'REC';
        SOMA           = NULL;
        COD_MOTIVO     = NULL;
        AGENDADO_PARA  = NULL;
        COBRAR_EM      = NULL;
        HISTORICO      = NULL;
        COD_MOTIVO     = NULL;
        MOTIVO         = NULL;
        COD_END        = NULL;
        COD_CID        = NULL;
        COD_BAI        = NULL;
        FONE           = NULL;
        FAX            = NULL;
        CELULAR        = NULL;
        LOCAL_TRABALHO = NULL;
        FONE_TRABALHO  = NULL;
        AGENDADO_PARA  = NULL;
        COBRAR_EM      = NULL;
        NOME_COBRADOR  = NULL;
        COBRADOR       = NULL;

        if (:rec_dt_vencto < cast('today' as date)) then
          atraso = (cast('today' as date) - :rec_dt_vencto);
        else
          atraso = 0;



        if ( valor is null ) then
          valor = 0;

        IF ( VLR_PARCIAL IS NULL )
        THEN
            VLR_PARCIAL = 0;

        IF ( JUROS_REC IS NULL )
        THEN
            JUROS_REC = 0;

        IF ( DESCONTOS IS NULL )
        THEN
            DESCONTOS = 0;

        SOMA = :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF, FAX, CELULAR, FANTASIA, RG_IE, DT_NASCIMENTO
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF, :FAX, :CELULAR, :FANTASIA, :RG_IE, :DT_NASCIMENTO;
               
        /* CLIENTES */
        SELECT LOCAL_TRABALHO, FONE_TRABALHO,
        ENDERECO_TRABALHO, NUMERO_TRABALHO
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :LOCAL_TRABALHO, :FONE_TRABALHO, :END_TRAB, :NUMERO_TRABALHO ;

        /* LOGRADOUROS DO TRABALHO*/
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :END_TRAB AND CNPJ = :CNPJ
        INTO :ENDERECO_TRABALHO ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;
        
        IF ( TOTALRECEBER > 0 )
        THEN
            PORCENTAGEM = SOMA / TOTALRECEBER * 100;

        /* AGENDAMENTO DE COBRANCAS */
        FOR SELECT DATA_COBRANCA, COBRAR_EM, HISTORICO,
        MOTIVO, COBRADOR, SELECIONADO
        FROM FIN_COBRANCAS
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND RECEBER = :RECEBER
        AND PAGO_EM IS NULL AND ORIGEM = 'REC'
        ORDER BY DATA_COBRANCA
        INTO :AGENDADO_PARA, :COBRAR_EM, :HISTORICO, :COD_MOTIVO, :COBRADOR,
        :SELECIONADO
        DO BEGIN
           SELECT NOME FROM FIN_COBRADOR
           WHERE CNPJ = :CNPJ AND CODIGO = :COBRADOR
           INTO :NOME_COBRADOR ;

           SELECT NOME FROM FIN_MOTIVO_COBRANCA
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_MOTIVO
           INTO :MOTIVO ;

        END

        IF ( COBRAR_EM IS NULL )
        THEN BEGIN
             IF ( DATA >= :INI AND DATA <= :FIM )
             THEN
                 SUSPEND; /* O SUSPENDE DEVE FICAR FORA DO LACO ACIMA POIS SE
                    UMA PARCELA AINDA NAO FOI AGENDADA ELA TBM DEVERA APARECER
                    E COMO FOI COLOCADO EM ORDEM DE DATA_COBRANCA
                    APARECERA APENAS A ULTIMA COBRANCA FEITA  */
        END
        ELSE BEGIN
             IF ( COBRAR_EM >= :INI AND COBRAR_EM <= :FIM )
             THEN
                 SUSPEND; /* O SUSPENDE DEVE FICAR FORA DO LACO ACIMA POIS SE
                    UMA PARCELA AINDA NAO FOI AGENDADA ELA TBM DEVERA APARECER
                    E COMO FOI COLOCADO EM ORDEM DE DATA_COBRANCA
                    APARECERA APENAS A ULTIMA COBRANCA FEITA  */

        END

     END

     FOR SELECT
     VALOR,
     BAIXAS_PARCIAIS,
     JUROS,
     DESCONTO,
     VENCIMENTO,
     CODIGO,
     PESSOA_FJ,
     DATA,
     ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND VENCIMENTO >= :INI AND VENCIMENTO <= :FIM
     AND PESSOA_FJ = :PESSOA AND BAIXADA <> 'S'
     INTO :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :DATA, :RECEBER, :PESSOA_FJ,
     :LANCAMENTO, :ULTIMA_BAIXA
     DO BEGIN
        VENDA = 0;

        DOCTO = CAST( :RECEBER AS VARCHAR(20) );

        ORIGEM = 'FAT';
        ANO = 0;
        SOMA = NULL;
        COD_MOTIVO = NULL;
        AGENDADO_PARA = NULL;
        COBRAR_EM = NULL;
        HISTORICO = NULL;
        COD_MOTIVO = NULL;
        MOTIVO     = NULL;
        COD_END = NULL;
        COD_CID = NULL;
        COD_BAI = NULL;
        FONE = NULL;
        FAX = NULL;
        CELULAR = NULL;
        LOCAL_TRABALHO = NULL;
        FONE_TRABALHO = NULL;
        AGENDADO_PARA = NULL;
        COBRAR_EM = NULL;
        NOME_COBRADOR = NULL;
        COBRADOR = NULL;

        IF ( VALOR IS NULL )
        THEN
            VALOR = 0;

        IF ( VLR_PARCIAL IS NULL )
        THEN
            VLR_PARCIAL = 0;

        IF ( JUROS_REC IS NULL )
        THEN
            JUROS_REC = 0;

        IF ( DESCONTOS IS NULL )
        THEN
            DESCONTOS = 0;

        SOMA = :VALOR ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF, FAX, CELULAR
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF, :FAX, :CELULAR;
               
        /* CLIENTES */
        SELECT LOCAL_TRABALHO, FONE_TRABALHO
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :LOCAL_TRABALHO, :FONE_TRABALHO ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;
        
        IF ( TOTALRECEBER > 0 )
        THEN
            PORCENTAGEM = SOMA / TOTALRECEBER * 100;

        /* AGENDAMENTO DE COBRANCAS */
        FOR SELECT DATA_COBRANCA, COBRAR_EM, HISTORICO,
        MOTIVO, COBRADOR, SELECIONADO
        FROM FIN_COBRANCAS
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND RECEBER = :RECEBER
        AND PAGO_EM IS NULL AND ORIGEM = 'FAT'
        ORDER BY DATA_COBRANCA
        INTO :AGENDADO_PARA, :COBRAR_EM, :HISTORICO, :COD_MOTIVO, :COBRADOR,
        :SELECIONADO
        DO BEGIN
               SELECT NOME FROM FIN_COBRADOR
               WHERE CNPJ = :CNPJ AND CODIGO = :COBRADOR
               INTO :NOME_COBRADOR ;
    
               SELECT NOME FROM FIN_MOTIVO_COBRANCA
               WHERE CNPJ = :CNPJ AND CODIGO = :COD_MOTIVO
               INTO :MOTIVO ;

        END

        IF ( COBRAR_EM IS NULL )
        THEN BEGIN
             IF ( DATA >= :INI AND DATA <= :FIM )
             THEN
                 SUSPEND; /* O SUSPENDE DEVE FICAR FORA DO LACO ACIMA POIS SE
                    UMA PARCELA AINDA NAO FOI AGENDADA ELA TBM DEVERA APARECER
                    E COMO FOI COLOCADO EM ORDEM DE DATA_COBRANCA
                    APARECERA APENAS A ULTIMA COBRANCA FEITA  */
        END
        ELSE BEGIN
             IF ( COBRAR_EM >= :INI AND COBRAR_EM <= :FIM )
             THEN
                 SUSPEND; /* O SUSPENDE DEVE FICAR FORA DO LACO ACIMA POIS SE
                    UMA PARCELA AINDA NAO FOI AGENDADA ELA TBM DEVERA APARECER
                    E COMO FOI COLOCADO EM ORDEM DE DATA_COBRANCA
                    APARECERA APENAS A ULTIMA COBRANCA FEITA  */

        END

     END
END
^

ALTER PROCEDURE CONSULTA_COTACOES (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    FORMA_PGTO INTEGER,
    NOME_FORMA VARCHAR(50),
    TRANSPORTADORA VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    DESC_ACRESC NUMERIC(18,4),
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT 
         CODIGO, DATA, PESSOA_FJ, USUARIO, FORMA_PGTO, OBSERVACAO,
         TOTAL, FECHADO, DESC_ACRESC, NOME_TRANSPORTADORA
     FROM FAT_COTACOES
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO  :CODIGO, :DATA, :PESSOA_FJ, :USUARIO, :FORMA_PGTO, :OBSERVACAO,
           :TOTAL, :FECHADO, :DESC_ACRESC, :TRANSPORTADORA
     DO BEGIN
        SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :COD
        INTO :NOME ;
        
        /* NOME FORMA */
        SELECT NOME FROM FIN_FORMAS_PAGTO
        WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
        INTO :NOME_FORMA;

        SUSPEND;
     END
END
^

ALTER PROCEDURE CONSULTA_COTACOES_ITENS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER)
AS
BEGIN
     FOR SELECT 
         PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO,
         DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL, SUBUNIDADE, NOME_PRODUTO
      FROM FAT_COTACOES_ITENS
      WHERE CNPJ = :CNPJ AND CODIGO =:CODIGO
      INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
           :DESCONTO, :PORC_DESC, :UNIDADE, :PRC_UNIT_ORIGINAL, :SUBUNIDADE, :NOME_PRODUTO
      DO BEGIN

         SUSPEND;
      END
END
^

ALTER PROCEDURE CONSULTA_GARANTIA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    FORMA_PGTO INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_FORMA VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50))
AS
BEGIN
     SELECT PESSOA_FJ, NOME, CODIGO, DATA, TOTAL, FECHADO, VENDEDOR,
            USUARIO, NOME_CONSUMIDOR, OBSERVACAO, CARTAO, CHEQUE,
            DESC_ACRESC, DINHEIRO, ENTRADA, TICKET,  TIPO_DOCTO,
            FORMA_PGTO, LOCAL_COBRANCA, TOTAL_2, DESC_ACRESC_2
     FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND CODIGO = :COD
     INTO
         :PESSOA_FJ, :NOME, :CODIGO , :DATA, :TOTAL, :FECHADO, :VENDEDOR,
         :USUARIO, :NOME_CONSUMIDOR, :OBSERVACAO, :CARTAO, :CHEQUE,
         :DESC_ACRESC, :DINHEIRO, :ENTRADA, :TICKET, :TIPO_DOCTO,
         :FORMA_PGTO, :LOCAL_COBRANCA, :TOTAL_2, :DESC_ACRESC_2 ;

     /* VALOR LIQUIDO */
     VLR_TOTAL = :TOTAL + :DESC_ACRESC ;

     /* VENDEDORRES */
     SELECT NOME FROM FAT_VENDEDOR
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
     INTO :NOME_VENDEDOR ;
      
     /* NOME DOCUMENTO */
     SELECT NOME FROM GLO_TIPOS_DOCTO
     WHERE CNPJ = :CNPJ AND SIGLA = :TIPO_DOCTO
     INTO :NOME_DOCUMENTO;
     
     /* NOME FORMA */
     SELECT NOME FROM FIN_FORMAS_PAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
     INTO :NOME_FORMA;

     /* PLANO DE CONTAS */
     SELECT NOME FROM CTB_PLANOCONTA
     WHERE CNPJ = :CNPJ AND CONTA = :LOCAL_COBRANCA
     INTO :NOME_LOCAL;
     
     SUSPEND;
END
^

ALTER PROCEDURE CONSULTA_ORDEM_SERV_ITENS_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
     FOR SELECT
             SERVICO,
             NOME,
             QUANTIDADE,
             UNITARIO,
             SELECIONADO
      FROM OFC_ORDEM_SERVICO_SERVICO_ORC
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :SERVICO,
           :NOME,
           :QUANTIDADE,
           :UNITARIO,
           :SELECIONADO
      DO
      BEGIN
           SUSPEND;
      END
END
^

ALTER PROCEDURE CONSULTA_ORDEM_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA DATE,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    VLR_ENTRADA NUMERIC(18,4),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    MED_VIRABREQUIM VARCHAR(20),
    MED_BIELA VARCHAR(20),
    MED_CILINDRO VARCHAR(20),
    MED_CARCACA VARCHAR(20),
    ORCAMENTO INTEGER,
    NUMERO_VENDA INTEGER,
    DEFEITO_RECLAMADO VARCHAR(50),
    CONDICAO_FINAL_EQUIPAMENTO VARCHAR(50),
    HORA_CHEGADA TIME,
    HORA_SAIDA TIME,
    CONTADOR_TOTAL NUMERIC(18,4),
    CONTADOR_COR NUMERIC(18,4),
    CONTADOR_PRETO NUMERIC(18,4),
    CONTADOR_IMPRESSAO NUMERIC(18,4),
    CONTADOR_CILINDRO NUMERIC(18,4),
    CONTADOR_REVELADOR NUMERIC(18,4),
    NOME_DEFEITO VARCHAR(50),
    PROPRIEDADE INTEGER,
    NOME_PROPRIEDADE VARCHAR(50),
    CAUSA_CHAMADO VARCHAR(200),
    TIPO_ATENDIMENTO VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF VARCHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    ATIVA CHAR(1),
    TIPO_CONTRATO VARCHAR(50),
    MODELO VARCHAR(50),
    GARANTIA DATE,
    CPF VARCHAR(20),
    VENDEDOR INTEGER,
    TECNICO INTEGER,
    CONTRATO VARCHAR(20),
    VENDA INTEGER)
AS
DECLARE VARIABLE CODIGO_DEFEITO INTEGER;
DECLARE VARIABLE CODIGO_CIDADE INTEGER;
DECLARE VARIABLE CODIGO_BAIRRO INTEGER;
DECLARE VARIABLE CODIGO_ENDERECO INTEGER;
DECLARE VARIABLE CODIGO_CONTRATO INTEGER;
DECLARE VARIABLE CODIGO_MODELO INTEGER;
begin
     FOR SELECT
         DATA, PESSOA_FJ, NOME,
         NATUREZA, MECANICO, VIAJANTE, ENTRADA,
         HISTORICO, CHASSI, TOTAL, DESC_ACRESC,
         CLIENTE, FECHADO, NOME_NATUREZA,
         NOME_MECANICO, NOME_VIAJANTE, NOME_MOTOR,
         VLR_ENTRADA, NF, ALIQUOTA_ISS,
         MED_VIRABREQUIM, MED_BIELA, MED_CILINDRO,
         MED_CARCACA, ORCAMENTO,
         NUMERO_VENDA, DEFEITO_RECLAMADO,
         CONDICAO_FINAL_EQUIPAMENTO, HORA_CHEGADA, HORA_SAIDA,
         CONTADOR_TOTAL, CONTADOR_CILINDRO, CONTADOR_REVELADOR ,
         NOME_DEFEITO, PROPRIEDADE, NOME_PROPRIEDADE, CAUSA_CHAMADO,
         TIPO_ATENDIMENTO, CONTADOR_COR, CONTADOR_PRETO, CONTADOR_IMPRESSAO,
         VENDA
     FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
         :DATA, :PESSOA_FJ, :NOME,
         :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
         :HISTORICO, :CHASSI, :TOTAL, :DESC_ACRESC,
         :CLIENTE, :FECHADO, :NOME_NATUREZA,
         :NOME_MECANICO, :NOME_VIAJANTE, :NOME_MOTOR,
         :VLR_ENTRADA, :NF, :ALIQUOTA_ISS,
         :MED_VIRABREQUIM, :MED_BIELA, :MED_CILINDRO,
         :MED_CARCACA, :ORCAMENTO, :NUMERO_VENDA, :CODIGO_DEFEITO,
         :CONDICAO_FINAL_EQUIPAMENTO, :HORA_CHEGADA, :HORA_SAIDA,
         :CONTADOR_TOTAL, :CONTADOR_CILINDRO, :CONTADOR_REVELADOR ,
         :NOME_DEFEITO, :PROPRIEDADE, :NOME_PROPRIEDADE, :CAUSA_CHAMADO,
         :TIPO_ATENDIMENTO, :CONTADOR_COR, :CONTADOR_PRETO, :CONTADOR_IMPRESSAO,
         :VENDA
     DO BEGIN
         /* DADOS DO EQUIPAMENTO */
         SELECT PROPRIETARIO, IE, ENDERECO,
         COMPLEMENTO, CIDADE, UF, CEP, AREA_TOTAL, OBS,
         NUMERO, BAIRRO , ATIVA, TIPO_CONTRATO, MODELO,
         GARANTIA, CPF, VENDEDOR, TECNICO, CONTRATO
         FROM GLO_PROPRIEDADES
         WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND PROPRIEDADE = :PROPRIEDADE
         INTO :PROPRIETARIO, :IE, :CODIGO_ENDERECO,
         :COMPLEMENTO, :CODIGO_CIDADE, :UF, :CEP, :AREA_TOTAL, :OBS,
         :NUMERO, :CODIGO_BAIRRO , :ATIVA, :CODIGO_CONTRATO, :CODIGO_MODELO,
         :GARANTIA, :CPF, :VENDEDOR, :TECNICO, :CONTRATO ;

         SELECT NOME FROM GLO_CIDADES
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_CIDADE
         INTO :CIDADE ;

         SELECT NOME FROM GLO_BAIRROS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_BAIRRO
         INTO :BAIRRO ;

         SELECT NOME FROM GLO_LOGRADOUROS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_ENDERECO
         INTO :ENDERECO ;

         SELECT NOME FROM GLO_TIPO_CONTRATO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_CONTRATO
         INTO :TIPO_CONTRATO ;

         SELECT NOME FROM GLO_MODELO_PROPRIEDADE
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MODELO
         INTO :MODELO ;

         SELECT NOME FROM OFC_DEFEITO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_DEFEITO
         INTO :DEFEITO_RECLAMADO ;

         suspend;
     END
END
^

ALTER PROCEDURE CONSULTA_ORDEM_SERVICO_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
BEGIN
     FOR SELECT
             SERVICO,
             NOME,
             QUANTIDADE,
             UNITARIO,
             SELECIONADO
      FROM OFC_ORDEM_SERVICO_SERVICO
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :SERVICO,
           :NOME,
           :QUANTIDADE,
           :UNITARIO,
           :SELECIONADO
      DO
      BEGIN
           SUSPEND;
      END
END
^

ALTER PROCEDURE CONSULTA_ORDEM_SERVICO_ORC (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA DATE,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    VLR_ENTRADA NUMERIC(18,4),
    VALIDADE DATE)
AS
begin
     FOR SELECT
         DATA, PESSOA_FJ, NOME,
         NATUREZA, MECANICO, VIAJANTE, ENTRADA,
         HISTORICO, CHASSI, TOTAL, DESC_ACRESC,
         CLIENTE, FECHADO, NOME_NATUREZA,
         NOME_MECANICO, NOME_VIAJANTE, NOME_MOTOR,
         VLR_ENTRADA, VALIDADE
     FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
         :DATA, :PESSOA_FJ, :NOME,
         :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
         :HISTORICO, :CHASSI, :TOTAL, :DESC_ACRESC,
         :CLIENTE, :FECHADO, :NOME_NATUREZA,
         :NOME_MECANICO, :NOME_VIAJANTE, :NOME_MOTOR,
         :VLR_ENTRADA, :VALIDADE
     DO BEGIN
         suspend;
     END
END
^

ALTER PROCEDURE CONSULTA_TROCA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    OBSERVACAO VARCHAR(80),
    FORMA_PGTO INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_FORMA VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50))
AS
BEGIN
     SELECT PESSOA_FJ, NOME, CODIGO, DATA, TOTAL, FECHADO, VENDEDOR,
            USUARIO, NOME_CONSUMIDOR, OBSERVACAO, CARTAO, CHEQUE,
            DESC_ACRESC, DINHEIRO, ENTRADA, TICKET,  TIPO_DOCTO,
            FORMA_PGTO, LOCAL_COBRANCA, TOTAL_2, DESC_ACRESC_2
     FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND CODIGO = :COD
     INTO
         :PESSOA_FJ, :NOME, :CODIGO , :DATA, :TOTAL, :FECHADO, :VENDEDOR,
         :USUARIO, :NOME_CONSUMIDOR, :OBSERVACAO, :CARTAO, :CHEQUE,
         :DESC_ACRESC, :DINHEIRO, :ENTRADA, :TICKET, :TIPO_DOCTO,
         :FORMA_PGTO, :LOCAL_COBRANCA, :TOTAL_2, :DESC_ACRESC_2 ;

     /* VALOR LIQUIDO */
     VLR_TOTAL = :TOTAL + :DESC_ACRESC ;

     /* VENDEDORRES */
     SELECT NOME FROM FAT_VENDEDOR
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
     INTO :NOME_VENDEDOR ;
      
     /* NOME DOCUMENTO */
     SELECT NOME FROM GLO_TIPOS_DOCTO
     WHERE CNPJ = :CNPJ AND SIGLA = :TIPO_DOCTO
     INTO :NOME_DOCUMENTO;
     
     /* NOME FORMA */
     SELECT NOME FROM FIN_FORMAS_PAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
     INTO :NOME_FORMA;

     /* PLANO DE CONTAS */
     SELECT NOME FROM CTB_PLANOCONTA
     WHERE CNPJ = :CNPJ AND CONTA = :LOCAL_COBRANCA
     INTO :NOME_LOCAL;
     
     SUSPEND;
END
^

ALTER PROCEDURE CONSULTA_VENDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    EMP_EMPRESA VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_FONE VARCHAR(20),
    EMP_CEP VARCHAR(20),
    EMP_BAIRRO VARCHAR(50),
    EMP_ENDERECO VARCHAR(80),
    EMP_CNPJ VARCHAR(20),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    IMP_PEDIDO CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    USUARIO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    TIPO_VENDA CHAR(3),
    CONVENIADO INTEGER,
    NOME_CONVENIADO VARCHAR(50),
    NOME_CONSUMIDOR VARCHAR(50),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBSERVACAO VARCHAR(600),
    PROPRIEDADE INTEGER,
    NOME_PROPRIEDADE VARCHAR(50),
    TERCEIRO INTEGER,
    FORMA_PGTO INTEGER,
    CARGA INTEGER,
    CARTAO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    LOCAL INTEGER,
    LOCAL_COBRANCA INTEGER,
    TIPO_DOCTO CHAR(3),
    NOME_VENDEDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    NOME_NATUREZA VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    NOME_TERCEIRO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50),
    NOME_DOCUMENTO VARCHAR(50),
    NOME_LOCAL VARCHAR(50),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    KM_ATUAL NUMERIC(18,4),
    MEDIA_KM NUMERIC(18,4),
    AVISTA CHAR(1),
    ENDERECO_CONSUMIDOR VARCHAR(30),
    DOCUMENTOS_CONSUMIDOR VARCHAR(20),
    CIDADE_CONSUMIDOR VARCHAR(50),
    TRANSPORTADORA INTEGER,
    DATA_CAIXA DATE,
    REQUISICAO VARCHAR(6),
    TROCO NUMERIC(18,4),
    PCT_COMISSAO NUMERIC(18,4),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
     /*  DADOS EMPRESA */
     select e.nome, e.fone, e.endereco, e.cep, e.bairro, e.cidade  from sis_empresas e
     where e.cnpj = :cnpj
     into :emp_empresa , :emp_fone, :emp_endereco, :emp_cep, :emp_bairro, :emp_cidade;
  
     emp_cnpj = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

     select pessoa_fj, nome, codigo, data, total, fechada, historico, vendedor,
            usuario, num_nf, num_cupom, natureza, tipo_venda, conveniado, nome_consumidor,
            descricao, observacao, propriedade, terceiro, carga, cartao, cheque,
            desc_acres, dinheiro, entrada, ticket, peso, volume, local, tipo_docto,
            forma_pgto, local_cobranca, base_icm, icm, base_icm_subst,
            valor_icm_subst, frete, seguro, despesas, ipi, total_nota,
            km_atual, media_km, endereco_consumidor, documentos_consumidor,
            transportadora, data_caixa, requisicao,
            troco, cidade_consumidor, pct_comissao, nfe_xml
     from fat_vendas
     where cnpj = :cnpj and codigo = :cod
     into
         :pessoa_fj, :nome, :codigo , :data, :total, :fechada, :historico, :vendedor,
         :usuario, :num_nf, :num_cupom, :natureza, :tipo_venda, :conveniado,
         :nome_consumidor, :descricao, :observacao, :propriedade, :terceiro,
         :carga, :cartao, :cheque, :desc_acres, :dinheiro, :entrada, :ticket,
         :peso, :volume, :local, :tipo_docto, :forma_pgto, :local_cobranca,
         :base_icm, :icm, :base_icm_subst,
         :valor_icm_subst, :frete, :seguro, :despesas, :ipi, :total_nota,
         :km_atual, :media_km, :endereco_consumidor, :documentos_consumidor,
         :transportadora, :data_caixa, :requisicao, :troco, :cidade_consumidor, :pct_comissao, :nfe_xml;
         
     /* VALOR LIQUIDO */
     vlr_total = :total + :desc_acres ;

     /*propriedades*/
     select pp.nome from glo_propriedades pp
     where pp.cnpj = :cnpj and pp.propriedade = :propriedade and pp.pessoa_fj = :pessoa_fj
     into :nome_propriedade;

     /* VENDEDORRES */
     select nome from fat_vendedor
     where cnpj = :cnpj and codigo = :vendedor
     into :nome_vendedor;
      
     /* nome natureza */
     select nome, perc_icms, mensagem_1, mensagem_2, imp_pedido from est_natureza
     where cnpj = :cnpj and codigo = :natureza
     into :nome_natureza, :perc_icms, :mensagem_nat1,
     :mensagem_nat2, :imp_pedido ;
      
     /* nome terceiro */
     select nome from fat_terceiros
     where cnpj = :cnpj and codigo = :terceiro
     into :nome_terceiro;
     
     /* nome documento */
     select nome from glo_tipos_docto
     where cnpj = :cnpj and sigla = :tipo_docto
     into :nome_documento;
     
     /* nome forma */
     select nome, avista from fin_formas_pagto
     where cnpj = :cnpj and codigo = :forma_pgto
     into :nome_forma, :avista;

     /* plano de contas */
     select nome from ctb_planoconta
     where cnpj = :cnpj and conta = :local_cobranca
     into :nome_local;

     if ((not :conveniado is null ) and ( :conveniado > 0 ))
     then begin
          select nome_razao from glo_pessoas_fj
          where cnpj = :cnpj and codigo = :conveniado
          into :nome_conveniado ;
     end
     else begin
          nome_conveniado = '';
     end
     
     suspend;
END
^

ALTER PROCEDURE CONTA_CTB_CONFIG_REL_CONTAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CONTA INTEGER)
RETURNS (
    NUM INTEGER)
AS
BEGIN
      SELECT COUNT(*)
      FROM CTB_CONFIGURA_RELATORIO_CONTAS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND CONTA = :CONTA
      INTO :NUM ;

      IF ( NUM IS NULL )
      THEN BEGIN
           NUM = 0;
      END

      SUSPEND ;
END
^

ALTER PROCEDURE CONTAGEM_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM EST_CONTAGEM
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            QUANTIDADE
        FROM EST_CONTAGEM_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO
        ORDER BY CNPJ, CODIGO, PRODUTO
        INTO
            :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE CONTAGEM_MENSAL (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    PRODUTO VARCHAR(15))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM EST_CONTAGEM
     WHERE CNPJ = :CNPJ AND DATA >= :INICIAL AND DATA <= :FINAL
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            QUANTIDADE, PRODUTO
        FROM EST_CONTAGEM_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :QUANTIDADE, :PRODUTO
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE CORRIGE_CUSTO_VENDAS
AS
DECLARE VARIABLE CUSTO NUMERIC(18,4);
DECLARE VARIABLE CODIGO VARCHAR(15);
DECLARE VARIABLE CNPJ CHAR(14);
begin
     FOR SELECT PRC_REPOS, CODIGO, CNPJ
     FROM EST_PRODUTOS
     INTO :CUSTO, :CODIGO, :CNPJ
     DO BEGIN
        UPDATE FAT_VENDAS_ITENS
        SET PRC_CUSTO = :CUSTO
        WHERE CNPJ = :CNPJ AND
        PRODUTO = :CODIGO ;
     END
END
^

ALTER PROCEDURE CORRIGE_ENTRADA_ITENS_CFOP
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE CNPJ VARCHAR(14);
begin
     FOR SELECT CNPJ, NDOCTO, PESSOA_FJ, NATUREZA
     FROM EST_ENTRADAS
     INTO :CNPJ, :NDOCTO, :PESSOA_FJ, :CFOP
     DO BEGIN
        UPDATE EST_ENTRADAS_ITENS
        SET CFOP = :CFOP
        WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
        AND CFOP IS NULL ;
     END
END
^

ALTER PROCEDURE CORRIGE_EST_FEC_DIARIO (
    DATA DATE,
    CNPJ VARCHAR(15))
AS
DECLARE VARIABLE CODIGO VARCHAR(15);
DECLARE VARIABLE POSICAO NUMERIC(18,4);
begin
     /*
       CORRIGE A POSICAO DE ESTOQUE COM A POSICAO ESTOQUE DIARIO
     */
     FOR SELECT CODIGO
     FROM EST_PRODUTOS
     WHERE CNPJ = :CNPJ
     INTO :CODIGO
     DO BEGIN
        SELECT POSICAO
        FROM EST_POSICAO_DIARIA
        WHERE CNPJ = :CNPJ AND PRODUTO = :CODIGO AND DATA = :DATA
        INTO :POSICAO ;

        UPDATE EST_PRODUTOS
        SET QTDADE_2 = :POSICAO /*, QTDADE_1 = :POSICAO  */
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     END
END
^

ALTER PROCEDURE CORRIGE_ID_CHEQUE
AS
DECLARE VARIABLE ID INTEGER;
DECLARE VARIABLE CNPJ CHAR(14);
DECLARE VARIABLE BANCO CHAR(3);
DECLARE VARIABLE CONTA VARCHAR(20);
DECLARE VARIABLE CHEQUE CHAR(6);
begin
  ID = 1;

  FOR SELECT CNPJ, BANCO, CONTA, CHEQUE
  FROM FIN_CHEQUES
  INTO :CNPJ, :BANCO, :CONTA, :CHEQUE
  DO BEGIN

     UPDATE FIN_CHEQUES
     SET ID = :ID
     WHERE CNPJ = :CNPJ AND BANCO = :BANCO
     AND CONTA = :CONTA AND CHEQUE = :CHEQUE ;

     ID = :ID + 1;
  END
END
^

ALTER PROCEDURE CORRIGE_SUBGRUPO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    SUBGRUPO INTEGER,
    GRUPO INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
begin
     SELECT CODIGO FROM EST_GRUPOS
     WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
     INTO :CODIGO ;

     IF ( CODIGO IS NULL )
     THEN BEGIN
          INSERT INTO EST_GRUPOS
          ( CNPJ, CODIGO, NOME, BASE, MINIMO, MAXIMO )
          VALUES
          ( :CNPJ, :GRUPO, '<NAO ESPECIFICADO>', 3, 1, 2 );
     END

     SELECT SUBGRUPO FROM EST_SUBGRUPOS
     WHERE CNPJ = :CNPJ AND SUBGRUPO = :SUBGRUPO
     AND GRUPO = :GRUPO
     INTO :CODIGO ;

     IF ( CODIGO IS NULL )
     THEN BEGIN
          INSERT INTO EST_SUBGRUPOS
          ( CNPJ, GRUPO, SUBGRUPO, NOME )
          VALUES
          ( :CNPJ, :GRUPO, :SUBGRUPO, '<NAO ESPECIFICADO>' );
     END

     UPDATE EST_PRODUTOS
     SET GRUPO = :GRUPO, SUBGRUPO = :SUBGRUPO
     WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO ;
END
^

ALTER PROCEDURE CORRIGE_VENDAS_ITENS_PROMOCAO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
DECLARE VARIABLE AUX NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
BEGIN
/* ESTA PROCEDURE CORRIGE OS PRECOS DE VENDA PARA OS DIAS DE PROMOCAO */
/* POIS O PREÇO PROMOCIONAL É APENAS PARA VENDAS A VISTA              */
     AUX = 0;

     FOR SELECT
             PRODUTO, QUANTIDADE
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :QUANTIDADE
     DO BEGIN
        SELECT PRC_VENDA
        FROM EST_PRODUTOS P
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        ORDER BY CNPJ, CODIGO
        INTO :PRC_VENDA  ;

        IF ( PRC_VENDA IS NULL )
        THEN BEGIN
             PRC_VENDA = 0;
        END

        /* ATUALIZANDO OS PRECOS DE VENDA */
        UPDATE FAT_VENDAS_ITENS
        SET FAT_VENDAS_ITENS.PRC_UNITARIO = :PRC_VENDA
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO ;
        
        AUX = AUX + ( :PRC_VENDA * :QUANTIDADE ) ;
     END

     SOMA = AUX ;
END
^

ALTER PROCEDURE COTACAO_DOLAR (
    DATA DATE)
RETURNS (
    VALOR NUMERIC(18,4))
AS
begin
    /* SELECT VALOR
     FROM FIN_COTACOES
     WHERE DATA = :DATA AND SIGLA = 'U$'
     INTO :VALOR ;*/

     suspend;
END
^

ALTER PROCEDURE CRIA_ARQUIVO_EXTERNO_PRODUTOS (
    CNPJ CHAR(14))
AS
DECLARE VARIABLE    CODIGO              VARCHAR(15);
DECLARE VARIABLE    CODIGO_2            VARCHAR(15);
DECLARE VARIABLE    CNPJ_AGRUP          CHAR(14);
DECLARE VARIABLE    COD_AGRUP           CHAR(14);
DECLARE VARIABLE    NOME                VARCHAR(50);
DECLARE VARIABLE    MARCA               INTEGER;
DECLARE VARIABLE    GRUPO               INTEGER;
DECLARE VARIABLE    SUBGRUPO            INTEGER;
DECLARE VARIABLE    REDUCAO             INTEGER;
DECLARE VARIABLE    UNIDADE             CHAR(4);
DECLARE VARIABLE    CTE                 INTEGER;
DECLARE VARIABLE    CTIE                INTEGER;
DECLARE VARIABLE    QTDADE_1            NUMERIC(18,4);
DECLARE VARIABLE    QTDADE_2            NUMERIC(18,4);
DECLARE VARIABLE    LOCALIZACAO_1       VARCHAR(30);
DECLARE VARIABLE    LOCALIZACAO_2       VARCHAR(30);
DECLARE VARIABLE    LOCALIZACAO_3       VARCHAR(30);
DECLARE VARIABLE    NEG_QTDADE_2        CHAR(1);
DECLARE VARIABLE    QTDADE_MIN          INTEGER;
DECLARE VARIABLE    QTDADE_MAX          INTEGER;
DECLARE VARIABLE    COMPLEMENTO_NF      CHAR(1);
DECLARE VARIABLE    DT_ULT_COMPRA       TIMESTAMP;
DECLARE VARIABLE    QT_ULT_COMPRA       INTEGER;
DECLARE VARIABLE    DT_ULT_VENDA        TIMESTAMP;
DECLARE VARIABLE    MARGEM_BRUTA        NUMERIC(18,4);
DECLARE VARIABLE    PRC_REPOS           NUMERIC(18,4);
DECLARE VARIABLE    PRC_CUSTO_ANT       NUMERIC(18,4);
DECLARE VARIABLE    PRC_CUSTO_MED       NUMERIC(18,4);
DECLARE VARIABLE    PRC_VENDA           NUMERIC(18,4);
DECLARE VARIABLE    PRC_VENDA_ANT       NUMERIC(18,4);
DECLARE VARIABLE    PRC_VENDA_MED       NUMERIC(18,4);
DECLARE VARIABLE    ALIQUOTA_ECF        CHAR(5);
DECLARE VARIABLE    ORIGEM              INTEGER;
DECLARE VARIABLE    PESO_LIQ            NUMERIC(18,4);
DECLARE VARIABLE    PERC_FRETE          NUMERIC(18,4);
DECLARE VARIABLE    IPI                 NUMERIC(18,4);
DECLARE VARIABLE    VOLUME              NUMERIC(18,4);
DECLARE VARIABLE    PROD_PESAVEL        CHAR(1);
DECLARE VARIABLE    ETIQUETA_ENT        CHAR(1);
DECLARE VARIABLE    ATIVO               CHAR(1);
DECLARE VARIABLE    ULTIMO_FORNECEDOR   INTEGER;
DECLARE VARIABLE    FORNECEDOR          INTEGER;
DECLARE VARIABLE    SUBUNIDADE          INTEGER;
DECLARE VARIABLE    NOME_MARCA          VARCHAR(50);
DECLARE VARIABLE    PRC_CUSTO_CODIF     VARCHAR(15);
DECLARE VARIABLE    CODIGO_INTERNO      INTEGER;
DECLARE VARIABLE    DT_ULT_ATU_PRECO    TIMESTAMP;
DECLARE VARIABLE    CUSTO_AQUISICAO     NUMERIC(18,4);
DECLARE VARIABLE    VENDE_FRACIONADO    CHAR(1);
DECLARE VARIABLE    QNTDE_EXPOSTA       NUMERIC(18,4);
DECLARE VARIABLE    POSSUI_LOTE         CHAR(1);
DECLARE VARIABLE    QNTDE_MAXIMA_VENDA  NUMERIC(18,4);
DECLARE VARIABLE    PIS                 CHAR(1);
DECLARE VARIABLE    COFINS              CHAR(1);
DECLARE VARIABLE    COM_VENDA_VLR       NUMERIC(18,4);
DECLARE VARIABLE    COM_VENDA_PCT       NUMERIC(18,4);
DECLARE VARIABLE    PARTICIP_LUCRO      NUMERIC(18,4);
DECLARE VARIABLE    NAO_COBR_JUR_ATE    INTEGER;
DECLARE VARIABLE    PREVISAO_ENTREGA    TIMESTAMP;
DECLARE VARIABLE    QNTDE_PEDIDA        NUMERIC(18,4);

begin
     /* APAGA TODOS OS ARQUIVOS DO ARQUIVO EXTERNO*/
     DELETE FROM EXT_EST_PRODUTOS ;

     /* MIGRA OS DADOS PARA A TABELA EXTERNA */
     FOR SELECT
         CODIGO,CODIGO_2,CNPJ_AGRUP,COD_AGRUP,NOME,MARCA,GRUPO,SUBGRUPO,REDUCAO,
         UNIDADE,CTE,CTIE,QTDADE_1,QTDADE_2,LOCALIZACAO_1,LOCALIZACAO_2,LOCALIZACAO_3,
         NEG_QTDADE_2,QTDADE_MIN,QTDADE_MAX,COMPLEMENTO_NF,DT_ULT_COMPRA,QT_ULT_COMPRA,
         DT_ULT_VENDA,MARGEM_BRUTA,PRC_REPOS,PRC_CUSTO_ANT,PRC_CUSTO_MED,PRC_VENDA,
         PRC_VENDA_ANT,PRC_VENDA_MED,ALIQUOTA_ECF,ORIGEM,PESO_LIQ,PERC_FRETE,IPI,
         VOLUME,PROD_PESAVEL,ETIQUETA_ENT,ATIVO,ULTIMO_FORNECEDOR,FORNECEDOR,
         SUBUNIDADE,NOME_MARCA,PRC_CUSTO_CODIF,CODIGO_INTERNO,DT_ULT_ATU_PRECO,
         CUSTO_AQUISICAO,VENDE_FRACIONADO,QNTDE_EXPOSTA,POSSUI_LOTE,QNTDE_MAXIMA_VENDA,
         PIS,COFINS,COM_VENDA_VLR,COM_VENDA_PCT,PARTICIP_LUCRO,NAO_COBR_JUR_ATE,PREVISAO_ENTREGA,
         QNTDE_PEDIDA
     FROM EST_PRODUTOS
     WHERE CNPJ = :CNPJ
     INTO
         :CODIGO,:CODIGO_2,:CNPJ_AGRUP,:COD_AGRUP,:NOME,:MARCA,:GRUPO,:SUBGRUPO,:REDUCAO,
         :UNIDADE,:CTE,:CTIE,:QTDADE_1,:QTDADE_2,:LOCALIZACAO_1,:LOCALIZACAO_2,:LOCALIZACAO_3,
         :NEG_QTDADE_2,:QTDADE_MIN,:QTDADE_MAX,:COMPLEMENTO_NF,:DT_ULT_COMPRA,:QT_ULT_COMPRA,
         :DT_ULT_VENDA,:MARGEM_BRUTA,:PRC_REPOS,:PRC_CUSTO_ANT,:PRC_CUSTO_MED,:PRC_VENDA,
         :PRC_VENDA_ANT,:PRC_VENDA_MED,:ALIQUOTA_ECF,:ORIGEM,:PESO_LIQ,:PERC_FRETE,:IPI,
         :VOLUME,:PROD_PESAVEL,:ETIQUETA_ENT,:ATIVO,:ULTIMO_FORNECEDOR,:FORNECEDOR,
         :SUBUNIDADE,:NOME_MARCA,:PRC_CUSTO_CODIF,:CODIGO_INTERNO,:DT_ULT_ATU_PRECO,
         :CUSTO_AQUISICAO,:VENDE_FRACIONADO,:QNTDE_EXPOSTA,:POSSUI_LOTE,:QNTDE_MAXIMA_VENDA,
         :PIS,:COFINS,:COM_VENDA_VLR,:COM_VENDA_PCT,:PARTICIP_LUCRO,:NAO_COBR_JUR_ATE,:PREVISAO_ENTREGA,
         :QNTDE_PEDIDA
     DO BEGIN
        INSERT INTO EXT_EST_PRODUTOS
        (
         CNPJ, CODIGO,CODIGO_2,CNPJ_AGRUP,COD_AGRUP,NOME,MARCA,GRUPO,SUBGRUPO,REDUCAO,
         UNIDADE,CTE,CTIE,QTDADE_1,QTDADE_2,LOCALIZACAO_1,LOCALIZACAO_2,LOCALIZACAO_3,
         NEG_QTDADE_2,QTDADE_MIN,QTDADE_MAX,COMPLEMENTO_NF,DT_ULT_COMPRA,QT_ULT_COMPRA,
         DT_ULT_VENDA,MARGEM_BRUTA,PRC_REPOS,PRC_CUSTO_ANT,PRC_CUSTO_MED,PRC_VENDA,
         PRC_VENDA_ANT,PRC_VENDA_MED,ALIQUOTA_ECF,ORIGEM,PESO_LIQ,PERC_FRETE,IPI,
         VOLUME,PROD_PESAVEL,ETIQUETA_ENT,ATIVO,ULTIMO_FORNECEDOR,FORNECEDOR,
         SUBUNIDADE,NOME_MARCA,PRC_CUSTO_CODIF,CODIGO_INTERNO,DT_ULT_ATU_PRECO,
         CUSTO_AQUISICAO,VENDE_FRACIONADO,QNTDE_EXPOSTA,POSSUI_LOTE,QNTDE_MAXIMA_VENDA,
         PIS,COFINS,COM_VENDA_VLR,COM_VENDA_PCT,PARTICIP_LUCRO,NAO_COBR_JUR_ATE,PREVISAO_ENTREGA,
         QNTDE_PEDIDA
        )
        VALUES
        (
         :CNPJ, :CODIGO,:CODIGO_2,:CNPJ_AGRUP,:COD_AGRUP,:NOME,:MARCA,:GRUPO,:SUBGRUPO,:REDUCAO,
         :UNIDADE,:CTE,:CTIE,:QTDADE_1,:QTDADE_2,:LOCALIZACAO_1,:LOCALIZACAO_2,:LOCALIZACAO_3,
         :NEG_QTDADE_2,:QTDADE_MIN,:QTDADE_MAX,:COMPLEMENTO_NF,:DT_ULT_COMPRA,:QT_ULT_COMPRA,
         :DT_ULT_VENDA,:MARGEM_BRUTA,:PRC_REPOS,:PRC_CUSTO_ANT,:PRC_CUSTO_MED,:PRC_VENDA,
         :PRC_VENDA_ANT,:PRC_VENDA_MED,:ALIQUOTA_ECF,:ORIGEM,:PESO_LIQ,:PERC_FRETE,:IPI,
         :VOLUME,:PROD_PESAVEL,:ETIQUETA_ENT,:ATIVO,:ULTIMO_FORNECEDOR,:FORNECEDOR,
         :SUBUNIDADE,:NOME_MARCA,:PRC_CUSTO_CODIF,:CODIGO_INTERNO,:DT_ULT_ATU_PRECO,
         :CUSTO_AQUISICAO,:VENDE_FRACIONADO,:QNTDE_EXPOSTA,:POSSUI_LOTE,:QNTDE_MAXIMA_VENDA,
         :PIS,:COFINS,:COM_VENDA_VLR,:COM_VENDA_PCT,:PARTICIP_LUCRO,:NAO_COBR_JUR_ATE,:PREVISAO_ENTREGA,
         :QNTDE_PEDIDA
        );
     END
END
^

ALTER PROCEDURE CRIA_CODIGO_INTERNO
AS
declare variable COD INTEGER;
declare variable CNPJ CHAR(14);
declare variable CODIGO VARCHAR(15);
BEGIN
     SELECT MAX(CODIGO_INTERNO)
     FROM EST_PRODUTOS
     INTO :COD ;
     
     if (COD IS NULL)
     then
         COD = 1;
         
     FOR SELECT CNPJ, CODIGO
     FROM EST_PRODUTOS
     WHERE CODIGO_INTERNO IS NULL
     INTO :CNPJ, :CODIGO
     DO BEGIN
        UPDATE EST_PRODUTOS
        SET CODIGO_INTERNO = :COD
        WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ ;
        
        COD = COD + 1;
     END
     
     
     SUSPEND;
END
^

ALTER PROCEDURE CRIA_CTB_FLUXO_CAIXA (
    CNPJ CHAR(14),
    DATA TIMESTAMP,
    SALDO_INICIAL NUMERIC(18,4),
    VENDAS_VISTA NUMERIC(18,4),
    RECEBER NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    CHQ_PRAZO NUMERIC(18,4),
    PAGAR NUMERIC(18,4),
    SALDO NUMERIC(18,4))
AS
BEGIN
  IF ( EXISTS
      (
        SELECT CNPJ FROM CTB_FLUXO_CAIXA
        WHERE (CNPJ = :CNPJ) AND  (DATA = :DATA)
      )
     )
  THEN BEGIN
       UPDATE CTB_FLUXO_CAIXA
       SET SALDO_INICIAL = :SALDO_INICIAL,
        VENDAS_VISTA = :VENDAS_VISTA,
        RECEBER = :RECEBER,
        CARTAO = :CARTAO,
        CHQ_PRAZO = :CHQ_PRAZO,
        PAGAR = :PAGAR,
        SALDO = :SALDO
       WHERE (CNPJ = :CNPJ) AND (DATA = :DATA);
  END
  ELSE BEGIN
       INSERT INTO CTB_FLUXO_CAIXA (
        CNPJ,
        DATA,
        SALDO_INICIAL,
        VENDAS_VISTA,
        RECEBER,
        CARTAO,
        CHQ_PRAZO,
        PAGAR,
        SALDO)
       VALUES (
        :CNPJ,
        :DATA,
        :SALDO_INICIAL,
        :VENDAS_VISTA,
        :RECEBER,
        :CARTAO,
        :CHQ_PRAZO,
        :PAGAR,
        :SALDO);
  END
END
^

ALTER PROCEDURE CRIA_LOG_TRANSACOES (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DOCUMENTO VARCHAR(20),
    ORIGEM CHAR(6),
    USUARIO INTEGER,
    DATA TIMESTAMP,
    HORA TIME,
    COMPUTADOR VARCHAR(50))
AS
BEGIN
  select codigo from gerar_codigo ('LOG',1) into :codigo;
  insert into sis_log_transacoes (
    cnpj,
    codigo,
    documento,
    origem,
    usuario,
    data,
    hora,
    computador)
  values (
    :cnpj,
    :codigo,
    :documento,
    :origem,
    :usuario,
    :data,
    :hora,
    :computador);
END
^

ALTER PROCEDURE CRIA_RECIBO (
    CNPJ CHAR(14),
    FAVORECIDO VARCHAR(50),
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    DT_LANCTO DATE,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    CPF_CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    PLANILHA INTEGER,
    INTEGRAL CHAR(1))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN

     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('RECIBOS',1)
     INTO :CODIGO;

     INSERT INTO
     FIN_RECIBOS
     (
       CNPJ ,
       CODIGO ,
       FAVORECIDO ,
       DT_VENCTO ,
       DOCTO ,
       DT_LANCTO ,
       VALOR ,
       HISTORICO ,
       IMPRESSO ,
       CPF_CNPJ ,
       PESSOA_FJ,
       PLANILHA,
       INTEGRAL
     )
     VALUES
     (
       :CNPJ ,
       :CODIGO ,
       :FAVORECIDO ,
       :DT_VENCTO ,
       :DOCTO ,
       :DT_LANCTO ,
       :VALOR ,
       :HISTORICO ,
       :IMPRESSO ,
       :CPF_CNPJ ,
       :PESSOA_FJ,
       :PLANILHA,
       :INTEGRAL
     );
     
  SUSPEND;
END
^

ALTER PROCEDURE CRIA_RECIBO_PAGAS (
    CNPJ CHAR(14),
    DT_VENCTO DATE,
    DOCTO VARCHAR(20),
    DT_LANCTO DATE,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN

     /* CODIGO DA RECIBO */
     SELECT CODIGO FROM GERAR_CODIGO ('RECIBOS_PAGAS',1)
     INTO :CODIGO;

     INSERT INTO
     FIN_RECIBOS_PAGAS
     (
       CNPJ ,
       CODIGO ,
       DT_VENCTO ,
       DOCTO ,
       DT_LANCTO ,
       VALOR ,
       HISTORICO ,
       IMPRESSO ,
       PESSOA_FJ
     )
     VALUES
     (
       :CNPJ ,
       :CODIGO ,
       :DT_VENCTO ,
       :DOCTO ,
       :DT_LANCTO ,
       :VALOR ,
       :HISTORICO ,
       :IMPRESSO ,
       :PESSOA_FJ
     );

  SUSPEND;
END
^

ALTER PROCEDURE CRIA_SIS_MENU (
    CNPJ CHAR(14),
    CATEGORIA VARCHAR(50),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    COMPUTADOR VARCHAR(50))
AS
DECLARE VARIABLE NUM INTEGER;
BEGIN
     SELECT COUNT(*) FROM SIS_MENU
     WHERE CNPJ = :CNPJ AND
           CATEGORIA = :CATEGORIA AND
           CODIGO = :CODIGO
     INTO :NUM ;

     IF (( NUM IS NULL ) OR ( NUM = 0 ))
     THEN BEGIN
          INSERT INTO SIS_MENU (
          CNPJ,
          CATEGORIA,
          NOME,
          CODIGO,
          COMPUTADOR)
          VALUES (
         :CNPJ,
         :CATEGORIA,
         :NOME,
         :CODIGO,
         :COMPUTADOR);
     END
END
^

ALTER PROCEDURE CRIA_SIS_MENU_ITEM (
    CNPJ CHAR(14),
    CATEGORIA VARCHAR(50),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    COMPUTADOR VARCHAR(50),
    CAPTION VARCHAR(50))
AS
DECLARE VARIABLE NUM INTEGER;
BEGIN
     SELECT COUNT(*) FROM SIS_MENU_ITEM
     WHERE CNPJ = :CNPJ AND
           CATEGORIA = :CATEGORIA AND
           CODIGO = :CODIGO AND
           NOME = :NOME
     INTO :NUM ;

     IF (( NUM IS NULL ) OR ( NUM = 0 ))
     THEN BEGIN
          INSERT INTO SIS_MENU_ITEM (
          CNPJ,
          CATEGORIA,
          NOME,
          CODIGO,
          COMPUTADOR,
          CAPTION,
          VISIVEL)
          VALUES (
         :CNPJ,
         :CATEGORIA,
         :NOME,
         :CODIGO,
         :COMPUTADOR,
         :CAPTION,
         'S');
     END
END
^

ALTER PROCEDURE CTB_PLANOCONTA_I (
    CNPJ CHAR(14),
    CONTA INTEGER,
    CODIGO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    NOME VARCHAR(50))
AS
BEGIN
  INSERT INTO CTB_PLANOCONTA (
    CNPJ,
    CONTA,
    CODIGO,
    CONTAPAI,
    NOME
  )
  VALUES (
    :CNPJ,
    :CONTA,
    :CODIGO,
    :CONTAPAI,
    :NOME
  );
END
^

ALTER PROCEDURE CX_MOVTOS_LANCA_CONTAB_GERAL (
    CNPJ CHAR(14),
    PLANILHA INTEGER,
    DATA DATE,
    CONTA INTEGER)
AS
DECLARE VARIABLE CONTRA_PARTIDA INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TIPO CHAR(1);
BEGIN
      /* LANCA A CONTABILIDADE DOS MOVIMENTOS AVULSOS */
      FOR SELECT
             DOCUMENTO, HISTORICO, VALOR,
             TIPO, CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA
      INTO
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :CONTRA_PARTIDA
      DO BEGIN
          IF (( TIPO = 'C' ) and ( CONTRA_PARTIDA > 0 ))
          THEN BEGIN
               /* LANCA OS MOVIMENTOS CONTABEIS */
               EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
               (
               :CNPJ, :DATA, 'C', :DOCUMENTO,
               :HISTORICO,
               :VALOR, :CONTRA_PARTIDA, 'CX', :PLANILHA,
               0, '', 'A', '', 0
               );

               /* LANCA OS MOVIMENTOS CONTABEIS */
               EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
               (
               :CNPJ, :DATA, 'D', :DOCUMENTO,
               :HISTORICO,
               :VALOR, :CONTA, 'CX', :PLANILHA,
               0, '', 'A', '', 0
               );
           END
           ELSE BEGIN
               IF ( CONTRA_PARTIDA > 0 )
               THEN BEGIN
                    /* LANCA OS MOVIMENTOS CONTABEIS */
                    EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                    (
                    :CNPJ, :DATA, 'D', :DOCUMENTO,
                    :HISTORICO,
                    :VALOR, :CONTRA_PARTIDA, 'CX', :PLANILHA,
                    0, '', 'A', '', 0
                    );

                    /* LANCA OS MOVIMENTOS CONTABEIS */
                    EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                    (
                    :CNPJ, :DATA, 'C', :DOCUMENTO,
                    :HISTORICO,
                    :VALOR, :CONTA, 'CX', :PLANILHA,
                    0, '', 'A', '', 0
                    );
               END
           END
      END
END
^

ALTER PROCEDURE DADOS_VENDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    TIPO_VENDA CHAR(3),
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     SELECT VENDEDOR, NUM_NF, NUM_CUPOM, TIPO_VENDA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :COD
     INTO
         :VENDEDOR, :NUM_NF, :NUM_CUPOM, :TIPO_VENDA ;

     /* VENDEDORRES */
     SELECT NOME FROM FAT_VENDEDOR
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
     INTO :NOME_VENDEDOR ;

     SUSPEND;
END
^

ALTER PROCEDURE DATA_HORA (
    TP VARCHAR(1))
RETURNS (
    DATA TIMESTAMP)
AS
begin
  /* Procedure Text */
  if (TP = 'D') then
     DATA = cast('TODAY' as date);
  if (TP = 'T') then
     DATA = 'NOW';
  SUSPEND;
END
^

ALTER PROCEDURE DATA_SERVIDOR
RETURNS (
    DATA TIMESTAMP)
AS
BEGIN
  select current_timestamp from RDB$DATABASE
  INTO :DATA ;

  SUSPEND;
END
^

ALTER PROCEDURE DESCARREGAR_FATURA (
    CNPJ CHAR(14),
    CARGA INTEGER,
    FATURA INTEGER,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
     /* ATUALIZA A VENDA */
     UPDATE FAT_VENDAS
     SET CARGA = NULL
     WHERE CNPJ = :CNPJ AND CODIGO = :FATURA ;
     
     /* ATUALIZA A CARGA */
     UPDATE CRG_CARGAS
     SET VOLUME =
     VOLUME - :VOLUME,
     PESO = PESO - :PESO
     WHERE CNPJ = :CNPJ AND CODIGO = :CARGA ;
     
     SUSPEND;
END
^

ALTER PROCEDURE DESCONCILIA_BANCO (
    CODIGO INTEGER)
AS
begin
     Update CTB_MOVIMENTO_CONTABIL
     SET DATA_CONCILIACAO = NULL
     WHERE CODIGO = :CODIGO ;
  suspend;
END
^

ALTER PROCEDURE DESVINCULA_RECEBER_FATURA (
    CNPJ CHAR(14),
    RECEBER INTEGER,
    ANO INTEGER)
AS
begin
     UPDATE FIN_BAIXAS_RECEBER
     SET FATURA = NULL
     WHERE CNPJ = :CNPJ AND CODIGO_CR = :RECEBER AND
     ANO_CR = :ANO;
END
^

ALTER PROCEDURE DEVOLVE_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO VARCHAR(6);
DECLARE VARIABLE ORDEM INTEGER;
DECLARE VARIABLE SERIE VARCHAR(3);
BEGIN
     /* VERIFICA O FATURAMENTO */
     execute procedure verifica_faturamento ( :cnpj, :codigo );

     delete from fin_cheques  where cnpj = :cnpj and venda = :codigo ;
     delete from fin_movimento_cartao where cnpj = :cnpj and venda = :codigo ;

     /* verifica a natureza de operação */
     select natureza, data, orcamento, serie from fat_vendas
     where cnpj = :cnpj and codigo = :codigo
     order by cnpj, codigo
     into :natureza, :data, :ordem, :serie ;

     if ( serie is null ) then
       serie = 'N1' ;

     if (serie = 'SRV') then
     begin
          update ofc_ordem_servico
          set ofc_ordem_servico.enviada_caixa ='N',
          ofc_ordem_servico.fechado = 'N',
          ofc_ordem_servico.nf = 0
          where cnpj = :cnpj and codigo = :ordem;
     end

     /* enviada para o caixa */
     update fat_vendas
     set enviada_cx = 'N', fechada = 'N', carga = 0
     where cnpj = :cnpj and codigo = :codigo ;
     suspend;
END
^

ALTER PROCEDURE DEVOLVE_FIN_CHEQUE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    BANCO CHAR(3),
    CHEQUE VARCHAR(6),
    DATA_DEVOLUCAO DATE,
    MOTIVO_DEVOLUCAO INTEGER)
AS
DECLARE VARIABLE CONTAATUAL INTEGER;
DECLARE VARIABLE CONTADEV INTEGER;
DECLARE VARIABLE OLD_ESTADO CHAR(2);
DECLARE VARIABLE VALOR NUMERIC(9,2);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE NDEV INTEGER;
DECLARE VARIABLE NDOC VARCHAR(20);
begin
     ndoc = 'CHQ-DEV ' || cast(:data_devolucao as Varchar(10));
     /* PLANILHA */
     select CODIGO from GERAR_CODIGO ('PLANILHA',1)
     into :PLANILHA;

     /* seleciona a conta atual do cheque e dados do cheque */
     select c.conta_conc, c.valor, coalesce(c.vezes_devolucao,0), c.tipo
     from fin_cheques c
     where c.cnpj = :cnpj and c.conta = :conta and c.banco = :banco and c.cheque = :cheque
     into :contaatual, :valor, :ndev, :old_estado;
  
     /*caso o estado do cheque tenha mudado o incremento de devolução é feito no before
     update caso contrario é feito por aqui manualmente*/
     if (:old_estado = 'DE') then
      ndev = :ndev + 1;
  
     if (contaatual > 0) then
     begin
       /* debita na conta escolhida pelo usuario(conta banco) */
       execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:CNPJ, :data_devolucao, 'D',
       :ndoc, :ndoc, :valor, :contaatual, 'CHQ', :PLANILHA,
       0, '', 'A', '', 0);
     end

     update fin_cheques c set c.data_devolucao = :data_devolucao, c.motivo_devolucao = :motivo_devolucao,
     c.tipo = 'DE', c.vezes_devolucao = :ndev, c.conciliado = 'N'
     where CNPJ = :CNPJ and CONTA = :CONTA and BANCO = :BANCO and CHEQUE = :CHEQUE;
END
^

ALTER PROCEDURE DEVOLVE_GARANTIA_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE TIPO VARCHAR(1);
BEGIN
     /* ATUALIZA O ESTOQUE */
     FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE,
     TIPO
     FROM FAT_GARANTIAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :TIPO
     DO BEGIN

        IF ( :QNTDEUNIDADE IS NULL )
        THEN BEGIN
             QNTDEUNIDADE = (:QUANTIDADE );
        END
        ELSE BEGIN
             QNTDEUNIDADE = (:QUANTIDADE * :QNTDEUNIDADE);
        END

        IF ( :TIPO = 'S' )
        THEN BEGIN
             /* ESTOQUE FISICO */
             UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 + (:QUANTIDADE )
             WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
        END
        ELSE BEGIN
             /* ESTOQUE FISICO */
             UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 - (:QUANTIDADE )
             WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
        END
     END

     /* ENVIADA PARA O CAIXA */
     UPDATE FAT_GARANTIAS
     SET ENVIADA_CX = 'N'
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE DEVOLVE_TROCA_BALCAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE TIPO VARCHAR(1);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO VARCHAR(6);
BEGIN
     /* ENVIADA PARA O CAIXA*/
     UPDATE FAT_TROCAS
     SET ENVIADA_CX = 'N'
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO;
END
^

ALTER PROCEDURE DIA_PREF_FATURAMENTO (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    DIA_PREF_FAT INTEGER)
AS
BEGIN
     SELECT DIA_PREF_FAT
     FROM GLO_CLIENTES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ =:PESSOA_FJ
     INTO :DIA_PREF_FAT ;
     
     SUSPEND;
END
^

ALTER PROCEDURE DIGITOS (
    NDOCTO VARCHAR(20))
RETURNS (
    INTEIRO INTEGER)
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE I INTEGER;
DECLARE VARIABLE AUX CHAR(1);
DECLARE VARIABLE AUX2 VARCHAR(20);
begin
     I = 1;

     AUX2 = '' ;

     LEN = 0;
     WHILE ( I <= 20 ) DO
     BEGIN
          SELECT RESULT FROM SP_SUBSTRING(:NDOCTO, :I, 1)
          INTO :AUX ;

          IF (( AUX = '0' ) OR ( AUX = '1' ) OR ( AUX = '2' ) OR
          ( AUX = '3' ) OR ( AUX = '4' ) OR ( AUX = '5' ) OR
          ( AUX = '6' ) OR ( AUX = '7' ) OR ( AUX = '8' ) OR
          ( AUX = '9' ) OR ( AUX = 'A' ) OR ( AUX = 'B' ) OR ( AUX = 'C' )
          OR ( AUX = 'D' ) OR ( AUX = 'E' ) OR ( AUX = 'F' ) OR ( AUX = 'G' )
          OR ( AUX = 'H' ) OR ( AUX = 'I' ) OR ( AUX = 'J' ) OR ( AUX = 'K' )
          OR ( AUX = 'L' ) OR ( AUX = 'M' ) OR ( AUX = 'N' ) OR ( AUX = 'O' )
          OR ( AUX = 'P') OR ( AUX = 'Q' ) OR ( AUX = 'R' ) OR ( AUX = 'S' )
          OR ( AUX = 'T' ) OR ( AUX = 'U' ) OR ( AUX = 'V' ) OR ( AUX = 'X' )
          OR ( AUX = 'Y' ) OR ( AUX = 'W' ) OR ( AUX = 'Z' ) OR ( AUX = ' ' )
          OR ( AUX = '-' ) OR ( AUX = '/' ) OR ( AUX = '\' ) OR ( AUX = '.' )
          OR ( AUX = ',' ) OR ( AUX = ':' ) OR ( AUX = ';')
          OR ( AUX = '(' ) OR ( AUX = ')' ))
          THEN BEGIN
               LEN = LEN + 1 ;
          END

          I = I + 1;
     END

     I = 1;

     /* ESTA PROCEDURE RETORNA SOMENTE OS NUMEROS DE UMA STRING. */
     WHILE ( I <= LEN ) DO
     BEGIN
          SELECT RESULT FROM SP_SUBSTRING(:NDOCTO, :I, 1)
          INTO :AUX ;

          IF (( AUX = '0' ) OR ( AUX = '1' ) OR ( AUX = '2' ) OR
          ( AUX = '3' ) OR ( AUX = '4' ) OR ( AUX = '5' ) OR
          ( AUX = '6' ) OR ( AUX = '7' ) OR ( AUX = '8' ) OR
          ( AUX = '9' ))
          THEN BEGIN
              AUX2 = AUX2 || AUX ;
          END

          I = I + 1;
     END

     IF ( AUX2 = '' )
     THEN
        AUX2 = '0';

     INTEIRO = CAST(AUX2 AS INTEGER);

     suspend;
END
^

ALTER PROCEDURE EMITIR_FATURAS (
    CNPJ CHAR(14),
    DATA DATE,
    TOLERANCIA INTEGER,
    TIPO_CLIENTE CHAR(1))
AS
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE TOLERANCIA_FATURAMENTO INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE VENCIMENTO DATE;
DECLARE VARIABLE DATAVND DATE;
DECLARE VARIABLE VALOR_LIQUID NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE DOCTO VARCHAR(15);
Begin
     /* ANDA NOS CLIENTES PARA FATURAR UM A UM */
     FOR SELECT PESSOA_FJ, TOLERANCIA_FATURAMENTO
     FROM GLO_CLIENTES 
     WHERE CNPJ = :CNPJ
     AND PERIODO_FATURAMENTO = :TIPO_CLIENTE
     INTO :PESSOA_FJ, :TOLERANCIA_FATURAMENTO
     DO BEGIN

        TOTAL = 0;

        SELECT SUM(TOTAL + DESC_ACRES)
        FROM FAT_VENDAS
        WHERE FECHADA = 'S'
        AND DATA_CAIXA <= :DATA
        AND CNPJ = :CNPJ
        AND PESSOA_FJ = :PESSOA_FJ
        AND CANCELADA <> 'S'
        AND DUPLICATA = 0
        AND TIPO_VENDA = 'FFT'
        INTO :SOMA ;

        IF ( SOMA IS NULL )
        THEN BEGIN
             SOMA = 0;
        END

        TOTAL = TOTAL + SOMA ;
        
        /* SOMA O VALOR DA NOTAS A RECEBER */
        SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
        FROM FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ
        AND PESSOA_FJ = :PESSOA_FJ
        AND DT_EMISSAO <= :DATA
        AND FATURA IS NULL
        INTO :SOMA ;
        
        IF ( SOMA IS NULL )
        THEN BEGIN
             SOMA = 0;
        END

        TOTAL = TOTAL + SOMA ;

        IF (TOTAL > 0)
        THEN BEGIN
             IF (TOLERANCIA_FATURAMENTO > 0)
             THEN BEGIN
                  /* TOLERANCIA DIFERENCIADA POR CLIENTE */
                  
                  /* SERA PRECISO UMA FUNCAO PARA ADICIONAR DIAS PARA QUE AQUI FIQUE CORRETO */
                  VENCIMENTO = DATA + TOLERANCIA_FATURAMENTO;
             END
             ELSE BEGIN
                  /* SERA PRECISO UMA FUNCAO PARA ADICIONAR DIAS PARA QUE AQUI FIQUE CORRETO */

                  /* TOLERANCIA GERAL DO SISTEMA */
                  VENCIMENTO = DATA + TOLERANCIA;
             END
        
             /* FATURA */
             FATURA = GEN_ID(FIN_FATURA_GE, 1);

             /* CRIA A FATURA */
             INSERT INTO FIN_FATURAS
             (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO, BAIXADA, TIPO, ENVIADA, ORIGEM )
             VALUES
             (:CNPJ, :FATURA, :PESSOA_FJ, :DATA, :TOTAL, 0, 0, :VENCIMENTO, '', 'N', 'PROTOCOLO', 'N', 'AUT' );
     
             /* CONTAS A RECEBER */
             UPDATE FIN_CONTAS_RECEBER SET FATURA = :FATURA
             WHERE CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND DT_EMISSAO <= :DATA
             AND FATURA IS NULL ;

             /* GERA AS CONTAS QUE ESTAO EM FFT NAS VENDAS */
             FOR SELECT CODIGO, DATA_CAIXA, (TOTAL + DESC_ACRES)
             FROM FAT_VENDAS
             WHERE FECHADA = 'S'
             AND CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND CANCELADA <> 'S'
             AND DUPLICATA = 0
             AND TIPO_VENDA = 'FFT'
             AND DATA_CAIXA <= :DATA
             INTO :VENDA, :DATAVND, :VALOR_LIQUID DO
             BEGIN
                  /* GERA O CODIGO E O ANO DO RECEBER */
                  CODREC = GEN_ID(FIN_RECEBER_COD_GE, 1);

                  ANO = EXTRACT (YEAR FROM DATA) ;
                     
                  DOCTO = 'VND ' || CAST(:VENDA AS VARCHAR(15)) ;
           
                  /* CRIANDO O CONTAS A RECEBER */
                  INSERT INTO FIN_CONTAS_RECEBER
                  (CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, BOLETO, ORIGEM, SELECIONADO, NUMBOLETO, NUMDUPLICATA, FATURA, CODIGO_VN, ANO_VN )
                  VALUES
                  (:CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATAVND, :DATA, :DOCTO, '01/01', '',
                  :VALOR_LIQUID, 'N', 'VND', 'N', 0, :FATURA, :FATURA, :VENDA, :ANO ) ;
             END

             UPDATE  FAT_VENDAS SET DUPLICATA = :FATURA
             WHERE FECHADA = 'S'
             AND DATA_CAIXA <= :DATA
             AND CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND CANCELADA <> 'S'
             AND DUPLICATA = 0
             AND TIPO_VENDA = 'FFT' ;

       END /* FINAL DO TOTAL > 0 */
     END

     suspend;
END
^

ALTER PROCEDURE EMITIR_FATURAS_CLIENTE (
    CNPJ CHAR(14),
    DATA DATE,
    TOLERANCIA INTEGER,
    CLIENTE INTEGER)
RETURNS (
    FATURA INTEGER)
AS
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE TOLERANCIA_FATURAMENTO INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE VENCIMENTO DATE;
DECLARE VARIABLE DATAVND DATE;
DECLARE VARIABLE VALOR_LIQUID NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE DOCTO VARCHAR(15);
Begin
     /* ANDA NOS CLIENTES PARA FATURAR UM A UM */
     FOR SELECT PESSOA_FJ, TOLERANCIA_FATURAMENTO
     FROM GLO_CLIENTES 
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     INTO :PESSOA_FJ, :TOLERANCIA_FATURAMENTO
     DO BEGIN

        TOTAL = 0;

        SELECT SUM(TOTAL + DESC_ACRES)
        FROM FAT_VENDAS
        WHERE FECHADA = 'S'
        AND DATA_CAIXA <= :DATA
        AND CNPJ = :CNPJ
        AND PESSOA_FJ = :PESSOA_FJ
        AND CANCELADA <> 'S'
        AND DUPLICATA = 0
        AND TIPO_VENDA = 'FFT'
        INTO :SOMA ;

        IF ( SOMA IS NULL )
        THEN BEGIN
             SOMA = 0;
        END

        TOTAL = TOTAL + SOMA ;
        
        /* SOMA O VALOR DA NOTAS A RECEBER */
        SELECT SUM( VALOR - VLR_PARCIAL + JUROS_REC - DESCONTOS )
        FROM FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ
        AND PESSOA_FJ = :PESSOA_FJ AND DT_EMISSAO <= :DATA AND FATURA IS NULL
        INTO :SOMA ;
        
        IF ( SOMA IS NULL )
        THEN BEGIN
             SOMA = 0;
        END

        TOTAL = TOTAL + SOMA ;

        IF (TOTAL > 0)
        THEN BEGIN
             IF ( TOLERANCIA_FATURAMENTO > 0 )
             THEN BEGIN
                  /* TOLERANCIA DIFERENCIADA POR CLIENTE */
                  
                  /* SERA PRECISO UMA FUNCAO PARA ADICIONAR DIAS PARA QUE AQUI FIQUE CORRETO */
                  VENCIMENTO = DATA + TOLERANCIA_FATURAMENTO;
             END
             ELSE BEGIN
                  /* SERA PRECISO UMA FUNCAO PARA ADICIONAR DIAS PARA QUE AQUI FIQUE CORRETO */

                  /* TOLERANCIA GERAL DO SISTEMA */
                  VENCIMENTO = DATA + TOLERANCIA;
             END
        
             /* FATURA */
             FATURA = GEN_ID(FIN_FATURA_GE, 1);

             /* CRIA A FATURA */
             INSERT INTO FIN_FATURAS
             (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO, BAIXADA, TIPO, ENVIADA, ORIGEM )
             VALUES
             (:CNPJ, :FATURA, :PESSOA_FJ, :DATA, :TOTAL, 0, 0, :VENCIMENTO, '', 'N', 'PROTOCOLO', 'N', 'AUT' );
     
             /* CONTAS A RECEBER */
             UPDATE FIN_CONTAS_RECEBER SET FATURA = :FATURA
             WHERE CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND DT_EMISSAO <= :DATA
             AND FATURA IS NULL ;

             /* GERA AS CONTAS QUE ESTAO EM FFT NAS VENDAS */
             FOR SELECT CODIGO, DATA_CAIXA, (TOTAL + DESC_ACRES)
             FROM FAT_VENDAS
             WHERE FECHADA = 'S'
             AND CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND CANCELADA <> 'S'
             AND DUPLICATA = 0
             AND TIPO_VENDA = 'FFT'
             AND DATA_CAIXA <= :DATA
             INTO :VENDA, :DATAVND, :VALOR_LIQUID DO
             BEGIN
                  /* GERA O CODIGO E O ANO DO RECEBER */
                  CODREC = GEN_ID(FIN_RECEBER_COD_GE, 1);

                  ANO = EXTRACT (YEAR FROM DATA) ;
                     
                  DOCTO = 'VND ' || CAST(:VENDA AS VARCHAR(15)) ;
           
                  /* CRIANDO O CONTAS A RECEBER */
                  INSERT INTO FIN_CONTAS_RECEBER
                  (CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO, DOCTO, PARCELA, HISTORICO,
                  VALOR, BOLETO, ORIGEM, SELECIONADO, NUMBOLETO, NUMDUPLICATA, FATURA, CODIGO_VN, ANO_VN )
                  VALUES
                  (:CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATAVND, :DATA, :DOCTO, '01/01', '',
                  :VALOR_LIQUID, 'N', 'VND', 'N', 0, :FATURA, :FATURA, :VENDA, :ANO ) ;
             END

             UPDATE  FAT_VENDAS SET DUPLICATA = :FATURA
             WHERE FECHADA = 'S'
             AND DATA_CAIXA <= :DATA
             AND CNPJ = :CNPJ
             AND PESSOA_FJ = :PESSOA_FJ
             AND CANCELADA <> 'S'
             AND DUPLICATA = 0
             AND TIPO_VENDA = 'FFT' ;

       END /* FINAL DO TOTAL > 0 */
     END

     suspend;
END
^

ALTER PROCEDURE ENCERRA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
AS
DECLARE VARIABLE VENCTO DATE;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE BANCO VARCHAR(3);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
BEGIN
     /* TROCA */
     SELECT PESSOA_FJ, DATA, OBSERVACAO, LOCAL_COBRANCA
     FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PESSOA_FJ, :DATA, :HISTORICO, :LOCAL ;
     
     /* PARCELAS DO CONTAS A RECEBER */
/*     FOR SELECT VENCTO, PARCELA, VALOR
     FROM FAT_GARANTIAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :VENCTO, PARCELA, VALOR
     DO BEGIN
        /* GERA O CODIGO E O ANO DO RECEBER */
       /* SELECT CODIGO, ANO
        FROM GERAR_CODIGO_RECEBER(1)
        INTO :CODREC, :ANO;

        IF (:LOCAL > 0)
        THEN BEGIN
             /* SELECIONA O BANCO DO LOCAL */
       /*      SELECT BANCO FROM CTB_PLANOCONTA
             WHERE CONTA = :LOCAL
             INTO :BANCO ;
             
             /* NUMERO DE BOLETO */
       /*      SELECT NUMERO FROM ATUALIZA_BOLETO(:BANCO)
             INTO :NUMBOLETO ;
        
             /* CONTAS A RECEBER */
       /*      INSERT INTO FIN_CONTAS_RECEBER
             (
             CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
             DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
             JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_TRC, AVISO,
             DT_AVISO, SELECIONADO, FATURA, NUMBOLETO
             )
             VALUES
             (
             :CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
             :DATA, 'VND ' || CAST(:CODIGO AS VARCHAR(15)),
             :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'S', 'VND', :CODIGO, NULL,
             NULL, 'N', NULL, :NUMBOLETO
             );
             
             /* ATUALIZANDO O ARQUIVO */
         /*    UPDATE FAT_TROCAS_PARCELAMENTO
             SET BOLETO = :NUMBOLETO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND VENCTO = :VENCTO ;*/
             
/*        END
        ELSE BEGIN
             /* CONTAS A RECEBER */
/*             INSERT INTO FIN_CONTAS_RECEBER
             (
             CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
             DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
             JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, AVISO,
             DT_AVISO, SELECIONADO, FATURA
             )
             VALUES
             (
             :CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
             :DATA, 'VND ' || CAST(:CODIGO AS VARCHAR(20)),
             :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'N', 'VND', :CODIGO, NULL,
             NULL, 'N', NULL
             );*/
/*        END
     END
     
     /* ENCERRA A TROCA */
     UPDATE FAT_GARANTIAS
     SET FECHADO = 'S', DATA_CAIXA = :DATA_CAIXA, USUARIO = :USUARIO,
     CONTA_CAIXA = :CONTA, TURNO = :TURNO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE ENCERRA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
AS
DECLARE VARIABLE VENCTO DATE;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE BANCO VARCHAR(3);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
BEGIN
     /* TROCA */
     SELECT PESSOA_FJ, DATA, OBSERVACAO, LOCAL_COBRANCA
     FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PESSOA_FJ, :DATA, :HISTORICO, :LOCAL ;
     
     /* PARCELAS DO CONTAS A RECEBER */
     FOR SELECT VENCTO, PARCELA, VALOR
     FROM FAT_TROCAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :VENCTO, PARCELA, VALOR
     DO BEGIN
        /* GERA O CODIGO E O ANO DO RECEBER */
        SELECT CODIGO, ANO
        FROM GERAR_CODIGO_RECEBER(1)
        INTO :CODREC, :ANO;

        IF (:LOCAL > 0)
        THEN BEGIN
             /* SELECIONA O BANCO DO LOCAL */
             SELECT BANCO FROM CTB_PLANOCONTA
             WHERE CONTA = :LOCAL
             INTO :BANCO ;
             
             /* NUMERO DE BOLETO */
             SELECT NUMERO FROM ATUALIZA_BOLETO(:BANCO)
             INTO :NUMBOLETO ;
        
             /* CONTAS A RECEBER */
             INSERT INTO FIN_CONTAS_RECEBER
             (
             CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
             DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
             JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_TRC, AVISO,
             DT_AVISO, SELECIONADO, FATURA, NUMBOLETO
             )
             VALUES
             (
             :CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
             :DATA, 'TRC ' || CAST(:CODIGO AS VARCHAR(15)),
             :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'S', 'TRC', :CODIGO, NULL,
             NULL, 'N', NULL, :NUMBOLETO
             );
             
             /* ATUALIZANDO O ARQUIVO */
             UPDATE FAT_TROCAS_PARCELAMENTO
             SET BOLETO = :NUMBOLETO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND VENCTO = :VENCTO ;
             
        END
        ELSE BEGIN
             /* CONTAS A RECEBER */
             INSERT INTO FIN_CONTAS_RECEBER
             (
             CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
             DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
             JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_TRC, AVISO,
             DT_AVISO, SELECIONADO, FATURA
             )
             VALUES
             (
             :CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
             :DATA, 'TRC ' || CAST(:CODIGO AS VARCHAR(20)),
             :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'N', 'TRC', :CODIGO, NULL,
             NULL, 'N', NULL
             );
        END
     END
     
     /* ENCERRA A TROCA */
     UPDATE FAT_TROCAS
     SET FECHADO = 'S', DATA_CAIXA = :DATA_CAIXA, USUARIO = :USUARIO,
     CONTA_CAIXA = :CONTA, TURNO = :TURNO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE ENCERRA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    VALE_TROCO CHAR(1))
AS
DECLARE VARIABLE VENCTO DATE;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE TIPO_DOCTO VARCHAR(3);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE KM_ATUAL NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE CCT_ID INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE ES CHAR(1);
declare variable TIPO_EMPRESA VARCHAR(30);
begin
  /*Validacao implementada para solucionar de imediato a questao do beef beef (PDV)*/
  select e.TIPO_EMPRESA from sis_empresas e
  where e.cnpj = :cnpj
  into :TIPO_EMPRESA;

  /*pegando dados da venda*/
  select vd.pessoa_fj, vd.data, vd.historico, vd.local_cobranca,  vd.km_atual, vd.tipo_docto, vd.natureza, nat.es, VD.centro_custo
  from fat_vendas vd
  inner join est_natureza nat on (nat.codigo = vd.natureza and vd.cnpj = nat.cnpj)
  where vd.cnpj = :cnpj and vd.codigo = :codigo
  into :pessoa_fj, :data, :historico, :local, :km_atual,:tipo_docto, :natureza, :es, :cct_id;

  /*codigo adicionado apenas para 'disparar o triguer' before update e garantir que o item tenha seu
  lucro defini e permitir o calculo correto das comissões, contador-arquivo é um campo sem utilidade*/
  update fat_vendas_itens vdi set vdi.contador_arquivo = 1 where vdi.cnpj = :cnpj and vdi.codigo = :codigo;

  /*gerando comissoes para vendas a vista*/
  select count(*) from fat_vendas_parcelamento pc
  where pc.cnpj = :cnpj and pc.codigo = :codigo
  into :existe;

  if ((coalesce(:existe,0) = 0) and (:tipo_empresa <> 'SuperMercado')) then
    execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,null,null,:data_caixa);



    /* parcelas do faturamento, caso o cfop não esteja marcado pra nao gerar financeiro nem mesmo o parcelmento
   é gerado, a validação é realizada na aplicação*/
  for select vencto, parcela, valor  from fat_vendas_parcelamento
      where cnpj = :cnpj and codigo = :codigo
      into :vencto, :parcela, :valor
  do
  begin
    if (:es = 'S') then
      execute procedure pcd_fat_gera_receber(:cnpj,:codigo,:pessoa_fj,:valor,:vencto,:data,:data_caixa,:local,:historico,:tipo_docto,:parcela);
    else if (:es = 'E') then
      execute procedure pcd_fat_gera_pagar(:cnpj,:codigo,:pessoa_fj,:valor,:vencto,:data,:data_caixa,:historico,:parcela,:cct_id);
  end

  /*enviada para o caixa*/
  update fat_vendas  vd set vd.fechada = 'S', vd.enviada_cx = 'S', data_caixa = :data_caixa, usuario = :usuario,
  conta_caixa = :conta, turno = :turno, vale_troco = :vale_troco
  where cnpj = :cnpj and codigo = :codigo ;

  suspend;
END
^

ALTER PROCEDURE ENTRADAS_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT SUM(ENTRADA), NDOCTO, PESSOA_FJ, NOME
     FROM EST_ENTRADAS
     WHERE CNPJ = :CNPJ AND DATA_REF = :DATA
     AND ENTRADA > 0
     GROUP BY NDOCTO, PESSOA_FJ, NOME
     ORDER BY NDOCTO, PESSOA_FJ, NOME
     INTO :VALOR, :DOCUMENTO, :PESSOA_FJ, :NOME
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE ENTRADAS_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE PESSOA_FJ INTEGER;
BEGIN
     FOR SELECT NDOCTO, PESSOA_FJ
     FROM EST_ENTRADAS
     WHERE CNPJ = :CNPJ AND DATA_REF = :DATA
     INTO :NDOCTO, :PESSOA_FJ
     DO BEGIN
        FOR SELECT
            SUM(QUANTIDADE)
        FROM EST_ENTRADAS_ITENS
        WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO
        AND PESSOA_FJ = :PESSOA_FJ AND
        PRODUTO = :PRODUTO
        INTO  :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE ENTRADAS_MENSAIS (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    PRODUTO VARCHAR(14))
AS
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE PESSOA_FJ INTEGER;
BEGIN
     FOR SELECT NDOCTO, PESSOA_FJ
     FROM EST_ENTRADAS
     WHERE CNPJ = :CNPJ AND DATA_REF >= :INICIAL AND DATA_REF <= :FINAL
     PLAN SORT ((EST_ENTRADAS INDEX (EST_ENTRADAS_DIARIA)))
     ORDER BY NDOCTO, DATA_REF
     INTO :NDOCTO, :PESSOA_FJ
     DO BEGIN
        FOR SELECT QUANTIDADE, PRODUTO
        FROM EST_ENTRADAS_ITENS
        WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO
        AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, NDOCTO, PESSOA_FJ
        INTO  :QUANTIDADE, :PRODUTO
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE ENTRADAS_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DATA_REF TIMESTAMP,
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT ENTRADA, NDOCTO, PESSOA_FJ, NOME,
     HISTORICO, DATA_REF, CENTRO_CUSTO
     FROM EST_ENTRADAS
     WHERE ( CNPJ = :CNPJ ) AND ( DATA_REF >= :INI AND DATA_REF <= :FIM )
     AND ( ENTRADA > 0 )
     INTO :VALOR, :DOCUMENTO, :PESSOA_FJ, :NOME,
     :HISTORICO, :DATA_REF, :CENTRO_CUSTO
     DO BEGIN
        NOME_CENTRO = NULL ;

        SELECT NOME FROM FIN_CENTRO_CUSTO
        WHERE CNPJ = :CNPJ AND CODIGO = :CENTRO_CUSTO
        INTO :NOME_CENTRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE ENVIA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDADE_2 NUMERIC(18,4);
DECLARE VARIABLE QDE_PROD_LOTE NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE NEG_QTDE2 CHAR(1);
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO VARCHAR(6);
DECLARE VARIABLE COMPROMETIDO NUMERIC(18,4);
DECLARE VARIABLE LOTE INTEGER;
BEGIN
     prod = '';

     /* pega a 'NATUREZA DE OPERAÇÃO' da venda */
     select natureza, data, vendedor, local from fat_vendas
     where codigo = :codigo and cnpj = :cnpj
     into :natureza, :data, :vendedor, :local;

     /* verifica se a natureza de operação 'MOVIMENTA ESTOQUE' e se é de 'ENTRADA/SAIDA' */
     select mov_estoque, es from est_natureza
     where cnpj = :cnpj and codigo = :natureza
     into :mov_estoque, :es;
     mov_estoque = :mov_estoque;
     
     /* se a natureza de operação for 'MOVIMENTO DE ESTOQUE' e for movimento de 'SAIDA' */
     if ((mov_estoque = 'S') and ( es = 'S')) then
     begin
           /* LAÇO NOS ITENS DA VENDA - procurando se contem estoque do produto */
           for select produto, quantidade, unidade, coalesce(subunidade,1), coalesce(grade,''), coalesce(numero,''), coalesce(codigo_lote,0)
           from fat_vendas_itens
           where cnpj = :cnpj and codigo = :codigo
           into :produto, :quantidade, :unidade, :qntdeunidade, :grade, :numero, :lote
           do begin

                 /*====[ PROCESSO NORMAL DE VERIFICAÇÃO DE QTDE DE ESTOQUE DISPONIVEL ]======================*/
                 /*pegando qtde do produto ainda temos no estoque*/
                 select coalesce(qtdade_2,0), coalesce(neg_qtdade_2,0)  from est_produtos
                 where cnpj = :cnpj and codigo = :produto
                 into :qtdade_2, neg_qtde2;

                 /*============ [pegando todos os comprometidos ]==========================================*/
                 comprometido  = 0;
                 select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0))
                 from fat_vendas vd
                 inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
                 inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
                 where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :produto and
                 coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S'
                 into :comprometido;

                 /*====[ VERIFICA SE A GRADE ESCOLHIDA CONTEM ESTOQUE DISPONIVEL ]===========================*/
                 /* Caso o produto conter estoque em grade atualizar o valor de quantidade do produto */
                 if (grade<>'' and numero<>'') then
                 begin
                       SELECT coalesce(estoque,0)
                       FROM EST_PRODUTOS_GRADES_NUMEROS
                       WHERE CNPJ = :cnpj AND PRODUTO = :produto AND GRADE = :grade AND NUMERO = :numero
                       into :qtdade_2;
          
                       /*pegando todos os comprometidos da grade */
                       comprometido  = 0;
                       select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0))
                       from FAT_VENDAS vd
                       inner join FAT_VENDAS_ITENS vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
                       inner join EST_PRODUTOS_GRADES_NUMEROS pgn on (pgn.produto = vdi.produto and pgn.grade = vdi.grade and pgn.numero = vdi.numero)
                       inner join EST_NATUREZA nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
                       where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :produto and
                       coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S'
                       into :comprometido;
                 end

                 /*====[ VERIFICA SE O PRODUTO ESCOLHIDO CONTEM ESTOQUE DISPONIVEL NO LOTE ]=================*/
                 /* Caso o produto possuir lote */
                 if( lote > 0 )then
                 begin
                       /* =================[ quantidade do lote ]=============================================*/
                       select coalesce(lote.estoque,0) from EST_LOTE_PRODUTO lote where lote.codigo = :lote
                       into :qtdade_2;
          
                       /* =============[ soma qtde do produto, fora o lote comprado ]=========================*/
                       select SUM(coalesce(lote.estoque,0)) from EST_LOTE_PRODUTO lote
                       where lote.produto = :PRODUTO and lote.codigo<> :lote
                       into :qde_prod_lote;
          
                       /* ===========[ pegando todos os comprometidos do produto independente do lote ]=========*/
                       comprometido  = 0;
                       select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0))
                       from FAT_VENDAS vd
                       inner join FAT_VENDAS_ITENS vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
                       inner join EST_LOTE_PRODUTO lote on (lote.produto = vdi.produto)
                       inner join EST_NATUREZA nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
                       where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :produto and
                       coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S'
                       into :comprometido;

                       /* ===========[ esse calculo resultara a qtde comprometida do lote ]======================*/
                       comprometido = :comprometido - :qde_prod_lote;
                       if  (:comprometido < 0) then
                          comprometido = 0;
                 end

                 qtdade_2 = :qtdade_2 - coalesce(:comprometido,0);
                 select * from round2(:qtdade_2) into :qtdade_2;

                 if ((:qtdade_2 < :quantidade * :qntdeunidade) and (neg_qtde2 = 'N')) then
                   prod = :produto;
           end    /* LAÇO NOS ITENS DA VENDA  */
     end          /* FIM IF (mov_estoque = 'S' and  es = 'S') */


     /* ==================================================================================================
        ENVIAR PARA O CAIXA
        prod = ''   será enviado p/ o cx, pq 'CONTéM PRODUTO EM ESTOQUE' ou 'ACEITA ESTOQUE NEGATIVO'
        ================================================================================================== */
     if (:prod ='') then
     begin
         /* =====[ Atualiza ultimo vendedor ]================ */
         update glo_clientes
         set ult_vendedor = :vendedor
         where cnpj = :cnpj and pessoa_fj = :pessoa_fj ;

         /* =====[ enviada para o caixa ]==================== */
         update fat_vendas
         set enviada_cx = 'S'
         where cnpj = :cnpj and codigo = :codigo ;
     end

     suspend;
END
^

ALTER PROCEDURE ENVIA_CAIXA_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDADE_2 NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE NEG_QTDE2 CHAR(1);
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
BEGIN
     PROD = '';

     /* ATUALIZA O ESTOQUE */
     FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE, PRODUTOFIS
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :PRODUTOFIS
     DO BEGIN
        /* isso já esta sendo feito no triguer de fat_vendas
        ESTOQUE FISICO
        UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 - (:QUANTIDADE * :QNTDEUNIDADE),
        DT_ULT_VENDA = :DATA
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;*/
     END

     IF (:PROD ='')
     THEN BEGIN
          UPDATE GLO_CLIENTES
          SET ULT_VENDEDOR = :VENDEDOR
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ ;

          /* ENVIADA PARA O CAIXA */
          UPDATE FAT_VENDAS
          SET ENVIADA_CX = 'S'
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE ENVIA_GARANTIA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDADE_2 NUMERIC(18,4);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE NEG_QTDE2 CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE TIPO CHAR(1);
BEGIN
     PROD = '';

     /* SOMENTE QUANDO MOVIMENTA ESTOQUE */
     FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE, TIPO
     FROM FAT_GARANTIAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :TIPO
     DO BEGIN

        SELECT QTDADE_2, NEG_QTDADE_2  FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO :QTDADE_2, NEG_QTDE2 ;

        IF ( :QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        /* SOMENTE PARA SAIDAS */
        IF ((:QTDADE_2 < :QUANTIDADE * :QNTDEUNIDADE) AND (NEG_QTDE2 = 'N') AND (TIPO = 'S'))
        THEN BEGIN
             PROD = :PRODUTO ;
        END
     END

     IF (:PROD = '')
     THEN BEGIN
          /* ATUALIZA O ESTOQUE */
          FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE, TIPO
          FROM FAT_GARANTIAS_ITENS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
          INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :TIPO
          DO BEGIN
             IF (TIPO = 'E')
             THEN  BEGIN
                   /* ESTOQUE FISICO */
                   UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 + (:QUANTIDADE * :QNTDEUNIDADE),
                   DT_ULT_VENDA = :DATA
                   WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
             END
             ELSE BEGIN
                   /* ESTOQUE FISICO */
                   UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 - (:QUANTIDADE * :QNTDEUNIDADE),
                   DT_ULT_VENDA = :DATA
                   WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
             END
          END
     END

     IF (:PROD ='')
     THEN BEGIN
          /* ENVIADA PARA O CAIXA */
          UPDATE FAT_GARANTIAS
          SET ENVIADA_CX = 'S'
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE ENVIA_TROCA_CAIXA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDADE_2 NUMERIC(18,4);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE NEG_QTDE2 CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE TIPO CHAR(1);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO VARCHAR(6);
BEGIN
     PROD = '';

     IF (:PROD = '')
     THEN BEGIN
          /* ENVIADA PARA O CAIXA */
          UPDATE FAT_TROCAS
          SET ENVIADA_CX = 'S'
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE EST_GRUPOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    BASE SMALLINT,
    MINIMO SMALLINT,
    MAXIMO SMALLINT)
AS
BEGIN
  INSERT INTO EST_GRUPOS (
    CNPJ,
    CODIGO,
    NOME,
    BASE,
    MINIMO,
    MAXIMO)
  VALUES (
    :CNPJ,
    :CODIGO,
    :NOME,
    :BASE,
    :MINIMO,
    :MAXIMO);
END
^

ALTER PROCEDURE EST_PROD_MAX_MIN (
    CNPJ VARCHAR(14),
    ESTOQUE VARCHAR(3))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50))
AS
BEGIN 
      IF ( ESTOQUE = 'MIN' )
      THEN BEGIN
           FOR SELECT
           CODIGO, CODIGO_2, CNPJ_AGRUP, COD_AGRUP, COALESCE(NOME,''), MARCA, GRUPO, SUBGRUPO,
           REDUCAO, UNIDADE, CTE, CTIE, QTDADE_1, QTDADE_2, LOCALIZACAO_1, LOCALIZACAO_2,
           LOCALIZACAO_3, NEG_QTDADE_2 , COMPLEMENTO_NF,
           DT_ULT_COMPRA, QT_ULT_COMPRA, DT_ULT_VENDA, MARGEM_BRUTA, PRC_REPOS,
           PRC_CUSTO_ANT, PRC_CUSTO_MED, PRC_VENDA, PRC_VENDA_ANT, PRC_VENDA_MED,
           ALIQUOTA_ECF, ORIGEM, PESO_LIQ, PERC_FRETE, IPI, VOLUME, PROD_PESAVEL,
           ETIQUETA_ENT, ATIVO, ULTIMO_FORNECEDOR, FORNECEDOR, SUBUNIDADE,
           qtdade_min, qtdade_max
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ and QTDADE_2 < QTDADE_MIN
           INTO
           :CODIGO, :CODIGO_2, :CNPJ_AGRUP, :COD_AGRUP, :NOME, :MARCA, :GRUPO, :SUBGRUPO,
           :REDUCAO, :UNIDADE, :CTE, :CTIE, :QTDADE_1, :QTDADE_2, :LOCALIZACAO_1, :LOCALIZACAO_2,
           :LOCALIZACAO_3, :NEG_QTDADE_2 ,:COMPLEMENTO_NF,
           :DT_ULT_COMPRA, :QT_ULT_COMPRA, :DT_ULT_VENDA, :MARGEM_BRUTA, :PRC_REPOS,
           :PRC_CUSTO_ANT, :PRC_CUSTO_MED, :PRC_VENDA, :PRC_VENDA_ANT, :PRC_VENDA_MED,
           :ALIQUOTA_ECF, :ORIGEM, :PESO_LIQ, :PERC_FRETE, :IPI, :VOLUME, :PROD_PESAVEL,
           :ETIQUETA_ENT, :ATIVO, :ULTIMO_FORNECEDOR, :FORNECEDOR, :SUBUNIDADE, :QTDADE_MIN, :QTDADE_MAX
           DO BEGIN
              SELECT NOME FROM EST_MARCAS
              WHERE CNPJ = :CNPJ AND CODIGO = :MARCA
              INTO :NOME_MARCA ;

              SELECT NOME FROM EST_SUBGRUPOS
              WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
              INTO :NOME_SUBGRUPO ;

              SELECT NOME  FROM EST_GRUPOS GR
              WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
              INTO :NOME_GRUPO;

              SUSPEND ;
           END
     END
     ELSE BEGIN
           FOR SELECT
           CODIGO, CODIGO_2, CNPJ_AGRUP, COD_AGRUP, NOME, MARCA, GRUPO, SUBGRUPO,
           REDUCAO, UNIDADE, CTE, CTIE, QTDADE_1, QTDADE_2, LOCALIZACAO_1, LOCALIZACAO_2,
           LOCALIZACAO_3, NEG_QTDADE_2 ,  COMPLEMENTO_NF,
           DT_ULT_COMPRA, QT_ULT_COMPRA, DT_ULT_VENDA, MARGEM_BRUTA, PRC_REPOS,
           PRC_CUSTO_ANT, PRC_CUSTO_MED, PRC_VENDA, PRC_VENDA_ANT, PRC_VENDA_MED,
           ALIQUOTA_ECF, ORIGEM, PESO_LIQ, PERC_FRETE, IPI, VOLUME, PROD_PESAVEL,
           ETIQUETA_ENT, ATIVO, ULTIMO_FORNECEDOR, FORNECEDOR, SUBUNIDADE,
           qtdade_min, qtdade_max
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND QTDADE_2 > QTDADE_MAX
           INTO
           :CODIGO, :CODIGO_2, :CNPJ_AGRUP, :COD_AGRUP, :NOME, :MARCA, :GRUPO, :SUBGRUPO,
           :REDUCAO, :UNIDADE, :CTE, :CTIE, :QTDADE_1, :QTDADE_2, :LOCALIZACAO_1, :LOCALIZACAO_2,
           :LOCALIZACAO_3, :NEG_QTDADE_2 ,:COMPLEMENTO_NF,
           :DT_ULT_COMPRA, :QT_ULT_COMPRA, :DT_ULT_VENDA, :MARGEM_BRUTA, :PRC_REPOS,
           :PRC_CUSTO_ANT, :PRC_CUSTO_MED, :PRC_VENDA, :PRC_VENDA_ANT, :PRC_VENDA_MED,
           :ALIQUOTA_ECF, :ORIGEM, :PESO_LIQ, :PERC_FRETE, :IPI, :VOLUME, :PROD_PESAVEL,
           :ETIQUETA_ENT, :ATIVO, :ULTIMO_FORNECEDOR, :FORNECEDOR, :SUBUNIDADE,
           :QTDADE_MIN, :QTDADE_MAX
           DO BEGIN
              SELECT NOME FROM EST_MARCAS
              WHERE CNPJ = :CNPJ AND CODIGO = :MARCA
              INTO :NOME_MARCA ;

              SELECT NOME FROM EST_SUBGRUPOS
              WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
              INTO :NOME_SUBGRUPO;

              SELECT NOME  FROM EST_GRUPOS GR
              WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
              INTO :NOME_GRUPO;


              SUSPEND ;
           END
     END
END
^

ALTER PROCEDURE EST_PRODUTOS_APLICACOES_I (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    APLICACAO VARCHAR(50),
    LOCAL VARCHAR(50))
AS
declare variable CODIGO_APLICACAO INTEGER;
BEGIN
  /*  */
  SELECT CODIGO FROM EST_APLICACOES
  WHERE CNPJ = :CNPJ AND
        NOME = :APLICACAO
  INTO :CODIGO_APLICACAO;
  /*  */
  if (:CODIGO_APLICACAO IS NULL) then
     BEGIN
       /*  */
       CODIGO_APLICACAO = GEN_ID(EST_APLICACOES_GE, 1);
       /*  */
       INSERT INTO EST_APLICACOES VALUES (:CNPJ, :CODIGO_APLICACAO, :APLICACAO);
     END
  /*  */
  INSERT INTO EST_PRODUTOS_APLICACOES (
    CNPJ,
    PRODUTO,
    APLICACAO,
    LOCAL)
  VALUES (
    :CNPJ,
    :PRODUTO,
    :CODIGO_APLICACAO,
    :LOCAL);
END
^

ALTER PROCEDURE EST_SUBGRUPOS_I (
    CNPJ CHAR(14),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME VARCHAR(50),
    DESCONTO_MAX NUMERIC(18,4),
    DIGITA_PRC CHAR(1))
AS
BEGIN
  INSERT INTO EST_SUBGRUPOS (
    CNPJ,
    GRUPO,
    SUBGRUPO,
    NOME,
    DESCONTO_MAX,
    DIGITA_PRC)
  VALUES (
    :CNPJ,
    :GRUPO,
    :SUBGRUPO,
    :NOME,
    :DESCONTO_MAX,
    :DIGITA_PRC);
END
^

ALTER PROCEDURE EST_UNIDADES_I (
    CNPJ CHAR(14),
    SIGLA CHAR(4),
    NOME VARCHAR(50),
    UNIDADES INTEGER)
AS
BEGIN
  INSERT INTO EST_UNIDADES (
    CNPJ,
    SIGLA,
    NOME,
    UNIDADES)
  VALUES (
    :CNPJ,
    :SIGLA,
    :NOME,
    :UNIDADES);
END
^

ALTER PROCEDURE ESTORNA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
AS
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TAXA NUMERIC(18,4);
DECLARE VARIABLE CONTA_CONCILIADO INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
BEGIN

     select coalesce(valor,0), coalesce(taxa,0), mvt.planilha from fin_movimento_cartao mvt
     where cnpj = :cnpj and mvt.codigo = :codigo
     into :valor, :taxa, :planilha;

     if (:taxa > 0) then
       valor = (:valor - ((:valor * :taxa)/100.00));

     documento = 'CARTAO :'||:codigo;
     select ctb.conta from ctb_movimento_contabil ctb
     where ctb.cnpj = :cnpj and ctb.planilha = :planilha
     into :conta_conciliado;


     codigo_cont = gen_id(mov_contabil_ge, 1);

     insert into ctb_movimento_contabil
     (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, data_conciliacao )
     values
     (:cnpj, :codigo_cont, cast('today' as date), 'D', :documento, ('-->EST. CONCILIAÇÃO CRT: '||cast('today' as date)), :valor, :conta_conciliado, 'CRT', :planilha, 'A', 'CRT', cast('today' as date) );


     update fin_movimento_cartao mvt set conciliado = 'N', data_conciliacao = null, processado = 'N'
     where cnpj = :cnpj and mvt.codigo = :codigo;

     suspend;
END
^

ALTER PROCEDURE ESTORNA_PAGAR_INTEGRAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DT_ULT_DATA DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_PG NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
Begin
     /* CONTAS A RECEBER */
     select
          codigo_PG, ano_PG,  dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          boleto, origem, codigo_vn, R.ano_ent, aviso, dt_aviso, planilha,
          valor, r.vlr_parcial, r.juros_pag,  juros,
          COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE, centro_custo
     from fin_baixas_pagar r
     where cnpj = :cnpj and codigo = :codbx and r.pessoa_fj = :pessoa_fj
     into
          :codigo, :ano,  :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :boleto, :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :planilha,
          :valor,:vlr_parcial, :juros_PG, :juros,
          :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE, :centro_custo;

     /*selecionando a maior data de baixa, exceto a da propria baixa passada, para podermos
     atualizar novamente em fin-contas-receber e termos condicoes de calcular os juros novamente
     a partir da ultima data de movimento da conta*/
     select max(dt_baixa) from fin_baixas_pagar
     where codigo <> :codbx and codigo_pg = :codigo and pessoa_fj = :pessoa_fj and juros <> 0
     into :dt_ult_data;                           /*quando juros esta preenchido com um valor é sinal de q foi feita uma baixa em o valor da conta foi baixado
                                                    e não houve somente baixa de juros, assim podemos tomar esta data como dt-ult-baixa
                                                   */


     delete from fin_baixas_pagar r where cnpj = :cnpj and r.codigo = :codbx ;

    /*se ele entrou neste bloco onde se faz nescessário inserir em contas_receber porque
    a conta ja nao esta mais la, e porque foi baixado varias contas agrupadas parcialmente.
    E no caso esta conta foi baixada integralmente*/
    INSERT INTO fin_contas_pagar
    ( cnpj, codigo, ano, pessoa_fj, dt_emissao,
    dt_vencto, dt_lancto, docto, parcela, historico,
    valor, vlr_parcial, juros_pag, boleto, origem, codigo_vn, ano_ent, aviso,
    dt_aviso, dt_ultima_baixa,
    cod_indexador, idx_database, idx_cotacao, idx_qtde,CENTRO_CUSTO
    )
    VALUES
    (:cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
    :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
    :valor,:vlr_parcial, :juros_pg, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
    :dt_aviso, :dt_ult_data,
    :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde, :centro_custo
    );

  suspend;
END
^

ALTER PROCEDURE ESTORNA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DT_ULT_DATA DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE VLR_ANTERADO CHAR(1);
DECLARE VARIABLE VLR_BAIXA NUMERIC(18,4);
Begin
     /* contas a receber */
     select
          r.codigo_pg, r.ano_pg, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros, descontos,
          boleto, origem, codigo_vn, r.ano_ent, aviso,
          dt_aviso, planilha
     from fin_baixas_pagar r
     where cnpj = :cnpj and codigo = :codbx and r.pessoa_fj = :pessoa_fj
     into
          :codigo, :ano,  :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros, :descontos,
          :boleto, :origem, :codigo_vn, :ano_vn,
          :aviso, :dt_aviso, :planilha;

    /* atualizar novamente em fin-contas-receber e termos condicoes de calcular os juros novamente
     a partir da ultima data de movimento da conta*/
     select max(dt_baixa) from fin_baixas_pagar bx
     where codigo <> :codbx and bx.codigo_pg = :codigo and pessoa_fj = :pessoa_fj
     into :dt_ult_data;
          
     /*teoricamente todas vezes vai entrar aqui */
     if (exists(select codigo from fin_contas_pagar where cnpj = :cnpj and codigo = :codigo and ano = :ano and pessoa_fj = :pessoa_fj)) then
     begin
          /*Verificando se foi uma BAIXA PARCIAL DOS JUROS conforme o pedido da economica(Rose)*/
          select bx.VLR_ORIG_ALT, bx.valor,  bx.vlr_baixa from fin_baixas_pagar bx
          where codigo = :codbx and bx.codigo_pg = :codigo and pessoa_fj = :pessoa_fj
          into :vlr_anterado, :valor, :vlr_baixa;

          /*Bloco utilizado para estornar movimentos onde o valor da baixa foi inferior
          ao valor de juros na ocasião*/
          if (:vlr_anterado = 'S') then
          begin
            select max(dt_baixa) from fin_baixas_pagar
            where codigo <> :codbx and codigo_pg = :codigo and pessoa_fj = :pessoa_fj
            into :dt_ult_data;

            /* extorna o valor parcial */
            update fin_contas_pagar pg set juros_pag = juros_pag - :vlr_baixa,
            descontos = descontos - :descontos,
            dt_ultima_baixa = :dt_ult_data,
            valor = :valor
            where codigo = :codigo and ano = :ano and pessoa_fj = :pessoa_fj;
          end
          else
          begin
            /*Acontecerá casos em que o valor parcial será inferior ao valor de juros
            ocasionando um estorno errado. e: o sujeiro baixa 120 de juros e 30 da conta_
            if (:VLR_PARCIAL > :juros) then
             VLR_PARCIAL = :VLR_PARCIAL - :JUROS;   */

            /*se data da ultima baixa estiver nula é sinal
            que não há mais nenhum resquicio de  de baixas parciais portanto o valor parcial da conta
            tem de ser 0, afinal não se baixou absolutamente nada dela*/
           if (:dt_ult_data is null) then
           begin
              /* extorna o valor parcial */
              update fin_contas_pagar r
              set vlr_parcial = 0,
              juros_pag = juros_pag - :juros ,
              dt_ultima_baixa = :dt_ult_data
              where codigo = :codigo and ano = :ano and pessoa_fj = :pessoa_fj ;
           end
           else
           begin
             /* extorna o valor parcial */
              update fin_contas_pagar r
              set vlr_parcial = :vlr_parcial, /*este é o valor parcial da conta por ocasião da baixa a ser estornada*/
              juros_pag = juros_pag - :juros ,
              dt_ultima_baixa = :dt_ult_data
              where codigo = :codigo and ano = :ano and pessoa_fj = :pessoa_fj ;
           end
          end
     end

     suspend;
END
^

ALTER PROCEDURE ESTORNA_RECEBER (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CODIGO_CR INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE MAXCODIGO INTEGER;
begin
  for select bx.codigo, bx.pessoa_fj, bx.codigo_cr from fin_baixas_receber bx
      where bx.cnpj = :cnpj and bx.planilha = :planilha
      order by bx.codigo desc
      into :codigo, :pessoa_fj, :codigo_cr
  do
  begin
     /*verifanco se existe algum movimento que obrigatoriamente deverá ser estornado primeiro*/
     select max(bx.codigo) from FIN_BAIXAS_RECEBER bx where bx.codigo_cr = :codigo_cr and bx.pessoa_fj = :pessoa_fj
     into :maxcodigo;

     /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
     if(coalesce(:maxcodigo,0) > :codigo) then
       exception exp_estorna_baixa;

     /*verificando se este é um movimento de baixa parcial ou integral*/
     select count(*) from  fin_contas_receber rec
     where rec.cnpj = :cnpj and rec.pessoa_fj = :pessoa_fj and rec.codigo = :codigo_cr
     into :existe;

     if (:existe > 0) then
       execute procedure estorna_receber_parcial(:cnpj,:codigo,:pessoa_fj);
     else
       execute procedure estorna_receber_integral(:cnpj,:codigo,:pessoa_fj);

     /*deletando a baixa de contas*/
     delete from fin_baixas_receber bx2 where bx2.cnpj = :cnpj and bx2.codigo = :codigo ;
     /*deletando a baixa de contas*/
  end

  /*excluindo os movimentos de cheques*/
  delete from fin_cheques ch where ch.cnpj = :cnpj and ch.planilha = :planilha;

  /*excluindo os movimentos de cartão*/
  delete from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.planilha = :planilha;

  /*excluindo os movimentos bancários*/
  delete from ctb_movimento_contabil ctb where ctb.cnpj = :cnpj and ctb.planilha = :planilha;

  /*excluindo os recibos*/
  delete from fin_recibos rb where rb.cnpj = :cnpj and rb.planilha = :planilha;
  suspend;
END
^

ALTER PROCEDURE ESTORNA_RECEBER_INTEGRAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DT_ULT_DATA DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE  DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /* CONTAS A RECEBER */
     select
          codigo_cr, ano_cr,  dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          boleto, origem, codigo_vn, ano_vn, aviso, dt_aviso, planilha,
          valor, r.vlr_parcial, juros_rec, local_cobranca, juros, r.codigo_trc,
          COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     from fin_baixas_receber r
     where cnpj = :cnpj and codigo = :codbx and r.pessoa_fj = :pessoa_fj
     into
          :codigo, :ano,  :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :boleto, :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :planilha,
          :valor,:vlr_parcial, :juros_rec, :local_cobranca, :juros, :codigo_trc,
          :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE;

     /*selecionando a maior data de baixa, exceto a da propria baixa passada, para podermos
     atualizar novamente em fin-contas-receber e termos condicoes de calcular os juros novamente
     a partir da ultima data de movimento da conta*/
     select max(dt_baixa) from fin_baixas_receber
     where codigo <> :codbx and codigo_cr = :codigo and pessoa_fj = :pessoa_fj and juros <> 0
     into :dt_ult_data;                           /*quando juros esta preenchido com um valor é sinal de q foi feita uma baixa em o valor da conta foi baixado
                                                    e não houve somente baixa de juros, assim podemos tomar esta data como dt-ult-baixa
                                                   */


    /*se ele entrou neste bloco onde se faz nescessário inserir em contas_receber porque
    a conta ja nao esta mais la, e porque foi baixado varias contas agrupadas parcialmente.
    E no caso esta conta foi baixada integralmente*/
    INSERT INTO FIN_CONTAS_RECEBER
    ( cnpj, codigo, ano, pessoa_fj, dt_emissao,
    dt_vencto, dt_lancto, docto, parcela, historico,
    valor, vlr_parcial, juros_rec, boleto, origem, codigo_vn, ano_vn, aviso,
    dt_aviso, local_cobranca,data_ult_baixa, codigo_trc,
    cod_indexador, idx_database, idx_cotacao, idx_qtde
    )
    VALUES
    (:cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
    :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
    :valor,:vlr_parcial,:juros_rec, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
    :dt_aviso, :local_cobranca,:dt_ult_data, :codigo_trc,
    :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
    );

  suspend;
END
^

ALTER PROCEDURE ESTORNA_RECEBER_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DT_ULT_DATA DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE VLR_ANTERADO CHAR(1);
DECLARE VARIABLE VLR_BAIXA NUMERIC(18,4);
Begin
     /* contas a receber */
     select
          codigo_cr, ano_cr, dt_emissao,
          dt_vencto, dt_lancto, docto, parcela, historico,
          valor, vlr_parcial, juros, descontos,
          boleto, origem, codigo_vn, ano_vn, aviso,
          dt_aviso, planilha, local_cobranca
     from fin_baixas_receber r
     where cnpj = :cnpj and codigo = :codbx and r.pessoa_fj = :pessoa_fj
     into
          :codigo, :ano,  :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :vlr_parcial, :juros, :descontos,
          :boleto, :origem, :codigo_vn, :ano_vn,
          :aviso, :dt_aviso, :planilha, :local_cobranca;

    /* atualizar novamente em fin-contas-receber e termos condicoes de calcular os juros novamente
     a partir da ultima data de movimento da conta*/
     select max(dt_baixa) from fin_baixas_receber
     where codigo <> :codbx and codigo_cr = :codigo and pessoa_fj = :pessoa_fj
     into :dt_ult_data;
          
     /*teoricamente todas vezes vai entrar aqui */
     if (exists(select codigo from fin_contas_receber where cnpj = :cnpj and codigo = :codigo and ano = :ano and pessoa_fj = :pessoa_fj)) then
     begin
          /*Verificando se foi uma BAIXA PARCIAL DOS JUROS conforme o pedido da economica(Rose)*/
          select bx.vlr_orig_alt, bx.valor,  bx.vlr_baixa from fin_baixas_receber bx
          where codigo = :codbx and codigo_cr = :codigo and pessoa_fj = :pessoa_fj
          into :vlr_anterado, :valor, :vlr_baixa;

          /*Bloco utilizado para estornar movimentos onde o valor da baixa foi inferior
          ao valor de juros na ocasião*/
          if (:vlr_anterado = 'S') then
          begin
            select max(dt_baixa) from fin_baixas_receber
            where codigo <> :codbx and codigo_cr = :codigo and pessoa_fj = :pessoa_fj
            into :dt_ult_data;

            /* extorna o valor parcial */
            UPDATE FIN_CONTAS_RECEBER
            SET JUROS_REC = JUROS_REC - :VLR_BAIXA,
            DESCONTOS = DESCONTOS - :DESCONTOS,
            DATA_ULT_BAIXA = :dt_ult_data,
            valor = :valor
            WHERE CODIGO = :CODIGO AND ANO = :ANO and pessoa_fj = :pessoa_fj;
          end
          else
          begin
            /*Acontecerá casos em que o valor parcial será inferior ao valor de juros
            ocasionando um estorno errado. e: o sujeiro baixa 120 de juros e 30 da conta_
            if (:VLR_PARCIAL > :juros) then
             VLR_PARCIAL = :VLR_PARCIAL - :JUROS;   */

            /*se data da ultima baixa estiver nula é sinal
            que não há mais nenhum resquicio de  de baixas parciais portanto o valor parcial da conta
            tem de ser 0, afinal não se baixou absolutamente nada dela*/
            if (:dt_ult_data is null) then
            begin
              /* extorna o valor parcial */
              UPDATE FIN_CONTAS_RECEBER R
              SET VLR_PARCIAL = 0,
              JUROS_REC = JUROS_REC - :JUROS ,
              DATA_ULT_BAIXA = :dt_ult_data,
              VLR_ORIG_ALT = 'N'
              WHERE CODIGO = :CODIGO AND ANO = :ANO and pessoa_fj = :pessoa_fj ;
           end
           else
           begin
             /* extorna o valor parcial */
              UPDATE FIN_CONTAS_RECEBER R
              SET VLR_PARCIAL = :VLR_PARCIAL, /*este é o valor parcial da conta por ocasião da baixa a ser estornada*/
              JUROS_REC = JUROS_REC - :JUROS ,
              DATA_ULT_BAIXA = :dt_ult_data,
              VLR_ORIG_ALT = 'N'
              WHERE CODIGO = :CODIGO AND ANO = :ANO and pessoa_fj = :pessoa_fj ;
           end
          end
     END

     suspend;
END
^

ALTER PROCEDURE EXCLUI_CHEQUE_PLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
AS
BEGIN
     DELETE FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;
     
     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_COTACAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     DELETE FROM
     FAT_COTACOES_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     DELETE FROM FAT_COTACOES
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_CTB_CONFIG_REL_CONTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    CONTA INTEGER)
AS
BEGIN
  DELETE FROM CTB_CONFIGURA_RELATORIO_CONTAS
  WHERE (CNPJ = :CNPJ) AND (CODIGO = :CODIGO) AND (CONTA = :CONTA);
END
^

ALTER PROCEDURE EXCLUI_ENTRADA (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
AS
BEGIN
      DELETE 
      FROM EST_ENTRADAS_FATURAMENTO
      WHERE CNPJ = :CNPJ AND
            NDOCTO = :NDOCTO AND
            PESSOA_FJ = :PESSOA_FJ ;

      DELETE 
      FROM EST_ENTRADAS_ITENS
      WHERE CNPJ = :CNPJ AND
            NDOCTO = :NDOCTO AND
            PESSOA_FJ = :PESSOA_FJ ;
            
      DELETE 
      FROM EST_ENTRADAS
      WHERE CNPJ = :CNPJ AND
            NDOCTO = :NDOCTO AND
            PESSOA_FJ = :PESSOA_FJ ;
            
      SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_GARANTIAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     /* PARCELAMENTO */
     DELETE FROM
     FAT_GARANTIAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     /* ENVIADA PARA O CAIXA */
     DELETE FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_LEITURA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     delete from ofc_leituras_itens where cnpj = :cnpj and leitura = :codigo ;

     DELETE FROM ofc_leituras WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_MENSALIDADE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     delete from ofc_mensalidades_itens where cnpj = :cnpj and COD_MENSALIDADE = :codigo ;

     DELETE FROM ofc_mensalidades WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_NOTA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     DELETE FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO ;

     DELETE FROM FAT_VENDAS_VEICULO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM FAT_VENDAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     
     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_NOTA_ABERTOS (
    CNPJ CHAR(14))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND ENVIADA_CX = 'N' AND CANCELADA = 'N' AND FECHADA = 'N'
     INTO :CODIGO
     DO BEGIN
        DELETE FROM FAT_VENDAS_FRMPAGTO
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

        DELETE FROM FIN_CHEQUES
        WHERE CNPJ = :CNPJ AND VENDA = :CODIGO ;

        DELETE FROM FAT_VENDAS_VEICULO
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

        DELETE FROM FAT_VENDAS_PARCELAMENTO
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

        DELETE FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

        DELETE FROM FAT_VENDAS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END
     
     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_ORCAMENTO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     DELETE FROM
     FAT_ORCAMENTOS_ITENS_PECAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM
     FAT_ORCAMENTOS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     DELETE FROM FAT_ORCAMENTOS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     DELETE FROM
     OFC_CTRL_QUALIDADE
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM
     OFC_ORDEM_SERVICO_MOVIMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM
     OFC_ORDEM_SERVICO_SERVICO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     DELETE FROM
     OFC_ORDEM_SERVICO_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE EXCLUI_ORDEM_ORC (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     DELETE FROM
     OFC_ORDEM_SERVICO_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     DELETE FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE EXCLUI_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_TROCAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     /* PARCELAMENTO */
     DELETE FROM
     FAT_TROCAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     /* ENVIADA PARA O CAIXA */
     DELETE FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXCLUI_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* VERIFICA FATURAMENTO */
     EXECUTE PROCEDURE VERIFICA_FATURAMENTO ( :CNPJ, :CODIGO );

     /* ANALISE DE CUSTOS */
     DELETE FROM FIN_ANALISE_CUSTO_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     DELETE FROM FIN_ANALISE_CUSTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     /* PARCELAMENTO */
     DELETE FROM
     FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     /* PARCELAMENTO */
     DELETE FROM
     FAT_VENDAS_PARCELAMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     /* CONTAS A RECEBER */
     DELETE FROM
     FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
        
     /* CHEQUES DA VENDA */
     DELETE FROM
     FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO ;

     /* ENVIADA PARA O CAIXA */
     DELETE FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE EXCLUIR_FECHAMENTO_DIARIO (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
AS
BEGIN

     /* INSERINDO NA TABELA DE FECHAMENTO DIARIO */
     DELETE FROM EST_POSICAO_DIARIA
     WHERE CNPJ = :CNPJ AND DATA >= :INICIAL AND DATA <= :FINAL ;
END
^

ALTER PROCEDURE EXCLUIR_MENSAGEM (
    CODIGO INTEGER,
    ANO INTEGER)
AS
BEGIN
     DELETE FROM SIS_MENSAGENS
     WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     
     SUSPEND;
END
^

ALTER PROCEDURE EXCLUIR_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14))
AS
BEGIN
     DELETE
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :EMPRESA AND EXCLUIR = 'S' ;
END
^

ALTER PROCEDURE EXISTE_ANALISE_CUSTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    NUMERO INTEGER)
AS
begin
     SELECT COUNT(*) FROM FIN_ANALISE_CUSTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :NUMERO ;

     IF ( NUMERO IS NULL )
     THEN
         NUMERO = 0;

     suspend;
END
^

ALTER PROCEDURE EXISTE_ANALISE_CUSTO_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    NUMERO INTEGER)
AS
begin
     SELECT COUNT(*) FROM FIN_ANALISE_CUSTO_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO
     INTO :NUMERO ;

     IF ( NUMERO IS NULL )
     THEN
         NUMERO = 0;

     suspend;
END
^

ALTER PROCEDURE EXT_NF_ENT_CUSTO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE CUSTO_MED_ANT NUMERIC(18,4);
DECLARE VARIABLE PRC_REPOS NUMERIC(18,4);
DECLARE VARIABLE CUSTO_AQUISICAO NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE COD_HISTORICO INTEGER;
BEGIN
  /*  */
  TAG = 1;
  /*  */
  UPDATE EST_ENTRADAS
  SET PROC_CUSTO = 'N'
  WHERE CNPJ = :CNPJ AND
  NDOCTO = :NDOCTO AND
  PESSOA_FJ = :PESSOA_FJ;

  for select produto from est_entradas_itens eti
      where eti.cnpj = :cnpj and eti.ndocto = :ndocto and eti.pessoa_fj = :pessoa_fj
      into :produto
  do
  begin
    /*resgatando o custo médio anterior da NF*/
    select max(ct.codigo), max(ct.custo_medio_ant), max(ct.PRC_REPOS), max(ct.CUSTO_AQUISICAO) from est_historico_prd_custo ct
    where ct.cod_pessoa_fj = :pessoa_fj and ct.cnpj = :cnpj and ct.cod_nf_entrada = :ndocto
    and ct.cod_produto = :produto
    into :cod_historico, :custo_med_ant, :prc_repos, :custo_aquisicao;

    update est_produtos prd set prd.prc_custo_med = :custo_med_ant,
                                prd.prc_repos = :prc_repos,
                                prd.custo_aquisicao = :custo_aquisicao
    where prd.cnpj = :cnpj and prd.codigo = :produto;

    delete from est_historico_prd_custo ct where ct.codigo = :cod_historico;
  end

  SUSPEND;
END
^

ALTER PROCEDURE EXT_NF_ENT_FINANCEIRO (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE CODIGO_CP INTEGER;
DECLARE VARIABLE ANO_CP INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
BEGIN
  /*  */
  TAG = 0;

  SELECT PLANILHA
  FROM EST_ENTRADAS
  WHERE CNPJ = :CNPJ AND
        NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
  INTO :PLANILHA ;

  /*  */
  FOR SELECT CODIGO_CP, ANO_CP
      FROM EST_ENTRADAS_FATURAMENTO
      WHERE CNPJ = :CNPJ AND
            NDOCTO = :NDOCTO AND
            PESSOA_FJ = :PESSOA_FJ
      INTO :CODIGO_CP, :ANO_CP
      DO BEGIN
         /*  */
         TAG = 1;
         /*  */
         DELETE FROM FIN_CONTAS_PAGAR
         WHERE CNPJ = :CNPJ AND
               CODIGO = :CODIGO_CP AND
               ANO = :ANO_CP;
      END

  /*   */
  UPDATE CTB_MOVIMENTO_CONTABIL
  SET EXCLUIR = 'S'
  WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

  DELETE FROM CTB_MOVIMENTO_CONTABIL
  WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

  UPDATE EST_ENTRADAS
  SET PROC_FIN = 'N'
  WHERE CNPJ = :CNPJ AND
  NDOCTO = :NDOCTO AND
  PESSOA_FJ = :PESSOA_FJ;

  SUSPEND;
END
^

ALTER PROCEDURE EXT_NF_ENT_QTD (
    CNPJ VARCHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TAG INTEGER)
AS
DECLARE VARIABLE FATOR_CONV_PRIMARIA FLOAT;
DECLARE VARIABLE DATA_ENT TIMESTAMP;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE UNIDADES NUMERIC(18,4);
DECLARE VARIABLE QTDADE_ANT NUMERIC(18,4);
DECLARE VARIABLE QTDADE FLOAT;
DECLARE VARIABLE QTDE_UNIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNIT NUMERIC(18,4);
DECLARE VARIABLE LOC_ESTOQUE SMALLINT;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE TIPO_KDX CHAR(1);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO_GRADE VARCHAR(6);
DECLARE VARIABLE QUANTIDADE_GRADE NUMERIC(18,4);
DECLARE VARIABLE LOTE INTEGER;
DECLARE VARIABLE ESTLOTE NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE_LOTE NUMERIC(18,4);
DECLARE VARIABLE LT_CODIGO INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE ORIGEM_FISCAL CHAR(1);
DECLARE VARIABLE FATOR_CONVERSAO INTEGER;
DECLARE VARIABLE QTDE_CONVERSAO FLOAT;
DECLARE VARIABLE UNIDADE_PADRAO CHAR(4);
DECLARE VARIABLE UND_PRIMARIA CHAR(4);
BEGIN
  /*  */
  tag = 0;
  /*  */
  select data_ent, local_estoque, natureza from est_entradas
  where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
  into :data_ent, :loc_estoque, :natureza;
  if( :loc_estoque = 1)then
    ORIGEM_FISCAL = 'F';
  else
    ORIGEM_FISCAL = '';

  /* VERIFICANDO SE MOVIMENTA ESTOQUE */
  select mov_estoque from est_natureza
  where cnpj = :cnpj and codigo = :natureza
  into :mov_estoque;
  /*  */
  for select produto, unidade, quantidade, prc_unitario, subunidade, lote
      from est_entradas_itens
      where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj
      into :produto, :unidade, :qtdade, :prc_unit, :unidades, :lote
  do
  begin
      tag = 1;     
     /*---------------[ unidade de conversao ]---------------------------------*/
      select prd.unidade, prd.und_primaria, prd.fator_conversao from est_produtos prd
      where prd.codigo = :produto and prd.cnpj = :cnpj
      into :unidade_padrao, :und_primaria, :fator_conv_primaria;

      /*unidade padrão diferente da unidade de utilizada no fechamento*/
      if (:unidade <> :UNIDADE_PADRAO) then
      begin
        select cv.fator, cv.qtde from est_conversao_unid_med cv
        where cv.cnpj = :cnpj and cv.cod_und_padrao = :und_primaria and cv.cod_und_conversao = :unidade
        into :fator_conversao, :qtde_conversao;

        if (:fator_conversao = 1) then
          qtdade = (:qtdade / :qtde_conversao);
        else
          qtdade = (:qtdade * :qtde_conversao);

        qtdade = (:qtdade / :fator_conv_primaria);
      end
  

    /* MONTANDO O TIPO DE KARDEX */
    if (:mov_estoque = 'S') then
       tipo_kdx = 'S';

    if (:mov_estoque = 'N') then
       tipo_kdx = 'N';

    /* grades */
    for select grade, numero, quantidade from est_entradas_itens_grades
    where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj and produto = :produto
    into :grade, :numero_grade, :quantidade_grade
    do
    begin
      /* atualiza a grade e os numeros */
      update est_produtos_grades_numeros
      set estoque = estoque - :quantidade_grade
      where cnpj = :cnpj and produto = :produto and grade = :grade and
      numero = :numero_grade;
    end

    /* resgatando a qtdade atual do produto */
    select coalesce(qtdade_2,0) from est_produtos
    where cnpj = :cnpj and codigo = :produto
    into :qtdade_ant;
        

    mes = extract(month from :data_ent) ;
    ano = extract(year from :data_ent)  ;

    /* atualizando kardex */
    insert into est_kardex (cnpj, produto, ndocto, dt_movto, mes, ano, origem, tipo_es, pessoa_fj, qtdade_ant, qtdade, prc_unit, descontos, cfop, cfop_estoque)
           values (:cnpj, :produto, :ndocto, :data_ent, :mes, :ano, 'ENT'||:ORIGEM_FISCAL||'-E', :tipo_kdx, :pessoa_fj, :qtdade_ant, :qtdade, :prc_unit, 0, :natureza, :mov_estoque);

    if (:mov_estoque = 'S') then
    begin
      cont = 0;

      select count(*) from est_produtos_grades gr
      inner join est_produtos_grades_numeros n on (n.cnpj = gr.cnpj and n.grade = gr.grade and n.produto = gr.produto)
      where gr.cnpj = :cnpj and gr.produto = :produto
      into :cont;

      /* atualizando produtos */
      if (:loc_estoque = 1) then
      begin
        update est_produtos set qtdade_1 = qtdade_1 - :qtdade
        where cnpj = :cnpj and codigo = :produto;
      end

      /*em tese local de estoque 2,nunca será necessário atualizar por aqui se o produto tiver grade..*/
      if ( (:cont = 0)) then
      begin
        update est_produtos set qtdade_2 = qtdade_2 - :qtdade
        where cnpj = :cnpj and codigo = :produto;
      end

      /* lotes */
      for select lt.lote, lt.quantidade from est_entradas_itens_lotes lt
         where cnpj = :cnpj and ndocto = :ndocto and pessoa_fj = :pessoa_fj and produto = :produto
         into :lt_codigo, :quantidade_lote
      do
      begin
        if (quantidade_lote > 0) then
        begin
          /* atualiza a grade */
          update est_lote_produto ltp
          set ltp.estoque = ltp.estoque - :quantidade_lote
          where ltp.cnpj = :cnpj and ltp.produto = :produto and ltp.codigo = :lt_codigo;
        end
      end

    end
  end

  /* apagando etiquetas geradas */
  delete from est_estiqueta_produto
  where cnpj = :cnpj and pessoa_fj = :pessoa_fj and ndocto = :ndocto ;

  update est_entradas set proc_qtd = 'N'
  where cnpj = :cnpj and ndocto = :ndocto and  pessoa_fj = :pessoa_fj;

  suspend;
END
^

ALTER PROCEDURE EXTORNA_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    ACEITE INTEGER)
AS
DECLARE VARIABLE TURNO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE FEC_DIARIO CHAR(1);
BEGIN
     SELECT COUNT(FECHADO) FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     DATA > :DATA AND FECHADO = 'S'
     INTO :ACEITE ;

     SELECT FAZ_FECHAMENTO_DIARIO
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :FEC_DIARIO ;
     
     IF (( ACEITE IS NULL ) or ( ACEITE = 0 ))
     THEN BEGIN
          IF ( FEC_DIARIO = 'S' )
          THEN BEGIN
               DELETE FROM EST_POSICAO_DIARIA
               WHERE CNPJ = :CNPJ AND DATA = :DATA ;
          END

          SELECT TURNO
          FROM FAT_CAIXAS
          WHERE CNPJ = :CNPJ AND USUARIO = :USUARIO AND
          CONTA = :CONTA AND DATA = :DATA
          INTO :TURNO ;

          IF ( TURNO = 99 )
          THEN BEGIN
               SELECT PLANILHA
               FROM FAT_CAIXA_GERAL
               WHERE CNPJ = :CNPJ AND DATA = :DATA
               INTO :PLANILHA ;
          END
          ELSE BEGIN
               SELECT PLANILHA
               FROM FAT_CAIXAS
               WHERE CNPJ = :CNPJ AND USUARIO = :USUARIO AND
               CONTA = :CONTA AND DATA = :DATA
               INTO :PLANILHA ;
          END

          UPDATE CTB_MOVIMENTO_CONTABIL
          SET EXCLUIR = 'S'
          WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

          DELETE FROM CTB_MOVIMENTO_CONTABIL
          WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

          UPDATE FAT_CAIXAS
          SET FECHADO = 'N'
          WHERE CNPJ = :CNPJ AND
          USUARIO = :USUARIO AND
          CONTA = :CONTA AND DATA = :DATA ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE EXTORNA_GARANTIA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
/*     DELETE FROM
     FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_TRC = :CODIGO ;
     
     /* TROCA FECHADA */
     UPDATE FAT_GARANTIAS
     SET FECHADO = 'N', ENTRADA = 0, DINHEIRO = 0,
     CHEQUE = 0, CARTAO = 0,
     TICKET = 0, DATA_CAIXA = NULL, USUARIO = 0,
     CONTA_CAIXA = NULL, TURNO = NULL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXTORNA_NOTA_CANCELADA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
BEGIN
     /* VERIFICA A NATUREZA DE OPERAÇÃO */
     SELECT NATUREZA, DATA, NUM_NF, NUM_CUPOM FROM FAT_VENDAS
     WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
     INTO :NATUREZA, :DATA, :NUM_NF, :NUM_CUPOM ;

     SELECT MOV_ESTOQUE FROM EST_NATUREZA
     WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
     INTO :MOV_ESTOQUE ;

     IF ( MOV_ESTOQUE = 'S' )
     THEN BEGIN
          /* ATUALIZA O ESTOQUE */
          FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE, PRODUTOFIS
          FROM FAT_VENDAS_ITENS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
          INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :PRODUTOFIS
          DO BEGIN
             /* ESTOQUE FISICO */
             UPDATE EST_PRODUTOS SET QTDADE_2 = QTDADE_2 - (:QUANTIDADE * :QNTDEUNIDADE),
             DT_ULT_VENDA = :DATA
             WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;

             IF (( NUM_NF > 0 ) OR ( NUM_CUPOM > 0 ))
             THEN BEGIN
                  /* ESTOQUE FISCAL */
                  UPDATE EST_PRODUTOS SET QTDADE_1 = QTDADE_1 - (:QUANTIDADE * :QNTDEUNIDADE),
                  DT_ULT_VENDA = :DATA
                  WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTOFIS;
             END
          END
     END

     /* APAGA DO CONTAS A RECEBER */
     DELETE FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_VN = :CODIGO ;

     UPDATE FAT_VENDAS SET CANCELADA = 'N'
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
END
^

ALTER PROCEDURE EXTORNA_PAGAR (
    CNPJ CHAR(14),
    CODBX INTEGER,
    ANOBX SMALLINT)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_PAG NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_PAG NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_ENT INTEGER;
DECLARE VARIABLE ANO_ENT SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE DUPLICATA VARCHAR(15);
DECLARE VARIABLE CONFERIDA CHAR(1);
DECLARE VARIABLE CODIGO_CONTABIL INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
Begin
     /* CONTAS A PAGAR */
     SELECT
          CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG,
          BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
          DT_AVISO, PLANILHA, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
          TOTAL_ENTRADA, CONTABILIDADE,
          COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODBX AND ANO = :ANOBX
     INTO
          :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG,
          :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT,
          :AVISO, :DT_AVISO, :PLANILHA, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
          :TOTAL_ENTRADA, :CODIGO_CONTABIL,
          :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE;

     if ( exists ( select codigo from fin_contas_pagar
     where codigo = :codigo and ano = :ano ))
     THEN BEGIN
          /* EXTORNA O VALOR PARCIAL */
          UPDATE FIN_CONTAS_PAGAR
          SET VLR_PARCIAL = :VLR_PARCIAL
          WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     END
     ELSE BEGIN
          INSERT INTO FIN_CONTAS_PAGAR
          ( CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO, ORIGEM,
          CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO, CENTRO_CUSTO, DUPLICATA,
          CONFERIDA, TOTAL_ENTRADA, CONTABILIDADE,
          COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
          )
          VALUES
          (
          :CNPJ, GEN_ID(FIN_PAGAR_COD_GE,1), :ANO, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM,
          :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO, :CENTRO_CUSTO, :DUPLICATA,
          :CONFERIDA, :TOTAL_ENTRADA, :CODIGO_CONTABIL,
          :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
          );
     END
     
     /* APAGA O CONTAS A PAGAR */
     DELETE FROM  FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODBX AND ANO = :ANOBX ;
     
     /* APAGA DA CONTABILIDADE */
     UPDATE CTB_MOVIMENTO_CONTABIL
     SET EXCLUIR = 'S'
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

     DELETE FROM  CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;
     
     /* APAGA DOS CHEQUE */
     DELETE FROM  CTB_CHEQUE
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;
END
^

ALTER PROCEDURE EXTORNA_PAGAR_PARCIAL (
    CNPJ CHAR(14),
    CODBX INTEGER,
    ANOBX SMALLINT,
    VLR_PARCIAL NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_ENT INTEGER;
DECLARE VARIABLE ANO_ENT SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE JUROS_PAG NUMERIC(18,4);
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE DUPLICATA VARCHAR(15);
DECLARE VARIABLE CONFERIDA CHAR(1);
DECLARE VARIABLE CODIGO_CONTABIL INTEGER;
Begin
     /* CONTAS A PAGAR */
     SELECT
          CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
          DT_AVISO, PLANILHA, VALOR, JUROS_PAG, CENTRO_CUSTO, DUPLICATA,
          CONFERIDA, TOTAL_ENTRADA, CONTABILIDADE
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODBX AND ANO = :ANOBX
     INTO
          :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT,
          :AVISO, :DT_AVISO, :PLANILHA, :VALOR, :JUROS_PAG,
          :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA, :TOTAL_ENTRADA,
          :CODIGO_CONTABIL ;
          
     IF ( EXISTS ( SELECT CODIGO FROM FIN_CONTAS_PAGAR
     WHERE CODIGO = :CODIGO AND ANO = :ANO ))
     THEN BEGIN
          /* EXTORNA O VALOR PARCIAL */
          UPDATE FIN_CONTAS_PAGAR
          SET VLR_PARCIAL = VLR_PARCIAL - :VLR_PARCIAL,
          JUROS_PAG = JUROS_PAG + :JUROS_PAG
          WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     END
     ELSE BEGIN
          INSERT INTO FIN_CONTAS_PAGAR
          ( CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
          DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
          VALOR, VLR_PARCIAL, JUROS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
          DT_AVISO, CENTRO_CUSTO, DUPLICATA, CONFERIDA, TOTAL_ENTRADA, CONTABILIDADE
          )
          VALUES
          (
          :CNPJ, GEN_ID(FIN_PAGAR_COD_GE,1), :ANO, :PESSOA_FJ, :DT_EMISSAO,
          :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
          :VALOR, 0, :JUROS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
          :DT_AVISO, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA, :TOTAL_ENTRADA,
          :CODIGO_CONTABIL
          );
     END
     
     /* APAGA O CONTAS A PAGAR */
     UPDATE FIN_BAIXAS_PAGAR
     SET VALOR = VALOR - :VALOR
     WHERE CNPJ = :CNPJ AND CODIGO = :CODBX AND ANO = :ANOBX ;
     
     suspend;
END
^

ALTER PROCEDURE EXTORNA_PLANILHA (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
begin
     /* CHEQUE */
     DELETE FROM CTB_CHEQUE
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

     /* BANCO */
     UPDATE CTB_MOVIMENTO_CONTABIL
     SET EXCLUIR = 'S'
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

     DELETE FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA ;

     suspend;
END
^

ALTER PROCEDURE EXTORNA_TROCA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /* CONTAS A RECEBER */
     DELETE FROM
     FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_TRC = :CODIGO ;
     
     /* TROCA FECHADA */
     UPDATE FAT_TROCAS
     SET FECHADO = 'N', ENTRADA = 0, DINHEIRO = 0,
     CHEQUE = 0, CARTAO = 0,
     TICKET = 0, DATA_CAIXA = NULL, USUARIO = 0,
     CONTA_CAIXA = NULL, TURNO = NULL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     SUSPEND;
END
^

ALTER PROCEDURE EXTORNA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE ORDEM INTEGER;
DECLARE VARIABLE NUMVENDAS INTEGER;
DECLARE VARIABLE SERIE VARCHAR(3);
DECLARE VARIABLE ES VARCHAR(1);
BEGIN
     select coalesce(nat.es,'S') from fat_vendas vd
     inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
     where vd.cnpj = :cnpj and vd.codigo = :codigo
     into :ES;

     /* verifica se tem fatura baixada pois nao permite estorna com fatura baixada*/
     if (:es = 'E') then
     begin
       select count(codigo_vn) from fin_baixas_pagar pgr
       where cnpj = :cnpj and pgr.codigo_vn = :codigo
       into :numvendas ;   

       if ( numvendas > 0 ) then
         exception venda_faturada ;

       /* contas à pagar */
       delete from fin_contas_pagar
       where cnpj = :cnpj and codigo_vn = :codigo ;

     end
     else
     begin
       select count(codigo_vn) from fin_baixas_receber
       where cnpj = :cnpj and codigo_vn = :codigo
       into :numvendas ;

       if ( numvendas > 0 ) then
         exception venda_faturada ;

       /* contas a receber */
       delete from fin_contas_receber
       where cnpj = :cnpj and codigo_vn = :codigo ;
         
       delete from fin_cheques
       where cnpj = :cnpj and venda = :codigo;
    
       delete from fin_movimento_cartao
       where cnpj = :cnpj and venda = :codigo;
     end

     /* FORMAS DE PAGAMENTO */
     delete from fat_vendas_frmpagto
     where cnpj = :cnpj and codigo = :codigo ;

     select num_nf, num_cupom, orcamento, serie
     from fat_vendas where cnpj = :cnpj and codigo = :codigo
     into :num_nf, :num_cupom, :ordem, :serie;

     if (serie is null) then
       serie = 'N1';

     /* servicos em ordem nao trabalaham com estoque */
     if (serie <> 'SRV')  then
     begin
       update fat_vendas vd
       set vd.fechada = 'N', num_nf = 0, num_cupom = 0,
           entrada = 0, dinheiro = 0, cheque = 0, cartao = 0,
           ticket = 0, troco = 0, data_caixa = null, usuario = 0,
           conta_caixa = null, duplicata = 0, selecionada = 'N', turno = null, serie = null
           where cnpj = :cnpj and codigo = :codigo ;
     end
     else
     begin
       /* enviada para o caixa */
       update fat_vendas vd
       set vd.fechada = 'N', num_cupom = 0, entrada = 0, dinheiro = 0,
           cheque = 0, cartao = 0, ticket = 0, troco = 0, data_caixa = null, usuario = 0,
           conta_caixa = null, duplicata = 0, selecionada = 'N', turno = null
           where cnpj = :cnpj and codigo = :codigo ;
     end
     suspend;
END
^

ALTER PROCEDURE FAT_CAIXAS_MOVIMENTOS_C (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
      FOR SELECT
             DOCUMENTO,
             HISTORICO,
             VALOR,
             TIPO,
             NOME_CONTRAPARTIDA,
             CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA AND
            USUARIO = :USUARIO AND
            CONTA = :CONTA AND
            TURNO = :TURNO AND
            TIPO = 'C'
      INTO 
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :NOME_CONTRAPARTIDA,
           :CONTRA_PARTIDA
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_CAIXAS_MOVIMENTOS_D (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
      FOR SELECT
             DOCUMENTO,
             HISTORICO,
             VALOR,
             TIPO,
             NOME_CONTRAPARTIDA,
             CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA AND
            USUARIO = :USUARIO AND
            CONTA = :CONTA AND
            TURNO = :TURNO AND
            TIPO = 'D'
      INTO 
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :NOME_CONTRAPARTIDA,
           :CONTRA_PARTIDA
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_CAIXAS_MOVIMENTOS_GERAL_C (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
      FOR SELECT
             DOCUMENTO,
             HISTORICO,
             VALOR,
             TIPO,
             NOME_CONTRAPARTIDA,
             CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA AND
            TIPO = 'C'
      INTO 
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :NOME_CONTRAPARTIDA,
           :CONTRA_PARTIDA
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_CAIXAS_MOVIMENTOS_GERAL_D (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    TIPO CHAR(1))
AS
BEGIN
      FOR SELECT
             DOCUMENTO,
             HISTORICO,
             VALOR,
             TIPO,
             NOME_CONTRAPARTIDA,
             CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA AND
            TIPO = 'D'
      INTO 
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :NOME_CONTRAPARTIDA,
           :CONTRA_PARTIDA
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_CAIXAS_MOVTOS_LANCA_CONTAB (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    PLANILHA INTEGER,
    TURNO INTEGER)
AS
DECLARE VARIABLE CONTRA_PARTIDA INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TIPO CHAR(1);
BEGIN
      FOR SELECT
             DOCUMENTO, HISTORICO, VALOR,
             TIPO, CONTRA_PARTIDA
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ = :CNPJ AND
            DATA = :DATA AND
            USUARIO = :USUARIO AND
            CONTA = :CONTA AND
            TURNO = :TURNO
      INTO 
           :DOCUMENTO,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :CONTRA_PARTIDA
      DO BEGIN
          IF (( TIPO = 'C' ) and ( CONTRA_PARTIDA > 0 ))
          THEN BEGIN
               /* LANCA OS MOVIMENTOS CONTABEIS */
               EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
               (
               :CNPJ, :DATA, 'C', :DOCUMENTO,
               :HISTORICO,
               :VALOR, :CONTRA_PARTIDA, 'CX', :PLANILHA,
               0, '', 'A', '', 0
               );

               /* LANCA OS MOVIMENTOS CONTABEIS */
               EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
               (
               :CNPJ, :DATA, 'D', :DOCUMENTO,
               :HISTORICO,
               :VALOR, :CONTA, 'CX', :PLANILHA,
               0, '', 'A', '', 0
               );
           END
           ELSE BEGIN
               IF ( CONTRA_PARTIDA > 0 )
               THEN BEGIN
                    /* LANCA OS MOVIMENTOS CONTABEIS */
                    EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                    (
                    :CNPJ, :DATA, 'D', :DOCUMENTO,
                    :HISTORICO,
                    :VALOR, :CONTRA_PARTIDA, 'CX', :PLANILHA,
                    0, '', 'A', '', 0
                    );

                    /* LANCA OS MOVIMENTOS CONTABEIS */
                    EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                    (
                    :CNPJ, :DATA, 'C', :DOCUMENTO,
                    :HISTORICO,
                    :VALOR, :CONTA, 'CX', :PLANILHA,
                    0, '', 'A', '', 0
                    );
               END
           END
      END
END
^

ALTER PROCEDURE FAT_VENDAS_CARREGADAS (
    CNPJ VARCHAR(14),
    CARGA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    NUM_NF INTEGER,
    DESC_ACRES NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    ORCAMENTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA,
             PESSOA_FJ, USUARIO, VENDEDOR,
             NUM_NF, DESC_ACRES, TOTAL,
             VOLUME, PESO,  ORCAMENTO, NOME
      FROM FAT_VENDAS
      WHERE ENVIADA_CX = 'S' AND CARGA = :CARGA AND CNPJ = :CNPJ
      INTO 
           :CODIGO, :DATA, :FECHADA,
           :PESSOA_FJ, :USUARIO, :VENDEDOR,
           :NUM_NF, :DESC_ACRES, :TOTAL,
           :VOLUME, :PESO,
           :ORCAMENTO,:NOME
      DO
      BEGIN
           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_VENDAS_CARREGAR (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    NUM_NF INTEGER,
    DESC_ACRES NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    ORCAMENTO INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA,
             PESSOA_FJ, USUARIO, VENDEDOR,
             NUM_NF, DESC_ACRES, TOTAL,
             VOLUME, PESO,  ORCAMENTO, NOME
      FROM FAT_VENDAS
      WHERE ENVIADA_CX = 'S' AND ( (CARGA IS NULL) or (CARGA = 0)) AND CNPJ = :CNPJ
      INTO 
           :CODIGO, :DATA, :FECHADA,
           :PESSOA_FJ, :USUARIO, :VENDEDOR,
           :NUM_NF, :DESC_ACRES, :TOTAL,
           :VOLUME, :PESO,
           :ORCAMENTO,:NOME
      DO
      BEGIN
           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE FAT_VENDAS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLR_PARC_LC NUMERIC(18,4),
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    APRAZO NUMERIC(18,4),
    UF CHAR(2),
    SERIE CHAR(3))
AS
BEGIN EXIT; END
^

ALTER PROCEDURE FAT_VENDAS_ITENS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    QUANTIDADE_FIS NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_FIS NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    SUBUNIDADE INTEGER)
AS
DECLARE VARIABLE NUM INTEGER;
BEGIN
  SELECT COUNT(*)
  FROM FAT_VENDAS
  WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
/*  order by cnpj, codigo gian*/
  INTO :NUM ;

  IF ( NUM IS NULL )
  THEN
      NUM = 0;

IF ( NUM > 0 )
THEN BEGIN

  SELECT COUNT(*) FROM
  FAT_VENDAS_ITENS
  WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
  AND CODIGO =:CODIGO
  INTO :SEQUENCIA ;

  IF ( SEQUENCIA IS NULL )
  THEN
      SEQUENCIA = 0;

  SEQUENCIA = :SEQUENCIA + 1;

  INSERT INTO FAT_VENDAS_ITENS
(
    CNPJ,
    CODIGO ,
    PRODUTO,
    SEQUENCIA,
    QUANTIDADE,
    QUANTIDADE_FIS,
    PRC_UNITARIO,
    PRC_UNITARIO_FIS,
    PRC_CUSTO,
    DESCONTO,
    PORC_DESC,
    UNIDADE,
    PRC_UNIT_ORIGINAL,
    SUBUNIDADE
)
  VALUES (
    :CNPJ,
    :CODIGO ,
    :PRODUTO,
    :SEQUENCIA,
    :QUANTIDADE,
    :QUANTIDADE_FIS,
    :PRC_UNITARIO,
    :PRC_UNITARIO_FIS,
    :PRC_CUSTO,
    :DESCONTO,
    :PORC_DESC,
    :UNIDADE,
    :PRC_UNIT_ORIGINAL,
    :SUBUNIDADE
    );
END
END
^

ALTER PROCEDURE FAT_VENDAS_PRODUTOS_CAIXA (
    CNPJ CHAR(14),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
AS
DECLARE VARIABLE TIPO_EMPRESA VARCHAR(30);
BEGIN
     SELECT TIPO_EMPRESA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TIPO_EMPRESA ;


          FOR SELECT
              CODIGO, DATA
          FROM FAT_VENDAS
          WHERE
          CNPJ = :CNPJ AND
          USUARIO = :USUARIO AND
          DATA_CAIXA = :DATA_CAIXA AND
          TURNO = :TURNO AND
          FECHADA = 'S' AND
          ENVIADA_CX = 'S' AND
          CANCELADA <> 'S'
          INTO :CODIGO, :DATA
          DO BEGIN
             FOR SELECT
             PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
             ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
             ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
             SUBUNIDADE, NOME_PRODUTO
             FROM FAT_VENDAS_ITENS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
                  :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
                  :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
                  :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :NOME_PRODUTO
             DO BEGIN
                SELECT QNTDE_EXPOSTA, GRUPO, SUBGRUPO FROM EST_PRODUTOS
                WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                INTO :QUANTIDADE_EXPOSTA, :GRUPO, :SUBGRUPO ;

                SUSPEND;
             END
          END
END
^

ALTER PROCEDURE FAT_VENDAS_PRODUTOS_CAIXA_GERAL (
    CNPJ CHAR(14),
    DATA_CAIXA DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    MOV_CAIXA CHAR(1))
AS
DECLARE VARIABLE TIPO_EMPRESA VARCHAR(30);
DECLARE VARIABLE NATUREZA INTEGER;
BEGIN
     SELECT TIPO_EMPRESA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TIPO_EMPRESA ;

     FOR SELECT CODIGO, DATA_CAIXA
     FROM FAT_VENDAS
     WHERE
     CNPJ = :CNPJ AND
     DATA_CAIXA = :DATA_CAIXA AND
     FECHADA = 'S' AND
     ENVIADA_CX = 'S' AND
     CANCELADA <> 'S'
     INTO :CODIGO, :DATA
     DO BEGIN
        FOR SELECT
        PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
        ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
        ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
        SUBUNIDADE, NOME_PRODUTO, CFOP
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
             :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
             :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :NOME_PRODUTO,
             :NATUREZA
        DO BEGIN
           MOV_CAIXA = 'S';

           SELECT MOV_CAIXA
           FROM EST_NATUREZA
           WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
           INTO :MOV_CAIXA ;

           IF ( MOV_CAIXA IS NULL )
           THEN
               MOV_CAIXA = 'S';

           IF ( MOV_CAIXA = 'N' )
           THEN BEGIN
                PRC_UNITARIO = 0;
                PORC_DESC    = 0;
                DESCONTO     = 0;
           END

           SELECT QNTDE_EXPOSTA, GRUPO, SUBGRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :QUANTIDADE_EXPOSTA, :GRUPO, :SUBGRUPO ;

           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE FATURA_FUTURA (
    CNPJ CHAR(14),
    CLIENTE INTEGER,
    HISTORICO VARCHAR(100),
    EMISSAO DATE,
    VENCIMENTO DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    BANCO VARCHAR(3),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    PARCELAS INTEGER,
    INTERVALO INTEGER)
RETURNS (
    NUM_FATURA INTEGER)
AS
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DPL INTEGER;
DECLARE VARIABLE FATURAAGRUPADORA INTEGER;
DECLARE VARIABLE PARCELA INTEGER;
DECLARE VARIABLE BOLETO VARCHAR(30);
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE BOL INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE VALOR_LIQUID NUMERIC(18,4);
Begin
     IF ( PARCELAS = 1 )
     THEN BEGIN
          /* FATURA */
          FATURA = GEN_ID(FIN_FATURA_GE, 1);
          
          IF (BANCO <> '')
          THEN BEGIN
               SELECT BOLETO FROM FIN_BANCO
               WHERE CODIGO = :BANCO
               INTO :BOL ;
          
               IF (BOL IS NULL)
               THEN BEGIN
                    BOL = 1;
               END
               ELSE BEGIN
                    BOL = BOL + 1;
               END
                     
               UPDATE FIN_BANCO SET BOLETO = :BOL
               WHERE CODIGO = :BANCO ;

               BOLETO = CAST (BOL AS VARCHAR(15));

               /* CRIA A FATURA */
               INSERT INTO FIN_FATURAS
               (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
               BAIXADA, BANCO, BOLETO, TIPO, ENVIADA, OBS, DUPLICATA, ORIGEM )
               VALUES
               (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO,
               'N', :BANCO, :BOLETO, :TIPO, :ENVIADA, :OBS, :DUPLICATA, 'AUT' );
          END
          ELSE BEGIN
               BOL = 0;

               IF ( DUPLICATA = '' )
               THEN BEGIN
                    SELECT DUPLICATA FROM SIS_EMPRESAS
                    WHERE CNPJ = :CNPJ
                    INTO :DPL ;

                    IF (DPL IS NULL)
                    THEN BEGIN
                         DPL = 1;
                    END
                    ELSE BEGIN
                         DPL = DPL + 1;
                    END

                    DUPLICATA = CAST( DPL AS VARCHAR(30));

                    UPDATE SIS_EMPRESAS SET DUPLICATA = :DPL
                    WHERE CNPJ = :CNPJ ;
               END

               /* CRIA A FATURA */
               INSERT INTO FIN_FATURAS
               (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
               BAIXADA, DUPLICATA, TIPO, ENVIADA, OBS, ORIGEM )
               VALUES
               (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO, 'N',
               :DUPLICATA, :TIPO, :ENVIADA, :OBS, 'AUT' );
          END

          FOR SELECT CODIGO, DATA, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
          FROM FAT_VENDAS
          WHERE FECHADA = 'S' AND DATA >= :DATA_INICIAL AND DATA <= :DATA_FINAL AND
          CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE AND CANCELADA <> 'S' AND DUPLICATA = 0
          AND SELECIONADA = 'S'
          INTO :VENDA, :DATA, :VALOR_LIQUID DO
          BEGIN
               /* GERA O CODIGO E O ANO DO RECEBER */
               SELECT CODIGO, ANO
               FROM GERAR_CODIGO_RECEBER(1)
               INTO :CODREC, :ANO;
                     
               DOCTO = 'VND ' || CAST(:VENDA AS VARCHAR(15)) ;
           
               /* CRIANDO O CONTAS A RECEBER */
               INSERT INTO FIN_CONTAS_RECEBER
               (CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO, DOCTO, PARCELA, HISTORICO,
               VALOR, BOLETO, ORIGEM, SELECIONADO, NUMBOLETO, NUMDUPLICATA, FATURA, CODIGO_VN, ANO_VN )
               VALUES
               (:CNPJ, :CODREC, :ANO, :CLIENTE, :EMISSAO, :DATA, :DOCTO, '01/01', :HISTORICO,
               :VALOR_LIQUID, 'N', 'VND', 'N', :BOL, :FATURA, :FATURA, :VENDA, :ANO ) ;
          END

          UPDATE  FAT_VENDAS SET DUPLICATA = :FATURA, BANCO = :BANCO
          WHERE FECHADA = 'S' AND DATA >= :DATA_INICIAL AND DATA <= :DATA_FINAL AND
          CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE AND CANCELADA <> 'S' AND
          (( DUPLICATA = 0 ) or ( DUPLICATA IS NULL ))
          AND SELECIONADA = 'S' ;


          NUM_FATURA = :FATURA ;
     END
     ELSE BEGIN
          PARCELA = 1;

          /* DIVIDE O VALOR PELO NUMERO DE PARCELAS */
          TOTAL = TOTAL / PARCELAS ;

          WHILE ( PARCELA <= PARCELAS ) DO
          BEGIN
                /* FATURA */
                FATURA = GEN_ID(FIN_FATURA_GE, 1);

                IF ( PARCELA = 1 )
                THEN BEGIN
                     /* QUAL O NUMERO DA FATURA QUE IRA AGRUPAR AS OUTRAS PARCELAS */
                     FATURAAGRUPADORA = FATURA ;
                END
          
                IF (BANCO <> '')
                THEN BEGIN
                     SELECT BOLETO FROM FIN_BANCO
                     WHERE CODIGO = :BANCO
                     INTO :BOL ;
          
                     IF (BOL IS NULL)
                     THEN BEGIN
                          BOL = 1;
                     END
                     ELSE BEGIN
                          BOL = BOL + 1;
                     END
                     
                     UPDATE FIN_BANCO SET BOLETO = :BOL
                     WHERE CODIGO = :BANCO ;

                     BOLETO = CAST ( BOL AS VARCHAR(15));

                     IF (PARCELA = 1)
                     THEN BEGIN
                          /* CRIA A FATURA */
                          INSERT INTO FIN_FATURAS
                          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
                          BAIXADA, BANCO, BOLETO, TIPO, ENVIADA, OBS, DUPLICATA, ORIGEM )
                          VALUES
                          (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO,
                          'N', :BANCO, :BOLETO, :TIPO, :ENVIADA, :OBS, :DUPLICATA, 'AUT' );
                     END
                     ELSE BEGIN
                          VENCIMENTO = VENCIMENTO + INTERVALO ;

                          /* CRIA A FATURA */
                          INSERT INTO FIN_FATURAS
                          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
                          BAIXADA, BANCO, BOLETO, TIPO, ENVIADA, OBS, DUPLICATA, AGRUPADORA, ORIGEM )
                          VALUES
                          (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO,
                          'N', :BANCO, :BOLETO, :TIPO, :ENVIADA, :OBS, :DUPLICATA, :FATURAAGRUPADORA, 'AUT' );
                     END
                END
                ELSE BEGIN
                     BOL = 0;

                     IF ( DUPLICATA = '' )
                     THEN BEGIN
                          SELECT DUPLICATA FROM SIS_EMPRESAS
                          WHERE CNPJ = :CNPJ
                          INTO :DPL ;

                          IF (DPL IS NULL)
                          THEN BEGIN
                               DPL = 1;
                          END
                          ELSE BEGIN
                               DPL = DPL + 1;
                          END

                          DUPLICATA = CAST( DPL AS VARCHAR(30) );

                          UPDATE SIS_EMPRESAS SET DUPLICATA = :DPL
                          WHERE CNPJ = :CNPJ ;
                     END

                     IF (PARCELA = 1)
                     THEN BEGIN
                          /* CRIA A FATURA */
                          INSERT INTO FIN_FATURAS
                          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
                          BAIXADA, DUPLICATA, TIPO, ENVIADA, OBS, ORIGEM )
                          VALUES
                          (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO, 'N',
                          :DUPLICATA, :TIPO, :ENVIADA, :OBS, 'AUT' );
                     END
                     ELSE BEGIN
                          /* CRIA A FATURA */
                          INSERT INTO FIN_FATURAS
                          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
                          BAIXADA, DUPLICATA, TIPO, ENVIADA, OBS, AGRUPADORA, ORIGEM )
                          VALUES
                          (:CNPJ, :FATURA, :CLIENTE, :EMISSAO, :TOTAL, 0, 0, :VENCIMENTO, :HISTORICO, 'N',
                          :DUPLICATA, :TIPO, :ENVIADA, :OBS, :FATURAAGRUPADORA, 'AUT' );
                     END
                END

                PARCELA = PARCELA + 1;

          END /* FINAL DO WHILE */

          FOR SELECT CODIGO, DATA, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
          FROM FAT_VENDAS
          WHERE FECHADA = 'S' AND DATA >= :DATA_INICIAL AND DATA <= :DATA_FINAL AND
          CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE AND CANCELADA <> 'S' AND DUPLICATA = 0
          AND SELECIONADA = 'S'
          INTO :VENDA, :DATA, :VALOR_LIQUID DO
          BEGIN
               /* GERA O CODIGO E O ANO DO RECEBER */
               SELECT CODIGO, ANO
               FROM GERAR_CODIGO_RECEBER(1)
               INTO :CODREC, :ANO;
                     
               DOCTO = 'VND ' || CAST(:VENDA AS VARCHAR(15)) ;
           
               /* CRIANDO O CONTAS A RECEBER */
               INSERT INTO FIN_CONTAS_RECEBER
               (CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO, DOCTO, PARCELA, HISTORICO,
               VALOR, BOLETO, ORIGEM, SELECIONADO, NUMBOLETO, NUMDUPLICATA, FATURA, CODIGO_VN, ANO_VN )
               VALUES
               (:CNPJ, :CODREC, :ANO, :CLIENTE, :EMISSAO, :DATA, :DOCTO, '01/01', :HISTORICO,
               :VALOR_LIQUID, 'N', 'VND', 'N', :BOL, :FATURA, :FATURAAGRUPADORA, :VENDA, :ANO ) ;
          END

          UPDATE  FAT_VENDAS SET DUPLICATA = :FATURAAGRUPADORA, BANCO = :BANCO
          WHERE FECHADA = 'S' AND DATA >= :DATA_INICIAL AND DATA <= :DATA_FINAL AND
          CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE AND CANCELADA <> 'S' AND
          (( DUPLICATA = 0 ) or ( DUPLICATA IS NULL ))

          AND SELECIONADA = 'S' ;

          NUM_FATURA = :FATURAAGRUPADORA ;
     END
     suspend;
END
^

ALTER PROCEDURE FATURA_OFC_ORDEM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENDA INTEGER)
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE NF INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE VLR_PARC_LC NUMERIC(18,4);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TIPO_FATURA CHAR(1);
DECLARE VARIABLE VENCTO DATE;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE BOLETO INTEGER;
begin
     SELECT OFC_ORDEM_VENDEDOR, OFC_ORDEM_PRODUTO
     FROM SIS_CONFIGURACOES
     WHERE CNPJ = :CNPJ
     INTO :VENDEDOR, :PRODUTO ;

     SELECT NOME FROM EST_PRODUTOS
     WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
     INTO :NOME_PRODUTO ;

     SELECT
           PESSOA_FJ    ,
           NOME         ,
           DATA         ,
           NATUREZA     ,
           HISTORICO    ,
           TOTAL        ,
           DESC_ACRESC  ,
           VLR_ENTRADA  ,
           FORMA_PAGTO  ,
           NF
     FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
           :PESSOA_FJ    ,
           :NOME         ,
           :DATA         ,
           :NATUREZA     ,
           :HISTORICO    ,
           :TOTAL        ,
           :DESC_ACRESC  ,
           :ENTRADA      ,
           :FORMA_PAGTO  ,
           :NF ;

     IF ( NOT PESSOA_FJ IS NULL )
     THEN BEGIN
          /* CODIGO DA VENDA */
          SELECT CODIGO FROM GERAR_CODIGO ('VENDAS',1)
          INTO :VENDA;

          SELECT FATURA_FUTURA
          FROM FIN_FORMAS_PAGTO
          WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PAGTO
          INTO :TIPO_FATURA ;

          IF ( TIPO_FATURA = 'S' ) /* SE S IGUAL FATURA FUTURA */
          THEN BEGIN
              INSERT INTO FAT_VENDAS
              (
               CNPJ, CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ,
               VENDEDOR, NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF,
               DESC_ACRES, ENTRADA, DINHEIRO, CHEQUE, CARTAO, TICKET,
               TOTAL, VLR_PARC_LC, TIPO_VENDA, TROCO, NOME, SERIE, USUARIO,
               ORCAMENTO
              )
              VALUES
              (
              :CNPJ, :VENDA, :DATA, 'N', :HISTORICO, :PESSOA_FJ,
              :VENDEDOR, :NATUREZA, 'S', :FORMA_PAGTO, :NF,
              :DESC_ACRESC, :ENTRADA, 0,0,0,0,
              :TOTAL, :VLR_PARC_LC, 'FFT', 0, :NOME, 'SRV', 0,
              :CODIGO
              );
          END
          ELSE BEGIN
              INSERT INTO FAT_VENDAS
              (
               CNPJ, CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ,
               VENDEDOR, NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF,
               DESC_ACRES, ENTRADA, DINHEIRO, CHEQUE, CARTAO, TICKET,
               TOTAL, VLR_PARC_LC, TIPO_VENDA, TROCO, NOME, SERIE, USUARIO,
               ORCAMENTO
              )
              VALUES
              (
              :CNPJ, :VENDA, :DATA, 'N', :HISTORICO, :PESSOA_FJ,
              :VENDEDOR, :NATUREZA, 'S', :FORMA_PAGTO, :NF,
              :DESC_ACRESC, :ENTRADA, 0,0,0,0,
              :TOTAL, :VLR_PARC_LC, 'Ven', 0, :NOME, 'SRV', 0,
              :CODIGO
              );
          END

          INSERT INTO FAT_VENDAS_ITENS
          (
            CNPJ, CODIGO, PRODUTO, SEQUENCIA, QUANTIDADE,
            PRC_UNITARIO, PRC_CUSTO, ICM, IPI, DESCONTO,
            PORC_DESC, UNIDADE, NOME_PRODUTO, SUBUNIDADE
          )
          VALUES
          (
            :CNPJ, :VENDA, :PRODUTO, 1, 1,
            :TOTAL, 0, 0, 0, 0,
            0, 'UN', :NOME_PRODUTO, 1
          );

          /* PARCELAMENTO */
          FOR SELECT VENCTO, PARCELA, VALOR, BOLETO
          FROM ofc_ordem_servico_parcelamento
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
          INTO :VENCTO, :PARCELA, :VALOR, :BOLETO
          DO BEGIN
             INSERT INTO fat_vendas_parcelamento
             ( CNPJ, CODIGO, VENCTO, PARCELA, VALOR, BOLETO )
             VALUES
             ( :CNPJ, :VENDA, :VENCTO, :PARCELA, :VALOR, :BOLETO );
          END
     END

     UPDATE OFC_ORDEM_SERVICO
     SET OFC_ORDEM_SERVICO.ENVIADA_CAIXA ='S',
     OFC_ORDEM_SERVICO.FECHADO = 'S'
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO;

     SUSPEND;
END
^

ALTER PROCEDURE FATURA_RECEBER (
    CNPJ CHAR(14),
    TIPO VARCHAR(20),
    CLIENTE INTEGER,
    HISTORICOBX VARCHAR(100),
    VENCIMENTO DATE,
    DATA_BAIXA DATE,
    DATA_INICIAL DATE,
    DATA_FINAL DATE,
    TOTAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    BANCO VARCHAR(3))
RETURNS (
    NUM_FATURA INTEGER)
AS
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE BOLETO VARCHAR(30);
DECLARE VARIABLE BOL INTEGER;
DECLARE VARIABLE DUPLICATA INTEGER;
Begin
     /* FATURA */
     FATURA = GEN_ID(FIN_FATURA_GE, 1);
     
     IF (BANCO <> '')
     THEN BEGIN
          SELECT BOLETO FROM FIN_BANCO
          WHERE CODIGO = :BANCO
          INTO :BOL ;
          
          IF (BOL IS NULL)
          THEN
              BOL = BOL + 1;
          
          UPDATE FIN_BANCO SET BOLETO = :BOL
          WHERE CODIGO = :BANCO ;

          BOLETO = CAST ( BOL AS VARCHAR(15));

          /* CRIA A FATURA */
          INSERT INTO FIN_FATURAS
          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO, BAIXADA, BANCO,
          BOLETO, ENVIADA, TIPO, ORIGEM )
          VALUES
          (:CNPJ, :FATURA, :CLIENTE, :DATA_BAIXA, :TOTAL, :JUROS, :DESCONTO, :VENCIMENTO, :HISTORICOBX, 'N',
          :BANCO, :BOLETO, 'N', 'CARTEIRA', 'AUT' );
     END
     ELSE BEGIN
          SELECT DUPLICATA FROM SIS_EMPRESAS
          WHERE CNPJ = :CNPJ
          INTO :DUPLICATA ;
          
          IF (DUPLICATA IS NULL)
          THEN
              DUPLICATA = DUPLICATA + 1;
          
          UPDATE SIS_EMPRESAS SET DUPLICATA = :DUPLICATA
          WHERE CNPJ = :CNPJ ;

          /* CRIA A FATURA */
          INSERT INTO FIN_FATURAS
          (CNPJ, CODIGO, PESSOA_FJ, DATA, VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
          BAIXADA, DUPLICATA, TIPO, ENVIADA, ORIGEM )
          VALUES
          (:CNPJ, :FATURA, :CLIENTE, :DATA_BAIXA, :TOTAL, :JUROS, :DESCONTO, :VENCIMENTO, :HISTORICOBX,
          'N', CAST( :DUPLICATA AS VARCHAR(30)), 'CARTEIRA', 'N', 'AUT' );
     END

     
     IF ( TIPO = 'Lancamento')
     THEN BEGIN
          /* CONTAS A RECEBER */
          UPDATE FIN_CONTAS_RECEBER SET FATURA = :FATURA
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
          SELECIONADO = 'S' AND DT_LANCTO >= :DATA_INICIAL AND
          DT_LANCTO <= :DATA_FINAL AND FATURA IS NULL ;
     END
     ELSE BEGIN
          /* CONTAS A RECEBER */
          UPDATE FIN_CONTAS_RECEBER SET FATURA = :FATURA
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE  AND
          SELECIONADO = 'S' AND DT_VENCTO >= :DATA_INICIAL AND
          DT_VENCTO <= :DATA_FINAL AND FATURA IS NULL;
     END
     
     NUM_FATURA = :FATURA ;
     
  suspend;
END
^

ALTER PROCEDURE FB_VER_FIN_CHEQUES (
    CNPJ VARCHAR(14))
RETURNS (
    INDICE VARCHAR(40),
    ID INTEGER,
    BANCO VARCHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO DATE,
    PRE_DATE DATE,
    VALOR NUMERIC(18,4),
    CONCILIADO VARCHAR(6),
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    DATA_CONCILIACAO DATE,
    JUROS NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO DATE,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO DATE,
    VEZES_DEVOLUCAO INTEGER,
    PROCESSADO CHAR(1),
    MARCADO CHAR(1),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(50),
    MOTIVO_DEVOLUCAO VARCHAR(50),
    PESSOA_FJ INTEGER,
    CMC7 VARCHAR(50),
    DATA_REAPRES DATE)
AS
DECLARE VARIABLE TESTE_CHAR VARCHAR(10);
begin
  /* fabiano 08/07/2005
  procedimento criado p/visualizar cheque p/conciliação, essa consulta era realizada anteriormente
  através de consulta simples no dataset, no entanto no refresh do dataset o campo id era utilizado como
  indexador embora ele não fosse único(não repetisse), isso fazia com q a grid desposicionasse no refresh */
  for select cast((coalesce(c.cnpj,'')||coalesce(c.banco,'')||coalesce(c.conta,'')||coalesce(c.cheque,''))as varchar(40)) indice, c.ID, c.BANCO, c.CONTA, c.CHEQUE, c.VENDA, c.EMISSAO, c.PRE_DATE,
      c.VALOR, c.CONCILIADO, c.HISTORICO, c.AGENCIA,
      c.DATA_CONCILIACAO, c.JUROS, c.TIPO, c.DATA_ACERTO, c.PLANILHA,
      c.DIGITO_AGENCIA, c.DIGITO_CHEQUE, c.DATA_DEVOLUCAO,
      c.VEZES_DEVOLUCAO, c.PROCESSADO,c.MARCADO,
      case
        upper(p.nome_razao) when 'CONSUMIDOR' then c.nome
      else
        p.nome_razao
      end,
      p.fone, p.fax, p.celular, p.cpf_cgc, p.rg_ie,
      cl.local_trabalho, cl.fone_trabalho, d.nome Motivo_Devolucao, c.pessoa_fj, c.cmc7, c.data_reapres
      from FIN_CHEQUES c
      inner join glo_pessoas_fj p on (p.codigo = c.pessoa_fj and p.cnpj = c.cnpj)
      inner join glo_clientes cl on (cl.pessoa_fj = p.codigo and cl.cnpj = c.cnpj)
      left join fin_motivo_devolucao d on (d.codigo = c.motivo_devolucao and d.cnpj = c.cnpj)
      where c.cnpj = :cnpj
      into :indice, :id, :banco, :conta, :cheque, :venda, :emissao, :pre_date, :valor, :conciliado, :historico,
           :agencia, :data_conciliacao, :juros, :tipo, :data_acerto, :planilha,:digito_agencia, :digito_cheque,
           :data_devolucao, :vezes_devolucao, :processado, :marcado, :nome, :fone, :fax, :celular, :cpf_cgc,
           :rg_ie, :local_trabalho, :fone_trabalho, :motivo_devolucao, :pessoa_fj, :cmc7, :data_reapres
  do
  begin
      suspend;
  end
END
^

ALTER PROCEDURE FECHA_ALTPRECO (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
declare variable PRODUTO        VARCHAR(15);
declare variable VALOR          NUMERIC(15,4);
declare variable CUSTO_LISTA    NUMERIC(15,4);
declare variable CUSTO_COLOCADO NUMERIC(15,4);
declare variable DATA           DATE;
begin
     SELECT DATA FROM EST_ALTERAPRECOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO :DATA ;

     /*CAPTURA OS VALORES QUE DEVERAO ENTRAR NO UPDATE*/
     FOR SELECT
         PRODUTO, VALOR, CUSTO_LISTA, CUSTO_COLOCADO
     FROM
         EST_ALTERAPRECOS_PRODUTOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO  :PRODUTO, :VALOR, :CUSTO_LISTA, :CUSTO_COLOCADO
     DO BEGIN
          /*  */
          UPDATE EST_PRODUTOS SET PRC_VENDA = :VALOR, DT_ULT_ATU_PRECO = :DATA,
          CUSTO_AQUISICAO = :CUSTO_LISTA, PRC_REPOS = :CUSTO_COLOCADO
          WHERE CODIGO = :PRODUTO AND CNPJ = :CNPJ;
     END
     
     UPDATE EST_ALTERAPRECOS SET FECHADA = 'S'
     WHERE CODIGO = :COD AND CNPJ = :CNPJ ;
  suspend;
END
^

ALTER PROCEDURE FECHA_ALTPRECO_GRUPO (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE VALOR NUMERIC(15,4);
DECLARE VARIABLE DATA DATE;
begin
     SELECT DATA FROM EST_ALTERAPRECOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO :DATA ;
     
     /*CAPTURA OS VALORES QUE DEVERAO ENTRAR NO UPDATE*/
     FOR SELECT
         GRUPO, PORCENTAGEM
     FROM
         EST_ALTERAPRECOS_GRUPO_PRODUTOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO  :GRUPO, :VALOR
     DO BEGIN
          /*     Arredondamento
          TEMP = (CAST((ENTRA*100) AS INTEGER));
          SAI = TEMP/100.00;*/
          /*esse é o entra ((PRC_VENDA * :VALOR)/100)*/
          UPDATE EST_PRODUTOS SET PRC_VENDA = PRC_VENDA + cast((((PRC_VENDA * :VALOR)/100)*100)as integer)/100.00,
          DT_ULT_ATU_PRECO = :DATA
          WHERE GRUPO = :GRUPO AND CNPJ = :CNPJ ;
     END
     
     UPDATE EST_ALTERAPRECOS_GRUPO SET FECHADA = 'S'
     WHERE CODIGO = :COD AND CNPJ = :CNPJ ;
  suspend;
END
^

ALTER PROCEDURE FECHA_ALTPRECO_MARCA (
    CNPJ VARCHAR(14),
    COD INTEGER)
AS
DECLARE VARIABLE MARCA INTEGER;
DECLARE VARIABLE VALOR NUMERIC(15,4);
DECLARE VARIABLE AUX INTEGER;
DECLARE VARIABLE DATA DATE;
begin
     SELECT DATA FROM EST_ALTERAPRECOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO :DATA ;

     /*CAPTURA OS VALORES QUE DEVERAO ENTRAR NO UPDATE*/
     FOR SELECT
         MARCA, PORCENTAGEM
     FROM
         EST_ALTERAPRECOS_MARCA_PRODUTOS
     WHERE CODIGO = :COD AND CNPJ = :CNPJ
     INTO  :MARCA, :VALOR
     DO BEGIN
          /*
           Arredondamento
          TEMP = (CAST((ENTRA*100) AS INTEGER));
          SAI = TEMP/100.00;
          esse é o entra ((PRC_VENDA * :VALOR)/100)*/

          UPDATE EST_PRODUTOS SET PRC_VENDA = PRC_VENDA + (cast(((PRC_VENDA * :VALOR)/100)*100 as integer)/100.00),
          DT_ULT_ATU_PRECO = :DATA
          WHERE MARCA = :MARCA AND CNPJ = :CNPJ  ;
     END
     
     UPDATE EST_ALTERAPRECOS_MARCA SET FECHADA = 'S'
     WHERE CODIGO = :COD AND CNPJ = :CNPJ ;
  suspend;
END
^

ALTER PROCEDURE FECHA_CAIXA_RESUMO (
    CNPJ CHAR(14),
    DATA DATE)
AS
DECLARE VARIABLE CAIXAS NUMERIC(18,4);
DECLARE VARIABLE ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE CHEQUE_DEVOLVIDO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE_PRAZO_ENT NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE_VISTA NUMERIC(18,4);
DECLARE VARIABLE SAIDAS NUMERIC(18,4);
DECLARE VARIABLE CHEQUE_PRAZO_SAI NUMERIC(18,4);
DECLARE VARIABLE MOEDAS NUMERIC(18,4);
DECLARE VARIABLE DOCUMENTO VARCHAR(15);
DECLARE VARIABLE RESUMO_CAIXA INTEGER;
DECLARE VARIABLE RESUMO_CHEQUE_PRAZO INTEGER;
DECLARE VARIABLE RESUMO_CHEQUE_DEVOLVIDO INTEGER;
DECLARE VARIABLE RESUMO_DINHEIRO INTEGER;
DECLARE VARIABLE RESUMO_CHEQUE_VISTA INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
BEGIN
     FOR SELECT CNPJ
     FROM SIS_EMPRESAS
     INTO :CNPJ
     DO BEGIN
        SELECT
          CAIXAS            ,
          ENTRADAS          ,
          CHEQUE_DEVOLVIDO  ,
          CHEQUE_PRAZO_ENT  ,
          DINHEIRO          ,
          CHEQUE_VISTA      ,
          SAIDAS            ,
          CHEQUE_PRAZO_SAI  ,
          MOEDAS
        FROM FAT_CAIXAS_RESUMO
        WHERE (( CNPJ = :CNPJ )  AND ( DATA = :DATA ))
        INTO
           :CAIXAS            ,
           :ENTRADAS          ,
           :CHEQUE_DEVOLVIDO  ,
           :CHEQUE_PRAZO_ENT  ,
           :DINHEIRO          ,
           :CHEQUE_VISTA      ,
           :SAIDAS            ,
           :CHEQUE_PRAZO_SAI  ,
           :MOEDAS ;

        /* PLANILHA */
        PLANILHA = GEN_ID(FIN_PLANILHA_GE, 1);


        EXECUTE PROCEDURE FECHA_CAIXA_RESUMO_MOVTOS
        ( :CNPJ, :DATA, :RESUMO_CAIXA, :PLANILHA );

        UPDATE FAT_CAIXAS_RESUMO
        SET FECHADO = 'S', PLANILHA = :PLANILHA
        WHERE CNPJ = :CNPJ AND DATA = :DATA ;
     END
END
^

ALTER PROCEDURE FECHA_CAIXA_RESUMO_MOVTOS (
    CNPJ CHAR(14),
    DATA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    PLANILHA INTEGER)
AS
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE TIPO CHAR(1);
DECLARE VARIABLE TIPOC CHAR(1);
DECLARE VARIABLE CONTRA_PARTIDA INTEGER;
DECLARE VARIABLE NOME_CONTRAPARTIDA VARCHAR(50);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
BEGIN
     FOR SELECT
         DOCUMENTO, HISTORICO, VALOR, TIPO, CONTRA_PARTIDA,
         NOME_CONTRAPARTIDA, PESSOA_FJ,
         NOME
     FROM FAT_CAIXAS_RESUMO_MOVTOS
     WHERE (( CNPJ = :CNPJ ) AND ( DATA = :DATA ) AND ( CONTRA_PARTIDA > 0 ))
     INTO
      :DOCUMENTO, :HISTORICO, :VALOR, :TIPO, :CONTRA_PARTIDA,
      :NOME_CONTRAPARTIDA, :PESSOA_FJ, :NOME
     DO BEGIN
        IF ( :TIPO = 'C' )
        THEN BEGIN
             TIPOC = 'D';
        END
        ELSE BEGIN
             TIPOC = 'C';
        END

        EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
         (
         :CNPJ,
         :DATA,
         :TIPO,
         :DOCUMENTO,
         :HISTORICO,
         :VALOR,
         :CONTRA_PARTIDA,
         'CXR',
         :PLANILHA,
         NULL,
         NULL,
         'A',
         NULL,
         NULL ) ;

         /* LANCA NO CAIXA */
         EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
         (
         :CNPJ,
         :DATA,
         :TIPOC,
         :DOCUMENTO,
         :HISTORICO,
         :VALOR,
         :CONTA_CAIXA,
         'CXR',
         :PLANILHA,
         NULL,
         NULL,
         'A',
         NULL,
         NULL ) ;

     END
END
^

ALTER PROCEDURE FECHA_CONTAGEM (
    CNPJ VARCHAR(15),
    COD INTEGER)
AS
DECLARE VARIABLE QUANTIDADE NUMERIC(15,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE TIPO VARCHAR(3);
DECLARE VARIABLE GRADE CHAR(3);
DECLARE VARIABLE NUMERO VARCHAR(6);
begin
     update est_contagem set fechada = 'S'
     where cnpj = :cnpj and codigo = :cod ;
     
     suspend;
END
^

ALTER PROCEDURE FECHA_ENTRADA_MANUAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE MARGEM NUMERIC(18,4);
DECLARE VARIABLE VLR_COMPRA NUMERIC(18,4);
DECLARE VARIABLE VLR_VENDA NUMERIC(18,4);
DECLARE VARIABLE QUANT_ANT NUMERIC(18,4);
DECLARE VARIABLE VLR_VENDA_ANTERIOR NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE ATUALIZA CHAR(1);
DECLARE VARIABLE FORNECEDOR INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE DATAKDX DATE;
DECLARE VARIABLE NDOCTO VARCHAR(10);
begin
     select coalesce(altera_preco_venda_ent,'N')
     from sis_empresas
     where cnpj = :cnpj
     into :atualiza ;

     /*Kaiser me garantiu que o preço de reposição do produto era o vlr-compra
     do produto*/
     datakdx = cast ('today' as date);
     ano = extract (year from :datakdx);
     mes = extract (month from :datakdx);
     ndocto = cast (:codigo as varchar(20));

     FOR SELECT QUANTIDADE, PRODUTO, VLR_VENDA, DATA, VLR_VENDA_ANTERIOR, FORNECEDOR, margem_lucro, VLR_COMPRA
     FROM EST_ENTRADAS_MANUAL ENT
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :QUANTIDADE, :PRODUTO, :VLR_VENDA, :DATA, :VLR_VENDA_ANTERIOR, :fornecedor, :margem, :vlr_compra
     DO BEGIN
        IF ( ATUALIZA = 'S' ) THEN
        begin
            update est_produtos prd
            set prd.prc_venda = :vlr_venda
            where cnpj = :cnpj and codigo = :produto;
        end

        select prd.qtdade_2 from est_produtos prd
        where prd.cnpj = :cnpj and prd.codigo = :produto
        into :quant_ant;

        /*atualizando kardex*/
        insert into est_kardex (cnpj, produto, ndocto,
                               dt_movto, mes, ano,
                               origem, tipo_es, pessoa_fj,
                               qtdade_ant, qtdade, prc_unit,
                               descontos)
        values                 (:cnpj, :produto, :ndocto,
                               :data, :mes, :ano,
                               'ENT-M', 'E', :fornecedor,
                               :quant_ant, :quantidade, :vlr_compra,0);


        update est_produtos prd
        set prd.qtdade_2 = prd.qtdade_2 + :quantidade,
        prd.dt_ult_compra = :data, prd.qt_ult_compra = :quantidade,
        prd.ultimo_fornecedor = :fornecedor,prd.margem_bruta = :margem,
        prd.prc_repos = :vlr_compra where cnpj = :cnpj and codigo = :produto;


        select * from round2(:vlr_venda) into :vlr_venda;
        select * from round2(:vlr_venda_anterior) into :vlr_venda_anterior;


        if (vlr_venda <> vlr_venda_anterior) then
        begin
             update est_produtos
             set atualizar = 'S'
             where cnpj = :cnpj and codigo = :produto;
        end
     end

     update est_entradas_manual
     set fechada = 'S'
     where cnpj = :cnpj and codigo = :codigo;
END
^

ALTER PROCEDURE FECHAMENTO_DIARIO (
    CNPJ CHAR(14),
    DATA DATE)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE LEITURAS NUMERIC(18,4);
DECLARE VARIABLE ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE INICIAL NUMERIC(18,4);
DECLARE VARIABLE VENDAS NUMERIC(18,4);
DECLARE VARIABLE CONTAGENS NUMERIC(18,4);
DECLARE VARIABLE GARANTIAS_ENT NUMERIC(18,4);
DECLARE VARIABLE GARANTIAS_SAI NUMERIC(18,4);
DECLARE VARIABLE TROCAS_ENT NUMERIC(18,4);
DECLARE VARIABLE TROCAS_SAI NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO_MED NUMERIC(18,4);
DECLARE VARIABLE CUSTO NUMERIC(18,4);
DECLARE VARIABLE BOMBA INTEGER;
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUB_GRUPO INTEGER;
DECLARE VARIABLE TIPO_CONTAGEM CHAR(3);
DECLARE VARIABLE TIPO_CUSTO CHAR(3);
BEGIN
  SELECT TIPO_CONTAGEM FROM SIS_EMPRESAS
  WHERE CNPJ = :CNPJ
  INTO :TIPO_CONTAGEM ;


  FOR SELECT CODIGO, NOME, CUSTO_AQUISICAO, GRUPO, SUBGRUPO, PRC_CUSTO_MED
  FROM EST_PRODUTOS
  WHERE CNPJ = :CNPJ
  INTO :PRODUTO, :NOME, :CUSTO, :GRUPO, :SUB_GRUPO, :PRC_CUSTO_MED
  DO BEGIN

     /* SALDO INICIAL */
     SELECT POSICAO FROM EST_POSICAO_DIARIA
     WHERE CNPJ = :CNPJ AND DATA = :DATA - 1 AND
     PRODUTO = :PRODUTO
     INTO :INICIAL ;

     IF ( INICIAL IS NULL )
     THEN BEGIN
          INICIAL = 0;
     END

     IF ( BOMBA IS NULL )
     THEN BEGIN
          BOMBA = 0;
     END


      /* VENDAS */
      SELECT SUM(QUANTIDADE) FROM VENDAS_DIARIA
      ( :CNPJ, :DATA, :PRODUTO )
      INTO :VENDAS ;
  
      IF ( VENDAS IS NULL )
      THEN BEGIN
           VENDAS = 0;
      END
  
      LEITURAS = 0;


     /* ENTRADAS DIARIA */
     SELECT SUM(QUANTIDADE) FROM ENTRADAS_DIARIA
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :ENTRADAS ;

     IF ( ENTRADAS IS NULL )
     THEN BEGIN
          ENTRADAS = 0;
     END

     /* TROCAS DIARIA ENTRADA */
     SELECT SUM(QUANTIDADE) FROM TROCAS_DIARIA_ENT
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :TROCAS_ENT ;

     IF ( TROCAS_ENT IS NULL )
     THEN BEGIN
          TROCAS_ENT = 0;
     END

     /* TROCAS DIARIA SAIDA */
     SELECT SUM(QUANTIDADE) FROM TROCAS_DIARIA_SAI
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :TROCAS_SAI ;

     IF ( TROCAS_SAI IS NULL )
     THEN BEGIN
          TROCAS_SAI = 0;
     END

     /* GARANTIAS DIARIA ENTRADA */
     SELECT SUM(QUANTIDADE) FROM GARANTIAS_DIARIA_ENT
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :GARANTIAS_ENT ;

     IF ( GARANTIAS_ENT IS NULL )
     THEN BEGIN
          GARANTIAS_ENT = 0;
     END

     /* GARANTIAS DIARIA SAIDA */
     SELECT SUM(QUANTIDADE) FROM GARANTIAS_DIARIA_SAI
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :GARANTIAS_SAI ;

     IF ( GARANTIAS_SAI IS NULL )
     THEN BEGIN
          GARANTIAS_SAI = 0;
     END

     /* CONTAGENS */
     SELECT SUM(QUANTIDADE) FROM CONTAGEM_DIARIA
     ( :CNPJ, :DATA, :PRODUTO )
     INTO :CONTAGENS ;

     IF ( CONTAGENS IS NULL )
     THEN BEGIN
          CONTAGENS = 0;
     END

     IF( TIPO_CONTAGEM <> 'Con' )/* INVENTARIO */
     THEN BEGIN
          CONTAGENS = 0;
     END

     QUANTIDADE = :INICIAL - :LEITURAS + :ENTRADAS - :VENDAS + :CONTAGENS +
     :TROCAS_ENT - :TROCAS_SAI + :GARANTIAS_ENT - :GARANTIAS_SAI;

     /* INSERINDO NA TABELA DE FECHAMENTO DIARIO */
     INSERT INTO EST_POSICAO_DIARIA
     (
      INICIAL   ,
      CNPJ      ,
      DATA      ,
      PRODUTO   ,
      NOME      ,
      LEITURA   ,
      ENTRADA   ,
      VENDA     ,
      CONTAGEM  ,
      POSICAO   ,
      CUSTO     ,
      GRUPO     ,
      SUB_GRUPO ,
      TROCAS_SAI ,
      TROCAS_ENT ,
      GARANTIAS_ENT,
      GARANTIAS_SAI,
      TURNO
     )
     VALUES
     (
      :INICIAL,
      :CNPJ,
      :DATA,
      :PRODUTO,
      :NOME,
      :LEITURAS,
      :ENTRADAS,
      :VENDAS,
      0,
      :QUANTIDADE,
      :CUSTO,
      :GRUPO,
      :SUB_GRUPO,
      :TROCAS_SAI ,
      :TROCAS_ENT ,
      :GARANTIAS_ENT,
      :GARANTIAS_SAI,
      1
     );
  END
END
^

ALTER PROCEDURE FECHAMENTO_DIARIO_INVERSO (
    CNPJ CHAR(14),
    DATA DATE)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE LEITURAS NUMERIC(18,4);
DECLARE VARIABLE ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE INICIAL NUMERIC(18,4);
DECLARE VARIABLE VENDAS NUMERIC(18,4);
DECLARE VARIABLE CONTAGENS NUMERIC(18,4);
DECLARE VARIABLE CUSTO NUMERIC(18,4);
DECLARE VARIABLE BOMBA INTEGER;
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUB_GRUPO INTEGER;
DECLARE VARIABLE TIPO_CONTAGEM CHAR(3);
DECLARE VARIABLE TURNO INTEGER;
BEGIN
  SELECT TIPO_CONTAGEM FROM SIS_EMPRESAS
  WHERE CNPJ = :CNPJ
  INTO :TIPO_CONTAGEM ;

  WHILE ( DATA >= '03/31/2004' ) DO
  BEGIN
       FOR SELECT CODIGO, NOME, CUSTO_AQUISICAO, GRUPO, SUBGRUPO, QTDADE_2
       FROM EST_PRODUTOS
       WHERE CNPJ = :CNPJ
       INTO :PRODUTO, :NOME, :CUSTO, :GRUPO, :SUB_GRUPO, :INICIAL
       DO BEGIN

          IF ( INICIAL IS NULL )
          THEN BEGIN
               INICIAL = 0;
          END



               /* VENDAS */
               SELECT SUM(QUANTIDADE) FROM VENDAS_DIARIA
               ( :CNPJ, :DATA, :PRODUTO )
               INTO :VENDAS ;

               IF ( VENDAS IS NULL )
               THEN BEGIN
                    VENDAS = 0;
               END

               LEITURAS = 0;


          /* ENTRADAS DIARIA */
          SELECT SUM(QUANTIDADE) FROM ENTRADAS_DIARIA
          ( :CNPJ, :DATA, :PRODUTO )
          INTO :ENTRADAS ;

          IF ( ENTRADAS IS NULL )
          THEN BEGIN
               ENTRADAS = 0;
          END

          /* CONTAGENS */
          SELECT SUM(QUANTIDADE) FROM CONTAGEM_DIARIA
          ( :CNPJ, :DATA, :PRODUTO )
          INTO :CONTAGENS ;

          IF ( CONTAGENS IS NULL )
          THEN BEGIN
               CONTAGENS = 0;
          END

          IF(TIPO_CONTAGEM <> 'Con' )/* INVENTARIO */
          THEN BEGIN
               CONTAGENS = 0;
          END

          QUANTIDADE = :INICIAL + :LEITURAS - :ENTRADAS + :VENDAS - :CONTAGENS;

          /* INSERINDO NA TABELA DE FECHAMENTO DIARIO */
          INSERT INTO EST_POSICAO_DIARIA
          (
          INICIAL   ,
          CNPJ      ,
          DATA      ,
          PRODUTO   ,
          NOME      ,
          LEITURA   ,
          ENTRADA   ,
          VENDA     ,
          CONTAGEM  ,
          POSICAO   ,
          CUSTO     ,
          GRUPO     ,
          SUB_GRUPO ,
          TURNO
          )
          VALUES
          (
          :INICIAL,
          :CNPJ,
          :DATA,
          :PRODUTO,
          :NOME,
          :LEITURAS,
          :ENTRADAS,
          :VENDAS,
          0,
          :QUANTIDADE,
          :CUSTO,
          :GRUPO,
          :SUB_GRUPO,
          1
          );
       END

       DATA = DATA - 1;
  END
END
^

ALTER PROCEDURE FECHAMENTO_MES (
    CNPJ CHAR(14),
    DATA DATE,
    DATAINICIAL DATE,
    DATAFINAL DATE,
    MES SMALLINT,
    ANO SMALLINT)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE LEITURAS NUMERIC(18,4);
DECLARE VARIABLE ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE INICIAL NUMERIC(18,4);
DECLARE VARIABLE VENDAS NUMERIC(18,4);
DECLARE VARIABLE CONTAGENS NUMERIC(18,4);
DECLARE VARIABLE BOMBA INTEGER;
DECLARE VARIABLE TIPO_CONTAGEM CHAR(3);
BEGIN
  SELECT TIPO_CONTAGEM FROM SIS_EMPRESAS
  WHERE CNPJ = :CNPJ
  INTO :TIPO_CONTAGEM ;


   /* VENDAS */
   FOR SELECT SUM(QUANTIDADE), PRODUTO FROM VENDAS_MENSAIS
   ( :CNPJ, :DATAINICIAL, :DATAFINAL )
   GROUP BY PRODUTO
   INTO :VENDAS, :PRODUTO DO
   BEGIN
        IF ( :VENDAS IS NULL )
        THEN BEGIN
             VENDAS = 0;
        END
  
        /* INSERINDO OS VALORES NO MOVIMENTO */
        EXECUTE PROCEDURE INSERE_EST_FECHAMENTO_MES
        ( :CNPJ, :PRODUTO, :DATA, :MES, :ANO, :INICIAL,
          0, :VENDAS, 0, 0, 0, 'SAI'
        );
   END
  
   LEITURAS = 0;


  /* ENTRADAS MENSAIS */
  FOR SELECT SUM(QUANTIDADE), PRODUTO FROM ENTRADAS_MENSAIS
  ( :CNPJ, :DATAINICIAL, :DATAFINAL )
  GROUP BY PRODUTO
  INTO :ENTRADAS, :PRODUTO
  DO BEGIN
     IF ( ENTRADAS IS NULL )
     THEN BEGIN
          ENTRADAS = 0;
     END

     /* INSERINDO OS VALORES NO MOVIMENTO */
     EXECUTE PROCEDURE INSERE_EST_FECHAMENTO_MES
     ( :CNPJ, :PRODUTO, :DATA, :MES, :ANO, :INICIAL,
     :ENTRADAS, 0, 0, 0, 0, 'ENT'
     );
  END

  /* CONTAGENS */
  FOR SELECT SUM(QUANTIDADE), PRODUTO
  FROM CONTAGEM_MENSAL
  ( :CNPJ, :DATAINICIAL, :DATAFINAL )
  GROUP BY PRODUTO
  INTO :CONTAGENS, :PRODUTO
  DO BEGIN
     IF ( CONTAGENS IS NULL )
     THEN BEGIN
          CONTAGENS = 0;
     END

     IF( TIPO_CONTAGEM <> 'Con' ) /* INVENTARIO */
     THEN BEGIN
          CONTAGENS = 0;
     END

     /* INSERINDO OS VALORES NO MOVIMENTO */
     EXECUTE PROCEDURE INSERE_EST_FECHAMENTO_MES
     ( :CNPJ, :PRODUTO, :DATA, :MES, :ANO, :INICIAL,
     :CONTAGENS, 0, 0, 0, 0, 'ENT'
     );
  END
END
^

ALTER PROCEDURE FECHAR_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER,
    SALDO NUMERIC(18,4),
    PLANILHA INTEGER,
    VISTA NUMERIC(18,4),
    PRAZO NUMERIC(18,4))
RETURNS (
    ACEITE INTEGER)
AS
DECLARE VARIABLE CONTA_VISTA INTEGER;
DECLARE VARIABLE CONTA_PRAZO INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
BEGIN
     SELECT COUNT(FECHADO) FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     DATA < :DATA AND
     TURNO = :TURNO AND
     FECHADO = 'N'
     INTO :ACEITE ;
     
     
     IF (( ACEITE IS NULL ) or ( ACEITE = 0 ))THEN
     BEGIN
           UPDATE FAT_CAIXAS
           SET FECHADO = 'S', SALDO = :SALDO, SALDO_ANTERIOR = :SALDO
           WHERE CNPJ = :CNPJ AND
           USUARIO = :USUARIO AND
           CONTA = :CONTA AND
           DATA = :DATA AND
           TURNO = :TURNO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE FECHAR_CAIXA_GERAL (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER,
    SALDO NUMERIC(18,4))
RETURNS (
    ACEITE INTEGER)
AS
BEGIN
     SELECT COUNT(FECHADO) FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     DATA < :DATA AND
     TURNO = :TURNO AND
     FECHADO = 'N'
     INTO :ACEITE ;

     IF (( ACEITE IS NULL ) or ( ACEITE = 0 ))
     THEN BEGIN
           UPDATE FAT_CAIXAS
           SET FECHADO = 'S', TROCO = :SALDO
           WHERE CNPJ = :CNPJ AND
           USUARIO = :USUARIO AND
           CONTA = :CONTA AND
           DATA = :DATA AND
           TURNO = :TURNO ;

           ACEITE = 1 ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE FIN_BAIXAS_RECEBER_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DT_BAIXA TIMESTAMP,
    VLR_BAIXA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE AUX INTEGER;
BEGIN
  /* DADOS DA BAIXA */
  ANO = EXTRACT ( YEAR FROM :DT_EMISSAO );

  /* CODIGO DA BAIXA */
  SELECT CODIGO FROM GERAR_CODIGO ('CONTAS_RECEBER',1)
  into :CODIGO;

  SELECT CODIGO FROM GLO_PESSOAS_FJ
  WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
  INTO :AUX ;

  IF ( AUX IS NULL )
  THEN BEGIN
       DOCTO = :DOCTO || '/' || CAST(PESSOA_FJ AS VARCHAR(10));
       PESSOA_FJ = 1;
  END

  INSERT INTO FIN_BAIXAS_RECEBER (
    CNPJ,
    CODIGO,
    ANO,
    PESSOA_FJ,
    DT_EMISSAO,
    DT_VENCTO,
    DT_LANCTO,
    DOCTO,
    PARCELA,
    HISTORICO,
    VALOR,
    VLR_PARCIAL,
    JUROS_REC,


    CODIGO_VN,
    ANO_VN,
    AVISO,
    DT_AVISO,
    FATURA,
    NUMBOLETO,
    NOME,
    NUMDUPLICATA,
    COBRADOR,
    CODIGO_CR,
    ANO_CR,
    USUARIO,
    PLANILHA,
    TAXA_JUROS,
    TIPO_JUROS,
    DT_BAIXA,
    VLR_BAIXA,
    JUROS,
    DESCONTOS,
    HISTORICO_BX,
    BOLETO,
    ORIGEM
    )
  VALUES (
    :CNPJ,
    :CODIGO,
    :ANO,
    :PESSOA_FJ,
    :DT_EMISSAO,
    :DT_VENCTO,
    :DT_LANCTO,
    :DOCTO,
    :PARCELA,
    :HISTORICO,
    :VALOR,
    0,
    0,


    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    :CODIGO,
    :ANO,
    1,
    1,
    0,
    'S',
    :DT_BAIXA,
    :VLR_BAIXA,
    :JUROS,
    :DESCONTOS,
    '_',
    'N',
    'A'
    );
END
^

ALTER PROCEDURE FIN_CONTAS_PAGAR_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    ORIGEM CHAR(3),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX INTEGER;
BEGIN

  IF ( NOT EXISTS
     (
       SELECT CODIGO FROM FIN_CENTRO_CUSTO
       WHERE CNPJ = :CNPJ AND CODIGO = :CENTRO_CUSTO
     )
     )
  THEN BEGIN
       INSERT INTO
       FIN_CENTRO_CUSTO
       ( CNPJ, CODIGO, NOME )
       VALUES
       ( :CNPJ, :CENTRO_CUSTO, CAST (:CENTRO_CUSTO  AS VARCHAR(50))) ;
  END
  
  /* CODIGO DA BAIXA */
  SELECT CODIGO FROM GERAR_CODIGO ('CONTAS_PAGAR',1)
  into :CODIGO;

  SELECT CODIGO FROM GLO_PESSOAS_FJ
  WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
  INTO :AUX ;

  IF ( AUX IS NULL )
  THEN BEGIN
       DOCTO = :DOCTO || '/' || CAST(PESSOA_FJ AS VARCHAR(10));
       PESSOA_FJ = 1;
  END


  INSERT INTO FIN_CONTAS_PAGAR (
    CNPJ,
    CODIGO,
    PESSOA_FJ,
    DT_EMISSAO,
    DT_VENCTO,
    DT_LANCTO,
    DOCTO,
    PARCELA,
    HISTORICO,
    VALOR,
    VLR_PARCIAL,
    JUROS_PAG,
    DESCONTOS,
    BOLETO,
    ORIGEM,
    SELECIONADO,
    CENTRO_CUSTO)
  VALUES (
    :CNPJ,
    :CODIGO,
    :PESSOA_FJ,
    :DT_EMISSAO,
    :DT_VENCTO,
    :DT_LANCTO,
    :DOCTO,
    :PARCELA,
    :HISTORICO,
    :VALOR,
    :VLR_PARCIAL,
    :JUROS_PAG,
    :DESCONTOS,
    'N',
    :ORIGEM,
    :SELECIONADO,
    :CENTRO_CUSTO);
END
^

ALTER PROCEDURE FIN_CONTAS_PAGAS_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    ORIGEM CHAR(3),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    DATA_BAIXA DATE)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX INTEGER;
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
BEGIN

  /* CODIGO DA BAIXA */
  SELECT CODIGO FROM GERAR_CODIGO ('CONTAS_PAGAR',1)
  into :CODIGO;

  /* CODIGO DA BAIXA */
  SELECT CODIGO FROM GERAR_CODIGO ('BAIXA_PAGAR',1)
  into :CODBX;

  SELECT CODIGO FROM GERAR_CODIGO ('PLANILHA',1)
  into :PLANILHA;

  SELECT CODIGO FROM GLO_PESSOAS_FJ
  WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
  INTO :AUX ;

  IF ( AUX IS NULL )
  THEN BEGIN
       DOCTO = :DOCTO || '/' || CAST(PESSOA_FJ AS VARCHAR(10));
       PESSOA_FJ = 1;
  END

  INSERT INTO FIN_BAIXAS_PAGAR (
    CNPJ,
    CODIGO,
    ANO,
    DT_BAIXA,
    HISTORICO_BX,
    VLR_BAIXA,
    CODIGO_PG,
    ANO_PG,
    PESSOA_FJ,
    DT_EMISSAO,
    DT_VENCTO,
    DT_LANCTO,
    DOCTO,
    PARCELA,
    HISTORICO,
    VALOR,
    VLR_PARCIAL,
    JUROS_PAG,
    DESCONTOS,
    BOLETO,
    ORIGEM,
    CENTRO_CUSTO,
    PLANILHA)
  VALUES (
    :CNPJ,
    :CODBX,
    2003,
    :DATA_BAIXA,
    'BAIXA',
    :VALOR,
    :CODIGO,
    2003,
    :PESSOA_FJ,
    :DT_EMISSAO,
    :DT_VENCTO,
    :DT_LANCTO,
    :DOCTO,
    :PARCELA,
    :HISTORICO,
    :VALOR,
    :VLR_PARCIAL,
    :JUROS_PAG,
    :DESCONTOS,
    'N',
    :ORIGEM,
    :CENTRO_CUSTO,
    :PLANILHA);
END
^

ALTER PROCEDURE FIN_CONTAS_RECEBER_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA VARCHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    TIPO_DOCTO CHAR(3))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE AUX INTEGER;

BEGIN
  /* DADOS DA BAIXA */
  ANO = EXTRACT ( YEAR FROM :DT_EMISSAO );

  /* CODIGO DA BAIXA */
  SELECT CODIGO FROM GERAR_CODIGO ('CONTAS_RECEBER',1)
  into :CODIGO;

  SELECT CODIGO FROM GLO_PESSOAS_FJ
  WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
  INTO :AUX ;

  IF ( AUX IS NULL )
  THEN BEGIN
       DOCTO = :DOCTO || '/' || CAST(PESSOA_FJ AS VARCHAR(10));
       PESSOA_FJ = 1;
  END

  INSERT INTO FIN_CONTAS_RECEBER (
    CNPJ,
    CODIGO,
    ANO,
    PESSOA_FJ,
    DT_EMISSAO,
    DT_VENCTO,
    DT_LANCTO,
    DOCTO,
    PARCELA,
    HISTORICO,
    VALOR,
    VLR_PARCIAL,
    JUROS_REC,
    DESCONTOS,
    BOLETO,
    ORIGEM,
    CODIGO_VN,
    ANO_VN,
    AVISO,
    DT_AVISO,
    SELECIONADO,
    FATURA,
    TIPO_DOCTO,
    NUMBOLETO,
    NOME,
    NUMDUPLICATA,
    MOEDA1,
    MOEDA2,
    PARCIAL,
    CODIGO_TRC,
    JUROS_PARCIAL,
    DATA_ULT_BAIXA,
    COBRADOR)
  VALUES (
    :CNPJ,
    :CODIGO,
    :ANO,
    :PESSOA_FJ,
    :DT_EMISSAO,
    :DT_VENCTO,
    :DT_LANCTO,
    :DOCTO,
    :PARCELA,
    :HISTORICO,
    :VALOR,
    0,
    0,
    0,
    'N',
    'MAN',
    null,
    null,
    null,
    null,
    'N',
    null,
    :TIPO_DOCTO,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null);
END
^

ALTER PROCEDURE FUTUROS (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1))
AS
begin
     FOR SELECT DATA, COD_DOC, DOCUMENTO, substring(HISTORICO from 1 for 80), VALOR, TIPO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND CONTA = :CONTA AND DATA > :D
     AND DATA_CONCILIACAO IS NULL
     ORDER BY DATA, COD_DOC, DOCUMENTO
     INTO :DATA, :COD_DOC, :DOCUMENTO, :HISTORICO, :VALOR, :TIPO
     DO BEGIN
        suspend;
     END
END
^

ALTER PROCEDURE GARANTIAS_DIARIA_ENT (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            SUM(QUANTIDADE)
        FROM FAT_GARANTIAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND TIPO = 'E' AND
        PRODUTO = :PRODUTO
        INTO  :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE GARANTIAS_DIARIA_SAI (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            SUM(QUANTIDADE)
        FROM FAT_GARANTIAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND TIPO = 'S' AND
        PRODUTO = :PRODUTO
        INTO  :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE GERAR_CODIGO (
    TABELA VARCHAR(50),
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN

  /* GLOBAIS */
  If (TABELA = 'ATIVIDADES') Then
     CODIGO = GEN_ID(GLO_ATIVIDADES_GE, :TAG);
  If (TABELA = 'ACERTO') Then
     CODIGO = GEN_ID(GEN_ACT_ACERTOCONTA_ID, :TAG);
  If (TABELA = 'CONTRATOS') Then
     CODIGO = GEN_ID(GLO_CONTRATOS_GE, :TAG);
  If (TABELA = 'BAIRROS') Then
     CODIGO = GEN_ID(GLO_BAIRROS_GE, :TAG);
  If (TABELA = 'CIDADES') Then
     CODIGO = GEN_ID(GLO_CIDADES_GE, :TAG);
  If (TABELA = 'LOGRADOUROS') Then
     CODIGO = GEN_ID(GLO_LOGRADOUROS_GE, :TAG);
  If (TABELA = 'PESSOAS_FJ') Then
     CODIGO = GEN_ID(GLO_PESSOAS_FJ_GE, :TAG);
  If (TABELA = 'EDTFORNECEDORES') Then
     CODIGO = GEN_ID(GLO_PESSOAS_FJ_GE, :TAG);

  If (TABELA = 'CLASSIFICACOES') Then
     CODIGO = GEN_ID(GLO_CLASSIFICACAO_GE, :TAG);
  If (TABELA = 'CONFETIQUETAS') Then
     CODIGO = GEN_ID(SIS_ETIQUETAS_GE, :TAG);
  If (TABELA = 'TIPO_VEICULO') Then
     CODIGO = GEN_ID(GLO_TIPO_VEICULO_GE, :TAG);
  If (TABELA = 'MARCA_VEICULO') Then
     CODIGO = GEN_ID(GLO_MARCA_VEICULO_GE, :TAG);
  If (TABELA = 'LOG') Then
     CODIGO = GEN_ID(SIS_LOG_GE, :TAG);
  If (TABELA = 'MODELO_PROPRIEDADE') Then
     CODIGO = GEN_ID(GLO_MODELOS_PROPRIEDADES_GE, :TAG);

     
  /* ESTOQUE */
  If (TABELA = 'ENTRADAS_FAT') Then
     CODIGO = GEN_ID(EST_ENTRADAS_PARC_GE, :TAG);
  If (TABELA = 'ENTRADAS_MANUAL') Then
     CODIGO = GEN_ID(EST_ENTRADAS_MANUAL_GE, :TAG);
  If (TABELA = 'PRODUTOS') Then
     CODIGO = GEN_ID(EST_PRODUTOS_GE, :TAG);
  If (TABELA = 'APLICACOES') Then
     CODIGO = GEN_ID(EST_APLICACOES_GE, :TAG);
  If (TABELA = 'GRUPOS') Then
     CODIGO = GEN_ID(EST_GRUPOS_GE, :TAG);
  If (TABELA = 'MARCAS') Then
     CODIGO = GEN_ID(EST_MARCAS_GE, :TAG);
  If (TABELA = 'NATUREZA') Then
     CODIGO = GEN_ID(EST_NATUREZA_GE, :TAG);
  If (TABELA = 'REDUCOES') Then
     CODIGO = GEN_ID(EST_REDUCOES_GE, :TAG);
  If (TABELA = 'ALTPRECO') Then
     CODIGO = GEN_ID(EST_ALTPRECOS_GE, :TAG);
  If (TABELA = 'CONTAGEM') Then
     CODIGO = GEN_ID(EST_CONTAGEM_GE, :TAG);
  If (TABELA = 'ALTPRECO_UNID') Then
     CODIGO = GEN_ID(EST_ALTPRECO_UNID_GE, :TAG);
  If (TABELA = 'ALTPRECO_MARCA') Then
     CODIGO = GEN_ID(EST_ALTPRECOS_MARCA_GE, :TAG);
  If (TABELA = 'ALTPRECO_GRUPO') Then
     CODIGO = GEN_ID(EST_ALTPRECOS_GRUPO_GE, :TAG);
  If (TABELA = 'LOTE') Then
     CODIGO = GEN_ID(EST_LOTE_GE, :TAG);
  If (TABELA = 'AGRUPADOR') Then
     CODIGO = GEN_ID(est_agrupador_ge, :TAG);
  If (TABELA = 'COR') Then
     CODIGO = GEN_ID(est_COR_ge, :TAG);
  If (TABELA = 'MATERIAL') Then
     CODIGO = GEN_ID(est_MATERIAL_ge, :TAG);
  If (TABELA = 'GRADES') Then
     CODIGO = GEN_ID(est_GRADES_ge, :TAG);
  If (TABELA = 'DEPARTAMENTO') Then
     CODIGO = GEN_ID(GLO_DEPARTAMENTO_ge, :TAG);
  If (TABELA = 'PATRIMONIO') Then
     CODIGO = GEN_ID(GLO_PATRIMONIO_ge, :TAG);
  If (TABELA = 'PECAS') Then
     CODIGO = GEN_ID(GLO_PECAS_ge, :TAG);
  If (TABELA = 'DECLARACAO_VENDA') Then
     CODIGO = GEN_ID(GLO_DECLARACAO_VENDA_ge, :TAG);
  If (TABELA = 'CONTAGEMGRADE') Then
     CODIGO = GEN_ID(GLO_DECLARACAO_VENDA_ge, :TAG);
  If (TABELA = 'CONTAGEMGRADEITENS') Then
     CODIGO = GEN_ID(GLO_DECLARACAO_VENDA_ge, :TAG);

  /* OFICINA */
  If (TABELA = 'SERVICOS') Then
     CODIGO = GEN_ID(OFC_SERVICO_GE, :TAG);
  If (TABELA = 'MOTORES') Then
     CODIGO = GEN_ID(OFC_MOTORES_GE, :TAG);
  If (TABELA = 'MECANICOS') Then
     CODIGO = GEN_ID(OFC_MECANICOS_GE, :TAG);
  If (TABELA = 'VIAJANTE') Then
     CODIGO = GEN_ID(OFC_VIAJANTE_GE, :TAG);
  If (TABELA = 'ORDEM') Then
     CODIGO = GEN_ID(OFC_ORDEM_GE, :TAG);
  If (TABELA = 'ORDEM_ORC') Then
     CODIGO = GEN_ID(OFC_ORDEM_ORC_GE, :TAG);
  If (TABELA = 'GRADES') Then
     CODIGO = GEN_ID(EST_GRADES_GE, :TAG);
  If (TABELA = 'PERFIL_GRADES') Then
     CODIGO = GEN_ID(EST_PERFIL_GRADES_GE, :TAG);
  If (TABELA = 'ORDENS_MOVTOS') Then
     CODIGO = GEN_ID(OFC_ORDEM_MOVTOS_GE, :TAG);
  If (TABELA = 'DEFEITO') Then
     CODIGO = GEN_ID(OFC_DEFEITO_GE, :TAG);
  If (TABELA = 'ORDENS_INTERVALO') Then
     CODIGO = GEN_ID(GEN_OFC_INTERVALO, :TAG);

  /* CARGAS */
  If (TABELA = 'ROTAS') Then
     CODIGO = GEN_ID(CRG_ROTAS_GE, :TAG);
  If (TABELA = 'CARGAS') Then
     CODIGO = GEN_ID(CRG_CARGAS_GE, :TAG);
  If (TABELA = 'TRANSPORTADORAS') Then
     CODIGO = GEN_ID(GLO_TRANSPORTASDORAS_GE  , :TAG);

  /* FINANCEIRO */
  If (TABELA = 'SANGRIAS') Then
     CODIGO = GEN_ID(FAT_CAIXAS_SANGRIA_GE, :TAG);
  If (TABELA = 'CONTAS_PAGAR') Then
     CODIGO = GEN_ID(FIN_PAGAR_COD_GE, :TAG);
  If (TABELA = 'CONTAS_RECEBER') Then
     CODIGO = GEN_ID(FIN_RECEBER_COD_GE, :TAG);
  If (TABELA = 'BAIXA_RECEBER') Then
     CODIGO = GEN_ID(FIN_BAIXA_RECEBER_GE, :TAG);
  If (TABELA = 'BAIXA_PAGAR') Then
     CODIGO = GEN_ID(FIN_BAIXA_PAGAR_GE, :TAG);
  If (TABELA = 'FORMAS_PAGTO') Then
     CODIGO = GEN_ID(FIN_FORMAS_PAGTO_GE, :TAG);
  If (TABELA = 'RECIBOS') Then
     CODIGO = GEN_ID(FIN_RECIBOS_GE, :TAG);
  If (TABELA = 'RECIBOS_PAGAS') Then
     CODIGO = GEN_ID(FIN_RECIBOS_PAGAS_GE, :TAG);
  If (TABELA = 'VENDEDORES') Then
     CODIGO = GEN_ID(FAT_VENDEDOR_GE, :TAG);
  If (TABELA = 'FATURA') Then
     CODIGO = GEN_ID(FIN_FATURA_GE, :TAG);
  If (TABELA = 'CENTRO_CUSTO') Then
     CODIGO = GEN_ID(FIN_CENTRO_CUSTO_GE, :TAG);
  If (TABELA = 'ADMINISTRADORA') Then
     CODIGO = GEN_ID(FIN_ADMINISTRADORA_GE, :TAG);
  If (TABELA = 'CARTAO') Then
     CODIGO = GEN_ID(FIN_CARTAO_GE, :TAG);
  If (TABELA = 'MOTIVO_DEVOLUCAO') Then
     CODIGO = GEN_ID(FIN_MOTIVO_DEVOLUCAO_GE, :TAG);
  If (TABELA = 'MOTIVO_COBRANCA') Then
     CODIGO = GEN_ID(FIN_MOTIVO_COBRANCA_GE, :TAG);
  If (TABELA = 'COBRADOR') Then
     CODIGO = GEN_ID(FIN_COBRADOR_GE, :TAG);
  If (TABELA = 'FATURA_PARCELAS') Then
     CODIGO = GEN_ID(FIN_FATURAS_PARCELAS_GE, :TAG);
  If (TABELA = 'ABASTECIMENTOS') Then
     CODIGO = GEN_ID(PST_ABASTECIMENTOS_GE, :TAG);
  If (TABELA = 'LOCAL_COBRANCA') Then
     CODIGO = GEN_ID(FIN_LOCAL_COBRANCA_GE, :TAG);
  If (TABELA = 'ARQ_CHEQUE') Then
     CODIGO = GEN_ID(FIN_LOCAL_COBRANCA_GE, :TAG);

  /* CONTABILIDADE */
  If (TABELA = 'PLANO') Then
     CODIGO = GEN_ID(PLANO_GE, :TAG);
  If (TABELA = 'PLANILHA') Then
     CODIGO = GEN_ID(FIN_PLANILHA_GE, :TAG);
  If (TABELA = 'MOVCONTABIL') Then
     CODIGO = GEN_ID(MOV_CONTABIL_GE, :TAG);
  If (TABELA = 'MOVIMENTO') Then
     CODIGO = GEN_ID(MOV_CONTABIL_GE, :TAG);
  If (TABELA = 'CONFIG_REL') Then
     CODIGO = GEN_ID(CTB_CONFIG_REL_GE, :TAG);
     
  /* FATURAMENTO */
  If (TABELA = 'ORCAMENTOS') Then
     CODIGO = GEN_ID(FAT_ORCAMENTOS_GE, :TAG);
  If (TABELA = 'ORCAMENTO_MASCARA') Then
     CODIGO = GEN_ID(FAT_ORCAMENTO_MASCARA_GE, :TAG);
  If (TABELA = 'COTACOES') Then
     CODIGO = GEN_ID(FAT_COTACOES_GE, :TAG);
  If (TABELA = 'VENDAS') Then
     CODIGO = GEN_ID(FAT_VENDAS_GE, :TAG);
  If (TABELA = 'TERCEIROS') Then
     CODIGO = GEN_ID(FAT_TERCEIROS_GE, :TAG);
  If (TABELA = 'PDV') Then
     CODIGO = GEN_ID(FAT_PDV_GE, :TAG);
  If (TABELA = 'NOTAS') Then
     CODIGO = GEN_ID(FAT_NOTAS_GE, :TAG);
  If (TABELA = 'HAVER') Then
     CODIGO = GEN_ID(FIN_HAVER_GE, :TAG);
  If (TABELA = 'HAVER_BAIXA') Then
     CODIGO = GEN_ID(FIN_HAVER_BAIXA_GE, :TAG);
  If (TABELA = 'TROCAS') Then
     CODIGO = GEN_ID(FAT_TROCAS_GE, :TAG);
  If (TABELA = 'GARANTIAS') Then
     CODIGO = GEN_ID(FAT_GARANTIAS_GE, :TAG);
  If (TABELA = 'CARTA_GARANTIA') Then
     CODIGO = GEN_ID(FAT_CARTA_GARANTIA_GE, :TAG);
  If (TABELA = 'RECIBOSPAGAS') Then
     CODIGO = GEN_ID(fin_recibos_pagas_ge, :TAG);

  /* PERFIL */
  If (TABELA = 'SIS_PERFIL') Then
     CODIGO = GEN_ID(SIS_PERFIL_GE, :TAG);
  If (TABELA = 'SIS_USUARIOS') Then
     CODIGO = GEN_ID(SIS_USUARIOS_GE, :TAG);
  If (TABELA = 'MENSAGEM') Then
     CODIGO = GEN_ID(SIS_MENSAGENS_GE, :TAG);
  
  /* BOMBAS */
  If (TABELA = 'BOMBA') Then
     CODIGO = GEN_ID(PST_BOMBAS_GE, :TAG);
  If (TABELA = 'LINHA_ABASTECIMENTOS') Then
     CODIGO = GEN_ID(PST_LINHA_ABASTECIMENTOS_GE, :TAG);
  If (TABELA = 'CONTADOR_UGM') Then
     CODIGO = GEN_ID(PST_CONTADOR_UGM_GE, :TAG);

  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_DUPLICATA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  /*  */
  SELECT (DUPLICATA) FROM SIS_EMPRESAS
  WHERE CNPJ = :CNPJ
  INTO :CODIGO;
  
  /*  */
  if (CODIGO is null) then
     CODIGO = 0;
     
  /*  */
  CODIGO = CODIGO + 1;
  
  UPDATE SIS_EMPRESAS SET DUPLICATA = :CODIGO
  WHERE CNPJ = :CNPJ ;
  
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_MENSAGEM (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE ANO_AT INTEGER;
BEGIN
  
  SELECT EXTRACT(YEAR FROM CURRENT_TIMESTAMP)
  FROM RDB$DATABASE INTO :ANO_AT;
  
  IF (:ANO_AT = GEN_ID(SIS_MENSAGENS_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(SIS_MENSAGENS_ANO_GE, 0);
       CODIGO = GEN_ID(SIS_MENSAGENS_COD_GE, :TAG);
     END
  IF (:ANO_AT > GEN_ID(SIS_MENSAGENS_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(SIS_MENSAGENS_ANO_GE, :ANO_AT - GEN_ID(SIS_MENSAGENS_ANO_GE, 0));
       CODIGO = GEN_ID(SIS_MENSAGENS_COD_GE, 0       - GEN_ID(SIS_MENSAGENS_COD_GE, 0));
     END
  IF (:ANO_AT < GEN_ID(SIS_MENSAGENS_ANO_GE, 0)) THEN
     BEGIN
       ANO = 0;
       CODIGO = 0;
     END
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_PAGAR (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE ANO_AT INTEGER;
BEGIN
  
  SELECT EXTRACT(YEAR FROM CURRENT_TIMESTAMP)
  FROM RDB$DATABASE INTO :ANO_AT;
  
  IF (:ANO_AT = GEN_ID(FIN_PAGAR_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(FIN_PAGAR_ANO_GE, 0);
       CODIGO = GEN_ID(FIN_PAGAR_COD_GE, :TAG);
     END
  IF (:ANO_AT > GEN_ID(FIN_PAGAR_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(FIN_PAGAR_ANO_GE, :ANO_AT - GEN_ID(FIN_PAGAR_ANO_GE, 0));
       CODIGO = GEN_ID(FIN_PAGAR_COD_GE, 0       - GEN_ID(FIN_PAGAR_COD_GE, 0));
     END
  IF (:ANO_AT < GEN_ID(FIN_PAGAR_ANO_GE, 0)) THEN
     BEGIN
       ANO = 0;
       CODIGO = 0;
     END
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_PROPRIEDADE (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  /*  */
  SELECT MAX(PROPRIEDADE) FROM GLO_PROPRIEDADES
  WHERE PESSOA_FJ = :PESSOA_FJ AND CNPJ = :CNPJ
  INTO :CODIGO;
  /*  */
  if (CODIGO is null) then
     CODIGO = 0;
  /*  */
  CODIGO = CODIGO + 1;
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_RECEBER (
    TAG INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE ANO_AT INTEGER;
BEGIN
  
  SELECT EXTRACT(YEAR FROM CURRENT_TIMESTAMP)
  FROM RDB$DATABASE INTO :ANO_AT;
  
  IF (:ANO_AT = GEN_ID(FIN_RECEBER_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(FIN_RECEBER_ANO_GE, 0);
       CODIGO = GEN_ID(FIN_RECEBER_COD_GE, :TAG);
     END
  IF (:ANO_AT > GEN_ID(FIN_RECEBER_ANO_GE, 0)) THEN
     BEGIN
       ANO    = GEN_ID(FIN_RECEBER_ANO_GE, :ANO_AT - GEN_ID(FIN_RECEBER_ANO_GE, 0));
       CODIGO = GEN_ID(FIN_RECEBER_COD_GE, 0       - GEN_ID(FIN_RECEBER_COD_GE, 0));
     END
  IF (:ANO_AT < GEN_ID(FIN_RECEBER_ANO_GE, 0)) THEN
     BEGIN
       ANO = 0;
       CODIGO = 0;
     END
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_SUBGRUPO (
    CNPJ CHAR(14),
    GRUPO INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  /*  */
  SELECT MAX(SUBGRUPO) FROM EST_SUBGRUPOS
  WHERE CNPJ = :CNPJ AND
        GRUPO = :GRUPO
  INTO :CODIGO;
  /*  */
  IF (:CODIGO IS NULL) THEN
     CODIGO = 0;
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE GERAR_CODIGO_VEICULO (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
  /*  */
  SELECT MAX(CODIGO) FROM GLO_VEICULOS
  WHERE PESSOA_FJ = :PESSOA_FJ AND CNPJ = :CNPJ
  INTO :CODIGO;
  /*  */
  if (CODIGO is null) then
     CODIGO = 0;
  /*  */
  CODIGO = CODIGO + 1;
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE GETLENGTH (
    TEXTO VARCHAR(255) CHARACTER SET ISO8859_1)
RETURNS (
    TAMANHO INTEGER)
AS
DECLARE VARIABLE P SMALLINT;
DECLARE VARIABLE TEMPSTRING VARCHAR(255) CHARACTER SET ISO8859_1;
BEGIN
  TAMANHO = 0;
  TEMPSTRING = SUBSTRING(TEXTO FROM 1 FOR 255);
  IF (TEXTO > '') THEN
    WHILE ((:TAMANHO < 255) AND (:TEMPSTRING <> '')) DO
    BEGIN
      TAMANHO = :TAMANHO + 1;
      TEMPSTRING = SUBSTRING(TEMPSTRING FROM 2 FOR 255);
    END
  SUSPEND;
END
^

ALTER PROCEDURE GLO_CIDADES_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    UF CHAR(2))
AS
BEGIN
  /**/
END
^

ALTER PROCEDURE GLO_CLIENTES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    LIMITE_CREDITO NUMERIC(18,4),
    BLOQUEADO CHAR(1),
    PAI VARCHAR(50),
    MAE VARCHAR(50),
    TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    TEMPO_SERVICO VARCHAR(15),
    RENDA NUMERIC(18,4),
    CEP VARCHAR(10),
    END_TRABALHO VARCHAR(50),
    NUMERO_TRABALHO VARCHAR(15),
    CIDADE_TRABALHO VARCHAR(50),
    UF_TRABALHO CHAR(2),
    CONJUGE VARCHAR(50),
    DT_NASC_CONJ DATE,
    FONE_CONJ VARCHAR(20),
    CONS_REV CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE ENDERECO_TRABALHO INTEGER;
BEGIN
  if (:END_TRABALHO <> '')
  then begin
       select codigo
       from glo_logradouros
       where cnpj = :cnpj and  nome = :END_TRABALHO
       into :ENDERECO_TRABALHO ;

       if (:ENDERECO_TRABALHO is null) then
       begin

            ENDERECO_TRABALHO = gen_id(glo_logradouros_ge, 1);

            insert into glo_logradouros values (:cnpj, :ENDERECO_TRABALHO, :END_TRABALHO);
       end
  end
  else begin
       ENDERECO_TRABALHO = 0;
  end


  INSERT INTO GLO_CLIENTES (
    CNPJ,
    PESSOA_FJ,
    REQUISICAO,
    CLASSIF,
    LIMITE_CREDITO,
    BLOQUEADO,
    FREQUENCIA,
    PERIODO_FATURAMENTO,
    TOLERANCIA_FATURAMENTO,
    AJUSTE_AUT_FATURAS,
    PAI,
    MAE,
    LOCAL_TRABALHO,
    FONE_TRABALHO,
    TEMPO_SERVICO,
    RENDA_MENSAL,
    CEP_TRABALHO,
    ENDERECO_TRABALHO,
    CONJUGE,
    DT_NASC_CONJUGE,
    FONE_LOCAL_CONJUGE,
    NUMERO_TRABALHO,
    CONS_REV
    )
  VALUES (
    :CNPJ,
    :PESSOA_FJ,
    'N',
    'M',
    :LIMITE_CREDITO,
    :BLOQUEADO,
    'Exp',
    'M',
    0,
    'N',
    :PAI,
    :MAE,
    :TRABALHO,
    :FONE_TRABALHO,
    :TEMPO_SERVICO,
    :RENDA,
    :CEP,
    :ENDERECO_TRABALHO,
    :CONJUGE,
    :DT_NASC_CONJ,
    :FONE_CONJ,
    :NUMERO_TRABALHO,
    :CONS_REV
  );
END
^

ALTER PROCEDURE GLO_FORNECEDORES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
BEGIN
/*     SELECT COUNT(*) FROM GLO_FORNECEDORES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :pessoa_fj
     INTO :CONT ;


IF (CONT IS NULL )
THEN BEGIN*/
  INSERT INTO GLO_FORNECEDORES (
    CNPJ,
    PESSOA_FJ)
  VALUES (
    :CNPJ,
    :PESSOA_FJ);
/*END*/
END
^

ALTER PROCEDURE GLO_PESSOAS_FJ_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    ATIVIDADE INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    BAIRRO VARCHAR(50),
    CIDADE VARCHAR(50),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    INSC_MUNIC VARCHAR(15),
    UF VARCHAR(2))
RETURNS (
    COD INTEGER)
AS
BEGIN EXIT; END
^

ALTER PROCEDURE GLO_PROPRIEDADES_I (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8))
AS
DECLARE VARIABLE CODIGO_LOGRADOURO INTEGER;
DECLARE VARIABLE CODIGO_BAIRRO INTEGER;
DECLARE VARIABLE CODIGO_CIDADE INTEGER;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE ESTADO CHAR(2);
DECLARE VARIABLE AUX CHAR(2);
BEGIN
 /**/
END
^

ALTER PROCEDURE GMB_LETRAS_ESTOQUE (
    LETRA CHAR(1),
    QTDE INTEGER)
AS
DECLARE VARIABLE I INTEGER;
DECLARE VARIABLE ID INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE DESCRICAO VARCHAR(10);
begin
  i = 1;


  select max(cnpj) from sis_empresas e
  into :cnpj;

  while (i <= :qtde) do
  begin
      id = GEN_ID(GEN_EST_LOCALIZACAO_ID,1);
      if (i < 10) then
        descricao = :letra||'0'||i;
      else
        descricao = :letra||i;
    
      insert into est_localizacao (CODIGO, CNPJ,DESCRICAO)
      values (:id,:cnpj,:descricao );
    
      i = i + 1;
  end

end
^

ALTER PROCEDURE GRAFICO_GRUPOPROD (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE VLR NUMERIC(18,4);
BEGIN
     for select codigo, nome
         from est_grupos g
         where cnpj = :cnpj
         order by nome
         into :grupo, :nome_grupo
     do begin
        /* INICIA O VALOR */
        valor = 0;
        

        select
        sum
        (
        /*total do item*/
        (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) +
        /*quanto percentualmente ele representa na venda.................. o descto é negativ*/
        (
            (
            ((coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) * 100)
            /coalesce(vd.total,0)
            )
            /*descobrindo quanto do desconto é "daquele produto" e diminuindo do total do item*/
            * coalesce(vd.desc_acres,0))/100
        )
        from fat_vendas vd
        inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vdi.codigo = vd.codigo)
        inner join est_produtos prd on (prd.cnpj = vdi.cnpj and prd.codigo = vdi.produto)
        inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
        where prd.grupo = :grupo and vd.cnpj = :cnpj and (vd.data_caixa between :dataini and :datafim)
        and nat.es = 'S' and vd.cancelada = 'N' and vd.fechada = 'S' and nat.computa_venda = 'S' and vd.total > 0
        into :valor;


        /*select sum((coalesce(prc_unitario,0) - coalesce(desconto,0)) * coalesce(quantidade,0))
        from ver_fat_vendas_produtos ( :cnpj, :dataini, :datafim )
        where grupo = :grupo
        into :valor ;*/

        if (:valor > 0) then
            SUSPEND;
     END
END
^

ALTER PROCEDURE GRAFICO_VENDASVEND (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4),
    PERCT_VENDA NUMERIC(18,4))
AS
DECLARE VARIABLE TOTAL_GERAL NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ENT NUMERIC(18,4);
DECLARE VARIABLE TOTAL_SAI NUMERIC(18,4);
DECLARE VARIABLE TOTAL_TROCAS NUMERIC(18,4);
DECLARE VARIABLE TROCAS_VENDEDOR NUMERIC(18,4);
BEGIN
     /* vendas */
     select sum(coalesce(vd.total,0) + coalesce(vd.desc_acres,0)) from
     fat_vendas vd
     inner join est_natureza nat on (nat.cnpj = vd.cnpj and vd.natureza = nat.codigo)
     where (vd.data_caixa between :dini and :dfim) and vd.cnpj = :cnpj and fechada = 'S'
     and  coalesce(cancelada,'N') = 'N' and nat.es = 'S' and nat.computa_venda = 'S'
     into  :total_geral;

     if (:total_geral is null)then
       total_geral = 0;

     /* TROCAS */
     select sum(coalesce(total_2,0) + coalesce(desc_acresc_2,0)), sum(coalesce(total,0) + coalesce(desc_acresc,0))
     from fat_trocas tr where (tr.data_caixa between :dini and :dfim) and cnpj = :cnpj
     and fechado = 'S' and  coalesce(cancelada,'N')= 'N'
     into  :total_sai, :total_ent;

     if ( :total_sai is null)then
       total_sai = 0;

     if (:total_ent is null) then
       total_ent = 0;

     total_trocas = total_sai - total_ent ;

     /* total de todos os vendedores */
     total_geral = total_geral + total_trocas ;

     /* somando as vendas e agrupando por vendedor */
     trocas_vendedor = 0;
     for select vd.vendedor,
         sum
        (
        /*total do item*/
        (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) +
        /*quanto percentualmente ele representa na venda.................. o descto é negativ*/
        (
            (
            ((coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) * 100)
            /coalesce(vd.total,0)
            )
            /*descobrindo quanto do desconto é "daquele produto" e diminuindo do total do item*/
            * coalesce(vd.desc_acres,0))/100
        )

         from fat_vendas_itens vdi
         inner join fat_vendas vd on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
         inner join est_natureza nat on (nat.cnpj = vd.cnpj and vd.natureza = nat.codigo)
         where (vd.data_caixa between :dini and :dfim) and vd.cnpj = :cnpj and fechada = 'S'
         and  coalesce(cancelada,'N') = 'N' and nat.es = 'S' and nat.computa_venda = 'S'
         and vd.total > 0
         group by vd.vendedor /*tirado o vendedor do item e colocado o da venda para fazer bater com rel de vd. periodo- Atitude*/
         into  :vendedo,
               :valor
     do
     begin                                                                       
        select sum(coalesce(total_2,0) + coalesce(desc_acresc_2,0)), sum(coalesce(total,0) + coalesce(desc_acresc,0))
        from fat_trocas tr where (tr.data_caixa between :dini and :dfim) and cnpj = :cnpj
        and fechado = 'S' and  coalesce(cancelada,'N')= 'N' AND tr.vendedor = :vendedo
        into  :total_sai, :total_ent;

        if (:total_sai is null) then
           total_sai = 0;

        if (:total_ent is null) then
           total_ent = 0;

        total_trocas = total_sai - total_ent ;
        /* SOMANDO AS VENDAS COM AS TROCAS */
        valor = :valor + :total_trocas ;

        if (total_geral > 0) then
          perct_venda = ( :valor * 100 ) / :total_geral;
        else
          perct_venda = 0;

        select nome from fat_vendedor
        where codigo = :vendedo
        into :nome_vendedor;

        suspend;
     End
END
^

ALTER PROCEDURE HISTORICO_FIN_COBRANCAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER,
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
DECLARE VARIABLE COD INTEGER;
DECLARE VARIABLE ORIGEM CHAR(3);
BEGIN
      for select data_cobranca, motivo, cobrar_em, historico, pago_em, nome_motivo, cobrador,
          pessoa_fj, receber, origem, hr_cobrar_em, hr_cobranca from fin_cobrancas
          where cnpj = :cnpj and pessoa_fj = :pessoa_fj
      into :data_cobranca, :motivo, :cobrar_em,  :historico, :pago_em, :nome_motivo,:cobrador,
           :codigo, :cod_rec, :origem, :hr_cobrar_em, :hr_cobranca
      do begin
         /* contas a receber */
         ano = extract (year from :data_cobranca);

         dt_vencto = null ;
         docto     = null ;
         valor     = null ;

         if (origem ='REC') then
         begin
           select dt_vencto, docto, ( valor - vlr_parcial + juros_rec - descontos ), codigo_vn
           from fin_contas_receber
           where cnpj = :cnpj and codigo = :cod_rec and ano = :ano
           into :dt_vencto, :docto, :valor, :venda;

           if (dt_vencto is null) then
           begin
             select dt_vencto, docto, (coalesce(valor,0) - coalesce(vlr_parcial,0) + coalesce(juros_rec,0) - coalesce(descontos,0))
             from fin_baixas_receber
             where cnpj = :cnpj and codigo_cr = :cod_rec and ano_cr = :ano
             into :dt_vencto, :docto, :valor;
           end
         end
         else
         begin
           select vencimento,coalesce(valor,0), codigo from fin_faturas
           where cnpj = :cnpj and codigo = :cod_rec
           into :dt_vencto, :valor, :cod;

           venda = 0;

           docto = cast(cod as varchar(20));
         end

         /*pessoas fj*/
         select nome_razao from glo_pessoas_fj
         where cnpj = :cnpj and codigo = :codigo
         order by cnpj, codigo
         into:nome;

         select nome from fin_motivo_cobranca
         where cnpj = :cnpj and codigo = :motivo
         into :nome_motivo;

         SELECT NOME FROM FIN_COBRADOR
         WHERE CNPJ = :CNPJ AND CODIGO = :COBRADOR
         INTO :NOME_COBRADOR ;

         SUSPEND;
     END
END
^

ALTER PROCEDURE HISTORICO_FIN_COBRANCAS_PCL (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    RECEBER INTEGER,
    ANO_REC INTEGER)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER,
    HR_COBRAR_EM TIME,
    HR_COBRANCA TIME)
AS
declare variable cod integer;
declare variable origem char(3);
begin
      for select data_cobranca, motivo, cobrar_em, historico, pago_em, nome_motivo, cobrador,
          pessoa_fj, receber, origem, ano, origem, hr_cobrar_em, hr_cobranca from fin_cobrancas
          where cnpj = :cnpj and pessoa_fj = :pessoa_fj and receber = :receber
      and ano = :ano_rec
      into
          :data_cobranca, :motivo, :cobrar_em, :historico, :pago_em, :nome_motivo,
           :cobrador, :codigo, :cod_rec, :origem, :ano, :origem, :hr_cobrar_em, :hr_cobranca
      do
      begin
         dt_vencto = null;
         docto     = null;
         valor     = null;

         if (origem = 'REC') then
         begin
           select dt_vencto, docto, (coalesce(valor,0) - coalesce(vlr_parcial,0) + coalesce(juros_rec,0) - coalesce(descontos,0)), codigo_vn
           from fin_contas_receber
           where cnpj = :cnpj and codigo = :cod_rec and ano = :ano
           into :dt_vencto, :docto, :valor, :venda;

           if (dt_vencto is null) then
           begin
             select dt_vencto, docto, (coalesce(valor,0) - coalesce(vlr_parcial,0) + coalesce(juros_rec,0) - coalesce(descontos,0))
             from fin_baixas_receber
             where cnpj = :cnpj and codigo_cr = :cod_rec and ano_cr = :ano
             into :dt_vencto, :docto, :valor;
           end
         END
         else begin
              select vencimento, coalesce(valor,0), codigo from fin_faturas
              where cnpj = :cnpj and codigo = :cod_rec
              into :dt_vencto, :valor, :cod;

              docto = cast(cod as varchar(20));
              venda = 0;
         end

         /*pessoas fj*/
         select nome_razao from   glo_pessoas_fj
         where cnpj = :cnpj and codigo = :codigo
         order by cnpj, codigo
         into :nome;

         select nome from fin_motivo_cobranca
         where cnpj = :cnpj and codigo = :motivo
         into :nome_motivo;

         select nome from fin_cobrador
         where cnpj = :cnpj and codigo = :cobrador
         into :nome_cobrador;

         suspend;
     end
END
^

ALTER PROCEDURE IMP_OFC_CTRL_QUALIDADE (
    CNPJ CHAR(14),
    CONTROLE INTEGER)
RETURNS (
    CODIGO INTEGER,
    VIRABREQUIM VARCHAR(15),
    MEDIDA_MANCAL VARCHAR(15),
    MEDIDA_BIELA VARCHAR(15),
    FOLGA_AXIAL_VIRABREQUIM VARCHAR(15),
    CABECOTE VARCHAR(15),
    ALTURA_CABECOTE VARCHAR(15),
    ALTURA_VALV_ADMISSAO VARCHAR(15),
    ALTURA_VALV_ESCAPE VARCHAR(15),
    BLOCO VARCHAR(15),
    FOLGA_CILINDRO VARCHAR(15),
    FOLGA_RADIAL_BLOCO VARCHAR(15),
    BIELA VARCHAR(15),
    FOLGA_RADIAL_BIELA VARCHAR(15),
    FOLGA_PINO VARCHAR(15),
    FOLGA_AXIAL_BIELA VARCHAR(15),
    AJUSTADO VARCHAR(15),
    TORQUE_MANCAL VARCHAR(15),
    TORQUE_BIELA VARCHAR(15),
    ALTURA_PISTAO VARCHAR(15),
    MONTADOR INTEGER,
    NOME_MONTADOR VARCHAR(50),
    PESSOA_FJ INTEGER,
    NOME_CLIENTE VARCHAR(50),
    DATA TIMESTAMP,
    MOTOR INTEGER,
    NOME_MOTOR VARCHAR(50),
    OBSERVACAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    NOME_MONTADOR_VIRABREQUIM VARCHAR(50),
    NOME_MONTADOR_CABECOTE VARCHAR(50),
    NOME_MONTADOR_BLOCO VARCHAR(50),
    NOME_MONTADOR_BIELA VARCHAR(50),
    NOME_MONTADOR_AJUSTE VARCHAR(50))
AS
DECLARE VARIABLE MONTADOR_VIRABREQUIM INTEGER;
DECLARE VARIABLE MONTADOR_CABECOTE INTEGER;
DECLARE VARIABLE MONTADOR_BLOCO INTEGER;
DECLARE VARIABLE MONTADOR_BIELA INTEGER;
DECLARE VARIABLE MONTADOR_AJUSTE INTEGER;
BEGIN
      FOR SELECT CODIGO, VIRABREQUIM, MEDIDA_MANCAL, MEDIDA_BIELA,
                FOLGA_AXIAL_VIRABREQUIM, CABECOTE, ALTURA_CABECOTE,
                ALTURA_VALV_ADMISSAO, ALTURA_VALV_ESCAPE, BLOCO, FOLGA_CILINDRO,
                FOLGA_RADIAL_BLOCO, BIELA, FOLGA_RADIAL_BIELA, FOLGA_PINO,
                FOLGA_AXIAL_BIELA, AJUSTADO, TORQUE_MANCAL, TORQUE_BIELA,
                ALTURA_PISTAO, MONTADOR, NOME_MONTADOR,OBSERVACAO,
                MONTADOR_VIRABREQUIM, MONTADOR_CABECOTE, MONTADOR_BLOCO,
                MONTADOR_BIELA, MONTADOR_AJUSTE
      FROM OFC_CTRL_QUALIDADE
      WHERE CNPJ = :CNPJ AND CODIGO = :CONTROLE
      ORDER BY CNPJ, CODIGO
      INTO
           :CODIGO, :VIRABREQUIM, :MEDIDA_MANCAL, :MEDIDA_BIELA, :FOLGA_AXIAL_VIRABREQUIM,
           :CABECOTE, :ALTURA_CABECOTE, :ALTURA_VALV_ADMISSAO, :ALTURA_VALV_ESCAPE,
           :BLOCO, :FOLGA_CILINDRO, :FOLGA_RADIAL_BLOCO, :BIELA, :FOLGA_RADIAL_BIELA,
           :FOLGA_PINO, :FOLGA_AXIAL_BIELA, :AJUSTADO, :TORQUE_MANCAL, :TORQUE_BIELA,
           :ALTURA_PISTAO, :MONTADOR, :NOME_MONTADOR, :OBSERVACAO,
           :MONTADOR_VIRABREQUIM, :MONTADOR_CABECOTE, :MONTADOR_BLOCO,
           :MONTADOR_BIELA, :MONTADOR_AJUSTE
      DO BEGIN
         /* CLIENTE */
         SELECT PESSOA_FJ, DATA, MOTOR FROM OFC_ORDEM_SERVICO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO :PESSOA_FJ, :DATA, :MOTOR ;

         /* NOME DO MOTOR */
         SELECT NOME FROM OFC_MOTORES
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO :NOME_MOTOR ;

         /* NOME DO MONTADOR */
         SELECT NOME FROM OFC_MECANICOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MONTADOR_VIRABREQUIM
         INTO :NOME_MONTADOR_VIRABREQUIM ;

         /* NOME DO MONTADOR */
         SELECT NOME FROM OFC_MECANICOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MONTADOR_CABECOTE
         INTO :NOME_MONTADOR_CABECOTE ;

         /* NOME DO MONTADOR */
         SELECT NOME FROM OFC_MECANICOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MONTADOR_BLOCO
         INTO :NOME_MONTADOR_BLOCO ;

         /* NOME DO MONTADOR */
         SELECT NOME FROM OFC_MECANICOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MONTADOR_BIELA
         INTO :NOME_MONTADOR_BIELA ;

         /* NOME DO MONTADOR */
         SELECT NOME FROM OFC_MECANICOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MONTADOR_AJUSTE
         INTO :NOME_MONTADOR_AJUSTE ;

         /* PESSOAS FJ */
         SELECT NOME_RAZAO
         FROM  GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO  :NOME_CLIENTE;

         SUSPEND;
      END
END
^

ALTER PROCEDURE IMPORTA_EST_PRODUTOS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    NEG_QTDADE_2 CHAR(1),
    COMPLEMENTO_NF CHAR(1),
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM INTEGER,
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    SUBUNIDADE INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1))
AS
begin
     /* MIGRA OS DADOS PARA A TABELA EXTERNA */
     IF ( NOT ( EXISTS ( SELECT CODIGO FROM EST_PRODUTOS
              WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO)))
     THEN BEGIN
          INSERT INTO EST_PRODUTOS
          (
          CNPJ,
          CODIGO,
          CODIGO_2,
          NOME,
          MARCA,
          GRUPO,
          SUBGRUPO,
          REDUCAO,
          UNIDADE,
          CTE,
          CTIE,
          QTDADE_1,
          QTDADE_2,
          NEG_QTDADE_2,
          COMPLEMENTO_NF,
          MARGEM_BRUTA,
          PRC_REPOS,
          PRC_CUSTO_ANT,
          PRC_CUSTO_MED,
          PRC_VENDA,
          PRC_VENDA_ANT,
          PRC_VENDA_MED,
          ALIQUOTA_ECF,
          ORIGEM,
          PROD_PESAVEL,
          ETIQUETA_ENT,
          ATIVO,
          SUBUNIDADE,
          CUSTO_AQUISICAO,
          VENDE_FRACIONADO,
          POSSUI_LOTE)
          VALUES
          (
          :CNPJ,
          :CODIGO,
          :CODIGO_2,
          :NOME,
          1,
          1,
          1,
          :REDUCAO,
          :UNIDADE,
          :CTE,
          :CTIE,
          0,
          0,
          :NEG_QTDADE_2,
          :COMPLEMENTO_NF,
          :MARGEM_BRUTA,
          :PRC_REPOS,
          :PRC_CUSTO_ANT,
          :PRC_CUSTO_MED,
          :PRC_VENDA,
          :PRC_VENDA_ANT,
          :PRC_VENDA_MED,
          :ALIQUOTA_ECF,
          :ORIGEM,
          :PROD_PESAVEL,
          :ETIQUETA_ENT,
          :ATIVO,
          :SUBUNIDADE,
          :CUSTO_AQUISICAO,
          :VENDE_FRACIONADO,
          :POSSUI_LOTE
          );
     END
     ELSE BEGIN
          UPDATE EST_PRODUTOS
          SET PRC_VENDA = :PRC_VENDA
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ATUALIZA_ARQ_EXTERNO <> 'S' ;
     END
END
^

ALTER PROCEDURE IMPORTA_ORCAMENTO (
    CNPJ VARCHAR(20),
    CODIGO INTEGER,
    CFOP INTEGER)
RETURNS (
    VENDA INTEGER)
AS
DECLARE VARIABLE VALIDADE DATE;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE USUARIO INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE FORMA_PGTO INTEGER;
DECLARE VARIABLE OBSERVACAO VARCHAR(200);
DECLARE VARIABLE NOME_CONSUMIDOR VARCHAR(50);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NOME_NATUREZA VARCHAR(50);
DECLARE VARIABLE NOME_FORMA VARCHAR(50);
DECLARE VARIABLE NOME_VENDEDOR VARCHAR(50);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE ICM NUMERIC(18,4);
DECLARE VARIABLE ICM_SUBS NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE VOLUME NUMERIC(18,4);
DECLARE VARIABLE PESO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE PORC_DESC NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE ALIQUOTA CHAR(5);
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE PRC_UNIT_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE TOTPESO NUMERIC(18,4);
DECLARE VARIABLE TOTVOLUME NUMERIC(18,4);
DECLARE VARIABLE TOTVENDA NUMERIC(18,4);
DECLARE VARIABLE CONS_REV CHAR(1);
DECLARE VARIABLE UF CHAR(2);
DECLARE VARIABLE SIS_UF CHAR(2);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE BASECALCULOICM NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE ICMSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE DIFERENCIA_FIS_FISC CHAR(1);
DECLARE VARIABLE COMPLEMENTO VARCHAR(100);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE NUMERO CHAR(6);
BEGIN
     for select
         pessoa_fj, usuario, vendedor, forma_pgto,
         substring(observacao from 1 for 200), nome_consumidor, total, desc_acresc, validade
     from fat_orcamentos                         /*cancelado e faturado*/
     where cnpj = :cnpj and codigo = :codigo and coalesce(Status,1) <> 4 and coalesce(Status,1) <> 3
     into
         :pessoa_fj, :usuario, :vendedor, :forma_pgto,
         :observacao, :nome_consumidor, :total, :desc_acresc, :validade
     do begin
        /* NOME DA PESSOA */
        select nome_razao, uf from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :nome, :uf ;
     
        /* CONSUMIDOR OU REVENDA */
        SELECT CONS_REV FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        INTO :CONS_REV ;

        IF ( CONS_REV IS NULL )
        THEN
            CONS_REV = 'C' ;

        /* CODIGO DA BAIXA */
        SELECT CODIGO FROM GERAR_CODIGO ('VENDAS', 1)
        into :VENDA;

        /* PARAMETROS */
        SELECT PDV_NATUREZA, UF FROM SIS_EMPRESAS
        WHERE CNPJ = :CNPJ
        into :NATUREZA, :SIS_UF;

        /* PARAMETROS */
        SELECT DIFERENCIA_FIS_FISC FROM SIS_CONFIGURACOES
        WHERE CNPJ = :CNPJ
        into :DIFERENCIA_FIS_FISC;

        /* NOME DA NATUREZA */
        SELECT NOME FROM EST_NATUREZA
        WHERE CNPJ = :CNPJ AND CODIGO = :CFOP
        INTO :NOME_NATUREZA ;

        /* NOME DO VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
        INTO :NOME_VENDEDOR ;


        SELECT NOME FROM fin_formas_pagto
        WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
        INTO :NOME_FORMA ;

        INSERT INTO FAT_VENDAS
        (
        CNPJ, CODIGO, DATA, FECHADA, PESSOA_FJ,
        USUARIO, VENDEDOR, NATUREZA, ENVIADA_CX, FORMA_PGTO,
        NUM_NF, NUM_CUPOM, DESC_ACRES, OBSERVACAO, TIPO_VENDA,
        NOME_CONSUMIDOR, ORCAMENTO, NOME, SELECIONADA, NOME_NATUREZA,
        NOME_VENDEDOR, NOME_FORMA, VALIDADE, CONS_REV, LOCAL
        )
        VALUES
        (
        :CNPJ, :VENDA, cast('today' as date), 'N', :PESSOA_FJ,
        :USUARIO, :VENDEDOR, :CFOP, 'N', :FORMA_PGTO,
        0,0, :DESC_ACRESC, :OBSERVACAO, 'Ven', :NOME_CONSUMIDOR, :CODIGO, :NOME, 'S',
        :NOME_NATUREZA, :NOME_VENDEDOR, :NOME_FORMA, :VALIDADE, :CONS_REV, 2
        );
        
        TOTPESO   = 0;
        TOTVOLUME = 0;
        TOTVENDA  = 0;

        BASECALCULOICM          = 0;
        BASECALCULOSUBSTITUICAO = 0;
        ICMSUBSTITUICAO         = 0;

        for select
            produto, sequencia, (coalesce(quantidade,0) - coalesce(qtde_faturada,0)), prc_unitario, prc_custo,
            icm, icm_subs, ipi, volume, peso, desconto, porc_desc, unidade,
            prc_unit_original, subunidade, complemento, grade, numero
        from fat_orcamentos_itens
        where cnpj = :cnpj and codigo = :codigo and (coalesce(quantidade,0) - (coalesce(qtde_faturada,0)) > 0)
        into
            :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
            :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
            :prc_unit_original, :subunidade, :COMPLEMENTO, :grade, :numero
        do begin

           select nome, aliquota_ecf, cte, ctie, origem from
           est_produtos
           where cnpj = :cnpj and codigo = :produto
           into :nome_produto, :aliquota, :cte, :ctie, :origem ;


           insert into fat_vendas_itens
           (
            cnpj, codigo, produto, sequencia, quantidade, prc_unitario, prc_custo,
            icm, icm_subs, ipi, volume, peso, desconto, porc_desc, unidade,
            prc_unit_original, nome_produto, subunidade, aliquota, cte, ctie, origem, complemento,
            grade, numero, sproduto, custo_medio
           )
           values
           (
            :cnpj, :venda, :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
            :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
            :prc_unit_original, :nome_produto, :subunidade, :aliquota, :cte, :ctie, :origem, :complemento,
            :grade, :numero, :produto, :prc_custo
           );
           
           TOTPESO   = TOTPESO   + :PESO;
           TOTVOLUME = TOTVOLUME + :VOLUME;
           TOTVENDA  = TOTVENDA  + (:QUANTIDADE * ( :PRC_UNITARIO - :DESCONTO ));
           
           /* SOMA OS TOTAIS E OS PESOS */
        END

        UPDATE FAT_VENDAS
        SET TOTAL = :TOTVENDA, PESO = :TOTPESO, VOLUME = :TOTVOLUME
        WHERE CNPJ = :CNPJ AND CODIGO = :VENDA ;
        
     END
     
     SUSPEND;
END
^

ALTER PROCEDURE IMPORTA_ORCAMENTOS (
    CNPJ VARCHAR(20),
    DATA DATE,
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    FORMA_PGTO INTEGER,
    OBSERVACAO VARCHAR(80),
    NOME_CONSUMIDOR VARCHAR(50),
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    DESC_ACRESC NUMERIC(18,4),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    NOME VARCHAR(50),
    VALIDADE DATE,
    TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('ORCAMENTOS',1)
     into :CODIGO;


     INSERT INTO FAT_ORCAMENTOS
     (   CNPJ, CODIGO, DATA, PESSOA_FJ, USUARIO, VENDEDOR, FORMA_PGTO,
         OBSERVACAO, NOME_CONSUMIDOR, TOTAL, DESC_ACRESC,
         PESO, VOLUME, NOME, VALIDADE, TOTAL_2, DESC_ACRESC_2, CLIENTE
     )
     VALUES
     (
         :CNPJ, :CODIGO, :DATA, :PESSOA_FJ, :USUARIO, :VENDEDOR, :FORMA_PGTO,
         :OBSERVACAO, :NOME_CONSUMIDOR, :TOTAL, :DESC_ACRESC,
         :PESO, :VOLUME, :NOME, :VALIDADE, :TOTAL_2, :DESC_ACRESC_2, :CLIENTE
     ) ;
END
^

ALTER PROCEDURE IMPORTA_ORCAMENTOS_ITENS (
    CNPJ VARCHAR(20),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    MARCA VARCHAR(30),
    QUANTIDADE_2 NUMERIC(18,4),
    MARCA_2 VARCHAR(30),
    PRC_UNITARIO_2 NUMERIC(18,4))
AS
BEGIN
     INSERT INTO
     FAT_ORCAMENTOS_ITENS
     (
    CNPJ ,
    CODIGO ,
    PRODUTO,
    SEQUENCIA,
    QUANTIDADE,
    PRC_UNITARIO,
    PRC_CUSTO,
    ICM ,
    ICM_SUBS,
    IPI ,
    VOLUME ,
    PESO ,
    DESCONTO ,
    PORC_DESC,
    UNIDADE,
    PRC_UNIT_ORIGINAL,
    NOME_PRODUTO,
    SUBUNIDADE,
    MARCA,
    QUANTIDADE_2,
    MARCA_2,
    PRC_UNITARIO_2
     )
     VALUES
     (
    :CNPJ ,
    :CODIGO ,
    :PRODUTO,
    :SEQUENCIA,
    :QUANTIDADE,
    :PRC_UNITARIO,
    :PRC_CUSTO,
    :ICM ,
    :ICM_SUBS,
    :IPI ,
    :VOLUME ,
    :PESO ,
    :DESCONTO ,
    :PORC_DESC,
    :UNIDADE,
    :PRC_UNIT_ORIGINAL,
    :NOME_PRODUTO,
    :SUBUNIDADE,
    :MARCA,
    :QUANTIDADE_2,
    :MARCA_2,
    :PRC_UNITARIO_2
     );
END
^

ALTER PROCEDURE IMPORTA_ORDEM_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    ORDEM INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MECANICO INTEGER;
DECLARE VARIABLE VIAJANTE INTEGER;
DECLARE VARIABLE ENTRADA DATE;
DECLARE VARIABLE HISTORICO VARCHAR(100) CHARACTER SET NONE;
DECLARE VARIABLE CHASSI VARCHAR(30) CHARACTER SET NONE;
DECLARE VARIABLE INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE CLIENTE VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE FECHADO VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_NATUREZA VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_MECANICO VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_VIAJANTE VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_MOTOR VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE VLR_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE MOTOR INTEGER;
DECLARE VARIABLE ENVIADA_CAIXA CHAR(1);
DECLARE VARIABLE PLACA VARCHAR(6);
DECLARE VARIABLE DATA_FECHAMENTO DATE;
DECLARE VARIABLE OBS_FECHAMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE NOME_FORMA VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE TIPO_DOCTO VARCHAR(3) CHARACTER SET NONE;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE VLR_PARC_LC NUMERIC(18,4);
DECLARE VARIABLE CREDITOS NUMERIC(18,4);
DECLARE VARIABLE DEBITOS NUMERIC(18,4);
DECLARE VARIABLE SERVICO INTEGER;
DECLARE VARIABLE NUMERO_VENDA INTEGER;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE SELECIONADO CHAR(1);
begin
     FOR SELECT
        CNPJ, CODIGO, DATA, PESSOA_FJ, NOME,
        NATUREZA, MECANICO, VIAJANTE, ENTRADA,
        HISTORICO, CHASSI, INFORMACOES, TOTAL,
        DESC_ACRESC, CLIENTE, FECHADO, NOME_NATUREZA,
        NOME_MECANICO, NOME_VIAJANTE, MOTOR,
        NOME_MOTOR, ENVIADA_CAIXA,
        PLACA, DATA_FECHAMENTO, OBS_FECHAMENTO,
        FORMA_PAGTO, NOME_FORMA, TIPO_DOCTO,
        LOCAL_COBRANCA, VLR_PARC_LC, VLR_ENTRADA,
        CREDITOS, DEBITOS, NUMERO_VENDA
     FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
        :CNPJ, :CODIGO, :DATA, :PESSOA_FJ, :NOME,
        :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
        :HISTORICO, :CHASSI, :INFORMACOES, :TOTAL,
        :DESC_ACRESC, :CLIENTE, :FECHADO, :NOME_NATUREZA,
        :NOME_MECANICO, :NOME_VIAJANTE, :MOTOR,
        :NOME_MOTOR, :ENVIADA_CAIXA,
        :PLACA, :DATA_FECHAMENTO, :OBS_FECHAMENTO,
        :FORMA_PAGTO, :NOME_FORMA, :TIPO_DOCTO,
        :LOCAL_COBRANCA, :VLR_PARC_LC, :VLR_ENTRADA,
        :CREDITOS, :DEBITOS, :NUMERO_VENDA
     DO BEGIN
        /* CODIGO DA BAIXA */
        SELECT CODIGO FROM GERAR_CODIGO ('ORDEM',1)
        into :ORDEM;

        INSERT INTO OFC_ORDEM_SERVICO
        (
        CNPJ, CODIGO, DATA, PESSOA_FJ, NOME,
        NATUREZA, MECANICO, VIAJANTE, ENTRADA,
        HISTORICO, CHASSI, INFORMACOES, TOTAL,
        DESC_ACRESC, CLIENTE, FECHADO, NOME_NATUREZA,
        NOME_MECANICO, NOME_VIAJANTE, MOTOR,
        NOME_MOTOR, ENVIADA_CAIXA,
        PLACA, DATA_FECHAMENTO, OBS_FECHAMENTO,
        FORMA_PAGTO, NOME_FORMA, TIPO_DOCTO,
        LOCAL_COBRANCA, VLR_PARC_LC, VLR_ENTRADA,
        CREDITOS, DEBITOS, ORCAMENTO, NUMERO_VENDA
        )
        VALUES
        (
        :CNPJ, :ORDEM, :DATA, :PESSOA_FJ, :NOME,
        :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
        :HISTORICO, :CHASSI, :INFORMACOES, :TOTAL,
        :DESC_ACRESC, :CLIENTE, :FECHADO, :NOME_NATUREZA,
        :NOME_MECANICO, :NOME_VIAJANTE, :MOTOR,
        :NOME_MOTOR, :ENVIADA_CAIXA,
        :PLACA, :DATA_FECHAMENTO, :OBS_FECHAMENTO,
        :FORMA_PAGTO, :NOME_FORMA, :TIPO_DOCTO,
        :LOCAL_COBRANCA, :VLR_PARC_LC, :VLR_ENTRADA,
        :CREDITOS, :DEBITOS, :CODIGO, :NUMERO_VENDA
        ) ;
     END

     /* ITENS DO ORCAMENTO */
     FOR SELECT
        SERVICO, NOME, QUANTIDADE,
        UNITARIO, SELECIONADO
     FROM OFC_ORDEM_SERVICO_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
        :SERVICO, :NOME, :QUANTIDADE,
        :UNITARIO, :SELECIONADO
     DO BEGIN
        INSERT INTO OFC_ORDEM_SERVICO_SERVICO
        (CNPJ, CODIGO, SERVICO, NOME, QUANTIDADE,
        UNITARIO, SELECIONADO)
        VALUES
        (:CNPJ, :ORDEM, :SERVICO, :NOME, :QUANTIDADE,
        :UNITARIO, :SELECIONADO);
     END

     SUSPEND ;
END
^

ALTER PROCEDURE IMPORTA_ORDEM_SERVICO_EXISTENTE (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    CODIGO_2 INTEGER)
RETURNS (
    ORDEM INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MECANICO INTEGER;
DECLARE VARIABLE VIAJANTE INTEGER;
DECLARE VARIABLE ENTRADA DATE;
DECLARE VARIABLE HISTORICO VARCHAR(100) CHARACTER SET NONE;
DECLARE VARIABLE CHASSI VARCHAR(30) CHARACTER SET NONE;
DECLARE VARIABLE INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE CLIENTE VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE FECHADO VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_NATUREZA VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_MECANICO VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_VIAJANTE VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE NOME_MOTOR VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE VLR_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE MOTOR INTEGER;
DECLARE VARIABLE ENVIADA_CAIXA CHAR(1);
DECLARE VARIABLE PLACA VARCHAR(6);
DECLARE VARIABLE DATA_FECHAMENTO DATE;
DECLARE VARIABLE OBS_FECHAMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE NOME_FORMA VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE TIPO_DOCTO VARCHAR(3) CHARACTER SET NONE;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE VLR_PARC_LC NUMERIC(18,4);
DECLARE VARIABLE CREDITOS NUMERIC(18,4);
DECLARE VARIABLE DEBITOS NUMERIC(18,4);
DECLARE VARIABLE SERVICO INTEGER;
DECLARE VARIABLE NUMERO_VENDA INTEGER;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE SELECIONADO CHAR(1);
begin
     FOR SELECT
        CNPJ, CODIGO, DATA, PESSOA_FJ, NOME,
        NATUREZA, MECANICO, VIAJANTE, ENTRADA,
        HISTORICO, CHASSI, INFORMACOES, TOTAL,
        DESC_ACRESC, CLIENTE, FECHADO, NOME_NATUREZA,
        NOME_MECANICO, NOME_VIAJANTE, MOTOR,
        NOME_MOTOR, ENVIADA_CAIXA,
        PLACA, DATA_FECHAMENTO, OBS_FECHAMENTO,
        FORMA_PAGTO, NOME_FORMA, TIPO_DOCTO,
        LOCAL_COBRANCA, VLR_PARC_LC, VLR_ENTRADA,
        CREDITOS, DEBITOS, NUMERO_VENDA
     FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
        :CNPJ, :CODIGO, :DATA, :PESSOA_FJ, :NOME,
        :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
        :HISTORICO, :CHASSI, :INFORMACOES, :TOTAL,
        :DESC_ACRESC, :CLIENTE, :FECHADO, :NOME_NATUREZA,
        :NOME_MECANICO, :NOME_VIAJANTE, :MOTOR,
        :NOME_MOTOR, :ENVIADA_CAIXA,
        :PLACA, :DATA_FECHAMENTO, :OBS_FECHAMENTO,
        :FORMA_PAGTO, :NOME_FORMA, :TIPO_DOCTO,
        :LOCAL_COBRANCA, :VLR_PARC_LC, :VLR_ENTRADA,
        :CREDITOS, :DEBITOS, :NUMERO_VENDA
     DO BEGIN
        /* CODIGO DA ORDE, */
        ORDEM = :CODIGO_2;

        INSERT INTO OFC_ORDEM_SERVICO
        (
        CNPJ, CODIGO, DATA, PESSOA_FJ, NOME,
        NATUREZA, MECANICO, VIAJANTE, ENTRADA,
        HISTORICO, CHASSI, INFORMACOES, TOTAL,
        DESC_ACRESC, CLIENTE, FECHADO, NOME_NATUREZA,
        NOME_MECANICO, NOME_VIAJANTE, MOTOR,
        NOME_MOTOR, ENVIADA_CAIXA,
        PLACA, DATA_FECHAMENTO, OBS_FECHAMENTO,
        FORMA_PAGTO, NOME_FORMA, TIPO_DOCTO,
        LOCAL_COBRANCA, VLR_PARC_LC, VLR_ENTRADA,
        CREDITOS, DEBITOS, ORCAMENTO, NUMERO_VENDA
        )
        VALUES
        (
        :CNPJ, :ORDEM, :DATA, :PESSOA_FJ, :NOME,
        :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
        :HISTORICO, :CHASSI, :INFORMACOES, :TOTAL,
        :DESC_ACRESC, :CLIENTE, :FECHADO, :NOME_NATUREZA,
        :NOME_MECANICO, :NOME_VIAJANTE, :MOTOR,
        :NOME_MOTOR, :ENVIADA_CAIXA,
        :PLACA, :DATA_FECHAMENTO, :OBS_FECHAMENTO,
        :FORMA_PAGTO, :NOME_FORMA, :TIPO_DOCTO,
        :LOCAL_COBRANCA, :VLR_PARC_LC, :VLR_ENTRADA,
        :CREDITOS, :DEBITOS, :CODIGO, :NUMERO_VENDA
        ) ;
     END

     /* ITENS DO ORCAMENTO */
     FOR SELECT
        SERVICO, NOME, QUANTIDADE,
        UNITARIO, SELECIONADO
     FROM OFC_ORDEM_SERVICO_SERVICO_ORC
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
        :SERVICO, :NOME, :QUANTIDADE,
        :UNITARIO, :SELECIONADO
     DO BEGIN
        INSERT INTO OFC_ORDEM_SERVICO_SERVICO
        (CNPJ, CODIGO, SERVICO, NOME, QUANTIDADE,
        UNITARIO, SELECIONADO)
        VALUES
        (:CNPJ, :ORDEM, :SERVICO, :NOME, :QUANTIDADE,
        :UNITARIO, :SELECIONADO);
     END

     SUSPEND ;
END
^

ALTER PROCEDURE INDEXA_CUSTOS (
    CNPJ CHAR(14),
    INDEXADOR NUMERIC(18,4))
AS
begin
     UPDATE EST_PRODUTOS SET
     PRC_VENDA = ( CUSTO_INDEXADO * :INDEXADOR ) + ((( CUSTO_INDEXADO * :INDEXADOR )* MARGEM_BRUTA)/100)
     WHERE CNPJ = :CNPJ AND CUSTO_INDEXADO > 0;
END
^

ALTER PROCEDURE INSERE_CTB_CHEQUE (
    CNPJ CHAR(14),
    CHEQUE INTEGER,
    CONTA INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER,
    ORIGEM CHAR(1),
    PLANILHA INTEGER,
    CONTABILIDADE CHAR(1),
    NOME VARCHAR(50))
AS
BEGIN
  INSERT INTO CTB_CHEQUE (
    CNPJ,
    CHEQUE,
    CONTA,
    DATA,
    VALOR,
    HISTORICO,
    IMPRESSO,
    PESSOA_FJ,
    ORIGEM,
    PLANILHA,
    CONTABILIDADE)
  VALUES (
    :CNPJ,
    :CHEQUE,
    :CONTA,
    :DATA,
    :VALOR,
    :HISTORICO,
    :IMPRESSO,
    :PESSOA_FJ,
    :ORIGEM,
    :PLANILHA,
    :CONTABILIDADE);
END
^

ALTER PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL (
    CNPJ CHAR(14),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    BANCO CHAR(3),
    TIPO_LANCAMENTO CHAR(1),
    COD_DOC CHAR(3),
    FORNECEDOR INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
BEGIN
  codigo = gen_id(mov_contabil_ge, 1);

  if(fornecedor = 0)then
    fornecedor = null ;

  /* dados da baixa */
  ano = extract(year  from :data);
  mes = extract(month from :data);

  if (contra_partida = 0)then
    contra_partida = null ;

  /*se o banco não for passado e a conta existir
  eu resgato o valor da conta*/
  if ((:banco is null) or (:banco = '')) then
  begin
    select ctb.banco from ctb_planoconta ctb
    where ctb.conta = :conta
    into :banco;
  end

  insert into ctb_movimento_contabil (
    cnpj,
    codigo,
    data,
    tipo,
    documento,
    historico,
    mes,
    ano,
    valor,
    conta,
    origem,
    planilha,
    contra_partida,
    banco,
    tipo_lancamento,
    cod_doc,
    fornecedor,
    data_conciliacao
    )
  values (
    :cnpj,
    :codigo,
    :data,
    :tipo,
    :documento,
    :historico,
    :mes,
    :ano,
    :valor,
    :conta,
    :origem,
    :planilha,
    :contra_partida,
    :banco,
    :tipo_lancamento,
    :cod_doc,
    :fornecedor,
    null);
END
^

ALTER PROCEDURE INSERE_EST_FECHAMENTO_MES (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DATA TIMESTAMP,
    MES INTEGER,
    ANO INTEGER,
    SALDO_INICIAL NUMERIC(18,4),
    ENTRADAS NUMERIC(18,4),
    SAIDAS NUMERIC(18,4),
    GRUPO INTEGER,
    CUSTO NUMERIC(18,4),
    SUB_GRUPO INTEGER,
    TIPO CHAR(3))
AS
BEGIN
     /* TIPO PODE SER ENT = ENTRADAS, SAI = SAIDAS,  */
     IF (EXISTS(SELECT CNPJ FROM EST_FECHAMENTO_MES WHERE (CNPJ = :CNPJ) AND  (PRODUTO = :PRODUTO) AND  (MES = :MES) AND  (ANO = :ANO)))
     THEN BEGIN
          /* ENTRADDAS  = ENT */
          IF ( TIPO = 'ENT' )
          THEN BEGIN
               UPDATE EST_FECHAMENTO_MES
               SET ENTRADAS = ENTRADAS + :ENTRADAS
               WHERE (CNPJ = :CNPJ) AND (PRODUTO = :PRODUTO) AND (MES = :MES) AND (ANO = :ANO);
          END

          IF ( TIPO = 'SAI' )
          THEN BEGIN
               UPDATE EST_FECHAMENTO_MES
               SET SAIDAS = SAIDAS + :SAIDAS
               WHERE (CNPJ = :CNPJ) AND (PRODUTO = :PRODUTO) AND (MES = :MES) AND (ANO = :ANO);
          END
     END
     ELSE BEGIN
          INSERT INTO EST_FECHAMENTO_MES (
          CNPJ, PRODUTO, DATA, MES, ANO, SALDO_INICIAL, ENTRADAS, SAIDAS, GRUPO, CUSTO, SUB_GRUPO)
          VALUES (
          :CNPJ, :PRODUTO, :DATA, :MES, :ANO, :SALDO_INICIAL, :ENTRADAS, :SAIDAS,
          :GRUPO, :CUSTO, :SUB_GRUPO);
     END
END
^

ALTER PROCEDURE INSERE_ETIQUETA_PRODUTO (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    NOME VARCHAR(50),
    VALOR NUMERIC(18,4),
    QUANTIDADE INTEGER,
    SEQUENCIA INTEGER,
    NUMERO VARCHAR(6),
    GRADE CHAR(4))
AS
BEGIN
  INSERT INTO EST_ESTIQUETA_PRODUTO_IMPRIME (
    CNPJ,
    CODIGO,
    NOME,
    VALOR,
    QUANTIDADE,
    SEQUENCIA,
    NUMERO,
    GRADE)
  VALUES (
    :CNPJ,
    :CODIGO,
    :NOME,
    :VALOR,
    :QUANTIDADE,
    :SEQUENCIA,
    :NUMERO,
    :GRADE);
END
^

ALTER PROCEDURE INSERE_FAT_VENDAS_COR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER)
AS
DECLARE VARIABLE COR INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
BEGIN
     FOR SELECT CODIGO, NOME
     FROM EST_COR
     WHERE CNPJ = :CNPJ
     INTO :COR, :NOME
     DO BEGIN
        IF (NOT EXISTS(SELECT CNPJ FROM FAT_VENDAS_COR
        WHERE (CNPJ = :CNPJ) AND (CODIGO = :CODIGO) AND (COR = :COR) AND ( PRODUTO = :PRODUTO ) AND ( SEQUENCIA = :SEQUENCIA )))
        THEN BEGIN
             INSERT INTO FAT_VENDAS_COR (
             CNPJ,
             CODIGO,
             COR,
             PRODUTO,
             NOME,
             QUANTIDADE,
             SEQUENCIA )
             VALUES (
             :CNPJ,
             :CODIGO,
             :COR,
             :PRODUTO,
             :NOME,
             0,
             :SEQUENCIA);
        END
     END
END
^

ALTER PROCEDURE INSERE_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO VARCHAR(3),
    AGENCIA VARCHAR(20),
    CONTA VARCHAR(6),
    CHEQUE VARCHAR(6),
    DVCONTA CHAR(1),
    DVAGENCIA CHAR(1),
    DVCHEQUE CHAR(1),
    AVISTA CHAR(1),
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    USUARIO_CAIXA INTEGER,
    TURNO INTEGER)
AS
BEGIN
  INSERT INTO FAT_VENDAS_FRMPAGTO (
    CNPJ,
    CODIGO,
    FORMA_PGTO,
    SEQUENCIA,
    VALOR_ORIGINAL,
    JUROS,
    TIPO_PAGTO,
    NOME_FORMA,
    BANCO,
    CONTA,
    AGENCIA,
    CHEQUE,
    DV_CONTA ,
    DV_AGENCIA ,
    DV_CHEQUE,
    AVISTA,
    DATA_CAIXA,
    USUARIO_CAIXA,
    CONTA_CAIXA,
    TURNO
    )
  VALUES (
    :CNPJ,
    :CODIGO,
    :FORMA_PGTO,
    :SEQUENCIA,
    :VALOR_ORIGINAL,
    :JUROS,
    :TIPO_PAGTO,
    :NOME_FORMA,
    :BANCO,
    :CONTA,
    :AGENCIA,
    :CHEQUE,
    :DVCONTA ,
    :DVAGENCIA ,
    :DVCHEQUE,
    :AVISTA,
    :DATA_CAIXA,
    :USUARIO_CAIXA,
    :CONTA_CAIXA,
    :TURNO
    );
END
^

ALTER PROCEDURE INSERE_FIN_CHEQUES (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    TIPO CHAR(2),
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    TURNO INTEGER,
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP)
AS
BEGIN
     IF ( VENDA > 0 )
     THEN BEGIN
          INSERT INTO FIN_CHEQUES (
                      CNPJ, BANCO, CONTA, CHEQUE, VENDA, EMISSAO,
                      PRE_DATE, VALOR, CONCILIADO, PESSOA_FJ, HISTORICO,
                      AGENCIA, NOME, TIPO, DIGITO_AGENCIA, DIGITO_CHEQUE, TURNO, USUARIO,
                      DATA_CAIXA
                      )
                       VALUES (
                      :CNPJ, :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO,
                      :PRE_DATE, :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO,
                      :AGENCIA, :NOME, :TIPO, :DIGITO_AGENCIA, :DIGITO_CHEQUE, :TURNO, :USUARIO,
                      :DATA_CAIXA
                      );
     END
     ELSE BEGIN
          INSERT INTO FIN_CHEQUES (
                      CNPJ, BANCO, CONTA, CHEQUE, VENDA, EMISSAO,
                      PRE_DATE, VALOR, CONCILIADO, PESSOA_FJ, HISTORICO,
                      AGENCIA, NOME, TIPO, DIGITO_AGENCIA, DIGITO_CHEQUE,
                      TURNO, USUARIO, DATA_CAIXA
                      )
                       VALUES (
                      :CNPJ, :BANCO, :CONTA, :CHEQUE, NULL, :EMISSAO,
                      :PRE_DATE, :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO,
                      :AGENCIA, :NOME, :TIPO, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
                      :TURNO, :USUARIO, :DATA_CAIXA
                      );
     END
END
^

ALTER PROCEDURE INSERE_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    INDICADO INTEGER,
    PORCENTAGEM NUMERIC(18,4),
    NOME VARCHAR(50),
    INICIO TIMESTAMP)
AS
BEGIN
  INSERT INTO GLO_INDICACOES (
    CNPJ,
    PESSOA_FJ,
    INDICADO,
    PORCENTAGEM,
    NOME,
    INICIO)
  VALUES (
    :CNPJ,
    :PESSOA_FJ,
    :INDICADO,
    :PORCENTAGEM,
    :NOME,
    :INICIO);
END
^

ALTER PROCEDURE INSERE_NOTAFATURA (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    FATURA INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE VLR_RECEBER NUMERIC(18,4);
begin
  /* Procedimento vinculará conta a receber a fatura futura*/
  select sum(coalesce(rec.valor,0) - coalesce(rec.vlr_parcial,0))
  from fin_contas_receber rec  where rec.codigo = :codigo and rec.cnpj = :cnpj and rec.ano = :ano
  into :vlr_receber;

  /*atualizando o total da fatura com o vlr. vindo de conta a receber*/
  update fin_faturas ft set ft.valor = (ft.valor + :vlr_receber)
  where ft.cnpj = :cnpj and ft.codigo = :fatura;

  /*vinculando o contas a receber, com a fatura*/
  update fin_contas_receber rec set rec.fatura = :fatura
  where rec.codigo = :codigo and rec.cnpj = :cnpj and rec.ano = :ano;

  suspend;
END
^

ALTER PROCEDURE INSERE_PRODUTO_PDV (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    NEG_QTDADE_2 CHAR(1),
    PRC_VENDA NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    PROD_PESAVEL CHAR(1),
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CODIGO_INTERNO INTEGER;
BEGIN
  SELECT CODIGO FROM GERAR_CODIGO ('PRODUTOS',1)
  into :CODIGO_INTERNO;

  IF ( NOT EXISTS ( SELECT CODIGO FROM EST_PRODUTOS
                    WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ )
     )
  THEN BEGIN /* INSERE OS PRODUTOS */
   INSERT INTO EST_PRODUTOS (
    CNPJ,
    CODIGO,
    CODIGO_2,
    NOME,
    MARCA,
    GRUPO,
    SUBGRUPO,
    UNIDADE,
    CTE,
    CTIE,
    QTDADE_1,
    QTDADE_2,
    NEG_QTDADE_2,
    COMPLEMENTO_NF,
    PRC_VENDA,
    ALIQUOTA_ECF,
    PROD_PESAVEL,
    ETIQUETA_ENT,
    ATIVO,
    SUBUNIDADE,
    CODIGO_INTERNO,
    ATUALIZA_ARQ_EXTERNO,
    VALIDADE)
   VALUES (
    :CNPJ,
    :CODIGO,
    :CODIGO_2,
    :NOME,
    1,
    1,
    1,
    'UN',
    '1',
    '1',
    0,
    0,
    :NEG_QTDADE_2,
    'N',
    :PRC_VENDA,
    :ALIQUOTA_ECF,
    :PROD_PESAVEL,
    'N',
    'S',
    1,
    :CODIGO_INTERNO,
    :ATUALIZA_ARQ_EXTERNO,
    :VALIDADE
    );
  END /* ALTERANDO O PRODUTO */
  ELSE BEGIN
    UPDATE EST_PRODUTOS
    SET
    CODIGO_2 = :CODIGO_2, NOME = :NOME, NEG_QTDADE_2 = :NEG_QTDADE_2,
    PRC_VENDA = :PRC_VENDA, ALIQUOTA_ECF = :ALIQUOTA_ECF,
    PROD_PESAVEL = :PROD_PESAVEL, ATUALIZA_ARQ_EXTERNO = :ATUALIZA_ARQ_EXTERNO,
    VALIDADE = :VALIDADE
    WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ;
  END
END
^

ALTER PROCEDURE INSERE_SANGRIAS (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA TIMESTAMP,
    TURNO INTEGER,
    VALOR NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     /* CODIGO DA BAIXA */
     SELECT CODIGO FROM GERAR_CODIGO ('SANGRIAS',1)
     into :CODIGO;
     
     INSERT INTO FAT_CAIXAS_SANGRIAS (
     CNPJ, USUARIO, CONTA, DATA, CODIGO, VALOR, TURNO)
     VALUES (:CNPJ,:USUARIO,:CONTA,:DATA,:CODIGO,:VALOR, :TURNO);
END
^

ALTER PROCEDURE INSERE_VALOR_ADICIONAL_FATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4))
AS
begin
     INSERT INTO
     FIN_FATURAS_ADICIONAL
     (CNPJ, CODIGO, DOCUMENTO, HISTORICO, VALOR)
     VALUES
     (:CNPJ, :CODIGO, :DOCUMENTO, :HISTORICO, :VALOR) ;

     suspend;
END
^

ALTER PROCEDURE INSERIR_FIN_FATURAS_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    VALOR_ATUAL NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4))
AS
BEGIN
  INSERT INTO FIN_FATURAS_PARCIAL (
    CNPJ,
    CODIGO,
    SEQUENCIA,
    HISTORICO,
    VALOR,
    DATA_CAIXA,
    USUARIO,
    CONTA,
    PLANILHA,
    VALOR_ANTERIOR,
    JUROS_RECEBIDOS,
    VALOR_ATUAL,
    TURNO,
    DESCONTOS_CONCEDIDOS)
  VALUES (
    :CNPJ,
    :CODIGO,
    :SEQUENCIA,
    :HISTORICO,
    :VALOR,
    :DATA_CAIXA,
    :USUARIO,
    :CONTA,
    :PLANILHA,
    :VALOR_ANTERIOR,
    :JUROS_RECEBIDOS,
    :VALOR_ATUAL,
    :TURNO,
    :DESCONTOS_CONCEDIDOS);
END
^

ALTER PROCEDURE INSERIR_NUMERO_GRADE (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    GRADE CHAR(4),
    NUMERO VARCHAR(6))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE ORDEM INTEGER;
begin
     select count(*) from est_produtos_grades_numeros
     where cnpj = :cnpj and produto = :produto and  grade = :grade and numero = :numero
     into :cont;

     if (:cont is null) then
       cont = 0;

     IF (cont = 0) THEN
     BEGIN
       select max(n.ordem) cnpj from est_produtos_grades_numeros n
       where cnpj = :cnpj and produto = :produto and  grade = :grade
       into :ordem;

       ordem = :ordem + 1;

       insert into est_produtos_grades_numeros
       (cnpj, produto, grade, numero, estoque, ordem )
       values
       (:cnpj, :produto, :grade, :numero, 0, :ordem );
     END
END
^

ALTER PROCEDURE LANCA_CONTAB_PROD_CAIXA_GERAL (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    PLANILHA INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15) CHARACTER SET NONE;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUBGRUPO INTEGER;
DECLARE VARIABLE CONTACREDITO INTEGER;
DECLARE VARIABLE CONTADEBITO INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
begin
     /*  */
    
        FOR SELECT SUM(QUANTIDADE * (PRC_UNITARIO - DESCONTO)),
        GRUPO, SUBGRUPO, SUM(QUANTIDADE)
        FROM FAT_VENDAS_PRODUTOS_CAIXA_GERAL ( :CNPJ, :DATA_CAIXA )
        GROUP BY GRUPO, SUBGRUPO
        INTO :TOTAL, :GRUPO, :SUBGRUPO, :QUANTIDADE
        DO BEGIN
           /* CONTAS DE VENDAS DO GRUPO E SUBGRUPO */
           SELECT VENDAS_C, VENDAS_D FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
           INTO :CONTACREDITO, :CONTADEBITO ;

           PRODUTO = CAST(GRUPO AS CHAR(5));

           DOCUMENTO = 'GRUPO ' || :PRODUTO;

           /* LANCA OS MOVIMENTOS CONTABEIS */
           EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
           (
           :CNPJ, :DATA_CAIXA, 'C', :DOCUMENTO,
           :DOCUMENTO,
           :TOTAL, :CONTACREDITO, 'CX', :PLANILHA,
           0, '', 'A', '', 0
           );

           /* LANCA OS MOVIMENTOS CONTABEIS */
           EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
           (
           :CNPJ, :DATA_CAIXA, 'D', :DOCUMENTO,
           :DOCUMENTO,
           :TOTAL, :CONTADEBITO, 'CX', :PLANILHA,
           0, '', 'A', '', 0
           );
        END
END
^

ALTER PROCEDURE LANCA_CONTABILIDADE_ESTOQUE (
    CNPJ CHAR(14),
    DATA DATE,
    PLANILHA INTEGER)
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE SALDO_ANT NUMERIC(18,4);
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE ESTOQUE INTEGER;
DECLARE VARIABLE ESTOQUE_INI INTEGER;
DECLARE VARIABLE ESTOQUE_FIM INTEGER;
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUB_GRUPO INTEGER;
begin
     /* O CUSTO ARMAZENADO ESTA VINDO DE ULTIMO CUSTO OU CUSTO MEDIO, VARIANDO CONFORME
     PARAMETRO
        O CUSTO É LANCADO NO MOMENTO DO FECHAMENTO DIARIO
     */

     FOR SELECT SUM(POSICAO*CUSTO), GRUPO, SUB_GRUPO
     FROM EST_POSICAO_DIARIA
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     GROUP BY CNPJ, DATA, GRUPO, SUB_GRUPO
     ORDER BY CNPJ, DATA, GRUPO, SUB_GRUPO
     INTO :SOMA, :GRUPO, :SUB_GRUPO
     DO BEGIN

        IF ( SOMA IS NULL )
        THEN BEGIN
             SOMA = 0;
        END

        SELECT ESTOQUE, ESTOQUE_INI, ESTOQUE_FIM
        FROM EST_SUBGRUPOS
        WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO
        AND SUBGRUPO = :SUB_GRUPO
        INTO :ESTOQUE, :ESTOQUE_INI, :ESTOQUE_FIM ;

        IF (( ESTOQUE > 0 ) AND ( ESTOQUE_INI > 0 ))
        THEN BEGIN
             /* SALDO ANTERIOR */
             SELECT SUM( SOMAC - SOMAD ) FROM SALDOANT_CONTA (:CNPJ, :ESTOQUE, :DATA)
             INTO :SALDO_ANT ;

             IF ( SALDO_ANT IS NULL )
             THEN BEGIN
                  SALDO_ANT = 0;
             END

             IF ( NOT ( SALDO_ANT IS NULL ))
             THEN BEGIN
                  IF ( SALDO_ANT < 0 )
                  THEN BEGIN
                       SALDO_ANT = SALDO_ANT * -1;
                  END

                  DOCUMENTO = 'CX EST ' || CAST(GRUPO AS CHAR(3)) || ' ' || CAST(SUB_GRUPO AS CHAR(3));

                  /* LANCA OS MOVIMENTOS CONTABEIS */
                  EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                  (
                  :CNPJ, :DATA, 'C', :DOCUMENTO,
                  :DOCUMENTO,
                  :SALDO_ANT, :ESTOQUE, 'CX', :PLANILHA,
                  0, '', 'A', '', 0
                  );

                  /* LANCA OS MOVIMENTOS CONTABEIS */
                  EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
                  (
                  :CNPJ, :DATA, 'D', :DOCUMENTO,
                  :DOCUMENTO,
                  :SALDO_ANT, :ESTOQUE_INI, 'CX', :PLANILHA,
                  0, '', 'A', '', 0
                  );
             END
        END

        IF (( ESTOQUE > 0 ) AND ( ESTOQUE_FIM > 0 ) AND ( NOT (SOMA IS NULL) ))
        THEN BEGIN
             IF ( SOMA < 0 )
             THEN BEGIN
                  SOMA = SOMA * -1;
             END

             DOCUMENTO = 'CX EST ' || CAST(GRUPO AS CHAR(3)) || ' ' || CAST(SUB_GRUPO AS CHAR(3));

             /* LANCA OS MOVIMENTOS CONTABEIS */
             EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
             (
             :CNPJ, :DATA, 'D', :DOCUMENTO,
             :DOCUMENTO,
             :SOMA, :ESTOQUE, 'CX', :PLANILHA,
             0, '', 'A', '', 0
             );

             /* LANCA OS MOVIMENTOS CONTABEIS */
             EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
             (
             :CNPJ, :DATA, 'C', :DOCUMENTO,
             :DOCUMENTO,
             :SOMA, :ESTOQUE_FIM, 'CX', :PLANILHA,
             0, '', 'A', '', 0
             );
        END

     END
END
^

ALTER PROCEDURE LANCA_CONTABILIDADE_PROD_CAIXA (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    PLANILHA INTEGER,
    TURNO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15) CHARACTER SET NONE;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUBGRUPO INTEGER;
DECLARE VARIABLE CONTACREDITO INTEGER;
DECLARE VARIABLE CONTADEBITO INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
begin
        FOR SELECT SUM(QUANTIDADE * (PRC_UNITARIO - DESCONTO)),
        GRUPO, SUBGRUPO, SUM(QUANTIDADE)
        FROM FAT_VENDAS_PRODUTOS_CAIXA ( :CNPJ, :DATA_CAIXA, :USUARIO, :TURNO )
        GROUP BY GRUPO, SUBGRUPO
        INTO :TOTAL, :GRUPO, :SUBGRUPO, :QUANTIDADE
        DO BEGIN
           /* CONTAS DE VENDAS DO GRUPO E SUBGRUPO */
           SELECT VENDAS_C, VENDAS_D FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
           INTO :CONTACREDITO, :CONTADEBITO ;

           PRODUTO = CAST(GRUPO AS CHAR(5));

           DOCUMENTO = ('GRUPO ' || :PRODUTO);

           /* LANCA OS MOVIMENTOS CONTABEIS */
           EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
           (
           :CNPJ, :DATA_CAIXA, 'C', :DOCUMENTO,
           :DOCUMENTO,
           :TOTAL, :CONTACREDITO, 'CX', :PLANILHA,
           0, '', 'A', '', 0
           );

           /* LANCA OS MOVIMENTOS CONTABEIS */
           EXECUTE PROCEDURE INSERE_CTB_MOVIMENTO_CONTABIL
           (
           :CNPJ, :DATA_CAIXA, 'D', :DOCUMENTO,
           :DOCUMENTO,
           :TOTAL, :CONTADEBITO, 'CX', :PLANILHA,
           0, '', 'A', '', 0
           );
        END
END
^

ALTER PROCEDURE LANCA_CONVENIO_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    HISTORICO VARCHAR(100),
    CODREC INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE PARCELA VARCHAR(6);
BEGIN
     /* GERA O CODIGO E O ANO DO RECEBER */
     CODREC = GEN_ID(FIN_RECEBER_COD_GE, 1);

     /* PARCELA DA VENDA */
     PARCELA = '01/01';

     /* CONTAS A RECEBER */
     INSERT INTO FIN_CONTAS_RECEBER
     (
      CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
      DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
      JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, AVISO,
      DT_AVISO, SELECIONADO, FATURA
     )
     VALUES
     (
      :CNPJ, :CODREC, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
      :DATA, 'ECF ' || CAST(:CODIGO AS VARCHAR(16)),
      :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'N', 'ECF', :CODIGO, NULL,
      NULL, 'N', NULL
     );

     SUSPEND;
END
^

ALTER PROCEDURE LANCA_MOVIMENTO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    TURNO INTEGER)
AS
begin
     INSERT INTO FAT_CAIXAS_MOVIMENTOS
     (CNPJ, USUARIO, CONTA, DATA, VALOR, TIPO,
     DOCUMENTO, HISTORICO, TURNO)
     VALUES
     (:CNPJ, :USUARIO, :CONTA, :DATA, :VALOR, :TIPO,
     :DOCUMENTO, :HISTORICO, :TURNO);

     suspend;
END
^

ALTER PROCEDURE LANCA_PAGAR_PDV (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    HISTORICO VARCHAR(100),
    CODPGR INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE PARCELA VARCHAR(6);
BEGIN
     /* GERA O CODIGO E O ANO DO PAGAR */
     CODPGR = GEN_ID(FIN_PAGAR_COD_GE, 1);

     /* PARCELA */
     PARCELA = '01/01';

     /* CONTAS A PAGAR */
     INSERT INTO FIN_CONTAS_PAGAR
     (
      CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO, DT_VENCTO,
      DT_LANCTO, DOCTO, PARCELA, HISTORICO, VALOR, VLR_PARCIAL,
      JUROS_PAG, DESCONTOS, BOLETO, ORIGEM, AVISO,
      DT_AVISO, SELECIONADO, CENTRO_CUSTO
     )
     VALUES
     (
      :CNPJ, :CODPGR, :ANO, :PESSOA_FJ, :DATA, :VENCTO,
      :DATA, 'ECF ' || CAST(:CODIGO AS VARCHAR(16)),
      :PARCELA, :HISTORICO, :VALOR, 0, 0, 0, 'N', 'ECF', NULL,
      NULL, 'N', 1
     );

     SUSPEND;
END
^

ALTER PROCEDURE LISTA_CCUSTO (
    IDGRP INTEGER)
RETURNS (
    COD_CENTRO INTEGER,
    AGRUPADOR INTEGER,
    CENTRO VARCHAR(50),
    VENCTO DATE,
    VALOR FLOAT,
    PARCIAL FLOAT,
    SALDO FLOAT,
    TIPO CHAR(1))
AS
BEGIN
  for select codigo, nome, agrupador  from fin_centro_custo cct1
      order by nome
      into :cod_centro, :centro, :agrupador
  do
  begin
    for select pgr.dt_vencto, coalesce(pgr.valor,0) valor_nominal, coalesce(pgr.vlr_parcial,0) bx_parcial
        from fin_contas_pagar pgr
        where pgr.centro_custo = :cod_centro
        into :vencto, :valor, :parcial
    do
    begin
        suspend;
    end
  end
END
^

ALTER PROCEDURE LISTA_PRODUTOS_CAIXA (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
DECLARE VARIABLE TIPO_EMPRESA VARCHAR(30);
begin
     SELECT TIPO_EMPRESA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TIPO_EMPRESA ;


          FOR SELECT SUM(QUANTIDADE * (PRC_UNITARIO - DESCONTO)),
          PRODUTO, NOME_PRODUTO, SUM(QUANTIDADE_EXPOSTA), SUM(QUANTIDADE),
          SUM(DESCONTO)
          FROM FAT_VENDAS_PRODUTOS_CAIXA ( :CNPJ, :DATA_CAIXA, :USUARIO, :TURNO )
          GROUP BY PRODUTO, NOME_PRODUTO
          INTO :TOTAL, :PRODUTO, :NOME, :QUANTIDADE_EXPOSTA, :QUANTIDADE, :DESCONTOS
          DO BEGIN
             suspend;
          END
END
^

ALTER PROCEDURE LISTA_PRODUTOS_CAIXA_GERAL (
    CNPJ VARCHAR(50),
    DATA_CAIXA DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    QUANTIDADE_EXPOSTA NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
DECLARE VARIABLE TIPO_EMPRESA VARCHAR(30);
begin
     SELECT TIPO_EMPRESA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TIPO_EMPRESA ;

     FOR SELECT SUM(QUANTIDADE * (PRC_UNITARIO - DESCONTO)),
     PRODUTO, NOME_PRODUTO, SUM(QUANTIDADE_EXPOSTA),
     SUM(QUANTIDADE), SUM(DESCONTO)
     FROM FAT_VENDAS_PRODUTOS_CAIXA_GERAL ( :CNPJ, :DATA_CAIXA )
     GROUP BY PRODUTO, NOME_PRODUTO
     INTO :TOTAL, :PRODUTO, :NOME, :QUANTIDADE_EXPOSTA, :QUANTIDADE, :DESCONTOS
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE LISTA_PRODUTOS_GRADES (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    GRADE CHAR(4),
    MATERIAL INTEGER,
    COR INTEGER,
    ESTOQUE NUMERIC(18,4),
    NOME_MATERIAL VARCHAR(50),
    NOME_COR VARCHAR(50),
    PERFIL INTEGER,
    NOME_PERFIL VARCHAR(50),
    NUMERO VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
      FOR SELECT GRADE, MATERIAL, COR, PERFIL
      FROM EST_PRODUTOS_GRADES
      WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
      INTO :GRADE, :MATERIAL, :COR, :PERFIL
      DO BEGIN

           SELECT NOME FROM EST_MATERIAL
           WHERE CNPJ = :CNPJ AND CODIGO = :MATERIAL
           INTO :NOME_MATERIAL ;
  
           SELECT NOME FROM EST_COR
           WHERE CNPJ = :CNPJ AND CODIGO = :COR
           INTO :NOME_COR ;
  
           SELECT NOME FROM EST_GRADES
           WHERE CNPJ = :CNPJ AND CODIGO = :PERFIL
           INTO :NOME_PERFIL ;
  
           FOR SELECT NUMERO, ORDEM, ESTOQUE
           FROM EST_PRODUTOS_GRADES_NUMEROS
           WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND GRADE = :GRADE
           INTO :NUMERO, :ORDEM, :ESTOQUE
           DO BEGIN
                  IF ( ORDEM IS NULL )
                  THEN BEGIN
                       ORDEM = CAST(NUMERO AS INTEGER) + 100;
                  END
      
                  SUSPEND;
           END
      END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
     /* MENORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_CODIGOMENOR ( :CNPJ, :PRODUTO )
     ORDER BY CODIGO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_CODIGOMAIOR ( :CNPJ, :PRODUTO )
     ORDER BY CODIGO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGO_GRUPO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
     /* MENORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_CODIGOMENOR_G ( :CNPJ, :PRODUTO, :GRUPO, :SUBGRUPO )
     ORDER BY CODIGO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_CODIGOMAIOR_G ( :CNPJ, :PRODUTO, :GRUPO, :SUBGRUPO )
     ORDER BY CODIGO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGOMAIOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;
     
     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO, E.ALIQUOTA_ECF,
           E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND CODIGO > :PRODUTO
     PLAN (E ORDER IDX_EST_PRODUTOS_ATIVO)
     ORDER BY CNPJ ASC, CODIGO ASC , ATIVO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD)
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD)
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGOMAIOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;
     
     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO, E.ALIQUOTA_ECF,
           E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND CODIGO > :PRODUTO
     AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
     PLAN (E ORDER IDX_EST_PRODUTOS_ATIVO)
     ORDER BY CNPJ ASC, CODIGO ASC , ATIVO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD)
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD)
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGOMENOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF , E.COD_AGRUP, E.NOME_MARCA, E.SUBUNIDADE, E.CUSTO_AQUISICAO,
           E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND CODIGO <= :PRODUTO
     ORDER BY CNPJ DESC, CODIGO DESC, ATIVO DESC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :SUBUNIDADE, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = :QTDADE_2 / :SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_CODIGOMENOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF , E.COD_AGRUP, E.NOME_MARCA, E.SUBUNIDADE, E.CUSTO_AQUISICAO,
           E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND CODIGO <= :PRODUTO
     AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
     ORDER BY CNPJ DESC, CODIGO DESC, ATIVO DESC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :SUBUNIDADE, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = :QTDADE_2 / :SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOME (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
     /* MENORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF,
           VALIDADE
     FROM LOCALIZAR_PRODUTO_NOMEMENOR ( :CNPJ, :PRODUTO )
     ORDER BY NOME ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_NOMEMAIOR ( :CNPJ, :PRODUTO )
     ORDER BY NOME ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOME_GRUPO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
BEGIN
     /* MENORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF,
           VALIDADE
     FROM LOCALIZAR_PRODUTO_NOMEMENOR_G ( :CNPJ, :PRODUTO, :GRUPO, :SUBGRUPO )
     ORDER BY NOME ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
           CODIGO, CODIGO_INTERNO, CODIGO_2, NOME, QTDADE_2, QTDADE_1, PRC_VENDA,
           CUSTO, COD_AGRUP, MARCA, PRC_REPOS, ALIQUOTA_ECF, VALIDADE
     FROM LOCALIZAR_PRODUTO_NOMEMAIOR_G ( :CNPJ, :PRODUTO, :GRUPO, :SUBGRUPO )
     ORDER BY NOME ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOMEMAIOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO,
           E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND NOME > :PRODUTO
     PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVO)
     ORDER BY CNPJ ASC, NOME ASC , ATIVO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOMEMAIOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO,
           E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND NOME > :PRODUTO
     AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
     PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVO)
     ORDER BY CNPJ ASC, NOME ASC , ATIVO ASC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF,
          :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOMEMENOR (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO, E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND NOME <= :PRODUTO
     PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVOD)
     ORDER BY CNPJ DESC, NOME DESC , ATIVO DESC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE LOCALIZAR_PRODUTO_NOMEMENOR_G (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    QTDADE_2 NUMERIC(18,4),
    QTDADE_1 NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    MARCA VARCHAR(50),
    COD_AGRUP VARCHAR(15),
    CUSTO VARCHAR(15),
    ALIQUOTA_ECF VARCHAR(5),
    VALIDADE INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO LOAD ;

     CONT = 0;
     
     FOR SELECT
           E.CODIGO, E.CODIGO_INTERNO, E.CODIGO_2, E.NOME, E.QTDADE_2, E.QTDADE_1, E.PRC_VENDA,
           E.PRC_CUSTO_CODIF, E.COD_AGRUP, E.NOME_MARCA, E.CUSTO_AQUISICAO, E.ALIQUOTA_ECF, E.VALIDADE
     FROM EST_PRODUTOS E
     WHERE CNPJ = :CNPJ AND ATIVO = 'S' AND NOME <= :PRODUTO
     AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
     PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVOD)
     ORDER BY CNPJ DESC, NOME DESC , ATIVO DESC
     INTO :CODIGO, :CODIGO_INTERNO, :CODIGO_2, :NOME, :QTDADE_2, :QTDADE_1, :PRC_VENDA,
          :CUSTO, :COD_AGRUP, :MARCA, :PRC_REPOS, :ALIQUOTA_ECF, :VALIDADE
     DO BEGIN
        IF ( QTDADE_2 IS NULL )
        THEN BEGIN
             QTDADE_2 = 0;
        END

        IF ( SUBUNIDADE IS NULL )
        THEN BEGIN
             SUBUNIDADE  = 0;
        END

        IF ( SUBUNIDADE > 0 )
        THEN BEGIN
             QTDADE_2 = QTDADE_2 / SUBUNIDADE ;
        END

        IF ( CONT < :LOAD )
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE MARCA_DUPLICATA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
BEGIN
     /*ATUALIZA O NUMERO DO CUPOM*/
     UPDATE SIS_EMPRESAS
     SET DUPLICATA = :CODIGO
     WHERE CNPJ = :CNPJ ;
END
^

ALTER PROCEDURE MARCA_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1))
AS
BEGIN
     IF ( TIPO = 'S' )
     THEN BEGIN
          UPDATE CTB_MOVIMENTO_CONTABIL
          SET EXCLUIR = 'N'
          WHERE CNPJ = :EMPRESA AND CODIGO = :CODIGO ;
     END
     ELSE BEGIN
          UPDATE CTB_MOVIMENTO_CONTABIL
          SET EXCLUIR = 'S'
          WHERE CNPJ = :EMPRESA AND CODIGO = :CODIGO;
     END
END
^

ALTER PROCEDURE MARCA_NOT_NULL
RETURNS (
    NOMETABELA VARCHAR(50),
    NOMECAMPO VARCHAR(50))
AS
begin
  for SELECT RDB$FIELD_NAME,
      C.RDB$RELATION_NAME
      FROM
      RDB$RELATION_CONSTRAINTS C,
      RDB$INDEX_SEGMENTS S
      WHERE
      C.RDB$CONSTRAINT_TYPE = 'PRIMARY KEY' AND
      S.RDB$INDEX_NAME = C.RDB$INDEX_NAME

      ORDER BY RDB$FIELD_POSITION
  into :nomecampo,
       :nometabela
  do
  begin
    UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = 1
    WHERE RDB$FIELD_NAME = :nomecampo AND RDB$RELATION_NAME= :nometabela;
    suspend;
  end
end
^

ALTER PROCEDURE MARCA_NUMCUPOM (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    NUMERO INTEGER,
    TIPO CHAR(3))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MOV_ESTOQUE VARCHAR(1);
DECLARE VARIABLE ES VARCHAR(1);
BEGIN
     IF ( TIPO = 'ECF' )
     THEN BEGIN
          /* VERIFICA SE JA FOI IMPRESSA UMA NOTA FISCAL */
          SELECT NUM_NF, NATUREZA FROM FAT_VENDAS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
          INTO :NUM_NF, :NATUREZA ;
          
          SELECT MOV_ESTOQUE, ES FROM EST_NATUREZA
          WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
          INTO :MOV_ESTOQUE, :ES ;

          MOV_ESTOQUE = :MOV_ESTOQUE;

          IF (NUM_NF IS NULL)
          THEN
              NUM_NF = 0;
          
          /* MARCA O CUPOM */
          UPDATE FAT_VENDAS
          SET FAT_VENDAS.NUM_CUPOM = :NUMERO
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     
          /*ATUALIZA O NUMERO DO CUPOM*/
          UPDATE SIS_EMPRESAS
          SET ECF_ULTNUMERO = :NUMERO
          WHERE CNPJ = :CNPJ ;
          
          IF ((NUM_NF <= 0) AND ( MOV_ESTOQUE = 'S' ) AND ( ES = 'S' ))
          THEN BEGIN
               /* SOMENTE QUANDO MOVIMENTA ESTOQUE */
               FOR SELECT PRODUTOFIS, QUANTIDADE, UNIDADE, SUBUNIDADE
               FROM FAT_VENDAS_ITENS
               WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
               INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE
               DO BEGIN
                       /* ESTOQUE FISCAL */
                       UPDATE EST_PRODUTOS SET QTDADE_1 = QTDADE_1 - (:QUANTIDADE * :QNTDEUNIDADE)
                       WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
               END
          END
     END
     ELSE BEGIN
          /* VERIFICA SE JA FOI IMPRESSA UMA NOTA FISCAL */
          SELECT NUM_NF, NATUREZA FROM FAT_VENDAS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
          INTO :NUM_NF, :NATUREZA ;
          
          SELECT MOV_ESTOQUE, ES FROM EST_NATUREZA
          WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
          INTO :MOV_ESTOQUE, :ES ;

          MOV_ESTOQUE = :MOV_ESTOQUE;

          IF (NUM_NF IS NULL)
          THEN
              NUM_NF = 0;

          /*ATUALIZA O NUMERO DO CUPOM*/
          SELECT ECF_ULTNUMERO FROM SIS_EMPRESAS
          WHERE CNPJ = :CNPJ
          INTO :NUMERO ;
          
          NUMERO = NUMERO + 1;
          
          /* MARCA O CUPOM */
          UPDATE FAT_VENDAS
          SET FAT_VENDAS.NUM_CUPOM = :NUMERO
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     
          /*ATUALIZA O NUMERO DO CUPOM*/
          UPDATE SIS_EMPRESAS
          SET ECF_ULTNUMERO = :NUMERO
          WHERE CNPJ = :CNPJ ;
          
          IF ((NUM_NF <= 0) AND ( MOV_ESTOQUE = 'S' ) AND ( ES = 'S' ))
          THEN BEGIN
               /* SOMENTE QUANDO MOVIMENTA ESTOQUE */
               FOR SELECT PRODUTOFIS, QUANTIDADE, UNIDADE, SUBUNIDADE
               FROM FAT_VENDAS_ITENS
               WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
               INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE
               DO BEGIN
                       /* ESTOQUE FISCAL */
                       UPDATE EST_PRODUTOS SET QTDADE_1 = QTDADE_1 - (:QUANTIDADE * :QNTDEUNIDADE)
                       WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
               END
          END
          
     END
     
     SUSPEND;
END
^

ALTER PROCEDURE MARCA_NUMNOTA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3),
    DATA_NF DATE)
AS
DECLARE VARIABLE NUMERO INTEGER;
DECLARE VARIABLE NUMERO_SERIE INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE CONFERENOTA INTEGER;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MOV_ESTOQUE VARCHAR(1);
DECLARE VARIABLE ES VARCHAR(1);
DECLARE VARIABLE DUPLICA_NUMERO VARCHAR(1);
BEGIN
     numero = :ultnumero + 1;

     select distinct num_nf, num_cupom, natureza from fat_vendas
     where cnpj = :cnpj and num_nf = :ultnumero and serie = :serie
     into :conferenota, :num_cupom, :natureza ;
     
     if (conferenota is null) then
     begin
       conferenota = 0;
     end
     else begin
          /* verifica se esta série pode duplicar numero de nota fiscal */
          select nota_duplica_numero
          from sis_serienf
          where cnpj = :cnpj and serie = :serie
          into :duplica_numero ;

          if (duplica_numero is null) then
             duplica_numero = 'N' ;

          if (duplica_numero = 'S') then
            conferenota = 0;
     end

     
     if ((conferenota is null) or (conferenota = 0)) then
     begin
        select natureza from fat_vendas
        where cnpj = :cnpj and codigo = :codigo
        into :natureza;

        select mov_estoque, es from est_natureza
        where cnpj = :cnpj and codigo = :natureza
        into :mov_estoque, :es ;

        mov_estoque = :mov_estoque;

        /* marca a nota */
        update fat_vendas vd set vd.num_nf = :ultnumero, serie = :serie, vd.dt_emissao_nf = :data_nf, vd.selecionada = 'N'
        where cnpj = :cnpj and codigo = :codigo ;
     
        /*atualiza a serie, modificado para que a aço forte
        pudesse utilizar uma numeração inferior que esta na tabelas de series
        sem perder a sequencia*/
        select ultimo_numero from sis_serienf  where cnpj = :cnpj and serie = :serie
        into :numero_serie;

        if (:numero > :numero_serie) then
        begin
          update sis_serienf set sis_serienf.ultimo_numero = :numero
          where cnpj = :cnpj and serie = :serie ;
        end

        if (( num_cupom <= 0 ) and ( mov_estoque = 'S' ) and ( es = 'S' )) then
        begin
               /* SOMENTE QUANDO MOVIMENTA ESTOQUE */
               for select produtofis, quantidade, unidade from fat_vendas_itens
                   where cnpj = :cnpj and codigo = :codigo
                   into :produto, :quantidade, :unidade
               do
               begin
                 /* estoque fiscal
                 update est_produtos set qtdade_1 = qtdade_1 - :quantidade
                 where cnpj = :cnpj and codigo = :produto;  */
               end
        end
     end
     else
       exception notaduplicada ;
END
^

ALTER PROCEDURE MARCA_NUMNOTA_AGRUPADA (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3),
    DATA_EMISSAO DATE)
AS
DECLARE VARIABLE NUMERO INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE CONFERENOTA INTEGER;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE MOV_ESTOQUE VARCHAR(1);
DECLARE VARIABLE ES VARCHAR(1);
BEGIN

     NUMERO = :ULTNUMERO + 1;

     SELECT NUM_NF, NUM_CUPOM, NATUREZA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND NUM_NF = :ULTNUMERO AND SERIE = :SERIE
     INTO :CONFERENOTA, :NUM_CUPOM, :NATUREZA ;
     
     IF (NUM_CUPOM IS NULL)
     THEN
         NUM_CUPOM = 0;

     IF ((CONFERENOTA IS NULL) or (CONFERENOTA = 0))
     THEN BEGIN
          /*ATUALIZA A SERIE*/
          UPDATE SIS_SERIENF
          SET SIS_SERIENF.ULTIMO_NUMERO = :NUMERO
          WHERE CNPJ = :CNPJ AND SERIE = :SERIE ;

          FOR SELECT CODIGO
          FROM FAT_VENDAS
          WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
          AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND DUPLICATA = 0 AND
          TIPO_VENDA = 'FFT' AND (( NUM_NF IS NULL ) OR ( NUM_NF <= 0 ))
          INTO :CODIGO
          DO BEGIN
             SELECT NATUREZA
             FROM FAT_VENDAS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             INTO :NATUREZA ;

             SELECT MOV_ESTOQUE, ES FROM EST_NATUREZA
             WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
             INTO :MOV_ESTOQUE, :ES ;

             MOV_ESTOQUE = :MOV_ESTOQUE;

             IF (( NUM_CUPOM <= 0 ) AND ( MOV_ESTOQUE = 'S' ) AND ( ES = 'S' ))
             THEN BEGIN
                  /* SOMENTE QUANDO MOVIMENTA ESTOQUE */
                  FOR SELECT PRODUTOFIS, QUANTIDADE, UNIDADE, SUBUNIDADE
                  FROM FAT_VENDAS_ITENS
                  WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
                  INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE
                  DO BEGIN
                       /* ESTOQUE FISCAL */
                       UPDATE EST_PRODUTOS SET QTDADE_1 = QTDADE_1 - (:QUANTIDADE * :QNTDEUNIDADE)
                       WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO;
                 END
             END
          END

          /* MARCA A NOTA */
          UPDATE FAT_VENDAS
          SET FAT_VENDAS.NUM_NF = :ULTNUMERO, SERIE = :SERIE,
          DT_EMISSAO_AGRUPADA = :DATA_EMISSAO
          WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
          AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND DUPLICATA = 0 AND
          TIPO_VENDA = 'FFT' AND (( NUM_NF IS NULL ) OR ( NUM_NF <= 0 )) AND
          SELECIONADA = 'S' ;
     END
     ELSE BEGIN
          EXCEPTION notaduplicada ;
     END

     SUSPEND ;
END
^

ALTER PROCEDURE MARCA_NUMNOTA_OS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    ULTNUMERO INTEGER,
    SERIE VARCHAR(3))
AS
DECLARE VARIABLE NF INTEGER;
DECLARE VARIABLE NUMERO INTEGER;
BEGIN
     NUMERO = :ULTNUMERO + 1;

     SELECT NF
     FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ AND NF = :ULTNUMERO
     INTO :NF ;
     
     IF ((NF IS NULL) or (NF = 0))
     THEN BEGIN
          /* MARCA A NOTA */
          UPDATE OFC_ORDEM_SERVICO
          SET NF = :ULTNUMERO
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     
          /*ATUALIZA A SERIE*/
          UPDATE SIS_SERIENF
          SET SIS_SERIENF.ULTIMO_NUMERO = :NUMERO
          WHERE CNPJ = :CNPJ AND SERIE = :SERIE ;
     END
     ELSE BEGIN
          EXCEPTION notaduplicada ;
     END
END
^

ALTER PROCEDURE MARCA_RECEBER_LANCAMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA_FJ INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE DT_VENCTO DATE;
BEGIN
     FOR SELECT CODIGO, ANO, VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS,
     DATA_ULT_BAIXA, DT_VENCTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI AND DT_LANCTO <= :DFIM
     AND FATURA IS NULL
     AND PESSOA_FJ = :PESSOA_FJ
     INTO :CODIGO, :ANO, :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS,
     :DATA_ULT_BAIXA, :DT_VENCTO
     DO BEGIN
        PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS );

        IF ( DATA_ULT_BAIXA IS NULL )
        THEN BEGIN
             SELECT RESULT FROM CALCULA_JUROS
             ( :CNPJ, :DT_VENCTO, :DATA_BAIXA, :PARCIAL, 0 )
             INTO :JUROS  ;
        END
        ELSE BEGIN
             SELECT RESULT FROM CALCULA_JUROS
             ( :CNPJ, :DATA_ULT_BAIXA, :DATA_BAIXA, :PARCIAL, 0 )
             INTO :JUROS ;
        END

        UPDATE FIN_CONTAS_RECEBER
        SET SELECIONADO = 'S',
        PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS ),
        JUROS_PARCIAL = :JUROS
        WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     END
END
^

ALTER PROCEDURE MARCA_RECEBER_VENCIMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA_FJ INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE DT_VENCTO DATE;
BEGIN
     FOR SELECT CODIGO, ANO, VALOR, VLR_PARCIAL, JUROS_REC,
     DESCONTOS, DATA_ULT_BAIXA, DT_VENCTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI AND DT_VENCTO <= :DFIM
     AND FATURA IS NULL
     AND PESSOA_FJ = :PESSOA_FJ
     INTO :CODIGO, :ANO, :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS,
     :DATA_ULT_BAIXA, :DT_VENCTO
     DO BEGIN
        /*porque quando é baixado parcialmente pelo pdv, juro */
        /*if ((:vlr_parcial = 0) or (:vlr_parcial is null)) then
           PARCIAL = ( :VALOR - (:VLR_PARCIAL + :JUROS_REC) - :DESCONTOS );
        else
           PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS );*/

        IF ( DATA_ULT_BAIXA IS NULL )
        THEN BEGIN
             /**/
             SELECT RESULT FROM CALCULA_JUROS
             ( :CNPJ, :DT_VENCTO, :DATA_BAIXA, :valor, 0 )
             INTO :JUROS  ;
        END
        ELSE BEGIN
             SELECT RESULT FROM CALCULA_JUROS        /*vlr a ser calculado */
             ( :CNPJ, :DATA_ULT_BAIXA, :DATA_BAIXA, (:VALOR - :VLR_PARCIAL), 0 )
             INTO :JUROS ;
        END

        UPDATE FIN_CONTAS_RECEBER
        SET SELECIONADO = 'S',
        PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS ),
        JUROS_PARCIAL = (:JUROS - :JUROS_REC)
        WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     END

     SUSPEND ;
END
^

ALTER PROCEDURE MARCA_RECEBER_VENCIMENTO_FATURA (
    CNPJ CHAR(14),
    FATURA INTEGER,
    DATA_BAIXA TIMESTAMP)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE PARCIAL NUMERIC(18,4);
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE DT_VENCTO DATE;
BEGIN
     FOR SELECT CODIGO, ANO, VALOR, VLR_PARCIAL, JUROS_REC,
     DESCONTOS, DATA_ULT_BAIXA, DT_VENCTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FATURA
     INTO :CODIGO, :ANO, :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS,
     :DATA_ULT_BAIXA, :DT_VENCTO
     DO BEGIN
        PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS );

        IF ( DATA_ULT_BAIXA IS NULL )
        THEN BEGIN
             SELECT RESULT FROM CALCULA_JUROS
             ( :CNPJ, :DT_VENCTO, :DATA_BAIXA, :PARCIAL, 0 )
             INTO :JUROS  ;
        END
        ELSE BEGIN
             SELECT RESULT FROM CALCULA_JUROS
             ( :CNPJ, :DATA_ULT_BAIXA, :DATA_BAIXA, :PARCIAL, 0 )
             INTO :JUROS ;
        END

        UPDATE FIN_CONTAS_RECEBER
        SET SELECIONADO = 'S',
        PARCIAL = ( :VALOR - :VLR_PARCIAL + :JUROS_REC - :DESCONTOS ),
        JUROS_PARCIAL = :JUROS
        WHERE CODIGO = :CODIGO AND ANO = :ANO ;
     END

     SUSPEND ;
END
^

ALTER PROCEDURE MASCARAIE (
    UF CHAR(2))
RETURNS (
    MASCARA VARCHAR(15))
AS
BEGIN
  FOR SELECT MASCARA_IE
      FROM GLO_ESTADOS
      INTO :MASCARA
  DO
      BEGIN
        SUSPEND;
      END
END
^

ALTER PROCEDURE MEDIA_MENSAL_PAGAMENTOS (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    MEDIA NUMERIC(18,4))
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE VALORES NUMERIC(18,4);
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE CONT INTEGER;
begin
     SOMA = 0;
     CONT = 0;

     FOR SELECT sum(VLR_BAIXA), extract ( month from dt_baixa ), extract ( year from dt_baixa )
     FROM fin_baixas_receber
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CLIENTE
     GROUP BY cnpj, pessoa_fj, extract ( month from dt_baixa ), extract ( year from dt_baixa )
     INTO :VALORES, MES, ANO
     DO BEGIN
        SOMA = SOMA + :VALORES ;
        CONT = CONT + 1;
     END

     IF ( CONT > 0 )
     THEN
       MEDIA = SOMA / CONT;
     ELSE
       MEDIA = 0;

     SUSPEND ;
END
^

ALTER PROCEDURE MIGRAR_FAT_CUPOM (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE USUARIO INTEGER;
DECLARE VARIABLE DATA TIMESTAMP;
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE CONVENIO NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE ACRES_DESC NUMERIC(18,4);
DECLARE VARIABLE CANCELADO CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUM INTEGER;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(5);
DECLARE VARIABLE PRC_UNIT_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE ALIQUOTA VARCHAR(5);
BEGIN
     SELECT PDV_NATUREZA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :NATUREZA ;

      FOR SELECT CODIGO, USUARIO,
          DATA, DINHEIRO, CHEQUE, TICKET,
          CONVENIO, CARTAO, TOTAL, TROCO,
          ACRES_DESC, CANCELADO, PESSOA_FJ, NOME
      FROM FAT_CUPOM
/*      WHERE CNPJ = :CNPJ AND DATA >= :DINI AND DATA <= :DFIM*/
      INTO :CODIGO, :USUARIO, :DATA, :DINHEIRO, :CHEQUE,
           :TICKET, :CONVENIO, :CARTAO, :TOTAL, :TROCO, :ACRES_DESC,
           :CANCELADO, :PESSOA_FJ, :NOME
      DO BEGIN
         IF ( PESSOA_FJ IS NULL )
         THEN BEGIN
              PESSOA_FJ = 1;
         END

/*         SELECT COUNT(*) FROM FAT_VENDAS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO :NUM ;*/

         NUM = 0;

         IF (( NUM = 0 ) OR ( NUM IS NULL ))
         THEN BEGIN
              INSERT INTO FAT_VENDAS
              (
               CNPJ                   ,
               CODIGO                 ,
               DATA                   ,
               FECHADA                ,
               HISTORICO              ,
               PESSOA_FJ              ,
               USUARIO                ,
               VENDEDOR               ,
               NATUREZA               ,
               ENVIADA_CX             ,
               FORMA_PGTO             ,
               NUM_CUPOM              ,
               DESC_ACRES             ,
               DINHEIRO               ,
               CHEQUE                 ,
               CARTAO                 ,
               TICKET                 ,
               TOTAL                  ,
               TIPO_VENDA             ,
               NOME                   ,
               DATA_CAIXA             ,
               CANCELADA              ,
               SELECIONADA
               )
               VALUES
               (
               :CNPJ                   ,
               :CODIGO                 ,
               :DATA                   ,
               'S'                     ,
               'CUPOM FISCAL'          ,
               :PESSOA_FJ              ,
               :USUARIO                ,
               1                       ,
               :NATUREZA               ,
               'S'                     ,
               1                       ,
               :CODIGO                 ,
               :ACRES_DESC             ,
               :DINHEIRO               ,
               :CHEQUE                 ,
               :CARTAO                 ,
               :TICKET                 ,
               :TOTAL                  ,
               'Ven'                   ,
               :NOME                   ,
               :DATA                   ,
               'N'                     ,
               'N'
               ) ;

             /* ITENS DA VENDA */
             FOR SELECT
                 PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, DESCONTO,
                 UNIDADE, PRC_UNIT_ORIGINAL, NOME, ALIQUOTA
             FROM FAT_CUPOM_ITENS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             INTO
                 :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO, DESCONTO,
                 :UNIDADE, :PRC_UNIT_ORIGINAL, :NOME_PRODUTO, :ALIQUOTA
             DO BEGIN
                INSERT INTO
                FAT_VENDAS_ITENS
                (
                 CNPJ,
                 CODIGO,
                 PRODUTO,
                 SEQUENCIA,
                 QUANTIDADE,
                 PRC_UNITARIO,
                 PRC_CUSTO,
                 ICM,
                 IPI,
                 UNIDADE,
                 PRC_UNIT_ORIGINAL,
                 NOME_PRODUTO,
                 ALIQUOTA,
                 SUBUNIDADE
                )
                VALUES
                (
                 :CNPJ,
                 :CODIGO,
                 :PRODUTO,
                 :SEQUENCIA,
                 :QUANTIDADE,
                 :PRC_UNITARIO,
                 :PRC_CUSTO,
                 0,
                 0,
                 :UNIDADE,
                 :PRC_UNITARIO,
                 :NOME_PRODUTO,
                 :ALIQUOTA,
                 1
                ) ;
             END

         END
      END
      
/*      FOR SELECT CODIGO
      FROM FAT_CUPOM
      WHERE CNPJ = :CNPJ AND DATA >= :DINI AND DATA <= :DFIM
      INTO :CODIGO
      DO BEGIN
         DELETE
         FROM FAT_CUPOM_ITENS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
      END

      /* APAGANDO OS CUPONS*/
/*      DELETE
      FROM FAT_CUPOM
      WHERE CNPJ = :CNPJ AND DATA >= :DINI AND DATA <= :DFIM ;
*/
END
^

ALTER PROCEDURE NAOCONCILIADOS (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1))
AS
begin
     FOR SELECT DATA, COD_DOC, DOCUMENTO, HISTORICO, VALOR, TIPO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND CONTA = :CONTA AND DATA <= :D
     AND DATA_CONCILIACAO IS NULL
     ORDER BY DATA, COD_DOC, DOCUMENTO
     INTO :DATA, :COD_DOC, :DOCUMENTO, :HISTORICO, :VALOR, :TIPO
     DO BEGIN
        suspend;
     END
END
^

ALTER PROCEDURE NFE_CLIENTE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    CLIENTE VARCHAR(500))
AS
DECLARE VARIABLE RAZAO_SOCIAL VARCHAR(60);
DECLARE VARIABLE IE VARCHAR(14);
DECLARE VARIABLE CPF_CNPJ VARCHAR(14);
DECLARE VARIABLE TIPO_DOCTO VARCHAR(4);
DECLARE VARIABLE CIDADE VARCHAR(60);
DECLARE VARIABLE UF VARCHAR(2);
DECLARE VARIABLE CDD_COD_IBGE VARCHAR(4);
DECLARE VARIABLE LOGRADOURO VARCHAR(60);
DECLARE VARIABLE END_NUMERO VARCHAR(60);
DECLARE VARIABLE PARTE1 VARCHAR(250);
DECLARE VARIABLE PARTE2 VARCHAR(250);
DECLARE VARIABLE BAIRRO VARCHAR(60);
DECLARE VARIABLE PESSOA VARCHAR(1);
DECLARE VARIABLE ISUF VARCHAR(2);
DECLARE VARIABLE COMPLEMENTO VARCHAR(60);
DECLARE VARIABLE CNAE CHAR(2);
DECLARE VARIABLE CEP VARCHAR(8);
DECLARE VARIABLE COD_PAIS VARCHAR(4);
DECLARE VARIABLE PAIS VARCHAR(60);
DECLARE VARIABLE FONE VARCHAR(20);
begin
  select substring(psa.nome_razao from 1 for 60), psa.cpf_cgc,substring(coalesce(psa.rg_ie,'') from 1 for 14),
  substring(coalesce(lgd.nome,'') from 1 for 60),  substring(psa.numero from 1 for 60),
  substring(coalesce(br.nome,'') from 1 for 60), cdd.cod_ibge, substring(coalesce(cdd.nome,'') from 1 for 60),
  psa.uf, psa.pessoa, coalesce(psa.complemento,''), psa.cep, psa.fone  from glo_pessoas_fj psa
  left join glo_logradouros lgd on (lgd.cnpj = psa.cnpj and psa.endereco = lgd.codigo)
  left join glo_bairros br on (br.cnpj = psa.cnpj and psa.bairro = br.codigo)
  left join glo_cidades cdd on (cdd.cnpj = psa.cnpj and psa.cidade = cdd.codigo)
  where psa.codigo = :codigo and psa.cnpj = :cnpj
  into :razao_social, :cpf_cnpj, :ie,
  :logradouro, :end_numero,
  :bairro, :cdd_cod_ibge, :cidade, :uf, :pessoa, :complemento,
  :cep, :fone;

  cliente = 'A|1.10|';
  suspend;
  /*Montando o retorno do registro*/
  /*tipo docto = "CNPJ ou "CPF"" - Obrigatorio*/
  if (:pessoa = 'J') then
    tipo_docto = 'CNPJ';
  else
  begin
    tipo_docto = 'CPF';
    IE = '';
  end

  /*numDoc = ":cpf-cnpj " - Obrigatorio
  xNome  = ":Razao-Social" - Obrigatorio
  IE = ":IE" -  Opcional         X-------------->*/
       /*Informar a IE quando o destinatário for contribuinte do ICMS.
        Informar ISENTO quando o destinatário for contribuinte do ICMS, mas não
        estiver obrigado à inscrição no cadastro de contribuintes do ICMS.
        Não informar se o destinatário não for contribuinte do ICMS.

  Não vou pegar a IE do manager, pois quando o cadastro é de pessoa fisica
  o campo IE passa ser RG, mas caso a pessoa fisica tenha alguma propriedade
  e a NF tenha sido faturada para esta propriedade então ele terá de utilizar a IE da propriedade
  */



/*ISUF = "Inscrição na SUFRAMA" - Opcional         X-------------->*/
  ISUF = '';

  /*  xLgr = ":Logradouro" - Opcional         X-------------->*/
  logradouro = coalesce(:logradouro,'');

  /* nro = "END_NUMERO" - Opcional         X-------------->*/
  end_numero = coalesce(:end_numero,'');

  /* xCpl = "Complemento" - Opcional         X-------------->*/
  if (:complemento = '') then


  /*xBairro = ":Bairro" - Opcional         X-------------->*/
  bairro = coalesce(:bairro,'');

  /*cMun = ":CDD_COD_IBGE" - Opcional         X--------------> */
  cdd_cod_ibge = coalesce(:cdd_cod_ibge,'');

  /* xMun = ":cidade" - Opcional         X-------------->*/
  cidade = coalesce(:cidade,'');

  /*UF = ":UF" - Obrigatorio*/
  uf = coalesce(:uf,'');

  /*CEP = "Código do CEP" - Opcional         X--------------> */
  cep = coalesce(:cep,'');

  /* cPais = "Código do País 1058" - Opcional         X--------------> */
  cod_pais = '1058';

  /* xPais = "Brasil" - Obrigatorio - Opcional         X--------------> */
  pais = 'BRASIL';

  /*fone = "Telefone" - Opcional         X--------------> */
  fone = coalesce(:fone,'');

  parte1 = :tipo_docto||'|'||:cpf_cnpj||'|'||:razao_social||'|'||:IE||'|'||:isuf||'|'||:logradouro||'|'||:end_numero||'|';
  parte2 = :complemento||'|'||:bairro||'|'||:cdd_cod_ibge||'|'||:cidade||'|'||:uf||'|'||:cep||'|'||:cod_pais||'|'||:pais||'|'||:fone||'|';

  cliente = 'E|'||:parte1||:parte2;
  suspend;
END
^

ALTER PROCEDURE NFE_EMITENTE (
    CNPJ VARCHAR(14))
RETURNS (
    EMITENTE VARCHAR(500))
AS
DECLARE VARIABLE RAZAO_SOCIAL VARCHAR(60);
DECLARE VARIABLE IE VARCHAR(14);
DECLARE VARIABLE CIDADE VARCHAR(60);
DECLARE VARIABLE UF VARCHAR(2);
DECLARE VARIABLE CDD_COD_IBGE INTEGER;
DECLARE VARIABLE LOGRADOURO VARCHAR(60);
DECLARE VARIABLE END_NUMERO VARCHAR(60);
DECLARE VARIABLE PARTE1 VARCHAR(250);
DECLARE VARIABLE PARTE2 VARCHAR(250);
DECLARE VARIABLE BAIRRO VARCHAR(60);
begin
  select substring(e.nome from 1 for 60), substring(e.ie from 1 for 14), substring(lgd.nome from 1 for 60),
  substring(e.end_numero from 1 for 60),substring(br.nome from 1 for 60), cdd.cod_ibge,
  substring(cdd.nome from 1 for 60), e.uf  from sis_empresas e
  inner join glo_logradouros lgd on (lgd.cnpj = e.cnpj and e.cod_logradouro = lgd.codigo)
  inner join glo_bairros br on (br.cnpj = e.cnpj and e.cod_bairro = br.codigo)
  inner join glo_cidades cdd on (cdd.cnpj = e.cnpj and e.cod_cidade = cdd.codigo)
  where e.cnpj = :cnpj
  into :razao_social, :ie,:logradouro,
  :end_numero, :bairro, :cdd_cod_ibge, :cidade, :uf;

  /*Montando o retorno do registro
  tipo docto = "CNPJ" - Obrigatorio
  numDoc = ":cnpj" - Obrigatorio
  xNome  = ":Razao-Social" - Obrigatorio
  xFant = "Nome fantasia" - Opcional         X-------------->
  IE = ":IE" - Obrigatorio
  IEST = IE do Substituto Tributário - Opcional         X-------------->
  IM = "Inscrição Municipal" - Opcional         X-------------->
  CNAE = "CNAE fiscal" - Opcional         X-------------->
  xLgr = ":Logradouro" - Obrigatorio
  nro = "END_NUMERO" - Obrigatorio
  xCpl = "Complemento" - Opcional         X-------------->
  xBairro = ":Bairro" - Obrigatorio
  cMun = ":CDD_COD_IBGE" - Obrigatorio
  xMun = ":cidade" - Obrigatorio
  UF = ":UF" - Obrigatorio
  CEP = "Código do CEP" - Opcional         X-------------->
  cPais = "Código do País 1058" - Obrigatorio
  xPais = "Brasil" - Obrigatorio
  fone = "Telefone" - Opcional         X-------------->
  */

  parte1 = 'CNPJ'||'|'||:cnpj||'|'||:razao_social||'|||'||:ie||'| || || ||'||:logradouro||'|'||:end_numero;
  parte2 = '|||'||:bairro||'|'||:cdd_cod_ibge||'|'||:cidade||'|'||:uf||'|||'||'1058'||'|'||'BRASIL'||'|||';
  emitente = :parte1||:parte2;

  suspend;
END
^

ALTER PROCEDURE NFE_GMB_GERA_CLIENTE
RETURNS (
    CLIENTE VARCHAR(500))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
begin
  for select psa.codigo, psa.cnpj from glo_pessoas_fj psa
      into :codigo, :cnpj
  do
  begin
    for select cliente from nfe_cliente(:cnpj,:codigo)
        into :cliente
    do
    begin
      suspend;
    end
  end
END
^

ALTER PROCEDURE NFE_GMB_GERA_PRODUTO
RETURNS (
    LINHA VARCHAR(500))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
begin
  for select prd.cnpj, prd.codigo from est_produtos prd
      into :cnpj, :codigo
  do
  begin
    for select linha from nfe_produto(:cnpj,:codigo)
        into :linha
    do
    begin
      suspend;
    end
  end
END
^

ALTER PROCEDURE NFE_GMB_GERA_TRANSPORTADORA
RETURNS (
    TRANSPORTADORA VARCHAR(500))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
begin
  for select tp.codigo, tp.cnpj from glo_transportadoras tp
      into :codigo, :cnpj
  do
  begin
    for select transportadora from nfe_transportadora(:cnpj,:codigo)
        into :transportadora
    do
    begin
      suspend;
    end
  end
END
^

ALTER PROCEDURE NFE_NOTAFISCAL (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    XXBSERIE VARCHAR(3),
    XXBTPEMIS CHAR(1),
    XXBCDV CHAR(1),
    XXBFINNFE CHAR(1))
RETURNS (
    LINHA VARCHAR(1000))
AS
DECLARE VARIABLE ID VARCHAR(4);
DECLARE VARIABLE BCUF VARCHAR(2);
DECLARE VARIABLE BCNF VARCHAR(9);
DECLARE VARIABLE BNATOP VARCHAR(60);
DECLARE VARIABLE BINDPAG CHAR(1);
DECLARE VARIABLE BMOD VARCHAR(2);
DECLARE VARIABLE BSERIE VARCHAR(3);
DECLARE VARIABLE BNNF INTEGER;
DECLARE VARIABLE BDEMI VARCHAR(10);
DECLARE VARIABLE BSAIENT VARCHAR(8);
DECLARE VARIABLE BTPNF CHAR(1);
DECLARE VARIABLE BCMUNFG VARCHAR(7);
DECLARE VARIABLE BTPIMP CHAR(1);
DECLARE VARIABLE BTPEMIS CHAR(1);
DECLARE VARIABLE BCDV CHAR(1);
DECLARE VARIABLE BTPAMB CHAR(1);
DECLARE VARIABLE BFINNFE CHAR(1);
DECLARE VARIABLE BPROCEMI CHAR(1);
DECLARE VARIABLE BVERPROC VARCHAR(20);
DECLARE VARIABLE B13REFNFE VARCHAR(40);
DECLARE VARIABLE B14CUF CHAR(2);
DECLARE VARIABLE B14AAMM VARCHAR(4);
DECLARE VARIABLE B14CNPJ VARCHAR(14);
DECLARE VARIABLE B14MOD CHAR(2);
DECLARE VARIABLE B14SERIE CHAR(3);
DECLARE VARIABLE B14NNF CHAR(9);
DECLARE VARIABLE CXNOME VARCHAR(60);
DECLARE VARIABLE CXFANT VARCHAR(60);
DECLARE VARIABLE CIE VARCHAR(14);
DECLARE VARIABLE CIEST VARCHAR(14);
DECLARE VARIABLE CIM VARCHAR(15);
DECLARE VARIABLE CNAE VARCHAR(7);
DECLARE VARIABLE C02CNPJ VARCHAR(14);
DECLARE VARIABLE C02ACPF VARCHAR(11);
DECLARE VARIABLE C05XLGR VARCHAR(60);
DECLARE VARIABLE C05NRO VARCHAR(60);
DECLARE VARIABLE C05CXPL VARCHAR(60);
DECLARE VARIABLE C05XBAIRRO VARCHAR(60);
DECLARE VARIABLE C05CMUN VARCHAR(7);
DECLARE VARIABLE C05XMUN VARCHAR(60);
DECLARE VARIABLE C05UF VARCHAR(2);
DECLARE VARIABLE C05CEP VARCHAR(8);
DECLARE VARIABLE C05CPAIS VARCHAR(4);
DECLARE VARIABLE C05XPAIS VARCHAR(60);
DECLARE VARIABLE C05FONE VARCHAR(10);
DECLARE VARIABLE EXNOME VARCHAR(60);
DECLARE VARIABLE EIE VARCHAR(14);
DECLARE VARIABLE EISUF VARCHAR(9);
DECLARE VARIABLE E02CNPJ VARCHAR(14);
DECLARE VARIABLE E03CPF VARCHAR(11);
DECLARE VARIABLE E05XLGR VARCHAR(60);
DECLARE VARIABLE E05NRO VARCHAR(60);
DECLARE VARIABLE E05XCPL VARCHAR(60);
DECLARE VARIABLE E05XBAIRRO VARCHAR(60);
DECLARE VARIABLE E05CMUN VARCHAR(7);
DECLARE VARIABLE E05XMUN VARCHAR(60);
DECLARE VARIABLE E05UF VARCHAR(2);
DECLARE VARIABLE E05CEP VARCHAR(8);
DECLARE VARIABLE E05CPAIS VARCHAR(14);
DECLARE VARIABLE E05XPAIS VARCHAR(60);
DECLARE VARIABLE E05FONE VARCHAR(10);
DECLARE VARIABLE FCNPJ VARCHAR(14);
DECLARE VARIABLE FXLGR VARCHAR(60);
DECLARE VARIABLE FNRO VARCHAR(60);
DECLARE VARIABLE FXCPL VARCHAR(60);
DECLARE VARIABLE FXBAIRRO VARCHAR(60);
DECLARE VARIABLE FCMUN VARCHAR(7);
DECLARE VARIABLE FXMUN VARCHAR(60);
DECLARE VARIABLE FUF VARCHAR(2);
DECLARE VARIABLE GCNPJ VARCHAR(14);
DECLARE VARIABLE GXLGR VARCHAR(60);
DECLARE VARIABLE GNRO VARCHAR(60);
DECLARE VARIABLE GXCPL VARCHAR(60);
DECLARE VARIABLE GXBAIRRO VARCHAR(60);
DECLARE VARIABLE GCMUN VARCHAR(7);
DECLARE VARIABLE GXMUN VARCHAR(60);
DECLARE VARIABLE GUF VARCHAR(2);
DECLARE VARIABLE HNITEM VARCHAR(3);
DECLARE VARIABLE HINFADPROD VARCHAR(500);
DECLARE VARIABLE ICPROD VARCHAR(60);
DECLARE VARIABLE ICEAN VARCHAR(14);
DECLARE VARIABLE IXPROD VARCHAR(120);
DECLARE VARIABLE INCM VARCHAR(8);
DECLARE VARIABLE IEXTIPI VARCHAR(3);
DECLARE VARIABLE IGENERO VARCHAR(2);
DECLARE VARIABLE ICFOP VARCHAR(4);
DECLARE VARIABLE IUCOM VARCHAR(6);
DECLARE VARIABLE IQCOM VARCHAR(16);
DECLARE VARIABLE IVUNCOM VARCHAR(20);
DECLARE VARIABLE IVPROD VARCHAR(17);
DECLARE VARIABLE ICEANTRIB VARCHAR(14);
DECLARE VARIABLE IUTRIB VARCHAR(6);
DECLARE VARIABLE IQTRIB VARCHAR(16);
DECLARE VARIABLE IVUNTRIB VARCHAR(20);
DECLARE VARIABLE IVFRETE VARCHAR(17);
DECLARE VARIABLE IVSEG VARCHAR(17);
DECLARE VARIABLE IVDESC VARCHAR(17);
DECLARE VARIABLE I18NDI VARCHAR(10);
DECLARE VARIABLE I18DDI VARCHAR(8);
DECLARE VARIABLE I18XLOCDESEMB VARCHAR(60);
DECLARE VARIABLE I18UFDESEMB VARCHAR(2);
DECLARE VARIABLE I18DDESEMB VARCHAR(8);
DECLARE VARIABLE I18CEXPORTADOR VARCHAR(60);
DECLARE VARIABLE I25NADICAO VARCHAR(3);
DECLARE VARIABLE I25NSEQADIC VARCHAR(3);
DECLARE VARIABLE I25CFABRICANTE VARCHAR(60);
DECLARE VARIABLE IVDESCDI VARCHAR(17);
DECLARE VARIABLE N02ORIG CHAR(1);
DECLARE VARIABLE N02CST CHAR(2);
DECLARE VARIABLE N02MODBC CHAR(1);
DECLARE VARIABLE N02VBC VARCHAR(17);
DECLARE VARIABLE N02PICMS VARCHAR(7);
DECLARE VARIABLE N02VICMS VARCHAR(17);
DECLARE VARIABLE N03ORIG CHAR(1);
DECLARE VARIABLE N03CST VARCHAR(10);
DECLARE VARIABLE N03MODBC CHAR(1);
DECLARE VARIABLE N03VBC VARCHAR(17);
DECLARE VARIABLE N03PICMS VARCHAR(7);
DECLARE VARIABLE N03VICMS VARCHAR(17);
DECLARE VARIABLE N03MODBCST CHAR(1);
DECLARE VARIABLE N03PMVAST VARCHAR(7);
DECLARE VARIABLE N03PREDBCST VARCHAR(7);
DECLARE VARIABLE N03VBCST VARCHAR(17);
DECLARE VARIABLE N03PICMSST VARCHAR(7);
DECLARE VARIABLE N03VICMSST VARCHAR(17);
DECLARE VARIABLE N04ORIG CHAR(1);
DECLARE VARIABLE N04CST CHAR(2);
DECLARE VARIABLE N04MODBC CHAR(1);
DECLARE VARIABLE N04PREDBC VARCHAR(7);
DECLARE VARIABLE N04VBC VARCHAR(17);
DECLARE VARIABLE N04PICMS VARCHAR(7);
DECLARE VARIABLE N04VICMS VARCHAR(17);
DECLARE VARIABLE N05ORIG CHAR(1);
DECLARE VARIABLE N05CST CHAR(2);
DECLARE VARIABLE N05MODBCST CHAR(1);
DECLARE VARIABLE N05PMVAST VARCHAR(7);
DECLARE VARIABLE N05PREDBCST VARCHAR(7);
DECLARE VARIABLE N05VBCST VARCHAR(17);
DECLARE VARIABLE N05PICMSST VARCHAR(7);
DECLARE VARIABLE N05VICMSST VARCHAR(17);
DECLARE VARIABLE N06ORIG CHAR(1);
DECLARE VARIABLE N06CST CHAR(2);
DECLARE VARIABLE N07ORIG CHAR(1);
DECLARE VARIABLE N07CST CHAR(2);
DECLARE VARIABLE N07MODBC CHAR(1);
DECLARE VARIABLE N07PREDBC VARCHAR(7);
DECLARE VARIABLE N07VBC VARCHAR(17);
DECLARE VARIABLE N07PICMS VARCHAR(7);
DECLARE VARIABLE N07VICMS VARCHAR(17);
DECLARE VARIABLE N08ORIG CHAR(1);
DECLARE VARIABLE N08CST CHAR(2);
DECLARE VARIABLE N08VBCST VARCHAR(17);
DECLARE VARIABLE N08VICMSST VARCHAR(17);
DECLARE VARIABLE N09ORIG CHAR(1);
DECLARE VARIABLE N09CST CHAR(2);
DECLARE VARIABLE N09MODBC CHAR(1);
DECLARE VARIABLE N09PREDBC VARCHAR(7);
DECLARE VARIABLE N09VBC VARCHAR(17);
DECLARE VARIABLE N09PICMS VARCHAR(7);
DECLARE VARIABLE N09VICMS VARCHAR(17);
DECLARE VARIABLE N09MODBCST CHAR(1);
DECLARE VARIABLE N09PMVAST VARCHAR(7);
DECLARE VARIABLE N09PREDBCST VARCHAR(7);
DECLARE VARIABLE N09VBCST VARCHAR(17);
DECLARE VARIABLE N09PICMSST VARCHAR(7);
DECLARE VARIABLE N09VICMSST VARCHAR(17);
DECLARE VARIABLE N10ORIG CHAR(1);
DECLARE VARIABLE N10CST CHAR(2);
DECLARE VARIABLE N10MODBC CHAR(1);
DECLARE VARIABLE N10PREDBC VARCHAR(7);
DECLARE VARIABLE N10VBC VARCHAR(17);
DECLARE VARIABLE N10PICMS VARCHAR(7);
DECLARE VARIABLE N10VICMS VARCHAR(17);
DECLARE VARIABLE N10MODBCST CHAR(1);
DECLARE VARIABLE N10PMVAST VARCHAR(7);
DECLARE VARIABLE N10PREDBCST VARCHAR(7);
DECLARE VARIABLE N10VBCST VARCHAR(17);
DECLARE VARIABLE N10PICMSST VARCHAR(7);
DECLARE VARIABLE N10VICMSST VARCHAR(17);
DECLARE VARIABLE W02VBC VARCHAR(17);
DECLARE VARIABLE W02VICMS VARCHAR(17);
DECLARE VARIABLE W02VBCST VARCHAR(17);
DECLARE VARIABLE W02VST VARCHAR(17);
DECLARE VARIABLE W02VPROD VARCHAR(17);
DECLARE VARIABLE W02VFRETE VARCHAR(17);
DECLARE VARIABLE W02VSEG VARCHAR(17);
DECLARE VARIABLE W02VDESC VARCHAR(17);
DECLARE VARIABLE W02VII VARCHAR(17);
DECLARE VARIABLE W02VIPI VARCHAR(17);
DECLARE VARIABLE W02VPIS VARCHAR(17);
DECLARE VARIABLE W02VCOFINS VARCHAR(17);
DECLARE VARIABLE W02VOUTRO VARCHAR(17);
DECLARE VARIABLE W02VNF VARCHAR(17);
DECLARE VARIABLE X03NOME VARCHAR(60);
DECLARE VARIABLE X03IE VARCHAR(60);
DECLARE VARIABLE X03XENDER VARCHAR(60);
DECLARE VARIABLE X03UF CHAR(2);
DECLARE VARIABLE X03XMUN VARCHAR(60);
DECLARE VARIABLE XXBDEMI DATE;
DECLARE VARIABLE XXBDEMIDIA INTEGER;
DECLARE VARIABLE XXBDEMIDIA_S VARCHAR(2);
DECLARE VARIABLE XXBDEMIMES INTEGER;
DECLARE VARIABLE XXBDEMIMES_S VARCHAR(2);
DECLARE VARIABLE XXBDEMIANO INTEGER;
DECLARE VARIABLE XXIDAGRUPADOR INTEGER;
DECLARE VARIABLE XXIVFRETE NUMERIC(15,2);
DECLARE VARIABLE XXIVSEG NUMERIC(15,2);
DECLARE VARIABLE XXIVDESC NUMERIC(15,2);
DECLARE VARIABLE XXNFE_CHAVE VARCHAR(40);
DECLARE VARIABLE XXB14AAMM DATE;
DECLARE VARIABLE XXB14SERIE VARCHAR(3);
DECLARE VARIABLE XXB14NNF VARCHAR(9);
DECLARE VARIABLE XXRET_SUB_B CHAR(1);
DECLARE VARIABLE XXEPROPRIEDADE INTEGER;
DECLARE VARIABLE XXETIPOPESSOA CHAR(1);
DECLARE VARIABLE XXECPFCNPJ VARCHAR(14);
DECLARE VARIABLE XXETROCA_PROPRIEDADE CHAR(1);
DECLARE VARIABLE XXHNITEM INTEGER;
DECLARE VARIABLE XXGFRETE NUMERIC(15,2);
DECLARE VARIABLE XXGTOTAL NUMERIC(15,2);
DECLARE VARIABLE XXGDESCONTO NUMERIC(15,2);
DECLARE VARIABLE XXGSEGURO NUMERIC(15,2);
DECLARE VARIABLE XXGOUTROS NUMERIC(15,2);
DECLARE VARIABLE XXIREP NUMERIC(15,2);
DECLARE VARIABLE XXICTE INTEGER;
DECLARE VARIABLE XXICTIE INTEGER;
DECLARE VARIABLE XXTIPO_TRIB INTEGER; /* Qual a tributação se considerará (Estadual o InterEstadual) */
DECLARE VARIABLE XXNORIGEM INTEGER;
DECLARE VARIABLE XXNREDUCAO INTEGER;
DECLARE VARIABLE XXNPCTREDUCAO NUMERIC(15,2);
DECLARE VARIABLE XXW02VBC NUMERIC(15,2);
DECLARE VARIABLE XXW02VICMS NUMERIC(15,2);
DECLARE VARIABLE XXW02VBCST NUMERIC(15,2);
DECLARE VARIABLE XXW02VST NUMERIC(15,2);
DECLARE VARIABLE XXW02VPROD NUMERIC(15,2);
DECLARE VARIABLE XXW02VFRETE NUMERIC(15,2);
DECLARE VARIABLE XXW02VSEG NUMERIC(15,2);
DECLARE VARIABLE XXW02VDESC NUMERIC(15,2);
DECLARE VARIABLE XXW02VII NUMERIC(15,2);
DECLARE VARIABLE XXW02VIPI NUMERIC(15,2);
DECLARE VARIABLE XXW02VPIS NUMERIC(15,2);
DECLARE VARIABLE XXW02VCOFINS NUMERIC(15,2);
DECLARE VARIABLE XXW02VOUTRO NUMERIC(15,2);
DECLARE VARIABLE XXW02VNF NUMERIC(15,2);
DECLARE VARIABLE XXIVPROD NUMERIC(15,2);
DECLARE VARIABLE XXXMOD_FRETE CHAR(1);
DECLARE VARIABLE XXXTRANSPORTADORA INTEGER;
DECLARE VARIABLE XXXTRPCPF_CNPJ VARCHAR(14);
DECLARE VARIABLE XXC05FONE VARCHAR(20);
DECLARE VARIABLE XXE05FONE VARCHAR(20);
DECLARE VARIABLE XXE05CUF VARCHAR(2);
DECLARE VARIABLE TAMANHO INTEGER;
begin
  XXW02VBC = 0;
  XXW02VICMS = 0;
  XXW02VBCST = 0;
  XXW02VST = 0;
  XXW02VPROD = 0;
  XXW02VFRETE = 0;
  XXW02VSEG = 0;
  XXW02VDESC = 0;
  XXW02VII = 0;
  XXW02VIPI = 0;
  XXW02VPIS = 0;
  XXW02VCOFINS = 0;
  XXW02VOUTRO = 0;
  XXW02VNF = 0;

  linha = 'A|1.10|';
  suspend;

  /*Bloco E - Destinatario*/
  select coalesce(cfg.glo_propriedade_equipamentos,'N') from sis_configuracoes cfg
  where cfg.cnpj = :cnpj
  into :xxetroca_propriedade;

  select
  /*Bloco B*/
  uf.cod_ibge, cdd.cod_ibge, coalesce(emp.nfe_ambiente,'1'), coalesce(emp.nfe_versao_app,'TESTE 1.2.6'),
  /*Bloco C*/
  emp.nome, coalesce(emp.ie,''),
  /*Bloco C05*/
  coalesce(lgd.nome,''), coalesce(cast(emp.end_numero as varchar(30)),''), coalesce(br.nome,''),
  cdd.cod_ibge , coalesce(cdd.nome,''), coalesce(cdd.uf,''),coalesce(emp.cep,''),coalesce(emp.fone,''),
  emp.nfe_leiaute_danfe
  from sis_empresas emp
  inner join glo_cidades cdd on (cdd.codigo = emp.cod_cidade and cdd.cnpj = emp.cnpj)
  inner join glo_estados uf on (cdd.uf = uf.sigla and cdd.cnpj = uf.cnpj)
  inner join glo_logradouros lgd on (lgd.codigo = emp.cod_logradouro and lgd.cnpj = emp.cnpj)
  inner join glo_bairros br on (br.codigo = emp.cod_bairro and br.cnpj = emp.cnpj)
  where emp.cnpj = :cnpj
  into :bcuf, :bcmunfg, :btpamb, :bverproc,
  :cxnome, :cie,
  :c05xlgr, :c05nro,:c05xbairro,
  :c05cmun,:c05xmun, :c05uf, :c05cep, :xxc05fone,
  :btpimp;

  select substring(retorno from 1 for 20) from strreplace(:xxc05fone,')','')
  into :xxc05fone;

  select substring(retorno from 1 for 20) from strreplace(:xxc05fone,'(','')
  into :xxc05fone;

  select substring(retorno from 1 for 20) from strreplace(:xxc05fone,'-','')
  into :xxc05fone;

  if (substring(:xxc05fone from 1 for 1) = '0') then
    c05fone = substring(:xxc05fone from 2 for 11);
  else
    c05fone = substring(:xxc05fone from 1 for 10);



  /*código pra chave da nf, não informar*/
  bcnf = '';

  /*mod - modelo de documento fiscal, padrão é 5 par 1 e 1A*/
  bmod = '55';

  /*tipo da NF (Normal, Contingência)*/
  btpemis = :xxbtpemis;

  /*serie do documento, deverá ser informado 0 quando for serie unica*/
  bserie = :xxbserie;

  /*digito verificador da chave*/
  BCDV = :XXBCDV;

  /*finalidade da emissão da NF (Normal, complementar , Ajuste)*/
  BFINNFE = :XXBFINNFE;

  /*processo de emissão, sempre ´3' por conta do programa emissor*/
  bprocemi = 3;

  select
  /*Bloco B*/
  coalesce(nat.nome,''), case pgt.avista
                                  when 'S' then '0'  /*forma de pagto à vista ou a prazo*/
                                  when 'N' then '1'
                                  else '2'
                                end, vd.num_nf, vd.data_caixa,
                                case nat.es
                                  when 'E' then '0' /*Entrada ou saida*/
                                  when 'S' then '1'
                                end, vd.id_agrupador,

  /*Bloco E*/
  coalesce(psa.nome_razao,''), coalesce(psa.rg_ie,''), vd.propriedade,
  /*Bloco E02 ou E03*/
  psa.cpf_cgc, psa.pessoa,
  /*Bloco E05*/
  coalesce(lgd.nome,''), coalesce(psa.numero,''), coalesce(psa.complemento,''), coalesce(br.nome,''), cdd.cod_ibge, uf.cod_ibge, coalesce(cdd.nome,''),
  coalesce(cdd.uf,''),coalesce(psa.cep,''),coalesce(psa.fone,''), coalesce(vd.PGTO_FRETE,'1'), vd.transportadora
  ,vd.frete, (vd.desc_acres * -1), vd.total, vd.seguro, vd.despesas
  from fat_vendas vd
  inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
  inner join fin_formas_pagto pgt on (pgt.codigo = vd.forma_pgto and pgt.cnpj = vd.cnpj)
  left join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
  left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
  inner join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
  inner join glo_cidades cdd on (cdd.codigo = psa.cidade and cdd.cnpj = psa.cnpj)
  inner join glo_estados uf on (cdd.uf = uf.sigla and uf.cnpj = cdd.cnpj)
  where vd.cnpj = :cnpj and vd.codigo = :codigo
  into :bnatop, :bindpag, :bnnf, :xxbdemi, :btpnf, :xxidagrupador,
  :exnome, :eie, :XXEPROPRIEDADE,
  :xxecpfcnpj, :xxetipopessoa,
  :e05xlgr, :e05nro, :e05xcpl, :e05xbairro, :e05cmun, :xxE05CUF,  :e05xmun,
  :e05uf, :e05cep, :xxe05fone, :xxxmod_frete, :xxxtransportadora
  ,:xxgfrete, :xxgdesconto, :xxgtotal, :xxgseguro, :xxgoutros;

  select substring(retorno from 1 for 20) from strreplace(:xxe05fone,')','')
  into :xxe05fone;

  select substring(retorno from 1 for 20) from strreplace(:xxe05fone,'(','')
  into :xxe05fone;

  select substring(retorno from 1 for 20) from strreplace(:xxe05fone,'-','')
  into :xxe05fone;

  if (substring(:xxe05fone from 1 for 1) = '0') then
    e05fone = substring(:xxe05fone from 2 for 11);
  else
    e05fone = substring(:xxe05fone from 1 for 10);


  /*retornando a data de emissão no formato solicitado*/
  xxbdemidia = extract (day from :xxbdemi);
  if (:xxbdemidia <= 9) then
    xxbdemidia_s = '0'||:xxbdemidia;
  else
    xxbdemidia_s = :xxbdemidia;

  xxbdemimes = extract (month from :xxbdemi);
  if (:xxbdemimes <= 9) then
    xxbdemimes_s = '0'||:xxbdemimes;
  else
    xxbdemimes_s = :xxbdemimes;

  xxbdemiano = extract (year from :xxbdemi);
  bdemi = xxbdemiano||'-'||xxbdemimes_s||'-'||xxbdemidia_s;

  /*data da saída ou entrada, é opcional*/
  bsaient = '';

  /*#----------------------------------------- RETORNANDO BLOCO 'B'--------------------------------------------*/
  linha ='B|'||:bcuf||'|'||:bcnf||'|'||:bnatop||'|'||:bindpag||'|'||:bmod||'|'||:bserie||'|'||:bnnf||'|'||:bdemi||'|'||:bsaient||'|'||:btpnf||'|'||(:bcuf||:bcmunfg)||'|'||:btpimp||'|'||:btpemis||'|'||:bcdv||'|'||:btpamb||'|'||:bfinnfe||'|'||:bprocemi||'|'||:bverproc||'|';
  suspend;
  

  /*verificando se retornaremos sub-blocos 'B'*/
  xxret_sub_b = 'N';
  if (:xxidagrupador is not null) then
  begin
    xxret_sub_b = 'S';
    /*Obviamente neste caso terá de ser gerado o sub-bloco de 'B', resta saber se 'B13' OU 'B14'*/
    select vd2.nfe_chave, vd2.data_caixa,  coalesce(vd2.serie,'0'), vd2.num_nf  from fat_vendas vd2
    where vd2.codigo = :xxidagrupador and vd2.cnpj = :cnpj
    into :b13refnfe, :xxb14aamm, :b14serie, :b14nnf;

    /*#----------------------------------------- RETORNANDO SUB-BLOCO 'B' (B13 OU B14)--------------------------------------------*/
    if (:b13refnfe is not null) then
    begin
      linha = 'B13|'||:b13refnfe||'|';
      suspend;
    end
    else
    begin
      if ((extract(month from :xxb14aamm)) <= 9) then
        b14aamm = extract(year from :xxb14aamm)||'0'||extract(month from :xxb14aamm);
      else
        b14aamm = extract(year from :xxb14aamm)||extract(month from :xxb14aamm);

      b14cuf = :bcmunfg;
      b14cnpj = :cnpj;
      b14mod = '01';

      linha = 'B14|'||:b14cuf||'|'||b14aamm||'|'||:b14cnpj||'|'||:b14mod||'|'||:b14serie||'|'||:b14nnf||'|';
      suspend;
    end
  end

  /*#----------------------------------------- RETORNANDO BLOCO 'C' (EMITENTE)--------------------------------------------*/
  cxfant = '';
  ciest = '';
  cim = '';
  cnae = '';
  linha = 'C|'||:cxnome||'|'||:cxfant||'|'||:cie||'|'||:ciest||'|'||:cim||'|'||:cnae||'|';
  suspend;

  /*#----------------------------------------- RETORNANDO SUB-BLOCO 'C' (C02 OU C02a)--------------------------------------------*/
  c02cnpj = :cnpj;
  linha = 'C02|'||:c02cnpj||'|';
  suspend;



  /*#----------------------------------------- RETORNANDO SUB-BLOCO 'C' (C05)--------------------------------------------*/
  c05cxpl = '';
  c05cpais = '1058';
  c05xpais = 'BRASIL';                                                           /*tem de unir, estado+municipio*/
  linha = 'C05|'||:c05xlgr||'|'||:c05nro||'|'||:c05cxpl||'|'||:c05xbairro||'|'||(bcuf||:c05cmun)||'|'||:c05xmun||'|'||:c05uf||'|'||:c05cep||'|'||:c05cpais||'|'||:c05xpais||'|'||:c05fone||'|';
  suspend;

  /*Se houve propriedade envolvida no faturamento, então alguns dados do emitente mudarão, IE e endereço para entrega*/
  if ((:XXEPROPRIEDADE is not null) and (:xxetroca_propriedade = 'S')) then
  begin
    select
    /*Bloco E*/
    pp.ie,
    /*Bloco G - Endereço de Entrega, quando existe uma propriedade vinculada muda-se o endereço de entrega*/
    coalesce(lgd.nome,''),coalesce(pp.numero,''),coalesce(pp.nome,''), coalesce(br.nome,''), cdd.cod_ibge,
    coalesce(cdd.nome,''), cdd.uf
    from fat_vendas vd
    inner join glo_propriedades pp on (pp.cnpj = vd.cnpj and pp.propriedade = vd.propriedade and pp.pessoa_fj = vd.pessoa_fj)
    left join glo_logradouros lgd on (lgd.codigo = pp.endereco and lgd.cnpj = pp.cnpj)
    left join glo_bairros br on (br.codigo = pp.bairro and br.cnpj = pp.cnpj)
    left join glo_cidades cdd on (cdd.codigo = pp.cidade and pp.cnpj = cdd.cnpj)
    where vd.cnpj = :cnpj and  vd.codigo = :codigo
    into :eie,
    :gxlgr, :gnro, :gxcpl, :gxbairro, :gcmun,
    :gxmun, :guf;
  end

  /*#----------------------------------------- RETORNANDO BLOCO 'E' (Destinatário)--------------------------------------------*/
  eisuf = '';
  if (:xxetipopessoa <> 'J') then
  begin
    if ((:XXEPROPRIEDADE is null) or (:xxetroca_propriedade = 'N')) then
      eie = '';
  end

  linha ='E|'||:exnome||'|'||:eie||'|'||:eisuf||'|';
  suspend;

  /*#----------------------------------------- RETORNANDO SUB-BLOCO 'E' (E02 ou E03)--------------------------------------------*/
  if (:xxetipopessoa = 'J') then
  begin
    e02cnpj = :xxecpfcnpj;
    linha ='E02|'||:e02cnpj||'|';
    suspend;
  end
  else
  begin
    e03cpf = :xxecpfcnpj;
    linha ='E03|'||:e03cpf||'|';
    if ((:XXEPROPRIEDADE is null) or (:xxetroca_propriedade = 'N')) then
      eie = '';
    suspend;   
  end

  /*#----------------------------------------- RETORNANDO SUB-BLOCO 'E05' (ENDERCO)--------------------------------------------*/
  e05cpais = '1058';
  e05xpais = 'BRASIL';
  linha ='E05|'||:e05xlgr||'|'||:e05nro||'|'||:e05xcpl||'|'||:e05xbairro||'|'||(xxE05CUF||:e05cmun)||'|'||:e05xmun||'|'||:e05uf||'|'||:e05cep||'|'||:e05cpais||'|'||:e05xpais||'|'||:e05fone||'|';
  suspend;


  /*#----------------------------------------- RETORNANDO BLOCO G (ENDERCO de Entrega)--------------------------------------------*/
  if ((:XXEPROPRIEDADE is not null) and (:xxetroca_propriedade = 'S')) then
  begin
    gcnpj = :xxecpfcnpj;
    linha ='G|'||:gcnpj||'|'||:gxlgr||'|'||:gnro||'|'||:gxcpl||'|'||:gxbairro||'|'||:gcmun||'|'||:gxmun||'|'||:guf||'|';
    suspend;
  end

  xxhnitem = 1;
  for select
      /*Bloco H */
      coalesce(vdi.complemento,''),
      /*Bloco I */
      vdi.produto,prd.nome, vdi.cfop, vdi.unidade,
      cast(cast(vdi.quantidade as numeric(12,4)) as varchar(16)),
      cast(cast(vdi.prc_unitario as numeric(16,4)) as varchar(20)),
      cast((vdi.prc_unitario * vdi.quantidade) as numeric(15,2)),
      /*Bloco N */
      prd.cte, prd.ctie, prd.origem, prd.reducao
      from fat_vendas_itens vdi
      inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
      where vdi.codigo = :codigo and vdi.cnpj = :cnpj
      into :hinfadprod,
      :icprod, :ixprod, :icfop, :iucom,
      :iqcom,
      :ivuncom,
      :xxivprod,
      :xxicte,:xxictie, :xxnorigem, :xxnreducao
  do
  begin
     /*#----------------------------------------- RETORNANDO BLOCO H (Inicio das Info. dos Itens)--------------------------------------------*/
     hnitem = cast (:xxhnitem as varchar(3));
     linha = 'H|'||:hnitem||'|'||:hinfadprod||'|';
     suspend;


     /*#----------------------------------------- RETORNANDO BLOCO I (Itens da NF)--------------------------------------------*/
     icean = ''; /*embora seja obrigatório o manual também diz pra não informar caso ele não exista*/
     incm = '';
     iextipi = '';
     igenero = '';
     iceantrib = '';

     /*testar exaustivamente estes códigos, pois acredito que deva haver redução quando o cliente ou produto
     se enquadrar neste ponto ou mesmo descontos quando houver descontos no total da NF que deva refletir nos itens*/
     iutrib = :iucom;
     iqtrib = :iqcom;
     ivuntrib = :ivuncom;

     /*Econtrando a representatividade do item no total da venda*/
     xxirep = (:xxivprod)/:xxgtotal;

     xxivfrete = (:xxirep * :xxgfrete);
     if (:xxivfrete > 0) then
       ivfrete = cast(:xxivfrete as varchar(17));
     else
       ivfrete = '';

     xxivseg = (:xxirep * :xxgseguro);
     if (:xxivseg > 0) then
       ivseg = cast(:xxivseg as varchar(17));
     else
       ivseg = '';

     xxivdesc = (:xxirep * :xxgdesconto);
     if (:xxivdesc > 0) then
       ivdesc = cast(:xxivdesc as varchar(17));
     else
       ivdesc = '';


     ivprod =  cast(:xxivprod as varchar(17));

     /*Totais*/
     xxw02vfrete = xxw02vfrete + xxivfrete; /*Frete*/
     xxw02vdesc = :xxw02vdesc + :xxivdesc; /*Descontos*/
     xxw02vprod = xxw02vprod +:xxivprod; /*Produtos*/
     xxw02vseg = xxw02vseg + xxivseg;

     linha = 'I|'||:icprod||'|'||:icean||'|'||:ixprod||'|'||:incm||'|'||:iextipi||'|'||:igenero||'|';
     linha = linha||:icfop||'|'||:iucom||'|'||:iqcom||'|'||:ivuncom||'|'||:ivprod||'|'||:iceantrib||'|';
     linha = linha||:iutrib||'|'||:iqtrib||'|'||:ivuntrib||'|'||:ivfrete||'|'||:ivseg||'|'||:ivdesc||'|';
     suspend;
     xxhnitem = :xxhnitem + 1;
     /* Blocos:
        I18: Declaração de Importação
        I25: Adições
        J: Veículos Novos
        K: Medicamentos
        L: Armamentos
        L01: Combustível
        L105 - CB. CIDE
        L109 - CB. ICMS Proprio ou Retido
        L114 - CB. ICMS Devido...
        L117 - CB. ICMS para consumo
     */

     /*#----------------------------------------- RETORNANDO BLOCO M - IMPOSTOS--------------------------------------------*/
     linha = 'M|';
     suspend;

     /*#----------------------------------------- RETORNANDO BLOCO N - ICMS--------------------------------------------*/
     linha = 'N|';
     suspend;

     xxw02vii = 0;                      /*Não sei q trem é esse*/
     xxw02vipi = 0;
     xxw02vpis = 0;
     xxw02vcofins = 0;
     xxw02voutro = 0;
     /*verificação dos sub-blocos 'N', isso é um sinal que os dois (Emitente e Cliente) estão no mesma UF,
     portanto a tributação a ser considerada será a estadual, caso contrário será a interestadual*/
     if (:bcuf = :e05uf) then
       xxtipo_trib = :xxicte;
     else
       xxtipo_trib = :xxictie;

     /*
     1 - Tributada Integralmente - OK
     2 - Tributada com Redução na Base de Cálculo - OK
     3 - Isento de ICMS
     4 - ICMS não incidência
     5 - Diferido
     6 - Substituição Tributária - OK
     7 - ISS */

     /* 1 - Tributada INTEGRALMENTE*/
     if (:xxtipo_trib = 1) then
     begin
        n02orig = :xxnorigem;
        n02cst = '00';
        n02modbc = '1'; /*Estou assumindo que a base de contribuição ICMS seja a pauta, no entando precisamos de um controle no sistema*/
        n02vbc = cast (:xxivprod as varchar(17)); /*valor do produto (Qtde X Vlr. Unitario) obs, falta o rateio do desconto*/

        xxw02vbc = :xxw02vbc + :xxivprod; /*Total*/

        n02picms = '17.00';

        xxivprod = (:xxivprod * 0.17);
        select sai from round2(:xxivprod)
        into :xxivprod;

        n02vicms = cast(:xxivprod  as varchar(17));
        xxw02vicms = (:xxw02vicms + :xxivprod);


        /*#----------------------------------------- RETORNANDO BLOCO N02 (Tributado Integralmente)--------------------------------------------*/
        linha = 'N02|'||:n02orig||'|'||:n02cst||'|'||:n02modbc||'|'||:n02vbc||'|'||:n02picms||'|'||:n02vicms||'|';
        suspend;

     end /*Isento - Totalmente*/
     if (:xxtipo_trib = 3) then
     begin
       n06orig = :xxnorigem;
       n06cst = '40'; /*Isento*/

       /*#----------------------------------------- RETORNANDO BLOCO N02 (Tributado Integralmente)--------------------------------------------*/
       linha = 'N06|'||:n06orig||'|'||:n06cst||'|';
       suspend;
     end /*Substituição tributária*/
     else if (:xxtipo_trib = 6) then
     begin
       n03orig = :xxnorigem;
       n03cst = '10';
       n03modbc = '1'; /*Estou assumindo que a base de contribuição ICMS seja a pauta, no entando precisamos de um controle no sistema*/
       n03vbc = cast (:xxivprod  as varchar(17));
       n03picms = '17.00';
       n03vicms = cast ((:xxivprod * 0.17) as varchar(17));
       n03modbcst = '5'; /*Estou assumindo que a base de contribuição ICMS-ST seja a pauta, no entando precisamos de um controle no sistema*/
       n03pmvast = '';
       n03predbcst = '';
       n03vbcst = cast (:xxivprod as varchar(17));
       n03picmsst = '17.00';
       n03vicmsst = cast ((:xxivprod * 0.17) as varchar(17)); /*valor do ICMS retido*/

       /*Totais*/
       xxw02vbcst = :xxw02vbcst + :xxivprod;
       xxw02vst = (:xxw02vst + (:xxivprod * 0.17));

       /*#----------------------------------------- RETORNANDO BLOCO N03 (SUBSTITUIÇÃO TRIBUTÁRIA)--------------------------------------------*/
       linha = 'N03|'||:n03orig||'|'||:n03cst||'|'||:n03modbc||'|'||:n03vbc||'|'||:n03picms||'|'||:n03vicms||'|'||:n03modbcst||'|';
       linha = :linha||:n03pmvast||'|'||:n03predbcst||'|'||:n03vbcst||'|'||:n03picmsst||'|'||:n03vicmsst||'|';
       suspend;
     end/*Tributação com REDUÇÃO de base de cálculo*/
     else if (:xxtipo_trib = 2) then
     begin
       /*Se utilizaremos a redução estadual ou Interestadual*/
       if (:bcuf = :e05uf) then
       begin
         select r.perc_estadual from est_reducoes r
         where r.codigo = :xxnreducao and r.cnpj = :cnpj
         into :xxnpctreducao;
       end
       else
       begin
         select r.perc_interestadual from est_reducoes r
         where r.codigo = :xxnreducao and r.cnpj = :cnpj
         into :xxnpctreducao;
       end

       n04orig = :xxnorigem;
       n04cst = '20';
       n04modbc = '1'; /*Estou assumindo que a base de contribuição ICMS seja a pauta, no entando precisamos de um controle no sistema*/
       n04predbc = cast (:xxnpctreducao as varchar(7));
       n04vbc = cast ( ((:xxivprod * :xxnpctreducao)/100.00) as varchar(17));
       n04picms = '17.00';
       n04vicms = cast ( (((:xxivprod * :xxnpctreducao)/100.00)  * 0.17) as varchar(17));

       /*#----------------------------------------- RETORNANDO BLOCO N04 (REDUÇÃO DE BASE DE CÁLCULO)--------------------------------------------*/
       linha = 'N04|'||:n04orig||'|'||:n04cst||'|'||:n04modbc||'|'||:n04predbc||'|'||:n04vbc||'|'||:n04picms||'|'||:n04vicms||'|';
       suspend;
     end

     /*Pularei IPI*/

     /*#----------------------------------------- RETORNANDO BLOCO Q - PIS--------------------------------------------*/
     linha = 'Q|';
     suspend;
     linha = 'Q04|08|'; /*Operação sem incidência de contribuição*/
     suspend;

     /*#----------------------------------------- RETORNANDO BLOCO COFINS - Substituição tributária--------------------------------------------*/
     linha = 'S|';
     suspend;
     linha = 'S04|08|'; /*Operação sem incidência de contribuição*/
     suspend;
  end
  /*#----------------------------------------- TOTAIS--------------------------------------------*/
  linha = 'W|';
  suspend;

  XXW02VNF = (:xxgtotal - :xxgdesconto);
  W02VBC = cast(:XXW02VBC as varchar(17));
  W02VICMS = cast(XXW02VICMS as varchar(17));
  W02VBCST = cast(XXW02VBCST as varchar(17));
  W02VST = cast(XXW02VST as varchar(17));
  W02VPROD = cast(XXW02VPROD as varchar(17));
  W02VFRETE = cast(XXW02VFRETE as varchar(17));
  W02VSEG = cast(XXW02VSEG as varchar(17));
  W02VDESC = cast(XXW02VDESC as varchar(17));
  W02VII = cast(XXW02VII as varchar(17));
  W02VIPI = cast(XXW02VIPI as varchar(17));
  W02VPIS = cast(XXW02VPIS as varchar(17));
  W02VCOFINS = cast(XXW02VCOFINS as varchar(17));
  W02VOUTRO = cast(XXW02VOUTRO as varchar(17));
  W02VNF = cast(XXW02VNF as varchar(17));

  linha = 'W02|'||:W02VBC||'|'||:w02vicms||'|'||:w02vbcst||'|'||:w02vst||'|'||:w02vprod||'|'||:w02vfrete||'|'||:w02vseg||'|'||:w02vdesc||'|';
  linha = linha||:w02vii||'|'||:w02vipi||'|'||:w02vpis||'|'||:w02vcofins||'|'||:w02voutro||'|'||:w02vnf||'|';
  suspend;

  /*#----------------------------------------- Transporte--------------------------------------------*/
  if (:xxxmod_frete = '1') then
    xxxmod_frete = '0';
  else if (:xxxmod_frete = '2') then
    xxxmod_frete = '1';

  linha = 'X|'||:xxxmod_frete||'|';
  suspend;

  /*se existe uma transportadora definida no faturamento*/
  if (:xxxtransportadora is not null) then
  begin
    select coalesce(trp.nome,''), coalesce(trp.ie,''), coalesce(trp.endereco,''), coalesce(trp.uf,''),
    coalesce(trp.cidade,''), coalesce(trp.cpf_cnpj,'')
    from glo_transportadoras trp
    where trp.cnpj = :cnpj and trp.codigo = :xxxtransportadora
    into :x03nome, :x03ie,:x03Xender, :x03uf,
    :x03xmun,:xxxtrpcpf_cnpj;

    /*#-----------------------------------------RETORNANDO X03--------------------------------------------*/

    linha = 'X03|'||:x03nome||'|'||:x03ie||'|'||:x03Xender||'|'||:x03uf||'|'||:x03xmun||'|';
    suspend;

      select tamanho from getlength(:xxxtrpcpf_cnpj)
      into :tamanho;

      if (:tamanho = 14) then
        linha = 'X04|'||:xxxtrpcpf_cnpj||'|';
      else
        linha = 'X05|'||cast(:xxxtrpcpf_cnpj as varchar(11))||'|';

    suspend;
  end
END
^

ALTER PROCEDURE NFE_PRODUTO (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15))
RETURNS (
    LINHA VARCHAR(500))
AS
DECLARE VARIABLE XPROD VARCHAR(120);
DECLARE VARIABLE CEAN VARCHAR(14);
DECLARE VARIABLE NCM VARCHAR(8);
DECLARE VARIABLE EXTIP VARCHAR(3);
DECLARE VARIABLE GENERO VARCHAR(2);
DECLARE VARIABLE UCOM VARCHAR(6);
DECLARE VARIABLE VUNCOM NUMERIC(16,4);
DECLARE VARIABLE CEANTRIB VARCHAR(14);
DECLARE VARIABLE UTRIB VARCHAR(6);
DECLARE VARIABLE VUNTRIB NUMERIC(16,4);
DECLARE VARIABLE QTRIB NUMERIC(12,4);
DECLARE VARIABLE MIPI INTEGER;
DECLARE VARIABLE QTDEN INTEGER;
DECLARE VARIABLE CLENQ VARCHAR(5);
DECLARE VARIABLE CNPJPROD VARCHAR(5);
DECLARE VARIABLE CENQ VARCHAR(3);
DECLARE VARIABLE CST CHAR(2);
DECLARE VARIABLE ORIG INTEGER;
DECLARE VARIABLE MODBC INTEGER;
DECLARE VARIABLE PICMS NUMERIC(5,2);
DECLARE VARIABLE PREDBC NUMERIC(5,2);
DECLARE VARIABLE MODBCST INTEGER;
DECLARE VARIABLE PREDBCST INTEGER;
DECLARE VARIABLE PMVAST INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
begin
  select substring(prd.nome from 1 for 120), substring(prd.unidade from 1 for 4),
  cast (prd.PRC_VENDA as numeric(16,4)), prd.cte, prd.ctie, prd.origem
  from est_produtos prd
  where prd.codigo = :codigo and prd.cnpj = :cnpj
  into :xprod, :ucom,
  :vuncom, :cte, :ctie, :orig;

  /*GTIN (Global Trade Item Number) do produto, antigo código EAN ou código de barras*/
  cEAN = null; /*Opcional*/

  /*Preencher de acordo com a Tabela de Capítulos da NCM. Em caso de serviço,não preencher.*/
  NCM = null; /*Opcional*/

  /*Preencher de acordo com o código EX da TIPI. Em caso de serviço, não preencher.*/
  EXTIP = null; /*Opcional*/

  /*Gênero do produto ou serviço. Preencher de acordo com a Tabela de Capítulos da NCM. Em caso de serviço, não preencher*/
  genero = null; /*Opcional*/

  /*Preencher com o código GTIN-8, GTIN-12, GTIN-13 ou GTIN-14 (antigos códigos EAN, UPC e DUN-14) da unidade tributável do produto, não informar
  em caso de o produto não possuir este código.*/
  ceantrib = null; /*Opcional*/

  /*Não vou preencher estes valores a principio, pois pesquisarei por mais informações sobre estes campos*/
  /*Unidade tributável*/
  utrib = null; /*Opcional*/

  /*Valor unitário de tributação*/
  vuntrib = null; /*Opcional*/

  /*Valor unitário de tributação*/
  qtrib = null; /*Opcional*/

  linha = 'A|1.02|';
  suspend;
  /*                                        cEAN  NCM  EXTIP genero                       :ceantrib :utrib :vuntrib :qtrib           */
--linha = 'I'||'|'||:codigo||'|'||:xprod||'|cEAN|'||'|NCM|'||'|EXTIPI|'||'|genero|'||:ucom||'|'||:vuncom||'|cEANTrib|'||'|uTrib|'||'|vUnTrib|'||'|qTrib|';
  linha = 'I'||'|'||:codigo||'|'||coalesce(:xprod,'')||'|'||'|'||'|'||'||'||coalesce(:ucom,'')||'|'||coalesce(:vuncom,'')||'|'||'|'||'|'||'|';
  suspend; /*Retornando itens do grupo 'I'*/

  /*Não vou preencher estes valores a principio, 'IPI' pois pesquisarei por mais informações sobre estes campos*/
  mipi = null;
     /*Registros do grupo 'O', usado somente quando existe algum produto que incide IPI*/
    clenq = null;
    cnpjprod = null;
    cenq = null;

  /*Grupo de ICMS - Atualmente temos apenas 2 variantes de tributações */
  if (:cte <> :ctie) then
   qtden = '2';
  else
   qtden = '1';

  linha = 'M'||'|0|'||:qtden||'|';
  suspend; /*Retornando itens do grupo 'M'*/

  if (:cte = 1) then /*tributada integralmente*/
    cst = '00';
  else if (:cte = 2) then /*redução da base de calculo*/
    cst = '20';
  else if (:cte = 3) then /*Isento de ICMS*/
    cst = '40';
  else if (:cte = 4) then /*Não incidência ou não tributada ICMS*/
    cst = '41';
  else if (:cte  = 5) then /*Diferimento*/
    cst = '51';
  else if (:cte  = 6) then /*Substituição*/
    cst = '10';
  else
    cst = '99'; /*Outros*/

  modbc = null;
  picms = null;
  predbc = null;
  modbcst = null;
  modbcst = null;           
  pmvast = null; /*                   :modbc :picms :predbc :modBCST :predbcst :pmvast                    */
  linha =  'N'||'|'||coalesce(:cst,'')||'|'||coalesce(:orig,'')||'||'||'||'||'||'||'||'||'||';
  suspend; /*Retornando neste caso, a primeira linha do icms com uma das formas de tributação*/

  if (:cte <> :ctie) then
  begin
    if (:ctie = 1) then /*tributada integralmente*/
      cst = '00';
    else if (:ctie = 2) then /*redução da base de calculo*/
      cst = '20';
    else if (:ctie = 3) then /*Isento de ICMS*/
      cst = '40';
    else if (:ctie = 4) then /*Não incidência ou não tributada ICMS*/
      cst = '41';
    else if (:ctie  = 5) then /*Diferimento*/
      cst = '51';
    else if (:ctie  = 6) then /*Substituição*/
      cst = '10';
    else
      cst = '99'; /*Outros*/

    modbc = null;
    picms = null;
    predbc = null;
    modbcst = null;
    modbcst = null;
    pmvast = null;

    linha =  'N'||'|'||coalesce(:cst,'')||'|'||coalesce(:orig,'')||'||'||'||'||'||'||'||'||'||';
    suspend; /*Retornando neste caso, a primeira linha do icms com uma das formas de tributação*/
  end
END
^

ALTER PROCEDURE NFE_TRANSPORTADORA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    TRANSPORTADORA VARCHAR(500))
AS
DECLARE VARIABLE TPDOC VARCHAR(4);
DECLARE VARIABLE NUMDOC VARCHAR(14);
DECLARE VARIABLE XNOME VARCHAR(60);
DECLARE VARIABLE IE VARCHAR(14);
DECLARE VARIABLE XENDER VARCHAR(60);
DECLARE VARIABLE UF VARCHAR(2);
DECLARE VARIABLE XMUM VARCHAR(60);
DECLARE VARIABLE TAMANHO INTEGER;
begin
  select coalesce(tp.cpf_cnpj,''), coalesce(tp.nome,''), coalesce(tp.ie,''), coalesce(tp.endereco,''),
  coalesce(tp.cidade,''), coalesce(tp.uf,'')
  from glo_transportadoras tp
  where cnpj = :cnpj and tp.codigo = :codigo
  into :numdoc, :xnome, :ie, :xender, :xmum, :uf;

  transportadora = 'A|1.10|';
  suspend;
  select tamanho from getlength(:numdoc)
  into :tamanho;

  if (:tamanho = 14) then
    tpdoc = 'CNPJ';
  else
    tpdoc = 'CPF';

  transportadora = 'X|'||:tpdoc||'|'||:numdoc||'|'||coalesce(:xnome,'')||'|'||coalesce(:ie,'')||'|'||coalesce(:xender,'')||'|'||coalesce(:xmum,'')||'|'||coalesce(:uf,'')||'|';
  suspend;
END
^

ALTER PROCEDURE NOME_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
     Select NOME
     From Est_Produtos
     Where Codigo = :PRODUTO and CNPJ = :CNPJ
     INTO
         :NOME ;
         
     SUSPEND;
END
^

ALTER PROCEDURE NOME_SIMILAR (
    PRODUTO_A VARCHAR(13),
    PRODUTO_B VARCHAR(13),
    PRODUTO VARCHAR(13))
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
  /*  */
  IF (:PRODUTO = :PRODUTO_A) THEN
     SELECT NOME FROM EST_PRODUTOS
     WHERE CODIGO = :PRODUTO_B
     INTO :NOME;
  /*  */
  IF (:PRODUTO = :PRODUTO_B) THEN
     SELECT NOME FROM EST_PRODUTOS
     WHERE CODIGO = :PRODUTO_A
     INTO :NOME;
  SUSPEND;
END
^

ALTER PROCEDURE NOMEUSUARIO (
    USUARIO INTEGER)
RETURNS (
    NOME VARCHAR(10))
AS
BEGIN
     SELECT LOGIN FROM SIS_USUARIOS
     WHERE CODIGO = :USUARIO
     INTO :NOME ;
     
     SUSPEND;
END
^

ALTER PROCEDURE OFC_MECANICOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    COM_VISTA NUMERIC(12,2),
    COM_PRAZO NUMERIC(12,2),
    PESSOA_FJ INTEGER,
    SENHA VARCHAR(6))
AS
BEGIN
  INSERT INTO OFC_MECANICOS (
    CNPJ,
    CODIGO,
    NOME,
    COM_VISTA,
    COM_PRAZO,
    PESSOA_FJ,
    SENHA)
  VALUES (
    :CNPJ,
    :CODIGO,
    :NOME,
    :COM_VISTA,
    :COM_PRAZO,
    :PESSOA_FJ,
    :SENHA);
END
^

ALTER PROCEDURE OFC_MOTORES_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(80),
    TIPO VARCHAR(10),
    CILINDROS VARCHAR(15),
    COMBUSTIVEL VARCHAR(30))
AS
BEGIN
  INSERT INTO OFC_MOTORES (
    CNPJ,
    CODIGO,
    NOME,
    TIPO,
    CILINDROS,
    COMBUSTIVEL)
  VALUES (
    :CNPJ,
    :CODIGO,
    :NOME,
    :TIPO,
    :CILINDROS,
    :COMBUSTIVEL);
END
^

ALTER PROCEDURE OFC_MOTORES_SERVICOS_I (
    CNPJ CHAR(14),
    MOTOR INTEGER,
    SERVICO INTEGER,
    NOME_SERVICO VARCHAR(50),
    ATIVO CHAR(1),
    VALOR NUMERIC(18,4))
AS
BEGIN
  IF (EXISTS(SELECT CNPJ FROM OFC_MOTORES_SERVICOS WHERE (CNPJ = :CNPJ) AND  (MOTOR = :MOTOR) AND  (SERVICO = :SERVICO))) THEN
    UPDATE OFC_MOTORES_SERVICOS
    SET NOME_SERVICO = :NOME_SERVICO,
        ATIVO = :ATIVO,
        VALOR = :VALOR
    WHERE (CNPJ = :CNPJ) AND (MOTOR = :MOTOR) AND (SERVICO = :SERVICO);
  ELSE
    INSERT INTO OFC_MOTORES_SERVICOS (
        CNPJ,
        MOTOR,
        SERVICO,
        NOME_SERVICO,
        ATIVO,
        VALOR)
    VALUES (
        :CNPJ,
        :MOTOR,
        :SERVICO,
        :NOME_SERVICO,
        :ATIVO,
        :VALOR);
END
^

ALTER PROCEDURE OFC_ORDEM_SERVICO_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ORCAMENTO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO CHAR(1),
    MOTOR INTEGER,
    ENVIADA_CAIXA CHAR(1),
    PLACA CHAR(8),
    DATA_FECHAMENTO TIMESTAMP,
    FORMA_PAGTO INTEGER)
AS
DECLARE VARIABLE CONTADOR INTEGER;
BEGIN
     SELECT COUNT(*) FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ and CODIGO = :PESSOA_FJ
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         PESSOA_FJ = 1;

     SELECT COUNT(*) FROM EST_NATUREZA
     WHERE CNPJ = :CNPJ and CODIGO = :NATUREZA
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         NATUREZA = 5102;

     SELECT COUNT(*) FROM OFC_MECANICOS
     WHERE CNPJ = :CNPJ and CODIGO = :MECANICO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         MECANICO = 1;

     SELECT COUNT(*) FROM OFC_VIAJANTES
     WHERE CNPJ = :CNPJ and CODIGO = :VIAJANTE
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         VIAJANTE = 1;

     SELECT COUNT(*) FROM OFC_MOTORES
     WHERE CNPJ = :CNPJ and CODIGO = :MOTOR
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         MOTOR = 1;

     SELECT COUNT(*) FROM FIN_FORMAS_PAGTO
     WHERE CNPJ = :CNPJ and CODIGO = :FORMA_PAGTO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         FORMA_PAGTO = 1;

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN BEGIN

  INSERT INTO OFC_ORDEM_SERVICO (
    CNPJ,
    CODIGO,
    ORCAMENTO,
    DATA,
    PESSOA_FJ,
    NATUREZA,
    MECANICO,
    VIAJANTE,
    ENTRADA,
    HISTORICO,
    CHASSI,
    TOTAL,
    DESC_ACRESC,
    CLIENTE,
    FECHADO,
    MOTOR,
    ENVIADA_CAIXA,
    PLACA,
    DATA_FECHAMENTO,
    FORMA_PAGTO
)
  VALUES (
    :CNPJ,
    :CODIGO,
    :ORCAMENTO,
    :DATA,
    :PESSOA_FJ,
    :NATUREZA,
    :MECANICO,
    :VIAJANTE,
    :ENTRADA,
    :HISTORICO,
    :CHASSI,
    :TOTAL,
    :DESC_ACRESC,
    :CLIENTE,
    :FECHADO,
    :MOTOR,
    :ENVIADA_CAIXA,
    :PLACA,
    :DATA_FECHAMENTO,
    :FORMA_PAGTO
);
END
END
^

ALTER PROCEDURE OFC_ORDEM_SERVICO_ORC_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO CHAR(1),
    MOTOR INTEGER,
    ENVIADA_CAIXA CHAR(1),
    PLACA CHAR(8),
    DATA_FECHAMENTO TIMESTAMP,
    FORMA_PAGTO INTEGER)
AS
DECLARE VARIABLE CONTADOR INTEGER;
BEGIN
     SELECT COUNT(*) FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ and CODIGO = :PESSOA_FJ
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         PESSOA_FJ = 1;

     SELECT COUNT(*) FROM EST_NATUREZA
     WHERE CNPJ = :CNPJ and CODIGO = :NATUREZA
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         NATUREZA = 5102;

     SELECT COUNT(*) FROM OFC_MECANICOS
     WHERE CNPJ = :CNPJ and CODIGO = :MECANICO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         MECANICO = 1;

     SELECT COUNT(*) FROM OFC_VIAJANTES
     WHERE CNPJ = :CNPJ and CODIGO = :VIAJANTE
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         VIAJANTE = 1;

     SELECT COUNT(*) FROM OFC_MOTORES
     WHERE CNPJ = :CNPJ and CODIGO = :MOTOR
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         MOTOR = 1;

     SELECT COUNT(*) FROM FIN_FORMAS_PAGTO
     WHERE CNPJ = :CNPJ and CODIGO = :FORMA_PAGTO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         FORMA_PAGTO = 1;

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN BEGIN

  INSERT INTO OFC_ORDEM_SERVICO_ORC (
    CNPJ,
    CODIGO,
    DATA,
    PESSOA_FJ,
    NATUREZA,
    MECANICO,
    VIAJANTE,
    ENTRADA,
    HISTORICO,
    CHASSI,
    TOTAL,
    DESC_ACRESC,
    CLIENTE,
    FECHADO,
    MOTOR,
    ENVIADA_CAIXA,
    PLACA,
    DATA_FECHAMENTO,
    FORMA_PAGTO
)
  VALUES (
    :CNPJ,
    :CODIGO,
    :DATA,
    :PESSOA_FJ,
    :NATUREZA,
    :MECANICO,
    :VIAJANTE,
    :ENTRADA,
    :HISTORICO,
    :CHASSI,
    :TOTAL,
    :DESC_ACRESC,
    :CLIENTE,
    :FECHADO,
    :MOTOR,
    :ENVIADA_CAIXA,
    :PLACA,
    :DATA_FECHAMENTO,
    :FORMA_PAGTO
);
END
END
^

ALTER PROCEDURE OFC_ORDEM_SERVICO_SERVICO_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
DECLARE VARIABLE CONTADOR INTEGER;
BEGIN
     SELECT COUNT(*) FROM OFC_SERVICOS
     WHERE CNPJ = :CNPJ and CODIGO = :SERVICO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         SERVICO = 1;

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO
     INTO :CONTADOR ;

     IF ( CONTADOR IS NULL )
     THEN
         CONTADOR = 0;

     IF ( CONTADOR > 0 )
     THEN BEGIN

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO_SERVICO
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO AND SERVICO = :SERVICO
     INTO :CONTADOR ;

     IF ( CONTADOR IS NULL )
     THEN
         CONTADOR = 0;

     IF ( CONTADOR = 0 )
     THEN BEGIN
     INSERT INTO OFC_ORDEM_SERVICO_SERVICO (
     CNPJ,
     CODIGO,
     SERVICO,
     NOME,
     QUANTIDADE,
     UNITARIO,
     SELECIONADO)
     VALUES (
     :CNPJ,
     :CODIGO,
     :SERVICO,
     :NOME,
     :QUANTIDADE,
     :UNITARIO,
     :SELECIONADO);
     END
     END
END
^

ALTER PROCEDURE OFC_ORDEM_SERVICO_SERVICO_ORC_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERVICO INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    SELECIONADO CHAR(1))
AS
DECLARE VARIABLE CONTADOR INTEGER;
BEGIN
     SELECT COUNT(*) FROM OFC_SERVICOS
     WHERE CNPJ = :CNPJ and CODIGO = :SERVICO
     INTO :CONTADOR ;

     IF (( CONTADOR = 0 ) OR ( CONTADOR IS NULL ))
     THEN
         SERVICO = 1;

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO
     INTO :CONTADOR ;

     IF ( CONTADOR IS NULL )
     THEN
         CONTADOR = 0;

     IF ( CONTADOR > 0 )
     THEN BEGIN

     SELECT COUNT(*) FROM OFC_ORDEM_SERVICO_SERVICO_ORC
     WHERE CNPJ = :CNPJ and CODIGO = :CODIGO AND SERVICO = :SERVICO
     INTO :CONTADOR ;

     IF ( CONTADOR IS NULL )
     THEN
         CONTADOR = 0;

     IF ( CONTADOR = 0 )
     THEN BEGIN
     INSERT INTO OFC_ORDEM_SERVICO_SERVICO_ORC (
     CNPJ,
     CODIGO,
     SERVICO,
     NOME,
     QUANTIDADE,
     UNITARIO,
     SELECIONADO)
     VALUES (
     :CNPJ,
     :CODIGO,
     :SERVICO,
     :NOME,
     :QUANTIDADE,
     :UNITARIO,
     :SELECIONADO);
     END
     END
END
^

ALTER PROCEDURE OFC_SERVICOS_I (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    NOME VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
  INSERT INTO OFC_SERVICOS (
    CNPJ,
    CODIGO,
    NOME,
    VALOR)
  VALUES (
    :CNPJ,
    :CODIGO,
    :NOME,
    :VALOR);
END
^

ALTER PROCEDURE ORGANIZA_ANO_COBRANCAS
AS
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE CNPJ VARCHAR(14);
begin
     FOR SELECT CNPJ, ANO, CODIGO FROM
     FIN_CONTAS_RECEBER
     INTO :CNPJ, :ANO, :CODIGO DO
     BEGIN
          UPDATE FIN_COBRANCAS
          SET ANO = :ANO
          WHERE CNPJ = :CNPJ AND
          RECEBER = :CODIGO ;
     END
END
^

ALTER PROCEDURE ORGANIZA_FATURAS
AS
DECLARE VARIABLE DATA    DATE;
DECLARE VARIABLE USUARIO INTEGER;
DECLARE VARIABLE FATURA  INTEGER;
begin
     FOR SELECT DT_BAIXA, USUARIO, FATURA FROM
     FIN_BAIXAS_RECEBER
     INTO :DATA, :USUARIO, :FATURA
     DO BEGIN
        UPDATE FIN_FATURAS
        SET USUARIO = :USUARIO, DATA_BAIXA = :DATA
        WHERE CODIGO = :FATURA ;
     END
END
^

ALTER PROCEDURE ORGANIZA_SERVICOS_ORDENS
AS
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE SERVICO INTEGER;
DECLARE VARIABLE CODIGO  INTEGER;
begin
     FOR SELECT CNPJ, SERVICO, CODIGO
     FROM OFC_ORDEM_SERVICO_SERVICO
     INTO :CNPJ, :SERVICO, :CODIGO DO
     BEGIN
          SELECT NOME FROM OFC_SERVICOS
          WHERE CNPJ = :CNPJ AND CODIGO = :SERVICO
          INTO :NOME ;

          UPDATE OFC_ORDEM_SERVICO_SERVICO
          SET NOME = :NOME
          WHERE CNPJ = :CNPJ AND SERVICO = :SERVICO
          AND CODIGO = :CODIGO ;
     END

     FOR SELECT CNPJ, SERVICO, CODIGO
     FROM OFC_ORDEM_SERVICO_SERVICO_ORC
     INTO :CNPJ, :SERVICO, :CODIGO DO
     BEGIN
          SELECT NOME FROM OFC_SERVICOS
          WHERE CNPJ = :CNPJ AND CODIGO = :SERVICO
          INTO :NOME ;

          UPDATE OFC_ORDEM_SERVICO_SERVICO_ORC
          SET NOME = :NOME
          WHERE CNPJ = :CNPJ AND SERVICO = :SERVICO
          AND CODIGO = :CODIGO ;
     END
END
^

ALTER PROCEDURE PCD_ACERTA_ESTOQUE_FERT
AS
DECLARE VARIABLE CODIGO INTEGER;
begin
  /*Procedimento a ser utilizado para acerto de base somente para a fert flora */
  for select vd.codigo from fat_vendas vd
      where vd.natureza = 5117 and vd.codigo not in (select vd2.id_agrupador from fat_vendas vd2)
  into :codigo
  do
  begin
    update fat_vendas_itens vdi set vdi.qtde_entregue = 0 where vdi.codigo = :codigo;
  end
  suspend;
END
^

ALTER PROCEDURE PCD_ACERTA_KARDEX
AS
DECLARE VARIABLE QTDE FLOAT;
DECLARE VARIABLE COD_KARDEX INTEGER;
begin
  /*Atualizando a quantidade dos movimentos de entrada*/
  for select k.codigo, k.qtdade from est_kardex k
      inner join est_produtos prd on (prd.cnpj = k.cnpj and prd.codigo = k.codigo)
      where prd.unidade = 'L' and k.origem = 'ENT'
      into :cod_kardex, :qtde
  do
  begin
     /*Atualização registro kardex*/
     update est_kardex k set k.qtdade = (k.qtdade * 20)
     where k.codigo = :cod_kardex;
  end
END
^

ALTER PROCEDURE PCD_ACT_EST_TITULO_GERADO (
    CNPJ VARCHAR(14),
    ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PARCELA VARCHAR(6),
    QTDE_MOEDA NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    NOME_RAZAO VARCHAR(50),
    CPF_CNPJ VARCHAR(15),
    DT_VENCTO DATE,
    TIPO VARCHAR(20),
    STATUS VARCHAR(20))
AS
declare variable cod_receber integer;
declare variable cod_pagar integer;
declare variable cont_recda integer;
declare variable cont_rec integer;
declare variable cont_pagda integer;
declare variable cont_pag integer;
begin
    for select tg.cod_receber, tg.cod_pagar from act_titulogerado tg
        where tg.cnpj = :cnpj and tg.cod_acertoconta = :acerto
        into :cod_receber, :cod_pagar
    do
    begin
       if (coalesce(:cod_receber,0) <> 0) then
       begin
         tipo = 'RECEBER';

         select count(*) from fin_contas_receber rec
         where rec.cnpj = :cnpj and rec.codigo = :cod_receber
         into :cont_rec;

         if (coalesce(:cont_rec,0) = 0) then
         begin
           status = 'Bx. Integral';

           /*buscando registros em contas baixadas*/
           for select bx.codigo_cr, bx.parcela, bx.idx_qtde, bx.valor, psa.nome_razao, psa.cpf_cgc, bx.dt_vencto
               from fin_baixas_receber bx
               inner join glo_pessoas_fj psa on (psa.cnpj = bx.cnpj and psa.codigo = bx.pessoa_fj)
               where bx.cnpj = :cnpj and bx.codigo_cr = :cod_receber
               into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj, :dt_vencto
            do
            begin
              suspend;
            end
         end
         else
         begin
           select count(*) from fin_baixas_receber bx
           where bx.cnpj = :cnpj and bx.codigo_cr = :cod_receber
           into :cont_recda;

           if (coalesce(:cont_recda,0) > 0) then
             status = 'Bx. Parcial';
           else
             status = 'Integral';

           for select rec.codigo, rec.parcela, rec.idx_qtde, rec.valor, psa.nome_razao, psa.cpf_cgc, rec.DT_VENCTO  from fin_contas_receber rec
               inner join glo_pessoas_fj psa on (psa.cnpj = rec.cnpj and psa.codigo = rec.pessoa_fj)
               where rec.cnpj = :cnpj and rec.codigo = :cod_receber
               into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj, :dt_vencto
           do
           begin
             suspend;
           end
         end
       end
       else if (coalesce(:cod_pagar,0) <> 0) then
       begin
         tipo = 'PAGAR';

         select count(*) from fin_contas_pagar pgr
         where pgr.cnpj = :cnpj and pgr.codigo = :cod_pagar
         into :cont_pag;

         if (coalesce(:cont_pag,0) = 0) then
         begin
           status = 'Bx. Integral';

           /*buscando registros em contas baixadas*/
           for select bx.codigo_pg, bx.parcela, bx.idx_qtde, bx.valor, psa.nome_razao, psa.cpf_cgc, bx.dt_vencto
               from fin_baixas_pagar bx
               inner join glo_pessoas_fj psa on (psa.cnpj = bx.cnpj and psa.codigo = bx.pessoa_fj)
               where bx.cnpj = :cnpj and bx.codigo_pg = :cod_pagar
               into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj, :dt_vencto
            do
            begin
              suspend;
            end
         end
         else
         begin
           select count(*) from fin_baixas_pagar bx
           where bx.cnpj = :cnpj and bx.codigo_pg = :cod_pagar
           into :cont_pagda;

           if (coalesce(:cont_pagda,0) > 0) then
             status = 'Bx. Parcial';
           else
             status = 'Integral';

           for select pgr.codigo, pgr.parcela, pgr.idx_qtde, pgr.valor, psa.nome_razao, psa.cpf_cgc, pgr.dt_vencto
               from fin_contas_pagar pgr
               inner join glo_pessoas_fj psa on (psa.cnpj = pgr.cnpj and psa.codigo = pgr.pessoa_fj)
               where pgr.cnpj = :cnpj and pgr.codigo = :cod_pagar
               into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj, :dt_vencto
           do
           begin
             suspend;
           end

         end
       end
    end
end
^

ALTER PROCEDURE PCD_ACT_ESTORNA (
    CNPJ VARCHAR(14),
    ACERTO INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CODIGO_CR INTEGER;
DECLARE VARIABLE CODIGO_PG INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE MAXCODIGO INTEGER;
DECLARE VARIABLE CONT INTEGER;
begin
  select count(*) from act_titulogerado tg
  where tg.cnpj = :cnpj and tg.cod_acertoconta = :acerto
  into :cont;

  /*verificando se os acertos geraram titulos, e tratando com validações*/
  if (:cont > 0) then
  begin
    for select tg.cod_pagar, tg.cod_receber from act_titulogerado tg
        where tg.cnpj = :cnpj and tg.cod_acertoconta = :acerto
        into :codigo_pg, :codigo_cr
    do
    begin
      if (:codigo_pg > 0) then
      begin
         select count(*) from fin_baixas_pagar bx
         where bx.cnpj = :cnpj and bx.codigo_pg = :codigo_pg
         into :existe;

         /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
         if(coalesce(:existe,0) > 0) then
           exception exp_estorna_ttgerado;
         else /*caso não exista basta apenas excluir o contas á receber*/
           delete from fin_contas_pagar pg where pg.cnpj = :cnpj and pg.codigo = :codigo_pg;
      end
      else if (:codigo_cr > 0) then
      begin
         select count(*) from fin_baixas_receber bx
         where bx.cnpj = :cnpj and bx.codigo_cr = :codigo_cr
         into :existe;

         /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
         if(coalesce(:existe,0) > 0) then
           exception exp_estorna_ttgerado;
         else /*caso não exista basta apenas excluir o contas á receber*/
           delete from fin_contas_receber pg where pg.cnpj = :cnpj and pg.codigo = :codigo_cr;
      end
    end
  end

  /*Estornando Contas Recebidas*/
  for select bx.codigo, bx.pessoa_fj, bx.codigo_cr from fin_baixas_receber bx
      where bx.cnpj = :cnpj and bx.cod_acertoconta = :acerto
      order by bx.codigo desc
      into :codigo, :pessoa_fj, :codigo_cr
  do
  begin
     /*verifanco se existe algum movimento que obrigatoriamente deverá ser estornado primeiro*/
     select max(bx.codigo) from FIN_BAIXAS_RECEBER bx where bx.codigo_cr = :codigo_cr and bx.pessoa_fj = :pessoa_fj
     into :maxcodigo;

     /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
     if(coalesce(:maxcodigo,0) > :codigo) then
       exception exp_estorna_baixa;

     /*verificando se este é um movimento de baixa parcial ou integral*/
     select count(*) from  fin_contas_receber rec
     where rec.cnpj = :cnpj and rec.pessoa_fj = :pessoa_fj and rec.codigo = :codigo_cr
     into :existe;

     if (:existe > 0) then
       execute procedure estorna_receber_parcial(:cnpj,:codigo,:pessoa_fj);
     else
       execute procedure estorna_receber_integral(:cnpj,:codigo,:pessoa_fj);

     /*deletando a baixa de contas*/
     delete from fin_baixas_receber bx2 where bx2.cnpj = :cnpj and bx2.codigo = :codigo ;
     /*deletando a baixa de contas*/
  end

  /*Estornando Contas Pagas*/
  for select bx.codigo, bx.pessoa_fj, bx.codigo_pg from fin_baixas_pagar bx
      where bx.cnpj = :cnpj and bx.cod_acertoconta = :acerto
      order by bx.codigo desc
      into :codigo, :pessoa_fj, :codigo_pg
  do
  begin
     /*verifanco se existe algum movimento que obrigatoriamente deverá ser estornado primeiro*/
     select max(bx.codigo) from fin_baixas_pagar bx where bx.codigo_pg = :codigo_pg and bx.pessoa_fj = :pessoa_fj
     into :maxcodigo;

     /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
     if(coalesce(:maxcodigo,0) > :codigo) then
       exception exp_estorna_baixa;

     /*verificando se este é um movimento de baixa parcial ou integral*/
     select count(*) from  fin_contas_pagar pgr
     where pgr.cnpj = :cnpj and pgr.pessoa_fj = :pessoa_fj and pgr.codigo = :codigo_pg
     into :existe;

     if (:existe > 0) then
       execute procedure estorna_pagar_parcial(:cnpj,:codigo,:pessoa_fj);
     else
       execute procedure estorna_pagar_integral(:cnpj,:codigo,:pessoa_fj);

     /*deletando a baixa de contas*/
     delete from fin_baixas_pagar bx2 where bx2.cnpj = :cnpj and bx2.codigo = :codigo ;
     /*deletando a baixa de contas*/
  end

  /*excluindo os movimentos de cheques*/
  delete from fin_cheques ch where ch.cnpj = :cnpj and ch.cod_acertoconta = :acerto;

  /*excluindo os movimentos de cheques*/
  delete from ctb_cheque ch where ch.cnpj = :cnpj and ch.cod_acertoconta = :acerto;

  /*excluindo os movimentos de cartão*/
  delete from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.cod_acertoconta = :acerto;

  /*excluindo os movimentos bancários*/
  delete from ctb_movimento_contabil ctb where ctb.cnpj = :cnpj and ((ctb.cod_acertoconta = :acerto) or (ctb.planilha = :acerto));

  /*excluindo os recibos*/
  delete from fin_recibos rb where rb.cnpj = :cnpj and rb.cod_acertoconta = :acerto;

  /*removendo títulos gerados*/
  delete from act_titulogerado tg where tg.cnpj = :cnpj and tg.cod_acertoconta = :acerto;

  delete from act_acertoconta act where act.cnpj = :cnpj and act.codigo = :acerto;

  suspend;
END
^

ALTER PROCEDURE PCD_ACT_GERA_CONFIG_TITULO (
    CNPJ VARCHAR(14),
    DATAINICIOVARIACAO DATE,
    DATAFIMVARIACAO DATE,
    COD_INDEXADOR INTEGER,
    QUANTIDADEINDEXADOR NUMERIC(18,4),
    JUROSIMPLES SMALLINT,
    TAXAMULTA NUMERIC(18,4),
    CARENCIAMULTA INTEGER,
    TIPODESCONTO INTEGER,
    PERCDESCONTOANTECIPADO NUMERIC(18,4),
    PERCDESCONTOPONTUALIDADE NUMERIC(18,4),
    COD_JURO_POS_FIXADO INTEGER,
    DATAINICIOJUROS DATE,
    CARENCIAJUROS INTEGER,
    TAXARISCO NUMERIC(18,4),
    TAXAJUROS NUMERIC(18,4),
    VIGENCIA INTEGER)
RETURNS (
    COD_CONFIG_TITULO INTEGER)
AS
begin
  cod_config_titulo = GEN_ID(GEN_ACT_CONFIGURACAOTITULO_ID,1);

  insert into ACT_CONFIGURACAOTITULO (
              CNPJ,
              CODIGO ,
              DATAINICIOVARIACAO,
              DATAFIMVARIACAO,
              COD_INDEXADOR             ,
              QUANTIDADEINDEXADOR       ,
              JUROSIMPLES               ,
              TAXAMULTA                 ,
              CARENCIAMULTA             ,
              TIPODESCONTO              ,
              PERCDESCONTOANTECIPADO    ,
              PERCDESCONTOPONTUALIDADE  ,
              COD_JURO_POS_FIXADO       ,
              DATAINICIOJUROS           ,
              CARENCIAJUROS             ,
              TAXARISCO                 ,
              TAXAJUROS                 ,
              VIGENCIA)
  values (    :CNPJ,
              :cod_config_titulo ,
              :DATAINICIOVARIACAO,
              :DATAFIMVARIACAO,
              :COD_INDEXADOR             ,
              :QUANTIDADEINDEXADOR       ,
              :JUROSIMPLES               ,
              :TAXAMULTA                 ,
              :CARENCIAMULTA             ,
              :TIPODESCONTO              ,
              :PERCDESCONTOANTECIPADO    ,
              :PERCDESCONTOPONTUALIDADE  ,
              :COD_JURO_POS_FIXADO       ,
              :DATAINICIOJUROS           ,
              :CARENCIAJUROS             ,
              :TAXARISCO                 ,
              :TAXAJUROS                 ,
              :VIGENCIA);
  suspend;
end
^

ALTER PROCEDURE PCD_ACT_IMPRIME_RECIBO (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
RETURNS (
    ACT_COD_CONTA INTEGER,
    ACT_TIPO_MOVIMENTO VARCHAR(100),
    ACT_DOCTO VARCHAR(20),
    ACT_PARCELA VARCHAR(6),
    ACT_DT_EMISSAO DATE,
    ACT_DT_VENCTO DATE,
    ACT_QTDE_MOEDA NUMERIC(18,4),
    ACT_VALOR_NOMINAL NUMERIC(18,4),
    ACT_JUROS NUMERIC(18,4),
    ACT_VARIACAO NUMERIC(18,4),
    ACT_MULTA NUMERIC(18,4),
    ACT_DESCONTO NUMERIC(18,4),
    ACT_TOTAL NUMERIC(18,4),
    PSA_NOME VARCHAR(50),
    PSA_NOME_RECIBO VARCHAR(50),
    PSA_CPF_CGC VARCHAR(50),
    EMP_NOME VARCHAR(50),
    EMP_IE VARCHAR(15),
    EMP_BAIRRO VARCHAR(50),
    EMP_LOGRADOURO VARCHAR(50),
    EMP_CIDADE VARCHAR(50),
    EMP_NUMERO INTEGER,
    EMP_CNPJ VARCHAR(20),
    ACT_PLANILHA INTEGER,
    ACT_TIPO_ACERTO VARCHAR(100),
    USR_NOME VARCHAR(50),
    B_ACT_VALOR_NOMINAL NUMERIC(18,4),
    B_ACT_JUROS NUMERIC(18,4),
    B_ACT_VARIACAO NUMERIC(18,4),
    B_ACT_MULTA NUMERIC(18,4),
    B_ACT_DESCONTO NUMERIC(18,4),
    B_ACT_TOTAL NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    NUM_NF INTEGER)
AS
DECLARE VARIABLE COD_USUARIO INTEGER;
DECLARE VARIABLE VALOR_RECEBER NUMERIC(18,4);
DECLARE VARIABLE VALOR_PAGAR NUMERIC(18,4);
begin
  /*Dados da empresa*/
  select e.nome, e.ie, e.cnpj, lgd.nome, br.nome, substring(cdd.nome from 1 for 40)||'-'||cdd.uf, e.end_numero
  from sis_empresas e
  left join glo_logradouros lgd on (e.cod_logradouro = lgd.codigo and e.cnpj = lgd.cnpj)
  left join glo_bairros br on (e.cod_bairro = br.codigo and e.cnpj = br.cnpj)
  left join glo_cidades cdd on (e.cod_cidade = cdd.codigo and e.cnpj = cdd.cnpj)
  where e.cnpj = :cnpj
  into :emp_nome, :emp_ie, :emp_cnpj, :emp_logradouro, :emp_bairro, :emp_cidade, :emp_numero;

  emp_cnpj = substring(:emp_cnpj from 1 for 2)||'.'||substring(:emp_cnpj from 3 for 3)||'.'||substring(:emp_cnpj from 6 for 3)||'/'||substring(:emp_cnpj from 9 for 4)||'-'||substring(:emp_cnpj from 13 for 2);

  act_planilha = :planilha;

  /*selecionando a 'pessoa do recibo'*/
  select psa.nome_razao from act_acertoconta act
  inner join glo_pessoas_fj psa on (psa.cnpj = act.cnpj and psa.codigo = act.pessoa_recibo)
  where act.cnpj = :cnpj and act.codigo = :planilha
  into :psa_nome_recibo;


  /*Totalizando Contas á Receber*/
  select sum(rec.vlr_baixa)
  from fin_baixas_receber rec
  left join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and psa.cnpj = rec.cnpj)
  where rec.cnpj = :cnpj and rec.cod_acertoconta = :planilha
  into :valor_receber;

  /*Totalizando Contas á Pagar*/
  select sum(pg.vlr_baixa)
  from fin_baixas_pagar pg
  left join glo_pessoas_fj psa on (psa.codigo = pg.pessoa_fj and psa.cnpj = pg.cnpj)
  where pg.cnpj = :cnpj and pg.cod_acertoconta = :planilha
  into :valor_pagar;


  saldo = (coalesce(:valor_receber,0) - coalesce(:valor_pagar,0));

  /*Dados de contas recebidas  */
  for select rec.codigo_cr, rec.docto, rec.DT_EMISSAO, rec.dt_vencto, rec.BX_IDX_QTDE, rec.valor,
      rec.juros, rec.variacao, rec.multa, rec.descontos, rec.vlr_baixa, rec.PARCELA,
      psa.nome_razao, psa.cpf_cgc, rec.usuario, vd.num_nf
      from fin_baixas_receber rec
      left join fat_vendas vd on (vd.cnpj = rec.cnpj and vd.codigo = rec.codigo_vn)
      left join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and psa.cnpj = rec.cnpj)
      where rec.cnpj = :cnpj and rec.cod_acertoconta = :planilha
      into :act_cod_conta, :act_docto, :act_dt_emissao, :act_dt_vencto, :act_qtde_moeda, :act_valor_nominal,
      :act_juros, :act_variacao, :act_multa, :act_desconto, :act_total, :act_parcela,
      :psa_nome, :psa_cpf_cgc, :cod_usuario, :num_nf
  do
  begin
    act_tipo_movimento = 'Dividas do Parceiro';
    /*Quando este codigo é colocado fora o cod-usuario é perdido*/
    select u.nome from sis_usuarios u
    where u.codigo = :cod_usuario
    into :usr_nome;

    B_ACT_VALOR_NOMINAL = ACT_VALOR_NOMINAL;
    B_ACT_JUROS = ACT_JUROS;
    B_ACT_VARIACAO = ACT_VARIACAO;
    B_ACT_MULTA = ACT_MULTA;
    B_ACT_DESCONTO = ACT_DESCONTO;
    B_ACT_TOTAL = ACT_TOTAL;
    suspend;
  end

  /*Dados de contas pagas  */
  for select pg.codigo_pg, pg.docto, pg.DT_EMISSAO, pg.dt_vencto, pg.BX_IDX_QTDE, pg.valor,
      pg.juros, pg.variacao, pg.multa, pg.descontos, pg.vlr_baixa, pg.PARCELA,
      psa.nome_razao, psa.cpf_cgc, pg.usuario, vd.num_nf
      from fin_baixas_pagar pg
      left join fat_vendas vd on (vd.cnpj = pg.cnpj and vd.codigo = pg.codigo_vn)
      left join glo_pessoas_fj psa on (psa.codigo = pg.pessoa_fj and psa.cnpj = pg.cnpj)
      where pg.cnpj = :cnpj and pg.cod_acertoconta = :planilha
      into :act_cod_conta, :act_docto, :act_dt_emissao, :act_dt_vencto, :act_qtde_moeda, :act_valor_nominal,
      :act_juros, :act_variacao, :act_multa, :act_desconto, :act_total, :act_parcela,
      :psa_nome, :psa_cpf_cgc, :cod_usuario, :num_nf
  do
  begin
    act_tipo_movimento = 'Haveres do Parceiro';
    /*Quando este codigo é colocado fora o cod-usuario é perdido*/
    select u.nome from sis_usuarios u
    where u.codigo = :cod_usuario
    into :usr_nome;

    B_ACT_VALOR_NOMINAL = (-1 * ACT_VALOR_NOMINAL);
    B_ACT_JUROS = (-1 *  ACT_JUROS);
    B_ACT_VARIACAO = (-1 *  ACT_VARIACAO);
    B_ACT_MULTA = (-1 * ACT_MULTA);
    B_ACT_DESCONTO = (-1 * ACT_DESCONTO);
    B_ACT_TOTAL = (-1 * ACT_TOTAL);
    suspend;
  end


end
^

ALTER PROCEDURE PCD_ACT_LISTA_TT_GERADO (
    CNPJ VARCHAR(14),
    ACERTO INTEGER,
    TIPO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    PARCELA VARCHAR(6),
    QTDE_MOEDA NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    NOME_RAZAO VARCHAR(50),
    CPF_CNPJ VARCHAR(15),
    DT_VENCTO DATE)
AS
begin
  if (:tipo = 'R') then
  begin
    for select rec.codigo, rec.parcela, rec.idx_qtde, rec.valor, psa.nome_razao, psa.cpf_cgc, rec.DT_VENCTO  from fin_contas_receber rec
        inner join glo_pessoas_fj psa on (psa.cnpj = rec.cnpj and psa.codigo = rec.pessoa_fj)
        inner join act_titulogerado tg on (tg.cnpj = rec.cnpj and tg.cod_receber = rec.codigo)
        where rec.cnpj = :cnpj and tg.cod_acertoconta = :acerto
        into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj, :dt_vencto
    do
    begin
      suspend;
    end
  end
  else
  begin
    for select pgr.codigo, pgr.parcela, pgr.idx_qtde, pgr.valor, psa.nome_razao, psa.cpf_cgc,
        pgr.dt_vencto
        from fin_contas_pagar pgr
        inner join glo_pessoas_fj psa on (psa.cnpj = pgr.cnpj and psa.codigo = pgr.pessoa_fj)
        inner join act_titulogerado tg on (tg.cnpj = pgr.cnpj and tg.cod_pagar = pgr.codigo)
        where pgr.cnpj = :cnpj and tg.cod_acertoconta = :acerto
        into :codigo, :parcela, :qtde_moeda, :valor, :nome_razao, :cpf_cnpj,
        :dt_vencto
    do
    begin
      suspend;
    end
  end
end
^

ALTER PROCEDURE PCD_ACT_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER,
    TURNO INTEGER,
    DATA_BAIXA DATE,
    VALOR_NOMINAL_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VARIACAO NUMERIC(18,4),
    MOEDA NUMERIC(18,4),
    PLANILHA INTEGER,
    ACT_TIPO_BAIXA CHAR(1))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_PG NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_PG NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
BEGIN

    ano = extract ( year from :data_baixa );
   /*valor da baixa*/
    valor_bx = :valor_nominal_bx + :juros + :multa + :desconto + :variacao;

    /* insere nos movimentos bancarios */
    if (( banco > 0) and ( banco <> conta )) then
    begin
      codigo_cont = gen_id(mov_contabil_ge, 1);

      insert into ctb_movimento_contabil
        (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, fornecedor)
      values
        (:cnpj, :codigo_cont, :data_baixa, 'D', :docto, 'historico de baixa', :valor_bx, :banco, 'PGR', :planilha, 'A', 'DPL', :pessoa_fj);
    end

    /* Percorrendo o Contas à pgr e pegando todas as contas que foram selecionadas*/
    select ano, pessoa_fj, dt_emissao,
         dt_vencto, dt_lancto, docto, parcela, historico,
         (coalesce(valor,0)-coalesce(vlr_parcial,0)), descontos, boleto, origem, codigo_vn,
         aviso, dt_aviso, vlr_parcial, nome,
         dt_ultima_baixa, pgr.centro_custo
     from fin_contas_pagar pgr
     where pgr.cnpj = :cnpj and pgr.codigo = :codigo
     into :ano, :pessoa_fj, :dt_emissao,
          :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
          :valor, :descontos_pg, :boleto, :origem, :codigo_vn,
          :aviso, :dt_aviso, :vlr_parcial, :nome,
          :data_ult_baixa, :centro_custo;


     /*Se a baixar do nominal é igual ao saldo do titulo logo a baixa será integral */

     select codigo from gerar_codigo ('BAIXA_PAGAR',1)   into :codbx;

     insert into fin_baixas_pagar
     (cnpj, codigo, ano, codigo_pg, ano_pg, dt_baixa,
     historico_bx, vlr_baixa, juros, descontos, variacao, multa,
     planilha,   taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
     dt_vencto, dt_lancto, docto, parcela, historico,
     valor, vlr_parcial, juros_pag, descontos_pag, boleto, origem, codigo_vn,
     aviso, dt_aviso, nome, usuario,
     conta, turno,cod_acertoconta,ACT_TIPO_BAIXA,centro_custo)
     values
     (:cnpj, :codbx, :ano, :codigo, :ano, :data_baixa,
     ':historicobx', :valor_bx , :juros, :desconto, :variacao, :multa,
     :planilha,:taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
     :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
     :valor, :vlr_parcial, :juros_pg, :descontos_pg, :boleto, :origem, :codigo_vn,
     :aviso, :dt_aviso, :nome, :usuario,
     :conta, :turno,:planilha,:ACT_TIPO_BAIXA,:centro_custo);

     if (:valor_nominal_bx = :valor ) then
     begin
       /* apaga o contas a receber */
       delete from  fin_contas_pagar
       where cnpj = :cnpj and codigo = :codigo and ano = :ano ;
     end
     else
     begin
       update fin_contas_pagar pgr set pgr.vlr_parcial = coalesce(pgr.vlr_parcial,0) + :valor_nominal_bx,
                                                         pgr.idx_vlr_parcial = pgr.idx_vlr_parcial + :moeda
       where pgr.cnpj = :cnpj and pgr.codigo = :codigo;
     end

end
^

ALTER PROCEDURE PCD_ACT_PAGAS (
    CNPJ CHAR(14),
    COD_ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PGR INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     for select cnpj, codigo, ano, codigo_pg, bx.ano_pg, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_baixa, vlr_parcial, bx.juros_pag, bx.descontos_pag, boleto, origem, codigo_vn, bx.ano_ent, aviso,
            dt_aviso, dt_baixa, historico_bx, juros, descontos,
            planilha, taxa_juros, tipo_juros,
            turno, COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     from fin_baixas_pagar bx
     where cnpj = :cnpj and bx.cod_acertoconta = :COD_ACERTO
     into
            :cnpj, :codigo, :ano, :codigo_pgr, :ano_pg, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_baixa, :vlr_parcial, :juros_pag, :descontos_pg, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
            :dt_aviso, :dt_baixa, :historico_bx, :juros, :descontos,
            :planilha, :taxa_juros, :tipo_juros,
            :turno, :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
     do begin
        local = 'rec' ;

        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
             :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE PCD_ACT_RECEBER (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    BANCO INTEGER,
    TURNO INTEGER,
    DATA_BAIXA DATE,
    VALOR_NOMINAL_BX NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    MULTA NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VARIACAO NUMERIC(18,4),
    MOEDA NUMERIC(18,4),
    PLANILHA INTEGER,
    ACT_TIPO_BAIXA CHAR(1))
AS
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE VALOR_BX NUMERIC(18,4);
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANO SMALLINT;
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA CHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_PARCIAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_REC NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS_REC NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_TRC INTEGER;
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN SMALLINT;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE DATA_ULT_BAIXA DATE;
DECLARE VARIABLE DESTINO INTEGER;
BEGIN

    /*Dados sobre juros*/
    select tx_juros_ate,  tipo_taxa from sis_empresas empe
    where cnpj = :cnpj
    into :taxa_juros, :tipo_juros ;

    ano = extract ( year from :data_baixa );
   /*valor da baixa*/
    valor_bx = :valor_nominal_bx + :juros + :multa - :desconto + :variacao;

    /* insere nos movimentos bancarios */
    if (( banco > 0) and ( banco <> conta )) then
    begin
      codigo_cont = gen_id(mov_contabil_ge, 1);

      insert into ctb_movimento_contabil
        (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, fornecedor)
      values
        (:cnpj, :codigo_cont, :data_baixa, 'C', :docto, 'historico de baixa', :valor_bx, :banco, 'REC', :planilha, 'A', 'DPL', :pessoa_fj);
    end

    /* Percorrendo o Contas à Receber e pegando todas as contas que foram selecionadas*/
    select
         codigo, ano, pessoa_fj, dt_emissao,
         dt_vencto, dt_lancto, docto, parcela, historico,
         (coalesce(valor,0)-coalesce(vlr_parcial,0)), juros_rec, descontos, boleto, origem, codigo_vn, ano_vn,
         aviso, dt_aviso, vlr_parcial, nome, numboleto, numduplicata,
         cobrador, local_cobranca, codigo_trc, data_ult_baixa
     from fin_contas_receber rec
     where cnpj = :cnpj and rec.codigo = :codigo
     into
         :codrec, :ano, :pessoa_fj, :dt_emissao,
         :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn,
         :aviso, :dt_aviso, :vlr_parcial, :nome, :numboleto, :numduplicata,
          :cobrador, :local_cobranca,:codigo_trc, :data_ult_baixa;


     /*Se a baixar do nominal é igual ao saldo do titulo logo a baixa será integral */

     select codigo from gerar_codigo ('BAIXA_RECEBER',1)
     into :codbx;

     insert into fin_baixas_receber
     (cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
     historico_bx, vlr_baixa, juros, descontos,multa, variacao, planilha,
     taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
     dt_vencto, dt_lancto, docto, parcela, historico,
     valor, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn,
     ano_vn, aviso, dt_aviso, nome, usuario, numboleto, numduplicata,
     conta, turno, cobrador, local_cobranca ,codigo_trc, cod_acertoconta,ACT_TIPO_BAIXA)
     values
     (:cnpj, :codbx, :ano, :codrec, :ano, :data_baixa,
     ':historicobx', :valor_bx , :juros, :desconto,:multa, :variacao, :planilha,
     :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
     :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
     :valor, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn,
     :ano_vn, :aviso, :dt_aviso, :nome, :usuario, :numboleto, :numduplicata,
     :conta, :turno, :cobrador, :local_cobranca,:codigo_trc, :planilha,:ACT_TIPO_BAIXA);

     if (:valor_nominal_bx = :valor ) then
     begin
       /* apaga o contas a receber */
       delete from  fin_contas_receber
       where cnpj = :cnpj and codigo = :codrec and ano = :ano ;
     end
     else
     begin
       update fin_contas_receber rec set rec.vlr_parcial = coalesce(rec.vlr_parcial,0) + :valor_nominal_bx,
                                         rec.idx_vlr_parcial = rec.idx_vlr_parcial + :moeda
       where rec.cnpj = :cnpj and rec.codigo = :codigo;
     end

end
^

ALTER PROCEDURE PCD_ACT_RECEBIDAS (
    CNPJ CHAR(14),
    COD_ACERTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     for select cnpj, codigo, ano, codigo_cr, ano_cr, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_baixa, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn, ano_vn, aviso,
            dt_aviso, dt_baixa, historico_bx, juros, descontos,
            planilha, taxa_juros, tipo_juros, numboleto, numduplicata, fatura,
            turno, COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     from fin_baixas_receber bx
     where cnpj = :cnpj and bx.cod_acertoconta = :COD_ACERTO
     into
            :cnpj, :codigo, :ano, :codigo_cr, :ano_cr, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_baixa, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
            :dt_aviso, :dt_baixa, :historico_bx, :juros, :descontos,
            :planilha, :taxa_juros, :tipo_juros, :numboleto, :numduplicata, :fatura,
            :turno, :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
     do begin
        local = 'rec' ;

        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
             :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE PCD_ATUALIZA_ULT_VENDA (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1),
    ENTSAID CHAR(1),
    MOVEST CHAR(1),
    DATA_ULT_VD DATE)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
begin
  if ((:entsaid = 'S') and (:movest = 'S'))then
  begin
    if ((:new_fechada = 'S') and (:old_fechada = 'N')) then
    begin
      for select prd.codigo from fat_vendas_itens vdi
          inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
          where vdi.codigo = :codigo and vdi.cnpj = :cnpj
          into :produto
      do
      begin
           update est_produtos prd set dt_ult_venda = :data_ult_vd
           where prd.cnpj = :cnpj and prd.codigo = :produto;
      end
    end
  end
END
^

ALTER PROCEDURE PCD_BAIXA_BOLETO (
    CNPJ VARCHAR(14),
    USUARIO INTEGER,
    TURNO INTEGER,
    NOSSONUM BIGINT,
    BANCO INTEGER,
    VALOR_BX NUMERIC(18,4),
    VLR_JUROS_BX NUMERIC(18,4),
    DT_CRED DATE)
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE FATURA INTEGER;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DOCTO VARCHAR(20);
DECLARE VARIABLE PARCELA INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE BOLETO CHAR(1);
DECLARE VARIABLE ORIGEM CHAR(3);
DECLARE VARIABLE CODIGO_VN INTEGER;
DECLARE VARIABLE ANO_VN INTEGER;
DECLARE VARIABLE AVISO INTEGER;
DECLARE VARIABLE DT_AVISO DATE;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NUMBOLETO INTEGER;
DECLARE VARIABLE NUMDUPLICATA INTEGER;
DECLARE VARIABLE COBRADOR INTEGER;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE CODBX INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE ANOREC INTEGER;
DECLARE VARIABLE HISTORICOBX VARCHAR(50);
DECLARE VARIABLE TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE TIPO_JUROS NUMERIC(18,4);
DECLARE VARIABLE BLT_NOSSO_NUM BIGINT;
DECLARE VARIABLE BLT_REM_GERADA CHAR(1);
begin
  /*Pendencias:
   - Os boletos não estão sendo considerados os descontos, não sei se
     o componente gbCobranca do delphi retorna o valor ou percentual de desconto do
     título, ms se retornar tenho de considerar e aplicar ao sistema*/


  /*Procedimento utilzado para baixar contas a receber baseando-se no arquivo de
  retorno dos titulos*/

  /*pegando a taxa de juros, no boleto equivale a mora diaria*30, já que aqui
  é a taxa de juros ao mês*/
  select (coalesce(emp.mora_diaria,0)*30), emp.tipo_taxa from sis_empresas emp
  where cnpj = :cnpj
  into :taxa_juros, :tipo_juros;

  /*Encontrando a conta a receber*/
  select pessoa_fj, dt_emissao, fatura, dt_vencto, dt_lancto,
    docto, parcela, historico, valor, boleto, origem,
    codigo_vn, ano_vn, aviso, dt_aviso, nome, numboleto,
    numduplicata, cobrador, local_cobranca,
    REC.blt_nosso_num, REC.blt_rem_gerada
  from fin_contas_receber rec
  where cnpj = :cnpj and  rec.blt_nosso_num = :nossonum and rec.blt_banco = :banco
  into
    :pessoa_fj, :dt_emissao, :fatura, :dt_vencto, :dt_lancto,
    :docto, :parcela, :historico, :valor,:boleto, :origem,
    :codigo_vn, :ano_vn,  :aviso, :dt_aviso, :nome, :numboleto,
    :numduplicata, :cobrador, :local_cobranca,
    :blt_nosso_num, :blt_rem_gerada;

    /*Existem alguns campos q normalmente são importantes em outros tipos de baixa, tal como valor parcial
    juros recebidos.. entre outros; q servem para armazenar valores parciais ja baixados de uma conta,
    neste caso(boleto), uma conta nunca terá valores parciais, ou será a totalidade o nada */


  ano = extract (year from :dt_cred);

  /*gerando código da baixa*/
  codbx = gen_id(fin_baixa_receber_ge,1);

  historicobx = 'BAIXA POR RETORNO BANCARIO';


 /*A conta será baixada pelo banco*/
 insert into fin_baixas_receber
    (cnpj, codigo, ano, codigo_cr, ano_cr, dt_baixa,
     historico_bx, vlr_baixa, juros, descontos, planilha,
     taxa_juros, tipo_juros, pessoa_fj, dt_emissao,
     dt_vencto, dt_lancto, docto, parcela, historico,
     valor, boleto, origem, codigo_vn,
     ano_vn, aviso, dt_aviso, fatura, nome, usuario,
     numboleto, numduplicata, conta, turno, cobrador, local_cobranca,
     blt_banco, blt_nosso_num, blt_rem_gerada)
  values
   (:cnpj, :codbx, :ano, :codrec, :anorec, :dt_cred,
    :historicobx, :valor_bx, :VLR_JUROS_BX, 0, 0,
    :taxa_juros, :tipo_juros, :pessoa_fj, :dt_emissao,
    :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
    :valor, :boleto, :origem, :codigo_vn,
    :ano_vn, :aviso, :dt_aviso, :fatura, :nome, :usuario,
    :numboleto, :numduplicata, :banco, :turno, :cobrador, :local_cobranca,
    :banco, :blt_nosso_num, :blt_nosso_num);

  /*gerando código do movimento*/
  codigo_cont = gen_id(mov_contabil_ge, 1);

  insert into ctb_movimento_contabil
  (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, tipo_lancamento, cod_doc, fornecedor )
  values
  (:cnpj, :codigo_cont, :dt_cred, 'C', :docto, :historicobx, :valor_bx, :banco, 'REC', 'A', 'BLT', :pessoa_fj);
     
  /*apaga o contas a receber */
  delete from  fin_contas_receber rec
  where cnpj = :cnpj and  rec.blt_nosso_num = :nossonum and rec.blt_banco = :banco;

  suspend;
END
^

ALTER PROCEDURE PCD_BLT_GERA_TITULOS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CONTACORRENTE INTEGER,
    ORIGEM CHAR(1))
RETURNS (
    BLT_NUM_COPIAS INTEGER,
    BLT_LAYOUT_IMPRESSAO CHAR(1),
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    CED_NOME VARCHAR(50),
    CED_RUA VARCHAR(50),
    CED_NUM VARCHAR(15),
    CED_EMAIL VARCHAR(80),
    CED_CEP VARCHAR(8),
    CED_CIDADE VARCHAR(50),
    CED_UF VARCHAR(2),
    CED_BAIRRO VARCHAR(50),
    CED_CPF_CGC VARCHAR(14),
    BLT_CARTEIRA VARCHAR(10),
    BLT_MODALIDADE VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_MULTA NUMERIC(18,4),
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    REC_DESCONTO NUMERIC(18,4),
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE,
    REC_CODIGO INTEGER)
AS
declare variable var_endereco integer;
declare variable var_bairro integer;
declare variable var_cidade integer;
begin
  /* Procedimento retornará os dados necessários para a impressão e para a geração da
     remessa dos boletos. Sé será util para:
    1 : Imprimir um único boleto, seja ele de Venda ou Receber
    2 : Gerar a Remessa de dados ao banco de um determinado período.
 */
   select e.nome,
          lgd.nome,
          e.end_numero,
          e.email,
          e.cep,
          lgd.nome,
          e.uf,
          br.nome,
          e.cnpj

   from sis_empresas e
   left join glo_logradouros lgd on (lgd.cnpj = e.cnpj and lgd.codigo = e.cod_logradouro)
   left join glo_bairros br on (br.cnpj = e.cnpj and br.codigo = e.cod_bairro)
   left join glo_cidades cdd on (cdd.cnpj = e.cnpj and cdd.codigo = e.cod_cidade)
   where e.cnpj = :cnpj
   into ced_nome ,
    ced_rua ,
    ced_num ,
    ced_email ,
    ced_cep ,
    ced_cidade ,
    ced_uf ,
    ced_bairro ,
    ced_cpf_cgc;


   /*dados do boleto*/
   select c.agencia, substring(c.dv_agencia from 1 for 1), substring(c.conta_corrente from 1 for 10), substring(c.dv_conta_corrente from 1 for 1),
          c.blt_carteira, c.blt_cod_cedente, c.blt_dig_cod_cedente,
          c.blt_convenio, c.blt_instrucao, c.blt_layout, c.blt_local_pagto,
          c.BLT_ACEITE_DOCTO, c.BLT_DIAS_ABATIMENTO, c.BLT_DIAS_DESCONTO,
          c.BLT_DIAS_MORA_JUROS, c.BLT_DIAS_PROTESTO, c.BLT_PCT_ABATIMENTO,
          c.BLT_PCT_DESCONTO, c.desp_bancaria, c.BLT_VLR_IOF, c.mora_diaria,
          c.BLT_VLR_OUTRAS_DESP, c.BLT_MULTA,
          c.blt_modalidade, b.codigo, b.nome,
          coalesce(c.BLT_LAYOUT_IMPRESSAO,1), coalesce(c.BLT_NUM_COPIAS,1)
          from ctb_planoconta c
          inner join fin_banco b on (b.codigo = c.banco)
          where cnpj = :cnpj and c.conta = :contacorrente
   into :blt_agencia, :blt_dig_agencia, :blt_conta, :blt_dig_conta, :blt_carteira,
        :ced_codigoced, :ced_dig_codigoced , :blt_convenio, :blt_instrucao,:blt_layout,:blt_local_pagto,
        :BLT_ACEITE_DOCTO, :BLT_DIAS_ABATIMENTO, :BLT_DIAS_DESCONTO,
        :BLT_DIAS_MORA_JUROS, :BLT_DIAS_PROTESTO, :BLT_PCT_ABATIMENTO,
        :BLT_PCT_DESCONTO, :BLT_VLR_DESPESA, :BLT_VLR_IOF, :BLT_VLR_MORA_JUROS,
        :BLT_VLR_OUTRAS_DESP, :BLT_MULTA,
        :blt_modalidade, :blt_banco, :blt_nome_banco,
        :blt_layout_impressao, :blt_num_copias;

  /*Origem de vendas, ou seja tem como parâmetro de pesquisa o codigo da venda e pesquisará em
  conas a receber, todas as contas que possuem vínculo com a venda*/
  if (:origem = 'V') then
  begin
    for select psa.nome_razao, psa.complemento, psa.numero, psa.email,
        psa.cep, psa.pessoa, psa.cpf_cgc, psa.bairro, psa.cidade,
        psa.endereco, rec.valor, rec.dt_vencto, rec.DT_LANCTO,
        rec.blt_nosso_num, rec.vlr_parcial, rec.descontos, rec.codigo

        from fin_contas_receber rec
        inner join fat_vendas vd on (vd.cnpj = rec.cnpj and vd.codigo = rec.codigo_vn and vd.pessoa_fj = rec.pessoa_fj)
        inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj)
        where rec.cnpj = :cnpj and rec.codigo_vn = :codigo
    into
      :sac_nome, :sac_complemento, :sac_num, :sac_email,
      :sac_cep, :sac_pessoa, :sac_cpf_cgc, :var_bairro,:var_cidade,
      :var_endereco, :blt_valor, :blt_dt_vencto, :blt_dt_lancto,
      :nosso_numero, :rec_vlr_parcial, :rec_desconto, :rec_codigo
    do
    begin
        select lrg.nome from glo_logradouros lrg where lrg.codigo = :var_endereco and lrg.cnpj = :cnpj
        into :sac_rua;
  
        select br.nome from glo_bairros br where br.codigo = :var_bairro and br.cnpj = :cnpj
        into :sac_bairro;
  
        select cdd.nome, cdd.uf from glo_cidades cdd where cdd.codigo = :var_cidade and cdd.cnpj = :cnpj
        into :sac_cidade, :sac_uf;
  

  
       suspend;
    end
  end/*Requisição vinda de recebimento*/
  else if (:origem = 'R') then
  begin
    select psa.nome_razao, psa.complemento, psa.numero, psa.email,
        psa.cep, psa.pessoa, psa.cpf_cgc, psa.bairro, psa.cidade,
        psa.endereco, rec.valor, rec.dt_vencto, rec.DT_LANCTO,
        rec.blt_nosso_num, rec.vlr_parcial, rec.descontos, rec.data_ult_baixa, rec.codigo
        from fin_contas_receber rec
        inner join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and rec.cnpj = psa.cnpj)
        where rec.cnpj = :cnpj and rec.codigo = :codigo
    into
      :sac_nome, :sac_complemento, :sac_num, :sac_email,
      :sac_cep, :sac_pessoa, :sac_cpf_cgc, :var_bairro,:var_cidade,
      :var_endereco, :blt_valor, :blt_dt_vencto, :blt_dt_lancto,
      :nosso_numero, :rec_vlr_parcial, :rec_desconto, :rec_data_ult_baixa, :rec_codigo;

        select lrg.nome from glo_logradouros lrg where lrg.codigo = :var_endereco and lrg.cnpj = :cnpj
        into :sac_rua;
  
        select br.nome from glo_bairros br where br.codigo = :var_bairro and br.cnpj = :cnpj
        into :sac_bairro;
  
        select cdd.nome, cdd.uf from glo_cidades cdd where cdd.codigo = :var_cidade and cdd.cnpj = :cnpj
        into :sac_cidade, :sac_uf;
  

       suspend;
  end
END
^

ALTER PROCEDURE PCD_CALC_MED_COPIA (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(15),
    ITEM_CONTRATO INTEGER)
AS
DECLARE VARIABLE CONTADOR INTEGER;
DECLARE VARIABLE OLD_COD_OS INTEGER;
DECLARE VARIABLE OLD_CONTADOR_TOTAL INTEGER;
DECLARE VARIABLE OLD_DATA_FECHAMENTO DATE;
DECLARE VARIABLE CONTADOR_ATUAL INTEGER;
DECLARE VARIABLE DATA_FECHAMENTO_ATUAL DATE;
DECLARE VARIABLE DATA_FECHAMENTO_FINAL DATE;
DECLARE VARIABLE TOTAL_COPIA INTEGER;
DECLARE VARIABLE TOTAL_DIA INTEGER;
DECLARE VARIABLE TOTAL_COPIAX1 INTEGER;
DECLARE VARIABLE TOTAL_DIAX1 INTEGER;
DECLARE VARIABLE TOTAL_COPIAX2 INTEGER;
DECLARE VARIABLE TOTAL_DIAX2 INTEGER;
DECLARE VARIABLE CONTADOR_FINAL INTEGER;
DECLARE VARIABLE CONTADOR_AUX INTEGER;
DECLARE VARIABLE CODIGO_AUX INTEGER;
DECLARE VARIABLE DATA_TROCA_AUX DATE;
DECLARE VARIABLE MEDIA_COPIA INTEGER;
begin
   CONTADOR   = 1;
   codigo_aux = NULL;
  /* Pega o ultimo contador do equipamento da ultima OS */
  for
  select first 5
  ofc.codigo, coalesce(ofc.contador_total,0), cast(ofc.data_fechamento as date)
  from ofc_ordem_servico ofc
  where (ofc.cnpj = :cnpj) and (:pessoa_fj = :pessoa_fj) and (ofc.produto = :produto)
  and (ofc.data_fechamento is not null)
  and (ofc.contador_total > 0)
  order by ofc.data_fechamento desc,  ofc.contador_total desc
  into :old_cod_os, :old_contador_total, :old_data_fechamento
  do begin
    /*inicializando os valores*/
    if( :contador = 1 )then
    begin
      contador_atual = old_contador_total;
      data_fechamento_atual = old_data_fechamento;
      contador_aux = old_contador_total;
    end

    if (:old_contador_total > :CONTADOR_AUX) then
    begin
      codigo_aux = :old_cod_os;
      data_troca_aux = old_data_fechamento;
    end

    CONTADOR_AUX = :old_contador_total;
    contador = contador + 1;
  end

  /*Se codigo aux for diferente de null é sinal que houve alguma
  diferença "estranha" nos contadores, ou por ocasiao de troca da placa e
  por extenção com o zeramento do contador ou mesmo por erro de digitação do usuário*/
  if (:codigo_aux is not null) then
  begin
    /*-----------------caulando o primeiro intervalo-------------------*/
    /*encontrando o contador do ultimo registro antes da "troca" para usar no where abaixo*/
    select coalesce(ofc.contador_total,0) from ofc_ordem_servico ofc
    where cnpj = :cnpj and codigo = :codigo_aux
    into :contador_aux;

    contador = 1;
    /*os cinco ultimos 5 atendimentos antes da troca da placa ou erro..*/
    for
    select first 5
    coalesce(ofc.contador_total,0), cast(ofc.data_fechamento as date)
    from ofc_ordem_servico ofc
    where (ofc.cnpj = :cnpj) and (:pessoa_fj = :pessoa_fj) and (ofc.produto = :produto)
    and (ofc.data_fechamento is not null)
    and (ofc.contador_total > 0) and ofc.contador_total <= :contador_aux and ofc.data_fechamento <= :data_troca_aux
    order by ofc.data_fechamento desc, ofc.contador_total desc
    into :old_contador_total, :old_data_fechamento
    do
    begin
      if (:contador = 1) then
      begin
        contador_atual = old_contador_total;
        data_fechamento_atual = old_data_fechamento;
      end
      contador = contador + 1;
    end

    contador_final      = old_contador_total;
    data_fechamento_final = old_data_fechamento;

    total_copiaX1 = contador_atual - contador_final;
    total_diaX1   = data_fechamento_atual - data_fechamento_final;

    /*-----------------caulando o segundo intervalo-------------------*/
    /*os cinco ultimos 5 atendimentos depois da troca da placa ou erro..*/
    contador = 1;
    for
    select first 5
    coalesce(ofc.contador_total,0), cast(ofc.data_fechamento as date)
    from ofc_ordem_servico ofc
    where (ofc.cnpj = :cnpj) and (:pessoa_fj = :pessoa_fj) and (ofc.produto = :produto)
    and (ofc.data_fechamento is not null)
    and (ofc.contador_total > 0) and ofc.data_fechamento > :data_troca_aux
    order by ofc.data_fechamento desc, ofc.codigo desc
    into :old_contador_total, :old_data_fechamento
    do
    begin
      if (:contador = 1) then
      begin
        contador_atual = old_contador_total;
        data_fechamento_atual = old_data_fechamento;
      end
      contador = contador + 1;
    end

    contador_final      = old_contador_total;
    data_fechamento_final = old_data_fechamento;

    /*-------------------apenas um registro a frente do intervalo de troca------------------------*/
    if ((contador_atual = contador_final) and (data_fechamento_atual = data_fechamento_final)) then
    begin
      total_copiax2 = contador_atual;
      total_diax2   = data_fechamento_atual - :data_troca_aux;
    end
    else
    begin
      total_copiax2 = contador_atual - contador_final;
      total_diax2   = data_fechamento_atual - data_fechamento_final;
    end

    /*#####################totalizando os dois intervalos###############################*/
    total_copia = total_copiax1 + total_copiax2;
    total_dia   = total_diax1 + total_diax2;
  end
  else
  begin
    /*caso normal*/
     contador_final      = old_contador_total;
     data_fechamento_final = old_data_fechamento;

    /* CALCULO DE TOTAL DOS ULTIMOS 5 ATENDIMENTOS E MEDIA DE COPIAS */
    total_copia = contador_atual - contador_final;
    total_dia   = data_fechamento_atual - data_fechamento_final;
  end

  media_copia = 0;
  if( total_dia > 0 )then
    media_copia = cast((total_copia  / total_dia) as integer);



  update ofc_contratos_itens cti
  set cti.media_copias = :media_copia
  where cti.codigo = :item_contrato;


  suspend;
END

^

ALTER PROCEDURE PCD_CALC_MED_COPIA_LT (
    CNPJ VARCHAR(14),
    CODIGO_ITEM INTEGER)
AS
DECLARE VARIABLE CONTADOR INTEGER;
DECLARE VARIABLE OLD_COD_LT INTEGER;
DECLARE VARIABLE OLD_LEITURA_ATUAL INTEGER;
DECLARE VARIABLE OLD_DATA_REFERENCIA DATE;
DECLARE VARIABLE CONTADOR_ATUAL INTEGER;
DECLARE VARIABLE DATA_REFERENCIA_ATUAL DATE;
DECLARE VARIABLE DATA_REFERENCIA_FINAL DATE;
DECLARE VARIABLE TOTAL_COPIA INTEGER;
DECLARE VARIABLE TOTAL_DIA INTEGER;
DECLARE VARIABLE TOTAL_COPIAX1 INTEGER;
DECLARE VARIABLE TOTAL_DIAX1 INTEGER;
DECLARE VARIABLE TOTAL_COPIAX2 INTEGER;
DECLARE VARIABLE TOTAL_DIAX2 INTEGER;
DECLARE VARIABLE CONTADOR_FINAL INTEGER;
DECLARE VARIABLE CONTADOR_AUX INTEGER;
DECLARE VARIABLE CODIGO_AUX INTEGER;
DECLARE VARIABLE DATA_TROCA_AUX DATE;
DECLARE VARIABLE MEDIA_COPIA INTEGER;
begin
   CONTADOR   = 1;
   codigo_aux = NULL;
  /* Pega o ultimo contador do equipamento da ultima OS */
  for
  select first 5
  lt.codigo, coalesce(lti.leitura_atual,0), cast(LT.data_referencia as date)
  from ofc_leituras lt
  inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
  where (lt.cnpj = :cnpj) and (lti.cod_item_contrato = :codigo_item)
  and lt.fechada = 'S' and (lti.leitura_atual > 0)
  order by lt.data_referencia desc,  lti.leitura_atual desc
  into :old_cod_lt, :old_leitura_atual, :old_data_referencia
  do begin
    if( :contador = 1 )then
    begin
      contador_atual = :old_leitura_atual;
      data_referencia_atual = :old_data_referencia;
      contador_aux = :old_leitura_atual;
    end

    if (:old_leitura_atual > :contador_aux) then
    begin
      codigo_aux = :old_cod_lt;
      data_troca_aux = :old_data_referencia;
    end

    CONTADOR_AUX = :old_leitura_atual;
    contador = contador + 1;
  end

  /*Se codigo aux for diferente de null é sinal que houve alguma
  diferença "estranha" nos contadores, ou por ocasiao de troca da placa do equipamento, e
  por extenção com o zeramento do contador ou mesmo por erro de digitação do usuário*/
  if (:codigo_aux is not null) then
  begin
    /*-----------------caulando o primeiro intervalo-------------------*/
    /*encontrando o contador do ultimo registro antes da "troca" para usar no where abaixo*/
    select coalesce(lti.leitura_atual,0) from ofc_leituras_itens lti
    where cnpj = :cnpj and lti.leitura = :codigo_aux and lti.cod_item_contrato = :codigo_item
    into :contador_aux;

    contador = 1;
    /*os cinco ultimos 5 atendimentos antes da troca da placa ou erro..*/
    for
    select first 5
    coalesce(lti.leitura_atual,0), cast(lt.data_referencia as date)
    from ofc_leituras lt
    inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
    where (lt.cnpj = :cnpj) and (lti.cod_item_contrato = :codigo_item) and lt.fechada = 'S'
    and (lti.leitura_atual > 0) and lti.leitura_atual <= :contador_aux
    and lt.data_referencia <= :data_troca_aux
    order by lt.data_referencia desc, lti.leitura_atual desc
    into :old_leitura_atual, :old_data_referencia
    do
    begin
      if (:contador = 1) then
      begin
        contador_atual = :old_leitura_atual;
        data_referencia_atual = :old_data_referencia;
      end
      contador = contador + 1;
    end

    contador_final      = :old_leitura_atual;
    data_referencia_final = :old_data_referencia;

    total_copiaX1 = contador_atual - contador_final;
    total_diaX1   = :data_referencia_atual - :data_referencia_final;

    /*-----------------caulando o segundo intervalo-------------------*/
    /*os cinco ultimos 5 atendimentos depois da troca da placa ou erro..*/
    contador = 1;
    for
    select first 5
    coalesce(lti.leitura_atual,0), cast(lt.data_referencia as date)
    from ofc_leituras lt
    inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
    where (lt.cnpj = :cnpj) and (lti.cod_item_contrato = :codigo_item) and lt.fechada = 'S'
    and (lti.leitura_atual > 0) and lt.data_referencia > :data_troca_aux
    order by lt.data_referencia desc, lt.codigo desc
    into :old_leitura_atual, :old_data_referencia
    do
    begin
      if (:contador = 1) then
      begin
        contador_atual = :old_leitura_atual;
        data_referencia_atual = :old_data_referencia;
      end
      contador = contador + 1;
    end

    contador_final      = :old_leitura_atual;
    data_referencia_final = :old_data_referencia;

    /*-------------------apenas um registro a frente do intervalo de troca------------------------*/
    if ((contador_atual = contador_final) and (:data_referencia_atual = :data_referencia_final)) then
    begin
      total_copiax2 = contador_atual;
      total_diax2   = :data_referencia_atual - :data_troca_aux;
    end
    else
    begin
      total_copiax2 = :contador_atual - :contador_final;
      total_diax2   = :data_referencia_atual - :data_referencia_final;
    end

    /*#####################totalizando os dois intervalos###############################*/
    total_copia = total_copiax1 + total_copiax2;
    total_dia   = total_diax1 + total_diax2;
  end
  else
  begin
    /*caso normal*/
     contador_final      = :old_leitura_atual;
     data_referencia_final = :old_data_referencia;

    /* CALCULO DE TOTAL DOS ULTIMOS 5 ATENDIMENTOS E MEDIA DE COPIAS */
    total_copia = contador_atual - contador_final;
    total_dia   = :data_referencia_atual - :data_referencia_final;
  end

  media_copia = 0;
  if (total_dia > 0) then
    media_copia = cast((total_copia / total_dia) as integer);

  update ofc_contratos_itens cti set cti.media_copias = :media_copia
  where cti.codigo = :codigo_item;

  suspend;
END
^

ALTER PROCEDURE PCD_CALCULA_COMISSAO_FAIXA (
    CNPJ VARCHAR(18),
    VENDEDOR INTEGER,
    VALOR_VISTA NUMERIC(18,4),
    VALOR_PRAZO NUMERIC(18,4))
RETURNS (
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE PCT_VISTA NUMERIC(18,4);
DECLARE VARIABLE PCT_PRAZO NUMERIC(18,4);
begin
  /*encontrando todos os valores que se enquadram na faixa de pagamento,
  ex: se para até
      5.000 comissão é 0,05
      8.000 comissão é 0,04
      18.000 comissão é 0,03
  e eu tenha entrado com um valor de 6.000 de vendas, então este procedimento irá trazer os
  3 registros ordenando pelo valor(5,8,18) o percentual
  na 1º volta do laço recebe 0,05 e sai*/
  for select vdx.prazo from fat_vendedor_faixas vdx
      where vdx.codigo = :vendedor and vdx.valor >= :valor_prazo
      order by vdx.valor
      into :pct_prazo
  do
  begin
    break;
  end

  /*isso quer dizer o valor de vendas superou ao de comissões cadastrados
  e vou passar a usar o maior valor cadastrado*/
  if (:pct_prazo is null) then
  begin
    select max(vdx.prazo) from fat_vendedor_faixas vdx
    where vdx.codigo = :vendedor
    into :pct_prazo;
  end
  com_prazo = ((:valor_prazo * :pct_prazo)/100.00);


  /*achando a comissão valor a prazo*/
  for select vdx.vista from fat_vendedor_faixas vdx
      where vdx.codigo = :vendedor and vdx.valor >= :valor_vista
      order by vdx.valor
      into :pct_vista
  do
  begin
    break;
  end

  /*isso quer dizer o valor de vendas superou ao de comissões cadastrados
  e vou passar a usar o maior valor cadastrado*/
  if (:pct_vista is null) then
  begin
    select max(vdx.vista) from fat_vendedor_faixas vdx
    where vdx.codigo = :vendedor
    into :pct_vista;
  end
  com_vista = ((:valor_vista * :pct_vista)/100.00);

  suspend;
END
^

ALTER PROCEDURE PCD_CALCULA_JUROS (
    CNPJ VARCHAR(18),
    VALOR NUMERIC(18,4),
    DATA_VECTO DATE,
    DATA_CALC DATE,
    TX_JUROS_ATE NUMERIC(18,8),
    TX_JUROS_APOS NUMERIC(18,8),
    TIPO CHAR(1),
    TOLERANCIA_JUROS INTEGER)
RETURNS (
    VALOR_JUROS NUMERIC(18,8))
AS
DECLARE VARIABLE TX_JUROS_DIA NUMERIC(18,8);
DECLARE VARIABLE VLR_AUX NUMERIC(18,8);
DECLARE VARIABLE EXP_AUX NUMERIC(18,8);
DECLARE VARIABLE DIAS INTEGER;
DECLARE VARIABLE CONT INTEGER;
begin
  if (:data_calc < (:data_vecto + :tolerancia_juros)) then
  begin
    valor_juros = 0;
    suspend;
    exit;
  end

  /*fica muito lento pesquisar isso a cada conta a receber
  por isso nos procedures estou passando direto estes valores já que são estáticos*/
  /*vlr. pct de juros */
  if ( (coalesce(:tx_juros_apos,0) = 0) or (coalesce(:tx_juros_ate,0) = 0) ) then
  begin
    select e.tx_juros_apos, e.tx_juros_ate, e.tipo_taxa
    from sis_empresas e
    where cnpj = :cnpj
    into :tx_juros_apos, :tx_juros_ate, :tipo;

    /*tolerância de juros*/
    select coalesce(c.tolerancia_juros,0)
    from sis_configuracoes c
    where cnpj = :cnpj
    into :tolerancia_juros;
  end

  data_vecto = :data_vecto /*+ :tolerancia_juros*/;
  tx_juros_dia = (:tx_juros_apos / 30.00);
  dias = (:data_calc - :data_vecto); /*N = Período*/

  /*Juros compostos*/
  if (:tipo = 'C') then
  begin
    /*M = C (1 + i )^n , onde C é o capital, i é a taxa % e n é o período de tempo. */
    tx_juros_dia = (:tx_juros_dia /100.00); /*i = Juros Dia p/ q se for 4% fique 0,04*/
    exp_aux = (1+:tx_juros_dia); /*Vlr. p/Calculo do expoente*/

    cont = 1;
    vlr_aux = :exp_aux;
    /*(1 + i )^n*/
    if (:cont > :dias) then /*validacao implementada por conta do relatório de posicao de titulos pendentes - OS 2005*/
      valor_juros = 0;
    else
    begin
        while (cont < dias) do
        begin
          vlr_aux = (:vlr_aux * :exp_aux);
          cont = :cont + 1;
        end
    
        valor_juros = (:valor * :vlr_aux);
        valor_juros = (:valor_juros - :valor);
    end
  end
  else /*Juros Simples*/
    valor_juros = (:valor * (:tx_juros_dia * dias)) /100;

  suspend;
END
^

ALTER PROCEDURE PCD_CALCULA_MULTA_REC (
    CNPJ VARCHAR(18),
    COD_REC INTEGER,
    PESSOA_FJ INTEGER,
    VENDA INTEGER,
    DATA DATE,
    TOLERANCIA_JUROS INTEGER,
    MULTA_FINANCEIRA NUMERIC(18,4))
RETURNS (
    VALOR_MULTA NUMERIC(18,4))
AS
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_ULT_BAIXA DATE;
DECLARE VARIABLE VALOR_CONTA NUMERIC(18,4);
DECLARE VARIABLE DT_AUX DATE;
DECLARE VARIABLE DIAS INTEGER;
begin
  /* Procedimento utilazado nas rotinas de baixa irá calcular os valores das
  multas da conta a receber passada */
  if ((:tolerancia_juros is null) or (:multa_financeira is null)) then
  begin
    select tolerancia_juros, multa_financeira
    from sis_configuracoes
    where cnpj = :cnpj
    into :tolerancia_juros, :multa_financeira;
  end

  /*pegando os dados da conta */
  select (coalesce(rec.valor,0) - coalesce(rec.vlr_parcial,0)),
  rec.data_ult_baixa, rec.dt_vencto
  from fin_contas_receber rec
  where rec.cnpj = :cnpj and rec.codigo = :cod_rec and rec.pessoa_fj = :pessoa_fj
  and rec.codigo_vn = :venda
  into :valor_conta, :dt_ult_baixa, :dt_vencto;

  if ((:dt_ult_baixa is null) or (:dt_ult_baixa < :dt_vencto)) then
    dt_aux = dt_vencto;
  else if (:dt_ult_baixa > :dt_vencto) then
    dt_aux = :dt_ult_baixa;

  /*comparando a diferença com a data passada*/
  dias = (:data - :dt_aux);

  /* aplicando multa*/
  if ((:dias > 0) and (:dias > :tolerancia_juros)) then
    valor_multa = ((:valor_conta * :multa_financeira) /100);


  suspend;
END
^

ALTER PROCEDURE PCD_CFS_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_CF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE XCTE INTEGER;
begin
  for select distinct vd.num_cupom
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.DT_EMISSAO_NF between :data1 and :data2)
      and coalesce(vd.num_cupom,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and nat.es = 'S'
      into :num_cf
  do
  begin
      num_item = 0;
      for select vd.codigo, vd.dt_emissao_nf, vd.serie, PSA.uf, coalesce(nat.mov_estoque,'N')
          from fat_vendas vd
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.DT_EMISSAO_NF between :data1 and :data2) and vd.num_cupom = :num_cf
          into :cod_venda, :data_saida, :serie, :psa_uf, :movimenta_mercadoria
      do
      begin
          for select vdi.produto, VDI.cfop, substring(prd.unidade from 1 for 3), vdi.cte, vdi.ctie,
              vdi.quantidade, vdi.prc_unitario, vdi.desconto, (vdi.prc_unitario * vdi.quantidade),
              vdi.basecalculoicm, vdi.basecalculosubstituicao,
              prd.nome, prd.nome,
              vdi.icm, vdi.icm_subs
               from fat_vendas_itens vdi
              inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
              where vdi.cnpj = :cnpj and vdi.codigo = :cod_venda
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :base_icms, :base_icms_sub,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
             sit_trib = '010';
           else if (:xcte = 2) then
             sit_trib = '020';
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
             sit_trib = '060';
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '000';

            produto_sit_trib = :sit_trib;
            num_item = num_item + 1;
            aliquota_icms = 17;
            suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_CM_CUSTO_MEDIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4))
AS
DECLARE VARIABLE CUSTO_MEDIO NUMERIC(18,4);
DECLARE VARIABLE CUSTO_ATUAL NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
begin
  /*pegando o valores no cadastro de produtos*/
  select coalesce(prd.prc_custo_med,0), coalesce(prd.prc_repos,0), coalesce(prd.prc_venda,0) from est_produtos prd
  where prd.cnpj = :cnpj and prd.codigo = :produto
  into :custo_medio, :custo_atual, :prc_venda;

  /*custo do medio atual do produto*/
  if (:custo_medio > 0) then
    valor = :custo_medio;
  else if (:custo_atual > 0) then /*ultimo custo do produto*/
    valor = :custo_atual;
  else if (:prc_venda > 0) then /*preço de venda do produto*/
    valor = :prc_venda;

  suspend;
END
^

ALTER PROCEDURE PCD_CM2_ATUALIZA_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODREC INTEGER,
    CODPAG INTEGER,
    DT_LANCTO DATE)
AS
DECLARE VARIABLE PC_CONT INTEGER;
DECLARE VARIABLE CM_VLR_LUCRO_ITEM NUMERIC(18,4);
DECLARE VARIABLE CM_PCT NUMERIC(18,4);
DECLARE VARIABLE CM_PESSOA_FJ INTEGER;
DECLARE VARIABLE CM_VLR_COMISSAO NUMERIC(18,4);
DECLARE VARIABLE PAGA_COMISSAO CHAR(10);
DECLARE VARIABLE AVISTA CHAR(1);
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE CM_PCT_LR NUMERIC(18,4);
begin
    if (:dt_lancto is null) then
      dt_lancto = current_date;

    select coalesce(nat.paga_comissao,'N') from fat_vendas vd
    inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
    where vd.cnpj = :cnpj and vd.codigo = :codigo and coalesce(vd.cancelada,'N') = 'N'
    into :paga_comissao;

    paga_comissao = coalesce(:paga_comissao,'N');

    if (:paga_comissao = 'S') then
    begin
        /*percentual de comissao sobre o lucro*/
        select coalesce(emp.cmd_vdt_pct,0) from sis_empresas emp
        where emp.cnpj = :cnpj
        into :cm_pct_lr;

        cm_pct_lr = (:cm_pct_lr /100.00);

        /*Econtrando o número de parcelas do faturamento*/
        select count(*) from fat_vendas_parcelamento pc
        where pc.cnpj = :cnpj and pc.codigo = :codigo
        into :pc_cont;
    
        avista = 'N';
        if (:pc_cont = 0 ) then
        begin
          select coalesce(pgt.avista,'N'), coalesce(nat.es,'N')  from fat_vendas vd
          left join fin_formas_pagto pgt on (vd.forma_pgto = pgt.codigo and pgt.cnpj = vd.cnpj)
          left join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
          where vd.cnpj = :cnpj and vd.codigo = :codigo
          into :AVISTA, :es;

          if (:avista = 'S') then
            pc_cont = 1;
        end

        /*perconrrendo todos os agentes participantes no faturamento*/
        for select distinct cmi.pessoa_fj
            from fat_vendas_itens_comissoes cmi
            inner join fat_vendas_itens vdi on (vdi.cnpj = cmi.cnpj and vdi.codigo = cmi.cod_item
                                                and vdi.sequencia = cmi.sequencia and vdi.produto = cmi.produto)
            inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
            where cmi.cnpj = :cnpj and cmi.cod_item = :codigo
            into :CM_PESSOA_FJ
        do
        begin
            select sum(
                        (
                         (
                          select
                          (
                           vdi2.vlr_lucro_item
                           +
                           (
                            (
                             (
                              (
                               (
                                 vdi2.quantidade * vdi2.prc_unitario
                               )
                               *
                               100
                              )
                              /
                              vd2.total
                             )
                             *
                             vd2.desc_acres
                            )
                            /
                            100
                           )
                          )
                          from fat_vendas_itens vdi2
                          inner join fat_vendas vd2 on (vd2.cnpj = vdi2.cnpj and vdi2.codigo = vd2.codigo)
                          where vdi2.cnpj = vdi.cnpj and vdi2.codigo = vdi.codigo
                          and vdi2.sequencia = vdi.sequencia and vdi2.produto = vdi.produto
                         )
                         *
                         :cm_pct_lr /*percentual pago da comissao sobre o lucro*/
                        )
                        *
                        /*Percentual de participacao que o agente tem no item*/
                        (
                          select (cmi.percentual/100.00) from fat_vendas_itens_comissoes cmi
                          where cmi.cod_item = vdi.codigo and cmi.produto = vdi.produto
                          and cmi.sequencia = vdi.sequencia and cmi.pessoa_fj = :cm_pessoa_fj
                        )
                       )
            from fat_vendas_itens vdi
            inner join est_produtos prd on (prd.cnpj = vdi.cnpj and prd.codigo = vdi.produto)
            left join sis_configuracoes cfg on (cfg.cnpj = vdi.cnpj)
            where vdi.cnpj = :cnpj and vdi.codigo = :codigo
            into :cm_vlr_comissao;
            /*lucro = ((total-lucro/qtde-parcelas)*pct-participacao)*/
            cm_vlr_comissao = (:cm_vlr_comissao/:pc_cont);
    
            /*gerando comissão negativa por caonta de devolução*/
            if (:codpag > 0) then
              cm_vlr_comissao = (:cm_vlr_comissao * -1);
            else if ((:es = 'E') and (:avista = 'S')) then
              cm_vlr_comissao = (:cm_vlr_comissao * -1);
                
                
            update CM2_COMISSAO_PARC c set VALOR = :cm_vlr_comissao
            where c.CNPJ = :cnpj and c.cod_venda = :codigo
            and c.cod_pessoa = :cm_pessoa_fj;


    
        end
    end
  suspend;
end
^

ALTER PROCEDURE PCD_CM2_GERA_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODREC INTEGER,
    CODPAG INTEGER,
    DT_LANCTO DATE)
AS
DECLARE VARIABLE PC_CONT INTEGER;
DECLARE VARIABLE CM_VLR_LUCRO_ITEM NUMERIC(18,4);
DECLARE VARIABLE CM_PCT NUMERIC(18,4);
DECLARE VARIABLE CM_PESSOA_FJ INTEGER;
DECLARE VARIABLE CM_VLR_COMISSAO NUMERIC(18,4);
DECLARE VARIABLE PAGA_COMISSAO CHAR(10);
DECLARE VARIABLE AVISTA CHAR(1);
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE CM_PCT_LR NUMERIC(18,4);
DECLARE VARIABLE CM_VDT CHAR(1);
begin
    select coalesce(e.CM_VDT,'N') from sis_empresas e
    where e.cnpj = :cnpj
    into :CM_VDT;

    if (:cm_vdt = 'S') then
    begin
        if (:dt_lancto is null) then
          dt_lancto = current_date;
    
        select coalesce(nat.paga_comissao,'N') from fat_vendas vd
        inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
        where vd.cnpj = :cnpj and vd.codigo = :codigo and coalesce(vd.cancelada,'N') = 'N'
        into :paga_comissao;
    
        paga_comissao = coalesce(:paga_comissao,'N');
    
        if (:paga_comissao = 'S') then
        begin
            /*percentual de comissao sobre o lucro*/
            select coalesce(emp.cmd_vdt_pct,0) from sis_empresas emp
            where emp.cnpj = :cnpj
            into :cm_pct_lr;
    
            cm_pct_lr = (:cm_pct_lr /100.00);
    
            /*Econtrando o número de parcelas do faturamento*/
            select count(*) from fat_vendas_parcelamento pc
            where pc.cnpj = :cnpj and pc.codigo = :codigo
            into :pc_cont;
        
            avista = 'N';
            if (:pc_cont = 0 ) then
            begin
              select coalesce(pgt.avista,'N'), coalesce(nat.es,'N')  from fat_vendas vd
              left join fin_formas_pagto pgt on (vd.forma_pgto = pgt.codigo and pgt.cnpj = vd.cnpj)
              left join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
              where vd.cnpj = :cnpj and vd.codigo = :codigo
              into :AVISTA, :es;
    
              if (:avista = 'S') then
                pc_cont = 1;
            end
    
            /*perconrrendo todos os agentes participantes no faturamento*/
            for select distinct cmi.pessoa_fj
                from fat_vendas_itens_comissoes cmi
                inner join fat_vendas_itens vdi on (vdi.cnpj = cmi.cnpj and vdi.codigo = cmi.cod_item
                                                    and vdi.sequencia = cmi.sequencia and vdi.produto = cmi.produto)
                inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
                where cmi.cnpj = :cnpj and cmi.cod_item = :codigo
                into :CM_PESSOA_FJ
            do
            begin
                select sum(
                            (
                             (
                              select
                              (
                               vdi2.vlr_lucro_item
                               +
                               (
                                (
                                 (
                                  (
                                   (
                                     vdi2.quantidade * vdi2.prc_unitario
                                   )
                                   *
                                   100
                                  )
                                  /
                                  vd2.total
                                 )
                                 *
                                 vd2.desc_acres
                                )
                                /
                                100
                               )
                              )
                              from fat_vendas_itens vdi2
                              inner join fat_vendas vd2 on (vd2.cnpj = vdi2.cnpj and vdi2.codigo = vd2.codigo)
                              where vdi2.cnpj = vdi.cnpj and vdi2.codigo = vdi.codigo
                              and vdi2.sequencia = vdi.sequencia and vdi2.produto = vdi.produto
                             )
                             *
                             :cm_pct_lr /*percentual pago da comissao sobre o lucro*/
                            )
                            *
                            /*Percentual de participacao que o agente tem no item*/
                            (
                              select (cmi.percentual/100.00) from fat_vendas_itens_comissoes cmi
                              where cmi.cod_item = vdi.codigo and cmi.produto = vdi.produto
                              and cmi.sequencia = vdi.sequencia and cmi.pessoa_fj = :cm_pessoa_fj
                            )
                           )
                from fat_vendas_itens vdi
                inner join est_produtos prd on (prd.cnpj = vdi.cnpj and prd.codigo = vdi.produto)
                left join sis_configuracoes cfg on (cfg.cnpj = vdi.cnpj)
                where vdi.cnpj = :cnpj and vdi.codigo = :codigo
                into :cm_vlr_comissao;
                /*lucro = ((total-lucro/qtde-parcelas)*pct-participacao)*/
                cm_vlr_comissao = (:cm_vlr_comissao/:pc_cont);
        
                /*gerando comissão negativa por caonta de devolução*/
                if (:codpag > 0) then
                  cm_vlr_comissao = (:cm_vlr_comissao * -1);
                else if ((:es = 'E') and (:avista = 'S')) then
                  cm_vlr_comissao = (:cm_vlr_comissao * -1);
                    
                    
                insert into CM2_COMISSAO_PARC (CNPJ,
                                               COD_VENDA,
                                               COD_PESSOA,
                                               COD_RECEBER,
                                               COD_PAGAR,
                                               VALOR,
                                               CM_PCT,
                                               STATUS,
                                               DT_GERACAO
                                               )
                                      values   (:cnpj,
                                               :codigo,
                                               :cm_pessoa_fj,
                                               :codrec,
                                               :codpag,
                                               :cm_vlr_comissao,
                                               :cm_pct,
                                               'F',
                                               :dt_lancto);
    
                /*gerando comissao aberta para venda a vista*/
                if (:avista = 'S') then
                begin
    
                    insert into CM2_COMISSAO_PARC (CNPJ,
                                                   COD_VENDA,
                                                   COD_PESSOA,
                                                   COD_RECEBER,
                                                   COD_PAGAR,
                                                   VALOR,
                                                   CM_PCT,
                                                   STATUS,
                                                   DT_GERACAO
                                                   )
                                          values   (:cnpj,
                                                   :codigo,
                                                   :cm_pessoa_fj,
                                                   :codrec,
                                                   :codpag,
                                                   :cm_vlr_comissao,
                                                   :cm_pct,
                                                   'L',
                                                  :dt_lancto);
                end
    
    
        
            end
        end
    end
  suspend;
end
^

ALTER PROCEDURE PCD_CM2_QUITAR_COMISSAO (
    CNPJ VARCHAR(14),
    COD_AGENTE INTEGER,
    CC_CUSTO INTEGER,
    HISTORICO VARCHAR(100),
    DT_VENCTO DATE)
AS
DECLARE VARIABLE COD_COMISSAO INTEGER;
DECLARE VARIABLE COD_ACERTO INTEGER;
DECLARE VARIABLE VALOR_PAGAR FLOAT;
DECLARE VARIABLE VALOR_RECEBER FLOAT;
DECLARE VARIABLE SALDO FLOAT;
DECLARE VARIABLE COD_FINANCEIRO INTEGER;
begin
  /*codigo do acerto*/
  cod_acerto = GEN_ID(GEN_CM2_ACERTO_COMISSAO_ID,1);

  select sum(cm.valor) from cm2_comissao_parc cm
  where cm.selecionado =  'S' and cm.valor > 0 and cm.cnpj = :cnpj
  into :valor_pagar;

  select sum(cm.valor) from cm2_comissao_parc cm
  where cm.selecionado =  'S' and cm.valor < 0 and cm.cnpj = :cnpj
  into :valor_receber;

  saldo = (coalesce(:valor_receber,0) + coalesce(:valor_pagar,0));

  /*Gerando contas a receber*/
  if (:saldo < 0) then
  begin
    cod_financeiro = GEN_ID(FIN_RECEBER_COD_GE,1);
    
    /*conta à receber*/
    insert into fin_contas_receber
           (cnpj,codigo,ano,pessoa_fj,dt_emissao,dt_vencto,dt_lancto,parcela,
           historico,valor,origem, SELECIONADO,DOCTO,BOLETO)
    values(:cnpj,:cod_financeiro,extract (year from current_date),:cod_agente,current_date,:dt_vencto, current_date, '1/1',
          :historico,(:saldo * -1),'CMS','N','','N');
  end
  else
  begin
    cod_financeiro = GEN_ID(FIN_PAGAR_COD_GE,1);
    
    /*conta à pagar*/
    insert into fin_contas_pagar
           (cnpj,codigo,ano,pessoa_fj,dt_emissao,dt_vencto,dt_lancto,parcela,
           historico,valor,origem,centro_custo,CONFERIDA,SELECIONADO,DOCTO,BOLETO)
    values(:cnpj,:cod_financeiro,extract (year from current_date),:cod_agente,current_date,:dt_vencto, current_date, '1/1',
          :historico,(:saldo),'CMS',:cc_custo,'N','N','','N');
  end

  /*Gerando dados do acerto de comissoes*/
  insert into cm2_acerto_comissao (CNPJ,
                                   CODIGO,
                                   DT_ACERTO,
                                   VALOR_PAGAR,
                                   VALOR_RECEBER,
                                   SALDO,
                                   COD_FINANCEIRO,
                                   COD_PESSOA)
                        values    (:cnpj,
                                   :cod_acerto,
                                   current_date,
                                   :valor_pagar,
                                   :valor_receber,
                                   :saldo,
                                   :cod_financeiro,
                                   :cod_agente);

  for select cm.codigo from cm2_comissao_parc cm
      where cm.cnpj = :cnpj and cm.selecionado = 'S'
      into :cod_comissao
  do
  begin
    insert into CM2_PARC_ACERTO (CNPJ,
                                 COD_COMISSAO,
                                 COD_ACERTO)
                         values(:cnpj,
                                :cod_comissao,
                                :cod_acerto);

    /*desabilitando as comissoes e marcando como quitadas*/
    update cm2_comissao_parc cm2 set cm2.selecionado = 'N', cm2.status = 'P'
    where cm2.codigo = :cod_comissao and cm2.cnpj = :cnpj;

  end
end
^

ALTER PROCEDURE PCD_COM_VENDEDOR (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    VALOR_VISTA NUMERIC(18,4),
    VALOR_PRAZO NUMERIC(18,4))
RETURNS (
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE COM_FAIXA CHAR(1);
DECLARE VARIABLE COM_NORMAL CHAR(1);
begin
  /* Procedimento retornará a comissão do vendedor
  sendo por faixa ou não*/
  select coalesce(emp.comissao_normal,''), coalesce(emp.comissao_por_faixa,'') from sis_empresas emp
  where emp.cnpj = :cnpj
  into :com_normal, :com_faixa;

  if (((:com_normal = 'S') and (:com_faixa ='N')) or ((:com_normal = 'S') and (:com_faixa =''))) then
  begin
    select coalesce(vdd.com_vista,0), coalesce(vdd.com_prazo,0) from fat_vendedor vdd
    where vdd.codigo = :vendedor and vdd.cnpj = :cnpj
    into :com_vista, :com_prazo;

    comissao_vista = (:com_vista * :valor_vista)/100;
    comissao_prazo = (:com_prazo * :valor_prazo)/100;
  end
  else
  begin

  end
  suspend;
END
^

ALTER PROCEDURE PCD_COMISSAO_FAIXA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    DATA_CAIXA DATE,
    DATA DATE,
    DESC_ACRES NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(70),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4),
    COM_TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    VLR_ITEM NUMERIC(18,4))
AS
DECLARE VARIABLE PCT_VISTA NUMERIC(18,4);
DECLARE VARIABLE PCT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE PCT_REPRESENTA NUMERIC(18,4);
DECLARE VARIABLE VLR_DESC_ITEM NUMERIC(18,4);
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE DATA_LANCTO_DOCTO DATE;
DECLARE VARIABLE DATA_PRE_DOCTO DATE;
DECLARE VARIABLE CHEQUE_VISTA NUMERIC(18,4);
DECLARE VARIABLE VLR_DOCTO NUMERIC(18,4);
DECLARE VARIABLE CRT_VISTA NUMERIC(18,4);
DECLARE VARIABLE CRT_INFLUENCIA CHAR(1);
DECLARE VARIABLE CH_INFLUENCIA CHAR(1);
BEGIN
    CHEQUE_VISTA = 0;
    CRT_VISTA = 0;
    select coalesce(emp.crt_influencia_venda,'N'), coalesce(emp.ch_influencia_venda,'N')
    from sis_empresas emp  where emp.cnpj = :cnpj
    into :crt_influencia, :ch_influencia;

    for select codigo,data, data_caixa, coalesce(fechado,'N'), pessoa_fj, vendedor, nome_consumidor,
        coalesce(desc_acresc,0),
        coalesce(dinheiro,0),
        coalesce(cheque,0)
        ,coalesce(cartao,0),
        coalesce(ticket,0),
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0)))
        from fat_trocas  trc
        where (( data_caixa between :dini and :dfim))
        and cnpj = :cnpj and coalesce(cancelada,'N') = 'N'
        into :codigo, :data,:data_caixa, :fechada, :pessoa_fj,:vendedo, :nome_consumidor,
        :desc_acres,
        :dinheiro,
        :cheque,
        :cartao,
        :ticket,
        :total,
        :vlrliquido
    do
    begin
      crt_vista = 0;
      cheque_vista = 0;
      /*se houve saldo positivo para a loja*/
      if (:total > 0) then
      begin
        fator = 1;
        /*Verificando se foram utilizados cheques a vista ou a prazo na venda*/
        if ((:cheque > 0) and (:ch_influencia = 'S')) then
        begin
            /*verificando se Cheque a vista ou prazo*/
          for select ch.data_caixa, ch.pre_date, ch.valor from fin_cheques ch
          where ch.troca = :codigo and ch.cnpj = :cnpj
          into :data_lancto_docto, :data_pre_docto, :vlr_docto
          do
          begin
            /*se o cheque for a vista, então conta como vlr a vista*/
            if (:data_pre_docto <= :data_lancto_docto) then
              cheque_vista = :cheque_vista + :vlr_docto;
          end
          cheque = :cheque_vista;
        end

        /*Verificando se foram utilizados pagto cartao a vista ou a prazo na venda*/
        if ((:cartao > 0) and (:crt_influencia = 'S'))then
        begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso, crt.valor from fin_movimento_cartao crt
          where crt.troca = :codigo and crt.cnpj = :cnpj
          into :data_lancto_docto, :data_pre_docto, :vlr_docto
          do
          begin
            /*se dt. de reembolso é menor igual a dt. atual então é a vista*/
            if (:data_pre_docto <= :data_lancto_docto) then
              crt_vista = :crt_vista + :vlr_docto;
          end
          cartao = :crt_vista;
        end


        vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
        if (:vlr_vista > :total) then
          vlr_vista = :total;
        vlr_Prazo = :total - :vlr_vista;
      end
      else
      begin
        fator =  -1;
        vlr_vista = :total;
        vlr_Prazo = 0;
        /*se o saldo da troca for negativo então termos de debitar da comissão*/
        dinheiro = :total;
      end

      tipo_venda  = 'TRC';
      troco = 0;
      desconto = 0;
      quantidade = 1;
      prc_unitario =  :total;
      vlr_item = :total;
      desc_acres = 0;
      nome_produto = 'TROCA';

      /*usado para corrigir valores negativos de trocas*/

      vlr_vista = :vlr_vista * :fator;
      vlr_prazo = :vlr_prazo * :fator;
      /*fazendo o cálculo de comissão por faixa*/
      select coalesce(com_vista,0), coalesce(com_prazo,0)  from pcd_calcula_comissao_faixa(:cnpj,:vendedo,coalesce(:vlr_vista,0),coalesce(:vlr_prazo,0))
      into :com_vista, :com_prazo;

      com_vista = :com_vista * :fator;
      com_prazo = :com_prazo * :fator;

      com_total = (:com_vista + :com_prazo);

      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;
      
      select nome
      from fat_vendedor
      where codigo = :vendedo
      into :nome_vendedor;
    
      suspend;
    end
  
   /*Percorrendo vendas*/
    for select vd.codigo, data, data_caixa, coalesce(fechada,'N'), pessoa_fj, tipo_venda,nome_consumidor,
        (coalesce(total,0) + coalesce(desc_acres,0)),
        coalesce(troco,0),
        coalesce(desc_acres,0),
        coalesce(dinheiro,0),
        coalesce(cheque,0),
        coalesce(cartao,0),
        coalesce(ticket,0),
        total
        from fat_vendas vd
        inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
        where (vd.data_caixa between :dini and :dfim) and vd.cnpj = :cnpj
        and nat.computa_venda = 'S' and nat.es = 'S'
        and coalesce(cancelada,'N') = 'N'
        into  :codigo,:data,:data_caixa,:fechada,:pessoa_fj,:tipo_venda,:nome_consumidor,
        :vlrliquido,
        :troco,
        :desc_acres,
        :dinheiro,
        :cheque,
        :cartao,
        :ticket,
        :total
    do
    begin
      crt_vista = 0;
      cheque_vista = 0;
      /*vlr. vista e vlr. prazo usado para saber quanto da
      venda é a vista e a prazo*/
      if (:vlrliquido <= 0 ) then
      begin
        vlr_vista = 0;
        vlr_prazo = 0;
  
        pct_vista = 0;
        pct_prazo = 0;
      end
      else
      begin
        /*Verificando se foram utilizados cheques a vista ou a prazo na venda*/
        if ((:cheque > 0) and (:ch_influencia = 'S')) then
        begin
            /*verificando se Cheque a vista ou prazo*/
          for select ch.data_caixa, ch.pre_date, ch.valor from fin_cheques ch
          where ch.venda = :codigo and ch.cnpj = :cnpj
          into :data_lancto_docto, :data_pre_docto, :vlr_docto
          do
          begin
            /*se o cheque for a vista, então conta como vlr a vista*/
            if (:data_pre_docto <= :data_lancto_docto) then
              cheque_vista = :cheque_vista + :vlr_docto;
          end
          cheque = :cheque_vista;
        end

        /*Verificando se foram utilizados pagto cartao a vista ou a prazo na venda*/
        if ((:cartao > 0) and (:crt_influencia = 'S'))then
        begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso, crt.valor from fin_movimento_cartao crt
          where crt.venda = :codigo and crt.cnpj = :cnpj
          into :data_lancto_docto, :data_pre_docto, :vlr_docto
          do
          begin
            /*se dt. de reembolso é menor igual a dt. atual então é a vista*/
            if (:data_pre_docto <= :data_lancto_docto) then
              crt_vista = :crt_vista + :vlr_docto;
          end
          cartao = :crt_vista;
        end

        vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
        vlr_prazo = :vlrliquido - :vlr_vista;
  
        pct_vista = (:vlr_vista * 100.00)/:vlrliquido;
        pct_prazo = (:vlr_prazo * 100.00)/:vlrliquido;
      end

      /*Nome do cliente*/
      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;

      /*Dados dos Itens*/
      for select produto, quantidade, prc_unitario,
          desconto, vendedor
          from fat_vendas_itens
          where codigo = :codigo and cnpj = :cnpj
          into :produto, :quantidade, :prc_unitario,
          :desconto,:vendedo
      do
      begin
        /*vlr. liquedo do item*/
        vlr_item = ((:prc_unitario + :desconto) * :quantidade);

        /*descobrindo quanto o item representa na venda*/
        if (:total > 0) then
          pct_representa = (:vlr_item * 100)/:total;
        else
          pct_representa = 0;


        select * from round2(:pct_representa) into :pct_representa;

        vlr_desc_item  = ((:desc_acres * :pct_representa)/100.00);
        select * from round2(:vlr_desc_item) into :vlr_desc_item;

        /*valor do item já com o desconto rateado da venda*/
        vlr_item  = :vlr_item + :vlr_desc_item;
       select * from round2(:vlr_item) into :vlr_item;

        /*vlr. à prazo e vlr. vista usado pra saber quanto do item é a prazo e a vista*/
        vlr_vista = ((:vlr_item * :pct_vista)/100.00);
        vlr_prazo = ((:vlr_item * :pct_prazo)/100.00);

        /*fazendo o cálculo de comissão por faixa*/
        select coalesce(com_vista,0), coalesce(com_prazo,0)  from pcd_calcula_comissao_faixa(:cnpj,:vendedo,coalesce(:vlr_vista,0),coalesce(:vlr_prazo,0))
        into :com_vista, :com_prazo;

        com_total = (:com_vista + :com_prazo);

        select nome from est_produtos
        where cnpj = :cnpj and codigo = :produto
        into nome_produto ;

        nome_produto = coalesce(:produto,'')||'-'||coalesce(:nome_produto,'');

        /*Dados do vendedor*/
        select nome
        from fat_vendedor
        where codigo = :vendedo
        into :nome_vendedor;

        suspend;
      end
    end
END
^

ALTER PROCEDURE PCD_COR_NUMERACAO_RECEBER
RETURNS (
    CODIGO INTEGER)
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE EXISTE_BX INTEGER;
DECLARE VARIABLE CONT_R INTEGER;
DECLARE VARIABLE CONT_BX INTEGER;
DECLARE VARIABLE NEW_CODIGO INTEGER;
begin

  /*verificando somente as que estão repedidas no receber*/
  for select r.codigo, r.pessoa_fj from fin_contas_receber r
  into  :codigo, :pessoa_fj
  do
  begin
    /*tratando registros que estão duplicados no proprio contas à pagar*/
    select count(*) from fin_contas_receber r2
    where r2.codigo = :codigo and r2.pessoa_fj <> :pessoa_fj
    into :existe;

    if (:existe > 0) then
    begin
       new_codigo = gen_id(FIN_RECEBER_COD_GE,1);

       /*verificando se existe baixa da conta à recer*/
       select count(*) from fin_baixas_receber bx
       where bx.codigo_cr = :codigo and bx.pessoa_fj = :pessoa_fj
       into :existe_bx;

       if (:existe_bx > 0) then
         update fin_baixas_receber bx set bx.codigo_cr = :new_codigo where bx.codigo_cr = :codigo and bx.pessoa_fj = :pessoa_fj;

    end
    update fin_contas_receber rec set rec.codigo = :new_codigo where rec.codigo = :codigo and rec.pessoa_fj = :pessoa_fj;
    suspend;
  end

  /*verificando somente as que estão repedidas na baixa*/
  for select r.codigo, r.pessoa_fj from fin_contas_receber r
  into  :codigo, :pessoa_fj
  do
  begin
    /*tratando registros que estão duplicados somente nas baixas*/
    select count(*) from fin_baixas_receber bx
    where bx.codigo_cr = :codigo and bx.pessoa_fj <> :pessoa_fj
    into :existe;

    if (:existe > 0) then
    begin
       new_codigo = gen_id(FIN_RECEBER_COD_GE,1);

       /*verificando se existe baixa da conta à recer*/
       select count(*) from fin_baixas_receber bx
       where bx.codigo_cr = :codigo and bx.pessoa_fj = :pessoa_fj
       into :existe_bx;

       if (:existe_bx > 0) then
         update fin_baixas_receber bx set bx.codigo_cr = :new_codigo where bx.codigo_cr = :codigo and bx.pessoa_fj = :pessoa_fj;

    end
    update fin_contas_receber rec set rec.codigo = :new_codigo where rec.codigo = :codigo and rec.pessoa_fj = :pessoa_fj;
    suspend;
  end
end
^

ALTER PROCEDURE PCD_CORRIGE_RECEBER
RETURNS (
    CONT INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CODIGO_CR INTEGER;
begin
  /**/
  for select rec.codigo, rec.pessoa_fj, rec.ano from fin_contas_receber rec
      into :codigo, :pessoa_fj, :ano
  do
  begin
     codigo_cr = gen_id(fin_receber_cod_ge,1);

     /*baixando conta receber*/
     update fin_contas_receber r set r.codigo = :codigo_cr
     where r.codigo = :codigo and r.pessoa_fj = :pessoa_fj and r.ano = :ano;

     /*reinventando o codigo das baixas*/
     update fin_baixas_receber bx set bx.codigo_cr = :codigo_cr
     where bx.codigo_cr = :codigo and bx.pessoa_fj = :pessoa_fj and bx.ano_cr = :ano;

     CONT  = coalesce(CONT,0) +1;
    suspend;
  end
end
^

ALTER PROCEDURE PCD_CREDITA_PENDENCIA (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    NEW_QTDE NUMERIC(18,4),
    OLD_QTDE NUMERIC(18,4))
AS
DECLARE VARIABLE SALDO NUMERIC(18,4);
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PENDENTE NUMERIC(18,4);
begin
  /*verificando se produto esta na pendencia*/
  saldo = :new_qtde;
  for select ped.codigo, ped.qtde_pendente from ofc_pendencia ped
      where ped.cnpj = :cnpj and ped.qtde_pendente <= :saldo and ped.produto = :produto
      order by ped.dt_pendencia, ped.codigo
      into :codigo, :pendente
  do
  begin
    if (:saldo <= 0) then
       exit;

    if (:pendente <= :saldo) then
    begin
      /*atualizando a quantidade creditada*/
      update ofc_pendencia p2 set p2.qtde_creditada = :pendente
      where p2.cnpj = :cnpj and p2.codigo = :codigo;

      saldo = :saldo - :pendente;
    end


  end
END
^

ALTER PROCEDURE PCD_CRG_FORMACAO_ROTA (
    CNPJ VARCHAR(14),
    CODIGO_FORMACAO INTEGER)
RETURNS (
    CRG_CODIGO INTEGER,
    CRG_CODIGO_VND INTEGER,
    CRG_DATA TIMESTAMP,
    CRG_NOME_RECEBEDOR VARCHAR(50),
    CRG_LOGRADOURO VARCHAR(50),
    CRG_NUMERO VARCHAR(15),
    CRG_BAIRRO VARCHAR(50),
    CRG_CEP VARCHAR(8),
    CRG_CIDADE VARCHAR(50),
    CRG_COMPLEMENTO VARCHAR(30),
    CRG_DT_ENTREGA TIMESTAMP,
    CRG_HR_ENTREGA TIME,
    CRG_OBSERVACAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CRG_PESO_BRUTO FLOAT,
    CRG_PESO_LIQUIDO FLOAT,
    CRG_STATUS INTEGER,
    CRG_UF CHAR(2),
    CRG_USUARIO INTEGER,
    CRGF_CODIGO INTEGER,
    CRGF_NOME_MOTORISTA VARCHAR(50),
    CRGF_STATUS INTEGER,
    CRGF_USUARIO INTEGER,
    CRGF_BAIRRO VARCHAR(50),
    CRGF_CIDADE VARCHAR(50),
    CRGF_CNPJ_CPF CHAR(14),
    CRGF_FONE VARCHAR(20),
    CRGF_IE_RG VARCHAR(15),
    CRGF_LOGRADOURO VARCHAR(40),
    CRGF_NUMERO VARCHAR(15),
    E_NOME VARCHAR(50),
    E_FONE VARCHAR(20),
    E_ENDERECO VARCHAR(50),
    E_CEP VARCHAR(8),
    E_BAIRRO VARCHAR(50),
    E_CIDADE VARCHAR(50),
    E_CNPJ VARCHAR(20))
AS
begin
    /* Dados da Empresa */
    SELECT E.NOME, E.FONE, E.ENDERECO, E.CEP, E.BAIRRO, E.CIDADE
    FROM SIS_EMPRESAS E WHERE E.CNPJ = :CNPJ
    INTO :E_NOME, :E_FONE, :E_ENDERECO, :E_CEP, :E_BAIRRO, :E_CIDADE;
    E_CNPJ = SUBSTRING(:CNPJ FROM 1 FOR 2)||'.'||SUBSTRING(:CNPJ FROM 3 FOR 3)||'.'||SUBSTRING(:CNPJ FROM 6 FOR 3)||'/'||SUBSTRING(:CNPJ FROM 9 FOR 4)||'-'||SUBSTRING(:CNPJ FROM 13 FOR 2);


    /* Dados da Carga */
    FOR
        SELECT
        CRG.CODIGO,
        CRG.CODIGO_VND,
        CRG.DATA,
        CRG.NOME_RECEBEDOR,
        CRG.LOGRADOURO,
        CRG.NUMERO,
        CRG.BAIRRO,
        CRG.CEP,
        CRG.CIDADE,
        CRG.COMPLEMENTO,
        CRG.DT_ENTREGA,
        CRG.HR_ENTREGA,
        CRG.OBSERVACAO,
        CRG.PESO_BRUTO,
        CRG.PESO_LIQUIDO,
        CRG.STATUS,
        CRG.UF,
        CRG.USUARIO,
        CRGF.CODIGO,
        CRGF.NOME_MOTORISTA,
        CRGF.STATUS,
        CRGF.USUARIO,
        CRGF.BAIRRO,
        CRGF.CIDADE,
        CRGF.CNPJ_CPF,
        CRGF.FONE,
        CRGF.IE_RG,
        CRGF.LOGRADOURO,
        CRGF.NUMERO
        FROM CRG_FORMAR_CARGA_ITENS CRGFI
        INNER JOIN CRG_ORDEM_CARGA  CRG  ON (CRG.CODIGO = CRGFI.CRG_CARGA)
        INNER JOIN CRG_FORMAR_CARGA CRGF ON (CRGF.CODIGO = CRGFI.CODIGO)
        WHERE CRGFI.CNPJ = :CNPJ AND CRGFI.CODIGO = :CODIGO_FORMACAO
    INTO
        /* CARGAS */
        :CRG_CODIGO, :CRG_CODIGO_VND, :CRG_DATA, :CRG_NOME_RECEBEDOR, :CRG_LOGRADOURO,
        :CRG_NUMERO, :CRG_BAIRRO, :CRG_CEP, :CRG_CIDADE, CRG_COMPLEMENTO, :CRG_DT_ENTREGA,
        :CRG_HR_ENTREGA, :CRG_OBSERVACAO, :CRG_PESO_BRUTO, :CRG_PESO_LIQUIDO,
        :CRG_STATUS, :CRG_UF, :CRG_USUARIO,
        /* CABECALHO FORMA CARGA */
        :CRGF_CODIGO, :CRGF_NOME_MOTORISTA, :CRGF_STATUS, :CRGF_USUARIO,
        :CRGF_BAIRRO, :CRGF_CIDADE, :CRGF_CNPJ_CPF, :CRGF_FONE, :CRGF_IE_RG, :CRGF_LOGRADOURO, :CRGF_NUMERO
    DO BEGIN
       SUSPEND;
    END
END
^

ALTER PROCEDURE PCD_CTB_EXTRATO_BANCARIO (
    CNPJ VARCHAR(14),
    CONTA INTEGER,
    DATA1 DATE,
    DATA2 DATE,
    TIPO_MOV CHAR(1))
RETURNS (
    DATA DATE,
    DATA_CONC DATE,
    DOCUMENTO VARCHAR(20),
    COD_DOC VARCHAR(3),
    HISTORICO VARCHAR(108),
    TIPO CHAR(1),
    DEBITO NUMERIC(18,4),
    CREDITO NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    SALDO_DIA_CREDITO NUMERIC(18,4),
    SALDO_DIA_DEBITO NUMERIC(18,4))
AS
declare variable xcredito numeric(18,2);
declare variable xdebito numeric(18,2);
declare variable xtpcredito numeric(18,2);
declare variable xtpdebito numeric(18,2);
declare variable dtmovimento date;
begin
  if (:tipo_mov = '3') then
  begin
      xdebito = 0;
      xcredito = 0;
      for select cast(ctb.valor as numeric(18,2)), ctb.data from ctb_movimento_contabil ctb
          where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1) and ctb.tipo = 'D'
          into :xtpdebito, :dtmovimento
      do
      begin
         if (:dtmovimento = cast('14.06.2010' as date)) then
            dtmovimento = :dtmovimento;

         select * from round2(:xtpdebito)
         into :xtpdebito;

         xdebito = :xdebito + :xtpdebito;
      end
    
      for select cast(ctb.valor as numeric(18,2)), ctb.data from ctb_movimento_contabil ctb
          where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1)  and ctb.tipo = 'C'
          into :xtpcredito, :dtmovimento
      do
      begin
        if (:dtmovimento = cast('14.06.2010' as date)) then
            dtmovimento = :dtmovimento;

        select * from round2(:xtpcredito)
        into :xtpcredito;

        xcredito = :xcredito + :xtpcredito;
      end

      select * from round2(:xcredito) into :xcredito;
      select * from round2(:xdebito) into :xdebito;

      saldo_anterior = (coalesce(:xcredito,0) - coalesce(:xdebito,0));
    
      saldo_dia_credito = :saldo_anterior;
      saldo = :saldo_anterior;
      for select ctb.data, ctb.data_conciliacao, ctb.documento, ctb.cod_doc, ctb.historico, ctb.tipo, ctb.valor from ctb_movimento_contabil ctb
          where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  between :data1 and :data2)
          order by ctb.data, ctb.codigo
          into :data, :data_conc, :documento, :cod_doc, :historico, :tipo, :valor
      do
      begin
        if (:tipo = 'D') then
        begin
          debito = :valor;
          select * from round2(:debito) into :debito;
          credito = 0;
        end
        else
        begin
          debito = 0;
          credito = :valor;
          select * from round2(:credito) into :credito;
        end
    
        saldo = :saldo + :credito - :debito;
        saldo_dia_credito = (:saldo_dia_credito + :saldo);
        suspend;
      end
  end
  else if (:tipo_mov = '2') then /*nao conciliados*/
  begin
      select sum(ctb.valor) from ctb_movimento_contabil ctb
      where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1) and ctb.tipo = 'D'
      and ctb.data_conciliacao is null
      into :xdebito;
    
      select sum(ctb.valor) from ctb_movimento_contabil ctb
      where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1)  and ctb.tipo = 'C'
      and ctb.data_conciliacao is null
      into :xcredito;
    
      saldo_anterior = (coalesce(:xcredito,0) - coalesce(:xdebito,0));
    
      saldo_dia_credito = :saldo_anterior;
      saldo = :saldo_anterior;
      for select ctb.data, ctb.data_conciliacao, ctb.documento, ctb.cod_doc, ctb.historico, ctb.tipo, ctb.valor from ctb_movimento_contabil ctb
          where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  between :data1 and :data2)
          and ctb.data_conciliacao is null
          order by ctb.data, ctb.codigo
          into :data, :data_conc, :documento, :cod_doc, :historico, :tipo, :valor
      do
      begin
        if (:tipo = 'D') then
        begin
          debito = :valor;
          credito = 0;
        end
        else
        begin
          debito = 0;
          credito = :valor;
        end
    
        saldo = :saldo + :credito - :debito;
        saldo_dia_credito = (:saldo_dia_credito + :saldo);
        suspend;
      end
  end
  else if (:tipo_mov = '1') then /*nao conciliados*/
  begin
      select sum(ctb.valor) from ctb_movimento_contabil ctb
      where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1) and ctb.tipo = 'D'
      and ctb.data_conciliacao is not null
      into :xdebito;
    
      select sum(ctb.valor) from ctb_movimento_contabil ctb
      where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  < :data1)  and ctb.tipo = 'C'
      and ctb.data_conciliacao is not null
      into :xcredito;
    
      saldo_anterior = (coalesce(:xcredito,0) - coalesce(:xdebito,0));

      saldo = :saldo_anterior;
      saldo_dia_credito = :saldo_anterior;
    
      for select ctb.data, ctb.data_conciliacao, ctb.documento, ctb.cod_doc, ctb.historico, ctb.tipo, ctb.valor from ctb_movimento_contabil ctb
          where  ctb.cnpj = :cnpj and ctb.conta = :conta and (ctb.data  between :data1 and :data2)
          and ctb.data_conciliacao is not null
          order by ctb.data, ctb.codigo
          into :data, :data_conc, :documento, :cod_doc, :historico, :tipo, :valor
      do
      begin
        if (:tipo = 'D') then
        begin
          debito = :valor;
          credito = 0;
        end
        else
        begin
          debito = 0;
          credito = :valor;
        end
    
        saldo = :saldo + :credito - :debito;
        saldo_dia_credito = (:saldo_dia_credito + :saldo);
        suspend;
      end
  end
end
^

ALTER PROCEDURE PCD_CTB_LANCA_CONTAB_PAGAR (
    CNPJ VARCHAR(14),
    CODIGOPAGAR INTEGER,
    ANOPAGAR INTEGER,
    VALOR NUMERIC(18,4),
    DATA DATE,
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    CONTA INTEGER,
    PLANILHA INTEGER,
    FORNECEDOR INTEGER)
AS
DECLARE VARIABLE VALORCRED NUMERIC(18,4);
DECLARE VARIABLE CONTADEB INTEGER;
DECLARE VARIABLE VALORDEB NUMERIC(18,4);
DECLARE VARIABLE JUROSDEB NUMERIC(18,4);
DECLARE VARIABLE DESCONTODEB NUMERIC(18,4);
DECLARE VARIABLE PERCENTUAL NUMERIC(18,4);
DECLARE VARIABLE SALDOAJUSTE NUMERIC(18,4);
DECLARE VARIABLE PLANILHAPAGAR INTEGER;
DECLARE VARIABLE BANCO CHAR(3);
begin
  valorcred = 0;
  contadeb = 0;
  valordeb = 0;
  jurosdeb = 0;
  descontodeb = 0;
  percentual = 0;
  saldoajuste = 0;

  banco = null;

  select Cast(p.banco as varchar(3))
  from ctb_planoconta p
  where p.conta = :conta and p.cnpj = :cnpj
  into :banco;

  if ( conta > 0 ) then
  begin
     /*  crédito */
     execute procedure insere_ctb_movimento_contabil (:cnpj,
     :data, 'D', :documento, :historico, :valor, :conta,
     'PGR', :planilha, null, :banco, 'A', null, :fornecedor);
  end
END
^

ALTER PROCEDURE PCD_CTB_MOVIMENTODIARIO (
    CNPJ VARCHAR(14),
    DATAI DATE,
    DATAF DATE,
    CODIGO VARCHAR(15))
RETURNS (
    CONTA INTEGER,
    NOMECONTA VARCHAR(50),
    DATA DATE,
    SALDODIA NUMERIC(18,4))
AS
BEGIN EXIT; END
^

ALTER PROCEDURE PCD_DESCONTOS_NF_SERVICO (
    CNPJ VARCHAR(14),
    COD_CLIENTE INTEGER,
    COD_VENDA INTEGER)
RETURNS (
    DESCONTO FLOAT)
AS
DECLARE VARIABLE SUB_TRIBUTARIA CHAR(1);
DECLARE VARIABLE RETEM_PIS CHAR(1);
DECLARE VARIABLE REMIRRF CHAR(1);
DECLARE VARIABLE RETEMINSS CHAR(1);
DECLARE VARIABLE IRRF FLOAT;
DECLARE VARIABLE PIS FLOAT;
DECLARE VARIABLE INSS FLOAT;
DECLARE VARIABLE ISS FLOAT;
DECLARE VARIABLE PCT_DESCTO FLOAT;
DECLARE VARIABLE TOTAL_VENDA FLOAT;
begin
  select c.ret_inss, c.ret_irrf, c.ret_pis, c.sub_tributario from glo_clientes c
  where c.cnpj = :cnpj and c.pessoa_fj = :cod_cliente
  into :reteminss, :remirrf, :retem_pis, :sub_tributaria;

  select vd.irrf, vd.iss, vd.inss, vd.pis_cofins_csll, (vd.total + vd.desc_acres) from fat_vendas vd
  where vd.cnpj = :cnpj and vd.codigo = :cod_venda
  into :irrf, :iss, :inss, :pis, :total_venda;

  pct_descto = 0;
  /*refazendo essa porcaria..*/
  if (coalesce(:sub_tributaria,'N')='S') then
    pct_descto = :pct_descto + coalesce(:iss,0);

  if (:retem_pis = 'S') then
    pct_descto = :pct_descto + coalesce(:pis,0);

  if (:remirrf = 'S') then
    pct_descto = :pct_descto + coalesce(:irrf,0);

  if (:reteminss = 'S') then
    pct_descto = :pct_descto + coalesce(:inss,0);

  total_venda = coalesce(:total_venda,0);
  pct_descto = coalesce(:pct_descto,0);

  desconto = (((:total_venda * :pct_descto)/100));
  suspend;
end
^

ALTER PROCEDURE PCD_DESCTO_ICM (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    DESC_ICMS FLOAT)
AS
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE INTERESTADUAL CHAR(1);
DECLARE VARIABLE ALIQUOTA FLOAT;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE TOTAL_ITEM FLOAT;
DECLARE VARIABLE DEBITA_ICMS CHAR(1);
begin
  desc_icms = 0;
  for select nat.es, nat.interestadual, nat.perc_icms from fat_vendas vd
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and vd.codigo = :venda and vd.pessoa_fj = :pessoa_fj
      into :es, :interestadual, :aliquota
  do
  begin
     if ((:es = 'S') and (:interestadual = 'E')) then
     begin
         for select vdi.produto, (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0)-coalesce(vdi.desconto,0)))
             from fat_vendas_itens vdi
             where vdi.cnpj = :cnpj and vdi.codigo = :venda
             into :produto, :total_item
         do
         begin
             select prd.debita_icms from est_produtos prd
             where prd.codigo = :produto and prd.cnpj = :cnpj
             into :debita_icms;

             if (:debita_icms = 'S') then
               desc_icms = :desc_icms + ((:total_item * :aliquota) / 100);
         end
     end
  end
  suspend;
END
^

ALTER PROCEDURE PCD_EST_ACERTOCUSTOMEDIO (
    CNPJ VARCHAR(14))
AS
DECLARE VARIABLE CUSTO NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
begin
  /*procedimento construido para fazer um acerto do preço médio.
  aparentemente este é utilizado como um paleativo, pois não encontrei
  referência dele em nenhum arquivo da aplicação e nem mesmo e outro procedure
  ou evento de BD*/
  for
    select ie.produto,  sum(ie.prc_custo * ie.quantidade) / sum(ie.quantidade)
    from est_entradas_itens ie
    where ie.cnpj = :cnpj
    group by 1
    into :produto, :custo
  do begin
    update est_produtos p
      set p.prc_custo_med = :custo
    where p.codigo = :produto and cnpj = :cnpj;
  end
END
^

ALTER PROCEDURE PCD_EST_COM_PARC (
    CNPJ VARCHAR(14),
    COD_PARC INTEGER,
    VENDEDOR INTEGER,
    STATUS CHAR(1))
AS
DECLARE VARIABLE DT_BAIXA DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE RECEBER INTEGER;
DECLARE VARIABLE CLIENTE INTEGER;
DECLARE VARIABLE FORNECEDOR INTEGER;
DECLARE VARIABLE REPRESENTA_LIB NUMERIC(18,4);
DECLARE VARIABLE REPRESENTA_BX NUMERIC(18,4);
DECLARE VARIABLE REPRESENTA_PG NUMERIC(18,4);
DECLARE VARIABLE ATRASO INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE VLR_BAIXA NUMERIC(18,4);
DECLARE VARIABLE JUROS NUMERIC(18,4);
DECLARE VARIABLE PCT_PAGTO NUMERIC(18,4);
DECLARE VARIABLE GAMB VARCHAR(20);
DECLARE VARIABLE PERFIL INTEGER;
BEGIN
      /*Procedure criado com a finalidade de possibilitar estornos de movmentos
      de comissão, à saber: Quitada->Gerada; Gerada->Aberta; Cancelada->Aberta;*/
    
      /*descobrindo o cod. do fornecedor só pra garantir*/
      select vdd.pessoa_fj from fat_vendedor vdd
      where vdd.cnpj = :cnpj and vdd.codigo = :vendedor
      into :fornecedor;
    
      /*verificando se existe alguma quitação parcial*/
      select count(*) from cm_parc_pagar cp
      where cp.cnpj = :cnpj and cp.cod_parc_com = :cod_parc
      into :cont;
    

      select cmp.cod_receber, cmp.pessoa_fj from cm_comissao_parc cmp
      where cmp.cnpj = :cnpj and cmp.codigo = :cod_parc
      into :receber, :cliente;
    
      /*existe ou existiram contas à pagar geradas a partir de baixas*/
      if (:cont > 0) then
      begin
        /*verificando se existe baixas nas contas à pagar*/
        select count(*) from fin_baixas_pagar bx
        inner join cm_parc_pagar cp on (bx.cnpj = cp.cnpj and bx.codigo_pg = cp.cod_pagar)
        where cp.cnpj = :cnpj and cp.cod_parc_com = :cod_parc and bx.pessoa_fj = :fornecedor
        into :cont;
    
        if (:cont > 0) then
          exception CM_PG_BAIXADA;
    

        /*verificando se existe baixas nas contas à pagar*/
        select count(*) from fin_contas_pagar pg
        inner join cm_parc_pagar cp on (pg.cnpj = cp.cnpj and pg.codigo = cp.cod_pagar)
        where cp.cnpj = :cnpj and cp.cod_parc_com = :cod_parc and pg.pessoa_fj = :fornecedor
        into :cont;
    
        if (:cont > 0) then
          exception CM_PG_EXISTE;

        if (:receber is not null) then
        begin
          representa_lib =  0;
          representa_pg =  0;
          representa_BX =  0;

          /*resgatando a composição dos percentuais de Pct-liberado e Pct-Pago baseando-se nos regs de
          contas recebidas*/
          for select rec.vlr_baixa, rec.juros, rec.dt_baixa, rec.dt_vencto, rec.valor from fin_baixas_receber rec
              where rec.cnpj = :cnpj and rec.codigo_cr = :receber and rec.pessoa_fj = :cliente
              into :vlr_baixa, :juros, :dt_baixa, :dt_vencto, :valor
          do
          begin
             /*descobriremos aqui os dias de atraso*/
             atraso = (:dt_baixa - :dt_vencto);
             if (atraso < 0) then
                atraso = 0;
        
             gamb = atraso;

             select vdd.cod_perfil_pagto from fat_vendedor vdd
             where vdd.codigo = :VENDEDOR
             into :perfil;

             select pfx.pct_pagto from cm_perfil_pagto_faixa pfx
             where (:gamb between pfx.dia_inicial and pfx.dia_final) and pfx.cnpj = :cnpj and pfx.cod_perfil_pagto = :perfil
             into :pct_pagto;
        
             vlr_baixa = (:vlr_baixa - coalesce(:juros,0));
        
             /*está baixando um percentual da conta*/
             if (:vlr_baixa > 0) then
             begin
               if (:vlr_baixa >= :valor) then
                  representa_bx = 100;
               else
                  representa_bx = ((:vlr_baixa * 100.00)/:valor);
        
              /*o vlr. que será debitado do vlr. total da comissão*/
              representa_pg = representa_pg + representa_bx;
        
              /*o valor percentual que será liberado já descontado o vlr. de redução*/
              representa_lib = representa_lib + ((:representa_bx * :pct_pagto)/100.00);
             end
          end
        
          /*-------------------------------------atulizando os valores--------------------------------------*/
          update cm_comissao_parc cmp set cmp.pct_liberado = :representa_lib, cmp.pct_pago = :representa_pg
          where cmp.codigo = :cod_parc and cmp.cnpj = :cnpj;
        end
      end

      /*o estado para qual o registro irá ser convertido*/
      if (:status = 'A') then
      begin
        /* excluindo os movimentos á vista*/
        delete from cm_comissao_parc cmp where cmp.codigo = :cod_parc and cmp.cnpj = :cnpj and cmp.cod_receber is null;

        /*----------zerando o valor da comissão---------*/
        update cm_comissao_parc cmp set cmp.vlr_total = 0, status = :status
        where cmp.codigo = :cod_parc and cmp.cnpj = :cnpj;
     end
     else
     begin
        /*---------------------atualizando somente o status--------------------------*/
        update cm_comissao_parc cmp set status = :status where cmp.codigo = :cod_parc and cmp.cnpj = :cnpj;
     end
END
^

ALTER PROCEDURE PCD_EST_COMISSAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE COD_PARC INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE STATUS CHAR(1);
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE TROCA INTEGER;
begin

  /*Excluindo os movtos à vista*/
  for select cmp.codigo, cm.cod_vendedor, cmp.status, cm.cod_venda, cm.cod_troca  from cm_comissao_parc cmp
      inner join cm_comissao cm on (cm.cnpj = cmp.cnpj and cm.codigo = cmp.cod_comissao)
      where cmp.cod_comissao = :codigo and cmp.cnpj = :cnpj
      order by cmp.codigo desc
      into :cod_parc, :vendedor, :status, :venda, :troca
  do
  begin
    if (:status = 'G') then
       status = 'A';
    else
       status = 'G';

    execute procedure PCD_EST_COM_PARC(:cnpj,:cod_parc,:vendedor,:status);
  end

  /*atualizando os itens da venda*/
  if (:venda > 0) then
    update fat_vendas_itens vdi set vdi.com_gerada = 'N' where vdi.cnpj = :cnpj and vdi.codigo = :venda and vdi.vendedor = :vendedor;
  else
    update fat_trocas_itens tri set tri.com_gerada = 'N' where tri.cnpj = :cnpj and tri.codigo = :troca;
END
^

ALTER PROCEDURE PCD_EST_MAX_MIN (
    CNPJ VARCHAR(14),
    TIPO SMALLINT,
    FORNECEDOR INTEGER,
    MARCA INTEGER,
    LOC1 INTEGER,
    LOC2 INTEGER,
    LOC3 INTEGER,
    TIPO_CALC CHAR(1))
RETURNS (
    PRD_EST_FISICO NUMERIC(18,4),
    PRD_PRODUTO VARCHAR(67),
    PRD_CODIGO VARCHAR(15),
    PRD_GRUPO VARCHAR(50),
    PRD_SUB_GRUPO VARCHAR(50),
    PRD_DT_ULTCOMPRA DATE,
    PRD_DT_ULTVENDA DATE,
    PRD_ESTOQUE NUMERIC(18,4),
    SUJ_COMPRA_MAX NUMERIC(18,4),
    QTDE_COTACAO NUMERIC(18,4),
    SUJ_COMPRA_MIN NUMERIC(18,4),
    PRD_ATIVO CHAR(1),
    PRD_MAX NUMERIC(18,4),
    PRD_MIN NUMERIC(18,4))
AS
declare variable grupo integer;
declare variable sub_grupo integer;
declare variable cont integer;
begin

    for select prd.grupo, prd.subgrupo, coalesce(prd.qtdade_2,0),
        (coalesce(prd.codigo,'')||' - '||coalesce(prd.nome,'')),
        prd.codigo, coalesce(prd.est_min,0), coalesce(prd.est_max,0), prd.dt_ult_venda, prd.dt_ult_compra,
        coalesce(prd.ativo,'S')
        from est_produtos prd
        where prd.cnpj = :cnpj
        and ((coalesce(prd.est_min,0) > 0) or (coalesce(prd.est_max,0) > 0))
        and ((prd.marca = :marca) or (coalesce(:marca,0) = 0))
        and ((prd.fornecedor = :fornecedor) or (coalesce(:fornecedor,0) = 0))
        and ((prd.cod_localizacao_1 = :loc1) or (coalesce(:loc1,0) = 0))
        and ((prd.cod_localizacao_2 = :loc2) or (coalesce(:loc2,0) = 0))
        and ((prd.cod_localizacao_3 = :loc3) or (coalesce(:loc3,0) = 0))
        into :grupo, :sub_grupo, :prd_est_fisico,
        :prd_produto, :prd_codigo,  :prd_min, :prd_max, :prd_dt_ultvenda, :prd_dt_ultcompra,
        :prd_ativo
    do
    begin
      /*somando o total de produtos nas cotações*/
      select count(cti.quantidade) from fat_cotacoes ct
      inner join fat_cotacoes_itens cti on (ct.codigo = cti.codigo and cti.cnpj = ct.cnpj)
      where cti.produto = :prd_codigo and coalesce(ct.fechado,'N') = 'N'
      into :qtde_cotacao;

      /*Nome subgrupo*/
      select grp.nome from est_grupos grp
      where grp.cnpj = :cnpj and grp.codigo = :grupo
      into :prd_grupo;

      /*Nome subgrupo*/
      select sbgrp.nome from est_subgrupos sbgrp
      where sbgrp.cnpj = :cnpj and sbgrp.subgrupo = :sub_grupo  and sbgrp.grupo = :grupo
      into :prd_sub_grupo;
    
      /*Dt. Ultima venda
      select max(vd.data) from fat_vendas vd
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
      where vd.cnpj = :cnpj and vdi.produto = :prd_codigo  and coalesce(vd.fechada,'N') = 'S'
      and coalesce(vd.cancelada,'N') = 'N'  and coalesce(vd.enviada_cx,'N') = 'S' and
      nat.es = 'S' and nat.computa_venda = 'S' and nat.ativa = 'S'
      into :prd_dt_ultvenda;*/
    
      /*Dt. Ultima Compra
      select max(vd.data) from fat_vendas vd
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
      where vd.cnpj = :cnpj and vdi.produto = :prd_codigo
      and coalesce(vd.fechada,'') = 'S' and coalesce(vd.cancelada,'') <> 'S' and nat.es = 'E'
      and nat.ativa = 'S'
      into :prd_dt_ultcompra;*/

      if (:prd_est_fisico < :prd_max) then
         suj_compra_max = :prd_max - :prd_est_fisico;
      else
        suj_compra_max = 0;

      if (:prd_est_fisico < :prd_min) then
         suj_compra_min = :prd_min - :prd_est_fisico;
      else
         suj_compra_min = 0;

      if (:tipo_calc = 'P') then
         select prd_estoque from PCD_SUB_PCD_EST_MAX_MIN(:cnpj,:grupo,:prd_codigo,:tipo)   into :prd_estoque;
      else
      begin
        if (:tipo = 1) then
          prd_estoque = :prd_min;
        else
          prd_estoque = :prd_max;
      end



      /*estoque mínimo*/
      if (:tipo = 1) then
      begin
        if (:prd_est_fisico < :prd_estoque) then
          suspend;
      end   /*estoque máximo*/
      else if (:tipo = 2) then
      begin
        if (:prd_est_fisico > :prd_estoque) then
          suspend;
      end
      else
        suspend; /*retornando todos */

    end
END
^

ALTER PROCEDURE PCD_EST_PROCESSA_CONTAGEM_GRADE (
    CNPJ VARCHAR(14),
    CONTAGEM_GRADE INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE GRADE VARCHAR(4);
DECLARE VARIABLE NUMERO VARCHAR(6);
DECLARE VARIABLE QDE NUMERIC(18,4);
DECLARE VARIABLE QDE_ANTIGA NUMERIC(18,4);
DECLARE VARIABLE QDE_KDX NUMERIC(18,4);
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TIPO_KDX CHAR(1);
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE CONTAGEM_INCREMENTAL CHAR(1);
begin

  select coalesce(emp.contagem_incremental,'N') from sis_empresas emp
  where emp.cnpj = :cnpj
  into :contagem_incremental;


  data = cast('today' as date);
  ano = extract (year from data);
  mes = extract (month from data);
  ndocto = cast(:contagem_grade as varchar(20));

  select coalesce(ec.local,2) from est_contagem_grade ec
  where ec.cnpj = :cnpj and ec.codigo = :contagem_grade
  into :local;


  /*-----------------------------Gerando Kardex------------------------------*/
  /*Estoque físico*/
  if (:local = 2) then
  begin
      for
        select c.produto, sum(c.qtde)
        from est_contagem_grade_produto c
        where c.contagem_grade = :contagem_grade and cnpj = :cnpj
        group by c.produto
        into :produto, :qde
      do
      begin
        select coalesce(p.qtdade_2,0)
        from est_produtos p where p.codigo = :produto and p.cnpj = :cnpj
        into :qde_antiga;
    
        if (:contagem_incremental = 'N') then
        begin
          if (:qde_antiga < :qde)then
          begin
            qde_kdx = (:qde - :qde_antiga);
            tipo_kdx = 'E'; /*Registro como movimento de entrada*/
          end
          else if (:qde_antiga > :qde) then
          begin
            qde_kdx = (:qde_antiga - :qde);
            tipo_kdx = 'S'; /*Registro como movimento de saída*/
          end
          else
          begin
            qde_kdx = 0;
            tipo_kdx = 'N'; /*Neutro*/
          end
        end
        else
        begin /*não faz o jogo de sinal*/
          qde_kdx = :qde;
          tipo_kdx = 'E';
        end
    
    
        insert into est_kardex (cnpj, produto, ndocto,
                            dt_movto, mes, ano,
                            origem, tipo_es,
                            qtdade_ant, qtdade, prc_unit,
                            descontos)
        values              (:cnpj, :produto, :ndocto,
                            :data, :mes, :ano,
                            'CNT-G', :tipo_kdx,
                            :qde_antiga, :qde_kdx, 0,
                            0);
    
      end
  end


  for
    select c.produto, coalesce(c.grade,'000'), coalesce(c.numero,'000000'), sum(c.qtde)
    from est_contagem_grade_produto c
    where c.contagem_grade = :contagem_grade and cnpj = :cnpj
    group by c.produto, c.grade, c.numero
    into :produto, :grade, :numero, :qde
  do
  begin
    /*validações referentes a movimentações físicas de estoque*/
    if (:local = 2) then
    begin
        /* se além de grades, temos números, tenho de saber quanto tinha anteriormente */
        if (:numero <> '000000') then
        begin
          select coalesce(p.estoque,0)
          from est_produtos_grades_numeros p
          where p.produto = :produto and upper(p.grade) = upper(:grade) and p.cnpj = :cnpj
          and p.numero = :numero
          into :qde_antiga;
        end
        else
        begin
          select coalesce(p.estoque,0)
          from est_produtos_grades p
          where p.produto = :produto and upper(p.grade) = upper(:grade) and p.cnpj = :cnpj
          into :qde_antiga;
        end
    
        /* produto com grade, atualizando numero que ira atualizar grade e por final atualizara o produto */
        if (:grade <> '000' and :numero <> '000000') then
        begin
          if (:contagem_incremental = 'N') then
          begin
            update est_produtos_grades_numeros p
            set p.estoque = :qde
            where p.produto = :produto and upper(p.grade) = upper(:grade) and upper(p.numero) = upper(:numero) and p.cnpj = :cnpj;
          end
          else
          begin
            update est_produtos_grades_numeros p
            set p.estoque = :qde_antiga + :qde
            where p.produto = :produto and upper(p.grade) = upper(:grade) and upper(p.numero) = upper(:numero) and p.cnpj = :cnpj;
          end
        end
    
        if (:grade = '000' and :numero = '000000') then
        begin
          if (:contagem_incremental = 'N') then
          begin
            update est_produtos p set p.qtdade_2 = :qde
            where p.codigo = :produto and p.cnpj = :cnpj;
          end
          else
          begin
            update est_produtos p set p.qtdade_2 = :qde + :qde_antiga
            where p.codigo = :produto and p.cnpj = :cnpj;
          end
    
        end
    end
    else /*soemnte para estoque fiscal*/
    begin
      select coalesce(p.qtdade_1,0)
      from est_produtos p where p.codigo = :produto and p.cnpj = :cnpj
      into :qde_antiga;

      if (:contagem_incremental = 'N') then
      begin
        update est_produtos p set p.qtdade_1 = :qde
        where p.codigo = :produto and p.cnpj = :cnpj;
      end
      else
      begin
        update est_produtos p set p.qtdade_1 = :qde + :qde_antiga
        where p.codigo = :produto and p.cnpj = :cnpj;
      end
    end
  end

  /*agrupando por produto para atualizar o campo QTDE-2 na est-produtos,
  isso só acontece se for adicionado produos que não possuirem grades na contagem,
  o que será permitido a partir da versão 28*/
END
^

ALTER PROCEDURE PCD_EST_VALIDACODBARRAS (
    CODIGO VARCHAR(15),
    GRADE VARCHAR(4),
    NUMERO VARCHAR(6),
    USA_GRADE SMALLINT,
    CNPJ VARCHAR(14))
RETURNS (
    EXISTE INTEGER)
AS
begin
  existe = 0;
  if (:usa_grade is null) then
    usa_grade = 0;

  if (:usa_grade = 1) then
  begin
    select count(n.cnpj) existe
    from est_produtos_grades_numeros n
    where n.produto  = :codigo  and n.grade = :grade
    and n.numero = :numero and n.cnpj = :cnpj
    into :existe;
  end
  else
  begin
    if (existe = 0) then
    select count(p.codigo) existe
    from est_produtos p
    where p.codigo = :codigo and p.cnpj = :cnpj
    into :existe;
  end

  suspend;
END
^

ALTER PROCEDURE PCD_ESTORNA_CH (
    CNPJ VARCHAR(14),
    CHEQUE VARCHAR(6),
    BANCO VARCHAR(3),
    CONTA VARCHAR(15))
AS
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE DT_CONC DATE;
DECLARE VARIABLE CONTA_PL INTEGER;
DECLARE VARIABLE BANCO_CH VARCHAR(3);
begin
  /*o banco do cheque pode ser diferente do banco de conciliação do movimento*/
  banco_ch = :banco;

  /*resgatando dados importantes da tabela de cheques*/
  select ch.valor, ch.conta_conc  from fin_cheques ch
  where ch.cnpj = :cnpj and ch.banco = :banco and ch.conta = :conta and ch.cheque = :cheque
  into  :valor, :conta_pl;

  select p.banco from ctb_planoconta p
  where p.cnpj = :cnpj and p.conta = :conta_pl
  into :banco;

  /*------Resgatando a planilha no movimento------*/
  select codigo from gerar_codigo ('PLANILHA',1)
  into :planilha;

  dt_conc = cast('today' as date);

  /*Inserindo um movimento de débito para compensar o cheque estornado */
  execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:cnpj, :dt_conc,'D',('CH:'||:cheque),('-->EST. CONCILIAÇÃO CH: '||cast('today' as date)), :valor, :conta_pl,'EXT->CHQ',:planilha,null,:banco, 'A','CHQ',null);

  /* Acertando a tabela de cheques */
  update fin_cheques ch set ch.data_conciliacao = null, ch.processado = 'N', ch.tipo = 'NO'
  where ch.cnpj = :cnpj and ch.banco = :banco_ch and ch.conta = :conta
  and ch.cheque = :cheque;

  suspend;
END
^

ALTER PROCEDURE PCD_ESTORNA_PAGAR2 (
    CNPJ VARCHAR(14),
    PLANILHA INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CODIGO_CR INTEGER;
DECLARE VARIABLE CODIGO_PG INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE MAXCODIGO INTEGER;
DECLARE VARIABLE CONT INTEGER;
begin

  /*Estornando Contas Pagas*/
  for select bx.codigo, bx.pessoa_fj, bx.codigo_pg from fin_baixas_pagar bx
      where bx.cnpj = :cnpj and bx.planilha = :planilha
      order by bx.codigo desc
      into :codigo, :pessoa_fj, :codigo_pg
  do
  begin
     /*verifanco se existe algum movimento que obrigatoriamente deverá ser estornado primeiro*/
     select max(bx.codigo) from fin_baixas_pagar bx where bx.codigo_pg = :codigo_pg and bx.pessoa_fj = :pessoa_fj
     into :maxcodigo;

     /*existe um movimento de baixa efetuado posteriormente que necessitará ser estornado primeiro*/
     if(coalesce(:maxcodigo,0) > :codigo) then
       exception exp_estorna_baixa;

     /*verificando se este é um movimento de baixa parcial ou integral*/
     select count(*) from  fin_contas_pagar pgr
     where pgr.cnpj = :cnpj and pgr.pessoa_fj = :pessoa_fj and pgr.codigo = :codigo_pg
     into :existe;

     if (:existe > 0) then
       execute procedure estorna_pagar_parcial(:cnpj,:codigo,:pessoa_fj);
     else
       execute procedure estorna_pagar_integral(:cnpj,:codigo,:pessoa_fj);

     /*deletando a baixa de contas*/
     delete from fin_baixas_pagar bx2 where bx2.cnpj = :cnpj and bx2.codigo = :codigo ;
     /*deletando a baixa de contas*/
  end

  /*excluindo os movimentos de cheques*/
  delete from fin_cheques ch where ch.cnpj = :cnpj and ch.planilha = :planilha;

  /*excluindo os movimentos de cheques*/
  delete from ctb_cheque ch where ch.cnpj = :cnpj and ch.planilha = :planilha;

  /*excluindo os movimentos de cartão*/
  delete from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.planilha = :planilha;

  /*excluindo os movimentos bancários*/
  delete from ctb_movimento_contabil ctb where ctb.cnpj = :cnpj and ctb.planilha = :planilha;

  /*excluindo os recibos*/
  delete from fin_recibos rb where rb.cnpj = :cnpj and rb.planilha = :planilha;


  suspend;
END
^

ALTER PROCEDURE PCD_EXCLUI_COMISSAO (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE COD_COMISSAO INTEGER;
begin
  if ((:new_fechada = 'N') and (:old_fechada= 'S')) then
  begin
    /*venda estava fechada e voltou a estar aberta*/
    for select cm.codigo from cm_comissao cm
      where cm.cod_venda = :codigo and cm.cnpj = :cnpj
      into :cod_comissao
    do
    begin
      /*verificando se existe alguma comissão quitada */
      select count(*) from cm_comissao_parc cmp
      where cmp.cod_comissao = :cod_comissao and cmp.cnpj = :cnpj and cmp.status = 'Q'
      into :cont;

      if (:cont > 0) then
        exception COMISSAO_QUITADA;

      /*deletando os parcelamentos de comissão*/
      delete from cm_comissao_parc cmp
      where cmp.cod_comissao = :cod_comissao and cmp.cnpj = :cnpj;

      /*excluindo o cabeçalho da comissão*/
      delete from cm_comissao cm
      where cm.codigo = :cod_comissao and cm.cnpj = :cnpj;
    end

    /*excluindo os logs, pois eles influenciarao no relatório de comissoes*/
    delete from cm_log lg where lg.cnpj = :cnpj and lg.cod_venda = :codigo;

    update fat_vendas_itens vdi set vdi.com_gerada = 'N'
    where vdi.cnpj = :cnpj and vdi.codigo = :codigo;
  end
END
^

ALTER PROCEDURE PCD_EXCLUI_COMISSAO_2 (
    CNPJ VARCHAR(18),
    CODIGO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
begin
  if ((:new_fechada = 'N') and (:old_fechada= 'S')) then
  begin
    /*venda estava fechada e voltou a estar aberta*/

      /*verificando se existe alguma comissão quitada */
      select count(*) from cm2_comissao_parc  cmp
      where cmp.cod_venda = :codigo and cmp.cnpj = :cnpj and cmp.status = 'P'
      into :cont;

      if (:cont > 0) then
        exception COMISSAO_QUITADA;

      /*deletando os parcelamentos de comissão*/
      delete from cm2_comissao_parc cmp
      where cmp.cod_venda = :codigo and cmp.cnpj = :cnpj;
  end
END
^

ALTER PROCEDURE PCD_EXCLUI_VENDA_2
AS
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE CODIGO VARCHAR(14);
begin
  for select vd.cnpj, vd.codigo from fat_vendas vd
  where vd.enviada_cx = 'N'
  into :cnpj, :codigo
  do
  begin
    execute PROCEDURE Exclui_Venda(:cnpj, :codigo);
  end
  suspend;
end
^

ALTER PROCEDURE PCD_EXECUTA_DEVOLUCAO (
    CNPJ VARCHAR(18),
    ID_AGRUPADOR INTEGER,
    PESSOA INTEGER,
    VENDEDOR INTEGER,
    CODIGO INTEGER,
    CFOP INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE TOTAL_PROD NUMERIC(18,4);
DECLARE VARIABLE DEVOLUCAO CHAR(1);
DECLARE VARIABLE ENTREGA_FUTURA CHAR(1);
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE VINCULO INTEGER;
begin
  fator = null;
  select nat.devolucao, coalesce(nat.entrega_futura,'N') from est_natureza nat
  where nat.cnpj = :cnpj and nat.codigo = :cfop
  into :devolucao, :entrega_futura;

  if ((:devolucao = 'S') and (:entrega_futura = 'N')) then
  begin
    if (((:new_enviada = 'S') and (:old_enviada = 'N'))) then
      fator = -1;
    else if (((:new_enviada = 'N') and (:old_enviada = 'S'))) then
      fator = 1;


    if (fator is not null) then
    begin
      /*verificando se a devolução possui um agrupador definido*/
      if (:id_agrupador is null) then
         exception FAT_VINCULADO ;
      else
      begin
        /*verificando se o codigo agrupador pertence a uma nota do mesmo cliente e vendedor,
        por conta das comissões*/
         select vd.codigo from fat_vendas vd
         where vd.cnpj = :cnpj and vd.codigo = :id_agrupador and vd.pessoa_fj = :pessoa
         and vd.vendedor = :vendedor and vd.codigo <> :codigo
         into :vinculo;

         if (:vinculo is null) then
            exception FAT_VINCULADO;
      end

      /*Em casos normais a devolução sempre vai "creditar" diminuindo a qtde-entregue exceto em caso de estorno*/
      for select (vdi.quantidade * :fator), vdi.produto from fat_vendas_itens vdi
        where vdi.cnpj = :cnpj and vdi.codigo = :codigo
        into :qtde, :produto
      do
      begin
        update fat_vendas_itens vdi set vdi.qtde_entregue = vdi.qtde_entregue + :qtde
        where vdi.codigo = :id_agrupador and vdi.cnpj = :cnpj and vdi.produto = :produto;
      end
    end
  end
END
^

ALTER PROCEDURE PCD_EXECUTA_ORDEM_CARGA (
    USUARIO INTEGER,
    CNPJ CHAR(14),
    CODIGO_VND INTEGER,
    NEW_STATUS INTEGER)
RETURNS (
    ORDEM_CARGA INTEGER)
AS
DECLARE VARIABLE COD_OC INTEGER;
DECLARE VARIABLE QTDE_CARREGAR NUMERIC(18,4);
begin
/* ---------- [ Legenda - VENDA] ---------             ---------- [ Legenda - CARGA] ---------
      0 - Aberto
                                                             1 - a Carregar
                                                             2 - a Entregar
      3 - Parcialmente Carregado                             3 - Parcialmente Carregado
      4 - Parcialmente Entregue                              4 - Parcialmente Entregue
      5 - Carregado                                          5 - Carregado
      6 - Entregue                                           6 - Entregue
                                                             7 - Devolvido
                                                             8 - Cancelado
   ---------------------------------------             ---------------------------------------  */

  /* Cria uma ordem de carga */
  SELECT SUM(COALESCE(FTI.CARREGAR,0)+COALESCE(FTI.ENTREGAR,0)+COALESCE(FTI.DEVOLVER,0))
  FROM FAT_VENDAS_ITENS FTI
  WHERE FTI.CODIGO = :CODIGO_VND
  INTO :QTDE_CARREGAR;

  /* SE TIVER PRODUTO PARA SER CARREGADO, CRIA ORDEM DE CARGA */
  IF( :QTDE_CARREGAR > 0 )THEN
  BEGIN
      ORDEM_CARGA = GEN_ID(GEN_CRG_ORDEM_CARGA_ID, 1);
      /* GERA ORDEM DE CARGA */
      INSERT INTO CRG_ORDEM_CARGA(CNPJ,CODIGO, CODIGO_VND,DATA,USUARIO,STATUS)VALUES(:CNPJ,:ORDEM_CARGA,:CODIGO_VND, cast('now' as timestamp),:USUARIO,:NEW_STATUS);
      /* ADICIONA NUMERO DA ORDEM DE CARGA NO PEDIDO */
      update FAT_VENDAS set ordem_carga = :ORDEM_CARGA
      where CNPJ = :CNPJ AND CODIGO = :CODIGO_VND;
  END
  suspend;
END
^

ALTER PROCEDURE PCD_EXECUTA_RECEITUARIO (
    CNPJ VARCHAR(18),
    COD_FATURAMENTO INTEGER,
    NEW_FECHADA CHAR(1),
    OLD_FECHADA CHAR(1),
    NEW_CANCELADA CHAR(1),
    OLD_CANCELADA CHAR(1))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QTDE FLOAT;
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE COD_DEFENSIVO INTEGER;
DECLARE VARIABLE RECEITUARIO CHAR(1);
DECLARE VARIABLE SEQUENCIA INTEGER;
begin

  select exibe_agr from sis_empresas
  where cnpj = :cnpj
  into :receituario;

  /*se não utiliza receituário não gera receita */
  if (coalesce(:receituario,'N') = 'N') then
     exit;

  /*venda estornada, logo terei de creditar o orçamento*/
  if ((:new_fechada = 'N') and (:old_fechada= 'S')) then
    fator = -1;
  if ((:new_fechada = 'S') and (:old_fechada= 'N')) then
    fator = 1;

  /*o procedure é chamado em qualquer update, antes de fechar ou estornar por isso valido*/
  if (fator is null) then
     exit;

  /*No caso de estorno, está sendo feita a deleção dos registros*/
  if (:fator = -1) then
  begin
    delete from agr_receitas rec
    where rec.cod_faturamento = :cod_faturamento and rec.cnpj = :cnpj;
    exit;
  end

  /*Achando o orçamento relacionado*/
  for select vdi.produto, vdi.quantidade, vdi.sequencia from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :cod_faturamento
      into :produto, :qtde, :sequencia
  do
  begin
    /*verificando se o item é um defensivo*/
    cod_defensivo = 0;

    select def.codigo from agr_defensivo_agricola def
    where def.cnpj = :cnpj and def.cod_produto = :produto
    into :cod_defensivo;

    if (:cod_defensivo > 0) then
    begin
      insert into agr_receitas(CNPJ,COD_FATURAMENTO,produto,sequencia, cod_defensivo)
      values(:cnpj, :cod_faturamento, :produto, :sequencia, :cod_defensivo);
    end
  end
END
^

ALTER PROCEDURE PCD_EXECUTA_REMESSA (
    CNPJ VARCHAR(18),
    ID_AGRUPADOR INTEGER,
    PESSOA INTEGER,
    CODIGO INTEGER,
    CFOP INTEGER,
    PROPRIEDADE INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE AUX_QTDE NUMERIC(18,4);
DECLARE VARIABLE REMESSA CHAR(1);
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE VINCULADO INTEGER;
begin
  select nat.remessa from est_natureza nat
  where nat.cnpj = :cnpj and nat.codigo = :cfop
  into :remessa;


  if (:remessa = 'S') then
  begin
    /*verificando se a remessa possui um agrupador definido*/
    if (:id_agrupador is null) then
      exception FAT_VINCULADO;
    else
    begin
      /*verificando se o codigo agrupador pertence a uma nota do mesmo cliente*/
      select vd.codigo from fat_vendas vd
      where vd.cnpj = :cnpj and vd.codigo = :id_agrupador and vd.pessoa_fj = :pessoa
      and coalesce(vd.propriedade,0) = coalesce(:propriedade,0) and vd.codigo <> :codigo
      into :vinculado;

      if (:vinculado is null) then
      exception FAT_VINCULADO;     
    end

    /*atualizando vlrs. tando do estoque como de qtde entregue, isso varia de acordo com o status do registro
    ele pode ser oriundo de um estorno (eviada = 'N') ou mesmo de cancelamento*/
    if ((:new_enviada = 'S') and (:old_enviada = 'N')) then
      fator = 1;
    else if ((:new_enviada = 'N') and (:old_enviada = 'S')) then
      fator = -1;
    else if ((:new_cancelada = 'N') and (:old_cancelada = 'S')) then
      fator = 1;
    else if ((:new_cancelada = 'S') and (:old_cancelada = 'N')) then
      fator = -1;



    if (fator is not null) then
    begin
      for select (vdi.quantidade * :fator), vdi.produto from fat_vendas_itens vdi
          where vdi.cnpj = :cnpj and vdi.codigo = :codigo
          into :qtde, :produto
      do
      begin
        /*testando a remessa, verificando se posso remeter a qtde definida - retornando o saldo */
        select sum(coalesce(vdi.quantidade,0) - coalesce(vdi.qtde_entregue,0)) from fat_vendas_itens vdi
        inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
        where vdi.cnpj = :cnpj and vdi.codigo = :id_agrupador and vdi.produto = :produto
        into :aux_qtde;

        if (:aux_qtde < :qtde) then
          exception fat_vinculado_itens1;

        update fat_vendas_itens vdi set vdi.qtde_entregue = coalesce(vdi.qtde_entregue,0) + :qtde
        where vdi.codigo = :vinculado and vdi.cnpj = :cnpj and vdi.produto = :produto;
      end
   end
  end
END
^

ALTER PROCEDURE PCD_EXP_CONSULTA_FORNECEDORES (
    CNPJ VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    TIPO CHAR(10))
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(15),
    NOME VARCHAR(50),
    EXISTE CHAR(1),
    SELECIONADO CHAR(1),
    CNPJ_ORIGEM VARCHAR(14))
AS
DECLARE VARIABLE CONT INTEGER;
begin
  cnpj_origem = :cnpj;

  if (:tipo = 'T') then
  begin
      for select psa.codigo, psa.nome_razao, psa.cpf_cgc, coalesce(psa.selecionado,'N')
          from glo_fornecedores f
          inner join glo_pessoas_fj psa on (f.cnpj = psa.cnpj and f.pessoa_fj = psa.codigo)
          where f.cnpj = :cnpj
          into :codigo, :nome, :cpf_cnpj, :selecionado
      do
      begin
        select count(*) from glo_fornecedores f
        where f.pessoa_fj = :codigo and cnpj = :cnpj_destino
        into :cont;
    
        if (:cont = 1) then
          existe = 'S';
        else
          existe = 'N';
    
        suspend;
      end
  end
  else if (:tipo = 'D') then
  begin
    for select psa.codigo, psa.nome_razao, psa.cpf_cgc, coalesce(psa.selecionado,'N')
          from glo_fornecedores f
          inner join glo_pessoas_fj psa on (f.cnpj = psa.cnpj and f.pessoa_fj = psa.codigo)
          where f.cnpj = :cnpj
          into :codigo, :nome, :cpf_cnpj, :selecionado
    do
    begin
        select count(*) from glo_fornecedores f
        where f.pessoa_fj = :codigo and cnpj = :cnpj_destino
        into :cont;
    
        if (:cont = 1) then
          existe = 'S';
        else
        begin
          existe = 'N';
          suspend;
        end
    end
  end
end
^

ALTER PROCEDURE PCD_EXP_CONSULTA_PRODUTOS (
    CNPJ VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    TIPO CHAR(10))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    EXISTE CHAR(1),
    SELECIONADO CHAR(1),
    CNPJ_ORIGEM VARCHAR(14),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50))
AS
DECLARE VARIABLE CONT INTEGER;
begin
  cnpj_origem = :cnpj;
  if (:tipo = 'T') then
  begin
      for select prd1.codigo, prd1.codigo_2, prd1.nome,coalesce(prd1.selecionado,'N'),
          prd1.marca, mr.nome,
          gr.codigo, gr.nome,
          sgr.subgrupo, sgr.nome
          from est_produtos prd1
          left join est_marcas mr on (mr.cnpj = prd1.cnpj and prd1.marca = mr.codigo)
          left join est_grupos gr on (gr.cnpj = prd1.cnpj and prd1.grupo = gr.codigo)
          left join est_subgrupos sgr on (sgr.cnpj = prd1.cnpj and prd1.grupo = sgr.grupo and prd1.subgrupo = sgr.subgrupo)
          where prd1.cnpj = :cnpj
          into :codigo, :codigo_2, :nome, :selecionado,
          :cod_marca, :marca,
          :cod_grupo, :grupo,
          :cod_subgrupo, :subgrupo
      do
      begin
        select count(*) from est_produtos
        where codigo = :codigo and cnpj = :cnpj_destino
        into :cont;
    
        if (:cont = 1) then
          existe = 'S';
        else
          existe = 'N';
    
        suspend;
      end
  end
  else if (:tipo = 'D') then
  begin
    for select prd1.codigo, prd1.codigo_2, prd1.nome,coalesce(prd1.selecionado,'N'),
          prd1.marca, mr.nome,
          gr.codigo, gr.nome,
          sgr.subgrupo, sgr.nome
          from est_produtos prd1
          left join est_marcas mr on (mr.cnpj = prd1.cnpj and prd1.marca = mr.codigo)
          left join est_grupos gr on (gr.cnpj = prd1.cnpj and prd1.grupo = gr.codigo)
          left join est_subgrupos sgr on (sgr.cnpj = prd1.cnpj and prd1.grupo = sgr.grupo and prd1.subgrupo = sgr.subgrupo)
          where prd1.cnpj = :cnpj
          into :codigo, :codigo_2, :nome, :selecionado,
          :cod_marca, :marca,
          :cod_grupo, :grupo,
          :cod_subgrupo, :subgrupo
      do
      begin
        select count(*) from est_produtos
        where codigo = :codigo and cnpj = :cnpj_destino
        into :cont;
    
        if (:cont = 1) then
          existe = 'S';
        else
        begin
          existe = 'N';
          suspend;
        end
      end
  end
end
^

ALTER PROCEDURE PCD_EXP_INSERE_CLIENTES (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE NOME_RAZAO VARCHAR(50);
DECLARE VARIABLE FANTASIA VARCHAR(50);
DECLARE VARIABLE ATIVIDADE INTEGER;
DECLARE VARIABLE ENDERECO INTEGER;
DECLARE VARIABLE NUMERO VARCHAR(15);
DECLARE VARIABLE COMPLEMENTO VARCHAR(30);
DECLARE VARIABLE BAIRRO INTEGER;
DECLARE VARIABLE CIDADE INTEGER;
DECLARE VARIABLE UF VARCHAR(2);
DECLARE VARIABLE CEP VARCHAR(8);
DECLARE VARIABLE FONE VARCHAR(20);
DECLARE VARIABLE FAX VARCHAR(20);
DECLARE VARIABLE CELULAR VARCHAR(20);
DECLARE VARIABLE PESSOA CHAR(1);
DECLARE VARIABLE CPF_CGC VARCHAR(15);
DECLARE VARIABLE RG_IE VARCHAR(20);
DECLARE VARIABLE CONTATO VARCHAR(30);
DECLARE VARIABLE DT_NASCIMENTO DATE;
DECLARE VARIABLE DT_CADASTRO DATE;
DECLARE VARIABLE EMAIL VARCHAR(80);
DECLARE VARIABLE OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE INSC_MUNIC VARCHAR(15);
DECLARE VARIABLE CONVENIO INTEGER;
DECLARE VARIABLE EMISSOR CHAR(6);
DECLARE VARIABLE CONTATO1 VARCHAR(50);
DECLARE VARIABLE CONTATO2 VARCHAR(50);
DECLARE VARIABLE CONTATO3 VARCHAR(50);
DECLARE VARIABLE ORDEM INTEGER;
DECLARE VARIABLE REGIAO INTEGER;
DECLARE VARIABLE NFE_EXP CHAR(1);
DECLARE VARIABLE SELECIONADO CHAR(1);
DECLARE VARIABLE RG_NOME VARCHAR(50);
DECLARE VARIABLE LG_NOME VARCHAR(50);
DECLARE VARIABLE BR_NOME VARCHAR(50);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CDD_NOME VARCHAR(50);
DECLARE VARIABLE CDD_UF VARCHAR(2);
DECLARE VARIABLE CDD_COD_IBGE VARCHAR(7);
DECLARE VARIABLE CDD_COD_IAGRO INTEGER;
DECLARE VARIABLE UF_NOME VARCHAR(50);
DECLARE VARIABLE ATV_NOME VARCHAR(50);
DECLARE VARIABLE F_VENDEDOR VARCHAR(50);
DECLARE VARIABLE F_FONE_VEN VARCHAR(20);
DECLARE VARIABLE F_FINANCEIRO VARCHAR(50);
DECLARE VARIABLE F_FONE_FIN VARCHAR(20);
DECLARE VARIABLE F_REPRESENTANTE VARCHAR(50);
DECLARE VARIABLE F_FONE_REP VARCHAR(20);
DECLARE VARIABLE F_BANCO_C1 VARCHAR(3);
DECLARE VARIABLE F_AGENCIA_C1 VARCHAR(6);
DECLARE VARIABLE F_CC_C1 VARCHAR(15);
DECLARE VARIABLE F_BANCO_C2 VARCHAR(3);
DECLARE VARIABLE F_AGENCIA_C2 VARCHAR(6);
DECLARE VARIABLE F_CC_C2 VARCHAR(15);
DECLARE VARIABLE F_FORMA_PAGTO INTEGER;
DECLARE VARIABLE F_CONTABILIDADE INTEGER;
begin

    /*selecionando registros */
    select   NOME_RAZAO ,
             FANTASIA,
             ATIVIDADE ,
             ENDERECO ,
             NUMERO ,
             COMPLEMENTO ,
             BAIRRO ,
             CIDADE ,
             UF ,
             CEP ,
             FONE ,
             FAX ,
             CELULAR ,
             PESSOA ,
             CPF_CGC ,
             RG_IE,
             CONTATO,
             DT_NASCIMENTO,
             DT_CADASTRO,
             EMAIL,
             OBS,
             INSC_MUNIC,
             EMISSOR ,
             CONTATO1,
             CONTATO2,
             CONTATO3,
             ORDEM ,
             REGIAO ,
             NFE_EXP
           from glo_pessoas_fj psa
           where psa.cnpj = :cnpj_origem
           and psa.codigo = :codigo
           into
           :NOME_RAZAO ,
           :FANTASIA,
           :ATIVIDADE ,
           :ENDERECO ,
             :NUMERO ,
             :COMPLEMENTO ,
             :BAIRRO ,
             :CIDADE ,
             :UF ,
             :CEP ,
             :FONE ,
             :FAX ,
             :CELULAR ,
             :PESSOA ,
             :CPF_CGC ,
             :RG_IE,
             :CONTATO,
             :DT_NASCIMENTO,
             :DT_CADASTRO,
             :EMAIL,
             :OBS,
             :INSC_MUNIC,
             :EMISSOR ,
             :CONTATO1,
             :CONTATO2,
             :CONTATO3,
             :ORDEM ,
             :REGIAO ,
             :NFE_EXP;




     /*regiao*/
     if (:regiao is not null) then
     begin
         cont = 0;
         select count(*) from glo_regioes r
         where r.cnpj = :cnpj_destino and r.codigo = :regiao
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select r.nome from glo_regioes r
            where r.cnpj = :cnpj_origem and r.codigo = :regiao
            INTO :rg_nome;
    
            insert into glo_regioes(cnpj,codigo,nome)
            values (:cnpj_destino,:regiao, :rg_nome);
         end
     end

     /*logradouro*/
     if (:endereco is not null) then
     begin
         cont = 0;
         select count(*) from glo_logradouros l
         where l.cnpj = :cnpj_destino and l.codigo = :endereco
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.nome from glo_logradouros l
            where l.cnpj = :cnpj_origem and l.codigo = :endereco
            INTO :lg_nome;
    
            insert into glo_logradouros(cnpj,codigo,nome)
            values (:cnpj_destino,:endereco, :lg_nome);
         end
     end

     /*BAIRRO*/
     if (:bairro is not null) then
     begin
         cont = 0;
         select count(*) from glo_bairros l
         where l.cnpj = :cnpj_destino and l.codigo = :bairro
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.nome from glo_bairros l
            where l.cnpj = :cnpj_origem and l.codigo = :bairro
            INTO :br_nome;
    
            insert into glo_bairros(cnpj,codigo,nome)
            values (:cnpj_destino,:bairro, :br_nome);
         end
     end

     /*cidade*/
     if (:cidade is not null) then
     begin
         cont = 0;
         select count(*) from glo_cidades l
         where l.cnpj = :cnpj_destino and l.codigo = :cidade
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.uf, l.cod_ibge, l.cod_iagro, l.nome from glo_cidades l
            where l.cnpj = :cnpj_origem and l.codigo = :cidade
            INTO :cdd_uf, :cdd_cod_ibge, :cdd_cod_iagro, :cdd_nome;
    
            /*estados*/
            if (:cdd_uf is not null) then
            begin
              cont = 0;
              select count(*) from glo_estados l
              where l.cnpj = :cnpj_destino and l.sigla = :cdd_uf
              into :cont;
    
              if ((coalesce(:cont,0) = 0) ) then
              begin
                select l.nome from glo_estados l
                where l.cnpj = :cnpj_origem and l.sigla = :cdd_uf
                INTO :uf_nome;
        
                insert into glo_estados(cnpj,sigla,nome)
                values (:cnpj_destino,:cdd_uf, :uf_nome);
              end
            end


            insert into glo_cidades(cnpj, codigo, uf, cod_ibge, cod_iagro, nome)
            values (:cnpj_destino,:cidade, :cdd_uf, :cdd_cod_ibge, :cdd_cod_iagro, :cdd_nome);
         end
     end

     /*estados*/
     if (:uf is not null) then
     begin
       cont = 0;
       select count(*) from glo_estados l
       where l.cnpj = :cnpj_destino and l.sigla = :uf
       into :cont;

       if ((coalesce(:cont,0) = 0) ) then
       begin
         select l.nome from glo_estados l
         where l.cnpj = :cnpj_origem and l.sigla = :uf
         INTO :uf_nome;

         insert into glo_estados(cnpj,sigla,nome)
         values (:cnpj_destino,:uf, :uf_nome);
       end
     end

     /*Atividades*/
     if (:atividade is not null) then
     begin
       cont = 0;
       select count(*) from glo_atividades l
       where l.cnpj = :cnpj_destino and l.codigo = :atividade
       into :cont;

       if ((coalesce(:cont,0) = 0) ) then
       begin
         select l.nome from glo_atividades l
         where l.cnpj = :cnpj_origem and l.codigo = :atividade
         INTO :atv_nome;

         insert into glo_atividades(cnpj,codigo,nome)
         values (:cnpj_destino,:atividade, :atv_nome);
       end
     end


    select count(*) from glo_pessoas_fj psa
    where psa.cnpj = :cnpj_destino and psa.codigo = :codigo
    into :cont;
    /*Inserindo registros de pessoas*/
    if (coalesce(:cont,0) = 0) then
    begin
       insert into glo_pessoas_fj(
                                 CNPJ,
                                 CODIGO,
                                 NOME_RAZAO,
                                 FANTASIA,
                                 ATIVIDADE ,
                                 ENDERECO ,
                                 NUMERO ,
                                 COMPLEMENTO ,
                                 BAIRRO ,
                                 CIDADE ,
                                 UF ,
                                 CEP ,
                                 FONE ,
                                 FAX ,
                                 CELULAR ,
                                 PESSOA ,
                                 CPF_CGC ,
                                 RG_IE,
                                 CONTATO,
                                 DT_NASCIMENTO,
                                 DT_CADASTRO,
                                 EMAIL,
                                 OBS,
                                 INSC_MUNIC,
                                 EMISSOR ,
                                 CONTATO1,
                                 CONTATO2,
                                 CONTATO3,
                                 ORDEM ,
                                 REGIAO ,
                                 NFE_EXP)
                               values(:cnpj_destino,
                                 :codigo,
                                 :NOME_RAZAO ,
                                 :FANTASIA,
                                 :ATIVIDADE ,
                                 :ENDERECO ,
                                 :NUMERO ,
                                 :COMPLEMENTO ,
                                 :BAIRRO ,
                                 :CIDADE ,
                                 :UF ,
                                 :CEP ,
                                 :FONE ,
                                 :FAX ,
                                 :CELULAR ,
                                 :PESSOA ,
                                 :CPF_CGC ,
                                 :RG_IE,
                                 :CONTATO,
                                 :DT_NASCIMENTO,
                                 :DT_CADASTRO,
                                 :EMAIL,
                                 :OBS,
                                 :INSC_MUNIC,
                                 :EMISSOR ,
                                 :CONTATO1,
                                 :CONTATO2,
                                 :CONTATO3,
                                 :ORDEM ,
                                 :REGIAO ,
                                 :NFE_EXP
                                 );

    end

    /*Inserindo registro de fornecedor*/
    select  VENDEDOR ,
            FONE_VEN  ,
            FINANCEIRO ,
            FONE_FIN  ,
            REPRESENTANTE,
            FONE_REP   ,
            BANCO_C1 ,
            AGENCIA_C1 ,
            CC_C1    ,
            BANCO_C2  ,
            AGENCIA_C2 ,
            CC_C2     ,
            FORMA_PAGTO  ,
            CONTABILIDADE
    from glo_fornecedores f
    where f.cnpj = :cnpj_origem and f.pessoa_fj = :codigo
    into :F_VENDEDOR ,
         :F_FONE_VEN  ,
         :F_FINANCEIRO ,
         :F_FONE_FIN  ,
         :F_REPRESENTANTE,
         :F_FONE_REP   ,
         :F_BANCO_C1 ,
         :F_AGENCIA_C1 ,
         :F_CC_C1    ,
         :F_BANCO_C2  ,
         :F_AGENCIA_C2 ,
         :F_CC_C2     ,
         :F_FORMA_PAGTO  ,
         :F_CONTABILIDADE;

    insert into glo_fornecedores
               (CNPJ,
                PESSOA_FJ,
                VENDEDOR ,
                FONE_VEN  ,
                FINANCEIRO ,
                FONE_FIN  ,
                REPRESENTANTE,
                FONE_REP   ,
                BANCO_C1 ,
                AGENCIA_C1 ,
                CC_C1    ,
                BANCO_C2  ,
                AGENCIA_C2 ,
                CC_C2     ,
                FORMA_PAGTO  ,
                CONTABILIDADE)
    Values     ( :cnpj_destino,
                 :codigo,
                 :F_VENDEDOR ,
                 :F_FONE_VEN  ,
                 :F_FINANCEIRO ,
                 :F_FONE_FIN  ,
                 :F_REPRESENTANTE,
                 :F_FONE_REP   ,
                 :F_BANCO_C1 ,
                 :F_AGENCIA_C1 ,
                 :F_CC_C1    ,
                 :F_BANCO_C2  ,
                 :F_AGENCIA_C2 ,
                 :F_CC_C2     ,
                 :F_FORMA_PAGTO  ,
                 :F_CONTABILIDADE);


    update glo_pessoas_fj f set f.selecionado = 'N'
    where f.cnpj = :cnpj_origem and f.codigo = :codigo;

  suspend;
end
^

ALTER PROCEDURE PCD_EXP_INSERE_PESSOAS (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO INTEGER,
    TIPO CHAR(1))
AS
DECLARE VARIABLE NOME_RAZAO VARCHAR(50);
DECLARE VARIABLE FANTASIA VARCHAR(50);
DECLARE VARIABLE ATIVIDADE INTEGER;
DECLARE VARIABLE ENDERECO INTEGER;
DECLARE VARIABLE NUMERO VARCHAR(15);
DECLARE VARIABLE COMPLEMENTO VARCHAR(30);
DECLARE VARIABLE BAIRRO INTEGER;
DECLARE VARIABLE CIDADE INTEGER;
DECLARE VARIABLE UF VARCHAR(2);
DECLARE VARIABLE CEP VARCHAR(8);
DECLARE VARIABLE FONE VARCHAR(20);
DECLARE VARIABLE FAX VARCHAR(20);
DECLARE VARIABLE CELULAR VARCHAR(20);
DECLARE VARIABLE PESSOA CHAR(1);
DECLARE VARIABLE CPF_CGC VARCHAR(15);
DECLARE VARIABLE RG_IE VARCHAR(20);
DECLARE VARIABLE CONTATO VARCHAR(30);
DECLARE VARIABLE DT_NASCIMENTO DATE;
DECLARE VARIABLE DT_CADASTRO DATE;
DECLARE VARIABLE EMAIL VARCHAR(80);
DECLARE VARIABLE OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE INSC_MUNIC VARCHAR(15);
DECLARE VARIABLE CONVENIO INTEGER;
DECLARE VARIABLE EMISSOR CHAR(6);
DECLARE VARIABLE CONTATO1 VARCHAR(50);
DECLARE VARIABLE CONTATO2 VARCHAR(50);
DECLARE VARIABLE CONTATO3 VARCHAR(50);
DECLARE VARIABLE ORDEM INTEGER;
DECLARE VARIABLE REGIAO INTEGER;
DECLARE VARIABLE NFE_EXP CHAR(1);
DECLARE VARIABLE SELECIONADO CHAR(1);
DECLARE VARIABLE RG_NOME VARCHAR(50);
DECLARE VARIABLE LG_NOME VARCHAR(50);
DECLARE VARIABLE BR_NOME VARCHAR(50);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CDD_NOME VARCHAR(50);
DECLARE VARIABLE CDD_UF VARCHAR(2);
DECLARE VARIABLE CDD_COD_IBGE VARCHAR(7);
DECLARE VARIABLE CDD_COD_IAGRO INTEGER;
DECLARE VARIABLE UF_NOME VARCHAR(50);
DECLARE VARIABLE ATV_NOME VARCHAR(50);
DECLARE VARIABLE F_VENDEDOR VARCHAR(50);
DECLARE VARIABLE F_FONE_VEN VARCHAR(20);
DECLARE VARIABLE F_FINANCEIRO VARCHAR(50);
DECLARE VARIABLE F_FONE_FIN VARCHAR(20);
DECLARE VARIABLE F_REPRESENTANTE VARCHAR(50);
DECLARE VARIABLE F_FONE_REP VARCHAR(20);
DECLARE VARIABLE F_BANCO_C1 VARCHAR(3);
DECLARE VARIABLE F_AGENCIA_C1 VARCHAR(6);
DECLARE VARIABLE F_CC_C1 VARCHAR(15);
DECLARE VARIABLE F_BANCO_C2 VARCHAR(3);
DECLARE VARIABLE F_AGENCIA_C2 VARCHAR(6);
DECLARE VARIABLE F_CC_C2 VARCHAR(15);
DECLARE VARIABLE F_FORMA_PAGTO INTEGER;
DECLARE VARIABLE F_CONTABILIDADE INTEGER;
DECLARE VARIABLE C_COMPRADOR VARCHAR(50);
DECLARE VARIABLE C_FONE VARCHAR(20);
DECLARE VARIABLE C_CNPJ_VEND VARCHAR(14);
DECLARE VARIABLE C_COD_VEND INTEGER;
DECLARE VARIABLE C_CNPJ_FPAGTO VARCHAR(14);
DECLARE VARIABLE C_COD_FPAGTO INTEGER;
DECLARE VARIABLE C_REQUISICAO CHAR(1);
DECLARE VARIABLE C_DIA_PREF_FAT INTEGER;
DECLARE VARIABLE C_CLASSIF CHAR(1);
DECLARE VARIABLE C_LIMITE_TEMPO INTEGER;
DECLARE VARIABLE C_LIMITE_CREDITO NUMERIC(18,4);
DECLARE VARIABLE C_REFERENCIAS BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE C_OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE C_BLOQUEADO CHAR(1);
DECLARE VARIABLE C_ULT_VENDEDOR INTEGER;
DECLARE VARIABLE C_FREQUENCIA VARCHAR(3);
DECLARE VARIABLE C_ATIVIDADE INTEGER;
DECLARE VARIABLE C_CEP_TRABALHO VARCHAR(8);
DECLARE VARIABLE C_CIDADE_PAIS INTEGER;
DECLARE VARIABLE C_CONJUGE VARCHAR(50);
DECLARE VARIABLE C_DT_NASC_CONJUGE DATE;
DECLARE VARIABLE C_ENDERECO_PAIS INTEGER;
DECLARE VARIABLE C_ENDERECO_TRABALHO INTEGER;
DECLARE VARIABLE C_FONE_LOCAL_CONJUGE VARCHAR(20);
DECLARE VARIABLE C_FONE_TRABALHO VARCHAR(20);
DECLARE VARIABLE C_LOCAL_TRAB_CONJUGE VARCHAR(50);
DECLARE VARIABLE C_LOCAL_TRABALHO VARCHAR(50);
DECLARE VARIABLE C_MAE VARCHAR(50);
DECLARE VARIABLE C_PAI VARCHAR(50);
DECLARE VARIABLE C_RAMAL_FONE_TRAB VARCHAR(3);
DECLARE VARIABLE C_RAMAL_LOCAL_CONJUGE VARCHAR(3);
DECLARE VARIABLE C_RENDA_MENSAL NUMERIC(18,4);
DECLARE VARIABLE C_TEMPO_SERV_CONJUGE VARCHAR(10);
DECLARE VARIABLE C_TEMPO_SERVICO VARCHAR(10);
DECLARE VARIABLE C_CNPJ_CLASSIF VARCHAR(14);
DECLARE VARIABLE C_COD_CLASSIF INTEGER;
DECLARE VARIABLE C_PRAZO INTEGER;
DECLARE VARIABLE C_PERIODO_FATURAMENTO CHAR(1);
DECLARE VARIABLE C_TOLERANCIA_FATURAMENTO INTEGER;
DECLARE VARIABLE C_AJUSTE_AUT_FATURAS CHAR(1);
DECLARE VARIABLE C_TAXA_JUROS NUMERIC(18,4);
DECLARE VARIABLE C_MEDIA_COMPRAS_MES INTEGER;
DECLARE VARIABLE C_NAO_COBR_JUR_ATE INTEGER;
DECLARE VARIABLE C_ASSINA_NOTA CHAR(1);
DECLARE VARIABLE C_CONTROLA_PLACA CHAR(1);
DECLARE VARIABLE C_CONTROLA_KM CHAR(1);
DECLARE VARIABLE C_ADMISSAO DATE;
DECLARE VARIABLE C_ADMISSAO_CONJUGE DATE;
DECLARE VARIABLE C_NUMERO_TRABALHO VARCHAR(15);
DECLARE VARIABLE C_LIMITE_RETIRADAS_DIARIA NUMERIC(18,4);
DECLARE VARIABLE C_VALOR_MAXIMO_RETIRADA NUMERIC(18,4);
DECLARE VARIABLE C_NUMERO_PAIS VARCHAR(15);
DECLARE VARIABLE C_CHEQUE CHAR(1);
DECLARE VARIABLE C_ALIQUOTA_DESCONTO NUMERIC(18,4);
DECLARE VARIABLE C_OPTANTE_SIMPLES CHAR(1);
DECLARE VARIABLE C_CONS_REV CHAR(1);
DECLARE VARIABLE C_SENHA_PDV VARCHAR(6);
DECLARE VARIABLE C_SUB_TRIBUTARIO CHAR(1);
DECLARE VARIABLE C_RET_PIS CHAR(1);
DECLARE VARIABLE C_RET_INSS CHAR(1);
DECLARE VARIABLE C_RET_IRRF CHAR(1);
DECLARE VARIABLE C_BAIRRO INTEGER;
begin
  /*selecionando registros */
    select   NOME_RAZAO ,
             FANTASIA,
             ATIVIDADE ,
             ENDERECO ,
             NUMERO ,
             COMPLEMENTO ,
             BAIRRO ,
             CIDADE ,
             UF ,
             CEP ,
             FONE ,
             FAX ,
             CELULAR ,
             PESSOA ,
             CPF_CGC ,
             RG_IE,
             CONTATO,
             DT_NASCIMENTO,
             DT_CADASTRO,
             EMAIL,
             OBS,
             INSC_MUNIC,
             EMISSOR ,
             CONTATO1,
             CONTATO2,
             CONTATO3,
             ORDEM ,
             REGIAO ,
             NFE_EXP
           from glo_pessoas_fj psa
           where psa.cnpj = :cnpj_origem
           and psa.codigo = :codigo
           into
           :NOME_RAZAO ,
           :FANTASIA,
           :ATIVIDADE ,
           :ENDERECO ,
             :NUMERO ,
             :COMPLEMENTO ,
             :BAIRRO ,
             :CIDADE ,
             :UF ,
             :CEP ,
             :FONE ,
             :FAX ,
             :CELULAR ,
             :PESSOA ,
             :CPF_CGC ,
             :RG_IE,
             :CONTATO,
             :DT_NASCIMENTO,
             :DT_CADASTRO,
             :EMAIL,
             :OBS,
             :INSC_MUNIC,
             :EMISSOR ,
             :CONTATO1,
             :CONTATO2,
             :CONTATO3,
             :ORDEM ,
             :REGIAO ,
             :NFE_EXP;




     /*regiao*/
     if (:regiao is not null) then
     begin
         cont = 0;
         select count(*) from glo_regioes r
         where r.cnpj = :cnpj_destino and r.codigo = :regiao
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select r.nome from glo_regioes r
            where r.cnpj = :cnpj_origem and r.codigo = :regiao
            INTO :rg_nome;
    
            insert into glo_regioes(cnpj,codigo,nome)
            values (:cnpj_destino,:regiao, :rg_nome);
         end
     end

     /*logradouro*/
     if (:endereco is not null) then
     begin
         cont = 0;
         select count(*) from glo_logradouros l
         where l.cnpj = :cnpj_destino and l.codigo = :endereco
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.nome from glo_logradouros l
            where l.cnpj = :cnpj_origem and l.codigo = :endereco
            INTO :lg_nome;
    
            insert into glo_logradouros(cnpj,codigo,nome)
            values (:cnpj_destino,:endereco, :lg_nome);
         end
     end

     /*BAIRRO*/
     if (:bairro is not null) then
     begin
         cont = 0;
         select count(*) from glo_bairros l
         where l.cnpj = :cnpj_destino and l.codigo = :bairro
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.nome from glo_bairros l
            where l.cnpj = :cnpj_origem and l.codigo = :bairro
            INTO :br_nome;
    
            insert into glo_bairros(cnpj,codigo,nome)
            values (:cnpj_destino,:bairro, :br_nome);
         end
     end

     /*cidade*/
     if (:cidade is not null) then
     begin
         cont = 0;
         select count(*) from glo_cidades l
         where l.cnpj = :cnpj_destino and l.codigo = :cidade
         into :cont;

         if ((coalesce(:cont,0) = 0) ) then
         begin
            select l.uf, l.cod_ibge, l.cod_iagro, l.nome from glo_cidades l
            where l.cnpj = :cnpj_origem and l.codigo = :cidade
            INTO :cdd_uf, :cdd_cod_ibge, :cdd_cod_iagro, :cdd_nome;
    
            /*estados*/
            if (:cdd_uf is not null) then
            begin
              cont = 0;
              select count(*) from glo_estados l
              where l.cnpj = :cnpj_destino and l.sigla = :cdd_uf
              into :cont;
    
              if ((coalesce(:cont,0) = 0) ) then
              begin
                select l.nome from glo_estados l
                where l.cnpj = :cnpj_origem and l.sigla = :cdd_uf
                INTO :uf_nome;
        
                insert into glo_estados(cnpj,sigla,nome)
                values (:cnpj_destino,:cdd_uf, :uf_nome);
              end
            end


            insert into glo_cidades(cnpj, codigo, uf, cod_ibge, cod_iagro, nome)
            values (:cnpj_destino,:cidade, :cdd_uf, :cdd_cod_ibge, :cdd_cod_iagro, :cdd_nome);
         end
     end

     /*estados*/
     if (:uf is not null) then
     begin
       cont = 0;
       select count(*) from glo_estados l
       where l.cnpj = :cnpj_destino and l.sigla = :uf
       into :cont;

       if ((coalesce(:cont,0) = 0) ) then
       begin
         select l.nome from glo_estados l
         where l.cnpj = :cnpj_origem and l.sigla = :uf
         INTO :uf_nome;

         insert into glo_estados(cnpj,sigla,nome)
         values (:cnpj_destino,:uf, :uf_nome);
       end
     end

     /*Atividades*/
     if (:atividade is not null) then
     begin
       cont = 0;
       select count(*) from glo_atividades l
       where l.cnpj = :cnpj_destino and l.codigo = :atividade
       into :cont;

       if ((coalesce(:cont,0) = 0) ) then
       begin
         select l.nome from glo_atividades l
         where l.cnpj = :cnpj_origem and l.codigo = :atividade
         INTO :atv_nome;

         insert into glo_atividades(cnpj,codigo,nome)
         values (:cnpj_destino,:atividade, :atv_nome);
       end
     end


    select count(*) from glo_pessoas_fj psa
    where psa.cnpj = :cnpj_destino and psa.codigo = :codigo
    into :cont;
    /*Inserindo registros de pessoas*/
    if (coalesce(:cont,0) = 0) then
    begin
       insert into glo_pessoas_fj(
                                 CNPJ,
                                 CODIGO,
                                 NOME_RAZAO,
                                 FANTASIA,
                                 ATIVIDADE ,
                                 ENDERECO ,
                                 NUMERO ,
                                 COMPLEMENTO ,
                                 BAIRRO ,
                                 CIDADE ,
                                 UF ,
                                 CEP ,
                                 FONE ,
                                 FAX ,
                                 CELULAR ,
                                 PESSOA ,
                                 CPF_CGC ,
                                 RG_IE,
                                 CONTATO,
                                 DT_NASCIMENTO,
                                 DT_CADASTRO,
                                 EMAIL,
                                 OBS,
                                 INSC_MUNIC,
                                 EMISSOR ,
                                 CONTATO1,
                                 CONTATO2,
                                 CONTATO3,
                                 ORDEM ,
                                 REGIAO ,
                                 NFE_EXP)
                               values(:cnpj_destino,
                                 :codigo,
                                 :NOME_RAZAO ,
                                 :FANTASIA,
                                 :ATIVIDADE ,
                                 :ENDERECO ,
                                 :NUMERO ,
                                 :COMPLEMENTO ,
                                 :BAIRRO ,
                                 :CIDADE ,
                                 :UF ,
                                 :CEP ,
                                 :FONE ,
                                 :FAX ,
                                 :CELULAR ,
                                 :PESSOA ,
                                 :CPF_CGC ,
                                 :RG_IE,
                                 :CONTATO,
                                 :DT_NASCIMENTO,
                                 :DT_CADASTRO,
                                 :EMAIL,
                                 :OBS,
                                 :INSC_MUNIC,
                                 :EMISSOR ,
                                 :CONTATO1,
                                 :CONTATO2,
                                 :CONTATO3,
                                 :ORDEM ,
                                 :REGIAO ,
                                 :NFE_EXP
                                 );

    end

    if (:tipo = 'F') then
    begin
        /*Inserindo registro de fornecedor*/
        select  VENDEDOR ,
                FONE_VEN  ,
                FINANCEIRO ,
                FONE_FIN  ,
                REPRESENTANTE,
                FONE_REP   ,
                BANCO_C1 ,
                AGENCIA_C1 ,
                CC_C1    ,
                BANCO_C2  ,
                AGENCIA_C2 ,
                CC_C2     ,
                FORMA_PAGTO  ,
                CONTABILIDADE
        from glo_fornecedores f
        where f.cnpj = :cnpj_origem and f.pessoa_fj = :codigo
        into :F_VENDEDOR ,
             :F_FONE_VEN  ,
             :F_FINANCEIRO ,
             :F_FONE_FIN  ,
             :F_REPRESENTANTE,
             :F_FONE_REP   ,
             :F_BANCO_C1 ,
             :F_AGENCIA_C1 ,
             :F_CC_C1    ,
             :F_BANCO_C2  ,
             :F_AGENCIA_C2 ,
             :F_CC_C2     ,
             :F_FORMA_PAGTO  ,
             :F_CONTABILIDADE;
    
      insert into glo_fornecedores
                   (CNPJ,
                    PESSOA_FJ,
                    VENDEDOR ,
                    FONE_VEN  ,
                    FINANCEIRO ,
                    FONE_FIN  ,
                    REPRESENTANTE,
                    FONE_REP   ,
                    BANCO_C1  ,
                    AGENCIA_C1 ,
                    CC_C1    ,
                    BANCO_C2  ,
                    AGENCIA_C2 ,
                    CC_C2     ,
                    FORMA_PAGTO  ,
                    CONTABILIDADE)
        Values     ( :cnpj_destino,
                     :codigo,
                     :F_VENDEDOR ,
                     :F_FONE_VEN  ,
                     :F_FINANCEIRO ,
                     :F_FONE_FIN  ,
                     :F_REPRESENTANTE,
                     :F_FONE_REP   ,
                     :F_BANCO_C1 ,
                     :F_AGENCIA_C1 ,
                     :F_CC_C1    ,
                     :F_BANCO_C2  ,
                     :F_AGENCIA_C2  ,
                     :F_CC_C2     ,
                     :F_FORMA_PAGTO  ,
                     :F_CONTABILIDADE);

    end
    else if (:tipo <> 'F') then
    begin
       select
            COMPRADOR,
            FONE    ,
            CNPJ_VEND,
            COD_VEND ,
            CNPJ_FPAGTO,
            COD_FPAGTO ,
            REQUISICAO ,
            DIA_PREF_FAT,
            CLASSIF    ,
            LIMITE_TEMPO,
            LIMITE_CREDITO,
            REFERENCIAS   ,
            OBS           ,
            BLOQUEADO     ,
            ULT_VENDEDOR  ,
            FREQUENCIA    ,
            ATIVIDADE     ,
            CEP_TRABALHO  ,
            CIDADE_PAIS   ,
            CONJUGE       ,
            DT_NASC_CONJUGE ,
            ENDERECO_PAIS   ,
            ENDERECO_TRABALHO,
            FONE_LOCAL_CONJUGE,
            FONE_TRABALHO     ,
            LOCAL_TRAB_CONJUGE,
            LOCAL_TRABALHO  ,
            MAE            ,
            PAI            ,
            RAMAL_FONE_TRAB,
            RAMAL_LOCAL_CONJUGE,
            RENDA_MENSAL       ,
            TEMPO_SERV_CONJUGE ,
            TEMPO_SERVICO    ,
            CNPJ_CLASSIF     ,
            COD_CLASSIF      ,
            PRAZO            ,
            PERIODO_FATURAMENTO,
            TOLERANCIA_FATURAMENTO,
            AJUSTE_AUT_FATURAS    ,
            TAXA_JUROS            ,
            MEDIA_COMPRAS_MES   ,
            NAO_COBR_JUR_ATE    ,
            ASSINA_NOTA ,
            CONTROLA_PLACA,
            CONTROLA_KM         ,
            ADMISSAO           ,
            ADMISSAO_CONJUGE   ,
            NUMERO_TRABALHO    ,
            LIMITE_RETIRADAS_DIARIA ,
            VALOR_MAXIMO_RETIRADA   ,
            NUMERO_PAIS             ,
            CHEQUE                  ,
            ALIQUOTA_DESCONTO       ,
            OPTANTE_SIMPLES         ,
            CONS_REV                ,
            SENHA_PDV               ,
            SUB_TRIBUTARIO ,
            RET_PIS       ,
            RET_INSS   ,
            RET_IRRF   ,
            BAIRRO
            from glo_clientes cli
            where cli.cnpj = :cnpj_origem and cli.pessoa_fj = :codigo
            into :C_COMPRADOR,
            :C_FONE    ,
            :C_CNPJ_VEND,
            :C_COD_VEND ,
            :C_CNPJ_FPAGTO,
            :C_COD_FPAGTO ,
            :C_REQUISICAO ,
            :C_DIA_PREF_FAT,
            :C_CLASSIF    ,
            :C_LIMITE_TEMPO,
            :C_LIMITE_CREDITO,
            :C_REFERENCIAS   ,
            :C_OBS           ,
            :C_BLOQUEADO     ,
            :C_ULT_VENDEDOR  ,
            :C_FREQUENCIA    ,
            :C_ATIVIDADE     ,
            :C_CEP_TRABALHO  ,
            :C_CIDADE_PAIS   ,
            :C_CONJUGE       ,
            :C_DT_NASC_CONJUGE ,
            :C_ENDERECO_PAIS   ,
            :C_ENDERECO_TRABALHO,
            :C_FONE_LOCAL_CONJUGE,
            :C_FONE_TRABALHO     ,
            :C_LOCAL_TRAB_CONJUGE,
            :C_LOCAL_TRABALHO  ,
            :C_MAE            ,
            :C_PAI            ,
            :C_RAMAL_FONE_TRAB,
            :C_RAMAL_LOCAL_CONJUGE,
            :C_RENDA_MENSAL       ,
            :C_TEMPO_SERV_CONJUGE ,
            :C_TEMPO_SERVICO    ,
            :C_CNPJ_CLASSIF     ,
            :C_COD_CLASSIF      ,
            :C_PRAZO            ,
            :C_PERIODO_FATURAMENTO,
            :C_TOLERANCIA_FATURAMENTO,
            :C_AJUSTE_AUT_FATURAS    ,
            :C_TAXA_JUROS            ,
            :C_MEDIA_COMPRAS_MES   ,
            :C_NAO_COBR_JUR_ATE    ,
            :C_ASSINA_NOTA ,
            :C_CONTROLA_PLACA,
            :C_CONTROLA_KM         ,
            :C_ADMISSAO           ,
            :C_ADMISSAO_CONJUGE   ,
            :C_NUMERO_TRABALHO    ,
            :C_LIMITE_RETIRADAS_DIARIA ,
            :C_VALOR_MAXIMO_RETIRADA   ,
            :C_NUMERO_PAIS             ,
            :C_CHEQUE                  ,
            :C_ALIQUOTA_DESCONTO       ,
            :C_OPTANTE_SIMPLES         ,
            :C_CONS_REV                ,
            :C_SENHA_PDV               ,
            :C_SUB_TRIBUTARIO ,
            :C_RET_PIS       ,
            :C_RET_INSS   ,
            :C_RET_IRRF   ,
            :C_BAIRRO;
    end

    update glo_pessoas_fj f set f.selecionado = 'N'
    where f.cnpj = :cnpj_origem and f.codigo = :codigo;


  suspend;
end
^

ALTER PROCEDURE PCD_EXP_INSERE_PRODUTO (
    CNPJ_ORIGEM VARCHAR(14),
    CNPJ_DESTINO VARCHAR(14),
    CODIGO VARCHAR(15))
AS
DECLARE VARIABLE CODIGO_2 VARCHAR(15);
DECLARE VARIABLE CNPJ_AGRUP VARCHAR(14);
DECLARE VARIABLE COD_AGRUP VARCHAR(14);
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE MARCA INTEGER;
DECLARE VARIABLE NOME_MARCA VARCHAR(50);
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUBGRUPO INTEGER;
DECLARE VARIABLE REDUCAO INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE UND_PRIMARIA VARCHAR(4);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE QTDADE_1 NUMERIC(18,4);
DECLARE VARIABLE LOCALIZACAO_1 VARCHAR(30);
DECLARE VARIABLE LOCALIZACAO_2 VARCHAR(30);
DECLARE VARIABLE LOCALIZACAO_3 VARCHAR(30);
DECLARE VARIABLE NEG_QTDADE_2 CHAR(1);
DECLARE VARIABLE QTDADE_MIN INTEGER;
DECLARE VARIABLE QTDADE_MAX INTEGER;
DECLARE VARIABLE COMPLEMENTO_NF CHAR(1);
DECLARE VARIABLE MARGEM_BRUTA NUMERIC(18,4);
DECLARE VARIABLE PRC_REPOS NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO_ANT NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO_MED NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA_MED NUMERIC(18,4);
DECLARE VARIABLE ALIQUOTA_ECF CHAR(5);
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE PESO_LIQ NUMERIC(18,4);
DECLARE VARIABLE PERC_FRETE NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE VOLUME NUMERIC(18,4);
DECLARE VARIABLE PROD_PESAVEL CHAR(1);
DECLARE VARIABLE ETIQUETA_ENT CHAR(1);
DECLARE VARIABLE ATIVO CHAR(1);
DECLARE VARIABLE ULTIMO_FORNECEDOR INTEGER;
DECLARE VARIABLE FORNECEDOR INTEGER;
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE PRC_CUSTO_CODIF VARCHAR(15);
DECLARE VARIABLE CODIGO_INTERNO INTEGER;
DECLARE VARIABLE DT_ULT_ATU_PRECO DATE;
DECLARE VARIABLE CUSTO_AQUISICAO NUMERIC(18,4);
DECLARE VARIABLE VENDE_FRACIONADO CHAR(1);
DECLARE VARIABLE QNTDE_EXPOSTA NUMERIC(18,4);
DECLARE VARIABLE POSSUI_LOTE CHAR(1);
DECLARE VARIABLE QNTDE_MAXIMA_VENDA NUMERIC(18,4);
DECLARE VARIABLE PIS CHAR(1);
DECLARE VARIABLE COFINS CHAR(1);
DECLARE VARIABLE COM_VENDA_VLR NUMERIC(18,4);
DECLARE VARIABLE COM_VENDA_PCT NUMERIC(18,4);
DECLARE VARIABLE PARTICIP_LUCRO NUMERIC(18,4);
DECLARE VARIABLE NAO_COBR_JUR_ATE INTEGER;
DECLARE VARIABLE PREVISAO_ENTREGA DATE;
DECLARE VARIABLE ATUALIZA_ARQ_EXTERNO CHAR(1);
DECLARE VARIABLE SERVICO CHAR(1);
DECLARE VARIABLE VALIDADE INTEGER;
DECLARE VARIABLE CUSTO_INDEXADO NUMERIC(18,4);
DECLARE VARIABLE COMPLEMENTO VARCHAR(100);
DECLARE VARIABLE ATUALIZAR CHAR(1);
DECLARE VARIABLE EST_MIN NUMERIC(18,4);
DECLARE VARIABLE EST_MAX NUMERIC(18,4);
DECLARE VARIABLE MODELO INTEGER;
DECLARE VARIABLE NOME_MODELO VARCHAR(80);
DECLARE VARIABLE SERIE VARCHAR(30);
DECLARE VARIABLE DEBITA_ICMS CHAR(1);
DECLARE VARIABLE SECAO INTEGER;
DECLARE VARIABLE NFE_EXP CHAR(1);
DECLARE VARIABLE SELECIONADO CHAR(1);
DECLARE VARIABLE QNTDE_MINIMA_VENDA NUMERIC(18,4);
DECLARE VARIABLE VALIDA_MULT_QTDE_MIN CHAR(1);
DECLARE VARIABLE FATOR_CONVERSAO NUMERIC(18,4);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CONT2 INTEGER;
DECLARE VARIABLE MR_NOME VARCHAR(50);
DECLARE VARIABLE GR_NOME VARCHAR(50);
DECLARE VARIABLE GR_BASE INTEGER;
DECLARE VARIABLE GR_MINIMO INTEGER;
DECLARE VARIABLE GR_MAXIMO INTEGER;
DECLARE VARIABLE SB_SUBGRUPO INTEGER;
DECLARE VARIABLE SB_NOME VARCHAR(50);
DECLARE VARIABLE SB_DESCONTO_MAX NUMERIC(18,4);
DECLARE VARIABLE SB_DIGITA_PRC CHAR(1);
DECLARE VARIABLE SB_COMPRAS_C INTEGER;
DECLARE VARIABLE SB_COMPRAS_D INTEGER;
DECLARE VARIABLE SB_TRANSFERENCIA_C INTEGER;
DECLARE VARIABLE SB_TRANSFERENCIA_D INTEGER;
DECLARE VARIABLE SB_VENDAS_C INTEGER;
DECLARE VARIABLE SB_VENDAS_D INTEGER;
DECLARE VARIABLE SB_ESTOQUE INTEGER;
DECLARE VARIABLE SB_ESTOQUE_INI INTEGER;
DECLARE VARIABLE SB_ESTOQUE_FIM INTEGER;
DECLARE VARIABLE RD_PERC_ESTADUAL NUMERIC(18,4);
DECLARE VARIABLE RD_PERC_INTERESTADUAL NUMERIC(18,4);
DECLARE VARIABLE RD_MENSAGEM_NF VARCHAR(80);
DECLARE VARIABLE RD_MENSAGEM_NF_IE VARCHAR(80);
DECLARE VARIABLE RD_PERC_CONTRIBUINTE NUMERIC(18,4);
DECLARE VARIABLE UN_NOME VARCHAR(50);
DECLARE VARIABLE UN_UNIDADES NUMERIC(18,4);
DECLARE VARIABLE MDL_NOME VARCHAR(50);
DECLARE VARIABLE SECAO_NOME VARCHAR(50);
DECLARE VARIABLE GR_GRADE VARCHAR(4);
DECLARE VARIABLE GR_MATERIAL INTEGER;
DECLARE VARIABLE GR_COR INTEGER;
DECLARE VARIABLE GR_ULTIMA_COMPRA DATE;
DECLARE VARIABLE GR_QTDADE_COMPRA NUMERIC(18,4);
DECLARE VARIABLE GR_ULTIMA_VENDA DATE;
DECLARE VARIABLE GR_QTDADE_VENDA NUMERIC(18,4);
DECLARE VARIABLE GR_ESTOQUE NUMERIC(18,4);
DECLARE VARIABLE GR_NOME_MATERIAL VARCHAR(50);
DECLARE VARIABLE GR_NOME_COR VARCHAR(50);
DECLARE VARIABLE GR_PERFIL INTEGER;
DECLARE VARIABLE GR_NOME_PERFIL VARCHAR(50);
DECLARE VARIABLE MAT_NOME VARCHAR(50);
DECLARE VARIABLE COR_NOME VARCHAR(50);
DECLARE VARIABLE GN_NUMERO VARCHAR(6);
DECLARE VARIABLE GN_ORDEM INTEGER;
DECLARE VARIABLE PF_CODIGO INTEGER;
DECLARE VARIABLE PF_NOME VARCHAR(50);
DECLARE VARIABLE PF_INICIAL INTEGER;
DECLARE VARIABLE PF_FINAL INTEGER;
DECLARE VARIABLE PF_INTERVALO INTEGER;
DECLARE VARIABLE PFA_CODIGO VARCHAR(6);
DECLARE VARIABLE PFA_ORDEM INTEGER;
begin

    /*selecionando registros */
    select prd.CODIGO_2 ,                            /*1 */
           prd.CNPJ_AGRUP,                           /*2 */
           prd.COD_AGRUP,                            /*3 */
           prd.NOME,

                           /*4 */
           prd.MARCA,/**/                            /*5 */
           prd.NOME_MARCA,                           /*6 */
           prd.GRUPO,                                /*7 */
           prd.SUBGRUPO,                             /*8 */
           prd.REDUCAO,                              /*9 */
           prd.UNIDADE,                              /*10 */
           prd.UND_PRIMARIA,                         /*11 */
           prd.CTE,                                  /*12 */
           prd.CTIE,                                /*13 */
           prd.LOCALIZACAO_1,                       /*16 */
           prd.LOCALIZACAO_2,                       /*17 */
           prd.LOCALIZACAO_3,                       /*18 */
           prd.NEG_QTDADE_2,                        /*19 */
           prd.QTDADE_MIN,                          /*20 */
           prd.QTDADE_MAX,                          /*21 */
           prd.COMPLEMENTO_NF,                      /*22 */
           prd.MARGEM_BRUTA,                        /*23 */
           prd.PRC_REPOS,                           /*24 */
           prd.PRC_CUSTO_ANT,                      /*25 */
           prd.PRC_CUSTO_MED,                      /*26 */
           prd.PRC_VENDA,                          /*27 */
           prd.PRC_VENDA_MED,                      /*28 */
           prd.ALIQUOTA_ECF,                       /*29 */
           prd.ORIGEM,                             /*30 */
           prd.PESO_LIQ,                          /*31 */
           prd.PERC_FRETE,                        /*32 */
           prd.IPI,                               /*33 */
           prd.VOLUME,                           /*34 */
           prd.PROD_PESAVEL,                     /*35 */
           prd.ETIQUETA_ENT,                     /*36 */
           prd.ATIVO,                           /*37 */
           prd.ULTIMO_FORNECEDOR,               /*38 */
           prd.FORNECEDOR,                      /*39 */
           prd.SUBUNIDADE,                     /*40 */
           prd.PRC_CUSTO_CODIF,                 /*41 */
           prd.CODIGO_INTERNO,                 /* 42*/
           prd.DT_ULT_ATU_PRECO,               /*43 */
           prd.CUSTO_AQUISICAO,                /*44 */
           prd.VENDE_FRACIONADO,               /*45 */
           prd.QNTDE_EXPOSTA,                  /*46 */
           prd.POSSUI_LOTE,                   /*47 */
           prd.QNTDE_MAXIMA_VENDA,            /*48 */
           prd.PIS,                           /*49 */
           prd.COFINS,                        /*50 */
           prd.COM_VENDA_VLR,                /*51 */
           prd.COM_VENDA_PCT,                /*52 */
           prd.PARTICIP_LUCRO,               /*53 */
           prd.NAO_COBR_JUR_ATE,             /*54 */
           prd.PREVISAO_ENTREGA,            /*55 */

           prd.ATUALIZA_ARQ_EXTERNO,        /*57 */
           prd.SERVICO,                    /*58 */
           prd.VALIDADE,                   /*59 */
           prd.CUSTO_INDEXADO,            /*60 */
           prd.COMPLEMENTO,               /*61 */
           prd.ATUALIZAR,                 /*62 */
           prd.EST_MIN,                  /*63 */
           prd.EST_MAX,                  /*64 */
           prd.MODELO,                   /*65 */
           prd.NOME_MODELO,             /*66 */
           prd.SERIE,                  /*67 */
           prd.DEBITA_ICMS,            /*68 */
           prd.SECAO,                  /*69 */
           prd.NFE_EXP,               /*70 */
           prd.SELECIONADO,           /*71 */
           prd.QNTDE_MINIMA_VENDA,    /*72 */
           prd.VALIDA_MULT_QTDE_MIN,  /*73 */
           prd.FATOR_CONVERSAO        /*74 */
           from est_produtos prd
           where prd.cnpj = :cnpj_origem
           and prd.codigo = :codigo
           into
           :CODIGO_2 ,   /*1*/
           :CNPJ_AGRUP,  /*2 */
           :COD_AGRUP,   /* 3*/
           :NOME,        /* 4*/
           :MARCA,       /*5 */
           :NOME_MARCA,  /*6 */
           :GRUPO,       /*7 */
           :SUBGRUPO,    /* 8*/
           :REDUCAO,     /*9 */
           :UNIDADE,     /*10 */
           :UND_PRIMARIA,/*11 */
           :CTE,         /* 12*/
           :CTIE,        /* 13*/
           :LOCALIZACAO_1,/*16 */
           :LOCALIZACAO_2, /*17 */
           :LOCALIZACAO_3,  /*18 */
           :NEG_QTDADE_2,    /*19 */
           :QTDADE_MIN,       /*20 */
           :QTDADE_MAX,        /*21 */
           :COMPLEMENTO_NF,    /*22 */
           :MARGEM_BRUTA,      /*23 */
           :PRC_REPOS,         /*24 */
           :PRC_CUSTO_ANT,     /*25 */
           :PRC_CUSTO_MED,     /*26 */
           :PRC_VENDA,         /*27 */
           :PRC_VENDA_MED,     /*28 */
           :ALIQUOTA_ECF,      /*29 */
           :ORIGEM,            /*30 */
           :PESO_LIQ,           /*31 */
           :PERC_FRETE,         /*32 */
           :IPI,                /*33 */
           :VOLUME,             /*34 */
           :PROD_PESAVEL,       /*35 */
           :ETIQUETA_ENT,       /*36 */
           :ATIVO,              /*37 */
           :ULTIMO_FORNECEDOR,  /*38 */
           :FORNECEDOR,         /*39 */
           :SUBUNIDADE,         /*40 */
           :PRC_CUSTO_CODIF,    /*41 */
           :CODIGO_INTERNO,     /*42 */
           :DT_ULT_ATU_PRECO,   /*43 */
           :CUSTO_AQUISICAO,    /*44 */
           :VENDE_FRACIONADO,   /*45 */
           :QNTDE_EXPOSTA,      /*46 */
           :POSSUI_LOTE,         /*47 */
           :QNTDE_MAXIMA_VENDA,   /*48 */
           :PIS,                  /*49 */
           :COFINS,               /*50 */
           :COM_VENDA_VLR,        /*51 */
           :COM_VENDA_PCT,        /*52 */
           :PARTICIP_LUCRO,       /*53 */
           :NAO_COBR_JUR_ATE,     /*54 */
           :PREVISAO_ENTREGA,     /*55 */
           :ATUALIZA_ARQ_EXTERNO, /*56   bo*/
           :SERVICO,               /*57 */
           :VALIDADE,              /*58 */
           :CUSTO_INDEXADO,        /*59 */
           :COMPLEMENTO,           /*60 */
           :ATUALIZAR,             /*61 */
           :EST_MIN,               /*62 */
           :EST_MAX,               /*63 */
           :MODELO,                /*64 */
           :NOME_MODELO,           /*65 */
           :SERIE,                 /*66 */
           :DEBITA_ICMS,           /*67 */
           :SECAO,                 /*68 */
           :NFE_EXP,               /*69 */
           :SELECIONADO,           /*70 */
           :QNTDE_MINIMA_VENDA,     /*71 */
           :VALIDA_MULT_QTDE_MIN,    /*72 */
           :FATOR_CONVERSAO;         /*73 */




     /*             inserindo marcas                  */
     if (:marca is not null) then
     begin
         cont = 0;
         select count(*) from est_marcas mr
         where mr.cnpj = :cnpj_destino and mr.codigo = :marca
         into :cont;
    
         cont2 = 0;
         select count(*) from est_marcas mr
         where mr.cnpj = :cnpj_origem and mr.codigo = :marca
         into :cont2;

         if ((coalesce(:cont,0) = 0) and (cont2 > 0)) then
         begin
            select mr.nome from est_marcas mr
            where mr.cnpj = :cnpj_origem and mr.codigo = :marca
            INTO :mr_nome;
    
            insert into est_marcas(cnpj,codigo,nome)
            values (:cnpj_destino,:marca, :mr_nome);
         end
     end

     /*inserindo grupos                  */
     if (:grupo is not null) then
     begin
         cont = 0;
         select count(*) from est_grupos gr
         where gr.cnpj = :cnpj_destino and gr.codigo = :grupo
         into :cont;

         cont2 = 0;
         select count(*) from est_grupos gr
         where gr.cnpj = :cnpj_origem and gr.codigo = :grupo
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (cont2 >0)) then
         begin
            select gr.nome,
                   BASE ,
                   MINIMO,
                   MAXIMO
            from est_grupos gr
            where gr.cnpj = :cnpj_origem and gr.codigo = :grupo
            into :gr_nome,
                 :GR_BASE ,
                 :GR_MINIMO,
                 :GR_MAXIMO;
    
            insert into est_grupos(cnpj,codigo,nome,BASE ,
                   MINIMO,
                   MAXIMO)
            values (:cnpj_destino,:grupo, :gr_nome,
                   :GR_BASE ,
                   :GR_MINIMO,
                   :GR_MAXIMO);
         end
     end
     /*             inserindo sub_grupos                  */
     if (:subgrupo is not null) then
     begin
         cont = 0;
         select count(*) from est_subgrupos sgr
         where sgr.cnpj = :cnpj_destino and sgr.subgrupo = :subgrupo and sgr.grupo = :grupo
         into :cont;

         cont2 = 0;
         select count(*) from est_subgrupos sgr
         where sgr.cnpj = :cnpj_origem and sgr.subgrupo = :subgrupo and sgr.grupo = :grupo
         into :cont2;

         if ((coalesce(:cont,0) = 0) and (:cont2 >0)) then
         begin
            select  NOME ,
                    DESCONTO_MAX    ,
                    DIGITA_PRC      ,
                    COMPRAS_C       ,
                    COMPRAS_D       ,
                    TRANSFERENCIA_C ,
                    TRANSFERENCIA_D ,
                    VENDAS_C    ,
                    VENDAS_D    ,
                    ESTOQUE     ,
                    ESTOQUE_INI ,
                    ESTOQUE_FIM
            from est_subgrupos sgr
            where sgr.cnpj = :cnpj_origem and sgr.subgrupo = :subgrupo and sgr.grupo = :grupo
            INTO    :SB_NOME ,
                    :SB_DESCONTO_MAX    ,
                    :SB_DIGITA_PRC      ,
                    :SB_COMPRAS_C       ,
                    :SB_COMPRAS_D       ,
                    :SB_TRANSFERENCIA_C ,
                    :SB_TRANSFERENCIA_D ,
                    :SB_VENDAS_C    ,
                    :SB_VENDAS_D    ,
                    :SB_ESTOQUE     ,
                    :SB_ESTOQUE_INI ,
                    :SB_ESTOQUE_FIM;
    
            insert into est_subgrupos(cnpj,
                                      subgrupo,
                                      grupo,
                                      NOME ,
                                      DESCONTO_MAX    ,
                                      DIGITA_PRC      ,
                                      COMPRAS_C       ,
                                      COMPRAS_D       ,
                                      TRANSFERENCIA_C ,
                                      TRANSFERENCIA_D ,
                                      VENDAS_C    ,
                                      VENDAS_D    ,
                                      ESTOQUE     ,
                                      ESTOQUE_INI ,
                                      ESTOQUE_FIM)
            values (:cnpj_destino,
                    :subgrupo,
                    :grupo,
                    :SB_NOME ,
                    :SB_DESCONTO_MAX    ,
                    :SB_DIGITA_PRC      ,
                    :SB_COMPRAS_C       ,
                    :SB_COMPRAS_D       ,
                    :SB_TRANSFERENCIA_C ,
                    :SB_TRANSFERENCIA_D ,
                    :SB_VENDAS_C    ,
                    :SB_VENDAS_D    ,
                    :SB_ESTOQUE     ,
                    :SB_ESTOQUE_INI ,
                    :SB_ESTOQUE_FIM);
         end
     end

    /*             inserindo reduções                 */
     if (:reducao is not null) then
     begin
         cont = 0;
         select count(*) from est_reducoes rd
         where rd.cnpj = :cnpj_destino and rd.codigo = :reducao
         into :cont;

         cont2 = 0;
         select count(*) from est_reducoes rd
         where rd.cnpj = :cnpj_origem and rd.codigo = :reducao
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (:cont2>0)) then
         begin
            select PERC_ESTADUAL,
                   PERC_INTERESTADUAL ,
                   MENSAGEM_NF,
                   MENSAGEM_NF_IE,
                   PERC_CONTRIBUINTE
            from est_reducoes rd
            where rd.cnpj = :cnpj_origem and rd.codigo = :reducao
            INTO :RD_PERC_ESTADUAL,
                 :RD_PERC_INTERESTADUAL ,
                 :RD_MENSAGEM_NF,
                 :RD_MENSAGEM_NF_IE,
                 :RD_PERC_CONTRIBUINTE;
    
    
            insert into est_reducoes(CNPJ,
                                     CODIGO,
                                     PERC_ESTADUAL,
                                     PERC_INTERESTADUAL ,
                                     MENSAGEM_NF,
                                     MENSAGEM_NF_IE,
                                     PERC_CONTRIBUINTE)
            values (:cnpj_destino,
                    :reducao,
                    :RD_PERC_ESTADUAL,
                    :RD_PERC_INTERESTADUAL ,
                    :RD_MENSAGEM_NF,
                    :RD_MENSAGEM_NF_IE,
                    :RD_PERC_CONTRIBUINTE);
         end
      end

    /* Inserindo unidades*/
    if (:unidade is not null) then
     begin
         cont = 0;
         select count(*) from est_unidades un
         where un.cnpj = :cnpj_destino and un.sigla = :unidade
         into :cont;

         cont2 = 0;
         select count(*) from est_unidades un
         where un.cnpj = :cnpj_origem and un.sigla = :unidade
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (cont2 >0)) then
         begin
            select un.nome,
                   UN.unidades from est_unidades un
            where un.cnpj = :cnpj_origem and un.sigla = :unidade
            INTO :un_nome,
                 :un_unidades;
    
            insert into est_unidades(cnpj,sigla,unidades,nome)
            values (:cnpj_destino,:unidade, :un_unidades, :un_nome);
         end
     end

     /* Inserindo unidades primarias*/
    if (:und_primaria is not null) then
    begin
         cont = 0;
         select count(*) from est_unidades un
         where un.cnpj = :cnpj_destino and un.sigla = :und_primaria
         into :cont;

         cont2 = 0;
         select count(*) from est_unidades un
         where un.cnpj = :cnpj_origem and un.sigla = :und_primaria
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (:cont2 >0)) then
         begin
            select un.nome,
                   UN.unidades from est_unidades un
            where un.cnpj = :cnpj_origem and un.sigla = :und_primaria
            INTO :un_nome,
                 :un_unidades;
    
            insert into est_unidades(cnpj,sigla,unidades,nome)
            values (:cnpj_destino,:und_primaria, :un_unidades, :un_nome);
         end
     end

    /*modelo     */
    if (:modelo is not null) then
    begin
         cont = 0;
         select count(*) from glo_modelo_propriedade mdl
         where mdl.cnpj = :cnpj_destino and mdl.codigo = :modelo
         into :cont;

         cont2 = 0;
         select count(*) from glo_modelo_propriedade mdl
         where mdl.cnpj = :cnpj_origem and mdl.codigo = :modelo
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (:cont2 > 0)) then
         begin
            select mdl.nome from glo_modelo_propriedade mdl
            where mdl.cnpj = :cnpj_origem and mdl.codigo = :modelo
            INTO :mdl_nome;
    
            insert into glo_modelo_propriedade(cnpj, codigo, nome)
            values (:cnpj_destino,:modelo, :nome);
         end
     end

     /*inserindo secao     */
    if (:secao is not null) then
    begin
         cont = 0;
         select count(*) from est_secao s
         where s.cnpj = :cnpj_destino and s.cod_secao = :secao
         into :cont;

         cont2 = 0;
         select count(*) from est_secao s
         where s.cnpj = :cnpj_origem and s.cod_secao = :secao
         into :cont2;
    
         if ((coalesce(:cont,0) = 0) and (:cont2 > 0)) then
         begin
            select s.nome from est_secao s
            where s.cnpj = :cnpj_origem and s.cod_secao = :secao
            INTO :secao_nome;
    
            insert into est_secao(cnpj, cod_secao, nome)
            values (:cnpj_destino,:secao, :secao_nome);
         end
     end


    /*Inserindo Registros*/
    insert into est_produtos  (
                               CNPJ,
                               CODIGO,
                               CODIGO_2 ,                            /*1 */
                               CNPJ_AGRUP,                           /*2 */
                               COD_AGRUP,                            /*3 */
                               NOME,                                 /*4 */
                               MARCA,/**/                            /*5 */
                               NOME_MARCA,                           /*6 */
                               GRUPO,                                /*7 */
                               SUBGRUPO,                             /*8 */
                               REDUCAO,                              /*9 */
                               UNIDADE,                              /*10 */
                               UND_PRIMARIA,                         /*11 */
                               CTE,                                  /*12 */
                               CTIE,                                /*13 */
                               LOCALIZACAO_1,                       /*16 */
                               LOCALIZACAO_2,                       /*17 */
                               LOCALIZACAO_3,                       /*18 */
                               NEG_QTDADE_2,                        /*19 */
                               QTDADE_MIN,                          /*20 */
                               QTDADE_MAX,                          /*21 */
                               COMPLEMENTO_NF,                      /*22 */
                               MARGEM_BRUTA,                        /*23 */
                               PRC_REPOS,                           /*24 */
                               PRC_CUSTO_ANT,                      /*25 */
                               PRC_CUSTO_MED,                      /*26 */
                               PRC_VENDA,                          /*27 */
                               PRC_VENDA_MED,                      /*28 */
                               ALIQUOTA_ECF,                       /*29 */
                               ORIGEM,                             /*30 */
                               PESO_LIQ,                          /*31 */
                               PERC_FRETE,                        /*32 */
                               IPI,                               /*33 */
                               VOLUME,                           /*34 */
                               PROD_PESAVEL,                     /*35 */
                               ETIQUETA_ENT,                     /*36 */
                               ATIVO,                           /*37 */
                               ULTIMO_FORNECEDOR,               /*38 */
                               FORNECEDOR,                      /*39 */
                               SUBUNIDADE,                     /*40 */
                             /*  PRC_CUSTO_CODIF,                 41 */
                               CODIGO_INTERNO,                 /* 42*/
                               DT_ULT_ATU_PRECO,               /*43 */
                               CUSTO_AQUISICAO,                /*44 */
                               VENDE_FRACIONADO,               /*45 */
                               QNTDE_EXPOSTA,                  /*46 */
                               POSSUI_LOTE,                   /*47 */
                               QNTDE_MAXIMA_VENDA,            /*48 */
                               PIS,                           /*49 */
                               COFINS,                        /*50 */
                               COM_VENDA_VLR,                /*51 */
                               COM_VENDA_PCT,                /*52 */
                               PARTICIP_LUCRO,               /*53 */
                               NAO_COBR_JUR_ATE,             /*54 */
                               PREVISAO_ENTREGA,            /*55 */
                    
                               ATUALIZA_ARQ_EXTERNO,        /*57 */
                               SERVICO,                    /*58 */
                               VALIDADE,                   /*59 */
                               CUSTO_INDEXADO,            /*60 */
                               COMPLEMENTO,               /*61 */
                               ATUALIZAR,                 /*62 */
                               EST_MIN,                  /*63 */
                               EST_MAX,                  /*64 */
                               MODELO,                   /*65 */
                               NOME_MODELO,             /*66 */
                               SERIE,                  /*67 */
                               DEBITA_ICMS,            /*68 */
                               SECAO,                  /*69 */
                               NFE_EXP,               /*70 */
                               SELECIONADO,           /*71 */
                               QNTDE_MINIMA_VENDA,    /*72 */
                               VALIDA_MULT_QTDE_MIN,  /*73 */
                               FATOR_CONVERSAO        /*74 */
                             )
                       values( :cnpj_destino,
                               :codigo,
                               :CODIGO_2 ,   /*1*/
                               :CNPJ_AGRUP,  /*2 */
                               :COD_AGRUP,   /* 3*/
                               :NOME,        /* 4*/
                               :MARCA,       /*5 */
                               :NOME_MARCA,  /*6 */
                               :GRUPO,       /*7 */
                               :SUBGRUPO,    /* 8*/
                               :REDUCAO,     /*9 */
                               :UNIDADE,     /*10 */
                               :UND_PRIMARIA,/*11 */
                               :CTE,         /* 12*/
                               :CTIE,        /* 13*/
                               :LOCALIZACAO_1,/*16 */
                               :LOCALIZACAO_2, /*17 */
                               :LOCALIZACAO_3,  /*18 */
                               :NEG_QTDADE_2,    /*19 */
                               :QTDADE_MIN,       /*20 */
                               :QTDADE_MAX,        /*21 */
                               :COMPLEMENTO_NF,    /*22 */
                               :MARGEM_BRUTA,      /*23 */
                               :PRC_REPOS,         /*24 */
                               :PRC_CUSTO_ANT,     /*25 */
                               :PRC_CUSTO_MED,     /*26 */
                               :PRC_VENDA,         /*27 */
                               :PRC_VENDA_MED,     /*28 */
                               :ALIQUOTA_ECF,      /*29 */
                               :ORIGEM,            /*30 */
                               :PESO_LIQ,           /*31 */
                               :PERC_FRETE,         /*32 */
                               :IPI,                /*33 */
                               :VOLUME,             /*34 */
                               :PROD_PESAVEL,       /*35 */
                               :ETIQUETA_ENT,       /*36 */
                               :ATIVO,              /*37 */
                               :ULTIMO_FORNECEDOR,  /*38 */
                               :FORNECEDOR,         /*39 */
                               :SUBUNIDADE,         /*40 */
                            /*   :PRC_CUSTO_CODIF,    41 */
                               :CODIGO_INTERNO,     /*42 */
                               :DT_ULT_ATU_PRECO,   /*43 */
                               :CUSTO_AQUISICAO,    /*44 */
                               :VENDE_FRACIONADO,   /*45 */
                               :QNTDE_EXPOSTA,      /*46 */
                               :POSSUI_LOTE,         /*47 */
                               :QNTDE_MAXIMA_VENDA,   /*48 */
                               :PIS,                  /*49 */
                               :COFINS,               /*50 */
                               :COM_VENDA_VLR,        /*51 */
                               :COM_VENDA_PCT,        /*52 */
                               :PARTICIP_LUCRO,       /*53 */
                               :NAO_COBR_JUR_ATE,     /*54 */
                               :PREVISAO_ENTREGA,     /*55 */
                               :ATUALIZA_ARQ_EXTERNO, /*56   bo*/
                               :SERVICO,               /*57 */
                               :VALIDADE,              /*58 */
                               :CUSTO_INDEXADO,        /*59 */
                               :COMPLEMENTO,           /*60 */
                               :ATUALIZAR,             /*61 */
                               :EST_MIN,               /*62 */
                               :EST_MAX,               /*63 */
                               :MODELO,                /*64 */
                               :NOME_MODELO,           /*65 */
                               :SERIE,                 /*66 */
                               :DEBITA_ICMS,           /*67 */
                               :SECAO,                 /*68 */
                               :NFE_EXP,               /*69 */
                               :SELECIONADO,           /*70 */
                               :QNTDE_MINIMA_VENDA,     /*71 */
                               :VALIDA_MULT_QTDE_MIN,    /*72 */
                               :FATOR_CONVERSAO         /*73 */
                             ) ;




   /*inserindo grades e numeros*/
  for select GRADE ,
             MATERIAL       ,
             COR            ,
             ULTIMA_COMPRA  ,
             QTDADE_COMPRA  ,
             ULTIMA_VENDA   ,
             QTDADE_VENDA   ,
             ESTOQUE        ,
             NOME_MATERIAL  ,
             NOME_COR       ,
             PERFIL         ,
             NOME_PERFIL
      from est_produtos_grades gr
      where gr.cnpj = :cnpj_origem and gr.produto = :codigo
      INTO
             :GR_GRADE ,
             :GR_MATERIAL       ,
             :GR_COR            ,
             :GR_ULTIMA_COMPRA  ,
             :GR_QTDADE_COMPRA  ,
             :GR_ULTIMA_VENDA   ,
             :GR_QTDADE_VENDA   ,
             :GR_ESTOQUE        ,
             :GR_NOME_MATERIAL  ,
             :GR_NOME_COR       ,
             :GR_PERFIL         ,
             :GR_NOME_PERFIL
  do
  begin

    cont = 0;
    select count(*) from est_produtos_grades gr
    where gr.cnpj = :cnpj_destino and gr.produto = :codigo and gr.grade = :gr_grade
    into :cont;
    
    if (coalesce(:cont,0) = 0) then
    begin
         /*Pefil de Grades*/
        if (:gr_perfil is not null) then
        begin
          cont = 0;
          select count(*) from est_grades pf
          where pf.cnpj = :cnpj_destino and pf.codigo = :gr_perfil
          into :cont;

          cont2 = 0;
          select count(*) from est_grades pf
          where pf.cnpj = :cnpj_origem and pf.codigo = :gr_perfil
          into :cont2;
    
          if ((coalesce(:cont,0) = 0) and (coalesce(:cont2,0) > 0)) then
          begin
            select CODIGO,
                   NOME,
                   INICIAL,
                   FINAL,
                   INTERVALO
            from est_grades gr
            where gr.cnpj = :cnpj_origem and gr.codigo = :gr_perfil
            INTO :pf_codigo,
                 :pf_nome,
                 :pf_inicial,
                 :pf_final,
                 :pf_intervalo;
    
            insert into est_grades(cnpj,
                                     CODIGO,
                                     NOME,
                                     INICIAL,
                                     FINAL,
                                     INTERVALO)
            values (:cnpj_destino,
                    :pf_codigo,
                    :pf_nome,
                    :pf_inicial,
                    :pf_final,
                    :pf_intervalo);


            for select codigo,
                       ordem
                       from est_grades_adicional pfa
                       where pfa.cnpj = :cnpj_origem and pfa.grade = :pf_codigo
                       into :pfa_codigo, :pfa_ordem

            do
            begin
                cont = 0;
                select count(*) from est_grades_adicional pfa
                where pfa.cnpj = :cnpj_destino and pfa.codigo = :pfa_codigo and pfa.grade = :pf_codigo
                into :cont;

                if (coalesce(:cont,0) = 0) then
                begin
                   insert into est_grades_adicional(cnpj, codigo, grade, ordem)
                   values (:cnpj_destino, :pfa_codigo, :pf_codigo,:pfa_ordem);
                end
            end
          end
        end

        /*MATERIAL*/
        if (:gr_material is not null) then
        begin
          cont = 0;
          select count(*) from est_material mt
          where mt.cnpj = :cnpj_destino and mt.codigo = :gr_material
          into :cont;
    
          if (coalesce(:cont,0) = 0) then
          begin
            select mt.nome from est_material mt
            where mt.cnpj = :cnpj_origem and mt.codigo = :gr_material
            INTO :MAT_NOME;
    
            insert into est_material(cnpj, codigo, nome)
            values (:cnpj_destino,:gr_material, :MAT_NOME);
          end
        end
    
        /*COR*/
        if (:gr_cor is not null) then
        begin
          cont = 0;
          select count(*) from est_cor c
          where c.cnpj = :cnpj_destino and c.codigo = :gr_cor
          into :cont;
    
          if (coalesce(:cont,0) = 0) then
          begin
            select c.nome from est_cor c
            where c.cnpj = :cnpj_origem and c.codigo = :gr_cor
            INTO :cor_nome;
    
            insert into est_cor(cnpj, codigo, nome)
            values (:cnpj_destino,:gr_cor, :cor_nome);
          end
        end

        /*INSERINDO GRADES*/
        insert into est_produtos_grades (CNPJ,
                                         PRODUTO,
                                         GRADE ,
                                         MATERIAL       ,
                                         COR            ,
                                         ULTIMA_COMPRA  ,
                                         QTDADE_COMPRA  ,
                                         ULTIMA_VENDA   ,
                                         QTDADE_VENDA   ,
                                         ESTOQUE        ,
                                         NOME_MATERIAL  ,
                                         NOME_COR       ,
                                         PERFIL         ,
                                         NOME_PERFIL)
                                VALUES( :cnpj_destino,
                                        :codigo,
                                        :GR_GRADE ,
                                        :GR_MATERIAL       ,
                                        :GR_COR            ,
                                        :GR_ULTIMA_COMPRA  ,
                                        :GR_QTDADE_COMPRA  ,
                                        :GR_ULTIMA_VENDA   ,
                                        :GR_QTDADE_VENDA   ,
                                        :GR_ESTOQUE        ,
                                        :GR_NOME_MATERIAL  ,
                                        :GR_NOME_COR       ,
                                        :GR_PERFIL         ,
                                        :GR_NOME_PERFIL);


       for select numero, ordem from
           est_produtos_grades_numeros gn
           where gn.cnpj = :cnpj_origem and gn.produto = :codigo and gn.grade = :gr_grade
       into :gn_numero, :gn_ordem
       do
       begin
          cont = 0;
          select count(*) from est_produtos_grades_numeros gn
          where gn.cnpj = :cnpj_destino and gn.produto = :codigo and gn.grade = :gr_grade and gn.numero = :gn_numero
          into :cont;

          if (coalesce(cont,0) = 0) then
          begin
            insert into est_produtos_grades_numeros (CNPJ ,
                                                     PRODUTO  ,
                                                     ESTOQUE  ,
                                                     NUMERO   ,
                                                     ORDEM   ,
                                                     GRADE)
                                            values ( :cnpj_destino ,
                                                     :codigo  ,
                                                     0,
                                                     :gn_numero   ,
                                                     :gn_ordem   ,
                                                     :gr_grade);

          end
       end





    end


  end

  update est_produtos prd set prd.selecionado = 'N'
  where prd.cnpj = :cnpj_origem and prd.codigo = :codigo;
  suspend;
end
^

ALTER PROCEDURE PCD_EXPORTA_BALANCA (
    CNPJ VARCHAR(14),
    BALANCA CHAR(1))
RETURNS (
    PRC_VENDA NUMERIC(18,4),
    NOME VARCHAR(50),
    VALIDADE INTEGER,
    PROD_PESAVEL CHAR(1),
    CODIGO VARCHAR(15))
AS
DECLARE VARIABLE VALOR_PROMOCAO NUMERIC(18,4);
begin
  /* Fabiano 11/06/06
  Procedimento escrito para exportação de produtos para balanças,
  onde nós pegaremos os valores promocionais dos produtos caso eles existam  */

  /*Toledo*/
  if (:balanca = 'T') then
  begin
    for select prd.codigo, prd.PROD_PESAVEL, prd.PRC_VENDA,
    prd.validade, prd.nome  from EST_PRODUTOS prd
    Where prd.CNPJ = :CNPJ and prd.ATUALIZA_ARQ_EXTERNO =  'S'
    into :codigo, :PROD_PESAVEL, :PRC_VENDA, :validade, :nome
    do
    begin
      select coalesce(valor,0) from VER_EST_PROMOCAO(:cnpj, :codigo,cast ('today' as date))
      into :valor_promocao;

      if ((:valor_promocao > 0) and (:valor_promocao < :prc_venda)) then
        prc_venda = :valor_promocao;
      suspend;
    end
  end /*Filizola*/
  else if (:balanca = 'F') then
  begin
    for select prd.codigo, prd.PROD_PESAVEL, prd.PRC_VENDA,
    prd.validade, prd.nome  from EST_PRODUTOS prd
    Where prd.CNPJ = :CNPJ and prd.ATUALIZA_ARQ_EXTERNO =  'S'
    into :codigo, :PROD_PESAVEL, :PRC_VENDA, :validade, :nome
    do
    begin
      select coalesce(valor,0) from VER_EST_PROMOCAO(:cnpj, :codigo,cast ('today' as date))
      into :valor_promocao;

      if ((:valor_promocao > 0) and (:valor_promocao < :prc_venda))then
        prc_venda = :valor_promocao;
      suspend;
    end
  end
END
^

ALTER PROCEDURE PCD_EXPORTA_IAGRO_LANCAMENTOS (
    CNPJ VARCHAR(14),
    COD_FATURAMENTO INTEGER)
RETURNS (
    IE VARCHAR(14),
    TIPOREGISTRO SMALLINT,
    SEQUENCIA INTEGER,
    IE_P VARCHAR(9),
    NOTAFISCAL VARCHAR(14),
    RECIBO VARCHAR(14),
    DATA DATE,
    QUANTIDADE FLOAT,
    VOLUME_EMBALAGEM FLOAT,
    UND_MEDIDA INTEGER,
    MAT_EMBALAGEM INTEGER)
AS
begin
  /* 1 - Inscricao estadual da revenda*/
  select substring(e.ie from 1 for 14) from sis_empresas e where e.cnpj = :cnpj
  into :ie;

  sequencia = 1;

  /*registros de movimentos*/
  tiporegistro = 3;

  for select vdi.quantidade, prd.volume from fat_vendas_itens vdi
      inner join est_produtos prd on (prd.cnpj = vdi.cnpj and prd.codigo = vdi.produto)
      inner join agr_defensivo_agricola def on (def.cnpj = prd.cnpj and prd.codigo = def.cod_produto)
      where vdi.codigo = :cod_faturamento and vdi.cnpj = :cnpj
      into :quantidade, :volume_embalagem
  do
  begin

    /*não temos a inscricao do produtor*/
    ie_p = '';

    select vd.num_nf, vd.data_caixa from fat_vendas vd
    where vd.codigo = :cod_faturamento and vd.cnpj = :cnpj
    into :notafiscal, :data;

    recibo = '';
    suspend;
  end
end
^

ALTER PROCEDURE PCD_EXTRAI_NUM_NFE (
    CHAVE_NFE VARCHAR(44))
RETURNS (
    NUM_NFE VARCHAR(10))
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE I INTEGER;
DECLARE VARIABLE AUX CHAR(1);
DECLARE VARIABLE AUX2 VARCHAR(20);
DECLARE VARIABLE NUMERO VARCHAR(9);
begin
     I = 1;

     AUX2 = '' ;

     numero = substring(:chave_nfe from 35 for 9);
     len = 0;
     while ( i <= 9 ) do
     begin
          select result from sp_substring(:numero, :i, 1)
          into :aux ;

          i = i + 1;
          if ( :aux <> '0' ) then
            break ;
     end
     i = i -1;
     while ( i <= 9 ) do
     begin
          select result from sp_substring(:numero, :i, 1)
          into :aux ;

          i = i + 1;
          NUM_NFE = coalesce(:num_nfe,'')||:aux;
     end
     suspend;
END
^

ALTER PROCEDURE PCD_FAT_GERA_PAGAR (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    DATA_CAIXA DATE,
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    CCT_ID INTEGER)
AS
DECLARE VARIABLE CODPGR INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE IDX_DATABASE DATE;
DECLARE VARIABLE IDX_COTACAO NUMERIC(18,4);
DECLARE VARIABLE IDX_QTDE NUMERIC(18,4);
DECLARE VARIABLE TOTAL_FAT NUMERIC(18,4);
DECLARE VARIABLE ID_AGRUPADOR INTEGER;
begin

    /* gera o codigo e o ano do receber */
    codpgr = gen_id(fin_pagar_cod_ge,1);
    ano = extract (year from data_caixa);

    select codigo from gerar_codigo ('PLANILHA',1)
    into :planilha;

    if (:parcela is null) then
        parcela = '<>' ;
    
     select COD_INDEXADOR,
           IDX_DATABASE,
           IDX_COTACAO,
           IDX_QTDE,
           (vd.total + vd.desc_acres),
           vd.id_agrupador
           from fat_vendas vd
    where vd.cnpj = :cnpj and vd.codigo = :codigo
    into :COD_INDEXADOR,
         :IDX_DATABASE,
         :IDX_COTACAO,
         :IDX_QTDE,
         :total_fat,
         :ID_AGRUPADOR;

    /*No caso de fatuamentos com 'Id_Agrupador' ou seja que possuem um faturamento vinculado
    como é o caso de devoluções, erá obedecer os parametros de indices no faturamento de origem*/
    if (:id_agrupador is not null) then
    begin
      select COD_INDEXADOR,
           IDX_DATABASE,
           IDX_COTACAO,
           IDX_QTDE,
           (vd.total + vd.desc_acres)
           from fat_vendas vd
      where vd.cnpj = :cnpj and vd.codigo = :id_agrupador
      into :COD_INDEXADOR,
         :IDX_DATABASE,
         :IDX_COTACAO,
         :IDX_QTDE,
         :total_fat;
    end
         
    /*quanto de moeda o titulo corresponde do total do faturamento*/
    idx_qtde = (:idx_qtde * (:valor/:total_fat));

    insert into fin_contas_pagar
    (
      cnpj, codigo, ano, pessoa_fj,
      dt_emissao, dt_vencto, dt_lancto, docto,
      parcela, historico, valor, origem,
      centro_custo, conferida, planilha, codigo_vn,
      cod_indexador, idx_database, idx_cotacao,idx_qtde)
    values
    (
      :cnpj, :codpgr, :ano, :pessoa_fj,
      :data, :vencto, :data_caixa , :codigo,
      :parcela, :historico, :valor, 'VND',
      :cct_id,  'N',  :planilha, :codigo,
      :cod_indexador, :idx_database, :idx_cotacao,:idx_qtde
    );

    /*gerando as parcelas de comissão - América Agroseeds*/
    execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,null,:codpgr,current_date);
    suspend;
END
^

ALTER PROCEDURE PCD_FAT_GERA_RECEBER (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    VENCTO DATE,
    DATA DATE,
    DATA_CAIXA DATE,
    LOCAL INTEGER,
    HISTORICO VARCHAR(100),
    TIPO_DOCTO VARCHAR(3),
    PARCELA VARCHAR(6))
AS
declare variable codrec integer;
declare variable id_agrupador integer;
declare variable ano integer;
declare variable banco integer;
declare variable pc_cont integer;
declare variable cm_pessoa_fj integer;
declare variable cm_pct numeric(18,4);
declare variable local_cobranca integer;
declare variable numboleto integer;
declare variable sinc_bol_dpl char(1);
declare variable cod_indexador integer;
declare variable idx_database date;
declare variable idx_cotacao numeric(18,4);
declare variable idx_qtde numeric(18,4);
declare variable total_fat numeric(18,4);
declare variable cm_vlr_lucro_item numeric(18,4);
declare variable cm_vlr_comissao numeric(18,4);
begin
    /*não tenho ideia do que é isso, aparentemente esta setando
    o numero do ultimo boleto*/
    select coalesce(sincronizar_bol_dpl,'N'), coalesce(duplicata,0)
    from sis_empresas where cnpj = :cnpj
    into :sinc_bol_dpl, :numboleto ;

    /* gera o codigo e o ano do receber */
    codrec = gen_id(fin_receber_cod_ge,1);
    ano = extract (year from data_caixa);

    if (:parcela is null) then
        parcela = '<>' ;
    
    /* seleciona o banco do local */
    select banco from ctb_planoconta
    where conta = :local and cnpj = :cnpj
    into :banco;
    
    select lcb.codigo from fin_local_cobranca lcb
    where lcb.banco = :banco
    into :local_cobranca;

    /*@#@$@!$@!.. bloco imenso só pra tratr dessas armadas de atualização de boleto.. nao vou alterar @#$!
    /* se e > 0 entao e boleto bancario */
    if (:local > 0) then
    begin
      /* se sincroniza boleto e duplicata */
      if (sinc_bol_dpl = 'N') then
      begin
         /* atualizando o arquivo */
         numboleto = numboleto + 1;
    
         update sis_empresas set duplicata = :numboleto
         where cnpj = :cnpj ;
      end
      else
      begin
        /* numero de boleto no "BANCO"*/
        select numero from atualiza_boleto(:banco)
        into :numboleto ;
    
      end
    end
    else
    begin
      /* verifica se é duplicata */
      if (:tipo_docto = 'DPL' ) then
      begin
        numboleto = numboleto + 1;
    
        update sis_empresas
        set duplicata = :numboleto
        where cnpj = :cnpj ;
      end
      else
        numboleto = null;
    end
    
    /*atualizando o parcelamento com o nº do boleto*/
    update fat_vendas_parcelamento
    set boleto = :numboleto
    where cnpj = :cnpj and codigo = :codigo and vencto = :vencto ;
    

    select COD_INDEXADOR,
           IDX_DATABASE,
           IDX_COTACAO,
           IDX_QTDE,
           (vd.total + vd.desc_acres),
           vd.ID_AGRUPADOR
           from fat_vendas vd
    where vd.cnpj = :cnpj and vd.codigo = :codigo
    into :COD_INDEXADOR,
         :IDX_DATABASE,
         :IDX_COTACAO,
         :IDX_QTDE,
         :total_fat,
         :id_agrupador;



    /*quanto de moeda o titulo corresponde do total do faturamento*/
    idx_qtde = (:idx_qtde * (:valor/:total_fat));

    /*contas a receber */
    insert into fin_contas_receber
    (
      cnpj, codigo, ano, pessoa_fj, dt_emissao, dt_vencto,
      dt_lancto, docto, parcela, historico, valor, vlr_parcial,
      juros_rec, descontos, boleto, origem, codigo_vn, aviso,
      dt_aviso, selecionado, fatura, numboleto,local_cobranca,
      cod_indexador, idx_database, idx_cotacao,idx_qtde,CONTA_CORRENTE
    )
    values
    (
      :cnpj, :codrec, :ano, :pessoa_fj, :data, :vencto,
      :data, 'VND ' || cast(:codigo as varchar(15)),
      :parcela, :historico, :valor, 0, 0, 0, 'S', 'VND', :codigo, null,
      null, 'N', null, :numboleto,:local_cobranca,
      :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde,:local
    );

    /*gerando as parcelas de comissão - América Agroseeds*/
    execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,:codrec,null,current_date);

    suspend;
END
^

ALTER PROCEDURE PCD_FIN_ACERTA_CHEQUE (
    INDICE VARCHAR(40),
    CNPJ VARCHAR(14),
    DATA DATE,
    CONTACAIXA INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    VALOR NUMERIC(9,2),
    JUROS NUMERIC(9,2),
    DESCONTOS NUMERIC(9,2),
    CONTADEV INTEGER)
AS
DECLARE VARIABLE NDOC VARCHAR(20);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE CONTAATUAL INTEGER;
DECLARE VARIABLE VALORCHEQUE NUMERIC(9,2);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE NCHEQUE VARCHAR(6);
begin

  /* PLANILHA */
  select CODIGO from GERAR_CODIGO ('PLANILHA',1)
  into :PLANILHA;

  /* seleciona a conta atual do cheque e dados do cheque */
  select c.conta_conc, c.valor, c.pessoa_fj, c.nome, c.cheque
  from fin_cheques c
  where c.cnpj = :cnpj and c.indice = :indice
  into :contaatual, :valorcheque, :pessoa_fj, :nome, :ncheque;

  ndoc = 'CHQ-ACER ' || :ncheque;

  /* credita no banco ou no caixa */
  if (:contadev > 0) then
  begin
    execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:CNPJ, :DATA, 'C', ndoc, :ndoc,
    :valorcheque, :contadev, 'CHQ-ACER', :planilha , 0, '', 'A', '', 0);
  end
  else
  begin
    insert into fat_caixas_movimentos(CNPJ, USUARIO, CONTA, DATA, DOCUMENTO,
    HISTORICO, VALOR, TIPO, CONTRA_PARTIDA, NOME_CONTRAPARTIDA, PESSOA_FJ,
    NOME, TURNO, PLANILHA, juros, DESCONTOS)
    values (:cnpj, :usuario, :contacaixa, :data,:ndoc,
    'CHQ-ACER ' || cast (:data as varchar(10)), :valorcheque, 'C', null, null, :pessoa_fj,
    :nome, :turno, :planilha, :juros, :descontos);
  end


  update fin_cheques c
  set c.data_acerto = cast ('today' as date), c.tipo = 'AC', c.juros = :juros, c.conciliado = 'S'
  where c.indice = :indice and c.cnpj = :cnpj  ;
END
^

ALTER PROCEDURE PCD_FIN_ARRUMACHEQUES_ID
AS
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE BANCO VARCHAR(3);
DECLARE VARIABLE CONTA VARCHAR(15);
DECLARE VARIABLE CHEQUE VARCHAR(6);
DECLARE VARIABLE ID INTEGER;
begin
  for
    select c.cnpj, c.banco, c.conta, c.cheque
    from fin_cheques c
    into :cnpj, :banco, :conta, :cheque
  do
  begin
    select gen_id(gnr_fin_cheques_id,1)
    from rdb$database
    into :id;
    update fin_cheques c
    set c.id = :id
    where c.cnpj = :cnpj and c.banco = :banco
    and c.conta = :conta and c.cheque = :cheque;
  end
END
^

ALTER PROCEDURE PCD_FIN_REAPRES_CHEQUE (
    INDICE VARCHAR(40),
    DATA DATE,
    CNPJ VARCHAR(14))
AS
DECLARE VARIABLE NDOC VARCHAR(20);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE CONTADEV INTEGER;
DECLARE VARIABLE CONTAATUAL INTEGER;
DECLARE VARIABLE VALOR NUMERIC(9,2);
begin
  ndoc = 'CHQ-REAP ' || cast(:data as Varchar(10));

  /* PLANILHA */
  select CODIGO from GERAR_CODIGO ('PLANILHA',1)
  into :PLANILHA;

  /* seleciona a conta atual do cheque e dados do cheque */
  select coalesce(c.conta_conc,0), c.valor
  from fin_cheques c
  where c.cnpj = :cnpj and c.indice = :indice
  into :contaatual, :valor;

  if (:contaatual > 0) then
  begin
    /* credita na conta cheques devolvidos */
    execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:CNPJ, :DATA, 'C',
    :ndoc, :ndoc, :valor, :contaatual, 'CHQ-REAP',
    :PLANILHA, 0, null, 'A', null, 0);
  end



  update fin_cheques c set c.data_reapres = :data, c.conciliado = 'S'
  where CNPJ = :CNPJ and c.indice = :indice;

  suspend;
END
^

ALTER PROCEDURE PCD_FIN_SOMAR_CONCILIACAO (
    CNPJ VARCHAR(14))
RETURNS (
    AVISTA NUMERIC(9,2),
    APRAZO NUMERIC(9,2),
    DESCARTADOS NUMERIC(9,2),
    TOTAL NUMERIC(9,2))
AS
begin
  select coalesce(sum(coalesce(c.valor,0)),0)
  from fin_cheques c
  where c.marcado = 'S' and  (c.data_conciliacao is null)
  and coalesce(c.emissao,'01.01.2001') >= coalesce(c.pre_date,'01.01.2001') and c.cnpj = :cnpj
  into :avista;

  select coalesce(sum(coalesce(c.valor,0)),0)
  from fin_cheques c
  where c.marcado = 'S' and  (c.data_conciliacao is null)
  and coalesce(c.emissao,'01.01.2001') < coalesce(c.pre_date,'01.01.2001') and c.cnpj = :cnpj
  into :aprazo;

  select coalesce(sum(coalesce(c.valor,0)),0)
  from fin_cheques c
  where c.marcado = 'S' and  (c.data_conciliacao is not null)
  and c.cnpj = :cnpj
  into :descartados;
  total = :avista + :aprazo;
  suspend;
END
^

ALTER PROCEDURE PCD_FLUXO_CAIXA (
    CNPJ VARCHAR(14),
    CHEQUE CHAR(1),
    CARTAO CHAR(1),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    DATA DATE,
    TT_RECEBER_EFETIVO FLOAT,
    TT_RECEBER_PREVISO FLOAT,
    TT_PAGAR_EFETIVO FLOAT,
    TT_PAGAR_PREVISTO FLOAT,
    TT_SALDO_PREVISTO FLOAT,
    TT_SALDO_EFETIVO FLOAT,
    E_CNPJ VARCHAR(14),
    SALDO_CAIXAS FLOAT,
    SALDO_CONTAS FLOAT,
    SALDO_INICIAL FLOAT)
AS
DECLARE VARIABLE SOMA FLOAT;
DECLARE VARIABLE USUARIO INTEGER;
DECLARE VARIABLE CONTA INTEGER;
DECLARE VARIABLE DATA_CX DATE;
DECLARE VARIABLE TURNO INTEGER;
begin
  saldo_caixas = 0;
  /*selecionando saldos de caixas já fechados*/
  for select u.usuario, u.conta from  FAT_USUARIOS_CAIXA u
      where u.ativo = 'S' and u.data_desativacao is null and coalesce(u.ctb_fluxo_caixa,'N') = 'S'
      into :usuario, :conta
  do
  begin
    select max(data) from fat_caixas cx
    where cx.usuario = :usuario and cx.conta = :conta and cx.fechado = 'S' and cx.cnpj = :cnpj and cx.data < :data1
    into :data_cx;

    select max(turno) from fat_caixas cx
    where cx.usuario = :usuario and cx.conta = :conta and cx.fechado = 'S' and cx.cnpj = :cnpj and cx.data = :data_cx
    into :turno;

    select coalesce(cx.saldo,0) from fat_caixas cx
    where cx.usuario = :usuario and cx.conta = :conta and cx.fechado = 'S' and cx.cnpj = :cnpj and cx.data = :data_cx and cx.turno = :turno
    into :soma;

    saldo_caixas = :saldo_caixas + :soma;
  end


  /*totalizando o saldo conciliados das contas antes da primeira data de vencto
  saldo_contas = 0;
  select sum(case ct.tipo
              when 'C' then ct.valor
              when 'D' then (ct.valor *-1)
             end
             ) from ctb_movimento_contabil ct
  inner join ctb_planoconta p on (p.conta = ct.conta and p.cnpj = ct.cnpj)
  where ct.cnpj = :cnpj and ct.data_conciliacao < :data1 and coalesce(p.ctb_fluxo_caixa,'N') = 'S'

  into :soma;*/

  saldo_contas = :saldo_contas + coalesce(:soma,0);

  SALDO_INICIAL = :saldo_caixas + :saldo_contas;

  E_CNPJ = :cnpj;
  data = :data1;
  tt_saldo_efetivo = (:saldo_caixas + :saldo_contas);
  tt_saldo_previsto = (:saldo_caixas + :saldo_contas);
  soma = 0;
  while (:data <= :data2) do
  begin

   /*---------------------------------------------Valores Previstos Receber---------------------------------------------*/
   /*contas à receber previstas, que não foram recebidas nem mesmo parcialmente, pois senão
   o procedure pegará 2 vezes na consulta das já baixadas*/
   select sum(coalesce(rec.valor,0) -coalesce(rec.vlr_parcial,0)) from fin_contas_receber rec
   where rec.cnpj = :cnpj and rec.dt_vencto = :data
   and ( 0 = (select count(*) from fin_baixas_receber bx where bx.cnpj = :cnpj and bx.codigo_cr = rec.codigo))
   into :soma;

   tt_receber_previso = coalesce(:soma,0);

   /*contas à receber previstas, que foram recebidas integralmente*/
   select sum(coalesce(bx.valor,0) -coalesce(bx.vlr_parcial,0)) from fin_baixas_receber bx
   where bx.cnpj = :cnpj and bx.dt_vencto = :data
   and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
   and ( 0 = (select count(*) from fin_contas_receber rec where rec.cnpj = :cnpj and rec.codigo = bx.codigo_cr))
   /*tirando os movimentos de cartão */
   and ( 0 = (select count(*) from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.planilha = bx.planilha))
   /*tirando os movimentos de cheque*/
   and ( 0 = (select count(*) from fin_cheques ch where ch.cnpj = :cnpj and ch.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from fin_cheques ch where ch.cnpj = :cnpj and ch.planilha = bx.planilha))
   into :soma;

   tt_receber_previso = (:tt_receber_previso + coalesce(:soma,0));

   /*cartoes*/
   select sum(crt.valor) from fin_movimento_cartao crt
   where crt.cnpj = :cnpj and crt.reembolso = :data
   into :soma;
   tt_receber_previso = (:tt_receber_previso + coalesce(:soma,0));

   /*cheques*/
   select sum(ch.valor) from fin_cheques ch
   where ch.cnpj = :cnpj and ch.pre_date = :data
   into :soma;
   tt_receber_previso = (:tt_receber_previso + coalesce(:soma,0));


    /*---------------------------------------------Valores Previstos Pagar---------------------------------------------*/
   /*contas à pagar previstas, que não foram recebidas nem mesmo parcialmente, pois senão
   o procedure pegará 2 vezes na consulta das já baixadas*/
   select sum(coalesce(pgr.valor,0) -coalesce(pgr.vlr_parcial,0)) from fin_contas_pagar pgr
   where pgr.cnpj = :cnpj and pgr.dt_vencto = :data
   and ( 0 = (select count(*) from fin_baixas_pagar bx where bx.cnpj = :cnpj and bx.codigo_pg = pgr.codigo))
   into :soma;

   tt_pagar_previsto = coalesce(:soma,0);

   /*contas à pagar previstas, que foram pagas integralmente*/
   select sum(coalesce(bx.valor,0) -coalesce(bx.vlr_parcial,0)) from fin_baixas_pagar bx
   where bx.cnpj = :cnpj and bx.dt_vencto = :data
   and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
   and ( 0 = (select count(*) from fin_contas_pagar pgr where pgr.cnpj = :cnpj and pgr.codigo = bx.codigo_pg))
   and ( 0 = (select count(*) from ctb_cheque ch where ch.cnpj = :cnpj and ch.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from ctb_cheque ch where ch.cnpj = :cnpj and ch.planilha = bx.planilha))
   into :soma;

   tt_pagar_previsto = (:tt_pagar_previsto + coalesce(:soma,0));

   /*cheques*/
   select sum(ch.valor) from ctb_cheque ch
   where ch.cnpj = :cnpj and ch.pre_date = :data
   into :soma;
   tt_pagar_previsto = (:tt_pagar_previsto + coalesce(:soma,0));

   /*---------------------------------------------Valores Realizados Receber---------------------------------------------*/
   /*contas à receber previstas, que foram recebidas integralmente*/
   select sum(bx.vlr_baixa) from fin_baixas_receber bx
   where bx.cnpj = :cnpj and bx.dt_baixa = :data
   and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
   /*tirando os movimentos de cartão */
   and ( 0 = (select count(*) from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from fin_movimento_cartao crt where crt.cnpj = :cnpj and crt.planilha = bx.planilha))
   /*tirando os movimentos de cheque*/
   and ( 0 = (select count(*) from fin_cheques ch where ch.cnpj = :cnpj and ch.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from fin_cheques ch where ch.cnpj = :cnpj and ch.planilha = bx.planilha))
   into :soma;
   tt_receber_efetivo = coalesce(:soma,0);

   /*cartoes*/
   select sum(crt.valor) from fin_movimento_cartao crt
   where crt.cnpj = :cnpj and crt.data_conciliacao = :data and coalesce(crt.conciliado,'N') = 'S'
   into :soma;
   tt_receber_efetivo = (:tt_receber_efetivo + coalesce(:soma,0));

   /*cheques*/
   select sum(ch.valor) from fin_cheques ch
   where ch.cnpj = :cnpj and ch.data_conciliacao = :data and coalesce(ch.conciliado,'N') = 'S'
   into :soma;
   tt_receber_efetivo = (:tt_receber_efetivo + coalesce(:soma,0));


    /*---------------------------------------------Valores Efetivos Pagar---------------------------------------------*/

   /*contas à pagar previstas, que foram recebidas integralmente*/
   select sum(bx.vlr_baixa) from fin_baixas_pagar bx
   where bx.cnpj = :cnpj and bx.dt_baixa = :data
   and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
   and ( 0 = (select count(*) from ctb_cheque ch where ch.cnpj = :cnpj and ch.cod_acertoconta = bx.cod_acertoconta))
   and ( 0 = (select count(*) from ctb_cheque ch where ch.cnpj = :cnpj and ch.planilha = bx.planilha))
   into :soma;
   tt_pagar_efetivo = coalesce(:soma,0);

   /*cheques*/
   select sum(ch.valor) from ctb_cheque ch
   where ch.cnpj = :cnpj and ch.data = :data
   into :soma;
   tt_pagar_efetivo = (:tt_pagar_efetivo + coalesce(:soma,0));


   tt_saldo_previsto = tt_saldo_previsto + (:tt_receber_previso - :tt_pagar_previsto);
   tt_saldo_efetivo = tt_saldo_efetivo + (:tt_receber_efetivo - :tt_pagar_efetivo);


   tt_pagar_efetivo = (:tt_pagar_efetivo * -1);
   tt_pagar_previsto = (:tt_pagar_previsto * -1);
   suspend;
   data = (:data + 1);
  end
end
^

ALTER PROCEDURE PCD_GERA_COMISSAO (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE,
    USUARIO INTEGER)
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE PCT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE PCT_VISTA NUMERIC(18,4);
DECLARE VARIABLE COD_PRODUTO VARCHAR(15);
DECLARE VARIABLE CM_COD_PERFIL INTEGER;
DECLARE VARIABLE CM_COD_FX_DC INTEGER;
DECLARE VARIABLE CM_COD_FAIXA INTEGER;
DECLARE VARIABLE LOG_COD_FX_DC_PRD INTEGER;
DECLARE VARIABLE LOG_FX_INICIAL INTEGER;
DECLARE VARIABLE LOG_FX_FINAL INTEGER;
DECLARE VARIABLE LOG_FX_D_INICIAL INTEGER;
DECLARE VARIABLE LOG_FX_D_FINAL INTEGER;
DECLARE VARIABLE LOG_PCT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE LOG_PCT_VISTA NUMERIC(18,4);
DECLARE VARIABLE LOG_PCT_PRAZO_PRD NUMERIC(18,4);
DECLARE VARIABLE LOG_PCT_VISTA_PRD NUMERIC(18,4);
DECLARE VARIABLE LOG_COM_PRAZO_PRD NUMERIC(18,4);
DECLARE VARIABLE LOG_COM_VISTA_PRD NUMERIC(18,4);
DECLARE VARIABLE LOG_AUX_COM_VISTA_PRD NUMERIC(18,4);
DECLARE VARIABLE LOG_NOME_PERFIL VARCHAR(50);
DECLARE VARIABLE COD_VENDEDOR INTEGER;
DECLARE VARIABLE BASE_CALC INTEGER;
DECLARE VARIABLE TTL_VENDAS NUMERIC(18,4);
DECLARE VARIABLE TTL_TROCAS NUMERIC(18,4);
DECLARE VARIABLE TTL_ITEM NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCTO_ITEM NUMERIC(18,4);
DECLARE VARIABLE TTL_MOVIMENTO NUMERIC(18,4);
DECLARE VARIABLE MVT_AVISTA CHAR(1);
DECLARE VARIABLE MVT_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE MVT_TOTAL NUMERIC(18,4);
DECLARE VARIABLE TR_TOTAL_E NUMERIC(18,4);
DECLARE VARIABLE TR_TOTAL_S NUMERIC(18,4);
DECLARE VARIABLE TR_DESC_E NUMERIC(18,4);
DECLARE VARIABLE TR_DESC_S NUMERIC(18,4);
DECLARE VARIABLE MVT_CODIGO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE CUSTO_MEDIO NUMERIC(18,4);
DECLARE VARIABLE lucro_item NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE VDI_TTL_COM_P NUMERIC(18,4);
DECLARE VARIABLE VDI_TTL_COM_V NUMERIC(18,4);
DECLARE VARIABLE VLR_ITEM_VISTA NUMERIC(18,4);
DECLARE VARIABLE VLR_ITEM_PRAZO NUMERIC(18,4);
DECLARE VARIABLE VLR_ITEM_ANT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE MVT_PCT_VISTA NUMERIC(18,4);
DECLARE VARIABLE MVT_PCT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE COD_COMISSAO INTEGER;
DECLARE VARIABLE COD_COMISSAO_PARC INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE GAMB VARCHAR(50);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE PCT_ANT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE AUX_PCT_ANT_PRAZO NUMERIC(18,4);
DECLARE VARIABLE ATUALIZA_COMISSAO CHAR(1);
DECLARE VARIABLE TR_TIPO_MOV CHAR(1);
DECLARE VARIABLE STATUS CHAR(1);
DECLARE VARIABLE PERFIL_PAGTO INTEGER;
begin
  /*Procedure utilizado para gerar comissão de um determinado período,
    pois ficaria inviável fazer a comissão ser gerada no ato do movimento já que
    o módulo prevê a possibilidade de calcula-la por faixa de valores*/

  /*--------percorrendo individualemnte os vendedors-------*/
  for select vdd.cod_perfil, vdd.codigo, cm.base_calc, cm.descricao, vdd.cod_perfil_pagto
      from fat_vendedor vdd
      inner join cm_perfil cm on (vdd.cod_perfil = cm.codigo and cm.cnpj = vdd.cnpj)
      where vdd.cnpj = :cnpj
      into :cm_cod_perfil, :cod_vendedor, :base_calc, :log_nome_perfil, :perfil_pagto
  do
  begin

    /*percentual de antecipação de venda á prazo*/
    select coalesce(p.pct_ant_prazo,0) from cm_perfil_pagto p
    where p.cnpj = :cnpj and p.codigo = :perfil_pagto
    into :pct_ant_prazo;

    /*pau no firbird.. nao sei porque continua nullo*/
    if (:pct_ant_prazo is null) then
       pct_ant_prazo = 0;

    /*-----------------Faturamento--------------------*/
    if (:base_calc = 1) then
    begin
        /*-------------------------------------------------Totalizando---------------------------------------------------*/
        select
            sum
            (/*total do item*/
            (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) +
            (/*quanto percentualmente ele representa na venda.................. o descto é negativ*/
                (
                ((coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))) * 100)
                /coalesce(vd.total,0)
                ) /*descobrindo quanto do desconto é "daquele produto" e diminuindo do total do item*/
                * coalesce(vd.desc_acres,0))/100
            )
        from fat_vendas vd
        inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
        inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
        where vd.cnpj = :cnpj and (vd.data_caixa between :dt_inicial and :dt_final)
        and nat.es = 'S' and coalesce(vd.cancelada,'N') = 'N' and coalesce(vd.fechada,'N') = 'S'
        and nat.computa_venda = 'S' and vdi.vendedor = :cod_vendedor and coalesce(vdi.com_gerada,'N') = 'N'
        into :ttl_vendas;
    end

    if (:base_calc = 2) then
    begin
        /*-------------------------------------------------Totalizando---------------------------------------------------*/
        select
            sum
            (
               (
                   (/*total do item*/
                     coalesce(vdi.quantidade,0) *
                     (
                       coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)
                     )
                   )
                   +
                   (/*quanto percentualmente ele representa na venda.................. o descto é negativ*/
                    (/* (ttlitem*100) / ttlvenda */
                     (
                      (/*total do item*/
                        coalesce(vdi.quantidade,0) *
                        (
                          coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)
                        )
                      )
                      * 100
                     )
                     /coalesce(vd.total,0)
                    )/*o quanto representa...* o descto dividido por 100 e temos o vlr. descto do item*/
                    * coalesce(vd.desc_acres,0)
                   )
                   /100
               )
               -
               (
                 coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0)
               )
            )
        from fat_vendas vd
        inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
        inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
        where vd.cnpj = :cnpj and (vd.data_caixa between :dt_inicial and :dt_final)
        and nat.es = 'S' and coalesce(vd.cancelada,'N') = 'N' and coalesce(vd.fechada,'N') = 'S'
        and nat.computa_venda = 'S' and vdi.vendedor = :cod_vendedor and coalesce(vdi.com_gerada,'N') = 'N'
        into :ttl_vendas;
    end

    /*------------------------Trocas----------------------*/
    select sum(distinct(coalesce(tr.total_2,0) + coalesce(tr.desc_acresc_2,0)) - (coalesce(tr.total,0) + coalesce(tr.desc_acresc,0)))
    from fat_trocas tr
    inner join fat_trocas_itens tri on (tri.cnpj = tr.cnpj and tri.codigo = tr.codigo)
    where tr.cnpj = :cnpj and (tr.data_caixa between :dt_inicial and :dt_final) and coalesce(tri.com_gerada,'N') = 'N'  and
    coalesce(tr.cancelada,'N') = 'N' and coalesce(tr.fechado,'N') = 'S' and tr.vendedor = :cod_vendedor
    into :ttl_trocas;

    ttl_movimento = (coalesce(:ttl_vendas,0) + coalesce(:ttl_trocas,0));

    /*só será realizado os cálculos caso haja algum movto para o vendedor*/
    if (ttl_movimento > 0) then
    begin
      /*#$%#$$#$!!!@!@@$##@$#$!!!!!!!!!!!!
      Não sei o porque as selects não procuram corretamente entre dois numerics quando se utiliza um numeric
      como parametro de entrado.. não há meio desse troço funcionar.. não sei se é pau do firebird.. em fim
      assim funcionou.. fiz um cast para string.. dpois joguei ela na select e o firebird se encarrega
      de refazer o cast para o tipo adequado*/
      if (:ttl_movimento < 0) then
        gamb = cast(0.00 as varchar(50));
      else
        gamb = cast(ttl_movimento as varchar(50));

      /*selecionando a faixa do perfil*/
      select fx.codigo, fx.vlr_inicial, fx.vlr_final from cm_perfil_faixa fx
      where fx.cnpj = :cnpj and fx.cod_perfil = :cm_cod_perfil
      and (:GAMB between fx.vlr_inicial and fx.vlr_final) /*and (fx.vlr_final >= :ttl_movimento)*/
      into :cm_cod_faixa, :log_fx_inicial, :log_fx_final;
    

      /*------------------------------------HORA DO VAMO VÊ--------------------------------------*/

      /*------------Só estou pegando Tr.Positivas------------------------------------------------*/
      for select tr.codigo, tr.pessoa_fj, pgt.avista, coalesce(tr.entrada,0),
          coalesce(tr.total_2,0), coalesce(tr.desc_acresc_2,0),
          coalesce(tr.total,0) , coalesce(tr.desc_acresc,0),
          ((coalesce(tr.total_2,0) + coalesce(tr.desc_acresc_2,0)) - (coalesce(tr.total,0) + coalesce(tr.desc_acresc,0)))
          from fat_trocas tr
          inner join fin_formas_pagto pgt on (pgt.codigo = tr.forma_pgto and pgt.cnpj = tr.cnpj)
          where tr.cnpj = :cnpj and (tr.data_caixa between :dt_inicial and :dt_final) and
          coalesce(tr.cancelada,'N') = 'N' and coalesce(tr.fechado,'N') = 'S'
          into :mvt_codigo, :pessoa_fj,  :mvt_avista, :mvt_entrada,
               :tr_total_s, :tr_desc_s,
               :tr_total_e, :tr_desc_e,
               :mvt_total
      do
      begin
        atualiza_comissao = 'N';
        /*percentual de antecipação de venda á prazo*/
        select coalesce(p.pct_ant_prazo,0) from cm_perfil_pagto p
        where p.cnpj = :cnpj and p.codigo = :perfil_pagto
        into :pct_ant_prazo;
        
        /*pau no firbird.. nao sei porque continua nullo*/
        if (:pct_ant_prazo is null) then
           pct_ant_prazo = 0;
        /*------------------------Preciso definir quanto da venda é a vista ou a prazo --------------------------*/
        /*----pois as comissões internas msmo nos items variam em perventua de acordo com a forma de pagto ------*/
        if (:mvt_avista= 'S') then
        begin
          mvt_pct_vista = 100;
          mvt_pct_prazo = 0;
          pct_ant_prazo = 0;
        end
        else
        begin
          /*considerando as entradas como valores a vista*/
          mvt_pct_vista = ((coalesce(:mvt_entrada,0) * 100.00)/:mvt_total);

          /*descobrindo qnto (R$) é o vlr de antecipação do restante a prazo*/
          aux_pct_ant_prazo = ((:mvt_total - coalesce(:mvt_entrada,0)) * :pct_ant_prazo)/100.00;

          /*descobrindo qnto este valor representa (%) no total da venda*/
          pct_ant_prazo = ((:aux_pct_ant_prazo * 100)/:mvt_total);

          /*considerando o vlr de antecipação como um vlr a vista*/
          mvt_pct_vista = mvt_pct_vista;

          mvt_pct_prazo = (100 - (:mvt_pct_vista + :pct_ant_prazo));
        end
    
        vdi_ttl_com_p = 0;
        vdi_ttl_com_v = 0;
        cod_comissao = null;
        for select tri.produto, coalesce(tri.prc_custo,0),coalesce(tri.custo_medio,0), tri.lucro_item,  coalesce(tri.prc_unitario,0),
            coalesce(tri.quantidade,0), coalesce(tri.desconto,0), tri.sequencia, tri.tipo
            from fat_trocas_itens tri
            where tri.cnpj = :cnpj and tri.codigo = :mvt_codigo and coalesce(tri.com_gerada,'N') = 'N'
            into :cod_produto, :prc_custo, :CUSTO_MEDIO, :LUCRO_ITEM, :prc_unitario, :quantidade, :desconto, :sequencia, :tr_tipo_mov
        do
        begin
             atualiza_comissao = 'S';
             /*se não tem custo médio ele vai pegar o valor do ultimo custo*/
             if (custo_medio <= 0) then
             begin
               custo_medio = :prc_custo;

               if (custo_medio <= 0) then
               begin
                 /*se não possui preço de custo no item, então vou pegar os valores
                 do cadastro de produtos, ..custo medio, ..prc-custo, ..prc-venda*/
                 select coalesce(valor,0) from pcd_cm_custo_medio(:cnpj,:cod_produto)
                 into :custo_medio;

                 /*senão tiver jeito memo.. pego o preço de venda do item...*/
                 if (:custo_medio <= 0) then
                    custo_medio = :prc_unitario;
               end
             end
             CUSTO_MEDIO = :CUSTO_MEDIO * :quantidade;
             prc_custo = :prc_custo * :quantidade;
             ttl_item = (:prc_unitario - :desconto) * :quantidade;

             if (:tr_tipo_mov = 'S') then
             begin
               if (:tr_total_s > 0) then
                  ttl_item = ttl_item + ((((ttl_item * 100)/:tr_total_s) * :tr_desc_s)/100.00);
             end
             else if (:tr_tipo_mov = 'E') then
             begin
               if (:tr_total_e > 0) then
                  ttl_item = ttl_item + ((((ttl_item * 100)/:tr_total_e) * :tr_desc_e)/100.00);
             end

             /*encontrando o  Lucro para se localizar a faixa */
             pct_descto_item =  ((:CUSTO_MEDIO * 100)/:ttl_item);
             pct_descto_item = (100 - :pct_descto_item);

             if (:lucro_item is null) then
             begin
               update fat_trocas_itens vdi set vdi.lucro_item = :pct_descto_item
               where vdi.cnpj = :cnpj and vdi.produto = :cod_produto and vdi.codigo = :mvt_codigo;
             end

             if (:pct_descto_item > 0) then
               gamb = cast(:pct_descto_item as varchar(50));
             else
               gamb = cast(0.00 as varchar(50));

             /*lozalizando a faixa e os valores de comissão*/
             select cmd.codigo, cmd.pct_prazo, cmd.pct_vista, cmd.pct_inicial, cmd.pct_final
             from cm_perfil_faixa_desc cmd
             where cmd.cnpj = :cnpj and (:gamb between cmd.pct_inicial and cmd.pct_final)
             and cmd.cod_perfil_faixa = :cm_cod_faixa
             into :cm_cod_fx_dc, :pct_prazo, :pct_vista, :log_fx_d_inicial, :log_fx_d_final;

             LOG_PCT_PRAZO = :pct_prazo;
             LOG_PCT_VISTA = :pct_vista;

             /*se o produto for uma exceção ele vai se encontrar aqui*/
             for select cmp.pct_prod_prazo, cmp.pct_prod_vista  from cm_perfil_faixa_prod cmp
                 where cmp.cnpj = :cnpj and cmp.cod_perfil_fx_desc = :cm_cod_fx_dc and cmp.cod_produto = :cod_produto
                 into :pct_prazo, :pct_vista
             do
             begin
               LOG_PCT_PRAZO_PRD = :pct_prazo;

               LOG_PCT_VISTA_PRD = :pct_vista;
             end
    
             /*faturamento */
             if (:base_calc = 1) then
             begin
               vlr_item_prazo = ((:mvt_pct_prazo * :ttl_item)/100);
               vlr_item_ant_prazo = ((:pct_ant_prazo * :ttl_item)/100);
               vlr_item_vista = ((:MVT_pct_vista * :ttl_item)/100);
             end
             else /*lucro */
             begin
               vlr_item_prazo = ((:mvt_pct_prazo * (:ttl_item - :prc_custo))/100);
               vlr_item_ant_prazo = ((:pct_ant_prazo * (:ttl_item - :prc_custo))/100);
               vlr_item_vista = ((:MVT_pct_vista * (:ttl_item - :prc_custo))/100);
             end

             if (TR_TIPO_MOV = 'E') then
                fator = (-1);
             else
                fator = (1);
             /*com prazo*/
             log_com_prazo_prd = ((:pct_prazo * :vlr_item_prazo)/100) * fator;
             vdi_ttl_com_p = (vdi_ttl_com_p + log_com_prazo_prd);
    
             /*com a prazo antecipada*/
             log_com_vista_prd = ((:pct_prazo * :vlr_item_ant_prazo)/100) * fator;
             vdi_ttl_com_v = (vdi_ttl_com_v + log_com_vista_prd) ;

             /*!!!#Atenção#!!! usado somente para salvar o log corretamente*/
             LOG_AUX_COM_VISTA_PRD = log_com_vista_prd;

             /*com vista*/
             log_com_vista_prd = ((:pct_vista * :vlr_item_vista)/100) * fator;
             vdi_ttl_com_v = (vdi_ttl_com_v + log_com_vista_prd);

             /*!!!#Atenção#!!! usado somente para salvar o log corretamente*/
             LOG_AUX_COM_VISTA_PRD = LOG_AUX_COM_VISTA_PRD + log_com_vista_prd;

         /*------------------------------------Guardando o Log de Cada Item------------------------------*/
         insert into cm_log (CNPJ, COD_TROCA, COD_PRODUTO, SEQUENCIA, P_CODIGO, P_PERFIL, P_BASE_CALC,
                            P_FX_CODIGO, P_FX_VLR_INICIAL, P_FX_VLR_FINAL,
                            P_FX_D_CODIGO, P_FX_D_PCT_INI, P_FX_D_PCT_FIN, P_FX_D_PCT_VISTA, P_FX_D_PCT_PRAZO,
                            P_FX_D_PRD_CODIGO, P_FX_D_PRD_PCT_VISTA, P_FX_D_PRD_PCT_PRAZO,
                            TTL_FATURAMENTO, TTL_DESCTO_ITEM, DT_INICIAL, DT_FINAL, COM_VISTA, COM_PRAZO, USUARIO)
                     values(:cnpj, :mvt_codigo, :cod_produto, :sequencia,:cm_cod_perfil, :log_nome_perfil, :base_calc,
                            :cm_cod_faixa, :log_fx_inicial, :log_fx_final,
                            :cm_cod_fx_dc, :log_fx_d_inicial,:log_fx_d_final, :log_pct_vista, :log_pct_prazo,
                            :log_cod_fx_dc_prd, :log_pct_vista_prd, :log_pct_prazo_prd,
                            :ttl_movimento, :pct_descto_item, :dt_inicial, :dt_final, :log_aux_com_vista_prd, :log_com_prazo_prd, :usuario);


        end

        if (atualiza_comissao = 'S') then
        begin
            /*marcando o item como comissão gerada */
            update fat_trocas_itens tri set tri.com_gerada = 'S'
            where tri.cnpj = :cnpj and tri.codigo = :mvt_codigo;
    
             /*salvando a média aritimética de desconto na comissão*/
            select avg(vdi.lucro_item) from fat_trocas_itens vdi
            where vdi.codigo = :mvt_codigo and vdi.cnpj = :cnpj
            into :pct_descto_item;

            /*quantos parcelamentos existem (prazo)*/
            select count(*) from cm_comissao c
            inner join cm_comissao_parc cp on (cp.cnpj = c.cnpj and c.codigo = cp.cod_comissao)
            where c.cod_troca = :mvt_codigo and c.cod_vendedor = :cod_vendedor and cp.cod_receber is not null
            and c.cnpj = :cnpj
            into :cont;
        
            /*-----------lançando os valores a prazo-----------*/
            if (:cont > 0) then
            begin
              vdi_ttl_com_p = (:vdi_ttl_com_p/cont);
              for select cp.codigo from cm_comissao c
                  inner join cm_comissao_parc cp on (cp.cnpj = c.cnpj and c.codigo = cp.cod_comissao)
                  where c.cod_troca = :mvt_codigo and c.cod_vendedor = :cod_vendedor and cp.cod_receber is not null
                  and c.cnpj = :cnpj
                  into :cod_comissao_parc
              do
              begin
                if (:vdi_ttl_com_p = 0) then
                  status = 'N';
                else
                  status = 'G';

                /*atualizando os registros com o valor a prazo rateado*/
                update cm_comissao_parc p set p.pct_lucro_item = :pct_descto_item, p.vlr_total = :vdi_ttl_com_p, p.status = :status
                where p.cnpj = :cnpj and p.codigo = :cod_comissao_parc;
              end
            end
        
            /*---------------------lançando os valores à vista-----------------------*/
            select c.codigo from cm_comissao c
            where c.cod_troca = :mvt_codigo and c.cod_vendedor = :cod_vendedor and c.cnpj = :cnpj
            into :cod_comissao;
        
            /* Aina não há cabeçalho*/
            if (:cod_comissao is null) then
            begin
              cod_comissao = GEN_ID(GEN_CM_COMISSAO_ID,1);
              insert into cm_comissao(cnpj,codigo,cod_troca,cod_vendedor,pessoa_fj, pct_lucro_item)
              values(:cnpj, :cod_comissao, :mvt_codigo, :cod_vendedor, :pessoa_fj, :pct_descto_item);
            end
        
            /*Só será lançado a parcela do percentual a vista, caso exista um
            valor a ser comssionado, estava acontecendo que vendas à prazo mas de vendedores
            que possuiam antecipação de comissão recebessem a vista*/
            if (:vdi_ttl_com_v > 0) then
            begin
              insert into cm_comissao_parc(cnpj,cod_comissao,pct_pago,pct_liberado,status,vlr_total, pct_lucro_item)
              values(:cnpj,:cod_comissao,100,100,:status, :vdi_ttl_com_v,:pct_descto_item);
            end
    
            update cm_comissao set pct_lucro_item = :pct_descto_item, dt_geracao = cast('today' as date), status = :status, pct_antecipacao = :pct_ant_prazo
            where codigo = :cod_comissao and cnpj = :cnpj;
        end
      end


      /*----------------------------------------Vendas-------------------------------------------*/
      for select vd.codigo, pessoa_fj, coalesce(vd.total,0), coalesce(vd.desc_acres,0), pgt.avista, coalesce(vd.entrada,0)
          from fat_vendas vd
          inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
          inner join fin_formas_pagto pgt on (pgt.codigo = vd.forma_pgto and pgt.cnpj = vd.cnpj)
          where vd.cnpj = :cnpj and (vd.data_caixa between :dt_inicial and :dt_final)
          and nat.es = 'S' and coalesce(vd.cancelada,'N') = 'N' and coalesce(vd.fechada,'N') = 'S'
          and nat.computa_venda = 'S'
          into :mvt_codigo, :pessoa_fj, :mvt_total, :desc_acres, :mvt_avista, :mvt_entrada
      do
      begin
        /*apenas teste*/
        if ((:mvt_codigo = 13487) and (:COD_VENDEDOR = 4)) then
           mvt_codigo = :mvt_codigo;

        atualiza_comissao = 'N';
        /*percentual de antecipação de venda á prazo*/
        select coalesce(p.pct_ant_prazo,0) from cm_perfil_pagto p
        where p.cnpj = :cnpj and p.codigo = :perfil_pagto
        into :pct_ant_prazo;

        /*pau no firbird.. nao sei porque continua nullo*/
        if (:pct_ant_prazo is null) then
           pct_ant_prazo = 0;
        /*------------------------Preciso definir quanto da venda é a vista ou a prazo --------------------------*/
        /*----pois as comissões internas msmo nos items variam em perventua de acordo com a forma de pagto ------*/
        if (:mvt_avista= 'S') then
        begin
          mvt_pct_vista = 100;
          mvt_pct_prazo = 0;
          pct_ant_prazo = 0;
        end
        else
        begin
          /*considerando as entradas como valores a vista*/
          mvt_pct_vista = ((coalesce(:mvt_entrada,0) * 100.00)/:mvt_total);

          /*descobrindo qnto (R$) é o vlr de antecipação do restante a prazo*/
          aux_pct_ant_prazo = ((:mvt_total - coalesce(:mvt_entrada,0)) * :pct_ant_prazo)/100.00;

          /*descobrindo qnto este valor representa (%) no total da venda*/
          pct_ant_prazo = ((:aux_pct_ant_prazo * 100)/:mvt_total);

          /*considerando o vlr de antecipação como um vlr a vista*/
          MVT_pct_vista = MVT_pct_vista;

          mvt_pct_prazo = (100 - (:MVT_pct_vista + :pct_ant_prazo));

        end
    
        vdi_ttl_com_p = 0;
        vdi_ttl_com_v = 0;
        cod_comissao = null;
        for select vdi.produto, coalesce(vdi.prc_custo,0),coalesce(vdi.CUSTO_MEDIO,0), coalesce(vdi.prc_unitario,0),
            coalesce(vdi.quantidade,0), coalesce(vdi.desconto,0), vdi.sequencia
            from fat_vendas_itens vdi
            where vdi.vendedor = :cod_vendedor and vdi.cnpj = :cnpj and vdi.codigo = :mvt_codigo and coalesce(vdi.com_gerada,'N') = 'N'
            into :cod_produto, :prc_custo, :CUSTO_MEDIO, :prc_unitario, :quantidade, :desconto, :sequencia
        do
        begin
             atualiza_comissao = 'S';

             /*encontrando o vlr. liquido do item*/
             if (custo_medio <= 0) then
             begin
               custo_medio = :prc_custo;

               if (custo_medio <= 0) then
               begin
                 /*se não possui preço de custo no item, então vou pegar os valores
                 do cadastro de produtos, ..custo medio, ..prc-custo, ..prc-venda*/
                 select coalesce(valor,0) from pcd_cm_custo_medio(:cnpj,:cod_produto)
                 into :custo_medio;

                 /*senão tiver jeito memo.. pego o preço de venda do item...*/
                 if (:custo_medio <= 0) then
                    custo_medio = :prc_unitario;
               end
             end

             CUSTO_MEDIO = :CUSTO_MEDIO * :quantidade;
             prc_custo = :prc_custo * :quantidade;

             ttl_item = (:prc_unitario - :desconto) * :quantidade;
             ttl_item = ttl_item + ((((ttl_item * 100)/:mvt_total) * :desc_acres)/100.00);
    
             /*encontrando o Lucro para se localizar a faixa */
             pct_descto_item =  ((:CUSTO_MEDIO * 100)/:ttl_item);
             pct_descto_item = (100 - :pct_descto_item);
        
             if (:lucro_item is null) then
             begin
               update fat_vendas_itens vdi set vdi.lucro_item = :pct_descto_item
               where vdi.cnpj = :cnpj and vdi.produto = :cod_produto and vdi.codigo = :mvt_codigo;
             end

             if (:pct_descto_item < 0 ) then
               gamb = cast(0.00 as varchar(50));
             else
               gamb = cast(:pct_descto_item as varchar(50));

             /*lozalizando a faixa e os valores de comissão*/
             select cmd.codigo, cmd.pct_prazo, cmd.pct_vista, cmd.pct_inicial, cmd.pct_final
             from cm_perfil_faixa_desc cmd
             where cmd.cnpj = :cnpj and (:gamb between cmd.pct_inicial and cmd.pct_final)
             and cmd.cod_perfil_faixa = :cm_cod_faixa
             into :cm_cod_fx_dc, :pct_prazo, :pct_vista, :log_fx_d_inicial, :log_fx_d_final;

             LOG_PCT_PRAZO = :pct_prazo;
             LOG_PCT_VISTA = :pct_vista;

             /*se o produto for uma exceção ele vai se encontrar aqui*/
             for select cmp.pct_prod_prazo, cmp.pct_prod_vista  from cm_perfil_faixa_prod cmp
                 where cmp.cnpj = :cnpj and cmp.cod_perfil_fx_desc = :cm_cod_fx_dc and cmp.cod_produto = :cod_produto
                 into :pct_prazo, :pct_vista
             do
             begin
               LOG_PCT_PRAZO_PRD = :pct_prazo;

               LOG_PCT_VISTA_PRD = :pct_vista;
             end
    
             /*modificado conforme o requisito da fert flora, de passar a utilizar o lucro
             ao invés do desconto*/
             vlr_item_prazo = ((:mvt_pct_prazo * :ttl_item)/100);
             vlr_item_ant_prazo = ((:pct_ant_prazo * :ttl_item)/100);
             vlr_item_vista = ((:MVT_pct_vista * :ttl_item)/100);

             /*venda
             if (:base_calc = 1) then
             begin
               vlr_item_prazo = ((:mvt_pct_prazo * :ttl_item)/100);
               vlr_item_ant_prazo = ((:pct_ant_prazo * :ttl_item)/100);
               vlr_item_vista = ((:MVT_pct_vista * :ttl_item)/100);
             end
             else /*lucro
             begin
               vlr_item_prazo = ((:mvt_pct_prazo * (:ttl_item - :prc_custo))/100);
               vlr_item_ant_prazo = ((:pct_ant_prazo * (:ttl_item - :prc_custo))/100);
               vlr_item_vista = ((:MVT_pct_vista * (:ttl_item - :prc_custo))/100);
             end  */

             /*com prazo*/
             log_com_prazo_prd = ((:pct_prazo * :vlr_item_prazo)/100);
             vdi_ttl_com_p = vdi_ttl_com_p + log_com_prazo_prd;
    
             /*com a prazo antecipada*/
             log_com_vista_prd = ((:pct_prazo * :vlr_item_ant_prazo)/100);

             /*!!!#Atenção#!!! usado somente para salvar o log corretamente*/
             LOG_AUX_COM_VISTA_PRD = log_com_vista_prd;
             vdi_ttl_com_v = vdi_ttl_com_v + log_com_vista_prd;

             /*com vista*/
             log_com_vista_prd = ((:pct_vista * :vlr_item_vista)/100);

             /*!!!#Atenção#!!! usado somente para salvar o log corretamente*/
             LOG_AUX_COM_VISTA_PRD = LOG_AUX_COM_VISTA_PRD + log_com_vista_prd;

             vdi_ttl_com_v = vdi_ttl_com_v + log_com_vista_prd;


         /*------------------------------------Guardando o Log de Cada Item------------------------------*/
         insert into cm_log (CNPJ, COD_VENDA, COD_PRODUTO, SEQUENCIA, P_CODIGO, P_PERFIL, P_BASE_CALC,
                            P_FX_CODIGO, P_FX_VLR_INICIAL, P_FX_VLR_FINAL,
                            P_FX_D_CODIGO, P_FX_D_PCT_INI, P_FX_D_PCT_FIN, P_FX_D_PCT_VISTA, P_FX_D_PCT_PRAZO,
                            P_FX_D_PRD_CODIGO, P_FX_D_PRD_PCT_VISTA, P_FX_D_PRD_PCT_PRAZO,
                            TTL_FATURAMENTO, TTL_DESCTO_ITEM, DT_INICIAL, DT_FINAL, COM_VISTA, COM_PRAZO, USUARIO)
                     values(:cnpj, :mvt_codigo, :cod_produto, :sequencia,:cm_cod_perfil, :log_nome_perfil, :base_calc,
                            :cm_cod_faixa, :log_fx_inicial, :log_fx_final,
                            :cm_cod_fx_dc, :log_fx_d_inicial,:log_fx_d_final, :log_pct_vista, :log_pct_prazo,
                            :log_cod_fx_dc_prd, :log_pct_vista_prd, :log_pct_prazo_prd,
                            :ttl_movimento, :pct_descto_item, :dt_inicial, :dt_final, :log_aux_com_vista_prd, :log_com_prazo_prd, :usuario);


        end

        if (atualiza_comissao = 'S') then
        begin
            /*marcando o item como comissão gerada */
            update fat_vendas_itens vdi set vdi.com_gerada = 'S'
            where vdi.vendedor = :cod_vendedor and vdi.codigo = :mvt_codigo and vdi.cnpj = :cnpj ;
    
            /*salvando a média aritimética de desconto na comissão*/
            select avg(vdi.lucro_item) from fat_vendas_itens vdi
            where vdi.vendedor = :cod_vendedor and vdi.codigo = :mvt_codigo and vdi.cnpj = :cnpj
            into :pct_descto_item;

            /*quantos parcelamentos existem (prazo)*/
            select count(*) from cm_comissao c
            inner join cm_comissao_parc cp on (cp.cnpj = c.cnpj and c.codigo = cp.cod_comissao)
            where c.cod_venda = :mvt_codigo and c.cod_vendedor = :cod_vendedor and cp.cod_receber is not null
            and c.cnpj = :cnpj
            into :cont;
        
            /*-----------lançando os valores a prazo-----------*/
            if (:cont > 0) then
            begin
              vdi_ttl_com_p = (:vdi_ttl_com_p/cont);
              for select cp.codigo from cm_comissao c
                  inner join cm_comissao_parc cp on (cp.cnpj = c.cnpj and c.codigo = cp.cod_comissao)
                  where c.cod_venda = :mvt_codigo and c.cod_vendedor = :cod_vendedor and cp.cod_receber is not null
                  and c.cnpj = :cnpj
                  into :cod_comissao_parc
              do
              begin
                if (:vdi_ttl_com_p = 0) then
                  status = 'N';
                else
                  status = 'G';

                /*atualizando os registros com o valor a prazo rateado*/
                update cm_comissao_parc p set p.cod_perfil_pagto = :perfil_pagto, p.pct_lucro_item = :pct_descto_item, p.vlr_total = :vdi_ttl_com_p, p.status = :status
                where p.cnpj = :cnpj and p.codigo = :cod_comissao_parc;
              end
            end
        
            /*---------------------lançando os valores à vista-----------------------*/
            select c.codigo from cm_comissao c
            where c.cod_venda = :mvt_codigo and c.cod_vendedor = :cod_vendedor and c.cnpj = :cnpj
            into :cod_comissao;
        
            /* Aina não há cabeçalho.. logo ta criando um á vista..*/
            if (:cod_comissao is null) then
            begin
              cod_comissao = GEN_ID(GEN_CM_COMISSAO_ID,1);
              insert into cm_comissao(cnpj,codigo,cod_venda,cod_vendedor,pessoa_fj, pct_lucro_item,cod_perfil_pagto)
              values(:cnpj, :cod_comissao, :mvt_codigo, :cod_vendedor,:pessoa_fj, :pct_descto_item, :perfil_pagto);
            end
        
            /*Só será lançado a parcela do percentual a vista, caso exista um
            valor a ser comssionado, estava acontecendo que vendas à prazo mas de vendedores
            que possuiam antecipação de comissão "recebessem 0 a vista" mesmo que o lucro destes
            não permitisse comissionamento*/
            if (:vdi_ttl_com_v > 0) then
            begin
               if (:vdi_ttl_com_v = 0) then
                 status = 'N';
               else
                 status = 'G';

               insert into cm_comissao_parc(cnpj,cod_comissao,pct_pago,pct_liberado,status,vlr_total,pct_lucro_item,cod_perfil_pagto)
               values(:cnpj,:cod_comissao,100,100,:status, :vdi_ttl_com_v,:pct_descto_item, :perfil_pagto);
            end
    
            update cm_comissao set cod_perfil_pagto = :perfil_pagto, pct_lucro_item = :pct_descto_item, dt_geracao = cast('today' as date), status = :status, pct_antecipacao = :pct_ant_prazo
            where codigo = :cod_comissao and cnpj = :cnpj;
        end
      end
    end/*final if total mvto > 0*/

  end
END
^

ALTER PROCEDURE PCD_GERA_COTACOES (
    DATA DATE)
AS
DECLARE VARIABLE MOEDA INTEGER;
begin
  for select md.codigo from fin_moeda md
      where md.utiliza_indexador = 'S'
      into :moeda
  do
  begin
     insert into fin_cotacoes(cod_moeda, data)
     values (:moeda,:data);
  end
  suspend;
end
^

ALTER PROCEDURE PCD_GERA_CPAGAR (
    CNPJ VARCHAR(15),
    VDD INTEGER,
    CENTRO_CUSTO INTEGER,
    DT_VENCTO DATE)
AS
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE COD_PARC_COM INTEGER;
DECLARE VARIABLE COD_RECEBER INTEGER;
DECLARE VARIABLE COD_RECEBIDA INTEGER;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE PARCELA VARCHAR(6);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE PCT_LIBERADO NUMERIC(18,4);
begin
  /*genrando contas à pagar*/
  for select sum((cmp.vlr_total * cmp.pct_liberado)/100.00), cm.cod_vendedor from cm_comissao_parc cmp
      inner join cm_comissao cm on (cm.cnpj = cmp.cnpj and cm.codigo = cmp.cod_comissao)
      where cmp.cnpj = :cnpj and cmp.status = 'G'  and (:vdd = 0 or cm.cod_vendedor = :vdd)
      group by cm.cod_vendedor
      into :total, :vendedor
  do
  begin
    /*só irá gerar contas à pagar se houver um vlr. a gerar*/
    if (:total > 0) then
    begin
        select vdd.pessoa_fj from fat_vendedor vdd
        where vdd.cnpj = :cnpj and vdd.codigo = :vendedor
        into :pessoa_fj;
    
        /*conta à pagar.....*/
        select (max(codigo)+1) from fin_contas_pagar pgr
        where pgr.cnpj = :cnpj
        into :codigo;
    
        if (:codigo is null) then
          codigo = 1;
    
        dt_emissao = cast('today' as date);
        dt_lancto = cast('today' as date);
        ano = extract (year from :dt_emissao);
        parcela = '1/1';
    
        /*conta à pagar*/
        insert into fin_contas_pagar
               (cnpj,codigo,ano,pessoa_fj,dt_emissao,dt_vencto,dt_lancto,parcela,
               historico,valor,origem,centro_custo,CONFERIDA,SELECIONADO,DOCTO,BOLETO)
        values(:cnpj,:codigo,:ano,:pessoa_fj,:dt_emissao,:dt_vencto, :dt_lancto, :parcela,
              :historico,:total,'CMS',:centro_custo,'N','N','','N');

        for select cmp.codigo, cmp.pct_liberado, cmp.cod_receber from cm_comissao_parc cmp
            inner join cm_comissao cm on (cm.cnpj = cmp.cnpj and cm.codigo = cmp.cod_comissao)
            where cmp.cnpj = :cnpj and cmp.status = 'G'  and cm.cod_vendedor = :vendedor and cmp.pct_liberado > 0
            into :cod_parc_com, :pct_liberado, :cod_receber
        do
        begin
           /*essa tabela foi feita em primeira ordem para guardar o relacionamento
           de pagar e comissoes.. serve para evitar cancelamento de comissoes
           que possuem baixas ou mesmo contas à pagar.. um dia talvez ela deixe
           de existir*/
           insert into cm_parc_pagar(cnpj,cod_parc_com,cod_pagar,pct_liberado)
                             values (:cnpj,:cod_parc_com,:codigo,:pct_liberado);

           /*preciso vincular o contas à pagar com a baixa de contas à receber
           que originou estes valores para a aquitação*/
           for select codigo from fin_baixas_receber bx
               where bx.codigo_cr = :cod_receber and bx.cnpj = :cnpj
               into :cod_recebida
           do
           begin
             /*atualizando a relação, marcando todos que não tiverem contas à */
             update cm_rel_com_pgr_rec rel set rel.cod_pagar = :codigo
             where rel.cnpj = :cnpj and rel.cod_recebida = 1 and rel.cod_pagar is null;
           end
        end
    end
  end



  /*atualizando vlr. liberados.. existe um triquer que irá dizer se a parcela esta quitada ou não*/
  update cm_comissao_parc cmp set cmp.pct_liberado = 0
  where cmp.cnpj = :cnpj and cmp.status = 'G' and
  cmp.cod_comissao in (select codigo from  cm_comissao cm where cm.cnpj = :cnpj and (:vdd = 0 or cm.cod_vendedor = :vdd));
END
^

ALTER PROCEDURE PCD_GERA_EST_KARDEX (
    CNPJ VARCHAR(18),
    PESSOA INTEGER,
    CODIGO INTEGER,
    OLD_ENVIADA CHAR(1),
    NEW_ENVIADA CHAR(1),
    OLD_CANCELADA CHAR(1),
    NEW_CANCELADA CHAR(1),
    MOVEST CHAR(1),
    ENTSAID CHAR(1),
    NEW_DATA DATE,
    NEW_NF INTEGER,
    OLD_NF INTEGER,
    NEW_LOCAL INTEGER,
    OLD_LOCAL INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE ORIGEM CHAR(6);
DECLARE VARIABLE ORIGEM_FISCAL CHAR(1);
DECLARE VARIABLE TIPO_KDX CHAR(1);
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE QUANT_ANT NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDE_FISCAL NUMERIC(18,4);
DECLARE VARIABLE QUANT_AUX NUMERIC(18,4);
DECLARE VARIABLE PRECO_UNT NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE NUMERO CHAR(6);
DECLARE VARIABLE LOTE INTEGER;
DECLARE VARIABLE UTILIZA_GRADE CHAR(1);
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE MOV_ESTOQUE CHAR(1);
DECLARE VARIABLE MOV_ESTOQUE_FISCAL CHAR(1);
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE COD_KARDEX INTEGER;
begin
 /*se a NAT movimenta estoque e se houve alguma mudança no status do registro
  então vai gerar kardex e outros procedimentos referente ao estoque*/
  select coalesce(est_utiliza_grades,'N') from sis_configuracoes where cnpj = :cnpj
  into :utiliza_grade;

  /*movimenta estoque*/
  select nat.codigo, coalesce(nat.mov_estoque,'N'), coalesce(nat.mov_estoque_fiscal,'S') from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
  where vd.codigo = :codigo and vd.cnpj = :cnpj
  into :cfop, :mov_estoque, :mov_estoque_fiscal;

  /* bloco utilizado para vendas faturadas no que vem do balcão com local 2
  e ao chegar no caixa o usuario opta por emitir NF. Portanto, esse bloco
  atualiza o estoque fiscal e o kardex gerado no balcao. */
  if ((:mov_estoque = 'S') and (:new_enviada = 'S' and :old_enviada = 'S')
  and (:NEW_NF < :OLD_NF)) then
  begin
        for select prd.codigo, vdi.quantidade
        from fat_vendas_itens vdi
        inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
        where vdi.codigo = :codigo and vdi.cnpj = :cnpj
        into :produto, :QUANTIDADE
        do begin
             if ((coalesce(:new_nf,0) <= 0) and (coalesce(:old_nf,0) > 0)) then
               quantidade = (:quantidade * -1);

             select max(codigo) from est_kardex
             where produto = :produto and ndocto = cast(:codigo as varchar(20)) and
             pessoa_fj = :PESSOA and origem = 'VD'
             into :COD_KARDEX;

             update est_kardex k set k.origem = 'VDF'
             where k.codigo = :COD_KARDEX and k.cnpj = :cnpj;

             if (:mov_estoque = 'N') then
                     quantidade = 0;

             update est_produtos p set p.qtdade_1 = p.qtdade_1 - :QUANTIDADE
             where p.codigo = :produto and p.cnpj = :cnpj;

        end
  end

  /* processo normal de geração de kardex no balcão */
  if (((:movest = 'S') or (:mov_estoque = 'S'))  and ((:new_enviada <> :old_enviada) or (:new_cancelada <> :old_cancelada))) then
  begin
    /*Venda normal, estava aberta e agora foi fechada*/
    if ((:new_enviada = 'S') and (:old_enviada = 'N')) then
    begin
              /*----------------------------------------------------*/
              IF (:NEW_LOCAL = 1)THEN
                ORIGEM_FISCAL = 'F';
              else
                ORIGEM_FISCAL = '';
              /*----------------------------------------------------*/
              origem = 'VD' || :ORIGEM_FISCAL;

              if(entsaid = 'S') then
                tipo_kdx = 'S';
              else
                tipo_kdx = 'E';
    end /* volta para o balcao */
    else if ((:new_enviada = 'N') and (:old_enviada ='S')) then
    begin
              /*----------------------------------------------------*/
              IF (:NEW_LOCAL = 1 )THEN
                ORIGEM_FISCAL = 'F';
              else
                ORIGEM_FISCAL = '';        
              /*----------------------------------------------------*/
              origem = 'VD' || :ORIGEM_FISCAL || '-E';
              /*era um movimento de saída*/
              if (entsaid = 'S') then
                  tipo_kdx = 'E';
              else
                  tipo_kdx = 'S';
    end
    else if ((:new_cancelada = 'S') and (:old_cancelada = 'N')) then
    begin
              /*----------------------------------------------------*/
              IF (:NEW_LOCAL = 1 )THEN
                ORIGEM_FISCAL = 'F';
              else
                ORIGEM_FISCAL = '';        
              /*----------------------------------------------------*/
              origem = 'VD' || :ORIGEM_FISCAL || '-C';
              /*era um movimento de saída*/
              if (entsaid = 'S') then
                  tipo_kdx = 'E';
              else
                  tipo_kdx = 'S';  
    end
    else if ((:new_cancelada = 'N') and (:old_cancelada = 'S')) then
    begin   /*vendas canceladas que voltaram a ficar ativas, ou seja estorno de cancelamentos*/
              /*----------------------------------------------------*/
              IF (:NEW_LOCAL = 1 )THEN
                ORIGEM_FISCAL = 'F';
              else
                ORIGEM_FISCAL = '';        
              /*----------------------------------------------------*/
              origem = 'VD' || :ORIGEM_FISCAL || '-CE';
              /*era um movimento de saída*/
              if (entsaid = 'S') then
                  tipo_kdx = 'S';
              else
                  tipo_kdx = 'E';
    end
    /* ====================================== */
    ano = extract (year from :new_data);
    mes = extract (month from :new_data);
    ndocto = cast(:codigo as varchar(20));
    /* ====================================== */

    for select vdi.produto,   coalesce(vdi.quantidade,0), coalesce(vdi.quantidade,0),
        coalesce(vdi.prc_unitario,0),
        coalesce(vdi.desconto,0), vdi.unidade, vdi.subunidade,
        vdi.grade, vdi.numero, coalesce(vdi.codigo_lote,0)
    from fat_vendas_itens vdi
    where vdi.codigo = :codigo and vdi.cnpj = :cnpj
    into :produto,  :quantidade, :QUANT_AUX,
    :preco_unt, :desconto, :unidade,
    :subunidade, :grade, :numero, :lote
    do
    begin
            qtde_fiscal = :quantidade;

            select prd.qtdade_2 from est_produtos prd
            where prd.codigo = :produto and prd.cnpj = :cnpj
            into :quant_ant;

            /*atualizando kardex*/
            insert into est_kardex (cnpj, produto, ndocto,
                                    dt_movto, mes, ano,
                                    origem, tipo_es, pessoa_fj,
                                    qtdade_ant, qtdade, prc_unit,
                                    descontos, cfop, cfop_estoque)
            values                 (:cnpj, :produto, :ndocto,
                                    :new_data, :mes, :ano,
                                    :origem, :tipo_kdx, :pessoa,
                                    :quant_ant, :quantidade, :preco_unt,
                                    :desconto, :cfop, :mov_estoque);


            /*modificando o valor dependendo do tipo de movimento*/
            if (tipo_kdx = 'S') then
                  quantidade = (:quantidade ) * -1;
            else
                  quantidade = (:quantidade );

          
             /*atualizando lote do produto caso este possua*/
             if (:lote > 0) then
             begin
                  update est_lote_produto l
                  set l.estoque = l.estoque + :quantidade
                  where l.cnpj = :cnpj and l.produto = :produto and l.codigo = :lote;
             end
      
             select count(*) from est_produtos_grades g
             where g.produto = :produto and g.cnpj = :cnpj
             into :existe;
      
             /*atualizando grade do produto*/
             IF ((:utiliza_grade = 'S') and (:existe > 0))then
             begin
                   /* debita do estoque fiscal, caso a venda com grade for fiscal*/
                  if (:new_local = 1) then
                  begin
                      if (tipo_kdx = 'S') then
                        quant_aux = (:quant_aux *  -1);
                      else
                        quant_aux = (:quant_aux);

                      if (:mov_estoque = 'N') then
                         quant_aux = 0;

                      update est_produtos prd set prd.qtdade_1 = coalesce(prd.qtdade_1,0) + :quant_aux
                      where prd.cnpj = :cnpj and prd.codigo = :produto;
                  end

                  /*atualizar grades números.. irá atualizar grades.. que vai atualizar produtos*/

                  if (:mov_estoque = 'N') then
                     quantidade = 0;

                  update est_produtos_grades_numeros
                  set estoque = estoque + :quantidade
                  where cnpj = :cnpj and produto = :produto and grade = :grade and
                  numero = :numero;

                  grade  = null ;
                  numero = null ;
             end
             else begin
                  if (:mov_estoque = 'N') then
                     qtde_fiscal = 0;

                  if (:mov_estoque = 'N') then
                     quantidade = 0;

                   /*======[ Se haver NF ]=============*/
                   if (:new_local = 1) then
                   begin
                       update est_produtos prd set prd.qtdade_2 = coalesce(prd.qtdade_2,0) + :quantidade,
                       prd.qtdade_1 = coalesce(prd.qtdade_1,0) + :qtde_fiscal
                       where prd.cnpj = :cnpj and prd.codigo = :produto;
                   end
                   else begin
                       update est_produtos prd set prd.qtdade_2 = coalesce(prd.qtdade_2,0) + :quantidade
                       where prd.cnpj = :cnpj and prd.codigo = :produto;
                   end
             end
    end
  end /*temos de acertar o estoque pois feito uma devolução ou um estorno da venda*/
END
^

ALTER PROCEDURE PCD_GERA_LEITURAS_AUT (
    CNPJ VARCHAR(14),
    DATA_REFERENCIA DATE)
RETURNS (
    CONT INTEGER)
AS
DECLARE VARIABLE CONTRATO INTEGER;
DECLARE VARIABLE COD_LEITURA INTEGER;
begin
  /*for select ct.codigo from ofc_contratos ct
      where ct.ativo = 'S' and ct.gera_leitura = 'S' and ct.cnpj = :cnpj
      and 0 = (select count(*) from ofc_grp_contratos_itens gpi where gpi.cnpj = :cnpj and gpi.pessoa_fj = CT.cod_cliente)
      /*ignorar todos os contratos que pertecerem a um grupo empresarial
      and 0 = (select count(*) from ofc_grp_contratos gp where gp.cnpj = :cnpj and gp.cod_cliente = CT.cod_cliente)
      into :contrato
  do
  begin
    /*gerando cabeçalho das leituras
    cod_leitura = GEN_ID(GEN_OFC_LEITURAS_ID,1);
    insert into ofc_leituras(CNPJ, CODIGO, CONTRATO, DATA_REFERENCIA, FECHADA, GERA_FATURAMENTO)
    values (:cnpj, :cod_leitura, :contrato, :data_referencia, 'N','N');

    /*gerando itens da leitura - que NÃO tem grupo empresarial
    execute procedure pcd_ofc_leitura_gera_itens(:cnpj,:contrato,:cod_leitura,:data_referencia,0);
  end  */
  cont = 1;
  for select gp.codigo from ofc_grp_contratos gp
      where gp.cnpj = :cnpj  /*and gp.codigo = 184  */
      into :contrato
  do
  begin
    if (:contrato = 2) then
      contrato = 2;

    /*gerando cabeçalho das leituras*/
    cod_leitura = GEN_ID(GEN_OFC_LEITURAS_ID,1);
    insert into ofc_leituras(CNPJ, CODIGO, CONTRATO, DATA_REFERENCIA, FECHADA, GERA_FATURAMENTO)
    values (:cnpj, :cod_leitura, :contrato, :data_referencia, 'N','N');

    execute procedure pcd_ofc_leitura_gera_itens(:cnpj,:contrato,:cod_leitura,:data_referencia,1);
  end

  suspend;
END
^

ALTER PROCEDURE PCD_GERA_MENSALIDADE_AUT (
    CNPJ VARCHAR(14),
    DATA_REFERENCIA DATE)
AS
DECLARE VARIABLE CONTRATO INTEGER;
DECLARE VARIABLE COD_MENSALIDADE INTEGER;
DECLARE VARIABLE VALOR_CONTRATO NUMERIC(18,4);
DECLARE VARIABLE VALOR_INDEXADOR NUMERIC(18,4);
DECLARE VARIABLE COD_INDEXADOR INTEGER;
DECLARE VARIABLE DT_INDEXADOR DATE;
begin
  for select ct.codigo, ct.VALOR_CONTRATO/*, ct.cod_indexador */
      from ofc_contratos ct

      where ct.ativo = 'S' and ct.gera_mensalidade = 'S' and ct.cnpj = :cnpj
      into :contrato, :valor_contrato/*, :cod_indexador */
  do
  begin
    select max(data) from fin_cotacoes c
    where c.cod_moeda = :cod_indexador
    into :dt_indexador;

    select coalesce(C.valor,1) from fin_cotacoes c
    where c.cod_moeda = :cod_indexador and c.data = :dt_indexador
    into :valor_indexador;

    valor_contrato = (:valor_contrato * :valor_indexador);

    /*gerando cabeçalho das mensalidades*/
    cod_mensalidade = GEN_ID(GEN_OFC_MENSALIDADES_ID,1);
    insert into ofc_mensalidades(CNPJ, CODIGO, CONTRATO, DATA_REFERENCIA, FECHADA, GERA_FATURAMENTO, valor_mensalidade)
    values (:cnpj, :cod_mensalidade, :contrato, :data_referencia,'N','S', :valor_contrato);

    /*gerando itens da leitura*/
    execute procedure pcd_ofc_mensalidades_gera_itens(:cnpj,:contrato,:cod_mensalidade,:data_referencia);
  end
  suspend;
END
^

ALTER PROCEDURE PCD_GERA_TABELA_ALTERACAO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    MARCA INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    PRODUTO VARCHAR(15),
    MARGEM NUMERIC(18,4),
    INCREMENTAL CHAR(1))
AS
DECLARE VARIABLE TBL_PRODUTO VARCHAR(15);
DECLARE VARIABLE TBL_PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE TBL_PRC_CUSTO NUMERIC(18,4);
begin
  /*exlcuindo os anteriores para gerar novamente*/
  if (coalesce(:incremental,'N') = 'N') then
    delete from est_altera_preco_item  where cnpj = :cnpj and cod_altera_preco = :codigo;

  for select prd.codigo, prd.prc_venda, prd.prc_custo_ant
      from est_produtos prd
      where prd.cnpj = :cnpj and prd.ativo = 'S'
      and (prd.codigo = :produto or :produto = '')
      and (prd.marca = :marca or :marca = 0)
      and (prd.grupo = :grupo or :grupo = 0)
      and (prd.subgrupo = :sub_grupo or :sub_grupo = 0)
      into :tbl_produto,:tbl_prc_venda, :tbl_prc_custo
  do
  begin
     insert into est_altera_preco_item(cnpj,cod_altera_preco,produto,vlr_anterior,vlr_atual,margem)
     values(:cnpj,:codigo,:tbl_produto,:tbl_prc_custo,:tbl_prc_venda,:margem);
  end
END
^

ALTER PROCEDURE PCD_GERA_TABELA_PRECO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    MARCA INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    PRODUTO VARCHAR(15),
    MARGEM NUMERIC(18,4),
    INCREMENTAL CHAR(1))
AS
DECLARE VARIABLE TBL_PRODUTO VARCHAR(15);
DECLARE VARIABLE TBL_PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE TBL_PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO_MAXIMO NUMERIC(18,4);
DECLARE VARIABLE DT_INI DATE;
DECLARE VARIABLE DT_FIM DATE;
begin
  select tbl.iniciovigencia, tbl.fimvigencia from fat_tabelapreco tbl
  where tbl.cnpj = :cnpj and tbl.codigo = :codigo
  into :dt_ini, :dt_fim;

  select e.desconto_maximo from sis_empresas e
  where e.cnpj = :cnpj
  into :desconto_maximo;

  /*exlcuindo os anteriores para gerar novamente*/
  if (coalesce(:incremental,'N') = 'N') then
    delete from fat_itemtabelapreco  where cnpj = :cnpj and cod_tabelapreco = :codigo;

  for select prd.codigo, prd.prc_venda, prd.prc_custo_ant
      from est_produtos prd
      where prd.cnpj = :cnpj and prd.ativo = 'S'
      and (prd.codigo = :produto or :produto = '')
      and (prd.marca = :marca or :marca = 0)
      and (prd.grupo = :grupo or :grupo = 0)
      and (prd.subgrupo = :sub_grupo or :sub_grupo = 0)
      into :tbl_produto,:tbl_prc_venda, :tbl_prc_custo
  do
  begin
     insert into fat_itemtabelapreco(cnpj,cod_tabelapreco,produto,precocusto,valor,margemutilizado, datainiciovigencia, datafimvigencia,precosugerido,descontomaximo)
     values(:cnpj,:codigo,:tbl_produto,:tbl_prc_custo,:tbl_prc_venda,:margem, :dt_ini, :dt_fim, :tbl_prc_venda,:desconto_maximo);
  end
END
^

ALTER PROCEDURE PCD_GERA_TITULOS (
    CNPJ VARCHAR(14))
RETURNS (
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    BLT_CARTEIRA VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_MULTA NUMERIC(18,4),
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    REC_DESCONTO NUMERIC(18,4),
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE,
    BLT_NUM_IMP INTEGER,
    COD_RECEBER INTEGER,
    FTR_COD_CLIENTE INTEGER,
    FTR_VENDEDOR INTEGER,
    FTR_REGIAO INTEGER,
    FTR_LOCAL_COB INTEGER,
    FTR_CLASSIFICACAO INTEGER)
AS
DECLARE VARIABLE VAR_ENDERECO INTEGER;
DECLARE VARIABLE VAR_BAIRRO INTEGER;
DECLARE VARIABLE VAR_CIDADE INTEGER;
begin
  /*dados do boleto*/
   select emp.blt_agencia, emp.blt_dig_agencia, emp.blt_conta, emp.blt_dig_conta,
          emp.blt_carteira, emp.blt_cod_cedente, emp.blt_dig_cod_cedente,
          emp.blt_convenio, emp.blt_instrucao, emp.blt_layout, emp.blt_local_pagto,
          emp.BLT_ACEITE_DOCTO, emp.BLT_DIAS_ABATIMENTO, emp.BLT_DIAS_DESCONTO,
          emp.BLT_DIAS_MORA_JUROS, emp.BLT_DIAS_PROTESTO, emp.BLT_PCT_ABATIMENTO,
          emp.BLT_PCT_DESCONTO, emp.desp_bancaria, emp.BLT_VLR_IOF, emp.mora_diaria,
          emp.BLT_VLR_OUTRAS_DESP, emp.BLT_MULTA
          from sis_empresas emp where cnpj = :cnpj
   into :blt_agencia, :blt_dig_agencia, :blt_conta, :blt_dig_conta, :blt_carteira,
        :ced_codigoced, :ced_dig_codigoced , :blt_convenio, :blt_instrucao,:blt_layout,:blt_local_pagto,
        :blt_aceite_docto, :blt_dias_abatimento, :blt_dias_desconto,
        :blt_dias_mora_juros, :blt_dias_protesto, :blt_pct_abatimento,
        :blt_pct_desconto, :blt_vlr_despesa, :blt_vlr_iof, :blt_vlr_mora_juros,
        :blt_vlr_outras_desp, :blt_multa;

    for select psa.nome_razao, psa.complemento, psa.numero, psa.email,
        psa.cep, psa.pessoa, psa.cpf_cgc, psa.bairro, psa.cidade,
        psa.endereco, rec.valor, rec.dt_vencto, rec.DT_LANCTO,
        rec.blt_nosso_num, rec.vlr_parcial, rec.descontos, rec.data_ult_baixa, rec.blt_num_imp,
        rec.codigo, rec.pessoa_fj
        from fin_contas_receber rec
        inner join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and rec.cnpj = psa.cnpj)
        inner join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
        left  join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
        where rec.cnpj = :cnpj
    into
       :sac_nome, :sac_complemento, :sac_num, :sac_email,
       :sac_cep, :sac_pessoa, :sac_cpf_cgc, :var_bairro,:var_cidade,
       :var_endereco, :blt_valor, :blt_dt_vencto, :blt_dt_lancto,
       :nosso_numero, :rec_vlr_parcial, :rec_desconto, :rec_data_ult_baixa, :blt_num_imp,
       :cod_receber, :ftr_cod_cliente
    do
    begin

        select lrg.nome from glo_logradouros lrg where lrg.codigo = :var_endereco and lrg.cnpj = :cnpj
        into :sac_rua;
  
        select br.nome from glo_bairros br where br.codigo = :var_bairro and br.cnpj = :cnpj
        into :sac_bairro;
  
        select cdd.nome, cdd.uf from glo_cidades cdd where cdd.codigo = :var_cidade and cdd.cnpj = :cnpj
        into :sac_cidade, :sac_uf;
  
        select b.codigo, b.nome from fin_banco b  where b.padrao_boleto = 'S'
        into :blt_banco, :blt_nome_banco;
       suspend;
    end
END
^

ALTER PROCEDURE PCD_GERA_TITULOS_PERIODO (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    SAC_NOME VARCHAR(50),
    SAC_RUA VARCHAR(50),
    BLT_CONVENIO VARCHAR(10),
    SAC_COMPLEMENTO VARCHAR(50),
    SAC_NUM VARCHAR(15),
    SAC_EMAIL VARCHAR(80),
    SAC_CEP VARCHAR(8),
    SAC_CIDADE VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_BAIRRO VARCHAR(50),
    SAC_PESSOA CHAR(1),
    SAC_CPF_CGC VARCHAR(14),
    BLT_AGENCIA VARCHAR(10),
    CED_CODIGOCED INTEGER,
    CED_DIG_CODIGOCED CHAR(1),
    BLT_CARTEIRA VARCHAR(10),
    BLT_INSTRUCAO BLOB SUB_TYPE 1 SEGMENT SIZE 80,
    BLT_LAYOUT INTEGER,
    BLT_DIG_CONTA CHAR(1),
    BLT_DIG_AGENCIA CHAR(1),
    BLT_CONTA VARCHAR(10),
    BLT_LOCAL_PAGTO VARCHAR(200),
    BLT_BANCO INTEGER,
    BLT_ACEITE_DOCTO CHAR(1),
    BLT_DIAS_ABATIMENTO INTEGER,
    BLT_DIAS_DESCONTO INTEGER,
    BLT_DIAS_MORA_JUROS INTEGER,
    BLT_DIAS_PROTESTO INTEGER,
    BLT_PCT_ABATIMENTO NUMERIC(18,4),
    BLT_PCT_DESCONTO NUMERIC(18,4),
    BLT_VLR_DESPESA NUMERIC(18,4),
    BLT_VLR_IOF NUMERIC(18,4),
    BLT_VLR_MORA_JUROS NUMERIC(18,4),
    BLT_VLR_OUTRAS_DESP NUMERIC(18,4),
    BLT_VALOR NUMERIC(18,4),
    BLT_DT_LANCTO DATE,
    BLT_DT_VENCTO DATE,
    BLT_NOME_BANCO VARCHAR(50),
    NOSSO_NUMERO BIGINT,
    COD_REC INTEGER,
    PESSOA_FJ INTEGER,
    REC_VLR_PARCIAL NUMERIC(18,4),
    REC_DESCONTOS NUMERIC(18,4),
    REC_DATA_ULT_BAIXA DATE)
AS
DECLARE VARIABLE VAR_ENDERECO INTEGER;
DECLARE VARIABLE VAR_BAIRRO INTEGER;
DECLARE VARIABLE VAR_CIDADE INTEGER;
begin
  /* Procedimento pode ser utilizado para gerar títulos de um determinado período,
  servirá tanto na impressão de vários boletos ou geração de remessa*/

  /*dados do boleto*/
   select emp.blt_agencia, emp.blt_dig_agencia, emp.blt_conta, emp.blt_dig_conta,
          emp.blt_carteira, emp.blt_cod_cedente, emp.blt_dig_cod_cedente,
          emp.blt_convenio, emp.blt_instrucao, emp.blt_layout, emp.blt_local_pagto,
          emp.BLT_ACEITE_DOCTO, emp.BLT_DIAS_ABATIMENTO, emp.BLT_DIAS_DESCONTO,
          emp.BLT_DIAS_MORA_JUROS, emp.BLT_DIAS_PROTESTO, emp.BLT_PCT_ABATIMENTO,
          emp.BLT_PCT_DESCONTO, emp.desp_bancaria, emp.BLT_VLR_IOF, emp.mora_diaria,
          emp.BLT_VLR_OUTRAS_DESP
          from sis_empresas emp where cnpj = :cnpj
   into :blt_agencia, :blt_dig_agencia, :blt_conta, :blt_dig_conta, :blt_carteira,
        :ced_codigoced, :ced_dig_codigoced , :blt_convenio, :blt_instrucao,:blt_layout,:blt_local_pagto,
        :BLT_ACEITE_DOCTO, :BLT_DIAS_ABATIMENTO, :BLT_DIAS_DESCONTO,
        :BLT_DIAS_MORA_JUROS, :BLT_DIAS_PROTESTO, :BLT_PCT_ABATIMENTO,
        :BLT_PCT_DESCONTO, :BLT_VLR_DESPESA, :BLT_VLR_IOF, :BLT_VLR_MORA_JUROS,
        :BLT_VLR_OUTRAS_DESP;


  for select psa.nome_razao, psa.complemento, psa.numero, psa.email,
      psa.cep, psa.pessoa, psa.cpf_cgc, psa.bairro, psa.cidade,
      psa.endereco, rec.valor, rec.dt_vencto, rec.DT_LANCTO,
      rec.blt_nosso_num, rec.codigo, rec.pessoa_fj, rec.vlr_parcial, rec.descontos,
      rec.data_ult_baixa
      from fin_contas_receber rec
      inner join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and psa.cnpj = rec.cnpj)
      where rec.cnpj = :cnpj and (rec.dt_vencto between :dt_ini and :dt_fin)
      and rec.blt_rem_gerada = 'N' and rec.fatura is null
  into
    :sac_nome, :sac_complemento, :sac_num, :sac_email,
    :sac_cep, :sac_pessoa, :sac_cpf_cgc, :var_bairro,:var_cidade,
    :var_endereco, :blt_valor, :blt_dt_vencto, :blt_dt_lancto,
    :nosso_numero,  :cod_rec, :pessoa_fj, :rec_vlr_parcial, :rec_descontos,
    :rec_data_ult_baixa
  do
  begin
      select lrg.nome from glo_logradouros lrg where lrg.codigo = :var_endereco and lrg.cnpj = :cnpj
      into :sac_rua;

      select br.nome from glo_bairros br where br.codigo = :var_bairro and br.cnpj = :cnpj
      into :sac_bairro;

      select cdd.nome, cdd.uf from glo_cidades cdd where cdd.codigo = :var_cidade and cdd.cnpj = :cnpj
      into :sac_cidade, :sac_uf;

      select b.codigo, nome from fin_banco b where b.padrao_boleto = 'S'
      into  :blt_banco, :blt_nome_banco;
     suspend;
  end
END
^

ALTER PROCEDURE PCD_GMB_CONT_AMERICA (
    CNPJ VARCHAR(15),
    CONTAGEM_GRADE INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QDE NUMERIC(18,4);
DECLARE VARIABLE QDE_ANTIGA NUMERIC(18,4);
DECLARE VARIABLE QDE_KDX NUMERIC(18,4);
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TIPO_KDX CHAR(1);
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE COD_KARDEX INTEGER;
DECLARE VARIABLE COD_OLD_KARDEX INTEGER;
begin
  select e.dt_processamento from est_contagem_grade e
  where e.cnpj = :cnpj and e.codigo = :contagem_grade
  into :data;

  ano = extract (year from data);
  mes = extract (month from data);
  ndocto = cast(:contagem_grade as varchar(20));


  for select c.produto, sum(c.qtde) from est_contagem_grade_produto c
      where c.contagem_grade = :CONTAGEM_GRADE and cnpj = :cnpj
      group by c.produto
      into :produto, :qde
  do
  begin
     cod_kardex = gen_id(est_kardex_ge, 1);

     select max(codigo) from est_kardex k
     where k.codigo < :cod_kardex and k.produto = :produto
     into :cod_old_kardex;
    
     select case k.tipo_es
              when 'E' then k.qtdade_ant + k.qtdade
              when 'S' then k.qtdade_ant - k.qtdade
            end
     from est_kardex k
     where k.codigo = :cod_old_kardex
     into :qde_antiga;

     qde_antiga = coalesce(:qde_antiga,0);

     if (:qde_antiga < :qde)then
     begin
       qde_kdx = (:qde - :qde_antiga);
       tipo_kdx = 'E'; /*Registro como movimento de entrada*/
     end
     else if (:qde_antiga > :qde) then
     begin
       qde_kdx = (:qde_antiga - :qde);
       tipo_kdx = 'S'; /*Registro como movimento de saída*/
     end
     else
     begin
       qde_kdx = 0;
       tipo_kdx = 'N'; /*Neutro*/
     end

    
    
     insert into est_kardex (cnpj, codigo, produto, ndocto,
                             dt_movto, mes, ano,
                             origem, tipo_es,
                             qtdade_ant, qtdade, prc_unit,
                             descontos)
      values              (:cnpj, :cod_kardex, :produto, :ndocto,
                            :data, :mes, :ano,
                            'CNT-G', :tipo_kdx,
                            :qde_antiga, :qde_kdx, 0,
                            0);
    
  end
end
^

ALTER PROCEDURE PCD_GMB_ENCONTRA_ENTRADAS (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    FORNECEDOR VARCHAR(65),
    DATA_NF DATE,
    CODIGO INTEGER,
    PRODUTO VARCHAR(80),
    NUM_NF VARCHAR(20),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    ORIGEM CHAR(3),
    DESCONTO_NOTA NUMERIC(18,4),
    COD_FORN INTEGER,
    CFOP INTEGER,
    TOTAL_NOTA NUMERIC(18,4),
    TOTAL_ITEMS NUMERIC(15,4),
    GERAL_NOTA NUMERIC(18,4),
    GERAL_ITEMS NUMERIC(15,4))
AS
DECLARE VARIABLE REPRESENTA NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DESCONTO_ITEM NUMERIC(18,4);
DECLARE VARIABLE DESCONTO_RATEIO NUMERIC(18,4);
DECLARE VARIABLE AGERAL_NOTA NUMERIC(18,4);
DECLARE VARIABLE AGERAL_ITEMS NUMERIC(18,4);
begin

  Ageral_items = 0;
  Ageral_nota = 0;
  for select ent.data_nf, psa.codigo, psa.nome_razao,
  ent.ndocto, ent.vlr_produtos, ent.vlr_desconto, ent.natureza, ent.pessoa_fj
  from EST_ENTRADAS ent
    inner join glo_pessoas_fj psa on (ent.pessoa_fj = psa.codigo and ent.cnpj = psa.cnpj)
    where ent.cnpj = :cnpj and (ent.data_ent between :dt_inicial and :dt_final)
    into :data_nf, :cod_forn, :fornecedor,:num_nf, :total_nota, :desconto_nota, :cfop, :pessoa_fj
  do
  begin                                                                                                /*  DESCONTOS*/
    origem = 'ENT';
    total_items = 0;
    for select (coalesce(eti.prc_unitario,0) - coalesce(eti.descontos,0)),
        ((coalesce(eti.prc_unitario,0) - coalesce(eti.descontos,0)) * coalesce(eti.quantidade,0)),
         coalesce(eti.quantidade,0) ,(eti.produto ||'-'||prd.nome)
        from EST_ENTRADAS_ITENS eti
        inner join est_produtos prd on (prd.codigo = eti.produto and prd.cnpj = eti.cnpj)
        where eti.ndocto = :num_nf and eti.cnpj = :cnpj and eti.pessoa_fj = :pessoa_fj
        into  :vlr_unitario, :total_item, :qtde, :produto
    do
    begin
      /*rateando o desconto da nota*/
      if (:desconto_nota < 0) then /*desconto sempre negativo*/
      begin
           representa = (:total_item * 100) / :total_nota;
           desconto_rateio = (:representa * :desconto_nota)/100;
           vlr_unitario = :vlr_unitario - :desconto_rateio;
           total_item = :vlr_unitario * :qtde;
      end
      total_items = :total_items + :total_item;
    end

    select * from round2(:total_items) into :total_items;
    select * from round2(:total_nota) into :total_nota;

    if ((:total_items <> :total_nota) and (:total_items > 0)) then
    begin
      suspend;
      Ageral_items = :Ageral_items + :total_items;
      Ageral_nota = :Ageral_nota + :total_nota;
    end

  end
  geral_items = :Ageral_items;
  geral_nota = :Ageral_nota ;
  suspend;
END
^

ALTER PROCEDURE PCD_GMB_FURO_VENDA_ENT (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    TIPO CHAR(1))
RETURNS (
    CODIGO_VD INTEGER,
    RETTOTAL_ITEMS NUMERIC(18,4),
    RETTOTAL_VENDA NUMERIC(18,4),
    FECHADA CHAR(1),
    MOTIVO VARCHAR(50))
AS
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE REP NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE DESC_PROP NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ITEM NUMERIC(18,4);
DECLARE VARIABLE VENDEDOR INTEGER;
begin
     /*Gambiarras pra achar venda pebada*/

     /*Se o usuário quer pesquisar se existe alguma venda sem vendedor, mas tendo vendedor nos itens,
      isso faz com que tenhamos incosistencias entre relatórios que se baseiam em Vendedor nos items(Comissões por faixa)
      e relatórios que usam normalmente o campo vendedor da venda, TAMBÉM encontraá se tiver um vendedor no item e outro
      na venda*/
     if (:tipo = 'V') then
     begin
       for select fv.codigo, fv.fechada, coalesce(fv.total + fv.desc_acres,0), fv.vendedor
           from fat_vendas fv
           inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
           where fv.cnpj = :cnpj and ((fv.data_caixa between :dini  and :dfim) or (fv.data_caixa is null))
           and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
           into :codigo_vd, :fechada, :rettotal_venda, :pessoa_fj
       do
       begin
          for select fvi.vendedor from fat_vendas_itens fvi
          where fvi.codigo = :codigo_vd and fvi.cnpj = :cnpj and fvi.vendedor <> :pessoa_fj
          into :vendedor
          do
          begin
            motivo = 'V. VD: '||cast(:pessoa_fj as varchar(6))||' - '||'V. It: '||cast(:vendedor as varchar(6));
            suspend;
          end
       end 
     end
     else if (:tipo = 'L') then
     begin
       /* verificando se o existem vendas com valores diferentes no total da venda, mais que são diferentes na somatória
       dos itens*/
       for select fv.codigo, fv.fechada, coalesce(fv.total,0),  coalesce(fv.desc_acres,0), fv.pessoa_fj
           from fat_vendas fv
           inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
           where fv.cnpj = :cnpj and ((fv.data_caixa between :dini  and :dfim) or (fv.data_caixa is null))
           and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
           into :codigo_vd, :fechada, :total, :desc_acresc,:pessoa_fj
       do
       begin
           rettotal_items = 0;
           rettotal_venda = (:total + :desc_acresc);
          /*percorrendo itens*/
          for select coalesce(fvi.quantidade,0), coalesce(fvi.prc_unitario,0), coalesce(fvi.desconto,0)
              from  fat_vendas_itens fvi
              where fvi.codigo = :codigo_vd and fvi.cnpj = :cnpj
              into :quantidade, :unitario, :desconto
          do
          begin
            /*até então aqui é desconsiderado o desconto dado na nf. que terá se ser rateado entre os itens*/
            total_item = ((:unitario - :desconto) * :quantidade);
            if (:total > 0) then
            begin
              /*Descobrindo qnto o item representa na NF*/
              rep = (:total_item * 100/:total);
    
              /*Desconto proporcional*/
              desc_prop = (:rep * :desc_acresc/100);
    
              /*Apos descoberto o desconto aplicando no item*/
              total_item = :total_item + :desc_prop;
            end
            rettotal_items = :rettotal_items + :total_item;
          end
          select * from round2(:rettotal_items) into :rettotal_items;
          select * from round2(:rettotal_venda) into :rettotal_venda;
          if (:rettotal_items <> :rettotal_venda) then
            suspend;
       end
     end
END
^

ALTER PROCEDURE PCD_GMB_FURO_VENDA_SAIDA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    TIPO CHAR(1))
RETURNS (
    CODIGO_VD INTEGER,
    RETTOTAL_ITEMS NUMERIC(18,4),
    RETTOTAL_VENDA NUMERIC(18,4),
    FECHADA CHAR(1),
    MOTIVO VARCHAR(50))
AS
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE REP NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE DESC_PROP NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ITEM NUMERIC(18,4);
DECLARE VARIABLE VENDEDOR INTEGER;
begin
     /*Gambiarras pra achar venda pebada*/

     /*Se o usuário quer pesquisar se existe alguma venda sem vendedor, mas tendo vendedor nos itens,
      isso faz com que tenhamos incosistencias entre relatórios que se baseiam em Vendedor nos items(Comissões por faixa)
      e relatórios que usam normalmente o campo vendedor da venda, TAMBÉM encontraá se tiver um vendedor no item e outro
      na venda*/
     if (:tipo = 'V') then
     begin
       for select fv.codigo, fv.fechada, coalesce(fv.total + fv.desc_acres,0), fv.vendedor
           from fat_vendas fv
           inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
           where fv.cnpj = :cnpj and ((fv.data_caixa between :dini  and :dfim) or (fv.data_caixa is null))
           and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
           into :codigo_vd, :fechada, :rettotal_venda, :pessoa_fj
       do
       begin
          for select fvi.vendedor from fat_vendas_itens fvi
          where fvi.codigo = :codigo_vd and fvi.cnpj = :cnpj and fvi.vendedor <> :pessoa_fj
          into :vendedor
          do
          begin
            motivo = 'V. VD: '||cast(:pessoa_fj as varchar(6))||' - '||'V. It: '||cast(:vendedor as varchar(6));
            suspend;
          end
       end 
     end
     else if (:tipo = 'L') then
     begin
       /* verificando se o existem vendas com valores diferentes no total da venda, mais que são diferentes na somatória
       dos itens*/
       for select fv.codigo, fv.fechada, coalesce(fv.total,0),  coalesce(fv.desc_acres,0), fv.pessoa_fj
           from fat_vendas fv
           inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
           where fv.cnpj = :cnpj and ((fv.data_caixa between :dini  and :dfim) or (fv.data_caixa is null))
           and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
           into :codigo_vd, :fechada, :total, :desc_acresc,:pessoa_fj
       do
       begin
           rettotal_items = 0;
           rettotal_venda = (:total + :desc_acresc);
          /*percorrendo itens*/
          for select coalesce(fvi.quantidade,0), coalesce(fvi.prc_unitario,0), coalesce(fvi.desconto,0)
              from  fat_vendas_itens fvi
              where fvi.codigo = :codigo_vd and fvi.cnpj = :cnpj
              into :quantidade, :unitario, :desconto
          do
          begin
            /*até então aqui é desconsiderado o desconto dado na nf. que terá se ser rateado entre os itens*/
            total_item = ((:unitario - :desconto) * :quantidade);
            if (:total > 0) then
            begin
              /*Descobrindo qnto o item representa na NF*/
              rep = (:total_item * 100/:total);
    
              /*Desconto proporcional*/
              desc_prop = (:rep * :desc_acresc/100);
    
              /*Apos descoberto o desconto aplicando no item*/
              total_item = :total_item + :desc_prop;
            end
            rettotal_items = :rettotal_items + :total_item;
          end
          select * from round2(:rettotal_items) into :rettotal_items;
          select * from round2(:rettotal_venda) into :rettotal_venda;
          if (:rettotal_items <> :rettotal_venda) then
            suspend;
       end
     end
END
^

ALTER PROCEDURE PCD_GMB_GERA_COMISSAO_AMERICA (
    CNPJ VARCHAR(14))
AS
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE CODPG INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE COD_BAIXA INTEGER;
DECLARE VARIABLE REC_VLR_BAIXA NUMERIC(18,4);
DECLARE VARIABLE REC_JUROS NUMERIC(18,4);
DECLARE VARIABLE REC_VALOR NUMERIC(18,4);
DECLARE VARIABLE BX_PCT_REP NUMERIC(18,4);
DECLARE VARIABLE COD_PESSOA INTEGER;
DECLARE VARIABLE CODIGO_CM INTEGER;
DECLARE VARIABLE CM_PCT NUMERIC(18,4);
DECLARE VARIABLE CM_VLR NUMERIC(18,4);
DECLARE VARIABLE CUSTOMEDIO NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE EXISTE INTEGER;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DT_BAIXA DATE;
begin
  /*atribuindo custo medio a todos os produtos que nao o possuem*/
  for select vdi.codigo, vdi.produto, vdi.sequencia  from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and coalesce(vdi.custo_medio,0) = 0
      into :codigo, :produto, :sequencia
  do
  begin
     select prd.prc_custo_med from est_produtos prd
     where prd.codigo = :produto and prd.cnpj = :cnpj
     into :customedio;

     update fat_vendas_itens vdi2 set vdi2.custo_medio = :customedio
     where vdi2.codigo = :codigo and vdi2.produto = :produto and vdi2.sequencia = :sequencia and vdi2.cnpj = :cnpj;
  end

  /*Atualizando o lucro-lquido do produto, q é realizado através de triguers*/
  update fat_vendas_itens vdi set vdi.contador_arquivo = 1;

  /*gerando os registros de vendedores-comissoes*/
  for select vdi.codigo, vdi.produto, vdi.sequencia, vdi.vendedor  from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj
      into :codigo, :produto, :sequencia, :vendedor
  do
  begin
    /*encontrando a pessoa do vendedor atrelado no item*/
    select vdd.pessoa_fj from fat_vendedor vdd
    where vdd.cnpj = :cnpj and vdd.codigo = :vendedor
    into :pessoa_fj;

    insert into fat_vendas_itens_comissoes (CNPJ,
                                           COD_ITEM,
                                           PRODUTO     ,
                                           SEQUENCIA   ,
                                           PESSOA_FJ   ,
                                           PERCENTUAL)
                                   values (:CNPJ,
                                           :CODIGO,
                                           :PRODUTO     ,
                                           :sequencia   ,
                                           :PESSOA_FJ   ,
                                           100);
  end

  /*gerando valores de faturamentos a vista*/
  for select vd.codigo, vd.data_caixa from fat_vendas vd
      left join fin_formas_pagto pgt on (pgt.cnpj = vd.cnpj and pgt.codigo = vd.forma_pgto)
      where vd.cnpj = :cnpj and pgt.avista = 'S' and coalesce(vd.fechada,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N'
      into  :codigo, :dt_lancto
  do
  begin
     if (:codigo = 27) then
       codigo = 27;
     execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,null,null,:dt_lancto);
  end



  /*gerando comissoes a partir do contas a receber*/
  for select rec.codigo_vn, rec.codigo, rec.dt_lancto from fin_contas_receber rec
      where rec.cnpj = :cnpj
      into :codigo, :codrec, :dt_lancto
  do
  begin
    if (coalesce(:codigo,0) > 0) then
      execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,:codrec,null,:dt_lancto);
  end

  for select bx.codigo, bx.vlr_baixa, bx.juros, bx.valor, bx.codigo_vn, bx.codigo_cr, bx.dt_lancto, bx.dt_baixa from fin_baixas_receber bx
      where bx.cnpj = :cnpj
      into :cod_baixa, :rec_vlr_baixa, :rec_juros, :rec_valor, :codigo, :codrec, :dt_lancto, :dt_baixa
  do
  begin
    if (coalesce(:codigo,0) > 0) then
    begin
        if (:codigo = 119) then
          codigo = 119;
        /*se nao existir o contas á receber, este sera criado novamente, para termos o cabecalho, pois
        e fundamental para gerar as comissoes das quitacoes das baixas*/
        select count(*) from cm2_comissao_parc pc
        where pc.cod_receber = :codrec and pc.cnpj = :cnpj
        into :existe;

        if (coalesce(:existe,0) = 0) then
          execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,:codrec,null,:dt_lancto);

        bx_pct_rep = ((:rec_vlr_baixa - rec_juros)/rec_valor);
    
        for select c2.cod_pessoa, c2.codigo, c2.cm_pct, c2.valor from cm2_comissao_parc c2
            where c2.cnpj = :cnpj and c2.cod_receber = :codrec and c2.status = 'F'
            into :cod_pessoa, :codigo_cm, :cm_pct, :cm_vlr
        do
        begin
            insert into CM2_COMISSAO_PARC (CNPJ,
                                           COD_VENDA,
                                           COD_PESSOA,
                                           COD_RECEBER,
                                           COD_PAGAR,
                                           VALOR,
                                           cm_pct,
                                           STATUS,
                                           cod_bx_receber,
                                           DT_GERACAO)
                                 values   (:cnpj,
                                           :codigo,
                                           :cod_pessoa,
                                           :codrec,
                                            null,
                                           (:cm_vlr * :bx_pct_rep),
                                           :cm_pct,
                                           'L',
                                           :cod_baixa,
                                           :dt_baixa);
        end
    end
  end



  /*gerando comissoes a partir do contas a pagar*/
  for select pg.codigo_vn, pg.codigo, pg.dt_lancto from fin_contas_pagar pg
      where pg.cnpj = :cnpj
      into :codigo, :codpg, :dt_lancto
  do
  begin
    if (coalesce(:codigo,0) > 0) then
      execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,null,:codpg,:dt_lancto);
  end

  for select bx.codigo, bx.vlr_baixa, bx.juros, bx.valor, bx.codigo_vn, bx.codigo_pg, bx.dt_lancto, bx.dt_baixa from fin_baixas_pagar bx
      where bx.cnpj = :cnpj
      into :cod_baixa, :rec_vlr_baixa, :rec_juros, :rec_valor, :codigo, :codpg, :dt_lancto, :dt_baixa
  do
  begin
    if (coalesce(:codigo,0) > 0) then
    begin
        if (:codigo = 119) then
          codigo = 119;
        /*se nao existir o contas á receber, este sera criado novamente, para termos o cabecalho, pois
        e fundamental para gerar as comissoes das quitacoes das baixas*/
        select count(*) from cm2_comissao_parc pc
        where pc.cod_pagar = :codpg and pc.cnpj = :cnpj
        into :existe;

        if (coalesce(:existe,0) = 0) then
          execute procedure pcd_cm2_gera_comissao(:cnpj,:codigo,null,:codpg,:dt_lancto);

        bx_pct_rep = ((:rec_vlr_baixa - rec_juros)/rec_valor);
    
        for select c2.cod_pessoa, c2.codigo, c2.cm_pct, c2.valor from cm2_comissao_parc c2
            where c2.cnpj = :cnpj and c2.cod_pagar = :codpg and c2.status = 'C'
            into :cod_pessoa, :codigo_cm, :cm_pct, :cm_vlr
        do
        begin
            insert into CM2_COMISSAO_PARC (CNPJ,
                                           COD_VENDA,
                                           COD_PESSOA,
                                           COD_RECEBER,
                                           COD_PAGAR,
                                           VALOR,
                                           cm_pct,
                                           STATUS,
                                           cod_bx_receber,
                                           DT_GERACAO)
                                 values   (:cnpj,
                                           :codigo,
                                           :cod_pessoa,
                                           null,
                                           :codpg,
                                           (:cm_vlr * :bx_pct_rep),
                                           :cm_pct,
                                           'L',
                                           :cod_baixa,
                                           :dt_baixa);
        end
    end
  end





end
^

ALTER PROCEDURE PCD_GMB_GERA_KARDEX (
    CNPJ VARCHAR(18),
    DATA1 DATE,
    DATA2 DATE)
AS
declare variable codigo integer;
declare variable data date;
declare variable produto varchar(15);
declare variable ndocto varchar(20);
declare variable tipo_kdx char(1);
declare variable mes integer;
declare variable ano integer;
declare variable unidade char(4);
declare variable unidades integer;
declare variable pessoa_fj integer;
declare variable quantidade numeric(18,4);
declare variable quant_ant numeric(18,4);
declare variable qtde_unidade numeric(18,4);
declare variable preco_unt numeric(18,4);
declare variable desconto numeric(18,4);
begin
  /*deletando todos os resgistros do intervalo e que forem de vendas*/
  delete from est_kardex k where k.cnpj = :cnpj and k.dt_movto between :data1 and :data2;


  /*-------------VENDAS-------------*/
  for select vd.codigo, vd.data, prd.codigo, vd.pessoa_fj,
      coalesce(vdi.quantidade,0), coalesce(prd.qtdade_2,0), vdi.prc_unitario, vdi.desconto
      from fat_vendas_itens vdi
      inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
      inner join est_natureza nat on (vd.cnpj = nat.cnpj and nat.codigo = vd.natureza)
      inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
      where vd.data between :data1 and :data2 and vd.cnpj = :cnpj
      and nat.computa_venda = 'S' and nat.es = 'S' and nat.mov_estoque = 'S'
      into :codigo, :data, :produto, :pessoa_fj, :quantidade,
      :quant_ant, :preco_unt, :desconto
  do
  begin
    tipo_kdx = 'S';

    mes = extract (month from :data);
    ano = extract (year from :data);
    ndocto = cast(:codigo as varchar(20));
    /*atualizando kardex*/
    insert into est_kardex (cnpj, produto, ndocto,
                            dt_movto, mes, ano,
                            origem, tipo_es, pessoa_fj,
                            qtdade_ant, qtdade, prc_unit,
                            descontos)
    values                  (:cnpj, :produto, :ndocto,
                            :data, :mes, :ano,
                            'VD', :tipo_kdx, :pessoa_fj,
                            :quant_ant, :quantidade, :preco_unt,
                            :desconto);

  end

  /*-------------ENTRADAS-------------*/
  for select produto, eti.unidade, eti.subunidade, quantidade, prc_unitario,
      descontos, coalesce(nat.mov_estoque,'N'), coalesce(prd.qtdade_2,0), data_ent,
      et.ndocto, et.pessoa_fj
      from est_entradas_itens eti
      inner join est_produtos prd on (prd.codigo = eti.produto and prd.cnpj = eti.cnpj)
      inner join est_entradas et on (et.cnpj = eti.cnpj and eti.ndocto = et.ndocto)
      inner join est_natureza nat on (et.cnpj = nat.cnpj and nat.codigo = et.natureza)
      where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2)
      into :produto, :unidade, :unidades, :quantidade, :preco_unt,
           :desconto, :tipo_kdx, :quant_ant, :data, :ndocto, :pessoa_fj

  do
  begin
     /*convertendo os valors de acordo com a unidade de conversao*/
     select coalesce(unidades,0) from est_unidades  where cnpj = :cnpj and sigla = :unidade
     into :qtde_unidade ;

     if (:qtde_unidade > 0) then
       quantidade = (:quantidade * :unidades) / :qtde_unidade;
     else
       quantidade = (:quantidade * :unidades);

    mes = extract (month from :data);
    ano = extract (year from :data);

    /*atualizando kardex*/
    insert into est_kardex (cnpj, produto, ndocto,
                            dt_movto, mes, ano,
                            origem, tipo_es, pessoa_fj,
                            qtdade_ant, qtdade, prc_unit,
                            descontos)
    values                  (:cnpj, :produto, :ndocto,
                            :data, :mes, :ano,
                            'ENT', :tipo_kdx, :pessoa_fj,
                            :quant_ant, :quantidade, :preco_unt,
                            :desconto);

  end

  /*-------------CONTAGEMS-------------*/
  suspend;
END
^

ALTER PROCEDURE PCD_GMB_GERA_NOSSO_NUMERO (
    CNPJ VARCHAR(18))
AS
DECLARE VARIABLE NOSSONUM INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CONVENIO INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
begin
  /*esse procedimento inserirá o nosso número em todas as contas à
  receber que não o possuirem, útil se a empressa passar a utilizar
  a geração de boletos pelo sistema*/
  select emp.blt_convenio from sis_empresas emp
  where emp.cnpj = :cnpj
  into :convenio;

  for select rec.codigo, rec.pessoa_fj from fin_contas_receber rec
      where rec.cnpj = :cnpj and coalesce(rec.blt_nosso_num,0) = 0
      into :codigo, :pessoa_fj
  do
  begin
      select bc.boleto from fin_banco bc
      where bc.padrao_boleto = 'S'
      into :nossonum;

      nossonum = (:nossonum + 1);
      update fin_banco bc set bc.boleto = :nossonum where bc.padrao_boleto = 'S';

      update fin_contas_receber rec set rec.blt_nosso_num = (:convenio || :nossonum)
      where rec.cnpj = :cnpj and rec.codigo = :codigo and rec.pessoa_fj = :pessoa_fj;
  end
  suspend;
END
^

ALTER PROCEDURE PCD_GMB_REGERAR_MOV_CTB (
    CNPJ VARCHAR(14))
RETURNS (
    VALOR FLOAT)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE HISTORICO VARCHAR(100);
begin
  for select c.data,('CH: '||c.cheque), c.historico, c.valor  from ctb_cheque c
      where 0 = (select count(*) from ctb_movimento_contabil ctb where ctb.documento = ('CH: '||c.cheque))
      and c.pre_date <= current_date
  into :data, :documento,:historico,:valor
  do
  begin
    insert into ctb_movimento_contabil  (CNPJ,
                                            CODIGO            ,
                                            DATA              ,
                                            TIPO              ,
                                            DOCUMENTO         ,
                                            HISTORICO         ,
                                            VALOR             ,
                                            CONTA             ,
                                            ORIGEM            ,
                                            PLANILHA          ,
                                            BANCO             ,
                                            TIPO_LANCAMENTO
                                            )
                                   values( :cnpj,
                                            GEN_ID(MOV_CONTABIL_GE, 1),
                                            :data              ,
                                            'D'              ,
                                            :documento         ,
                                            :historico         ,
                                            :valor             ,
                                            2            ,
                                            'PGR'            ,
                                            GEN_ID(GEN_ACT_ACERTOCONTA_ID, 1),
                                            001             ,
                                            'G'
                                            );

    suspend;
  end
end
^

ALTER PROCEDURE PCD_GMB_REPROCESSA_ESTOQUE (
    CNPJ VARCHAR(14))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
begin
  for select distinct k.produto from est_kardex k
      where k.cnpj = :cnpj
      into :produto
  do
  begin
    /*pegando o primeiro registro kardex*/
    select min(k.codigo) from est_kardex k
    where k.produto = :produto
    into :codigo;

    /*este processo fará com que as triguer da tabela atualizem todo o estoque,
    pois foi alterada a quantidade anterior
    update est_kardex k set k.qtdade_ant = 1
    where k.codigo = :codigo;      */

    /*voltando para 0 porque toda primeira movimentação kardex terá como saldo anterior = 0*/
    update est_kardex k set k.qtdade_ant = 0
    where k.codigo = :codigo;

  end

  suspend;
end
^

ALTER PROCEDURE PCD_GMB_VD_S_REC
RETURNS (
    RETORNO INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE REC INTEGER;
DECLARE VARIABLE PARC INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE BX INTEGER;
begin
  for select vd.codigo, vd.pessoa_fj, vd.natureza, vd.data
      from fat_vendas vd
      inner join fin_formas_pagto pgt on (pgt.codigo = vd.forma_pgto and vd.cnpj = pgt.cnpj)
      inner join est_natureza nat on (nat.codigo = vd.natureza and vd.cnpj = nat.cnpj)
      where vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N' and pgt.avista = 'N'
      and nat.es = 'S' and coalesce(nat.gera_financeiro,'S') = 'S'
  into :codigo, :pessoa_fj, :cfop, :data
  do
  begin
    bx = 0;
    rec = 0;
    parc = 0;
    select count(*) from fin_contas_receber rec
    where rec.codigo_vn = :codigo and rec.pessoa_fj = :pessoa_fj
    into :rec;

    select count(*) from fin_baixas_receber bx
    where bx.codigo_vn = :codigo and bx.pessoa_fj = :pessoa_fj
    into :bx;

    select count(*) from fat_vendas_parcelamento pc
    where pc.codigo = :codigo
    into :parc;

    if ((:rec = 0) and (:bx = 0)) then
    begin
      update fat_vendas vd1 set vd1.fechada = 'N',vd1.enviada_cx = 'N'
      where vd1.codigo = :codigo and vd1.pessoa_fj = :pessoa_fj;
    end
  end
  retorno = 1;
  suspend;
END
^

ALTER PROCEDURE PCD_IMP_DUPLICADA (
    CNPJ VARCHAR(14),
    COD_VENDA INTEGER,
    COD_RECEBER INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    VALOR_EXTENSO VARCHAR(200),
    VD_TOTAL FLOAT,
    VD_CODIGO INTEGER,
    VD_NUM_NF INTEGER,
    DPL_VALOR FLOAT,
    DPL_VENCTO DATE,
    DPL_EMISSAO DATE,
    DPL_PARCELA VARCHAR(6),
    SAC_CODIGO INTEGER,
    SAC_NOME VARCHAR(50),
    DPL_NUMERO INTEGER,
    SAC_RG_IE VARCHAR(20),
    SAC_ENDERECO VARCHAR(50),
    SAC_CEP VARCHAR(20),
    SAC_CIDADE VARCHAR(50),
    SAC_BAIRRO VARCHAR(50),
    SAC_UF VARCHAR(2),
    SAC_CPF_CGC VARCHAR(79),
    SAC_NUMERO VARCHAR(15),
    SAC_FONE VARCHAR(20),
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_TOTAL_UNITARIO FLOAT,
    PRD_UNIDADE VARCHAR(4),
    PRD_NOME VARCHAR(50),
    PRD_CODIGO VARCHAR(15),
    VD_DESCONTOS FLOAT,
    PROP_BAIRRO VARCHAR(50),
    PROP_IE VARCHAR(15),
    PROP_NOME_ENDERECO VARCHAR(120),
    PROP_CEP VARCHAR(8),
    PROP_CIDADE VARCHAR(50),
    PROP_UF VARCHAR(2),
    PROP_NOME VARCHAR(50),
    VDD_CODIGO INTEGER,
    VDD_NOME VARCHAR(50),
    VDDI_NOME VARCHAR(50),
    VDDI_CODIGO INTEGER)
AS
DECLARE VARIABLE END_COBRANCA INTEGER;
DECLARE VARIABLE IMP_PROD_DUPLICATA CHAR(1);
begin
  select e.imp_prod_duplicata from sis_empresas e
 where e.cnpj = :cnpj
 into :imp_prod_duplicata;
  /*pegará dados do parcelamento*/
  if ((coalesce(:cod_receber,0) <= 0)   or (coalesce(:cod_venda,0) > 0))
 then
  begin
    for select
        pc.VALOR_EXTENSO,
        (coalesce(vd.total,0)+coalesce(vd.desc_acres,0)) VD_TOTAL,
        vd.codigo vd_codigo,
        vd.num_nf vd_num_nf,
        pc.valor dpl_valor,
        pc.vencto dpl_vencto,
        VD.data_caixa,
        pc.parcela dpl_parcela,
        psa.codigo sac_codigo,
        psa.nome_razao sac_nome,
        pc.boleto DPL_NUMERO,
        case psa.pessoa
             when 'J' then psa.rg_ie
             else ''
        end ,
        lgd.nome SAC_ENDERECO,
        psa.cep SAC_CEP,
        cdd.nome SAC_CIDADE,
        br.nome SAC_BAIRRO,
        cdd.uf SAC_UF,
        case psa.pessoa
          when 'J' then
            substring(coalesce(psa.cpf_cgc,'') from 1 for 2)||'.'||substring(coalesce(psa.cpf_cgc,'') from 3 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 6 for 3)||'/'||substring(coalesce(psa.cpf_cgc,'') from 9 for 4)||'-'||substring(coalesce(psa.cpf_cgc,'') from 13 for 2)
          else
           substring(coalesce(psa.cpf_cgc,'') from 1 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 4 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 7 for 3)||'-'||substring(coalesce(psa.cpf_cgc,'') from 10 for 2)
        end ,
        psa.numero SAC_NUMERO,



        vd.desc_acres vd_descontos,
        br2.nome prop_bairro,
        pr.ie PROP_IE,
        (coalesce(pr.nome,'')||'-'||coalesce(lgd.nome,'')||' N º'||coalesce(pr.numero,'(S/N)')) PROP_NOME_ENDERECO,
        pr.cep PROP_CEP,
        cdd2.nome prop_cidade,
        cdd2.uf prop_uf,
        pr.nome prop_nome,
        vd.vendedor vdd_codigo,
        vdd.nome vdd_nome,
        PSA.fone
        from fat_vendas vd
        left join fat_vendedor vdd on (vd.vendedor = vdd.codigo and vd.cnpj = vdd.cnpj)
        inner join fat_vendas_parcelamento pc on (pc.cnpj = vd.cnpj and pc.codigo = vd.codigo)
        /*Pessoas*/
        inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
        left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
        left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
        left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
        /*Propriedades*/
        left join glo_propriedades pr on (pr.propriedade = vd.propriedade and pr.pessoa_fj = vd.pessoa_fj and vd.cnpj = pr.cnpj)
        left join glo_logradouros lgd2 on (lgd2.codigo = pr.endereco and lgd2.cnpj = pr.cnpj)
        left join glo_bairros br2 on (br2.codigo = pr.bairro and br.cnpj = pr.cnpj)
        left join glo_cidades cdd2 on (cdd2.codigo = pr.cidade and pr.cnpj = cdd2.cnpj)
        where vd.cnpj = :cnpj and vd.codigo = :cod_venda and psa.codigo = :pessoa_fj
        into
        :VALOR_EXTENSO,
        :VD_TOTAL ,
        :VD_CODIGO ,
        :VD_NUM_NF ,
        :DPL_VALOR ,
        :DPL_VENCTO,
        :dpl_emissao,
        :DPL_PARCELA,
        :SAC_CODIGO ,
        :SAC_NOME ,
        :dpl_numero ,
        :SAC_RG_IE ,
        :SAC_ENDERECO,
        :SAC_CEP ,
        :SAC_CIDADE ,
        :sac_bairro,
        :SAC_UF ,
        :SAC_CPF_CGC,
        :SAC_NUMERO ,
        :VD_DESCONTOS ,
        :PROP_BAIRRO ,
        :PROP_IE ,
        :PROP_NOME_ENDERECO,
        :prop_cep,
        :PROP_CIDADE ,
        :PROP_UF ,
        :PROP_NOME ,
        :VDD_CODIGO,
        :VDD_NOME,
        :sac_fone
        do
        begin
         select max(e.codigo) from glo_cliente_endereco e
          where e.cnpj = :cnpj and e.id_cliente = :sac_codigo
          and e.endereco_padrao = 'S'
          into :end_cobranca;

          select lgd.nome,
                 e.cep,
                 cdd.nome,
                 br.nome,
                 e.uf_sigla,
                 e.numero_end
                  from glo_cliente_endereco e
          left join glo_bairros br on (br.cnpj = e.cnpj and br.codigo = e.id_bairro)
          left join glo_logradouros lgd on (lgd.cnpj = e.cnpj and lgd.codigo = e.id_logradouro)
          left join glo_cidades cdd on (cdd.cnpj = e.cnpj and cdd.codigo = e.id_cidade)
          where e.cnpj = :cnpj and e.id_cliente = :sac_codigo and e.codigo = :end_cobranca
          into  :SAC_ENDERECO,
                :SAC_CEP ,
                :SAC_CIDADE ,
                :sac_bairro,
                :SAC_UF,
                :sac_numero ;


         if (imp_prod_duplicata = 'S') then /*no caso de duplicatas que listam os produtos (fert flora)*/
         begin
             for select coalesce(vdi.quantidade,0) PRD_QTDE,
                    coalesce(vdi.prc_unitario,0) PRD_UNITARIO,
                    ((coalesce(vdi.prc_unitario,0)) * coalesce(vdi.quantidade,0)) PRD_TOTAL_UNITARIO,
                    prd.unidade PRD_UNIDADE,
                    prd.nome PRD_NOME,
                    prd.codigo PRD_CODIGO,
                    vdd1.nome vddi_nome,
                    vdd1.codigo vddi_codigo
                from  fat_vendas_itens vdi
                left join fat_vendedor vdd1 on (vdi.vendedor = vdd1.codigo and vdi.cnpj = vdd1.cnpj)
                inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
                where vdi.cnpj = :cnpj and vdi.codigo = :cod_venda
                into    :PRD_QTDE,
                        :PRD_UNITARIO,
                        :PRD_TOTAL_UNITARIO ,
                        :PRD_UNIDADE ,
                        :PRD_NOME ,
                        :PRD_CODIGO,
                        :VDDI_NOME,
                        :VDDI_CODIGO
             do
             begin
                suspend;
             end
          end
          else
            suspend;
        end


  end
  else
  begin
    select
    rec.valor dpl_valor,
    rec.dt_vencto dpl_vencto,
    rec.dt_emissao,
    rec.parcela dpl_parcela,
    psa.codigo sac_codigo,
    psa.nome_razao sac_nome,
    case psa.pessoa
         when 'J' then psa.rg_ie
         else ''
    end,
    lgd.nome sac_endereco,
    psa.cep sac_cep,
    cdd.nome sac_cidade,
    br.nome sac_bairro,
    cdd.uf sac_uf,
    case psa.pessoa
      when 'J' then
        substring(coalesce(psa.cpf_cgc,'') from 1 for 2)||'.'||substring(coalesce(psa.cpf_cgc,'') from 3 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 6 for 3)||'/'||substring(coalesce(psa.cpf_cgc,'') from 9 for 4)||'-'||substring(coalesce(psa.cpf_cgc,'') from 13 for 2)
      else
       substring(coalesce(psa.cpf_cgc,'') from 1 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 4 for 3)||'.'||substring(coalesce(psa.cpf_cgc,'') from 7 for 3)||'-'||substring(coalesce(psa.cpf_cgc,'') from 10 for 2)
    end ,
    psa.numero sac_numero,
    rec.valor_extenso,
    rec.codigo,
    rec.codigo_vn,
    psa.rg_ie,
    psa.rg_ie,
    psa.fone
    from fin_contas_receber rec
    /*Pessoas*/
    inner join glo_pessoas_fj psa on (psa.codigo = rec.pessoa_fj and psa.cnpj = rec.cnpj)
    left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
    left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
    left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
    /*Propriedades*/
    where rec.cnpj = :cnpj and rec.codigo = :cod_receber
    into
     :dpl_valor,
     :dpl_vencto,
     :dpl_emissao,
     :dpl_parcela,
     :sac_codigo,
     :sac_nome,
     :sac_rg_ie,
     :sac_endereco,
     :sac_cep,
     :sac_cidade,
     :sac_bairro,
     :sac_uf,
     :sac_cpf_cgc,
     :sac_numero,
     :valor_extenso,
     :dpl_numero,
     :vd_codigo,
     :sac_rg_ie,
     :prop_ie,
     :sac_fone;

     select max(e.codigo) from glo_cliente_endereco e
     where e.cnpj = :cnpj and e.id_cliente = :sac_codigo
     and e.endereco_padrao = 'S'
     into :end_cobranca;

      select lgd.nome,
             e.cep,
             cdd.nome,
             br.nome,
             e.uf_sigla,
             e.numero_end
              from glo_cliente_endereco e
      left join glo_bairros br on (br.cnpj = e.cnpj and br.codigo = e.id_bairro)
      left join glo_logradouros lgd on (lgd.cnpj = e.cnpj and lgd.codigo = e.id_logradouro)
      left join glo_cidades cdd on (cdd.cnpj = e.cnpj and cdd.codigo = e.id_cidade)
      where e.cnpj = :cnpj and e.id_cliente = :sac_codigo and e.codigo = :end_cobranca
      into  :SAC_ENDERECO,
            :SAC_CEP ,
            :SAC_CIDADE ,

            :sac_bairro,
            :SAC_UF,
            :sac_numero ;
     suspend;
  end
end
^

ALTER PROCEDURE PCD_IMP_ITENS_REM_DEV (
    CNPJ VARCHAR(14),
    COD_ORIGEM INTEGER,
    COD_DESTINO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE ICM NUMERIC(18,4);
DECLARE VARIABLE ICM_SUBS NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE VOLUME NUMERIC(18,4);
DECLARE VARIABLE PESO NUMERIC(18,4);
DECLARE VARIABLE DESCONTO NUMERIC(18,4);
DECLARE VARIABLE PORC_DESC NUMERIC(18,4);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE ALIQUOTA CHAR(5);
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE PRC_UNIT_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE TOTPESO NUMERIC(18,4);
DECLARE VARIABLE TOTVOLUME NUMERIC(18,4);
DECLARE VARIABLE TOTVENDA NUMERIC(18,4);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE DEVOLUCAO CHAR(1);
DECLARE VARIABLE REMESSA CHAR(1);
DECLARE VARIABLE CMI_PESSOA_FJ INTEGER;
DECLARE VARIABLE CMI_PERCENTUAL NUMERIC(18,4);
DECLARE VARIABLE LOTE VARCHAR(10);
DECLARE VARIABLE CODIGO_LOTE INTEGER;
begin
     /*descobrindo se é uma devolução ou uma simples remessa*/
     select coalesce(nat.remessa,'N'), coalesce(nat.devolucao,'N') from fat_vendas vd
     inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
     where vd.cnpj = :cnpj and vd.codigo = :cod_destino
     into :remessa, :devolucao;

     if (:remessa = 'S') then
     begin
         for select
                vdi.produto, vdi.sequencia, (coalesce(vdi.quantidade,0) - coalesce(vdi.qtde_entregue,0)), vdi.prc_unitario, vdi.prc_custo,
                vdi.icm, vdi.icm_subs, vdi.ipi, vdi.volume, vdi.peso, vdi.desconto, vdi.porc_desc, vdi.unidade,
                vdi.prc_unit_original, vdi.subunidade, vdi.lote, vdi.codigo_lote
          from fat_vendas_itens vdi
          where cnpj = :cnpj and vdi.codigo = :cod_origem and (coalesce(vdi.quantidade,0) - (coalesce(vdi.qtde_entregue,0)) > 0)
          into
                :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
                :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
                :prc_unit_original, :subunidade, :lote, :codigo_lote
          do
          begin
        
               select nome, aliquota_ecf, cte, ctie, origem from est_produtos prd
               where cnpj = :cnpj and codigo = :produto
               into :nome_produto, :aliquota, :cte, :ctie, :origem ;
        
        
               insert into fat_vendas_itens
               (
                cnpj, codigo, produto, sequencia, quantidade, prc_unitario, prc_custo,
                icm, icm_subs, ipi, volume, peso, desconto, porc_desc, unidade,
                prc_unit_original, nome_produto, subunidade, aliquota, cte, ctie, origem,
                sproduto, lote, codigo_lote
               )
               values
               (
                :cnpj, :cod_destino, :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
                :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
                :prc_unit_original, :nome_produto, :subunidade, :aliquota, :cte, :ctie, :origem,
                :produto, :lote, :codigo_lote
               );
               
               totpeso   = totpeso   + :peso;
               totvolume = totvolume + :volume;
              totvenda  = totvenda  + (:quantidade * ( :prc_unitario ));
               
               /* SOMA OS TOTAIS E OS PESOS */
          end
     end
     else if (:devolucao = 'S') then
     begin
       for select
                vdi.produto, vdi.sequencia, coalesce(vdi.qtde_entregue,0), vdi.prc_unitario, vdi.prc_custo,
                vdi.icm, vdi.icm_subs, vdi.ipi, vdi.volume, vdi.peso, vdi.desconto, vdi.porc_desc, vdi.unidade,
                vdi.prc_unit_original, vdi.subunidade
          from fat_vendas_itens vdi
          where cnpj = :cnpj and vdi.codigo = :cod_origem
          order by vdi.sequencia
--          and coalesce(vdi.qtde_entregue,0) > 0
          into
                :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
                :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
                :prc_unit_original, :subunidade
          do
          begin
        
               select nome, aliquota_ecf, cte, ctie, origem from est_produtos prd
               where cnpj = :cnpj and codigo = :produto
               into :nome_produto, :aliquota, :cte, :ctie, :origem ;
        
        
               insert into fat_vendas_itens
               (
                cnpj, codigo, produto, sequencia, quantidade, prc_unitario, prc_custo,
                icm, icm_subs, ipi, volume, peso, desconto, porc_desc, unidade,
                prc_unit_original, nome_produto, subunidade, aliquota, cte, ctie, origem,
                sproduto,  lote, codigo_lote
               )
               values
               (
                :cnpj, :cod_destino, :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
                :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
                :prc_unit_original, :nome_produto, :subunidade, :aliquota, :cte, :ctie, :origem,
                :produto, :lote, :codigo_lote
               );
               
               /*deletando o retistro que será gerado automaticmaente no triguer after insert em fat-vendas-itens*/
               delete from fat_vendas_itens_comissoes cmi
               where cmi.cnpj = :cnpj and cmi.cod_item = :cod_destino and cmi.produto = :produto and cmi.sequencia = :sequencia;

               /*importando vendedores dos itens
               for select PESSOA_FJ, PERCENTUAL from fat_vendas_itens_comissoes cmi
                   where cmi.cnpj = :cnpj and cmi.cod_item = :cod_origem
                   and cmi.produto = :produto and cmi.sequencia = :sequencia
                   into :cmi_pessoa_fj, :cmi_percentual
               do
               begin
                  insert into fat_vendas_itens_comissoes (CNPJ,
                                                          COD_ITEM,
                                                          PRODUTO     ,
                                                          SEQUENCIA   ,
                                                          PESSOA_FJ   ,
                                                          PERCENTUAL)
                                                    values (:cnpj,
                                                           :cod_destino,
                                                           :produto,
                                                           :sequencia ,
                                                           :cmi_pessoa_fj ,
                                                           :cmi_percentual);
                  
               end  */

               /*apenas disparando o triguuer after-update para executar os calculos de comissão America AgroSeeds*/
               update fat_vendas_itens vdi set contador_arquivo = 0
               where vdi.cnpj = :cnpj and vdi.codigo = :cod_destino;

               totpeso   = totpeso   + :peso;
               totvolume = totvolume + :volume;
               totvenda  = totvenda  + (:quantidade * ( :prc_unitario ));
               
               /* SOMA OS TOTAIS E OS PESOS */
          end   
     end

      update fat_vendas vd set total = :totvenda, peso = :totpeso, volume = :totvolume
      where cnpj = :cnpj and codigo = :cod_destino;
  suspend;
END
^

ALTER PROCEDURE PCD_IMP_NF_AGRUPADA (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    DT_NF DATE)
RETURNS (
    CLI_NOME VARCHAR(50),
    VD_CODIGO INTEGER,
    CLI_PROPRIEDADE VARCHAR(50),
    VEND_NOME VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_IE_SUB VARCHAR(15),
    CLI_IE VARCHAR(15),
    CLI_CNPJ VARCHAR(20),
    CLI_ENDERECO VARCHAR(70),
    CLI_BAIRRO VARCHAR(50),
    CLI_CEP VARCHAR(10),
    CLI_CIDADE VARCHAR(50),
    CLI_FAX VARCHAR(20),
    CLI_FONE VARCHAR(20),
    CLI_UF CHAR(2),
    VD_NATUREZA VARCHAR(50),
    VD_MSG_ECF VARCHAR(50),
    VD_OBS VARCHAR(200),
    VD_CFOP INTEGER,
    VD_DT_EMISSAO DATE,
    VD_DT_SAIDA DATE,
    VD_HORA_SAIDA TIME,
    VD_TOTAL_PROD FLOAT,
    VD_TOTAL_LIQUIDO FLOAT,
    VD_ICMS_DEBITADO FLOAT,
    VD_TOTAL_NF FLOAT,
    VD_DESCONTO FLOAT,
    VD_VLR_FRETE FLOAT,
    VD_VLR_SEGURO FLOAT,
    VD_VLR_OUTRAS_DESP FLOAT,
    VD_BASE_CALC FLOAT,
    VD_VLR_ICM FLOAT,
    VD_BASE_CALC_SUB FLOAT,
    VD_VOLUME FLOAT,
    VD_VLR_ICM_SUB FLOAT,
    VD_VLR_IPI FLOAT,
    PRD_IPI FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(400),
    PRD_UNIDADE CHAR(4),
    PRD_SIT_TRIB CHAR(6),
    PRD_CL_FIS CHAR(2),
    PRD_QTDE FLOAT,
    PRD_VLR_UNIT FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    PRD_VLR_TTL_ITEM FLOAT,
    PRD_ALIQ_ICM VARCHAR(10),
    PRD_COMPLEMENTO VARCHAR(100),
    PRD_REDUCAO VARCHAR(80),
    VDI_COMPLEMENTO VARCHAR(100),
    VDI_CFOP INTEGER,
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(14),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(8),
    TRP_MARCA VARCHAR(8),
    TRP_NUMERO VARCHAR(8),
    PRD_OBSERVACAO VARCHAR(200),
    GPR_OBS BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_COMPLEMENTAR BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    PC_PARCELAMENTO VARCHAR(300),
    PRD_PRODUTO_LOTE VARCHAR(250),
    VD_ENTRADA CHAR(1),
    VD_SAIDA CHAR(1),
    NUM_NF INTEGER,
    ALT_DETALHE FLOAT,
    DESC_ICM_TTL_PROD FLOAT,
    DESC_ICM_LBL_TTL_PROD VARCHAR(50),
    DESC_ICM_TTL_DESCTO FLOAT,
    DESC_ICM_LBL_TTL_DESCTO VARCHAR(50),
    DESC_ICM_TTL_LIQ FLOAT,
    DESC_ICM_LBL_TTL_LIQ VARCHAR(50),
    DESC_ICM_MSG_1 VARCHAR(200),
    DESC_ICM_MSG_2 VARCHAR(200),
    DT_IMP_NF DATE,
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_VD_VOLUME VARCHAR(30),
    LINHA INTEGER,
    VND_CODIGOS VARCHAR(180))
AS
DECLARE VARIABLE SUBSTITUTO CHAR(1);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE ECF INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE ICMS FLOAT;
DECLARE VARIABLE IPI FLOAT;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE TROCA_PROPRIEDADE CHAR(1);
DECLARE VARIABLE GPR_OBS_AUX BLOB SUB_TYPE 1 SEGMENT SIZE 200 CHARACTER SET ASCII;
DECLARE VARIABLE PRD_GERM_AUX NUMERIC(18,2);
DECLARE VARIABLE PRD_PUR_AUX NUMERIC(18,2);
DECLARE VARIABLE PRD_LT_AUX VARCHAR(10);
DECLARE VARIABLE PRD_COD_LT_AUX INTEGER;
DECLARE VARIABLE PRD_PENEIRA_AUX VARCHAR(10);
DECLARE VARIABLE PRD_VALID_AUX DATE;
DECLARE VARIABLE PC_DIA INTEGER;
DECLARE VARIABLE PC_MES INTEGER;
DECLARE VARIABLE PC_AUXDIA CHAR(2);
DECLARE VARIABLE PC_AUXMES CHAR(2);
DECLARE VARIABLE PC_ANO INTEGER;
DECLARE VARIABLE PC_VALOR NUMERIC(18,2);
DECLARE VARIABLE PERC_ICMS NUMERIC(18,2);
DECLARE VARIABLE PC_PARCELA VARCHAR(6);
DECLARE VARIABLE E_S VARCHAR(1);
DECLARE VARIABLE E_I VARCHAR(1);
DECLARE VARIABLE TP_PESSOA VARCHAR(1);
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE CONT_PARC INTEGER;
DECLARE VARIABLE AUX_VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE PAGTO_FRETE CHAR(1);
DECLARE VARIABLE NUM_MAX_ITENS INTEGER;
DECLARE VARIABLE ITEM INTEGER;
DECLARE VARIABLE XCONT1 INTEGER;
DECLARE VARIABLE XCONT INTEGER;
DECLARE VARIABLE AUX1 INTEGER;
DECLARE VARIABLE AUX2 INTEGER;
DECLARE VARIABLE AUX3 INTEGER;
DECLARE VARIABLE NMOD FLOAT;
DECLARE VARIABLE IMP_ASTERISCO CHAR(1);
DECLARE VARIABLE VD_CODIGO_1 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_2 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_3 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_4 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_5 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_6 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_7 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_8 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_9 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_10 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_11 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_12 VARCHAR(10);
DECLARE VARIABLE VD_CODIGO_13 VARCHAR(10);
DECLARE VARIABLE AUXNOME_PROD VARCHAR(50);
begin
  dt_imp_nf = :dt_nf;

  ITEM = 0;
  /*numero maximo de itens por folha*/
  select coalesce(ep.num_itens_nf,13) from sis_empresas ep
  where ep.cnpj = :cnpj
  into :num_max_itens;

  /*------------------------------------------------------------------------------*/
  select coalesce(cfg.glo_propriedade_equipamentos,'N') from sis_configuracoes cfg
  where cfg.cnpj = :cnpj
  into :troca_propriedade;

  if ((:dt_nf is null) or (:dt_nf < '01.01.2000')) then
    dt_nf = cast ('today' as date);


  cont = 0;
  vd_codigo_1 = '';
  vd_codigo_2 = '';
  vd_codigo_3 = '';
  vd_codigo_4 = '';
  vd_codigo_5 = '';
  vd_codigo_6 = '';
  vd_codigo_7 = '';
  vd_codigo_8 = '';
  vd_codigo_9 = '';
  vd_codigo_10 = '';
  vd_codigo_11 = '';
  vd_codigo_12 = '';
  vd_codigo_13 =  '';
  for select vd.codigo
       from fat_vendas vd
      where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  into :VD_CODIGO
  do
  begin
    cont = cont + 1;
    /*utilizado em agronegocio*/
    if (cont = 1) then
      vd_codigo_1 = :vd_codigo;
    else if (cont = 2) then
      vd_codigo_2 = '/'||:vd_codigo;
    else if (cont = 3) then
      vd_codigo_3 = '/'||:vd_codigo;
    else if (cont = 4) then
      vd_codigo_4 = '/'||:vd_codigo;
    else if (cont = 5) then
      vd_codigo_5 = '/'||:vd_codigo;
    else if (cont = 6) then
      vd_codigo_6 = '/'||:vd_codigo;
    else if (cont = 7) then
      vd_codigo_7 = '/'||:vd_codigo;
    else if (cont = 8) then
      vd_codigo_8 = '/'||:vd_codigo;
    else if (cont = 9) then
      vd_codigo_9 = '/'||:vd_codigo;
    else if (cont = 10) then
      vd_codigo_10 = '/'||:vd_codigo;
    else if (cont = 11) then
      vd_codigo_11 = '/'||:vd_codigo;
    else if (cont = 12) then
      vd_codigo_12 = '/'||:vd_codigo;
    else if (cont = 13) then
      vd_codigo_13 = '/'||:vd_codigo;

    cont = cont +1;
  end

  vnd_codigos = 'FAT(s): '||:vd_codigo_1||:vd_codigo_2||:vd_codigo_3||:vd_codigo_4||:vd_codigo_5||:vd_codigo_6||:vd_codigo_7||:vd_codigo_8||:vd_codigo_9||:vd_codigo_10||:vd_codigo_11||:vd_codigo_12||:vd_codigo_13;

  /*---------------------------Dados das Vendas-------------------------------------*/
  select nat.cfop_descricao, nat.msg_fiscal, nat.cfop, vd.propriedade, nat.es, nat.interestadual, nat.perc_icms,
  sum(coalesce(vd.icm,0)),
  sum(vd.total),
  sum(vd.desc_acres),
  sum(coalesce(vd.total,0)+coalesce(vd.desc_acres,0)),
  sum(coalesce(vd.ipi,0)),
  sum(coalesce(vd.frete,0)),
  sum(coalesce(vd.seguro,0)),
  sum(coalesce(vd.descto_icms,0)),
  sum(coalesce(vd.despesas,0))
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  group by nat.nome, nat.msg_fiscal, nat.codigo, vd.propriedade, nat.es,nat.interestadual, nat.perc_icms, nat.cfop, nat.cfop_descricao
  into :vd_natureza, :vd_msg_fiscal, :vd_cfop, :propriedade, :E_S,:e_i, :perc_icms,
  :icms,
  :vd_total_prod,
  :vd_desconto,
  :vd_total_liquido,
  :ipi,
  :vd_vlr_frete,
  :vd_vlr_seguro,
  :desc_icm_ttl_descto,
  :vd_vlr_outras_desp;

  if (:e_s = 'S') then
  begin
    vd_saida = 'X';
    vd_entrada = ' ';
  end
  else
  begin
    vd_saida = ' ';
    vd_entrada = 'X';
  end

  /*16.716.814/0001-67
  16716814000167*/
  /*971.736.301-34*/
  /*---------------Campos sem noção------------*/
  vd_dt_emissao = cast ('today' as date);
  vd_dt_saida = cast ('today' as date);

  /*----------------Impostos-------------*/
  vd_VLR_ipi = :ipi;

  vd_total_nf = (:vd_total_liquido + :vd_vlr_frete + :vd_vlr_seguro + :vd_vlr_outras_desp + :vd_vlr_ipi);

  /*---------------------------Cliente ou Propriedade----------------------------------------------*/
  select distinct coalesce(cli.sub_tributario,'N'), psa.nome_razao, coalesce(psa.cpf_cgc,''), psa.rg_ie,
         coalesce(lgd.nome,'')||' N º'||coalesce(psa.numero,''), br.nome, psa.cep, cdd.nome,
         psa.fone, cdd.uf, psa.pessoa, psa.codigo, psa.fax
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
  inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
  left join glo_clientes cli on (cli.pessoa_fj = psa.codigo  and psa.cnpj = cli.cnpj)
  left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
  left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
  left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
  left  join fat_vendedor   vdd   on (vd.vendedor = vdd.codigo and vdd.cnpj = vd.cnpj)
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  into :substituto, :cli_nome, :cli_cnpj, :cli_ie, :cli_endereco,
  :cli_bairro, :cli_cep, :cli_cidade, :cli_fone, :cli_uf, :tp_pessoa, :cli_codigo, :cli_fax;


  /*Máscara cpf/cnpj*/
  if (:tp_pessoa = 'J') then
    cli_cnpj = substring(:cli_cnpj from 1 for 2)||'.'||substring(:cli_cnpj from 3 for 3)||'.'||substring(:cli_cnpj from 6 for 3)||'/'||substring(:cli_cnpj from 9 for 4)||'-'||substring(:cli_cnpj from 13 for 2);
  else
    cli_cnpj = substring(:cli_cnpj from 1 for 3)||'.'||substring(:cli_cnpj from 4 for 3)||'.'||substring(:cli_cnpj from 7 for 3)||'-'||substring(:cli_cnpj from 10 for 2);

   /*Caso tenha sido definida uma propriedade na venda, então os dados impressos
  referentes a endereço devem ser os da propriedade*/
  if ((:propriedade is not null) and (troca_propriedade = 'N')) then
  begin
    select distinct pp.nome, pp.ie, coalesce(pp.nome,'')||'-'||coalesce(lgd.nome,'')||' N º'||coalesce(pp.numero,''),
    br.nome, pp.cep, cdd.nome, cdd.uf
    from fat_vendas vd
    inner join glo_propriedades pp on (pp.cnpj = vd.cnpj and pp.propriedade = vd.propriedade and pp.pessoa_fj = vd.pessoa_fj)
    left join glo_logradouros lgd on (lgd.codigo = pp.endereco and lgd.cnpj = pp.cnpj)
    left join glo_bairros br on (br.codigo = pp.bairro and br.cnpj = pp.cnpj)
    left join glo_cidades cdd on (cdd.codigo = pp.cidade and pp.cnpj = cdd.cnpj)
    where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
    into :cli_propriedade, :cli_ie, :cli_endereco, :cli_bairro, :cli_cep, :cli_cidade, :cli_uf;
  end

  if (:substituto = 'S') then
  begin
    cli_ie_sub = :cli_ie;
    cli_ie = '';
  end
  else
    cli_ie_sub = '';

  select sum(coalesce(vd.base_icm_subst,0)), sum(coalesce(vd.valor_icm_subst,0)) from fat_vendas vd
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  into :vd_base_calc_sub, :vd_vlr_icm_sub;

  select sum(coalesce(vd.base_icm,0)), sum(coalesce(vd.icm,0)) from fat_vendas vd
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  into :vd_base_calc, :vd_vlr_icm;


  /*------------------------------------------Transportador-----------------------------------------------------*/
  select sum(vd.peso), max(tp.nome),max(tp.cpf_cnpj),
  max(tp.placa),max(tp.endereco),max(tp.cidade),max(tp.uf),max(tp.ie),max(vd.peso),max(vd.pgto_frete)
  from fat_vendas vd
  left join glo_transportadoras tp on (tp.codigo = vd.transportadora and tp.cnpj = vd.cnpj)
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
  into :trp_peso_bruto, :trp_nome, :trp_cnpj, :trp_placa, :trp_endereco, :trp_cidade, :trp_uf, :trp_ie, :trp_peso_bruto, :pagto_frete;

   if (coalesce(:trp_nome,'') = '') then
      trp_nome = 'Em mãos';
      
   trp_peso_liq = trp_peso_bruto;

   /*---------------Campos sem noção------------*/
   trp_uf_veiculo = '';
   trp_peso_qtde = 0;
   trp_especie = 0;
   trp_marca = '';
   trp_numero = '';


   if (pagto_frete = '1') then
      trp_frete = 1;
   else if (pagto_frete = '2') then
      trp_frete = 2;

  /*------------------------------------------Produtos e Vlrs. de Vendas----------------------------------------*/
  xcont = 0;
  for select count(*) from fat_vendas_itens vdi
      inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
      where  vdi.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
      group by vdi.produto, vdi.prc_unitario,vdi.desconto, vdi.complemento,
      vdi.lote,vdi.codigo_lote, vdi.ipi, vdi.mensagem_reducao, vdi.cfop
      into :xcont1
  do
  begin
     xcont = xcont + xcont1;
  end

  for select prd.codigo, prd.nome, prd.unidade,
      sum(coalesce(vdi.quantidade,0)),
      coalesce(vdi.prc_unitario,0),
      coalesce(vdi.prc_unitario,0),
      sum(
         ((coalesce(vdi.prc_unitario,0)) * coalesce(vdi.quantidade,0))
         ),
      coalesce(vdi.complemento,''), sg.obs, coalesce(vdi.lote,''), coalesce(vdi.codigo_lote,0), coalesce(lt.germinacao,0),
      coalesce(lt.peneira,''), coalesce(lt.pureza,0), lt.validade,
      prd.complemento_nf, prd.CTE, prd.ctie, vdi.origem, vdi.ipi, vdi.mensagem_reducao,
      vdi.cfop
      from fat_vendas_itens vdi
      inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
      inner join est_produtos prd on (vdi.produto = prd.codigo and vdi.cnpj = prd.cnpj)
      left join est_subgrupos sg on (sg.subgrupo = prd.subgrupo and sg.grupo = prd.grupo and sg.cnpj = prd.cnpj)
      left join est_lote_produto lt on (lt.produto = vdi.produto and lt.codigo = vdi.codigo_lote and vdi.cnpj = lt.cnpj)
      where vdi.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.selecionada = 'S'
      group by prd.codigo, prd.nome, prd.unidade,vdi.prc_unitario,vdi.desconto, vdi.complemento, sg.obs,
      vdi.lote,vdi.codigo_lote,lt.germinacao,lt.peneira,lt.pureza,lt.validade,prd.complemento_nf, prd.CTE, prd.ctie, vdi.origem, vdi.ipi, vdi.mensagem_reducao, vdi.cfop
      into :prd_codigo, :auxnome_prod, :prd_unidade,
      :prd_qtde,
      :prd_vlr_unit,
      :prc_unitario_liq,
      :prd_vlr_ttl_item,
      :vdi_complemento, :gpr_obs_aux,
      :prd_lt_aux, :prd_cod_lt_aux, :prd_germ_aux, :prd_peneira_aux, :prd_pur_aux, :prd_valid_aux,
      :prd_complemento, :cte, :ctie, :origem, :prd_ipi, :PRD_REDUCAO, :vdi_cfop
  do
  begin
    if (:vdi_complemento is not null) then
      prd_nome = :auxnome_prod||'-'||:vdi_complemento;
    else
      prd_nome = :auxnome_prod;

    IMP_ASTERISCO = 'N';
    linha = coalesce(:linha,0)+1;
    /* Função MOD
    Supondo que o campo CA é o dividendo, e o CB o divisor, para eu obter o resultado do mod, ficaria assim:
    select :ca -  ((ca / cast(cb as integer) ) * cb ) from rdb$database
    nmod = :num_max_itens - ((num_max_itens/:item) * item);*/

    /*verificando se o item é multiplo do do máximo de itens*/
    if (:item > 0) then
      nmod = :num_max_itens - ((num_max_itens/:item) * item);

    item = item + 1;

    /*salto de página, mostrar somente asteríscos no rodapé*/

    if ((:linha - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
    else if (:linha > :num_max_itens) then
    begin
     if (((:linha - :num_max_itens) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
     else if (((:linha- (:num_max_itens * 2)) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
     else if (((:linha - (:num_max_itens *3)) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
    end

    if (:imp_asterisco = 'S')then
    begin
      item = 1;
      S_VD_TOTAL_NF =        '***************';
      S_VD_VLR_IPI =         '***************';
      S_VD_VLR_OUTRAS_DESP = '***************';
      S_VD_VLR_SEGURO =      '***************';
      S_VD_VLR_FRETE =       '***************';
      S_VD_TOTAL_PROD =      '***************';
      S_VD_VLR_ICM =         '***************';
      S_VD_VLR_ICM_SUB =     '***************';
      S_VD_BASE_CALC =       '***************';
      S_VD_BASE_CALC_SUB =   '***************';
    end
    else
    begin
      select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
    end

    /*------------------------- Situação Tributária ------------------------------*/
    PRD_ALIQ_ICM = :PERC_ICMS;
    if (E_I = 'E') then
    begin
       /*estadual leva em consideração o campo cte de estadual do cad. produtos*/
       if (:cte = 1) then
         prd_sit_trib = :origem||'00';
       else if (:cte = 2) then
         prd_sit_trib = :origem||'20';
       else if (:cte = 3) then
         prd_sit_trib = :origem||'40';
       else if (:cte = 5) then
         prd_sit_trib = :origem||'51';
       else if (:cte = 6) then
       begin
         prd_sit_trib = :origem||'60';
         PRD_ALIQ_ICM = 'ST';
       end
       else if (:cte = 7) then
         prd_sit_trib = :origem||'90';
       else
         prd_sit_trib = :origem||'00';
    end
    else
    begin
       /*interestadual leva em consideração o campo ctie de estadual do cad. produtos*/
       if (:ctie = 1) then
         prd_sit_trib = :origem||'00';
       else if (:ctie = 2) then
         prd_sit_trib = :origem||'20';
       else if (:ctie = 3) then
         prd_sit_trib = :origem||'40';
       else if (:ctie = 5) then
         prd_sit_trib = :origem||'51';
       else if (:ctie = 6) then
       begin
         prd_sit_trib = :origem||'60';
         PRD_ALIQ_ICM = 'ST';
       end
       else if (:ctie = 7) then
         prd_sit_trib = :origem||'90';
       else
         prd_sit_trib = :origem||'00';   
    end
        
    prd_produto_lote =  '';

    if (:prd_cod_lt_aux > 0) then
      prd_produto_lote = :prd_nome||', Lt:'||:prd_cod_lt_aux||'-'||:prd_lt_aux||',';

    if (:prd_peneira_aux <> '') then
      prd_produto_lote = :prd_produto_lote|| ' Pn:'||:prd_peneira_aux||',';

    if (:prd_valid_aux is not null) then
      prd_produto_lote = prd_produto_lote|| ' Val:'||:prd_valid_aux||',';

    if (:prd_pur_aux > 0) then
      prd_produto_lote = prd_produto_lote|| ' Pur:'||:prd_pur_aux||'%,';

    if (:prd_germ_aux > 0) then
      prd_produto_lote = prd_produto_lote|| ' Germ:'||:prd_germ_aux||'%';

    if (gpr_obs_aux is not null) then
       gpr_obs = gpr_obs_aux;
    /*---------------Campos sem noção------------*/
    PRD_CL_FIS = '?';

    suspend;
  end

  if (xcont > :num_max_itens) then
  begin
    aux1 = (xcont/:num_max_itens);
    aux2 = :aux1 * :num_max_itens;
    aux3 = :xcont - :aux2;

    /*ultima folha terá somente um item e teremos de mostrar o total,
    criando um registro "ficticio"..*/

    /*criando um registro ficticio na ultima página para permitir a totalização correta do rodape,
    gambiarra por causa do report builder*/
    if (:aux3 = 1) then
    begin
      select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;

      PRD_IPI  = null;
      PRD_CODIGO = null;
      PRD_NOME = null;
      PRD_UNIDADE = null;
      PRD_SIT_TRIB = null;
      PRD_CL_FIS = null;
      PRD_QTDE = null;
      PRD_VLR_UNIT = null;
      PRD_VLR_TTL_ITEM  = null;
      PRD_ALIQ_ICM  = null;
      PRD_COMPLEMENTO  = null;
      PRD_REDUCAO  = null;
      prd_vlr_unit = null;
      prd_vlr_ttl_item = null;
      VDI_COMPLEMENTO  = null;
      VDI_CFOP  = null;
      PRD_OBSERVACAO  = null;
      PRD_PRODUTO_LOTE  = null;
      suspend;
    end
  end

END
^

ALTER PROCEDURE PCD_IMPREME_NF_SERV (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA INTEGER)
RETURNS (
    COMPLEMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CLIENTE VARCHAR(50),
    RG_IE VARCHAR(15),
    ENDERECO VARCHAR(130),
    BAIRRO VARCHAR(50),
    CIDADE VARCHAR(50),
    UF VARCHAR(2),
    FONE VARCHAR(20),
    CEP VARCHAR(10),
    CPF_CGC VARCHAR(20),
    INSC_MUNIC VARCHAR(15),
    FAT_FATURA1 VARCHAR(10),
    FAT_VENCTO1 VARCHAR(12),
    FAT_VLR1 VARCHAR(12),
    FAT_FATURA2 VARCHAR(10),
    FAT_VENCTO2 VARCHAR(12),
    FAT_VLR2 VARCHAR(12),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    VLR_TOTAL_UNIT NUMERIC(18,4),
    PIS NUMERIC(18,4),
    IRRF NUMERIC(18,4),
    INSS NUMERIC(18,4),
    VLR_PIS NUMERIC(18,4),
    VLR_IRRF NUMERIC(18,4),
    VLR_INSS NUMERIC(18,4),
    TOTAL_VENDA NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    TEXTO_PIS VARCHAR(30),
    TEXTO_IRRF VARCHAR(30),
    TEXTO_INSS VARCHAR(30),
    TEXTO_DESCONTO VARCHAR(30),
    BASE_CALC_ISS NUMERIC(18,4),
    VLR_ISS NUMERIC(18,4),
    VLR_ISS_SUB NUMERIC(18,4),
    TOTAL_NF NUMERIC(18,4),
    FRETE_DESTINATARIO CHAR(1),
    FRETE_EMITENTE CHAR(1),
    CLI_PROPRIEDADE VARCHAR(50),
    CLI_IE VARCHAR(15))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE VLRRESTANTE NUMERIC(18,2);
DECLARE VARIABLE VLRITEM NUMERIC(18,4);
DECLARE VARIABLE DESCITEM NUMERIC(18,4);
DECLARE VARIABLE VLRCONTA NUMERIC(18,2);
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE SUB_TRIBUTARIO CHAR(1);
DECLARE VARIABLE NUMERO VARCHAR(15);
DECLARE VARIABLE MES VARCHAR(2);
DECLARE VARIABLE DIA VARCHAR(2);
DECLARE VARIABLE TIPO_FRETE CHAR(1);
DECLARE VARIABLE ISS NUMERIC(18,4);
DECLARE VARIABLE RETEMINSS CHAR(1);
DECLARE VARIABLE RETEMIRRF CHAR(1);
DECLARE VARIABLE RETEMPIS CHAR(1);
DECLARE VARIABLE VLR_DESCTO NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCTO NUMERIC(18,4);
DECLARE VARIABLE FECHADA CHAR(1);
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE TROCA_PROPRIEDADE CHAR(1);
begin
  /*Fb. 05/06/2006
   Procedimento criado para facilitar a customização da NF. Serviço
  para atenter uma necessidade de Sistemaq. Dourados.  */

  /*------------------------------------------------------------------------------*/
  select coalesce(cfg.glo_propriedade_equipamentos,'N') from sis_configuracoes cfg
  where cfg.cnpj = :cnpj
  into :troca_propriedade;

  for select vd.pessoa_fj,  psa.nome_razao , lgd.nome, coalesce(psa.numero,'S/Nº'), br.nome,
      cdd.nome, cdd.uf , psa.fone, psa.cep, psa.cpf_cgc, psa.insc_munic,
      vdi.quantidade, prd.nome, vdi.servico, vdi.prc_unitario, coalesce(vdi.desconto,0),
      vd.pis_cofins_csll, vd.irrf, vd.inss, vd.total, vd.desc_acres, cli.sub_tributario, vd.pgto_frete, coalesce(vd.iss,0),
      cli.ret_inss, cli.ret_irrf, cli.ret_pis, vd.fechada, PSA.rg_ie, PSA.pessoa, VD.natureza, vd.propriedade
      from fat_vendas vd
      inner join fat_vendas_itens vdi on (vdi.codigo = vd.codigo and vdi.cnpj = vd.cnpj)
      inner join est_produtos prd on (vdi.produto = prd.codigo and vdi.cnpj = prd.cnpj)
      inner join glo_pessoas_fj psa on (vd.pessoa_fj = psa.codigo and psa.cnpj = vd.cnpj)
      left join glo_clientes cli on (cli.pessoa_fj = psa.codigo and psa.cnpj = cli.cnpj)
      left join glo_logradouros lgd on (psa.endereco = lgd.codigo and psa.cnpj = lgd.cnpj)
      left join glo_bairros br on (psa.bairro = br.codigo and br.cnpj = psa.cnpj)
      left join glo_cidades cdd on (psa.cidade = cdd.codigo and cdd.cnpj = psa.cnpj)
      where vd.cnpj = :cnpj and vd.codigo = :VENDA and vd.pessoa_fj = :pessoa
      into :pessoa_fj, :cliente, :endereco , :numero, :bairro,
      :cidade, :uf , :fone, :cep, :cpf_cgc, :insc_munic,
      :qtde, :produto, :complemento, :vlritem, :descitem,
      :pis, :irrf, :inss, :total_venda, :desc_acresc, :sub_tributario, :tipo_frete, :iss,
      :reteminss, :retemirrf, :retempis, :fechada, :rg_ie, :TP_pessoa, :natureza, :propriedade
  do
  begin 

    if ((:propriedade is not null) and (troca_propriedade = 'N')) then
    begin
        select pp.nome, pp.ie, coalesce(pp.nome,'')||'-'||coalesce(lgd.nome,'')||' N º'||coalesce(pp.numero,''),
        br.nome, pp.cep, cdd.nome, cdd.uf
        from fat_vendas vd
        inner join glo_propriedades pp on (pp.cnpj = vd.cnpj and pp.propriedade = vd.propriedade and pp.pessoa_fj = vd.pessoa_fj)
        left join glo_logradouros lgd on (lgd.codigo = pp.endereco and lgd.cnpj = pp.cnpj)
        left join glo_bairros br on (br.codigo = pp.bairro and br.cnpj = pp.cnpj)
        left join glo_cidades cdd on (cdd.codigo = pp.cidade and pp.cnpj = cdd.cnpj)
        where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.codigo = :venda
        into :cli_propriedade, :cli_ie, :endereco, :bairro, :cep, :cidade, :uf;
    end

    texto_inss = '';
    texto_irrf = '';
    texto_pis = '';
    texto_desconto = '';
    vlr_inss = 0;
    vlr_irrf = 0;
    vlr_iss = 0;
    vlr_iss_sub = 0;
    vlr_pis = 0;
    vlr_descto = 0;

    /*Colocando máscara no cgc ou cpf*/
--    if (substring(:cpf_cgc from 13 for 13) is  NULL) then
    if (:TP_pessoa='J') then
       cpf_cgc = substring(:cpf_cgc from 1 for 2)||'.'||substring(:cpf_cgc from 3 for 3)||'.'||substring(:cpf_cgc from 6 for 3)||'/'||substring(:cpf_cgc from 9 for 4)||'-'||substring(:cpf_cgc from 13 for 2);
    else
       cpf_cgc = substring(:cpf_cgc from 1 for 3)||'.'||substring(:cpf_cgc from 4 for 3)||'.'||substring(:cpf_cgc from 7 for 3)||'-'||substring(:cpf_cgc from 10 for 2);


    if (:rg_ie='' and :TP_pessoa='J' AND :natureza=1) then
        rg_ie='ISENTO';

    if (:tipo_frete = 'E') then
    begin
      frete_emitente = 'X';
      frete_destinatario = '';
    end
    else
    begin
      frete_emitente = '';
      frete_destinatario = 'X';
    end


   pct_descto = 0;
   /*refazendo essa porcaria..*/
   if (:fechada = 'S') then
   begin
     if (coalesce(:sub_tributario,'N')='S') then
       pct_descto = :pct_descto + :iss;

     if (:retempis = 'S') then
       pct_descto = :pct_descto + :pis;

     if (:retemirrf = 'S') then
       pct_descto = :pct_descto + :irrf;

     if (:reteminss = 'S') then
        pct_descto = :pct_descto + :inss;
   end

   /*remotando os valores da venda, porque o triguer já debita no before-update
   total_venda = (:total_venda * 100/(100.00 - :pct_descto));
   desc_acresc = (:desc_acresc * 100/(100.00 - :pct_descto));*/

    /*Valores de ISS*/
    if (coalesce(:sub_tributario,'N')='S') then
    begin
      vlr_iss = 0;
      vlr_iss_sub = ((total_venda + :desc_acresc) * :iss)/100;
      vlr_descto = :vlr_descto + :vlr_iss_sub;
    end
    else
    begin
      vlr_iss = ((total_venda + :desc_acresc) * :iss)/100;
      vlr_iss_sub = 0;
    end

    base_calc_iss = (:total_venda + :desc_acresc);

    /*Cliente retém PIS*/
    if (:retempis = 'S') then
    begin
      if(:pis > 0) then
      begin
        texto_pis = 'Ret. Fonte-PIS/CSLL/COFINS:';
        vlr_pis = (:pis * (:total_venda + :desc_acresc)/100);
        vlr_descto = :vlr_descto + :vlr_pis;
      end
      else
      begin
        texto_pis = '';
        vlr_pis = 0;
      end
    end

      /*Cliente retém Imposto. de Renda*/
      if (:retemirrf = 'S') then
      begin
        if(:irrf > 0) then
        begin
          texto_irrf = 'Ret. Fonte-IRRF..........:';
          vlr_irrf = (:irrf * (:total_venda + :desc_acresc)/100);
          vlr_descto = :vlr_descto + :vlr_irrf;
        end
        else
        begin
          texto_irrf = '';
          vlr_irrf = 0;
        end
      end

      /*Cliente retém INSS*/
      if (:reteminss = 'S') then
      begin
        if(:inss > 0) then
        begin
          texto_inss = 'Ret. Seg. Social(INSS)...:';
          vlr_inss = (:inss * (:total_venda + :desc_acresc)/100);
          vlr_descto = :vlr_descto + :vlr_inss;
        end
        else
        begin
          texto_inss = '';
          vlr_inss = 0;
        end
     end

   
   endereco = :endereco||', Nº '||:numero;
  /*calculando valores dos itens
   vlritem = ((:vlritem * 100)/(100.00 - :pct_descto));*/
   vlr_unitario = :vlritem - descitem;
   vlr_total_unit = :vlr_unitario * :qtde;

   /*aqui o total é relamente o total já com os tributos retidos,
     por causa do triguer  no beforeupdate de fat-vendas*/

   total_nf = :total_venda - :vlr_descto + :desc_acresc;

   /*Descontos na venda são sempre negativos*/
   if (:desc_acresc < 0) then
   begin
     texto_desconto = 'Desconto na Venda:';
     desc_acresc = :desc_acresc * -1;
   end
   else
    texto_desconto = '';

   /*----------------selecionando os valores das parcelas/ Obs: Na nota só cabem 2-----------*/
   select count(*) from fin_contas_receber rec
   where rec.pessoa_fj = :pessoa_fj and rec.codigo_vn = :venda and rec.cnpj = :cnpj
   into :cont;

   /*caso for mais de uma parcela*/
   if (:cont > 1 ) then
   begin
      /* ---primeira parcela---*/
      select min(rec.dt_vencto) from fin_contas_receber rec
      where rec.pessoa_fj = :pessoa_fj and rec.codigo_vn = :venda and rec.cnpj = :cnpj
      into :dt_vencto;

      select rec.valor from fin_contas_receber rec
      where rec.pessoa_fj = :pessoa_fj and rec.codigo_vn = :venda and rec.cnpj = :cnpj
      and rec.dt_vencto = :dt_vencto
      into :vlrconta;
  
      /*nao sei se isso vai funcionar*/
      fat_fatura1 = '1/'||cast(:cont as varchar(2));

      dia = extract (day from :dt_vencto);
      if (cast(dia as integer) <= 9) then
         dia = '0'||dia;

      mes = extract (month from :dt_vencto);
      if (cast(mes as integer) <= 9) then
         mes = '0'||mes;

      fat_vencto1 = dia||'/'||mes||'/'||extract (year from :dt_vencto);
      fat_vlr1 = cast(:vlrconta as varchar(12));
  
      /* ---resto das parcelas---*/
      select sum(rec.valor) from fin_contas_receber rec
      where rec.pessoa_fj = :pessoa_fj and rec.codigo_vn = :venda and rec.cnpj = :cnpj and rec.dt_vencto <> :dt_vencto
      into :vlrrestante;
  
      fat_fatura2 = 'Diversas';
      fat_vencto2 = 'Diversos';
      fat_vlr2 = cast(:vlrrestante as varchar(12));
   end
   else
   begin
     cont = 0;
     for select rec.dt_vencto, rec.valor  from fin_contas_receber rec
         where rec.pessoa_fj = :pessoa_fj and rec.codigo_vn = :venda and rec.cnpj = :cnpj
         order by rec.dt_vencto
         into :dt_vencto, :vlrconta
     do
     begin
        cont = cont + 1;
        if (:cont = 1) then
        begin
          fat_fatura1 = '1/1';

          dia = extract (day from :dt_vencto);
          if (cast(dia as integer) <= 9) then
             dia = '0'||dia;

          mes = extract (month from :dt_vencto);
          if (cast(mes as integer) <= 9) then
             mes = '0'||mes;


          fat_vencto1 = dia||'/'||mes||'/'||extract (year from :dt_vencto);
          fat_vlr1 = cast(:vlrconta as varchar(12));
        end
        else
        begin
          fat_fatura2 = '2/2';

          dia = extract (day from :dt_vencto);
          if (cast(dia as integer) <= 9) then
             dia = '0'||dia;

          mes = extract (month from :dt_vencto);
          if (cast(mes as integer) <= 9) then
             mes = '0'||mes;


          fat_vencto2 = dia||'/'||mes||'/'||extract (year from :dt_vencto);
          fat_vlr2 = cast(:vlrconta as varchar(12));
        end
     end
   end

   suspend;
  end
END
^

ALTER PROCEDURE PCD_IMPRIME_NF_GRAFICA (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    DT_NF DATE,
    I_NUM_NF INTEGER)
RETURNS (
    CLI_NOME VARCHAR(50),
    VD_CODIGO INTEGER,
    CLI_PROPRIEDADE VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_IE_SUB VARCHAR(15),
    CLI_IE VARCHAR(15),
    CLI_CNPJ VARCHAR(20),
    CLI_ENDERECO VARCHAR(130),
    CLI_BAIRRO VARCHAR(50),
    CLI_CEP VARCHAR(10),
    CLI_CIDADE VARCHAR(50),
    CLI_FONE VARCHAR(20),
    CLI_FAX VARCHAR(20),
    CLI_UF CHAR(2),
    VEND_NOME VARCHAR(50),
    VEND_COD INTEGER,
    VD_NATUREZA VARCHAR(50),
    VD_MSG_ECF VARCHAR(50),
    VD_OBS VARCHAR(200),
    VD_CFOP INTEGER,
    VD_DT_EMISSAO DATE,
    VD_DT_SAIDA DATE,
    VD_HORA_SAIDA TIME,
    VD_ICMS_DEBITADO FLOAT,
    VD_TOTAL_PROD FLOAT,
    VD_TOTAL_LIQUIDO FLOAT,
    VD_TOTAL_NF FLOAT,
    VD_DESCONTO FLOAT,
    VD_VLR_FRETE FLOAT,
    VD_VLR_SEGURO FLOAT,
    VD_VLR_OUTRAS_DESP FLOAT,
    VD_BASE_CALC FLOAT,
    VD_VLR_ICM FLOAT,
    VD_BASE_CALC_SUB FLOAT,
    VD_VOLUME FLOAT,
    VD_VLR_ICM_SUB FLOAT,
    VD_VLR_IPI FLOAT,
    PRD_IPI FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(400),
    PRD_UNIDADE CHAR(4),
    PRD_SIT_TRIB CHAR(6),
    PRD_CL_FIS CHAR(2),
    PRD_QTDE FLOAT,
    PRD_VLR_UNIT FLOAT,
    PRD_PORC_DESC FLOAT,
    PRD_VLR_TTL_ITEM FLOAT,
    PRD_ALIQ_ICM VARCHAR(10),
    PRD_COMPLEMENTO VARCHAR(100),
    PRD_REDUCAO VARCHAR(80),
    PRC_UNITARIO_LIQ FLOAT,
    PRC_UNITARIO FLOAT,
    VDI_COMPLEMENTO VARCHAR(100),
    VDI_CFOP INTEGER,
    PRD_OBSERVACAO VARCHAR(200),
    PRD_PRODUTO_LOTE VARCHAR(250),
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(15),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(50),
    TRP_MARCA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    GPR_OBS BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    VD_MSG_COMPLEMENTAR BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    PC_PARCELAMENTO VARCHAR(300),
    PRD_DEFENSIVO VARCHAR(300),
    PRD_CONCAT VARCHAR(800),
    VD_ENTRADA CHAR(1),
    VD_SAIDA CHAR(1),
    NUM_NF INTEGER,
    ALT_DETALHE FLOAT,
    DESC_ICM_TTL_PROD FLOAT,
    DESC_ICM_LBL_TTL_PROD VARCHAR(50),
    DESC_ICM_TTL_DESCTO FLOAT,
    DESC_ICM_LBL_TTL_DESCTO VARCHAR(50),
    DESC_ICM_TTL_LIQ FLOAT,
    DESC_ICM_LBL_TTL_LIQ VARCHAR(50),
    DESC_ICM_MSG_1 VARCHAR(200),
    DESC_ICM_MSG_2 VARCHAR(200),
    COD_ORIGINADOR VARCHAR(70),
    DT_IMP_NF DATE,
    PARCELA_1_NUMERO VARCHAR(6),
    PARCELA_1_VALOR FLOAT,
    PARCELA_1_VENCTO DATE,
    PARCELA_1_EXTENSO VARCHAR(200),
    PARCELA_2_NUMERO VARCHAR(6),
    PARCELA_2_VALOR FLOAT,
    PARCELA_2_VENCTO DATE,
    PARCELA_2_EXTENSO VARCHAR(200),
    PARCELA_3_NUMERO VARCHAR(6),
    PARCELA_3_VALOR FLOAT,
    PARCELA_3_VENCTO DATE,
    PARCELA_3_EXTENSO VARCHAR(200),
    PARCELA_4_NUMERO VARCHAR(6),
    PARCELA_4_VALOR FLOAT,
    PARCELA_4_VENCTO DATE,
    PARCELA_4_EXTENSO VARCHAR(200),
    PARCELA_5_NUMERO VARCHAR(6),
    PARCELA_5_VALOR FLOAT,
    PARCELA_5_VENCTO DATE,
    PARCELA_5_EXTENSO VARCHAR(200),
    PARCELA_6_NUMERO VARCHAR(6),
    PARCELA_6_VALOR FLOAT,
    PARCELA_6_VENCTO DATE,
    PARCELA_6_EXTENSO VARCHAR(200),
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_VD_VOLUME VARCHAR(30),
    LINHA INTEGER,
    VND_CODIGOS VARCHAR(180))
AS
DECLARE VARIABLE SUBSTITUTO CHAR(1);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE ECF INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE COD_MARCA INTEGER;
DECLARE VARIABLE ICMS FLOAT;
DECLARE VARIABLE IPI FLOAT;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE TROCA_PROPRIEDADE CHAR(1);
DECLARE VARIABLE GPR_OBS_AUX BLOB SUB_TYPE 1 SEGMENT SIZE 200 CHARACTER SET ASCII;
DECLARE VARIABLE SERVICO BLOB SUB_TYPE 1 SEGMENT SIZE 200 CHARACTER SET ASCII;
DECLARE VARIABLE PRD_GERM_AUX NUMERIC(18,2);
DECLARE VARIABLE PRD_PUR_AUX NUMERIC(18,2);
DECLARE VARIABLE PRD_LT_AUX VARCHAR(10);
DECLARE VARIABLE PRD_COD_LT_AUX INTEGER;
DECLARE VARIABLE PRD_PENEIRA_AUX VARCHAR(10);
DECLARE VARIABLE PRD_VALID_AUX DATE;
DECLARE VARIABLE PC_DIA INTEGER;
DECLARE VARIABLE PC_MES INTEGER;
DECLARE VARIABLE PC_AUXDIA CHAR(2);
DECLARE VARIABLE PC_AUXMES CHAR(2);
DECLARE VARIABLE PC_ANO INTEGER;
DECLARE VARIABLE PC_EXTENSO VARCHAR(200);
DECLARE VARIABLE PC_VENCTO DATE;
DECLARE VARIABLE PC_VALOR NUMERIC(18,2);
DECLARE VARIABLE PERC_ICMS NUMERIC(18,2);
DECLARE VARIABLE PC_PARCELA VARCHAR(6);
DECLARE VARIABLE E_S VARCHAR(1);
DECLARE VARIABLE E_I VARCHAR(1);
DECLARE VARIABLE DEBITA_ICMS VARCHAR(1);
DECLARE VARIABLE TP_PESSOA VARCHAR(1);
DECLARE VARIABLE TRANSPORTADORA VARCHAR(50);
DECLARE VARIABLE ORIGEM INTEGER;
DECLARE VARIABLE CONT_PARC INTEGER;
DECLARE VARIABLE AUX_VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE ORIGINADOR INTEGER;
DECLARE VARIABLE NF_ORIGINADOR INTEGER;
DECLARE VARIABLE DT_NF_ORIGINADOR DATE;
DECLARE VARIABLE PAGTO_FRETE CHAR(1);
DECLARE VARIABLE DATA_ORIGINADOR VARCHAR(10);
DECLARE VARIABLE DIA_ORIGINADOR VARCHAR(2);
DECLARE VARIABLE AUX INTEGER;
DECLARE VARIABLE MES_ORIGINADOR VARCHAR(15);
DECLARE VARIABLE NUM_MAX_ITENS INTEGER;
DECLARE VARIABLE ITEM INTEGER;
DECLARE VARIABLE XCONT INTEGER;
DECLARE VARIABLE AUX1 INTEGER;
DECLARE VARIABLE AUX2 INTEGER;
DECLARE VARIABLE AUX3 INTEGER;
DECLARE VARIABLE NMOD FLOAT;
DECLARE VARIABLE IMP_ASTERISCO CHAR(1);
DECLARE VARIABLE AUXNOME_PROD VARCHAR(50);
DECLARE VARIABLE AUX_PRD_REDUCAO VARCHAR(80);
begin

  ITEM = 0;
  /*numero maximo de itens por folha*/
  select coalesce(ep.num_itens_nf,13) from sis_empresas ep
  where ep.cnpj = :cnpj
  into :num_max_itens;

  if ((:dt_nf is null) or (:dt_nf < '01.01.2000')) then
    dt_nf = cast ('today' as date);

  dt_imp_nf = :dt_nf;
  /* ------------------------- Parcelamento 2 ------------------------------------------------- */
  pc_parcelamento = '';
  /*verificando quantos parcelamentos tenho desta venda, para poder validar a listagem deles na NF*/
  select count(*) from fat_vendas_parcelamento pc where pc.cnpj = :cnpj and pc.codigo = :venda
  into :cont_parc;

  cont = 0;
  aux_valor = 0;
  parcela_1_numero = '';
  parcela_1_valor = null;
  parcela_1_vencto = null;
  parcela_1_extenso = 'À Vista';

  for select extract(day from pc.vencto), extract(month from pc.vencto), extract(year from pc.vencto),
      pc.valor, pc.parcela, pc.vencto, pc.valor_extenso
       from fat_vendas_parcelamento pc
      where pc.cnpj = :cnpj and pc.codigo = :venda
  into :pc_dia, :pc_mes, :pc_ano,
       :pc_valor, :pc_parcela, :pc_vencto, :pc_extenso
  do
  begin
    cont = cont + 1;
    /*utilizado em agronegocio*/
    if (cont = 1) then
    begin
      parcela_1_numero = :pc_parcela;
      parcela_1_valor = :pc_valor;
      parcela_1_vencto = :pc_vencto;
      parcela_1_extenso = :pc_extenso;
    end
    else if (cont = 2) then
    begin
      parcela_2_numero = :pc_parcela;
      parcela_2_valor = :pc_valor;
      parcela_2_vencto = :pc_vencto;
      parcela_2_extenso = :pc_extenso;
    end
    else if (cont = 3) then
    begin
      parcela_3_numero = :pc_parcela;
      parcela_3_valor = :pc_valor;
      parcela_3_vencto = :pc_vencto;
      parcela_3_extenso = :pc_extenso;
    end
    else if (cont = 4) then
    begin
      parcela_4_numero = :pc_parcela;
      parcela_4_valor = :pc_valor;
      parcela_4_vencto = :pc_vencto;
      parcela_4_extenso = :pc_extenso;
    end
    else if (cont = 5) then
    begin
      parcela_5_numero = :pc_parcela;
      parcela_5_valor = :pc_valor;
      parcela_5_vencto = :pc_vencto;
      parcela_5_extenso = :pc_extenso;
    end else if (cont = 6) then
    begin
      parcela_6_numero = :pc_parcela;
      parcela_6_valor = :pc_valor;
      parcela_6_vencto = :pc_vencto;
      parcela_6_extenso = :pc_extenso;
    end

    if (:pc_dia <= 9) then
      pc_auxdia = '0'||:pc_dia;
    else
      pc_auxdia = :pc_dia;

    if (:pc_mes <= 9) then
      pc_auxmes = '0'||:pc_mes;
    else
      pc_auxmes = :pc_mes;

    if (:cont <= 10) then
    begin
      if ((:cont <= 9) or (:cont_parc <=10)) then
        pc_parcelamento = pc_parcelamento||' - '||:pc_parcela||' '||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||'  '||:pc_valor||'  ';
      else
        aux_valor = :aux_valor + :pc_valor; /*passando a contabilizar a 10 parcela no restante*/
    end
    else
      aux_valor = :aux_valor + :pc_valor;
  end
  if (:aux_valor > 0) then
    pc_parcelamento = pc_parcelamento||'Vlr. Rest: '||:aux_valor;

  if (pc_parcelamento = '') then
  begin
   select coalesce(vd.nome_forma,'À Vista') from fat_vendas vd
   where vd.codigo = :venda and vd.pessoa_fj = :pessoa_fj
   into :pc_parcelamento;
                                 
  end

  /*------------------------------------------------------------------------------*/
  select coalesce(cfg.glo_propriedade_equipamentos,'N') from sis_configuracoes cfg
  where cfg.cnpj = :cnpj
  into :troca_propriedade;

  /*---------------------------Dados da Venda-------------------------------------*/
  select nat.cfop_descricao, nat.msg_fiscal, nat.cfop, coalesce(vd.icm,0), vd.total, vd.desc_acres,coalesce(vd.total,0)+coalesce(vd.desc_acres,0),
  coalesce(vd.ipi,0), coalesce(vd.frete,0),coalesce(vd.seguro,0), vd.propriedade, nat.es, nat.interestadual, nat.perc_icms,
  coalesce(vd.despesas,0), substring(vd.observacao from 1 for 200), vd.num_nf, vd.id_agrupador,
  coalesce(vd.base_icm,0),
  coalesce(vd.ICM,0),
  coalesce(vd.BASE_ICM_SUBST,0),
  coalesce(vd.VALOR_ICM_SUBST,0)
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.codigo = :venda
  into :vd_natureza, :vd_msg_fiscal, :vd_cfop, :icms, :vd_total_prod, :vd_desconto,
  :vd_total_liquido, :ipi, :vd_vlr_frete, :vd_vlr_seguro, :propriedade, :E_S, :E_I, :perc_icms,
  :vd_vlr_outras_desp, :VD_OBS, :num_nf, :originador,
  :vd_base_calc,
  :vd_vlr_icm,
  :vd_base_calc_sub,
  :vd_vlr_icm_sub
  ;

  /*se possui nf relacionada, devolucao - simples remessa..*/
  if (:originador is not null) then
  begin
    select coalesce(vd.num_nf,0), vd.data  from fat_vendas vd
    where vd.cnpj = :cnpj and vd.codigo = :originador
    into :nf_originador, :dt_nf_originador;

    AUX = extract(day from :DT_NF_ORIGINADOR);
    if (:aux <=9) then
      dia_originador = '0'||:aux;
    else
      dia_originador = :aux;

    AUX = extract(month from :DT_NF_ORIGINADOR);
    if (:aux <=9) then
      mes_originador = '0'||:aux;
    else
      mes_originador = :aux;

    DATA_ORIGINADOR =  :dia_originador||'/'||:mes_originador||'/'||extract(year from :DT_NF_ORIGINADOR);

    cod_originador = 'Conforme NF de venda Nº '||cast(:nf_originador as varchar(10))||' - '||:DATA_ORIGINADOR;
  end

  num_nf = :i_num_nf;
  /*Utilizado somente na fert-flora pra cálculo de valores de
  imposto deduzidos*/
  if ((:E_S = 'S') and (:E_I = 'E') and (:perc_icms > 0)) then           /*Aqui*/
  begin
    /*tirando do desconto da venda o descto do icms.. pra nao misturar rs*/
    desc_icm_lbl_ttl_prod =   'Total Produtos..:';
    desc_icm_ttl_prod = :vd_total_prod / (((100 - :perc_icms)/100.00));

    desc_icm_lbl_ttl_descto = 'Desconto de ICMS:';
    desc_icm_ttl_descto = desc_icm_ttl_prod - :vd_total_prod;
    desc_icm_lbl_ttl_liq =    'Total Liq.......:';
    desc_icm_ttl_liq = :vd_total_prod;

    desc_icm_msg_1 = 'Isento conforme o decreto 9078 de 06.04.98 conforme convênio ICMS 100/97';
    desc_icm_msg_2 = 'Desconto de Icms cfe. art. 29, anexo I do RICMS';

  end
  else
  begin
    desc_icm_msg_1 = NULL;
    desc_icm_msg_2 = NULL;

    desc_icm_lbl_ttl_prod = null;
    desc_icm_ttl_prod = null;

    desc_icm_lbl_ttl_descto = null;
    desc_icm_lbl_ttl_liq =  null;
    desc_icm_ttl_liq =  null;
  end


  if (:e_s = 'S') then
  begin
    vd_saida = 'X';
    vd_entrada = ' ';
  end
  else
  begin
    vd_saida = ' ';
    vd_entrada = 'X';
  end

  /*16.716.814/0001-67
    971.736.301-34*/
  /*---------------Campos sem noção------------*/

  vd_dt_emissao = :dt_nf;
  vd_dt_saida = :dt_nf;

  /*----------------Impostos-------------*/
  vd_VLR_ipi = :ipi;

  vd_total_nf = (:vd_total_liquido + :vd_vlr_frete + :vd_vlr_seguro + :vd_vlr_outras_desp + :vd_vlr_ipi);

  /*---------------------------Cliente ou Propriedade----------------------------------------------*/
  select coalesce(cli.sub_tributario,'N'), psa.nome_razao, coalesce(psa.cpf_cgc,''), psa.rg_ie,
         coalesce(lgd.nome,'')||' N º'||coalesce(psa.numero,''), br.nome, psa.cep, cdd.nome,
         psa.fone, cdd.uf, coalesce(vd.num_cupom,0), psa.pessoa, vd.trp_nome, vdd.codigo, vdd.nome, psa.fax
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
  inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
  left join glo_clientes cli on (cli.pessoa_fj = psa.codigo  and psa.cnpj = cli.cnpj)
  left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
  left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
  left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
  left  join fat_vendedor   vdd   on (vd.vendedor   = vdd.codigo    and vdd.cnpj = vd.cnpj  )
  where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.codigo = :venda
  into :substituto, :cli_nome, :cli_cnpj, :cli_ie,
  :cli_endereco,
  :cli_bairro, :cli_cep, :cli_cidade, :cli_fone, :cli_uf, :ecf, :tp_pessoa, :trp_nome, :vend_cod, :vend_nome,
  :cli_fax;

  /*código do cliente para impressão da NF*/
  cli_codigo = :pessoa_fj;

  /*Máscara cpf/cnpj*/
  if (:tp_pessoa = 'J') then
    cli_cnpj = substring(:cli_cnpj from 1 for 2)||'.'||substring(:cli_cnpj from 3 for 3)||'.'||substring(:cli_cnpj from 6 for 3)||'/'||substring(:cli_cnpj from 9 for 4)||'-'||substring(:cli_cnpj from 13 for 2);
  else
    cli_cnpj = substring(:cli_cnpj from 1 for 3)||'.'||substring(:cli_cnpj from 4 for 3)||'.'||substring(:cli_cnpj from 7 for 3)||'-'||substring(:cli_cnpj from 10 for 2);

  vd_codigo = :venda;

  vnd_codigos = 'FAT(s): '||:venda;
  if (:ecf > 0) then
     vd_msg_ecf = 'Nota Fiscal conforme Cupom Fiscal Nº: '||:ecf;
  else
     vd_msg_ecf = '';

  /*Caso tenha sido definida uma propriedade na venda, então os dados impressos
  referentes a endereço devem ser os da propriedade*/
  if ((:propriedade is not null) and (troca_propriedade = 'N')) then
  begin
    select pp.nome, pp.ie, coalesce(pp.nome,'')||'-'||coalesce(lgd.nome,'')||' N º'||coalesce(pp.numero,''),
    br.nome, pp.cep, cdd.nome, cdd.uf
    from fat_vendas vd
    inner join glo_propriedades pp on (pp.cnpj = vd.cnpj and pp.propriedade = vd.propriedade and pp.pessoa_fj = vd.pessoa_fj)
    left join glo_logradouros lgd on (lgd.codigo = pp.endereco and lgd.cnpj = pp.cnpj)
    left join glo_bairros br on (br.codigo = pp.bairro and br.cnpj = pp.cnpj)
    left join glo_cidades cdd on (cdd.codigo = pp.cidade and pp.cnpj = cdd.cnpj)
    where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.codigo = :venda
    into :cli_propriedade, :cli_ie, :cli_endereco, :cli_bairro, :cli_cep, :cli_cidade, :cli_uf;
  end

  if (:substituto = 'S') then
  begin
    cli_ie_sub = :cli_ie;
    cli_ie = '';
  end
  else
    cli_ie_sub = '';

  /*totalizações da Pedido, parecido com a NF, copiado de lá */
  select  /*sum(coalesce(vdi.basecalculosubstituicao,0)), sum(coalesce(vdi.icm_subs,0)),
  sum(coalesce(vdi.basecalculoicm,0)), sum(coalesce(vdi.icm,0)),
  */case sum(coalesce(vdi.volume,0))
    when 0 then sum(coalesce(vdi.quantidade,0))
    else  sum(coalesce(vdi.quantidade,0)/
                                        (case coalesce(vdi.volume,0)
                                          when 0 then 1
                                          else coalesce(vdi.volume,0)
                                         end
                                        )
                                        )
  end

   from fat_vendas_itens vdi
  where vdi.cnpj = :cnpj and vdi.codigo = :venda
  into /*:vd_base_calc_sub, :vd_vlr_icm_sub,
       :vd_base_calc, :vd_vlr_icm,*/ :vd_volume;

   /*------------------------------------------Transportador-----------------------------------------------------*/
   select vd.trp_peso_bruto, vd.trp_peso_liquido, vd.trp_numero, vd.trp_qtde, VD.trp_marca, VD.trp_especie, tp.nome,
   tp.cpf_cnpj, tp.placa, tp.endereco, tp.cidade, tp.uf, tp.ie, vd.pgto_frete
   from fat_vendas vd
   left join glo_transportadoras tp on (tp.codigo = vd.transportadora and tp.cnpj = vd.cnpj)
   where vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and vd.codigo = :venda
   into :trp_peso_bruto, :trp_peso_liq, :trp_numero, :trp_peso_qtde, :cod_marca, :trp_especie, :transportadora,
   :trp_cnpj, :trp_placa, :trp_endereco, :trp_cidade, :trp_uf, :trp_ie, :pagto_frete;

   if ((coalesce(:trp_nome,'') = '') and (coalesce(transportadora,'') = ''))then
      trp_nome = 'Em mãos';
   else if (:transportadora <> '') then
      trp_nome = :transportadora;

   select mr.nome from est_marcas mr
   where mr.cnpj = :cnpj and mr.codigo = :cod_marca
   into :trp_marca;

   /*---------------Campos sem noção------------*/
   trp_uf_veiculo = '';


   if (pagto_frete = '1') then
      trp_frete = 1;
   else if (pagto_frete = '2') then
      trp_frete = 2;

  vnd_codigos = 'FAT: '||:venda;
  /*------------------------------------------Produtos e Vlrs. de Vendas----------------------------------------*/
  select count(*) from fat_vendas_itens vdi
  where vdi.cnpj = :cnpj and vdi.codigo = :venda
  into :xcont;

  for select prd.codigo, prd.nome, prd.unidade,
      coalesce(vdi.quantidade,0),
      coalesce(vdi.prc_unit_original,0),
      coalesce(vdi.prc_unitario,0),
      coalesce(vdi.prc_unit_original,0),
      coalesce(vdi.porc_desc,0),
      ((coalesce(vdi.prc_unitario,0)) * coalesce(vdi.quantidade,0)),
      coalesce(vdi.complemento,''), sg.obs,
      coalesce(vdi.lote,''), coalesce(vdi.codigo_lote,0), coalesce(lt.germinacao,0), coalesce(lt.peneira,''), coalesce(lt.pureza,0), lt.validade,
      prd.complemento_nf, prd.CTE, prd.ctie, vdi.origem, vdi.ipi, vdi.mensagem_reducao, coalesce(prd.debita_icms,'N'),
      vdi.cfop, VDI.servico
      from fat_vendas_itens vdi
      inner join est_produtos prd on (vdi.produto = prd.codigo and vdi.cnpj = prd.cnpj)
      left join est_subgrupos sg on (sg.subgrupo = prd.subgrupo and sg.grupo = prd.grupo and sg.cnpj = prd.cnpj)
      left join est_lote_produto lt on (lt.produto = vdi.produto and lt.codigo = vdi.codigo_lote and vdi.cnpj = lt.cnpj)
      where vdi.cnpj = :cnpj and vdi.codigo = :venda
      into :prd_codigo, :auxnome_prod, :prd_unidade,
      :prd_qtde,
      :prd_vlr_unit,
      :prc_unitario_liq,
      :prc_unitario,/*Preco Original do produto*/
      :prd_porc_desc,
      :prd_vlr_ttl_item,
      :vdi_complemento, :gpr_obs_aux,
      :prd_lt_aux, :prd_cod_lt_aux, :prd_germ_aux, :prd_peneira_aux, :prd_pur_aux, :prd_valid_aux,
      :prd_complemento, :cte, :ctie, :origem, :prd_ipi, :aux_prd_reducao, :debita_icms,
      :vdi_cfop, :servico
  do
  begin
    if (coalesce(:aux_prd_reducao,'') <> '') then
      prd_reducao = aux_prd_reducao;

    IMP_ASTERISCO = 'N';
    linha = coalesce(:linha,0)+1;
    /* Função MOD
    Supondo que o campo CA é o dividendo, e o CB o divisor, para eu obter o resultado do mod, ficaria assim:
    select :ca -  ((ca / cast(cb as integer) ) * cb ) from rdb$database
    nmod = :num_max_itens - ((num_max_itens/:item) * item);*/

    /*verificando se o item é multiplo do do máximo de itens*/
    if (:item > 0) then
      nmod = :num_max_itens - ((num_max_itens/:item) * item);

    item = item + 1;

    /*salto de página, mostrar somente asteríscos no rodapé*/

    if ((:linha - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
    else if (:linha > :num_max_itens) then
    begin
     if (((:linha - :num_max_itens) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
     else if (((:linha- (:num_max_itens * 2)) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
     else if (((:linha - (:num_max_itens *3)) - 1) = :num_max_itens) then
       IMP_ASTERISCO = 'S' ;
    end

    if (:imp_asterisco = 'S')then
    begin
      item = 1;
      S_VD_TOTAL_NF =        '***************';
      S_VD_VLR_IPI =         '***************';
      S_VD_VLR_OUTRAS_DESP = '***************';
      S_VD_VLR_SEGURO =      '***************';
      S_VD_VLR_FRETE =       '***************';
      S_VD_TOTAL_PROD =      '***************';
      S_VD_VLR_ICM =         '***************';
      S_VD_VLR_ICM_SUB =     '***************';
      S_VD_BASE_CALC =       '***************';
      S_VD_VOLUME    =       '***************';
      S_VD_BASE_CALC_SUB =   '***************';
      S_VD_VOLUME =   '***************';

    end
    else
    begin
     /* select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:vd_volume) into :s_vd_volume;
      select sai from SP_FORMAT_FLOAT(:s_vd_volume) into :s_vd_volume;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;*/
    end


    /*------------------------- Situação Tributária ------------------------------*/
    PRD_ALIQ_ICM = :PERC_ICMS;
    if (:debita_icms = 'S') then
    begin
       /* prd_vlr_unit  = :prd_vlr_unit + ((:prd_vlr_unit * :perc_icms)/100.00);
        prd_vlr_ttl_item = :prd_vlr_ttl_item + ((:prd_vlr_ttl_item * :perc_icms)/100.00);  */
        desc_icm_msg_1 = 'Isento conforme o decreto 9078 de 06.04.98 conforme convênio ICMS 100/97';
        desc_icm_msg_2 = 'Desconto de Icms cfe. art. 29, anexo I do RICMS';
    end

    if (:E_I = 'E') then
    begin
       /*estadual leva em consideração o campo cte de estadual do cad. produtos*/
       if (:cte = 1) then
         prd_sit_trib = :origem||'00';
       else if (:cte = 2) then
         prd_sit_trib = :origem||'20';
       else if (:cte = 3) then
       begin
         prd_sit_trib = :origem||'40';
         prd_aliq_icm = 0;
       end
       else if (:cte = 5) then
         prd_sit_trib = :origem||'51';
       else if (:cte = 6) then
       begin
         prd_sit_trib = :origem||'60';
         prd_aliq_icm = 'ST';
         vd_msg_complementar = ' ICMS ST CONFORME SUBANEXO UNICO DO ANEXO III  DO RICMS/MS ';
       end
       else if (:cte = 7) then
         prd_sit_trib = :origem||'90';
       else
         prd_sit_trib = :origem||'00';

       if ((:debita_icms = 'S') and (prd_aliq_icm <> 'ST')) then
           prd_aliq_icm = 0;

    end
    else
    begin
       /*interestadual leva em consideração o campo ctie de estadual do cad. produtos*/
       if (:ctie = 1) then
         prd_sit_trib = :origem||'00';
       else if (:ctie = 2) then
         prd_sit_trib = :origem||'20';
       else if (:ctie = 3) then
       begin
         prd_sit_trib = :origem||'40';
         prd_aliq_icm = 0;
       end
       else if (:ctie = 5) then
         prd_sit_trib = :origem||'51';
       else if (:ctie = 6) then
       begin
         prd_sit_trib = :origem||'60';
         prd_aliq_icm = 'ST';
         vd_msg_complementar = ' ICMS ST CONFORME SUBANEXO UNICO DO ANEXO III  DO RICMS/MS ';
       end
       else if (:ctie = 7) then
         prd_sit_trib = :origem||'90';
       else
         prd_sit_trib = :origem||'00';   
    end


    /*defensivo*/
    PRD_DEFENSIVO = '';
    select 'Cl. Tóx.: '||coalesce(tx.descricao,'')||' - Cl. Risco:'||coalesce(def.classe_risco,'')||' - Nº ONU: '||coalesce(def.numero_onu,'')||' - P. Ativo: '||coalesce(def.ingrediente_ativo,'') from agr_defensivo_agricola def
    left join agr_classe_toxicologica tx on (tx.cnpj = def.cnpj and tx.codigo = def.cod_classe_toxicologica)
    where def.cnpj = :cnpj and def.cod_produto = :prd_codigo
    into :PRD_DEFENSIVO;


    prd_produto_lote =  '';
    if (:prd_cod_lt_aux > 0) then
    begin
      select ('Lt: '||coalesce(lt.lote,'')||' ,') from est_lote_produto lt where lt.cnpj = :cnpj and lt.codigo = :prd_cod_lt_aux and lt.produto = :prd_codigo
      into :prd_produto_lote;
    end

    if (:prd_peneira_aux <> '') then
      prd_produto_lote = prd_produto_lote||' Pn:'||:prd_peneira_aux||',';

    if (:prd_valid_aux is not null) then
      prd_produto_lote = prd_produto_lote|| ' Val:'||:prd_valid_aux||',';

    if (:prd_pur_aux > 0) then
      prd_produto_lote = prd_produto_lote|| ' Pur:'||:prd_pur_aux||'%,';

    if (:prd_germ_aux > 0) then
      prd_produto_lote = prd_produto_lote|| ' Germ:'||:prd_germ_aux||'%';

    if (gpr_obs_aux is not null) then
       gpr_obs = gpr_obs_aux;

    if ((gpr_obs_aux is null) and (:servico is not null)) then
       gpr_obs = :servico;

    if (:vdi_complemento is not null) then
      prd_nome = :auxnome_prod||'-'||:vdi_complemento;
    else
      prd_nome = :auxnome_prod;

    PRD_CL_FIS = '?';
    prd_concat = :prd_nome||'  -  '||coalesce(:prd_produto_lote,'')||' '||coalesce(:prd_defensivo,'');
    suspend;

  end

  if (xcont > :num_max_itens) then
  begin
    aux1 = (xcont/:num_max_itens);
    aux2 = :aux1 * :num_max_itens;
    aux3 = :xcont - :aux2;

    /*ultima folha terá somente um item e teremos de mostrar o total,
    criando um registro "ficticio"..*/
    if (:aux3 = 1) then
    begin
      select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:vd_volume) into :s_vd_volume;
      select sai from SP_FORMAT_FLOAT(:s_vd_volume) into :s_vd_volume;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;

      PRD_IPI  = null;
      PRD_CODIGO = null;
      PRD_NOME = null;
      PRD_UNIDADE = null;
      PRD_SIT_TRIB = null;
      PRD_CL_FIS = null;
      PRD_QTDE = null;
      PRD_VLR_UNIT = null;
      PRD_PORC_DESC  = null;
      PRD_VLR_TTL_ITEM  = null;
      PRD_ALIQ_ICM  = null;
      PRD_COMPLEMENTO  = null;
      PRD_REDUCAO  = null;
      PRC_UNITARIO_LIQ  = null;
      PRC_UNITARIO  = null;
      VDI_COMPLEMENTO  = null;
      VDI_CFOP  = null;
      PRD_OBSERVACAO  = null;
      PRD_PRODUTO_LOTE  = null;
      suspend;
    end
  end
  /*criando um registro ficticio na ultima página para permitir a totalização correta do rodape,
  gambiarra por causa do report builder*/
  update fat_vendas v set selecionada = 'N'
  where selecionada = 'S' and v.pessoa_fj = :pessoa_fj and v.cnpj = :cnpj;
END
^

ALTER PROCEDURE PCD_IMPRIME_OS (
    CNPJ VARCHAR(15),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    PSA_CODIGO INTEGER,
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_FANTASIA VARCHAR(50),
    PSA_ENDERECO VARCHAR(100),
    PSA_BAIRRO VARCHAR(50),
    PSA_CEP VARCHAR(8),
    PSA_FONE VARCHAR(20),
    PSA_CONTATO VARCHAR(50),
    PSA_CIDADE VARCHAR(80),
    PSA_REGIAO VARCHAR(60),
    OS_NOME_TECNICO VARCHAR(50),
    OS_KM INTEGER,
    OS_EQUIPAMENTO VARCHAR(50),
    OS_EQ_MODELO VARCHAR(50),
    OS_EQ_MARCA VARCHAR(50),
    OS_EQ_SERIE VARCHAR(30),
    OS_SOLICITANTE VARCHAR(50),
    OS_DEFEITO_RECLAMADO VARCHAR(50),
    OS_OBS_FECHAMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_PESSOA_OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OS_DT_PROGRAMACAO DATE,
    OS_HR_PROGRAMACAO TIME,
    OS_TECNICO VARCHAR(50),
    OS_MOTIVO_CHAMADO VARCHAR(50),
    OS_TIPO_ATENDIMENTO VARCHAR(50),
    OS_CT_TOTAL INTEGER,
    OS_CT_COR INTEGER,
    OS_CT_PRETO INTEGER,
    OS_DT_CILINDRO DATE,
    OS_CT_CILINDRO INTEGER,
    OS_CT_REVELADOR INTEGER,
    OS_DT_REVELADOR DATE,
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_TOTAL FLOAT,
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(50),
    OS_DT_INICIO DATE,
    OS_TIPO_CONTRATO VARCHAR(50),
    OS_HR_INICIALIZACAO TIME,
    OS_DT_FINALIZACAO DATE,
    OS_HR_FINALIZACAO TIME,
    CAB_NOME_EMPRESA VARCHAR(50),
    CAB_END_EMPRESA VARCHAR(200),
    CAB_FONE_EMPRESA VARCHAR(20),
    VEI_PLACA VARCHAR(8),
    VEI_COR VARCHAR(50),
    VEI_MODELO VARCHAR(50),
    VEI_ANO INTEGER,
    VEI_CHASSI VARCHAR(50),
    VEI_MARCA VARCHAR(50),
    PSA_CPF VARCHAR(15),
    PSA_RG_IE VARCHAR(20),
    OS_CODIGO INTEGER,
    OS_EQUIPAMENTO_OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
DECLARE VARIABLE ITENS INTEGER;
DECLARE VARIABLE COD_EQUIPAMENTO VARCHAR(15);
DECLARE VARIABLE OFC_EXIBE_VISUALIZACAO CHAR(1);
begin
  select OFC_EXIBE_VISUALIZACAO from sis_empresas e
  where e.cnpj = :cnpj
  into :ofc_exibe_visualizacao;

  /*Dados do Corpo da OS*/
  select distinct psa.nome_razao, psa.fantasia, coalesce(lgd.nome,'')||' Nº '||coalesce(psa.numero,'') ,
  br.nome, psa.cep, psa.fone, psa.contato, coalesce(cdd.nome,'')||' - '||coalesce(cdd.uf,''),
  rg.nome, prd.nome, mdl.nome , prd.marca, prd.serie, os.cliente, def.nome,
  os.informacoes, os.dt_atribuicao, os.hr_atribuicao, tec.nome, mc.nome, ta.nome,
  os.obs_fechamento, os.contador_total, os.contador_cor, os.contador_preto,
  os.dt_inicializacao, os.hr_inicializacao, os.dt_finalizacao, os.hr_finalizacao,
  os.ct_revelador, os.ct_cilindro, psa2.nome_razao, tpc.nome, prd.codigo, psa.obs,
  cti.INFORMACOES_ITENS,
  v.placa, v.cor, v.modelo, v.ano, V.n_chassi,
  m.nome, psa.cpf_cgc, psa.rg_ie,
  os.pessoa_fj, os.km
  from ofc_ordem_servico os
  left join glo_pessoas_fj psa on (psa.codigo = os.pessoa_fj and psa.cnpj = os.cnpj)
  left join glo_regioes rg on (rg.codigo = psa.regiao and rg.cnpj = psa.cnpj)
  left join glo_logradouros lgd on (psa.endereco = lgd.codigo and psa.cnpj = lgd.cnpj)
  left join glo_bairros br on (br.codigo = psa.bairro and psa.cnpj = br.cnpj)
  left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
  left join est_produtos prd on (prd.codigo = os.produto and os.cnpj = prd.cnpj)
  left join est_marcas mr on (prd.marca = mr.codigo and os.cnpj = prd.cnpj)
  left join glo_modelo_propriedade mdl on (mdl.codigo = prd.modelo and mdl.cnpj = prd.cnpj)
  left join ofc_contratos ct on (ct.codigo = os.id_contrato and ct.cnpj = os.cnpj)
  left join ofc_contratos_itens cti on (os.id_contrato = cti.contrato and cti.cnpj = os.cnpj and os.produto = cti.cod_produto)
  left join glo_tipo_contrato tpc on (tpc.codigo = ct.cod_contrato and tpc.cnpj = ct.cnpj)
  left join ofc_defeito def on (def.codigo = os.defeito_reclamado and os.cnpj = def.cnpj)
  left join ofc_mecanicos tec on (tec.codigo = os.mecanico and os.cnpj = tec.cnpj)
  left join glo_pessoas_fj psa2 on (psa2.codigo = tec.pessoa_fj and psa2.cnpj = tec.cnpj)
  left join ofc_motivo_chamado mc on (mc.codigo = os.id_motivo_chamado and mc.cnpj = os.cnpj)
  left join ofc_tipo_atendimento ta on (ta.codigo = os.id_tipo_atendimento and ta.cnpj = os.cnpj)
  left join glo_veiculos v on (v.codigo = os.veiculo and v.cnpj = os.cnpj)
  left join glo_marca_veiculos m on (m.codigo = v.marca_veiculo and v.cnpj = m.cnpj)
  where (os.cnpj = :cnpj) and (os.pessoa_fj = :pessoa_fj) and os.codigo = :codigo
  into :psa_nome_razao, :psa_fantasia, :psa_endereco,
  :psa_bairro, :psa_cep, :psa_fone, :psa_contato, :psa_cidade,
  :psa_regiao, :os_equipamento, :os_eq_modelo, :os_eq_marca, :os_eq_serie, :os_solicitante, :os_defeito_reclamado,
  :os_informacoes, :os_dt_programacao, :os_hr_programacao, :os_tecnico, :os_motivo_chamado, :os_tipo_atendimento,
  :os_obs_fechamento, :os_ct_total, :os_ct_cor, :os_ct_preto,
  :os_dt_inicio, :os_hr_inicializacao, :os_dt_finalizacao, :os_hr_inicializacao,
  :os_ct_revelador, :os_ct_cilindro, :os_nome_tecnico, :os_tipo_contrato, :cod_equipamento, :os_pessoa_obs,
  :OS_EQUIPAMENTO_OBS,
  :vei_placa, :vei_cor, :vei_modelo, :vei_ano, :vei_chassi,
  :vei_marca, :psa_cpf, :psa_rg_ie,
  :psa_codigo, :os_km;

  select max(os.dt_revelador), max(os.dt_cilindro) from ofc_ordem_servico os
  where os.produto = :cod_equipamento and os.pessoa_fj = :pessoa_fj
  into :os_dt_revelador, :os_dt_cilindro;

  /*maior contador do revelador na data da troca*/
  select max(os.ct_revelador) from ofc_ordem_servico os
  where os.produto = :cod_equipamento and os.pessoa_fj = :pessoa_fj and os.dt_revelador = :os_dt_revelador
  into :os_ct_revelador;

 /*maior contador do cilindro na data da troca*/
  select max(os.ct_cilindro) from ofc_ordem_servico os
  where os.produto = :cod_equipamento and os.pessoa_fj = :pessoa_fj and os.dt_cilindro = :os_dt_cilindro
  into :os_ct_cilindro;

  os_codigo = :codigo;
  /*dados da empresa*/
  select emp.nome, coalesce(emp.endereco,'')||' - '||coalesce(emp.cidade,'')||'-'||coalesce(emp.uf,'')||' - '||coalesce(emp.fone,''),
  emp.fone from sis_empresas emp
  where emp.cnpj = :cnpj
  into :cab_nome_empresa, :cab_end_empresa, :cab_fone_empresa;

  /*dados dos produtos*/
  itens = 0;
  for select oss.quantidade, oss.produto, prd2.nome, oss.unitario   from ofc_ordem_servico_servico oss
      inner join est_produtos prd2 on (oss.produto = prd2.codigo and oss.cnpj = prd2.cnpj)
      where oss.codigo = :codigo and oss.cnpj = :cnpj
      into :prd_qtde, :prd_codigo, :prd_nome, :prd_unitario
  do
  begin
      prd_total = (:prd_qtde * :prd_unitario);
      itens = (itens + 1);
      suspend;
  end

  if (:ofc_exibe_visualizacao <> '1') then
  begin
      while (:itens <= 8) do
      begin
        prd_qtde = null;
        prd_codigo = null;
        prd_nome = null;
        suspend;
        itens = itens + 1;
      end
   end
END
^

ALTER PROCEDURE PCD_IMPRIME_PROMISSORIA (
    CNPJ VARCHAR(15),
    CODIGO INTEGER,
    TIPO CHAR(1))
RETURNS (
    PSA_CODIGO INTEGER,
    VD_DATA DATE,
    VD_CODIGO INTEGER,
    VD_COD_VENDEDOR INTEGER,
    VD_NF INTEGER,
    VD_CF VARCHAR(20),
    PC_PARCELA VARCHAR(6),
    PSA_FONE VARCHAR(20),
    PC_VALOR FLOAT,
    PC_VENCTO DATE,
    PC_DIA INTEGER,
    PC_MES INTEGER,
    PC_ANO INTEGER,
    PSA_NOME VARCHAR(50),
    PSA_ENDERECO VARCHAR(100),
    PSA_BAIRRO VARCHAR(50),
    PSA_CIDADE VARCHAR(50),
    PSA_CNPJ VARCHAR(14),
    PSA_RG_IE VARCHAR(15))
AS
DECLARE VARIABLE IMPRIME_TOTALIZADOR CHAR(1);
DECLARE VARIABLE NUM_CF INTEGER;
begin
  select np.imprime_totalizador from sis_notapromissoria np
  where np.cnpj = :cnpj
  into :imprime_totalizador;

  if (:tipo = 'V') then /*venda*/
  begin
      for select psa.codigo,psa.rg_ie, vd.data, vd.codigo, pc.parcela, pc.valor,pc.vencto,
          extract(day from pc.vencto), extract(month from pc.vencto),extract(year from pc.vencto),
          coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''),coalesce(lgd.nome,'')||' - '||coalesce(psa.numero,''),
          br.nome, coalesce(cdd.nome,'')||'-'||coalesce(cdd.uf,''),psa.cnpj, psa.fone, vd.vendedor, vd.num_cupom, vd.num_nf
          from fat_vendas vd
          inner join fat_vendas_parcelamento pc on (pc.codigo = vd.codigo and vd.cnpj = pc.cnpj)
          inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
          left join glo_logradouros lgd on (lgd.codigo = psa.endereco and psa.cnpj = lgd.cnpj)
          left join glo_cidades cdd on (psa.cidade  = cdd.codigo and cdd.cnpj = psa.cnpj)
          left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
          where vd.cnpj = :cnpj and vd.codigo = :codigo
          into :psa_codigo, :psa_rg_ie, :vd_data, :vd_codigo, :pc_parcela, :pc_valor, :pc_vencto,
          :pc_dia, :pc_mes, :pc_ano, :psa_nome, :psa_endereco,
          :psa_bairro, :psa_cidade, :psa_cnpj, :psa_fone, :vd_cod_vendedor, :num_cf, :vd_nf
      do
      begin
        if (:num_cf > 0) then
          vd_cf = 'CF '||:num_cf;

        suspend;
      end

      if (:imprime_totalizador = 'S') then
      begin
        pc_vencto = null;
        pc_dia = 0;
        pc_mes = 0;
        pc_ano = 0;
        select vd.codigo, 0, sum(pc.valor), coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''),
               psa.codigo, psa.rg_ie, vd.data, coalesce(lgd.nome,'')||' - '||coalesce(psa.numero,''),
               br.nome , coalesce(cdd.nome,'')||'-'||coalesce(cdd.uf,''), psa.cnpj, vd.num_cupom, vd.num_nf
        from fat_vendas vd
        inner join fat_vendas_parcelamento pc on (pc.codigo = vd.codigo and vd.cnpj = pc.cnpj)
        inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
        left join glo_logradouros lgd on (lgd.codigo = psa.endereco and psa.cnpj = lgd.cnpj)
        left join glo_cidades cdd on (psa.cidade  = cdd.codigo and cdd.cnpj = psa.cnpj)
        left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
        where vd.cnpj = :cnpj and vd.codigo = :codigo
        group by vd.codigo, psa.codigo, psa.nome_razao, psa.codigo, psa.rg_ie, vd.data, lgd.nome,psa.numero,
        br.nome, cdd.nome,cdd.uf, psa.cnpj, vd.num_cupom, vd.num_nf
        into :psa_codigo, :pc_parcela, :pc_valor, :psa_nome,
             :psa_codigo, :psa_rg_ie, :vd_data, :psa_endereco,
             :PSA_BAIRRO, :PSA_CIDADE , :PSA_CNPJ, :vd_cf, :num_cf;

        if (:num_cf > 0) then
          vd_cf = 'CF '||:num_cf;
        suspend;
      end
  end
  else if (:tipo ='T') then /*troca*/
  begin
    for select psa.codigo,psa.rg_ie, vd.data, vd.codigo, pc.parcela, pc.valor,pc.vencto,
          extract(day from pc.vencto), extract(month from pc.vencto),extract(year from pc.vencto),
          coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''),coalesce(lgd.nome,'')||' - '||coalesce(psa.numero,''),
          br.nome, coalesce(cdd.nome,'')||'-'||coalesce(cdd.uf,''),psa.cnpj,psa.fone, vd.vendedor
          from fat_trocas vd
          inner join fat_trocas_parcelamento pc on (pc.codigo = vd.codigo and vd.cnpj = pc.cnpj)
          inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
          left join glo_logradouros lgd on (lgd.codigo = psa.endereco and psa.cnpj = lgd.cnpj)
          left join glo_cidades cdd on (psa.cidade  = cdd.codigo and cdd.cnpj = psa.cnpj)
          left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
          where vd.cnpj = :cnpj and vd.codigo = :codigo
          into :psa_codigo, :psa_rg_ie, :vd_data, :vd_codigo, :pc_parcela, :pc_valor, :pc_vencto,
          :pc_dia, :pc_mes, :pc_ano, :psa_nome, :psa_endereco,
          :psa_bairro, :psa_cidade, :psa_cnpj, :PSA_FONE, :VD_COD_VENDEDOR
      do
      begin


        suspend;
      end

      if (:imprime_totalizador = 'S') then
      begin
        pc_vencto = null;
        pc_dia = 0;
        pc_mes = 0;
        pc_ano = 0;
        select vd.codigo, 0, sum(pc.valor), coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''),
               psa.codigo, psa.rg_ie, vd.data, coalesce(lgd.nome,'')||' - '||coalesce(psa.numero,''),
               br.nome , coalesce(cdd.nome,'')||'-'||coalesce(cdd.uf,''), psa.cnpj
        from fat_trocas vd
        inner join fat_trocas_parcelamento pc on (pc.codigo = vd.codigo and vd.cnpj = pc.cnpj)
        inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
        left join glo_logradouros lgd on (lgd.codigo = psa.endereco and psa.cnpj = lgd.cnpj)
        left join glo_cidades cdd on (psa.cidade  = cdd.codigo and cdd.cnpj = psa.cnpj)
        left join glo_bairros br on (br.codigo = psa.bairro and br.cnpj = psa.cnpj)
        where vd.cnpj = :cnpj and vd.codigo = :codigo
        group by vd.codigo, psa.codigo, psa.nome_razao, psa.codigo, psa.rg_ie, vd.data, lgd.nome,psa.numero,
        br.nome, cdd.nome,cdd.uf, psa.cnpj
        into :psa_codigo, :pc_parcela, :pc_valor, :psa_nome,
             :psa_codigo, :psa_rg_ie, :vd_data, :psa_endereco,
             :psa_bairro, :psa_cidade , :psa_cnpj;

        suspend;   
      end
  end
END
^

ALTER PROCEDURE PCD_IMPRIME_RECEITA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    NOME_PROPRIETARIO VARCHAR(70),
    NOME_PROPRIEDADE VARCHAR(70),
    CIDADE_PROPRIEDADE VARCHAR(70),
    CULTURA VARCHAR(70),
    PRAGA VARCHAR(70),
    COD_PRODUTO VARCHAR(15),
    MEDIDA_DOSAGEM VARCHAR(15),
    MEDIDA_VAZAO VARCHAR(15),
    ORIENTACAO_USO_EQUIPAMENTO VARCHAR(80),
    ORIENTACAO_TECNICA VARCHAR(80),
    ORIENTACAO_COMPLEMENTAR VARCHAR(80),
    ORIENTACAO_FORMA_APLICACAO VARCHAR(80),
    FORMULACAO VARCHAR(80),
    CIDADE_EMPRESA VARCHAR(80),
    CLASSE_TOXICOLOGICA VARCHAR(80),
    INGREDIENTE_ATIVO VARCHAR(80),
    NOME_PRODUTO VARCHAR(50),
    DOSAGEM NUMERIC(18,4),
    VAZAO NUMERIC(18,4),
    DATA_EMISSAO DATE,
    NOME_TECNICO VARCHAR(50),
    CREA_TECNICO VARCHAR(20),
    CTPS_TECNICO VARCHAR(20),
    CPF_CNPJ_PRODUTOR VARCHAR(20),
    CPF_CNPJ_TECNICO VARCHAR(20),
    CNPJ_EMPRESA VARCHAR(20),
    INTERVALO_SEGURANCA INTEGER,
    AREA_TRATADA NUMERIC(18,4),
    AREA_TOTAL VARCHAR(30),
    QTDE_ITENS FLOAT)
AS
DECLARE VARIABLE TP_PESSOA CHAR(1);
begin

  select cdd.nome from sis_empresas emp
  left join glo_cidades cdd on (cdd.codigo = emp.cod_cidade and emp.cnpj = cdd.cnpj)
  where emp.cnpj = :cnpj
  into :cidade_empresa;

  select psa.nome_razao, prop.nome, cdd.nome, ct.descricao,
         pr.descricao, prd.codigo, prd.nome, adf.dosagem,
         substring(med1.sigla from 1 for 15)  , adf.vazao, med2.sigla, ot1.descricao,
         ot2.descricao, ot3.descricao, ot4.descricao, def.INGREDIENTE_ATIVO,
         def.formulacao, tx.descricao, vd.data, tc.nome, TC.crea, TC.ctps, adf.intervaloseguranca,
         psa.cpf_cgc, psa.pessoa, vdi.quantidade, psa1.cpf_cgc, prop.area_total
         from agr_receitas rec
         inner join ofc_mecanicos tc on (tc.codigo = rec.cod_tecnico and tc.cnpj = rec.cnpj)
         left join glo_pessoas_fj psa1 on (psa1.cnpj = tc.cnpj and tc.pessoa_fj = psa1.codigo)
         inner join agr_defensivoculturapraga adf ON (adf.cnpj = rec.cnpj and adf.iddefensivoagricola = rec.cod_defensivo
                                                      and adf.idcultura = rec.cod_cultura and adf.idpraga = rec.cod_praga)
         left join agr_medida_dosagem med1 on (med1.cnpj = adf.cnpj and med1.codigo = adf.idmedidadosagem)
         left join agr_medida_dosagem med2 on (med2.cnpj = adf.cnpj and med2.codigo = adf.idmedidavazao)


         left join agr_defensivo_agricola def on (def.cnpj = rec.cnpj and def.codigo = rec.cod_defensivo)
         left join agr_orientacao_tecnica ot1 on (ot1.cnpj = def.cnpj and ot1.codigo = def.cod_orientacao_equipamento)
         left join agr_orientacao_tecnica ot2 on (ot2.cnpj = def.cnpj and ot2.codigo = def.cod_orientacao_tecnica)
         left join agr_orientacao_tecnica ot3 on (ot3.cnpj = def.cnpj and ot3.codigo = def.cod_ORIENTACAO_COMPLEMENTAR)
         left join agr_orientacao_tecnica ot4 on (ot4.cnpj = def.cnpj and ot4.codigo = def.cod_informacao_aplicacao)

         left join agr_classe_toxicologica tx on (tx.cnpj = def.cnpj and tx.codigo = def.cod_classe_toxicologica)
         left  join agr_cultura ct on (ct.cnpj = rec.cnpj and ct.codigo = rec.cod_cultura)
         left join agr_praga pr on (pr.cnpj = rec.cnpj and pr.codigo = rec.cod_praga)
         left join est_produtos prd on (prd.cnpj = rec.cnpj and prd.codigo = rec.produto)
         left join fat_vendas vd on (vd.cnpj = rec.cnpj and vd.codigo = rec.cod_faturamento)
         left join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo and vdi.produto = prd.codigo)
         left join glo_pessoas_fj psa on (vd.cnpj = psa.cnpj and vd.pessoa_fj = psa.codigo)
         left join glo_propriedades prop on (vd.cnpj = prop.cnpj and vd.propriedade = prop.propriedade and prop.pessoa_fj = vd.pessoa_fj)
         left join glo_cidades cdd on (prop.cnpj = cdd.cnpj and prop.cidade = cdd.codigo)

         where rec.cnpj = :cnpj and rec.codigo = :codigo
  into :nome_proprietario, :nome_propriedade, :cidade_propriedade, :cultura,
       :praga, :cod_produto, :nome_produto, :dosagem,
       :medida_dosagem, :vazao, :medida_vazao, :orientacao_uso_equipamento, :orientacao_tecnica,
       :orientacao_complementar, :orientacao_forma_aplicacao, :ingrediente_ativo,
       :formulacao, :classe_toxicologica, :data_emissao, :nome_tecnico, :crea_tecnico, :ctps_tecnico, :intervalo_seguranca,
       :cpf_cnpj_produtor, :tp_pessoa, qtde_itens, :cpf_cnpj_tecnico, :area_total ;

  if (:vazao > 0) then
    area_tratada = (:qtde_itens / :dosagem);
  else           
    area_tratada = null;

  if (:tp_pessoa = 'J') then
    cpf_cnpj_produtor = substring(:cpf_cnpj_produtor from 1 for 2)||'.'||substring(:cpf_cnpj_produtor from 3 for 3)||'.'||substring(:cpf_cnpj_produtor from 6 for 3)||'/'||substring(:cpf_cnpj_produtor from 9 for 4)||'-'||substring(:cpf_cnpj_produtor from 13 for 2);
  else
    cpf_cnpj_produtor = substring(:cpf_cnpj_produtor from 1 for 3)||'.'||substring(:cpf_cnpj_produtor from 4 for 3)||'.'||substring(:cpf_cnpj_produtor from 7 for 3)||'-'||substring(:cpf_cnpj_produtor from 10 for 2);

  cnpj_empresa  =  substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  suspend;
END
^

ALTER PROCEDURE PCD_IMPRIME_SERIE_DEVOLUCAO (
    ORDEM_CARGA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    PSA_CLIENTE VARCHAR(50),
    PSA_FANTASIA_CLI VARCHAR(50),
    PSA_CIDADE VARCHAR(60),
    PSA_ENDERECO_CLI VARCHAR(100),
    VD_COD_VENDA INTEGER,
    VD_PESSOA_FJ INTEGER,
    VD_DT_VENDA DATE,
    VD_DATA_CAIXA DATE,
    VD_DESC_ACRESC FLOAT,
    VD_TOTAL FLOAT,
    VD_NUM_CUPOM INTEGER,
    VD_NUM_NF INTEGER,
    VD_OBSERVACAO VARCHAR(200),
    VD_VOLUME NUMERIC(18,4),
    VD_PESO NUMERIC(18,4),
    VD_HORA TIME,
    VD_TIPO_DOCTO VARCHAR(3),
    VD_TOTAL_BRUTO FLOAT,
    COD_CLIENTE INTEGER,
    DESC_ITEM FLOAT,
    NOME_VENDEDOR VARCHAR(50),
    VD_ORDEM_CARGA INTEGER,
    PRODUTO VARCHAR(50),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    CGC_CPF_CLI VARCHAR(20),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    CONT_ITENS NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO INTEGER,
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    PC_PARCELAMENTO VARCHAR(300),
    CGRI_CARREGADO FLOAT,
    CGRI_DEVOLVIDO FLOAT,
    CGRI_ENTREGUE FLOAT,
    CGRI_QUANTIDADE FLOAT,
    CGRI_GRADE VARCHAR(4),
    CGRI_NUMERO VARCHAR(6))
AS
DECLARE VARIABLE PARCELA NUMERIC(18,4);
DECLARE VARIABLE DT_VENCTO_REC DATE;
DECLARE VARIABLE ENTRADA NUMERIC(18,2);
DECLARE VARIABLE VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE SOLICITANTE VARCHAR(50);
DECLARE VARIABLE CONT_PARC INTEGER;
DECLARE VARIABLE AUX_VALOR NUMERIC(18,2);
DECLARE VARIABLE PC_DIA INTEGER;
DECLARE VARIABLE PC_MES INTEGER;
DECLARE VARIABLE PC_AUXDIA CHAR(2);
DECLARE VARIABLE PC_AUXMES CHAR(2);
DECLARE VARIABLE PC_ANO INTEGER;
DECLARE VARIABLE PC_PARCELA VARCHAR(6);
DECLARE VARIABLE PC_VALOR NUMERIC(18,2);
begin
  select e.nome, e.fone, e.endereco, e.cep, e.bairro, e.cidade  from sis_empresas e
  where e.cnpj = :cnpj
  into :empresa , :fone, :endereco_emp, :cep_emp, :bairro_emp, :cidade_emp;

  cnpj_emp = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  /* Procedure Text */
  for select
      /* cliente */
      coalesce(psa.nome_razao,''), coalesce(psa.FANTASIA,''), coalesce(cdd.nome,'')||' - '||coalesce(cdd.uf,''),
      coalesce(lgd.nome,'') ||' Nº:'||coalesce(psa.numero,''),
      /* venda */
      vd.pessoa_fj, vd.entrada, vd.codigo,vd.data, vd.data_caixa, coalesce(vd.desc_acres,0), (vd.total + coalesce(vd.desc_acres,0)), vd.num_cupom, vd.num_nf,
      substring(vd.observacao from 1 for 200), VD.volume, VD.peso, vd.nome_consumidor, VD.hora, vd.tipo_docto,
      vd.total,
      /* vendedor */
      vdd.nome,
      /* forma pgto */
      coalesce(fpgto.codigo,0)||'-'||coalesce(fpgto.nome,''),
      /* cliente */
      VD.pessoa_fj, psa.celular, psa.fax, PSA.pessoa, psa.fone, PSA.complemento, 
      psa.cpf_cgc, PSA.rg_ie, psa.cep,
      br.nome,
      /* propriedade */
      pro.nome, pro.proprietario, pro.ie, pro.propriedade,
      pro.endereco, pro.complemento, pro.cidade, pro.uf, pro.cep, pro.area_total,
      pro.ativa, pro.bairro, pro.numero, pro.cpf, pro.tecnico,
      /* Carga */
      cgr.codigo,
      /* Carga Item */
      cgri.carregado, cgri.devolvido, cgri.entregue, cgri.quantidade, cgri.grade, cgri.numero,
      cgri.nome_produto, cgri.produto, cgri.unidade
      from crg_ordem_carga cgr
      inner join crg_ordem_carga_itens cgri on (cgr.codigo = cgri.codigo and cgr.cnpj = cgri.cnpj)
      inner join fat_vendas        vd    on (vd.codigo     = cgr.codigo_vnd and vd.cnpj = cgr.cnpj )
      inner join glo_pessoas_fj    psa   on (psa.codigo    = vd.pessoa_fj  and psa.cnpj = vd.cnpj  )
      left  join glo_logradouros   lgd   on (lgd.codigo    = psa.endereco  and lgd.cnpj = psa.cnpj )
      left  join glo_bairros       br    on (psa.bairro    = br.codigo     and br.cnpj = psa.cnpj  )
      left  join glo_cidades       cdd   on (psa.cidade    = cdd.codigo    )
      left  join fat_vendedor      vdd   on (vd.vendedor   = vdd.codigo    and vdd.cnpj = vd.cnpj  )
      left  join fin_formas_pagto  fpgto on (vd.forma_pgto = fpgto.codigo  )
      left  join glo_propriedades  pro   on (psa.codigo    = pro.pessoa_fj and pro.propriedade = vd.propriedade and pro.cnpj = psa.cnpj)
      where cgr.codigo = :ORDEM_CARGA  and cgr.cnpj = :cnpj
  into
     /* cliente */
     :psa_cliente, :psa_fantasia_cli, :psa_cidade,
     :psa_endereco_cli,
     /* venda */
     :vd_pessoa_fj, :entrada, :vd_cod_venda, :vd_dt_venda, :vd_data_caixa,
     :vd_desc_acresc,:vd_total, :vd_num_cupom, :vd_num_nf,
     :vd_observacao, :vd_VOLUME, :vd_peso, :SOLICITANTE, :vd_hora, :vd_tipo_docto,
     :vd_total_bruto,
     /* vendedor */
     :nome_vendedor,
     /* forma pgto */
     :forma_pagto,
     /* pessoa */
     :cod_cliente, psa_celular, psa_fax, :TP_PESSOA, :fone_cliente, :complemento,
     :cgc_cpf_cli, :rg_ie, :cep, :bairro,
     /* PROPROIEDADE */
     :pro_nome, :pro_proprietario, :pro_ie, :pro_propriedade,
     :pro_endereco, :pro_complemento, :pro_cidade, :pro_uf, :pro_cep, :pro_area_total,
     :pro_ativa, :pro_bairro, :pro_numero, :pro_cpf, :pro_tecnico,
     /* Carga */
     :vd_ordem_carga,
     /* Carga Itens */
     :cgri_carregado, :cgri_devolvido, :cgri_entregue, :cgri_quantidade, :cgri_grade, :cgri_numero,
     :produto, :cod_produto, :UNIDADE
  do
  begin
        /* ------------------------- Grade ------------------------------------------------- */
        if (not :cgri_grade IS NULL and :cgri_grade <> '0')then
        begin
             select grd.grade, grd.material, grd.cor, grd.nome_material, grd.nome_cor, grd.perfil, grd.nome_perfil, grd.numero, grd.ordem
             from LISTA_PRODUTOS_GRADES( :cnpj, :cod_produto ) grd
             where (grd.GRADE = :cgri_grade and grd.numero = :cgri_numero)
             into :GRD_GRADE, :GRD_MATERIAL, :GRD_COR, :GRD_NOME_MATERIAL, :GRD_NOME_COR, :GRD_PERFIL, :GRD_NOME_PERFIL, :GRD_NUMERO, :GRD_ORDEM;
        end

        /* ------------------------- Consumidor ------------------------------------------------- */
        if( :vd_pessoa_fj = 1 )  then
        begin
         psa_cliente      = solicitante;
         psa_fantasia_cli = solicitante;
        end
        /* ------------------------- Formata CPF/CNPJ ------------------------------------------------- */
        if (:tp_pessoa = 'J') then
           cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 2)||'.'||substring(:cgc_cpf_cli from 3 for 3)||'.'||substring(:cgc_cpf_cli from 6 for 3)||'/'||substring(:cgc_cpf_cli from 9 for 4)||'-'||substring(:cgc_cpf_cli from 13 for 2);
        else
           cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 3)||'.'||substring(:cgc_cpf_cli from 4 for 3)||'.'||substring(:cgc_cpf_cli from 7 for 3)||'-'||substring(:cgc_cpf_cli from 10 for 2);
        /* ------------------------- Tipo Docto ------------------------------------------------- */
        select d.nome from glo_tipos_docto d
        where d.sigla = :vd_tipo_docto and d.cnpj = :cnpj
        into :nome_tipo_docto;
        /* ------------------------- Calculo Dscto ------------------------------------------------- */
        if (:vd_total_bruto > 0) then
          pct_descto_venda = (:vd_desc_acresc * 100.00)/:vd_total_bruto;
        else
          pct_descto_venda = 0;
        /* ------------------------- Qtde Itens ------------------------------------------------- */
        select sum(quantidade) from crg_ordem_carga_itens
        where codigo = :ORDEM_CARGA and cnpj = :cnpj
        into :cont_itens;
        /* ------------------------- Parcelamento 1 ------------------------------------------------- */
        parcelamento = '';
        if ((:entrada is not null) and (:entrada > 0)) then
          parcelamento = 'E-'||' ('||cast(:vd_dt_venda as varchar(11))||') '||cast (:entrada as varchar (12));
    
        cont = 1;
        valor = 0;
    
        if (:valor = 0 ) then
        begin
    
            for select pc.valor, pc.vencto from crg_ordem_carga crg
                inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
                where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
                into :valor, :dt_vencto_rec
            do
            begin
                if (:valor is null) then
                    valor  = 0;
    
               /**/ parcelamento = parcelamento ||' /P-'||cast(cont as varchar(2))||' '||' ('||cast(:dt_vencto_rec as varchar(11))||') '||' - '||cast (:valor as char (12));
                cont = cont + 1;
            end
        end

        /* ------------------------- Parcelamento 2 ------------------------------------------------- */
          pc_parcelamento = '';
          /*verificando quantos parcelamentos tenho desta venda, para poder validar a listagem deles na NF*/
          select count(pc.codigo) from crg_ordem_carga crg
          inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
          where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
          into :cont_parc;
        
          cont = 0;
          aux_valor = 0;
          for select extract(day from pc.vencto), extract(month from pc.vencto), extract(year from pc.vencto),
              pc.valor, pc.parcela
               from crg_ordem_carga crg
               inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
               where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
          into :pc_dia, :pc_mes, :pc_ano,
               :pc_valor, :pc_parcela
          do
          begin
            cont = cont + 1;
            if (:pc_dia <= 9) then
              pc_auxdia = '0'||:pc_dia;
            else
              pc_auxdia = :pc_dia;
        
            if (:pc_mes <= 9) then
              pc_auxmes = '0'||:pc_mes;
            else
              pc_auxmes = :pc_mes;
        
        
            if (:cont <= 10) then
            begin
              if ((:cont <= 9) or (:cont_parc <=10)) then
                pc_parcelamento = pc_parcelamento||' - '||:pc_parcela||' '||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||'  '||:pc_valor||'  ';
              else
                aux_valor = :aux_valor + :pc_valor; /*passando a contabilizar a 10 parcela no restante*/
            end
            else
              aux_valor = :aux_valor + :pc_valor;
          end
          if (:aux_valor > 0) then
            pc_parcelamento = pc_parcelamento||'Vlr. Rest: '||:aux_valor;
        
          if (pc_parcelamento = '') then
           pc_parcelamento = 'À vista';
        /* --------------------------------------------------------------------------------------- */
  suspend;
  end
END
^

ALTER PROCEDURE PCD_IMPRIME_SERIE_NF (
    VENDA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CONTATO VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    COD_INDICE INTEGER,
    COD_CLIENTE INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL_DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(50),
    VDI_GRADE CHAR(4),
    VDI_NUMERO VARCHAR(6),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PESO_ITEN FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    SERV_COMPLEMENTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    PROD_COMPLEMENTO VARCHAR(120),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO VARCHAR(50),
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PRO_RUA_NOME VARCHAR(50),
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    VD_CFOP INTEGER,
    VD_CFOP_DESC VARCHAR(50),
    PC_PARCELAMENTO VARCHAR(300),
    TROCO NUMERIC(18,4),
    TRP_NOME VARCHAR(50),
    TRP_CNPJ VARCHAR(15),
    TRP_PLACA VARCHAR(8),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_UF CHAR(2),
    TRP_UF_VEICULO CHAR(2),
    TRP_FRETE INTEGER,
    TRP_IE VARCHAR(15),
    TRP_PESO_LIQ FLOAT,
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_QTDE FLOAT,
    TRP_ESPECIE VARCHAR(50),
    TRP_MARCA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    VD_VLR_FRETE NUMERIC(18,4),
    VD_DATA_BASE DATE,
    VD_BASE_CALC NUMERIC(18,4),
    VD_BASE_CALC_SUB NUMERIC(18,4),
    VD_VLR_ICM_SUB NUMERIC(18,4),
    VD_VLR_ICM NUMERIC(18,4),
    VD_TOTAL_PROD NUMERIC(18,4),
    VD_VLR_SEGURO NUMERIC(18,4),
    VD_VLR_OUTRAS_DESP NUMERIC(18,4),
    VD_VLR_IPI NUMERIC(18,4),
    VD_TOTAL_NF NUMERIC(18,4),
    S_MSG_PROX_FOLHA VARCHAR(100),
    S_VD_TOTAL_NF VARCHAR(30),
    S_VD_VLR_IPI VARCHAR(30),
    S_VD_VLR_OUTRAS_DESP VARCHAR(30),
    S_VD_VLR_SEGURO VARCHAR(30),
    S_VD_VLR_FRETE VARCHAR(30),
    S_VD_TOTAL_PROD VARCHAR(30),
    S_VD_VLR_ICM VARCHAR(30),
    S_VD_VLR_ICM_SUB VARCHAR(30),
    S_VD_BASE_CALC VARCHAR(30),
    S_VD_BASE_CALC_SUB VARCHAR(30),
    S_TOTAL_BRUTO VARCHAR(30),
    S_DESC_ACRESC VARCHAR(30),
    S_TOTAL VARCHAR(30),
    VD_DESC_CARREGAMENTO VARCHAR(300),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    OFC_PLACA VARCHAR(10))
AS
DECLARE VARIABLE PARCELA NUMERIC(18,4);
DECLARE VARIABLE DT_VENCTO_REC DATE;
DECLARE VARIABLE ENTRADA NUMERIC(18,2);
DECLARE VARIABLE VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE SOLICITANTE VARCHAR(50);
DECLARE VARIABLE CONT_PARC INTEGER;
DECLARE VARIABLE AUX_VALOR NUMERIC(18,2);
DECLARE VARIABLE PC_DIA INTEGER;
DECLARE VARIABLE PC_MES INTEGER;
DECLARE VARIABLE PC_AUXDIA CHAR(2);
DECLARE VARIABLE PC_AUXMES CHAR(2);
DECLARE VARIABLE PC_ANO INTEGER;
DECLARE VARIABLE PC_PARCELA VARCHAR(6);
DECLARE VARIABLE PC_VALOR NUMERIC(18,2);
DECLARE VARIABLE VD_TOTAL_LIQ NUMERIC(18,2);
DECLARE VARIABLE PAGTO_FRETE VARCHAR(1);
DECLARE VARIABLE TRANSPORTADORA VARCHAR(50);
DECLARE VARIABLE NUM_MAX_ITENS INTEGER;
DECLARE VARIABLE ITEM INTEGER;
DECLARE VARIABLE XCONT INTEGER;
DECLARE VARIABLE AUX1 INTEGER;
DECLARE VARIABLE AUX2 INTEGER;
DECLARE VARIABLE AUX3 INTEGER;
DECLARE VARIABLE NMOD FLOAT;
DECLARE VARIABLE UND_CARREGAMENTO VARCHAR(4);
DECLARE VARIABLE QNTDE_PDR_CARGA FLOAT;
DECLARE VARIABLE TTL_UND_CARREGAMENTO FLOAT;
DECLARE VARIABLE TTL_UND_INDIVIDUAL FLOAT;
DECLARE VARIABLE ID_OS INTEGER;
begin
  select v.placa from ofc_ordem_servico os
  inner join glo_veiculos v on (v.cnpj = os.cnpj and v.codigo = os.veiculo)
  where  os.cnpj = :cnpj and os.venda = :venda
  into :ofc_placa;

  select e.nome, e.fone, e.endereco, e.cep, e.bairro, e.cidade, coalesce(e.num_itens_pdd,42)
  from sis_empresas e
  where e.cnpj = :cnpj
  into :empresa , :fone, :endereco_emp, :cep_emp, :bairro_emp, :cidade_emp, :num_max_itens;

  cnpj_emp = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  /*------------------------------------------Transportador-----------------------------------------------------*/
  select vd.trp_peso_bruto, vd.trp_peso_liquido, vd.trp_numero, vd.trp_qtde, mr.nome, VD.trp_especie, tp.nome,
  tp.cpf_cnpj, tp.placa, tp.endereco, tp.cidade, tp.uf, tp.ie, vd.pgto_frete, coalesce(vd.frete,0), coalesce(vd.total,0),
  coalesce(vd.seguro,0), coalesce(vd.despesas,0), coalesce(vd.ipi,0), coalesce(vd.total_fiscal,0),
  coalesce(vd.total,0)+coalesce(vd.desc_acres,0), vd.natureza, nat.nome, vd.dt_prev_entrega, vd.cod_indexador
  from fat_vendas vd
  left join glo_transportadoras tp on (tp.codigo = vd.transportadora and tp.cnpj = vd.cnpj)
  left join est_marcas mr on (vd.trp_marca = mr.codigo and tp.cnpj = mr.cnpj)
  left join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
  where vd.cnpj = :cnpj and  vd.codigo = :venda
  into :trp_peso_bruto, :trp_peso_liq, :trp_numero, :trp_peso_qtde, :trp_marca, :trp_especie, :transportadora,
  :trp_cnpj, :trp_placa, :trp_endereco, :trp_cidade, :trp_uf, :trp_ie, :pagto_frete, :vd_vlr_frete, :vd_total_prod,
  :VD_VLR_SEGURO, :VD_VLR_OUTRAS_DESP, :VD_VLR_IPI, :vd_total_nf, :vd_total_liq, :vd_cfop, :vd_cfop_desc, :vd_data_base, :cod_indice;

  VD_TOTAL_NF = (:VD_TOTAL_LIQ + :VD_VLR_FRETE + :VD_VLR_SEGURO + :VD_VLR_OUTRAS_DESP + :VD_VLR_IPI);

  if ((coalesce(:trp_nome,'') = '') and (coalesce(transportadora,'') = ''))then
      trp_nome = 'Em mãos';
   else if (:transportadora <> '') then
      trp_nome = :transportadora;

   if (pagto_frete = '1') then
      trp_frete = 1;
   else if (pagto_frete = '2') then
      trp_frete = 2;


  select count(*) from fat_vendas_itens vdi
  where vdi.cnpj = :cnpj and vdi.codigo = :venda
  into :xcont;

  /*totalizações da Pedido, parecido com a NF, copiado de lá*/
  select sum(coalesce(vdi.basecalculosubstituicao,0)), sum(coalesce(vdi.icm_subs,0)),
  sum(coalesce(vdi.basecalculoicm,0)), sum(coalesce(vdi.icm,0)) from fat_vendas_itens vdi
  where vdi.cnpj = :cnpj and vdi.codigo = :venda
  into :vd_base_calc_sub, :vd_vlr_icm_sub,
  :vd_base_calc, :vd_vlr_icm;

  item  = 0;
  /* Procedure Text */
  for select
      /* cliente */
      coalesce(psa.nome_razao,''), coalesce(psa.FANTASIA,''), coalesce(cdd.nome,'')||' - '||coalesce(cdd.uf,''),
      coalesce(lgd.nome,'') ||' Nº:'||coalesce(psa.numero,''),
      /* venda */
      vd.pessoa_fj, vd.entrada, vd.codigo,vd.data, vd.data_caixa, coalesce(vd.desc_acres,0), (vd.total + coalesce(vd.desc_acres,0)), vd.num_cupom, vd.num_nf,
      substring(vd.observacao from 1 for 200), VD.volume, VD.peso, vd.nome_consumidor, VD.hora, vd.tipo_docto,
      vd.total, 
      /* vendedor */
      vdd.nome,
      /* forma pgto */
      coalesce(fpgto.nome,''),
      /* item venda */
      prd.codigo,
      vdi.sequencia, prd.nome produto, vdi.complemento,
      vdi.quantidade, vdi.prc_unitario, vdi.desconto, (coalesce(vdi.desconto,0) * coalesce(vdi.quantidade,0)) ,(coalesce(vdi.prc_unitario,0)/*- coalesce(vdi.desconto,0)*/),
      (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0)/*- coalesce(vdi.desconto,0)*/)) total_item,
      VDI.grade, VDI.numero, vdi.porc_desc, vdi.unidade, (vdi.peso * vdi.quantidade), vdi.servico,
      /* cliente */
      VD.pessoa_fj, psa.celular, psa.fax, PSA.pessoa, psa.fone, PSA.complemento, 
      psa.cpf_cgc, PSA.rg_ie, psa.cep, br.nome,
      /* marca */
      mrc.codigo, mrc.nome,
      /* propriedade */
      pro.nome, pro.proprietario, pro.ie, pro.propriedade,
      pro.endereco, pro.complemento, pro.cidade, pro.uf, pro.cep, pro.area_total,
      pro.ativa, br2.nome, pro.numero, pro.cpf, pro.tecnico,
      coalesce(prua.nome,''), coalesce(vd.troco,0), cli.comprador,
      prd.und_carregamento, prd.qntde_pdr_carga,
      (cast(vdi.quantidade as integer)/cast( coalesce(prd.qntde_pdr_carga,1) as integer)),
      (
         (
          (vdi.quantidade/coalesce(prd.qntde_pdr_carga,1))
           -
          (cast(vdi.quantidade as integer)/cast(coalesce(prd.qntde_pdr_carga,1) as integer))
         ) * coalesce(prd.qntde_pdr_carga,1)
      ), prd.localizacao_1,
      prd.localizacao_2,
      prd.localizacao_3

      from fat_vendas vd
      inner join glo_pessoas_fj    psa   on (psa.codigo    = vd.pessoa_fj  and psa.cnpj = vd.cnpj  )
      left  join glo_clientes      cli   on (psa.cnpj = cli.cnpj and cli.pessoa_fj = psa.codigo)
      left  join glo_logradouros   lgd   on (lgd.codigo    = psa.endereco  and lgd.cnpj = psa.cnpj )
      left  join glo_bairros       br    on (psa.bairro    = br.codigo     and br.cnpj = psa.cnpj  )
      left  join glo_cidades       cdd   on (psa.cidade    = cdd.codigo and psa.cnpj = cdd.cnpj   )
      left  join fat_vendedor      vdd   on (vd.vendedor   = vdd.codigo    and vdd.cnpj = vd.cnpj  )
      left  join fin_formas_pagto  fpgto on (vd.forma_pgto = fpgto.codigo  and vd.cnpj = fpgto.cnpj)
      inner join fat_vendas_itens  vdi   on (vd.codigo     = vdi.codigo    and vdi.cnpj = vd.cnpj  )
      inner join est_produtos      prd   on (vdi.produto   = prd.codigo   and vdi.cnpj = prd.cnpj )
      left  join est_marcas        mrc   on (prd.marca     = mrc.codigo    and mrc.cnpj  = prd.cnpj)
      left  join glo_propriedades  pro   on (psa.codigo    = pro.pessoa_fj and pro.propriedade = vd.propriedade and pro.cnpj = psa.cnpj)
      left  join glo_logradouros   prua  on (prua.codigo   = pro.endereco  and prua.cnpj = pro.cnpj )
      left  join glo_bairros       br2   on (br2.codigo    = pro.bairro     and br2.cnpj = pro.cnpj )
      where vd.codigo = :venda  and vd.cnpj = :cnpj
  into
     /* cliente */
     :cliente, :fantasia_cli, :cidade,
     :endereco_cli,
     /* venda */
     :pessoa_fj, :entrada, :cod_venda, :dt_venda, :data_caixa,
     :desc_acresc,:total, :num_cupom, :num_nf,
     :observacao, :VOLUME, :peso, :SOLICITANTE, :hora, :tipo_docto,
     :total_bruto,
     /* vendedor */
     :nome_vendedor,
     /* forma pgto */
     :forma_pagto,
     /* item venda */
     :cod_produto,
     :sequencia, :produto, :prod_complemento,
     :quantidade, :prc_unitario, :desc_item, :total_desc_item, :prc_unitario_liq,
     :total_item, :vdi_grade, :VDI_numero, :pct_item_descto, :unidade, :peso_iten, :serv_complemento,
     /* pessoa */
     :cod_cliente, psa_celular, psa_fax, :TP_PESSOA, :fone_cliente, :complemento,
     :cgc_cpf_cli, :rg_ie, :cep, :bairro,
     /* marca */
     :mrc_codigo, :mrc_nome,
     /* PROPROIEDADE */
     :pro_nome, :pro_proprietario, :pro_ie, :pro_propriedade,
     :pro_endereco, :pro_complemento, :pro_cidade, :pro_uf, :pro_cep, :pro_area_total,
     :pro_ativa, :pro_bairro, :pro_numero, :pro_cpf, :pro_tecnico,
     :pro_rua_nome, :troco,
     :contato,
     :und_carregamento, :qntde_pdr_carga,
     :TTL_UND_CARREGAMENTO,
     :ttl_und_individual,
     :localizacao_1,
     :localizacao_2,
     :localizacao_3
  do
  begin
    VD_DESC_CARREGAMENTO = '';
    if (:ttl_und_carregamento > 0) then
      VD_DESC_CARREGAMENTO = cast (cast(:ttl_und_carregamento as integer) as varchar(22))||' '||:und_carregamento;

    if (:ttl_und_individual > 0) then
    begin
      if (VD_DESC_CARREGAMENTO <> '') then
        VD_DESC_CARREGAMENTO = VD_DESC_CARREGAMENTO || ' e ';

      VD_DESC_CARREGAMENTO = VD_DESC_CARREGAMENTO || cast (cast(:ttl_und_individual as integer) as varchar(22))||' '||:unidade;
    end
    if (:item > 0) then
      nmod = :num_max_itens - ((num_max_itens/:item) * item);

    item = item + 1;

    if ((nmod = 0) and (:item > 2))then
    begin
      item = 1;
      S_MSG_PROX_FOLHA = 'Impressão Continua na Próxima Página ==>';
      S_VD_TOTAL_NF =        '***************';
      S_VD_VLR_IPI =         '***************';
      S_VD_VLR_OUTRAS_DESP = '***************';
      S_VD_VLR_SEGURO =      '***************';
      S_VD_VLR_FRETE =       '***************';
      S_VD_TOTAL_PROD =      '***************';
      S_VD_VLR_ICM =         '***************';
      S_VD_VLR_ICM_SUB =     '***************';
      S_VD_BASE_CALC =       '***************';
      S_VD_BASE_CALC_SUB =   '***************';
      S_TOTAL_BRUTO =   '***************';
      S_DESC_ACRESC =   '***************';
      S_TOTAL =   '***************';
    end
    else
    begin
      S_MSG_PROX_FOLHA = '';
      select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;

      select * from round2(:total_bruto) into :s_total_bruto;
      select sai from SP_FORMAT_FLOAT(:s_total_bruto) into :s_total_bruto;

      select * from round2(:desc_acresc) into :s_desc_acresc;
      select sai from SP_FORMAT_FLOAT(:s_desc_acresc) into :s_desc_acresc;

      select * from round2(:total) into :s_total;
      select sai from SP_FORMAT_FLOAT(:s_total) into :s_total;
    end

        /* ------------------------- Grade ------------------------------------------------- */
        if (not :vdi_grade IS NULL and :vdi_grade <> '0')then
        begin
             select grd.grade, grd.material, grd.cor, grd.nome_material, grd.nome_cor, grd.perfil, grd.nome_perfil, grd.numero, grd.ordem
             from LISTA_PRODUTOS_GRADES( :cnpj, :cod_produto ) grd
             where (grd.GRADE = :vdi_grade and grd.numero = :vdi_numero)
             into :GRD_GRADE, :GRD_MATERIAL, :GRD_COR, :GRD_NOME_MATERIAL, :GRD_NOME_COR, :GRD_PERFIL, :GRD_NOME_PERFIL, :GRD_NUMERO, :GRD_ORDEM;
        end

        /* ------------------------- Consumidor ------------------------------------------------- */
        if( :pessoa_fj = 1 )  then
        begin
         cliente      = solicitante;
         fantasia_cli = solicitante;
        end
        /* ------------------------- Formata CPF/CNPJ ------------------------------------------------- */
        if (:tp_pessoa = 'J') then
           cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 2)||'.'||substring(:cgc_cpf_cli from 3 for 3)||'.'||substring(:cgc_cpf_cli from 6 for 3)||'/'||substring(:cgc_cpf_cli from 9 for 4)||'-'||substring(:cgc_cpf_cli from 13 for 2);
        else
           cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 3)||'.'||substring(:cgc_cpf_cli from 4 for 3)||'.'||substring(:cgc_cpf_cli from 7 for 3)||'-'||substring(:cgc_cpf_cli from 10 for 2);
        /* ------------------------- Tipo Docto ------------------------------------------------- */
        select d.nome from glo_tipos_docto d
        where d.sigla = :tipo_docto and d.cnpj = :cnpj
        into :nome_tipo_docto;
        /* ------------------------- Calculo Dscto ------------------------------------------------- */
        if (:total_bruto > 0) then
          pct_descto_venda = (:desc_acresc * 100.00)/:total_bruto;
        else
          pct_descto_venda = 0;
        /* ------------------------- Qtde Itens ------------------------------------------------- */
        select sum(quantidade) from fat_vendas_itens
        where codigo = :venda and cnpj = :cnpj
        into :cont_itens;
        /* ------------------------- Parcelamento 1 ------------------------------------------------- */
        parcelamento = '';
        if ((:entrada is not null) and (:entrada > 0)) then
        begin
          pc_dia = extract(day from :dt_venda);
          pc_mes = extract(month from :dt_venda);
          pc_ano = extract(year from :dt_venda);
          if (:pc_dia <= 9) then
            pc_auxdia = '0'||:pc_dia;
          else
            pc_auxdia = :pc_dia;
        
          if (:pc_mes <= 9) then
            pc_auxmes = '0'||:pc_mes;
          else
            pc_auxmes = :pc_mes;

          parcelamento = 'E-'||' ('||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||') '||cast (:entrada as varchar (12));
        end
    
        cont = 1;
        valor = 0;
    
        if (:valor = 0 ) then
        begin
    
            for select extract(day from pc.vencto), extract(month from pc.vencto), extract(year from pc.vencto),
                       pc.valor, pc.vencto from fat_vendas_parcelamento pc
                where pc.cnpj = :cnpj and pc.codigo = :venda
                into :pc_dia, :pc_mes, :pc_ano,
                :valor, :dt_vencto_rec
            do
            begin
                if (:pc_dia <= 9) then
                  pc_auxdia = '0'||:pc_dia;
                else
                 pc_auxdia = :pc_dia;
        
                if (:pc_mes <= 9) then
                  pc_auxmes = '0'||:pc_mes;
                else
                  pc_auxmes = :pc_mes;

                if (:valor is null) then
                    valor  = 0;
    
               /**/ parcelamento = parcelamento ||' /P-'||cast(cont as varchar(2))||' '||' ('||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||') '||' - '||cast (:valor as char (12));
                cont = cont + 1;
            end
        end

        /* ------------------------- Parcelamento 2 ------------------------------------------------- */
          pc_parcelamento = '';
          /*verificando quantos parcelamentos tenho desta venda, para poder validar a listagem deles na NF*/
          select count(*) from fat_vendas_parcelamento pc where pc.cnpj = :cnpj and pc.codigo = :venda
          into :cont_parc;
        
          cont = 0;
          aux_valor = 0;
          for select extract(day from pc.vencto), extract(month from pc.vencto), extract(year from pc.vencto),
              pc.valor, pc.parcela
               from fat_vendas_parcelamento pc
              where pc.cnpj = :cnpj and pc.codigo = :venda
          into :pc_dia, :pc_mes, :pc_ano,
               :pc_valor, :pc_parcela
          do
          begin
            cont = cont + 1;
            if (:pc_dia <= 9) then
              pc_auxdia = '0'||:pc_dia;
            else
              pc_auxdia = :pc_dia;
        
            if (:pc_mes <= 9) then
              pc_auxmes = '0'||:pc_mes;
            else
              pc_auxmes = :pc_mes;
        
        
            if (:cont <= 10) then
            begin
              if ((:cont <= 9) or (:cont_parc <=10)) then
                pc_parcelamento = pc_parcelamento||' - '||:pc_parcela||' '||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||'  '||:pc_valor||'  ';
              else
                aux_valor = :aux_valor + :pc_valor; /*passando a contabilizar a 10 parcela no restante*/
            end
            else
              aux_valor = :aux_valor + :pc_valor;
          end
          if (:aux_valor > 0) then
            pc_parcelamento = pc_parcelamento||'Vlr. Rest: '||:aux_valor;
        
          if (pc_parcelamento = '') then
           pc_parcelamento = 'À vista';
        /* --------------------------------------------------------------------------------------- */
        suspend;
        grd_cor = NULL;
        grd_grade = NULL;
        grd_material = NULL;
        grd_nome_cor = NULL;
        grd_nome_material = NULL;
        grd_nome_perfil = NULL;
        grd_numero = NULL;
        grd_ordem = NULL;
        grd_perfil = NULL;
        vdi_grade = NULL;
        VDI_numero = NULL;
  end
  /*ultima folha terá somente um item e teremos de mostrar o total,
   criando um registro "ficticio"..*/
  if (xcont > :num_max_itens) then
  begin
    aux1 = (xcont/:num_max_itens);
    aux2 = :aux1 * :num_max_itens;
    aux3 = :xcont - :aux2;

    /*ultima folha terá somente um item e teremos de mostrar o total,
    criando um registro "ficticio"..*/
    if (:aux3 = 1) then
    begin
      select * from round2(:VD_TOTAL_NF) into :s_vd_total_nf;
      select sai from SP_FORMAT_FLOAT(:s_vd_total_nf) into :s_vd_total_nf;

      select * from round2(:VD_VLR_IPI) into :s_vd_vlr_ipi;
      select sai from SP_FORMAT_FLOAT(:s_vd_vlr_ipi) into :s_vd_vlr_ipi;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_OUTRAS_DESP;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_OUTRAS_DESP) into :S_VD_VLR_OUTRAS_DESP;

      select * from round2(:VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_SEGURO) into :S_VD_VLR_SEGURO;

      select * from round2(:VD_VLR_FRETE) into :S_VD_VLR_FRETE;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_FRETE) into :S_VD_VLR_FRETE;

      select * from round2(:VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;
      select sai from SP_FORMAT_FLOAT(:S_VD_TOTAL_PROD) into :S_VD_TOTAL_PROD;

      select * from round2(:VD_VLR_ICM) into :S_VD_VLR_ICM;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM) into :S_VD_VLR_ICM;

      select * from round2(:VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_VLR_ICM_SUB) into :S_VD_VLR_ICM_SUB;

      select * from round2(:VD_BASE_CALC) into :S_VD_BASE_CALC;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC) into :S_VD_BASE_CALC;

      select * from round2(:VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;
      select sai from SP_FORMAT_FLOAT(:S_VD_BASE_CALC_SUB) into :S_VD_BASE_CALC_SUB;

      select * from round2(:total_bruto) into :s_total_bruto;
      select sai from SP_FORMAT_FLOAT(:s_total_bruto) into :s_total_bruto;

      select * from round2(:desc_acresc) into :s_desc_acresc;
      select sai from SP_FORMAT_FLOAT(:s_desc_acresc) into :s_desc_acresc;

      select * from round2(:total) into :s_desc_acresc;
      select sai from SP_FORMAT_FLOAT(:s_total) into :s_total;


       cod_produto = null;
       sequencia = null;
       produto = null;
       quantidade = null;
       prc_unitario = null;
       desc_item = null;
       total_desc_item = null;
       prc_unitario_liq = null;
       total_item = null;
       vdi_grade = null;
       VDI_numero = null;
       pct_item_descto = null;
       unidade = null;
      suspend;
    end
  end
END
^

ALTER PROCEDURE PCD_IMPRIME_SERIE_ORC_NF (
    ORCA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DATA_VALIDADE DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PRODUTO VARCHAR(50),
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30))
AS
DECLARE VARIABLE PARCELA NUMERIC(18,4);
DECLARE VARIABLE DT_VENCTO_REC DATE;
DECLARE VARIABLE ENTRADA NUMERIC(18,2);
DECLARE VARIABLE VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE SOLICITANTE VARCHAR(50);
begin
  select e.nome, e.fone, e.endereco, e.cep, e.bairro, e.cidade  from sis_empresas e
  where e.cnpj = :cnpj
  into :empresa , :fone, :endereco_emp, :cep_emp, :bairro_emp, :cidade_emp;

  cnpj_emp = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  /* Procedure Text */
  for select coalesce(psa.nome_razao,''), coalesce(psa.FANTASIA,''),coalesce(cdd.nome,'')||' - '||coalesce(cdd.uf,''),
      coalesce(lgd.nome,'') ||' Nº:'||coalesce(psa.numero,''),ORC.codigo,ORC.data,
      coalesce(ORC.desc_acresc,0), (ORC.total + coalesce(ORC.desc_acresc,0)),
      vdd.nome, coalesce(fpgto.codigo,0)||'-'||coalesce(fpgto.nome,''), ORCI.sequencia, prd.nome produto,
      ORCI.quantidade, ORCI.prc_unit_original,ORCI.desconto, (coalesce(ORCI.prc_unitario,0)),
      (coalesce(ORCI.quantidade,0) * (coalesce(ORCI.prc_unitario,0))) total_item,
      ORC.pessoa_fj, prd.codigo, ORC.total, substring (orci.complemento from 1 for 50), br.nome, ORCI.porc_desc,
      ORCI.unidade, psa.cpf_cgc, PSA.rg_ie,  psa.cep, substring(orc.observacao from 1 for 200), PSA.pessoa, psa.fone,
      ORC.volume, ORC.peso, ORC.nome_consumidor, orc.validade,
      /* marca */
      mrc.codigo, mrc.nome,ORCI.grade, ORCI.numero
      , prd.localizacao_1,
      prd.localizacao_2,
      prd.localizacao_3
      from FAT_ORCAMENTOS ORC
      LEFT join glo_pessoas_fj psa on (psa.codigo = ORC.pessoa_fj and psa.cnpj = ORC.cnpj)
      LEFT join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
      LEFT join glo_bairros br on (psa.bairro = br.codigo and br.cnpj = psa.cnpj)
      LEFT join glo_cidades cdd on (psa.cidade = cdd.codigo)
      LEFT join fat_vendedor vdd on (ORC.vendedor = vdd.codigo and vdd.cnpj = ORC.cnpj)
      LEFT join fin_formas_pagto fpgto on (ORC.forma_pgto = fpgto.codigo)
      INNER join fat_orcamentos_itens ORCI on (ORC.codigo = ORCI.codigo and ORCI.cnpj = ORC.cnpj)
      INNER join est_produtos prd on (ORCI.produto = prd.codigo)
      left  join est_marcas        mrc   on (prd.marca     = mrc.codigo    and mrc.cnpj  = prd.cnpj)
      where ORC.codigo = :orca  and ORC.cnpj = :cnpj
  into
     :cliente, :fantasia_cli, :cidade, :endereco_cli,
     :cod_venda, :dt_venda,
     :desc_acresc,:total,
     :nome_vendedor, :forma_pagto, :sequencia, :produto,
     :quantidade, :prc_unitario, :desc_item, :prc_unitario_liq,
     :total_item,:pessoa_fj, :cod_produto, :total_bruto, :complemento, :bairro, :pct_item_descto,
     :unidade, :cgc_cpf_cli, :rg_ie, :cep, :observacao, :TP_PESSOA, :fone_cliente,
     :VOLUME, :peso, :SOLICITANTE, :data_validade,
     :mrc_codigo, :mrc_nome, :grd_grade, :grd_numero
     ,:localizacao_1
     ,:localizacao_2
     ,:localizacao_3
  do
  begin

    if( :pessoa_fj = 1 )  then
    begin
     cliente      = solicitante;
     fantasia_cli = solicitante;
    end

    if (not :grd_grade IS NULL and :grd_grade <> '0')then
    begin
         select grd.material, grd.cor, grd.nome_material, grd.nome_cor, grd.perfil, grd.nome_perfil, grd.ordem
         from LISTA_PRODUTOS_GRADES( :cnpj, :cod_produto ) grd
         where (grd.GRADE = :grd_grade and grd.numero = :grd_numero)
         into :GRD_MATERIAL, :GRD_COR, :GRD_NOME_MATERIAL, :GRD_NOME_COR, :GRD_PERFIL, :GRD_NOME_PERFIL,:GRD_ORDEM;
    end


    if (:tp_pessoa = 'J') then
       cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 2)||'.'||substring(:cgc_cpf_cli from 3 for 3)||'.'||substring(:cgc_cpf_cli from 6 for 3)||'/'||substring(:cgc_cpf_cli from 9 for 4)||'-'||substring(:cgc_cpf_cli from 13 for 2);
    else
       cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 3)||'.'||substring(:cgc_cpf_cli from 4 for 3)||'.'||substring(:cgc_cpf_cli from 7 for 3)||'-'||substring(:cgc_cpf_cli from 10 for 2);

    if (:total_bruto > 0) then
      pct_descto_venda = (:desc_acresc * 100.00)/:total_bruto;
    else
      pct_descto_venda = 0;

    select sum(quantidade) from fat_orcamentos_itens
    where codigo = :ORCA and cnpj = :cnpj
    into :cont_itens;

    parcelamento = '';
    if ((:entrada is not null) and (:entrada > 0)) then
      parcelamento = 'E-'||' ('||cast(:dt_venda as varchar(11))||') '||cast (:entrada as varchar (12));

    cont = 1;
    valor = 0;


  suspend;
  end
END
^

ALTER PROCEDURE PCD_IMPRIME_SERIE_REQUISICAO (
    ORDEM_CARGA INTEGER,
    CNPJ VARCHAR(14))
RETURNS (
    CLIENTE VARCHAR(50),
    CIDADE VARCHAR(60),
    ENDERECO_CLI VARCHAR(100),
    COD_VENDA INTEGER,
    COD_CLIENTE INTEGER,
    DT_VENDA DATE,
    DATA_CAIXA DATE,
    DESC_ACRESC FLOAT,
    DESC_ITEM FLOAT,
    TOTAL FLOAT,
    TOTAL_BRUTO FLOAT,
    NUM_CUPOM INTEGER,
    NUM_NF INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VD_ORDEM_CARGA INTEGER,
    PRODUTO VARCHAR(50),
    VDI_GRADE CHAR(4),
    VDI_NUMERO VARCHAR(6),
    VDI_CARREGADO FLOAT,
    VDI_CARREGAR FLOAT,
    VDI_ENTREGUE FLOAT,
    VDI_DEVOLVIDO FLOAT,
    VDI_ENTREGAR FLOAT,
    VDI_DEVOLVER FLOAT,
    FORMA_PAGTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_LIQ FLOAT,
    TOTAL_ITEM FLOAT,
    PARCELAMENTO VARCHAR(500),
    COD_PRODUTO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(50),
    PCT_ITEM_DESCTO FLOAT,
    UNIDADE CHAR(4),
    PESSOA_FJ INTEGER,
    CGC_CPF_CLI VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    NOME_TIPO_DOCTO VARCHAR(50),
    RG_IE VARCHAR(15),
    HORA TIME,
    PCT_DESCTO_VENDA FLOAT,
    CPF_CGC VARCHAR(14),
    CEP VARCHAR(20),
    CEP_EMP VARCHAR(20),
    BAIRRO_EMP VARCHAR(50),
    FONE VARCHAR(20),
    FONE_CLIENTE VARCHAR(20),
    ENDERECO_EMP VARCHAR(80),
    FANTASIA_CLI VARCHAR(50),
    EMPRESA VARCHAR(50),
    CIDADE_EMP VARCHAR(50),
    CNPJ_EMP VARCHAR(20),
    OBSERVACAO VARCHAR(200),
    CONT_ITENS NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    PRO_NOME VARCHAR(50),
    PRO_PROPRIETARIO VARCHAR(50),
    PRO_IE VARCHAR(15),
    PRO_PROPRIEDADE INTEGER,
    PRO_ENDERECO INTEGER,
    PRO_COMPLEMENTO VARCHAR(30),
    PRO_CIDADE INTEGER,
    PRO_UF CHAR(2),
    PRO_CEP VARCHAR(8),
    PRO_AREA_TOTAL VARCHAR(30),
    PRO_ATIVA CHAR(1),
    PRO_BAIRRO INTEGER,
    PRO_NUMERO VARCHAR(15),
    PRO_CPF VARCHAR(20),
    PRO_TECNICO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_FAX VARCHAR(20),
    GRD_GRADE CHAR(4),
    GRD_MATERIAL INTEGER,
    GRD_COR INTEGER,
    GRD_NOME_MATERIAL VARCHAR(50),
    GRD_NOME_COR VARCHAR(50),
    GRD_PERFIL INTEGER,
    GRD_NOME_PERFIL VARCHAR(50),
    GRD_NUMERO VARCHAR(6),
    GRD_ORDEM INTEGER,
    PC_PARCELAMENTO VARCHAR(300),
    CGRI_CARREGADO FLOAT,
    CGRI_DEVOLVIDO FLOAT,
    CGRI_ENTREGUE FLOAT,
    CGRI_QUANTIDADE FLOAT)
AS
DECLARE VARIABLE PARCELA NUMERIC(18,4);
DECLARE VARIABLE DT_VENCTO_REC DATE;
DECLARE VARIABLE ENTRADA NUMERIC(18,2);
DECLARE VARIABLE VALOR NUMERIC(18,2);
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE SOLICITANTE VARCHAR(50);
DECLARE VARIABLE CONT_PARC INTEGER;
DECLARE VARIABLE AUX_VALOR NUMERIC(18,2);
DECLARE VARIABLE PC_DIA INTEGER;
DECLARE VARIABLE PC_MES INTEGER;
DECLARE VARIABLE PC_AUXDIA CHAR(2);
DECLARE VARIABLE PC_AUXMES CHAR(2);
DECLARE VARIABLE PC_ANO INTEGER;
DECLARE VARIABLE SEQUENCIA_VND INTEGER;
DECLARE VARIABLE PC_PARCELA VARCHAR(6);
DECLARE VARIABLE PC_VALOR NUMERIC(18,2);
begin
  /* ------------[ Dados Empresa ]------------------------------------------- */
  select e.nome, e.fone, e.endereco, e.cep, e.bairro, e.cidade  from sis_empresas e
  where e.cnpj = :cnpj
  into :empresa , :fone, :endereco_emp, :cep_emp, :bairro_emp, :cidade_emp;
  cnpj_emp = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  /* ------------[ Codigo Venda ]-------------------------------------------- */
  select cgr.codigo_vnd from crg_ordem_carga cgr
  where cgr.codigo = :ORDEM_CARGA  and cgr.cnpj = :cnpj
  into :COD_VENDA;

  /* ------------[ Cabeçalho da Venda ]-------------------------------------- */
   select
      /* Pessoa FJ */   vd.pessoa_fj, coalesce(psa.nome_razao,''), coalesce(psa.FANTASIA,''),
                        psa.celular, psa.fax, PSA.pessoa, psa.fone, PSA.complemento,
                        psa.cpf_cgc, psa.cpf_cgc, PSA.rg_ie, psa.cep, coalesce(cdd.nome,'')||' - '||coalesce(cdd.uf,''),
                        coalesce(lgd.nome,'') ||' Nº:'||coalesce(psa.numero,''),
      /* Venda */       vd.pessoa_fj, vd.entrada, vd.codigo, vd.data, vd.data_caixa,
                        coalesce(vd.desc_acres,0), (vd.total + coalesce(vd.desc_acres,0)),
                        vd.num_cupom, vd.num_nf, substring(vd.observacao from 1 for 200), VD.volume, VD.peso,
                        vd.nome_consumidor, VD.hora, vd.tipo_docto, vd.total,
      /* vendedor */    vdd.nome,
      /* forma de pgto */ coalesce(fpgto.codigo,0)||'-'||coalesce(fpgto.nome,''),
      /* bairro */      br.nome,
      /* Propriedade */ pro.nome, pro.proprietario, pro.ie, pro.propriedade,
                        pro.endereco, pro.complemento, pro.cidade, pro.uf, pro.cep, pro.area_total,
                        pro.ativa, pro.bairro, pro.numero, pro.cpf, pro.tecnico
      from fat_vendas vd
      inner join glo_pessoas_fj    psa   on (psa.codigo    = vd.pessoa_fj  and psa.cnpj = vd.cnpj  )
      left  join glo_logradouros   lgd   on (lgd.codigo    = psa.endereco  and lgd.cnpj = psa.cnpj )
      left  join glo_bairros       br    on (psa.bairro    = br.codigo     and br.cnpj = psa.cnpj  )
      left  join glo_cidades       cdd   on (psa.cidade    = cdd.codigo    )
      left  join fat_vendedor      vdd   on (vd.vendedor   = vdd.codigo    and vdd.cnpj = vd.cnpj  )
      left  join fin_formas_pagto  fpgto on (vd.forma_pgto = fpgto.codigo  )
      left  join glo_propriedades  pro   on (psa.codigo    = pro.pessoa_fj and pro.propriedade = vd.propriedade and pro.cnpj = psa.cnpj)
      where vd.codigo = :COD_VENDA
      into
      /* cliente */             :cod_cliente, :cliente, :fantasia_cli, :psa_celular, :psa_fax,
                                :TP_PESSOA, :fone_cliente, :complemento,
                                :cgc_cpf_cli, :cpf_cgc, :rg_ie, :cep, :cidade, :endereco_cli,
      /* Venda */               :pessoa_fj, :entrada, :cod_venda, :dt_venda,
                                :data_caixa, :desc_acresc, :total, :num_cupom,
                                :num_nf, :observacao, :volume, :peso, :solicitante,
                                :hora, :tipo_docto, :total_bruto,
      /* vendedor */            :nome_vendedor,
      /* forma de pagamento */  :forma_pagto,
      /* bairro */              :bairro,
      /* PROPROIEDADE */        :pro_nome, :pro_proprietario, :pro_ie, :pro_propriedade,
                                :pro_endereco, :pro_complemento, :pro_cidade,
                                :pro_uf, :pro_cep, :pro_area_total,
                                :pro_ativa, :pro_bairro, :pro_numero, :pro_cpf, :pro_tecnico;

    /* ------------[ Formata CPF/CNPJ ]-------------------------------------- */
    if (:tp_pessoa = 'J') then
         cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 2)||'.'||substring(:cgc_cpf_cli from 3 for 3)||'.'||substring(:cgc_cpf_cli from 6 for 3)||'/'||substring(:cgc_cpf_cli from 9 for 4)||'-'||substring(:cgc_cpf_cli from 13 for 2);
    else
         cgc_cpf_cli = substring(:cgc_cpf_cli from 1 for 3)||'.'||substring(:cgc_cpf_cli from 4 for 3)||'.'||substring(:cgc_cpf_cli from 7 for 3)||'-'||substring(:cgc_cpf_cli from 10 for 2);

    /* ------------------------- Consumidor ------------------------------------------------- */
    if( :pessoa_fj = 1 )  then
    begin
         cliente      = solicitante;
         fantasia_cli = solicitante;
    end

  /* -----------------[ LAÇO NA CARGA ]-------------------------------------------------------- */
  for select
      /* Carga */
      cgr.codigo,
      /* Carga Item */
      cgri.produto, cgri.sequencia, cgri.nome_produto,
      cgri.carregado, cgri.devolvido, cgri.entregue, cgri.quantidade,
      cgri.grade, cgri.numero, CGRI.SEQUENCIA_VND
      from crg_ordem_carga_itens cgri
      inner join crg_ordem_carga cgr on (cgr.codigo = cgri.codigo and cgr.cnpj = cgri.cnpj)
      where cgr.codigo = :ORDEM_CARGA  and cgr.cnpj = :cnpj
  into
     /* Carga */
     :vd_ordem_carga,
     /* Carga Itens */
     :cod_produto,
     :sequencia, :produto,
     :cgri_carregado, :cgri_devolvido, :cgri_entregue, :cgri_quantidade,
     :vdi_GRADE, :vdi_numero, :sequencia_vnd
  do
  begin
        /* ------------------------- Valores do Produto ------------------------------------ */
        select
        /* item venda */  vdi.sequencia, prd.nome produto, vdi.quantidade,
                          vdi.prc_unitario, vdi.desconto, (coalesce(vdi.prc_unitario,0)- coalesce(vdi.desconto,0)),
                          (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0)- coalesce(vdi.desconto,0))) total_item,
                          VDI.grade, VDI.numero, vdi.porc_desc, vdi.unidade,
                          vdi.carregado, vdi.carregar, vdi.entregue, vdi.devolvido,VDI.ENTREGAR, VDI.DEVOLVER,
        /* marca */       mrc.codigo, mrc.nome
        from fat_vendas_itens   vdi
        inner join est_produtos prd   on (vdi.produto   = prd.codigo    )
        left  join est_marcas   mrc   on (prd.marca     = mrc.codigo    and mrc.cnpj  = prd.cnpj)
        where (vdi.codigo = :COD_VENDA and vdi.produto   = :cod_produto and vdi.sequencia = :sequencia_vnd and vdi.cnpj = :cnpj ) /*:cod_produto*/
        into
        /* item venda */  :sequencia, :produto, :quantidade,
                          :prc_unitario, :desc_item, :prc_unitario_liq, :total_item, :vdi_grade,
                          :VDI_numero, :pct_item_descto, :unidade, :vdi_carregado,
                          :vdi_carregar, :vdi_entregue, :vdi_devolvido, vdi_entregar, vdi_devolver,
        /* marca */       :mrc_codigo, :mrc_nome;

        /* ------------------------- Grade ------------------------------------------------- */
        if (not :vdi_grade IS NULL and :vdi_grade <> '0')then
        begin
             select grd.grade, grd.material, grd.cor, grd.nome_material, grd.nome_cor, grd.perfil, grd.nome_perfil, grd.numero, grd.ordem
             from LISTA_PRODUTOS_GRADES( :cnpj, :cod_produto ) grd
             where (grd.GRADE = :vdi_grade and grd.numero = :vdi_numero)
             into :GRD_GRADE, :GRD_MATERIAL, :GRD_COR, :GRD_NOME_MATERIAL, :GRD_NOME_COR, :GRD_PERFIL, :GRD_NOME_PERFIL, :GRD_NUMERO, :GRD_ORDEM;
        end
        else
        begin
          GRD_GRADE = NULL;
          GRD_MATERIAL = NULL;
          GRD_COR = NULL;
          GRD_NOME_MATERIAL = NULL;
          GRD_NOME_COR = NULL;
          GRD_PERFIL = NULL;
          GRD_NOME_PERFIL = NULL;
          GRD_NUMERO = NULL;
          GRD_ORDEM = NULL;
        end


        /* ------------------------- Tipo Docto ------------------------------------------------- */
        select d.nome from glo_tipos_docto d
        where d.sigla = :tipo_docto and d.cnpj = :cnpj
        into :nome_tipo_docto;
        /* ------------------------- Calculo Dscto ------------------------------------------------- */
        if (:total_bruto > 0) then
          pct_descto_venda = (:desc_acresc * 100.00)/:total_bruto;
        else
          pct_descto_venda = 0;
        /* ------------------------- Qtde Itens ------------------------------------------------- */
        select sum(quantidade) from crg_ordem_carga_itens
        where codigo = :ORDEM_CARGA and cnpj = :cnpj
        into :cont_itens;
        /* ------------------------- Parcelamento 1 ------------------------------------------------- */
        parcelamento = '';
        if ((:entrada is not null) and (:entrada > 0)) then
          parcelamento = 'E-'||' ('||cast(:dt_venda as varchar(11))||') '||cast (:entrada as varchar (12));
    
        cont = 1;
        valor = 0;
    
        if (:valor = 0 ) then
        begin
    
            for select pc.valor, pc.vencto from crg_ordem_carga crg
                inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
                where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
                into :valor, :dt_vencto_rec
            do
            begin
                if (:valor is null) then
                    valor  = 0;
    
               /**/ parcelamento = parcelamento ||' /P-'||cast(cont as varchar(2))||' '||' ('||cast(:dt_vencto_rec as varchar(11))||') '||' - '||cast (:valor as char (12));
                cont = cont + 1;
            end
        end

        /* ------------------------- Parcelamento 2 ------------------------------------------------- */
          pc_parcelamento = '';
          /*verificando quantos parcelamentos tenho desta venda, para poder validar a listagem deles na NF*/
          select count(pc.codigo) from crg_ordem_carga crg
          inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
          where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
          into :cont_parc;
        
          cont = 0;
          aux_valor = 0;
          for select extract(day from pc.vencto), extract(month from pc.vencto), extract(year from pc.vencto),
              pc.valor, pc.parcela
               from crg_ordem_carga crg
               inner join fat_vendas_parcelamento pc on (pc.codigo = crg.codigo_vnd and pc.cnpj = crg.cnpj)
               where crg.cnpj = :cnpj and crg.codigo = :ordem_carga
          into :pc_dia, :pc_mes, :pc_ano,
               :pc_valor, :pc_parcela
          do
          begin
            cont = cont + 1;
            if (:pc_dia <= 9) then
              pc_auxdia = '0'||:pc_dia;
            else
              pc_auxdia = :pc_dia;
        
            if (:pc_mes <= 9) then
              pc_auxmes = '0'||:pc_mes;
            else
              pc_auxmes = :pc_mes;
        
        
            if (:cont <= 10) then
            begin
              if ((:cont <= 9) or (:cont_parc <=10)) then
                pc_parcelamento = pc_parcelamento||' - '||:pc_parcela||' '||:pc_auxdia||'/'||:pc_auxmes||'/'||:pc_ano||'  '||:pc_valor||'  ';
              else
                aux_valor = :aux_valor + :pc_valor; /*passando a contabilizar a 10 parcela no restante*/
            end
            else
              aux_valor = :aux_valor + :pc_valor;
          end
          if (:aux_valor > 0) then
            pc_parcelamento = pc_parcelamento||'Vlr. Rest: '||:aux_valor;
        
          if (pc_parcelamento = '') then
           pc_parcelamento = 'À vista';
        /* --------------------------------------------------------------------------------------- */
  suspend;
  vdi_GRADE = null;
  vdi_numero = null;
  end
END
^

ALTER PROCEDURE PCD_LISTA_COMISSAO (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    VENDEDOR INTEGER)
RETURNS (
    VD_TOTAL FLOAT,
    VD_COD_VENDEDOR INTEGER,
    VD_DT_VD DATE,
    VD_DT_CX DATE,
    VD_CODIGO INTEGER,
    VD_TIPO VARCHAR(30),
    PCT_COMISSAO FLOAT,
    VLR_COMISSAO FLOAT,
    BX_CODIGO INTEGER,
    BX_VALOR FLOAT,
    BX_JUROS FLOAT,
    BX_DESCONTOS FLOAT,
    BX_DATA DATE)
AS
begin
  /*pegando somente vendas à vista*/
  for select vd.codigo, vd.vendedor, vd.data, vd.data_caixa, vd.total, vd.pct_comissao,
      ((coalesce(vd.total,0) * coalesce(vd.pct_comissao,0))/100.00), 'À Vista'
      from fat_vendas vd
      inner join est_natureza nat on (vd.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      inner join fin_formas_pagto pgt on (pgt.cnpj = vd.cnpj and pgt.codigo = vd.forma_pgto)
      where coalesce(vd.fechada,'N')  = 'S' and coalesce(vd.enviada_cx,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N'
      and coalesce(nat.computa_venda,'N') = 'S' and coalesce(pgt.avista,'N') = 'S'
      and (vd.data_caixa between :data1 and :data2) and vd.cnpj = :cnpj and (vd.vendedor = :vendedor or :vendedor  = 0)
      into :vd_codigo, :vd_cod_vendedor, :vd_dt_vd, :vd_dt_cx, :vd_total, :pct_comissao,
      :vlr_comissao, :vd_tipo
  do
  begin
    suspend;
  end

  /*pegando somente vendas à vista*/
  for select vd.codigo, vd.vendedor, vd.data, vd.data_caixa, vd.total, vd.pct_comissao
      ,bx.dt_baixa, 'À Prazo',
      bx.codigo, bx.vlr_baixa, bx.juros, bx.descontos,
      (
        (
           (
             coalesce(bx.vlr_baixa,0) + coalesce(bx.juros,0) - coalesce(bx.descontos,0)
           )   * coalesce(vd.pct_comissao,0)
        )/100.00
      )
      from fat_vendas vd
      inner join est_natureza nat on (vd.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      inner join fin_formas_pagto pgt on (pgt.cnpj = vd.cnpj and pgt.codigo = vd.forma_pgto)
      inner join fin_baixas_receber bx on (bx.cnpj = vd.cnpj and bx.codigo_vn = vd.codigo and vd.pessoa_fj = bx.pessoa_fj)
      where coalesce(vd.fechada,'N')  = 'S' and coalesce(vd.enviada_cx,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N'
      and coalesce(nat.computa_venda,'N') = 'S' and (vd.vendedor = :vendedor or :vendedor  = 0)
      and (bx.dt_baixa between :data1 and :data2) and vd.cnpj = :cnpj
      into :vd_codigo, :vd_cod_vendedor, :vd_dt_vd, :vd_dt_cx, :vd_total, :pct_comissao, :bx_data,
      :vd_tipo, :bx_codigo, :bx_valor, :bx_juros, :bx_descontos,
      :vlr_comissao
  do
  begin
    suspend;
  end
END
^

ALTER PROCEDURE PCD_LISTA_COMPRAS (
    CNPJ VARCHAR(18),
    CODIGO VARCHAR(15),
    LOAD INTEGER)
RETURNS (
    COD_FORNECEDOR INTEGER,
    FORNECEDOR VARCHAR(80),
    TELEFONE VARCHAR(20),
    NDOCTO VARCHAR(20),
    TIPO_DOCTO VARCHAR(20),
    LOCAL_ESTOQUE INTEGER,
    CUSTO FLOAT,
    DATA DATE,
    QTDE FLOAT)
AS
DECLARE VARIABLE CONT INTEGER;
begin
  cont = 1;
  for select et.pessoa_fj, eti.prc_unitario, et.data_ent, eti.quantidade, et.NDOCTO,
      et.tipo_docto, et.local_estoque
      from est_entradas_itens eti
      inner join est_entradas et on (et.cnpj = eti.cnpj and et.ndocto = eti.ndocto)
      where eti.produto =  :codigo  and eti.cnpj = :cnpj
      order by et.data_ent desc
      into :cod_fornecedor, :CUSTO, :DATA,:QTDE, :ndocto,
      :tipo_docto, :local_estoque
  do
  begin
    select psa.nome_razao, psa.fone from glo_pessoas_fj psa
    where psa.codigo = :cod_fornecedor and psa.cnpj = :cnpj
    into :fornecedor, :telefone;

    fornecedor = coalesce(:cod_fornecedor,'')||'-'||coalesce(:fornecedor,'');

    if (cont <= :load) then
    begin
      cont = cont + 1;
      suspend;
    end
    else
        break;
  end
END
^

ALTER PROCEDURE PCD_LISTA_FATURAMENTOS (
    CNPJ VARCHAR(18),
    PESSOA_FJ INTEGER,
    ES CHAR(1),
    CFOP INTEGER,
    TIPO CHAR(1))
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DATA DATE,
    DATA_CAIXA DATE,
    FECHADA CHAR(1),
    VENDEDOR VARCHAR(50),
    NATUREZA VARCHAR(80),
    SALDO NUMERIC(18,4),
    NUM_NF INTEGER)
AS
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE QTDE_ENTREGUE NUMERIC(18,4);
begin
  /*Remessa*/
  if (:tipo = 'R') then
  begin
    /*Em remessa iremos listar comente os regs com "tipos ES" diferentes*/
    for select vd.codigo, vd.total, vd.desc_acres, vd.data, vd.data_caixa, vd.fechada, vdd.nome,
          coalesce(nat.codigo,'')||'-'||coalesce(nat.nome,''), vd.num_nf
          from fat_vendas vd
          inner join fat_vendedor vdd on (vd.vendedor = vdd.codigo and vd.cnpj = vdd.cnpj)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and vd.natureza = nat.codigo)
          where  vd.pessoa_fj = :pessoa_fj and nat.es = :es and vd.natureza <> :cfop and vd.fechada = 'S'
          and nat.entrega_futura = 'S'
          into :codigo, :total, :desc_acresc, :data, :data_caixa,:fechada, :vendedor, :natureza, :num_nf
    do
    begin
      select sum(coalesce(vdi.quantidade,0)), sum(coalesce(vdi.qtde_entregue,0)) from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :codigo
      into :qtde, :qtde_entregue;

      saldo = (:qtde - :qtde_entregue);
      suspend;
    end
  end
  else
  begin
    /*Em iremos listar comente os regs com "tipos ES" diferentes*/
    for select vd.codigo, vd.total, vd.desc_acres, vd.data, vd.data_caixa, vd.fechada, vdd.nome,
        coalesce(nat.codigo,'')||'-'||coalesce(nat.nome,''),vd.num_nf
        from fat_vendas vd
        inner join fat_vendedor vdd on (vd.vendedor = vdd.codigo and vd.cnpj = vdd.cnpj)
        inner join est_natureza nat on (nat.cnpj = vd.cnpj and vd.natureza = nat.codigo)
        where  vd.pessoa_fj = :pessoa_fj and nat.es <> :es and vd.natureza <> :cfop and vd.fechada = 'S'
--        and nat.mov_estoque = 'S'
        into :codigo, :total, :desc_acresc, :data, :data_caixa,:fechada, :vendedor, :natureza, :num_nf
    do
    begin
      select sum(coalesce(vdi.quantidade,0)), sum(coalesce(vdi.qtde_entregue,0)) from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :codigo
      into :qtde, :qtde_entregue;
    
      saldo = (:qtde - :qtde_entregue);
      suspend;
    end
  end
END
^

ALTER PROCEDURE PCD_LISTA_PRODUTO (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    VENCTO_PRC_VENDA DATE,
    VALIDA_MULT_QTDE_MIN CHAR(1),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    COD_GETIN VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    QNTDE_MINIMA_VENDA FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    TRIB_PIS CHAR(2),
    TRIB_COFINS CHAR(2),
    TRIB_IPI CHAR(2),
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    CSOSN INTEGER,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    CODIGO_NCM VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    SECAO INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1),
    UND_PRIMARIA CHAR(4),
    FATOR_CONVERSAO NUMERIC(18,4),
    QNTDE_PDR_CARGA NUMERIC(18,4),
    SINCRONIZA_FILIAIS CHAR(1),
    UND_CARREGAMENTO CHAR(4),
    TRIB_ALIQ_EST NUMERIC(18,4),
    TRIB_ALIQ_INT NUMERIC(18,4),
    TRIB_MODALIDADE VARCHAR(50),
    APLICACAO BLOB SUB_TYPE 1 SEGMENT SIZE 200,
    IMG_2 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_1 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_3 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    IMG_4 BLOB SUB_TYPE -1 SEGMENT SIZE 80,
    CODIGO_FABRICANTE VARCHAR(50),
    COR INTEGER,
    MATERIAL INTEGER,
    BCH_CODIGO INTEGER,
    COD_LOCALIZACAO_1 INTEGER,
    COD_LOCALIZACAO_2 INTEGER,
    COD_LOCALIZACAO_3 INTEGER)
AS
declare variable comprometido1 numeric(18,4);
declare variable comprometido2 numeric(18,4);
declare variable comprometido3 numeric(18,4);
declare variable carregamento_parcial char(1);
BEGIN

     select coalesce(carregamento_parcial,'N') from sis_empresas
     where cnpj = :empresa
     into :carregamento_parcial;

     for select
      cnpj ,
      codigo ,
      codigo_interno,
      codigo_2 ,
      cnpj_agrup ,
      cod_agrup ,
      nome ,
      marca ,
      secao,
      modelo,
      grupo ,
      subgrupo ,
      reducao ,
      unidade ,
      cte ,
      ctie ,
      qtdade_1 ,
      qtdade_2 ,
      localizacao_1 ,
      localizacao_2 ,
      localizacao_3 ,
      neg_qtdade_2 ,
      qtdade_min ,
      qtdade_max ,
      complemento_nf ,
      dt_ult_compra ,
      qt_ult_compra ,
      dt_ult_venda ,
      margem_bruta ,
      prc_repos ,
      prc_custo_ant ,
      prc_custo_med ,
      prc_venda ,
      prc_venda_ant ,
      prc_venda_med ,
      aliquota_ecf ,
      origem ,
      peso_liq ,
      perc_frete ,
      ipi ,
      volume ,
      prod_pesavel ,
      etiqueta_ent ,
      ativo ,
      ultimo_fornecedor ,
      fornecedor ,
      subunidade ,
      nome_marca ,
      nome_modelo,
      prc_custo_codif,
      dt_ult_atu_preco,
      custo_aquisicao,
      qntde_exposta,
      possui_lote,
      vende_fracionado,
      qntde_pedida,
      previsao_entrega,
      qntde_maxima_venda,
      pis,
      cofins,
      com_venda_vlr,
      com_venda_pct,
      particip_lucro,
      nao_cobr_jur_ate,
      atualiza_arq_externo,
      servico,
      validade,
      custo_indexado,
      complemento,
      e.est_min,
      e.est_max,
      serie,
      e.debita_icms,
      e.qntde_minima_venda,
      e.valida_mult_qtde_min,
      e.und_primaria,
      e.fator_conversao,
      e.SINCRONIZA_FILIAIS,
      e.QNTDE_PDR_CARGA,E.und_carregamento,
      e.TRIB_ALIQ_EST,
      e.TRIB_ALIQ_INT,
      e.TRIB_MODALIDADE,
      e.codigo_ncm,
      e.APLICACAO  ,
      e.IMG_2,
      e.IMG_1,
      e.IMG_3,
      e.IMG_4,
      E.codigo_fabricante,
      e.cor,
      e.material,
      e.trib_ipi,
      e.trib_cofins,
      e.trib_pis,
      e.bch_codigo,
      e.VENCTO_PRC_VENDA,
      e.CSOSN,
      e.cod_getin,
      e.COD_LOCALIZACAO_1,
      e.cod_localizacao_2,
      e.cod_localizacao_3
     from est_produtos e
     where cnpj = :empresa and (codigo = :produto or :produto = ' ')
     order by cnpj desc, nome desc , ativo desc
     into 
      :cnpj ,  :codigo , :codigo_interno, :codigo_2 , :cnpj_agrup , :cod_agrup , :nome ,
      :marca ,:secao, :modelo, :grupo , :subgrupo , :reducao , :unidade , :cte , :ctie ,
      :qtdade_1 , :qtdade_2 , :localizacao_1 , :localizacao_2 , :localizacao_3 ,
      :neg_qtdade_2 , :qtdade_min , :qtdade_max , :complemento_nf , :dt_ult_compra ,
      :qt_ult_compra ,  :dt_ult_venda , :margem_bruta , :prc_repos , :prc_custo_ant ,
      :prc_custo_med , :prc_venda , :prc_venda_ant , :prc_venda_med , :aliquota_ecf ,
      :origem , :peso_liq , :perc_frete , :ipi , :volume , :prod_pesavel ,
      :etiqueta_ent , :ativo , :ultimo_fornecedor , :fornecedor , :subunidade ,
      :nome_marca, :nome_modelo, :prc_custo_codif, :dt_ult_atu_preco, :custo_aquisicao,
      :qntde_exposta, :possui_lote, :vende_fracionado,
      :qntde_pedida, :previsao_entrega,  :qntde_maxima_venda, :pis, :cofins,
      :com_venda_vlr, :com_venda_pct, :particip_lucro,  :nao_cobr_jur_ate,
      :atualiza_arq_externo, :servico, :validade, :custo_indexado, :complemento,
      :est_min, :est_max, :serie, :debita_icms, :qntde_minima_venda,
      :valida_mult_qtde_min, :und_primaria, :fator_conversao, :sincroniza_filiais,
      :qntde_pdr_carga, :UND_CARREGAMENTO,
      :trib_aliq_est,
      :trib_aliq_int,
      :trib_modalidade,
      :codigo_ncm,
      :APLICACAO  ,
      :IMG_2,
      :IMG_1,
      :IMG_3,
      :IMG_4,
      :codigo_fabricante,
      :cor,
      :material,
      :trib_ipi,
      :trib_cofins,
      :trib_pis,
      :bch_codigo,
      :VENCTO_PRC_VENDA,
      :CSOSN,
      :COD_GETIN,
      :COD_LOCALIZACAO_1,
      :cod_localizacao_2,
      :cod_localizacao_3
     do
     begin
       /**/
        if (:carregamento_parcial = 'S') then
        begin
            /*calculando estoque comprometido em orçamentos*/
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0)) from fat_orcamentos vd
            inner join fat_orcamentos_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and vd.comprometer_estoque = 'S' and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0) > 0 and vd.status <> 4
            into :comprometido1;
    
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            left join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            left join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where vd.cnpj = :cnpj
            and vdi.produto = :codigo
            and (coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) > 0
            and vd.fechada = 'S'
            and vd.cancelada = 'N'
            and vd.comprometer_estoque = 'S'
            and nat.es = 'S'
            into :comprometido2;
    
    
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            left join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            left join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and
            (coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) > 0
            and vd.fechada = 'S' and vd.cancelada = 'N' and vd.comprometer_estoque = 'S'
            and nat.es = 'E'
            into :comprometido3;  /* */
        
            comprometido = coalesce(:comprometido1,0) + coalesce(:comprometido2,0) - coalesce(:comprometido3,0);
         end
        suspend;
     end
END
^

ALTER PROCEDURE PCD_LOG_FAT_VENDAS (
    LOG_CODIGO INTEGER,
    LOG_CNPJ VARCHAR(14),
    LOG_USUARIO INTEGER,
    LOG_OPERACAO VARCHAR(20))
AS
DECLARE VARIABLE CNPJ VARCHAR(14);
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE FECHADA CHAR(1);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE USUARIO INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE NATUREZA INTEGER;
DECLARE VARIABLE ENVIADA_CX CHAR(1);
DECLARE VARIABLE FORMA_PGTO INTEGER;
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE CONVENIADO INTEGER;
DECLARE VARIABLE TIPO_DOCTO CHAR(3);
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE OBSERVACAO VARCHAR(200);
DECLARE VARIABLE VLR_PARC_LC NUMERIC(18,4);
DECLARE VARIABLE TERCEIRO INTEGER;
DECLARE VARIABLE CARGA INTEGER;
DECLARE VARIABLE VOLUME NUMERIC(18,4);
DECLARE VARIABLE PESO NUMERIC(18,4);
DECLARE VARIABLE REQUISICAO CHAR(6);
DECLARE VARIABLE DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE TIPO_VENDA CHAR(3);
DECLARE VARIABLE NOME_CONSUMIDOR VARCHAR(50);
DECLARE VARIABLE ORCAMENTO INTEGER;
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE LOCAL INTEGER;
DECLARE VARIABLE NOME VARCHAR(50);
DECLARE VARIABLE DATA_CAIXA DATE;
DECLARE VARIABLE CONTA_CAIXA INTEGER;
DECLARE VARIABLE CANCELADA CHAR(1);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
DECLARE VARIABLE BASE_ICM NUMERIC(18,4);
DECLARE VARIABLE ICM NUMERIC(18,4);
DECLARE VARIABLE BASE_ICM_SUBST NUMERIC(18,4);
DECLARE VARIABLE VALOR_ICM_SUBST NUMERIC(18,4);
DECLARE VARIABLE FRETE NUMERIC(18,4);
DECLARE VARIABLE SEGURO NUMERIC(18,4);
DECLARE VARIABLE DESPESAS NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE APRAZO NUMERIC(18,4);
DECLARE VARIABLE SELECIONADA CHAR(1);
DECLARE VARIABLE DUPLICATA INTEGER;
DECLARE VARIABLE BANCO CHAR(3);
DECLARE VARIABLE RECEBIDAS NUMERIC(18,4);
DECLARE VARIABLE CONTROLA_PLACA CHAR(1);
DECLARE VARIABLE CONTROLA_KM CHAR(1);
DECLARE VARIABLE ASSINA_NOTA CHAR(1);
DECLARE VARIABLE KM_ATUAL NUMERIC(18,4);
DECLARE VARIABLE NOME_PROPRIEDADE VARCHAR(50);
DECLARE VARIABLE NOME_VENDEDOR VARCHAR(50);
DECLARE VARIABLE NOME_NATUREZA VARCHAR(50);
DECLARE VARIABLE NOME_TERCEIRO VARCHAR(50);
DECLARE VARIABLE NOME_FORMA VARCHAR(50);
DECLARE VARIABLE UF CHAR(2);
DECLARE VARIABLE VALIDADE DATE;
DECLARE VARIABLE MEDIA_KM NUMERIC(18,4);
DECLARE VARIABLE DOCUMENTOS_CONSUMIDOR VARCHAR(20);
DECLARE VARIABLE ENDERECO_CONSUMIDOR VARCHAR(30);
DECLARE VARIABLE TURNO INTEGER;
DECLARE VARIABLE HORA TIME;
DECLARE VARIABLE NAO_COBR_JUR_ATE INTEGER;
DECLARE VARIABLE SERIE CHAR(3);
DECLARE VARIABLE DESCONTOS_CONCEDIDOS NUMERIC(18,4);
DECLARE VARIABLE NOME_CONVENIO VARCHAR(50);
DECLARE VARIABLE DT_EMISSAO_AGRUPADA DATE;
DECLARE VARIABLE TRANSPORTADORA INTEGER;
DECLARE VARIABLE DATA_CANCELAMENTO DATE;
DECLARE VARIABLE TOTAL_FISCAL NUMERIC(18,4);
DECLARE VARIABLE CONS_REV CHAR(1);
DECLARE VARIABLE IRRF NUMERIC(18,4);
DECLARE VARIABLE INSS NUMERIC(18,4);
DECLARE VARIABLE PIS_COFINS_CSLL NUMERIC(18,4);
DECLARE VARIABLE ISS NUMERIC(18,4);
DECLARE VARIABLE VALE_TROCO CHAR(1);
DECLARE VARIABLE CIDADE_CONSUMIDOR VARCHAR(50);
DECLARE VARIABLE PGTO_FRETE CHAR(1);
DECLARE VARIABLE BAIRRO_CONSUMIDOR VARCHAR(50);
DECLARE VARIABLE FONE_CONSUMIDOR VARCHAR(20);
DECLARE VARIABLE MESA INTEGER;
DECLARE VARIABLE DESCTO_RES NUMERIC(18,4);
DECLARE VARIABLE COMPROMETER_ESTOQUE CHAR(1);
DECLARE VARIABLE ID_AGRUPADOR INTEGER;
DECLARE VARIABLE DESCTO_ICMS NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCTO_ICMS NUMERIC(18,4);
DECLARE VARIABLE NF_AGRUPADA CHAR(1);
DECLARE VARIABLE TRP_QTDE NUMERIC(18,4);
DECLARE VARIABLE TRP_ESPECIE VARCHAR(50);
DECLARE VARIABLE TRP_PESO_BRUTO NUMERIC(18,4);
DECLARE VARIABLE TRP_PESO_LIQUIDO NUMERIC(18,4);
DECLARE VARIABLE TRP_NUMERO VARCHAR(50);
DECLARE VARIABLE TRP_MARCA INTEGER;
DECLARE VARIABLE TRP_NOME VARCHAR(50);
DECLARE VARIABLE STATUS_CARREGAMENTO INTEGER;
DECLARE VARIABLE ORDEM_CARGA INTEGER;
DECLARE VARIABLE ENTREGA_FUTURA CHAR(1);
DECLARE VARIABLE PCT_COMISSAO NUMERIC(18,4);
DECLARE VARIABLE CENTRO_CUSTO INTEGER;
DECLARE VARIABLE ES CHAR(1);
DECLARE VARIABLE GERA_FINANCEIRO CHAR(1);
DECLARE VARIABLE NFE_CHAVE VARCHAR(80);
DECLARE VARIABLE NFE_SELECIONADO CHAR(1);
begin

    select
    CNPJ ,
    CODIGO ,
    DATA ,
    FECHADA ,
    HISTORICO,
    PESSOA_FJ,
    USUARIO ,
    VENDEDOR,
    NATUREZA,
    ENVIADA_CX,
    FORMA_PGTO,
    NUM_NF,
    NUM_CUPOM,
    PROPRIEDADE,
    CONVENIADO,
    TIPO_DOCTO,
    LOCAL_COBRANCA         ,
    DESC_ACRES            ,
    ENTRADA               ,
    DINHEIRO  ,
    CHEQUE ,
    CARTAO ,
    TICKET ,
    TOTAL  ,
    substring(OBSERVACAO from 1 for 200)            ,
    VLR_PARC_LC            ,
    TERCEIRO               ,
    CARGA                  ,
    VOLUME                 ,
    PESO                   ,
    REQUISICAO             ,
    DESCRICAO              ,
    TIPO_VENDA             ,
    NOME_CONSUMIDOR        ,
    ORCAMENTO              ,
    TROCO                  ,
    LOCAL                  ,
    NOME                   ,
    DATA_CAIXA             ,
    CONTA_CAIXA            ,
    CANCELADA              ,
    TOTAL_NOTA             ,
    BASE_ICM               ,
    ICM                    ,
    BASE_ICM_SUBST         ,
    VALOR_ICM_SUBST        ,
    FRETE                  ,
    SEGURO                 ,
    DESPESAS               ,
    IPI                    ,
    APRAZO                 ,
    SELECIONADA            ,
    DUPLICATA              ,
    BANCO                  ,
    RECEBIDAS              ,
    CONTROLA_PLACA         ,
    CONTROLA_KM            ,
    ASSINA_NOTA            ,
    KM_ATUAL               ,
    NOME_PROPRIEDADE       ,
    NOME_VENDEDOR          ,
    NOME_NATUREZA          ,
    NOME_TERCEIRO          ,
    NOME_FORMA             ,
    UF                     ,
    VALIDADE               ,
    MEDIA_KM               ,
    DOCUMENTOS_CONSUMIDOR  ,
    ENDERECO_CONSUMIDOR    ,
    TURNO                  ,
    HORA                   ,
    NAO_COBR_JUR_ATE       ,
    SERIE                  ,
    DESCONTOS_CONCEDIDOS   ,
    NOME_CONVENIO          ,
    DT_EMISSAO_AGRUPADA    ,
    TRANSPORTADORA         ,
    DATA_CANCELAMENTO      ,
    TOTAL_FISCAL           ,
    CONS_REV               ,
    IRRF                   ,
    INSS                   ,
    PIS_COFINS_CSLL        ,
    ISS                    ,
    VALE_TROCO             ,
    CIDADE_CONSUMIDOR      ,
    PGTO_FRETE             ,
    BAIRRO_CONSUMIDOR      ,
    FONE_CONSUMIDOR        ,
    MESA                   ,
    DESCTO_RES             ,
    COMPROMETER_ESTOQUE    ,
    ID_AGRUPADOR           ,
    DESCTO_ICMS            ,
    PCT_DESCTO_ICMS        ,
    NF_AGRUPADA            ,
    TRP_QTDE               ,
    TRP_ESPECIE            ,
    TRP_PESO_BRUTO         ,
    TRP_PESO_LIQUIDO       ,
    TRP_NUMERO             ,
    TRP_MARCA              ,
    TRP_NOME               ,
    STATUS_CARREGAMENTO    ,
    ORDEM_CARGA            ,
    ENTREGA_FUTURA         ,
    PCT_COMISSAO           ,
    CENTRO_CUSTO           ,
    ES                     ,
    GERA_FINANCEIRO        ,
    NFE_CHAVE              ,
    NFE_SELECIONADO
    from fat_vendas vd
    where vd.codigo = :log_codigo and vd.cnpj = :log_cnpj
    into
    :CNPJ ,
    :CODIGO ,
    :DATA ,
    :FECHADA ,
    :HISTORICO,
    :PESSOA_FJ,
    :USUARIO ,
    :VENDEDOR,
    :NATUREZA,
    :ENVIADA_CX,
    :FORMA_PGTO,
    :NUM_NF,
    :NUM_CUPOM,
    :PROPRIEDADE,
    :CONVENIADO,
    :TIPO_DOCTO,
    :LOCAL_COBRANCA         ,
    :DESC_ACRES            ,
    :ENTRADA               ,
    :DINHEIRO  ,
    :CHEQUE ,
    :CARTAO ,
    :TICKET ,
    :TOTAL  ,
    :OBSERVACAO             ,
    :VLR_PARC_LC            ,
    :TERCEIRO               ,
    :CARGA                  ,
    :VOLUME                 ,
    :PESO                   ,
    :REQUISICAO             ,
    :DESCRICAO              ,
    :TIPO_VENDA             ,
    :NOME_CONSUMIDOR        ,
    :ORCAMENTO              ,
    :TROCO                  ,
    :LOCAL                  ,
    :NOME                   ,
    :DATA_CAIXA             ,
    :CONTA_CAIXA            ,
    :CANCELADA              ,
    :TOTAL_NOTA             ,
    :BASE_ICM               ,
    :ICM                    ,
    :BASE_ICM_SUBST         ,
    :VALOR_ICM_SUBST        ,
    :FRETE                  ,
    :SEGURO                 ,
    :DESPESAS               ,
    :IPI                    ,
    :APRAZO                 ,
    :SELECIONADA            ,
    :DUPLICATA              ,
    :BANCO                  ,
    :RECEBIDAS              ,
    :CONTROLA_PLACA         ,
    :CONTROLA_KM            ,
    :ASSINA_NOTA            ,
    :KM_ATUAL               ,
    :NOME_PROPRIEDADE       ,
    :NOME_VENDEDOR          ,
    :NOME_NATUREZA          ,
    :NOME_TERCEIRO          ,
    :NOME_FORMA             ,
    :UF                     ,
    :VALIDADE               ,
    :MEDIA_KM               ,
    :DOCUMENTOS_CONSUMIDOR  ,
    :ENDERECO_CONSUMIDOR    ,
    :TURNO                  ,
    :HORA                   ,
    :NAO_COBR_JUR_ATE       ,
    :SERIE                  ,
    :DESCONTOS_CONCEDIDOS   ,
    :NOME_CONVENIO          ,
    :DT_EMISSAO_AGRUPADA    ,
    :TRANSPORTADORA         ,
    :DATA_CANCELAMENTO      ,
    :TOTAL_FISCAL           ,
    :CONS_REV               ,
    :IRRF                   ,
    :INSS                   ,
    :PIS_COFINS_CSLL        ,
    :ISS                    ,
    :VALE_TROCO             ,
    :CIDADE_CONSUMIDOR      ,
    :PGTO_FRETE             ,
    :BAIRRO_CONSUMIDOR      ,
    :FONE_CONSUMIDOR        ,
    :MESA                   ,
    :DESCTO_RES             ,
    :COMPROMETER_ESTOQUE    ,
    :ID_AGRUPADOR           ,
    :DESCTO_ICMS            ,
    :PCT_DESCTO_ICMS        ,
    :NF_AGRUPADA            ,
    :TRP_QTDE               ,
    :TRP_ESPECIE            ,
    :TRP_PESO_BRUTO         ,
    :TRP_PESO_LIQUIDO       ,
    :TRP_NUMERO             ,
    :TRP_MARCA              ,
    :TRP_NOME               ,
    :STATUS_CARREGAMENTO    ,
    :ORDEM_CARGA            ,
    :ENTREGA_FUTURA         ,
    :PCT_COMISSAO           ,
    :CENTRO_CUSTO           ,
    :ES                     ,
    :GERA_FINANCEIRO        ,
    :NFE_CHAVE              ,
    :NFE_SELECIONADO;

    insert into log_fat_vendas
    (CNPJ ,
    CODIGO ,
    DATA ,
    FECHADA ,
    HISTORICO,
    PESSOA_FJ,
    USUARIO ,
    VENDEDOR,
    NATUREZA,
    ENVIADA_CX,
    FORMA_PGTO,
    NUM_NF,
    NUM_CUPOM,
    PROPRIEDADE,
    CONVENIADO,
    TIPO_DOCTO,
    LOCAL_COBRANCA ,
    DESC_ACRES,
    ENTRADA ,
    DINHEIRO,
    CHEQUE ,
    CARTAO ,
    TICKET ,
    TOTAL  ,
    OBSERVACAO             ,
    VLR_PARC_LC            ,
    TERCEIRO               ,
    CARGA                  ,
    VOLUME                 ,
    PESO                   ,
    REQUISICAO             ,
    DESCRICAO              ,
    TIPO_VENDA             ,
    NOME_CONSUMIDOR        ,
    ORCAMENTO              ,
    TROCO                  ,
    LOCAL                  ,
    NOME                   ,
    DATA_CAIXA             ,
    CONTA_CAIXA            ,
    CANCELADA              ,
    TOTAL_NOTA             ,
    BASE_ICM               ,
    ICM                    ,
    BASE_ICM_SUBST         ,
    VALOR_ICM_SUBST        ,
    FRETE                  ,
    SEGURO                 ,
    DESPESAS               ,
    IPI                    ,
    APRAZO                 ,
    SELECIONADA            ,
    DUPLICATA              ,
    BANCO                  ,
    RECEBIDAS              ,
    CONTROLA_PLACA         ,
    CONTROLA_KM            ,
    ASSINA_NOTA            ,
    KM_ATUAL               ,
    NOME_PROPRIEDADE       ,
    NOME_VENDEDOR          ,
    NOME_NATUREZA          ,
    NOME_TERCEIRO          ,
    NOME_FORMA             ,
    UF                     ,
    VALIDADE               ,
    MEDIA_KM               ,
    DOCUMENTOS_CONSUMIDOR  ,
    ENDERECO_CONSUMIDOR    ,
    TURNO                  ,
    HORA                   ,
    NAO_COBR_JUR_ATE       ,
    SERIE                  ,
    DESCONTOS_CONCEDIDOS   ,
    NOME_CONVENIO          ,
    DT_EMISSAO_AGRUPADA    ,
    TRANSPORTADORA         ,
    DATA_CANCELAMENTO      ,
    TOTAL_FISCAL           ,
    CONS_REV               ,
    IRRF                   ,
    INSS                   ,
    PIS_COFINS_CSLL        ,
    ISS                    ,
    VALE_TROCO             ,
    CIDADE_CONSUMIDOR      ,
    PGTO_FRETE             ,
    BAIRRO_CONSUMIDOR      ,
    FONE_CONSUMIDOR        ,
    MESA                   ,
    DESCTO_RES             ,
    COMPROMETER_ESTOQUE    ,
    ID_AGRUPADOR           ,
    DESCTO_ICMS            ,
    PCT_DESCTO_ICMS        ,
    NF_AGRUPADA            ,
    TRP_QTDE               ,
    TRP_ESPECIE            ,
    TRP_PESO_BRUTO         ,
    TRP_PESO_LIQUIDO       ,
    TRP_NUMERO             ,
    TRP_MARCA              ,
    TRP_NOME               ,
    STATUS_CARREGAMENTO    ,
    ORDEM_CARGA            ,
    ENTREGA_FUTURA         ,
    PCT_COMISSAO           ,
    CENTRO_CUSTO           ,
    ES                     ,
    GERA_FINANCEIRO        ,
    NFE_CHAVE              ,
    NFE_SELECIONADO,
    LOG_USUARIO,
    LOG_HORA,
    LOG_DATA,
    LOG_OPERACAO)
    values
    (:CNPJ ,
    :CODIGO ,
    :DATA ,
    :FECHADA ,
    :HISTORICO,
    :PESSOA_FJ,
    :USUARIO ,
    :VENDEDOR,
    :NATUREZA,
    :ENVIADA_CX,
    :FORMA_PGTO,
    :NUM_NF,
    :NUM_CUPOM,
    :PROPRIEDADE,
    :CONVENIADO,
    :TIPO_DOCTO,
    :LOCAL_COBRANCA         ,
    :DESC_ACRES            ,
    :ENTRADA               ,
    :DINHEIRO  ,
    :CHEQUE ,
    :CARTAO ,
    :TICKET ,
    :TOTAL  ,
    :OBSERVACAO             ,
    :VLR_PARC_LC            ,
    :TERCEIRO               ,
    :CARGA                  ,
    :VOLUME                 ,
    :PESO                   ,
    :REQUISICAO             ,
    :DESCRICAO              ,
    :TIPO_VENDA             ,
    :NOME_CONSUMIDOR        ,
    :ORCAMENTO              ,
    :TROCO                  ,
    :LOCAL                  ,
    :NOME                   ,
    :DATA_CAIXA             ,
    :CONTA_CAIXA            ,
    :CANCELADA              ,
    :TOTAL_NOTA             ,
    :BASE_ICM               ,
    :ICM                    ,
    :BASE_ICM_SUBST         ,
    :VALOR_ICM_SUBST        ,
    :FRETE                  ,
    :SEGURO                 ,
    :DESPESAS               ,
    :IPI                    ,
    :APRAZO                 ,
    :SELECIONADA            ,
    :DUPLICATA              ,
    :BANCO                  ,
    :RECEBIDAS              ,
    :CONTROLA_PLACA         ,
    :CONTROLA_KM            ,
    :ASSINA_NOTA            ,
    :KM_ATUAL               ,
    :NOME_PROPRIEDADE       ,
    :NOME_VENDEDOR          ,
    :NOME_NATUREZA          ,
    :NOME_TERCEIRO          ,
    :NOME_FORMA             ,
    :UF                     ,
    :VALIDADE               ,
    :MEDIA_KM               ,
    :DOCUMENTOS_CONSUMIDOR  ,
    :ENDERECO_CONSUMIDOR    ,
    :TURNO                  ,
    :HORA                   ,
    :NAO_COBR_JUR_ATE       ,
    :SERIE                  ,
    :DESCONTOS_CONCEDIDOS   ,
    :NOME_CONVENIO          ,
    :DT_EMISSAO_AGRUPADA    ,
    :TRANSPORTADORA         ,
    :DATA_CANCELAMENTO      ,
    :TOTAL_FISCAL           ,
    :CONS_REV               ,
    :IRRF                   ,
    :INSS                   ,
    :PIS_COFINS_CSLL        ,
    :ISS                    ,
    :VALE_TROCO             ,
    :CIDADE_CONSUMIDOR      ,
    :PGTO_FRETE             ,
    :BAIRRO_CONSUMIDOR      ,
    :FONE_CONSUMIDOR        ,
    :MESA                   ,
    :DESCTO_RES             ,
    :COMPROMETER_ESTOQUE    ,
    :ID_AGRUPADOR           ,
    :DESCTO_ICMS            ,
    :PCT_DESCTO_ICMS        ,
    :NF_AGRUPADA            ,
    :TRP_QTDE               ,
    :TRP_ESPECIE            ,
    :TRP_PESO_BRUTO         ,
    :TRP_PESO_LIQUIDO       ,
    :TRP_NUMERO             ,
    :TRP_MARCA              ,
    :TRP_NOME               ,
    :STATUS_CARREGAMENTO    ,
    :ORDEM_CARGA            ,
    :ENTREGA_FUTURA         ,
    :PCT_COMISSAO           ,
    :CENTRO_CUSTO           ,
    :ES                     ,
    :GERA_FINANCEIRO        ,
    :NFE_CHAVE              ,
    :NFE_SELECIONADO,
    :log_usuario,
    current_time,
    current_date,
    :log_operacao);

  suspend;
END
^

ALTER PROCEDURE PCD_LST_ATENDIMENTO_OS_SINT (
    CNPJ VARCHAR(14),
    DATA_INI DATE,
    DATA_FIM DATE,
    TP_DATA CHAR(1),
    PR_REGIAO INTEGER,
    PR_MODELO INTEGER,
    PR_CLIENTE INTEGER,
    PR_MTV_CHAMADO INTEGER,
    PR_EQUIPAMENTO VARCHAR(15),
    PR_TPCONTRATO INTEGER,
    PR_TPA_CODIGO INTEGER,
    PR_MARCA INTEGER,
    PR_CONTRATO INTEGER,
    PR_CIDADE INTEGER,
    PR_STATUS INTEGER,
    PR_TECNICO INTEGER)
RETURNS (
    OFC_CODIGO INTEGER,
    ID_CONTRATO INTEGER,
    OFC_DATA DATE,
    OFC_TEMPO_VIAJEM FLOAT,
    OFC_DT_ENTRADA DATE,
    OFC_DT_FECHAMENTO DATE,
    OFC_DT_SOLICITACAO DATE,
    OFC_HR_ENTRADA TIME,
    OFC_DT_ATRIBUICAO DATE,
    OFC_HR_ATRIBUICAO TIME,
    OFC_DATA_FECHAMENTO DATE,
    OFC_TOTAL NUMERIC(18,4),
    OFC_SOLICITANTE VARCHAR(50),
    OFC_VENDA INTEGER,
    OFC_KM_RODADO NUMERIC(18,4),
    OFC_HORAS_TRABALHADAS NUMERIC(18,4),
    ST_CODIGO INTEGER,
    ST_COR INTEGER,
    ST_NOME VARCHAR(50),
    MEC_CODIGO INTEGER,
    MEC_NOME VARCHAR(50),
    DEF_CODIGO INTEGER,
    DEF_NOME VARCHAR(50),
    MTC_CODIGO INTEGER,
    MTC_NOME VARCHAR(50),
    TPA_CODIGO INTEGER,
    TPA_NOME VARCHAR(50),
    CLI_CODIGO INTEGER,
    CLI_NOME_RAZAO VARCHAR(90),
    REG_CODIGO INTEGER,
    REG_DESCRICAO VARCHAR(50),
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(90),
    PRD_SERIE VARCHAR(30),
    MDL_CODIGO INTEGER,
    MDL_NOME VARCHAR(50),
    MRC_CODIGO INTEGER,
    MRC_NOME VARCHAR(50),
    CP_TEMPO_RESPOSTA FLOAT,
    CP_COD_CONTRATO INTEGER,
    TPC_NOME VARCHAR(50),
    TP_ATENDIMENTO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(70),
    TECNICO_ATDD CHAR(1),
    REG_NOME VARCHAR(50),
    BAIRRO VARCHAR(50),
    ENDERECO VARCHAR(100),
    FONE VARCHAR(20))
AS
declare variable originador integer;
declare variable os_rechamado integer;
declare variable preventivo integer;
begin
    /*data de solicitacao*/
    if (:tp_data = 'S') then
    begin
        for select
            ofc.id_contrato,
            ofc.codigo ofc_codigo,
            ofc.data ofc_data,
            ofc.entrada ofc_dt_entrada,
            cast(ofc.hr_entrada as time),
            ofc.dt_atribuicao ofc_dt_atribuicao,
            cast(ofc.hr_atribuicao as time),
            ofc.data_fechamento ofc_data_fechamento,
            ofc.total ofc_total,
            ofc.cliente ofc_solicitante,
            ofc.venda ofc_venda,
            ofc.km_rodado,
            ofc.horas_trabalhadas,
            st.codigo st_codigo,
            st.cor st_cor,
            st.nome st_nome,
            mec.codigo mec_codigo,
            mec.nome mec_nome,
            def.codigo def_codigo,
            def.nome def_nome,
            mtc.codigo mtc_codigo,
            mtc.nome mtc_nome,
            tpa.codigo tpa_codigo,
            tpa.nome tpa_nome,
            cli.codigo cli_codigo,
            coalesce(cli.codigo,'')||'-'||coalesce(cli.nome_razao,'') cli_nome_razao,
            reg.codigo reg_codigo,
            coalesce(reg.nome,'Não determinada') reg_descricao,
            prd.codigo prd_codigo,
            coalesce(prd.nome,'')||' ('||coalesce(prd.serie,'')||')' prd_nome,
            prd.serie prd_serie,
            mdl.codigo mdl_codigo,
            coalesce(mdl.nome,'Não determinado') mdl_nome,
            mrc.codigo mrc_codigo,
            coalesce(mrc.nome,'Não determinada') mrc_nome,
            ofc.tempo_resposta cp_tempo_resposta,
            ct.cod_contrato cp_cod_contrato,
            tpc.nome tpc_nome,
            ofc.os_rechamado,
            ofc.preventivo,
            cdd.codigo,
            cdd.nome,
            ofc.tipo_tecnico,
            ('End: '||coalesce(lgd.nome,'')||' Nº '||coalesce(cli.numero,'')),
            br.nome,
            cli.fone,
            ofc.data_fechamento,
            ofc.entrada
            from ofc_ordem_servico ofc
            left join ofc_status             st on (st.codigo = ofc.cod_status and st.cnpj=ofc.cnpj)
            left join ofc_mecanicos          mec on (mec.codigo = ofc.mecanico and mec.cnpj = ofc.cnpj)
            left join ofc_defeito            def on (def.codigo = ofc.defeito_reclamado and def.cnpj = ofc.cnpj)
            left join ofc_motivo_chamado     mtc on (mtc.codigo = ofc.id_motivo_chamado and mtc.cnpj = ofc.cnpj)
            left join ofc_tipo_atendimento   tpa on (tpa.codigo = ofc.id_tipo_atendimento and tpa.cnpj = ofc.cnpj)
            left join glo_pessoas_fj         cli on (cli.codigo = ofc.pessoa_fj and cli.cnpj = ofc.cnpj)
            left join glo_logradouros        lgd on (cli.endereco = lgd.codigo and cli.cnpj = lgd.cnpj)
            left join glo_bairros            br on (cli.bairro = br.codigo and cli.cnpj = br.cnpj)
            left join glo_cidades            cdd on (cdd.codigo = cli.cidade and cli.cnpj = cdd.cnpj)
            left join glo_regioes            reg on (reg.codigo = cli.regiao and reg.cnpj = ofc.cnpj)
            left join est_produtos           prd on (prd.codigo = ofc.produto and prd.cnpj = ofc.cnpj)
            left join ofc_contratos          ct on (ct.cnpj = cli.cnpj and ct.cod_cliente = cli.codigo and ct.codigo = ofc.id_contrato)
            left join ofc_contratos_itens cti on (cti.contrato = ct.codigo and ct.cnpj = cti.cnpj and ofc.produto = cti.cod_produto )
            left join glo_tipo_contrato      tpc on (tpc.cnpj = ct.cnpj and tpc.codigo = ct.cod_contrato )
            left join glo_modelo_propriedade mdl on (mdl.codigo = prd.modelo  and mdl.cnpj = ofc.cnpj)
            left join EST_MARCAS             mrc on (mrc.codigo = prd.marca  and mrc.cnpj = ofc.cnpj)
            where (ofc.cnpj = :cnpj) and (cast(ofc.entrada as date) between :DATA_Ini and :DATA_Fim)
            and (reg.codigo = :PR_REGIAO or :PR_REGIAO = 0)
            and (mdl.codigo = :PR_MODELO or :pr_modelo  = 0)
            and (cli.codigo = :PR_CLIENTE or :PR_CLIENTE  = 0)
            and (mtc.codigo = :PR_MTV_CHAMADO or :PR_MTV_CHAMADO = 0)
            and (prd.codigo = :PR_EQUIPAMENTO or :PR_EQUIPAMENTO = '')
            and (tpc.codigo = :PR_TPCONTRATO or :PR_TPCONTRATO = 0)
            and (mrc.codigo = :PR_MARCA or :PR_MARCA = 0)
            and (ct.cod_contrato = :PR_CONTRATO or :pr_contrato = 0)
            and (cdd.codigo = :PR_CIDADE or :pr_cidade = 0)
            and (st.codigo =  :PR_STATUS or :pr_status = 0)
            and (mec.codigo = :PR_TECNICO or :pr_tecnico = 0)
            and (tpa.codigo = :pr_tpa_codigo or :pr_tpa_codigo = 0)
            into
            /* variaveis ordem servico */
            :id_contrato,:ofc_codigo, :ofc_data, :ofc_dt_entrada,           :ofc_hr_entrada, :ofc_dt_atribuicao,
            :ofc_hr_atribuicao,     :ofc_data_fechamento,      :ofc_total,      :ofc_solicitante,    :ofc_venda,
            :ofc_km_rodado,         :ofc_horas_trabalhadas,
            /* variaveis status */                      /* variaveis mecanico */
            :st_codigo, :st_cor, :st_nome,              :mec_codigo, :mec_nome,
            /* variaveis defeito */                     /* variaveis motivo chamado */
            :def_codigo, :def_nome,                     :mtc_codigo, :mtc_nome,
            /* variaveis tipo atendimento */            /* variaveis cliente */
            :tpa_codigo, :tpa_nome,                     :cli_codigo, :cli_nome_razao,
            /* variaveis regiao */                      /* variaveis produto */
            :reg_codigo, :reg_descricao,                :prd_codigo, :prd_nome, :prd_serie,
            /* variaveis modelo */                      /* variaveis marca */
            :mdl_codigo, :mdl_nome,                     :mrc_codigo, :mrc_nome,
            /* variaveis contrato produto */            /* variaveis tipo contrato */
            :cp_tempo_resposta, :cp_cod_contrato,       :tpc_nome,
            :os_rechamado,
            :PREVENTIVO,
            :cod_cidade,
            :cidade,
            :tecnico_atdd,
            :endereco,
            :bairro,
            :fone,
            :ofc_data_fechamento,
            :ofc_dt_solicitacao
            do
            begin
              select sum(coalesce(tempo_viajem,0))
              from ofc_ordem_servico_intervalo
              where cnpj = :cnpj and codigo = :ofc_codigo
              into :ofc_tempo_viajem;

              /*verificando o tipo do atendimento
              Normal - Andimento normal
              Originador - Originador de um Rechamado
              Rechamado - Rechamado de acordo com os parametros existentes no contrato
              Preventiva - Atendimento disparado como preventivo*/
    

              /*verificando se o atendimento atual é um originador*/
              select count(*) from ofc_ordem_servico os
              where os.os_rechamado = :ofc_codigo and os.cnpj = :cnpj
              into :originador;
    
              if (:originador > 0) then
               tp_atendimento = 'Originador';
              else if (:os_rechamado > 0) then
               tp_atendimento = 'Rechamado';
              else
               tp_atendimento = 'Normal';
    
              suspend;
            end
    end
    else if (:tp_data = 'P') then
    begin
        /*data de programcao*/
        for select
            ofc.id_contrato,
            ofc.codigo ofc_codigo,
            ofc.data ofc_data,
            ofc.entrada ofc_dt_entrada,
            cast(ofc.hr_entrada as time),
            ofc.dt_atribuicao ofc_dt_atribuicao,
            cast(ofc.hr_atribuicao as time),
            ofc.data_fechamento ofc_data_fechamento,
            ofc.total ofc_total,
            ofc.cliente ofc_solicitante,
            ofc.venda ofc_venda,
            ofc.km_rodado,
            ofc.horas_trabalhadas,
            st.codigo st_codigo,
            st.cor st_cor,
            st.nome st_nome,
            mec.codigo mec_codigo,
            mec.nome mec_nome,
            def.codigo def_codigo,
            def.nome def_nome,
            mtc.codigo mtc_codigo,
            mtc.nome mtc_nome,
            tpa.codigo tpa_codigo,
            tpa.nome tpa_nome,
            cli.codigo cli_codigo,
            coalesce(cli.codigo,'')||'-'||coalesce(cli.nome_razao,'') cli_nome_razao,
            reg.codigo reg_codigo,
            coalesce(reg.nome,'Não determinada') reg_descricao,
            prd.codigo prd_codigo,
            coalesce(prd.nome,'')||' ('||coalesce(prd.serie,'')||')' prd_nome,
            prd.serie prd_serie,
            mdl.codigo mdl_codigo,
            coalesce(mdl.nome,'Não determinado') mdl_nome,
            mrc.codigo mrc_codigo,
            coalesce(mrc.nome,'Não determinada') mrc_nome,
            ofc.tempo_resposta cp_tempo_resposta,
            ct.cod_contrato cp_cod_contrato,
            tpc.nome tpc_nome,
            ofc.os_rechamado,
            ofc.preventivo,
            cdd.codigo,
            cdd.nome,
            ofc.tipo_tecnico,
            ('End: '||coalesce(lgd.nome,'')||' Nº '||coalesce(cli.numero,'')),
            br.nome,
            cli.fone,
            ofc.data_fechamento,
            ofc.entrada
            from ofc_ordem_servico ofc
            left join ofc_status             st on (st.codigo = ofc.cod_status and st.cnpj=ofc.cnpj)
            left join ofc_mecanicos          mec on (mec.codigo = ofc.mecanico and mec.cnpj = ofc.cnpj)
            left join ofc_defeito            def on (def.codigo = ofc.defeito_reclamado and def.cnpj = ofc.cnpj)
            left join ofc_motivo_chamado     mtc on (mtc.codigo = ofc.id_motivo_chamado and mtc.cnpj = ofc.cnpj)
            left join ofc_tipo_atendimento   tpa on (tpa.codigo = ofc.id_tipo_atendimento and tpa.cnpj = ofc.cnpj)
            left join glo_pessoas_fj         cli on (cli.codigo = ofc.pessoa_fj and cli.cnpj = ofc.cnpj)
            left join glo_logradouros        lgd on (cli.endereco = lgd.codigo and cli.cnpj = lgd.cnpj)
            left join glo_bairros            br on (cli.bairro = br.codigo and cli.cnpj = br.cnpj)
            left join glo_cidades            cdd on (cdd.codigo = cli.cidade and cli.cnpj = cdd.cnpj)
            left join glo_regioes            reg on (reg.codigo = cli.regiao and reg.cnpj = ofc.cnpj)
            left join est_produtos           prd on (prd.codigo = ofc.produto and prd.cnpj = ofc.cnpj)
            left join ofc_contratos          ct on (ct.cnpj = cli.cnpj and ct.cod_cliente = cli.codigo and ct.codigo = ofc.id_contrato)
            left join ofc_contratos_itens cti on (cti.contrato = ct.codigo and ct.cnpj = cti.cnpj and ofc.produto = cti.cod_produto)
            left join glo_tipo_contrato      tpc on (tpc.cnpj = ct.cnpj and tpc.codigo = ct.cod_contrato)
            left join glo_modelo_propriedade mdl on (mdl.codigo = prd.modelo  and mdl.cnpj = ofc.cnpj)
            left join EST_MARCAS             mrc on (mrc.codigo = prd.marca  and mrc.cnpj = ofc.cnpj)
            where (ofc.cnpj = :cnpj) and (cast(ofc.dt_atribuicao as date) between :DATA_Ini and :DATA_Fim)
            and (reg.codigo = :PR_REGIAO or :PR_REGIAO = 0)
            and (mdl.codigo = :PR_MODELO or :pr_modelo  = 0)
            and (cli.codigo = :PR_CLIENTE or :PR_CLIENTE  = 0)
            and (mtc.codigo = :PR_MTV_CHAMADO or :PR_MTV_CHAMADO = 0)
            and (prd.codigo = :PR_EQUIPAMENTO or :PR_EQUIPAMENTO = '')
            and (tpc.codigo = :PR_TPCONTRATO or :PR_TPCONTRATO = 0)
            and (mrc.codigo = :PR_MARCA or :PR_MARCA = 0)
            and (ct.cod_contrato = :PR_CONTRATO or :pr_contrato = 0)
            and (cdd.codigo = :PR_CIDADE or :pr_cidade = 0)
            and (st.codigo =  :PR_STATUS or :pr_status = 0)
            and (mec.codigo = :PR_TECNICO or :pr_tecnico = 0)
            and (tpa.codigo = :pr_tpa_codigo or :pr_tpa_codigo = 0)
            into
            /* variaveis ordem servico */
            :id_contrato,:ofc_codigo, :ofc_data, :ofc_dt_entrada,           :ofc_hr_entrada, :ofc_dt_atribuicao,
            :ofc_hr_atribuicao,     :ofc_data_fechamento,      :ofc_total,      :ofc_solicitante,    :ofc_venda,
            :ofc_km_rodado,         :ofc_horas_trabalhadas,
            /* variaveis status */                      /* variaveis mecanico */
            :st_codigo, :st_cor, :st_nome,              :mec_codigo, :mec_nome,
            /* variaveis defeito */                     /* variaveis motivo chamado */
            :def_codigo, :def_nome,                     :mtc_codigo, :mtc_nome,
            /* variaveis tipo atendimento */            /* variaveis cliente */
            :tpa_codigo, :tpa_nome,                     :cli_codigo, :cli_nome_razao,
            /* variaveis regiao */                      /* variaveis produto */
            :reg_codigo, :reg_descricao,                :prd_codigo, :prd_nome, :prd_serie,
            /* variaveis modelo */                      /* variaveis marca */
            :mdl_codigo, :mdl_nome,                     :mrc_codigo, :mrc_nome,
            /* variaveis contrato produto */            /* variaveis tipo contrato */
            :cp_tempo_resposta, :cp_cod_contrato,       :tpc_nome,
            :os_rechamado,
            :PREVENTIVO,
            :cod_cidade,
            :cidade,
            :tecnico_atdd,
            :endereco,
            :bairro,
            :fone,
            :ofc_data_fechamento,
            :ofc_dt_solicitacao
            do
            begin
              select sum(coalesce(tempo_viajem,0))
              from ofc_ordem_servico_intervalo
              where cnpj = :cnpj and codigo = :ofc_codigo
              into :ofc_tempo_viajem;

              /*verificando o tipo do atendimento
              Normal - Andimento normal
              Originador - Originador de um Rechamado
              Rechamado - Rechamado de acordo com os parametros existentes no contrato
              Preventiva - Atendimento disparado como preventivo*/
    
              /*verificando se o atendimento atual é um originador*/
              select count(*) from ofc_ordem_servico os
              where os.os_rechamado = :ofc_codigo
              into :originador;
    
              if (:originador > 0) then
               tp_atendimento = 'Originador';
              else if (:os_rechamado > 0) then
               tp_atendimento = 'Rechamado';
              else
               tp_atendimento = 'Normal';
    
              suspend;
            end
    end
    else if (:tp_data = 'F') then
    begin
        /*Dt. Fechamento*/
        for select
        ofc.id_contrato, ofc.codigo ofc_codigo,
        ofc.data ofc_data,
        ofc.entrada ofc_dt_entrada,
        cast(ofc.hr_entrada as time),
        ofc.dt_atribuicao ofc_dt_atribuicao,
        cast(ofc.hr_atribuicao as time),
        ofc.data_fechamento ofc_data_fechamento,
        ofc.total ofc_total,
        ofc.cliente ofc_solicitante,
        ofc.venda ofc_venda,
        ofc.km_rodado,
        ofc.horas_trabalhadas,
        st.codigo st_codigo,
        st.cor st_cor,
        st.nome st_nome,
        mec.codigo mec_codigo,
        mec.nome mec_nome,
        def.codigo def_codigo,
        def.nome def_nome,
        mtc.codigo mtc_codigo,
        mtc.nome mtc_nome,
        tpa.codigo tpa_codigo,
        tpa.nome tpa_nome,
        cli.codigo cli_codigo,
        coalesce(cli.codigo,'')||'-'||coalesce(cli.nome_razao,'') cli_nome_razao,
        reg.codigo reg_codigo,
        coalesce(reg.nome,'Não determinada') reg_descricao,
        prd.codigo prd_codigo,
        coalesce(prd.nome,'')||' ('||coalesce(prd.serie,'')||')' prd_nome,
        prd.serie prd_serie,
        mdl.codigo mdl_codigo,
        coalesce(mdl.nome,'Não determinado') mdl_nome,
        mrc.codigo mrc_codigo,
        coalesce(mrc.nome,'Não determinada') mrc_nome,
        ofc.tempo_resposta cp_tempo_resposta,
        ct.cod_contrato cp_cod_contrato,
        tpc.nome tpc_nome,
        ofc.os_rechamado,
        ofc.preventivo,
        cdd.codigo,
        cdd.nome,
        ofc.tipo_tecnico,
        ('End: '||coalesce(lgd.nome,'')||' Nº '||coalesce(cli.numero,'')),
        br.nome,
        cli.fone,
        ofc.data_fechamento,
        ofc.entrada
        from ofc_ordem_servico ofc
        left join ofc_status             st on (st.codigo = ofc.cod_status and st.cnpj=ofc.cnpj)
        left join ofc_mecanicos          mec on (mec.codigo = ofc.mecanico and mec.cnpj = ofc.cnpj)
        left join ofc_defeito            def on (def.codigo = ofc.defeito_reclamado and def.cnpj = ofc.cnpj)
        left join ofc_motivo_chamado     mtc on (mtc.codigo = ofc.id_motivo_chamado and mtc.cnpj = ofc.cnpj)
        left join ofc_tipo_atendimento   tpa on (tpa.codigo = ofc.id_tipo_atendimento and tpa.cnpj = ofc.cnpj)
        left join glo_pessoas_fj         cli on (cli.codigo = ofc.pessoa_fj and cli.cnpj = ofc.cnpj)
        left join glo_logradouros        lgd on (cli.endereco = lgd.codigo and cli.cnpj = lgd.cnpj)
        left join glo_bairros            br on (cli.bairro = br.codigo and cli.cnpj = br.cnpj)
        left join glo_cidades            cdd on (cdd.codigo = cli.cidade and cli.cnpj = cdd.cnpj)
        left join glo_regioes            reg on (reg.codigo = cli.regiao and reg.cnpj = ofc.cnpj)
        left join est_produtos           prd on (prd.codigo = ofc.produto and prd.cnpj = ofc.cnpj)
        left join ofc_contratos          ct on (ct.cnpj = cli.cnpj and ct.cod_cliente = cli.codigo and ct.codigo = ofc.id_contrato)
        left join ofc_contratos_itens cti on (cti.contrato = ct.codigo and ct.cnpj = cti.cnpj and ofc.produto = cti.cod_produto)
        left join glo_tipo_contrato      tpc on (tpc.cnpj = ct.cnpj and tpc.codigo = ct.cod_contrato)
        left join glo_modelo_propriedade mdl on (mdl.codigo = prd.modelo  and mdl.cnpj = ofc.cnpj)
        left join EST_MARCAS             mrc on (mrc.codigo = prd.marca  and mrc.cnpj = ofc.cnpj)
        where (ofc.cnpj = :cnpj) and (ofc.data_fechamento between :DATA_Ini and :DATA_Fim)
       and (reg.codigo = :PR_REGIAO or :PR_REGIAO = 0)
        and (mdl.codigo = :PR_MODELO or :pr_modelo  = 0)
        and (cli.codigo = :PR_CLIENTE or :PR_CLIENTE  = 0)
        and (mtc.codigo = :PR_MTV_CHAMADO or :PR_MTV_CHAMADO = 0)
        and (prd.codigo = :PR_EQUIPAMENTO or :PR_EQUIPAMENTO = '')
        and (tpc.codigo = :PR_TPCONTRATO or :PR_TPCONTRATO = 0)
        and (mrc.codigo = :PR_MARCA or :PR_MARCA = 0)
        and (ct.cod_contrato = :PR_CONTRATO or :pr_contrato = 0)
        and (cdd.codigo = :PR_CIDADE or :pr_cidade = 0)
        and (st.codigo =  :PR_STATUS or :pr_status = 0)
        and (mec.codigo = :PR_TECNICO or :pr_tecnico = 0)
        and (tpa.codigo = :pr_tpa_codigo or :pr_tpa_codigo = 0)
        into
        /* variaveis ordem servico */
        :id_contrato,:ofc_codigo, :ofc_data, :ofc_dt_entrada,           :ofc_hr_entrada, :ofc_dt_atribuicao,
        :ofc_hr_atribuicao,     :ofc_data_fechamento,      :ofc_total,      :ofc_solicitante,    :ofc_venda,
        :ofc_km_rodado,         :ofc_horas_trabalhadas,
        /* variaveis status */                      /* variaveis mecanico */
        :st_codigo, :st_cor, :st_nome,              :mec_codigo, :mec_nome,
        /* variaveis defeito */                     /* variaveis motivo chamado */
        :def_codigo, :def_nome,                     :mtc_codigo, :mtc_nome,
        /* variaveis tipo atendimento */            /* variaveis cliente */
        :tpa_codigo, :tpa_nome,                     :cli_codigo, :cli_nome_razao,
        /* variaveis regiao */                      /* variaveis produto */
        :reg_codigo, :reg_descricao,                :prd_codigo, :prd_nome, :prd_serie,
        /* variaveis modelo */                      /* variaveis marca */
        :mdl_codigo, :mdl_nome,                     :mrc_codigo, :mrc_nome,
        /* variaveis contrato produto */            /* variaveis tipo contrato */
        :cp_tempo_resposta, :cp_cod_contrato,       :tpc_nome,
        :os_rechamado,
        :PREVENTIVO,
        :cod_cidade,
        :cidade,
        :tecnico_atdd,
        :endereco,
        :bairro,
        :fone,
        :ofc_data_fechamento,
        :ofc_dt_solicitacao
        do
        begin
          select sum(coalesce(tempo_viajem,0))
          from ofc_ordem_servico_intervalo
          where cnpj = :cnpj and codigo = :ofc_codigo
          into :ofc_tempo_viajem;
            
          /*verificando o tipo do atendimento
          Normal - Andimento normal
          Originador - Originador de um Rechamado
          Rechamado - Rechamado de acordo com os parametros existentes no contrato
          Preventiva - Atendimento disparado como preventivo*/

          /*verificando se o atendimento atual é um originador*/
          select count(*) from ofc_ordem_servico os
          where os.os_rechamado = :ofc_codigo
          into :originador;

          if (:originador > 0) then
           tp_atendimento = 'Originador';
          else if (:os_rechamado > 0) then
           tp_atendimento = 'Rechamado';
          else if (:preventivo = 'S') then
           tp_atendimento = 'Preventivo';
          else
           tp_atendimento = 'Normal';

          suspend;
        end
    end
END
^

ALTER PROCEDURE PCD_LST_CRG_FORMACAO_SINT (
    CNPJ VARCHAR(14),
    CODIGO_FORMACAO INTEGER)
RETURNS (
    CRGI_PRODUTO VARCHAR(15),
    CRGI_NOME_PRODUTO VARCHAR(50),
    CRGI_GRADE VARCHAR(4),
    CRGI_NUMERO VARCHAR(6),
    CRGI_UNIDADE CHAR(4),
    CRGI_CARREGADO FLOAT,
    PRD_LOCALIZACAO_1 VARCHAR(30),
    PRD_LOCALIZACAO_2 VARCHAR(30),
    PRD_LOCALIZACAO_3 VARCHAR(30),
    E_NOME VARCHAR(50),
    E_FONE VARCHAR(20),
    E_ENDERECO VARCHAR(50),
    E_CEP VARCHAR(8),
    E_BAIRRO VARCHAR(50),
    E_CIDADE VARCHAR(50),
    E_CNPJ VARCHAR(20))
AS
begin
    /* Dados da Empresa */
    SELECT E.NOME, E.FONE, E.ENDERECO, E.CEP, E.BAIRRO, E.CIDADE
    FROM SIS_EMPRESAS E WHERE E.CNPJ = :CNPJ
    INTO :E_NOME, :E_FONE, :E_ENDERECO, :E_CEP, :E_BAIRRO, :E_CIDADE;
    E_CNPJ = SUBSTRING(:CNPJ FROM 1 FOR 2)||'.'||SUBSTRING(:CNPJ FROM 3 FOR 3)||'.'||SUBSTRING(:CNPJ FROM 6 FOR 3)||'/'||SUBSTRING(:CNPJ FROM 9 FOR 4)||'-'||SUBSTRING(:CNPJ FROM 13 FOR 2);

    FOR
        SELECT
        /* PRODUTO */
        PRD.LOCALIZACAO_1,PRD.LOCALIZACAO_2,PRD.LOCALIZACAO_3,
        /* ORDEM DE CARGA ITENS */
        CRGI.PRODUTO,CRGI.NOME_PRODUTO,CRGI.GRADE,CRGI.NUMERO,CRGI.UNIDADE,SUM(CRGI.CARREGADO)
        FROM CRG_FORMAR_CARGA_ITENS CRGF
        INNER JOIN CRG_ORDEM_CARGA_ITENS CRGI ON (CRGI.CODIGO = CRGF.CRG_CARGA)
        INNER JOIN EST_PRODUTOS PRD ON (PRD.CNPJ = CRGI.CNPJ AND PRD.CODIGO = CRGI.PRODUTO)
        WHERE CRGF.CNPJ = :CNPJ AND CRGF.CODIGO = :CODIGO_FORMACAO
        GROUP BY
        PRD.LOCALIZACAO_1,PRD.LOCALIZACAO_2,PRD.LOCALIZACAO_3,
        CRGI.PRODUTO,CRGI.NOME_PRODUTO,CRGI.GRADE,CRGI.NUMERO,CRGI.UNIDADE
    INTO
        /* PRODUTO */
        PRD_LOCALIZACAO_1,PRD_LOCALIZACAO_2,PRD_LOCALIZACAO_3,
        /* ORDEM DE CARGA ITENS */
        CRGI_PRODUTO,CRGI_NOME_PRODUTO,CRGI_GRADE,CRGI_NUMERO,CRGI_UNIDADE,CRGI_CARREGADO
    DO BEGIN
       SUSPEND;
    END
END
^

ALTER PROCEDURE PCD_LST_DIAS_TRAB_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    OST_DT_INICIO DATE,
    OST_DT_FIM DATE,
    OST_HR_INICIO TIME,
    OST_HR_FIM TIME,
    OST_QTDE_HORA INTEGER)
AS
begin
    FOR
    select
    ost.codigo,
    ost.dt_inicio ost_dt_inicio,
    ost.dt_fim ost_dt_fim,
    ost.hr_inicio ost_hr_inicio,
    ost.hr_fim ost_hr_fim,
    ost.qtde_hora ost_qtde_hora

    /* Movimentos dos Dias Trabalhados */
    from OFC_ORDEM_SERVICO_INTERVALO ost
--    where (ost.codigo = :ofc_codigo)

    INTO
    :OFC_CODIGO,
    /* variaveis horas trabalhadas */
    :ost_dt_inicio, :ost_dt_fim, :ost_hr_inicio, :ost_hr_fim, :ost_qtde_hora
    DO BEGIN
       SUSPEND;
    END
END
^

ALTER PROCEDURE PCD_LST_EST_COMPROMETIDO (
    CNPJ VARCHAR(18))
RETURNS (
    TOTAL_ITEM NUMERIC(18,4),
    CLIENTE VARCHAR(70),
    CODIGO INTEGER,
    PRODUTO VARCHAR(70),
    QUANTIDADE NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    MARCA VARCHAR(50),
    FORNECEDOR INTEGER,
    PSA_CODIGO INTEGER,
    PSA_NOME_RAZAO VARCHAR(50),
    PRD_NOME VARCHAR(50),
    ORIGEM VARCHAR(50))
AS
DECLARE VARIABLE VD_CODIGO INTEGER;
DECLARE VARIABLE ES CHAR(1);
begin

  for select vd.codigo, vd.pessoa_fj, nat.ES   from fat_vendas vd
      inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
      where vd.cnpj = :cnpj and comprometer_estoque = 'S'
      and coalesce(vd.fechada,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N'
      and coalesce(vd.enviada_cx,'N')='S'
      into :vd_codigo, :psa_codigo, :es
  do
  begin
     /*encontrando o cliente*/
      select coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''), psa.codigo, psa.nome_razao from glo_pessoas_fj
      psa where psa.cnpj = :cnpj and psa.codigo = :psa_codigo
      into :cliente, :psa_codigo, :psa_nome_razao;

     /*percorrendo os items*/
     for select vdi.produto, sum(vdi.quantidade - coalesce(vdi.qtde_entregue,0)),
         sum((coalesce(vdi.prc_unitario,0)) * (vdi.quantidade - coalesce(vdi.qtde_entregue,0))),
         sum(vdi.prc_custo * (vdi.quantidade - coalesce(vdi.qtde_entregue,0))) from fat_vendas_itens vdi
         where vdi.cnpj = :cnpj and vdi.codigo = :vd_codigo and (vdi.quantidade - coalesce(vdi.qtde_entregue,0)) > 0
         group by vdi.produto
         into :codigo, :quantidade, :total_item, :prc_custo
     do
     begin
         ORIGEM = 'Faturamento';

         if (:es = 'E') then
         begin
           quantidade = (:quantidade * -1);
           total_item = (:total_item * -1);
         end

         /*produto, marca e fornecedor*/
         select coalesce(prd.codigo,'')||'-'||coalesce(prd.nome,''), prd.nome_marca, prd.fornecedor, prd.nome
         from est_produtos prd
         where prd.codigo = :codigo and prd.cnpj = :cnpj
         into :produto, :marca, :fornecedor, :prd_nome;

         suspend;
     end
  end

  for select oc.codigo, oc.pessoa_fj from fat_orcamentos oc
      where oc.cnpj = :cnpj and oc.comprometer_estoque = 'S' and oc.status <> 4
      into :vd_codigo, :psa_codigo
  do
  begin
     /*encontrando o cliente*/
      select coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''), psa.codigo, psa.nome_razao
      from glo_pessoas_fj psa
      where psa.cnpj = :cnpj and psa.codigo = :psa_codigo
      into :cliente, :psa_codigo, :psa_nome_razao;

     /*percorrendo os items
     sum((coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))*/
     for select vdi.produto, sum(vdi.quantidade - coalesce(vdi.qtde_faturada,0)),
         sum((coalesce(vdi.prc_unitario,0)) * (vdi.quantidade - coalesce(vdi.qtde_faturada,0))),
         sum(vdi.prc_custo * (vdi.quantidade - coalesce(vdi.qtde_faturada,0))) from fat_orcamentos_itens vdi
         where vdi.cnpj = :cnpj and vdi.codigo = :vd_codigo and (vdi.quantidade - coalesce(vdi.qtde_faturada,0) > 0)
         group by vdi.produto
         into :codigo, :quantidade, :total_item, :prc_custo
     do
     begin
         ORIGEM = 'Orçamento';
         /*produto, marca e fornecedor*/
         select coalesce(prd.codigo,'')||'-'||coalesce(prd.nome,''), prd.nome_marca, prd.fornecedor, prd.nome
         from est_produtos prd
         where prd.codigo = :codigo and prd.cnpj = :cnpj
         into :produto, :marca, :fornecedor, :prd_nome;

         suspend;
     end
  end
  /**/
END
^

ALTER PROCEDURE PCD_LST_MOV_ANEXO_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    MOV_HISTORICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    MOV_VALOR NUMERIC(18,4),
    MOV_TIPO CHAR(1),
    MOV_DATA DATE,
    MOV_TIPO_DESPESA CHAR(3))
AS
begin
    FOR
    select
    mov.codigo,
    mov.historico mov_historico,
    mov.valor mov_valor,
    mov.tipo mov_tipo,
    mov.data mov_data,
    mov.tipo_despesa mov_tipo_despesa

    /* Movimentos de Anexos */
    from OFC_ORDEM_SERVICO_MOVIMENTO mov
--    where (mov.codigo = :ofc_codigo)

    INTO
    :OFC_CODIGO,
    /* variaveis movimentos */
    :mov_historico, :mov_valor, :mov_tipo, :mov_data, :mov_tipo_despesa

    DO BEGIN
       SUSPEND;
    END
END
^

ALTER PROCEDURE PCD_LST_MOVIMENTOS_OS_ANAL
RETURNS (
    OFC_CODIGO INTEGER,
    OSI_CODIGO INTEGER,
    OSI_QUANTIDADE NUMERIC(18,4),
    OSI_SERVICO INTEGER,
    OSI_UNITARIO NUMERIC(18,4),
    SRV_CODIGO VARCHAR(15),
    SRV_NOME VARCHAR(50),
    SRV_SERVICO VARCHAR(10))
AS
begin
    FOR
    select
    osi.codigo,
    osi.codigo,
    osi.quantidade osi_quantidade,
    osi.servico osi_servico,
    osi.unitario osi_unitario,
    srv.codigo srv_codigo,
    srv.nome srv_nome,
    case
     coalesce(srv.servico,'N')
     when 'S' then
     'Servico'
     else
     'Produto'
    end
    /* Movimentos dos Servicos */
    from OFC_ORDEM_SERVICO_SERVICO osi
    inner join EST_PRODUTOS        srv on (srv.codigo = osi.produto)
--    where (osi.codigo = :ofc_codigo or 0 = :ofc_codigo)

    INTO
    :OFC_CODIGO,
    /* variaveis servicos */
    :osi_codigo, :osi_quantidade, :osi_servico, :osi_unitario,
    /* variaveis servicos */
    :srv_codigo, :srv_nome, :srv_servico
    DO BEGIN
       SUSPEND;
    END
END
^

ALTER PROCEDURE PCD_LST_OS_PREVENTIVA (
    CNPJ CHAR(14),
    COD_CIDADE INTEGER,
    COD_TECNICO INTEGER,
    COD_CLIENTE INTEGER,
    DATA_BASE DATE,
    ATIVO CHAR(1))
RETURNS (
    CONTRATO_ATIVO CHAR(1),
    CONTRATO_CLIENTE INTEGER,
    CONTRATO_CODIGO INTEGER,
    CONTRATO_DIAS_RECHAMADO INTEGER,
    CONTRATO_DT_FIM TIMESTAMP,
    CONTRATO_DT_INICIO TIMESTAMP,
    NUMERO_CONTRATO VARCHAR(30),
    TEMPO_RESPOSTA INTEGER,
    ATIVIDADE_CLIENTE INTEGER,
    BAIRRO_CLIENTE INTEGER,
    CIDADE_CLIENTE INTEGER,
    CODIGO_CLIENTE INTEGER,
    CPF_CNPJ VARCHAR(15),
    NOME_FANTASIA VARCHAR(50),
    RAZAO_SOCIAL VARCHAR(50),
    REGIAO_CLIENTE INTEGER,
    RG_INSC_ESTADUAL VARCHAR(15),
    UF CHAR(2),
    PRODUTO_ATIVO CHAR(1),
    CODIGO_PRODUTO VARCHAR(15),
    CODIGO_PRODUTO_SEC VARCHAR(15),
    CODIGO_MARCA INTEGER,
    NOME_PRODUTO VARCHAR(50),
    MARCA_PRODUTO VARCHAR(50),
    MODELO_PRODUTO VARCHAR(80),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    MEDIA_COPIA INTEGER,
    CONTRATO_COPIAS_PREVENTIVA INTEGER,
    QTDE_COPIA_ATUAL INTEGER,
    QTDE_COPIA_PREVISTA INTEGER,
    DT_FECHAMENTO_ULTIMO DATE,
    CONTADOR_ULTIMO INTEGER,
    PONTO_VISITA_PREVENTIVA DATE,
    DIAS_EM_ATRASO INTEGER,
    NOME_CIDADE VARCHAR(50),
    NOME_REGIAO VARCHAR(50),
    NOME_TIPO_CONTRATO VARCHAR(50))
AS
DECLARE VARIABLE DIAS INTEGER;
BEGIN
  /* Procedure Text */

  for select cti.ativo, ct.cod_cliente, cti.qtde_copias_preventiva,
    ct.codigo,
    cti.dias_rechamado,
    ct.dt_fim,
    ct.dt_inicio,
    COALESCE(cti.media_copias,1), ct.num_contrato,
    cti.tempo_resposta,
    pes.atividade ,pes.bairro,
    pes.cidade,
    cdd.nome,
    pes.codigo , pes.cpf_cgc ,pes.fantasia,
    pes.nome_razao , pes.regiao ,
    pes.rg_ie ,pes.uf ,
    prd.ativo ,
    prd.codigo ,prd.codigo_2 ,
    prd.marca ,
    prd.nome , prd.nome_marca , prd.nome_modelo ,
    tpcnt.codigo, tpcnt.nome,
    reg.nome,
    tpcnt.nome
    from ofc_contratos ct
    inner join ofc_contratos_itens cti on (cti.cnpj = ct.cnpj and cti.contrato = ct.codigo)
    left join glo_pessoas_fj pes on (pes.codigo = ct.cod_cliente and pes.cnpj = ct.cnpj)
    left join glo_cidades cdd on (cdd.codigo = pes.cidade and cdd.cnpj = pes.cnpj)
    left join glo_regioes reg on (reg.codigo = pes.regiao and reg.cnpj = pes.cnpj)
    left join est_produtos prd on (prd.codigo = cti.cod_produto and prd.cnpj = cti.cnpj)
    left join glo_tipo_contrato tpcnt on (tpcnt.codigo = ct.cod_contrato and tpcnt.cnpj = ct.cnpj)
    where (:ativo = cti.ativo) and (:cnpj = cti.cnpj) and (cti.qtde_copias_preventiva is not null)
    and (cdd.codigo = :cod_cidade or 0 = :cod_cidade) and (reg.tecnico = :cod_tecnico or :cod_tecnico = 0)
    and (pes.codigo = :cod_cliente or :cod_cliente = 0)
    INTO
    :Contrato_Ativo    , :Contrato_Cliente        , :contrato_copias_preventiva,
    :Contrato_Codigo   , :Contrato_Dias_Rechamado ,
    :Contrato_Dt_Fim   , :Contrato_Dt_Inicio      ,
    :Media_Copia       , :Numero_Contrato         , :Tempo_Resposta ,
    :Atividade_Cliente , :Bairro_Cliente          , :Cidade_Cliente ,
    :nome_cidade,
    :Codigo_Cliente    , :CPF_CNPJ                , :Nome_Fantasia ,
    :Razao_Social      , :Regiao_Cliente          ,
    :RG_Insc_Estadual  , :UF                      ,
    :Produto_Ativo     , :Codigo_Produto          , :Codigo_Produto_Sec,
    :Codigo_Marca      , :Nome_Produto            , :Marca_Produto ,
    :Modelo_Produto    ,
    :Tipo_Contrato     , :Nome_Contrato,
    :nome_regiao,
    :nome_tipo_contrato
    do
    begin
        select max(ofc.data_fechamento), max(coalesce(ofc.contador_total,0))
        from ofc_ordem_servico ofc
        where ofc.pessoa_fj = :codigo_cliente and ofc.produto = :codigo_produto
        and ofc.data_fechamento is not null
        and ofc.contador_total > 0
        into :dt_fechamento_ultimo, :contador_ultimo;

        /* CALCULA QUANTIDADE DE COPIAS ATÉ A DATA PREVISTA */
        DIAS                = (:DATA_BASE - coalesce(cast(:DT_FECHAMENTO_ULTIMO as date),CAST('TODAY' AS DATE)));
        QTDE_COPIA_PREVISTA = (DIAS * MEDIA_COPIA);

        /* esse código dará condiçoe de descobrirmos o dia em que o contrato
        atenderá o requisito de cópias para preventiva.. ou o ponto de visita*/
        if (:media_copia = 0) then
          dias = 0;
        else
          dias = (:contrato_copias_preventiva / :media_copia);

        ponto_visita_preventiva = (cast(:dt_fechamento_ultimo as date) + :dias);
        dias_em_atraso = 0;
        if( :ponto_visita_preventiva < cast('today' as date)) then
          dias_em_atraso  = (cast('today' as date) - ponto_visita_preventiva);

        /* calcula quantidade de copias até hoje */
        dias              = (cast('today' as date) - cast(:dt_fechamento_ultimo as date));
        qtde_copia_atual  = (dias * media_copia);

        if (:data_base >= :ponto_visita_preventiva) then
          suspend;
    end
END
^

ALTER PROCEDURE PCD_LST_POSICAO_EST (
    CNPJ VARCHAR(18),
    DATA_BASE DATE,
    CODPRODUTO VARCHAR(15),
    CODGRUPO INTEGER,
    CODSUBGRUPO INTEGER,
    CODMARCA INTEGER,
    CODFORNECEDOR INTEGER,
    CODLOCALIZACAO1 INTEGER,
    CODLOCALIZACAO2 INTEGER,
    CODLOCALIZACAO3 INTEGER,
    CPL CHAR(1))
RETURNS (
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    COD_FORNECEDOR INTEGER,
    FORNECEDOR VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    DATA_MOV DATE,
    ORIGEM VARCHAR(6),
    QTDE_ANT NUMERIC(18,4),
    QTDE NUMERIC(18,4),
    SALDO NUMERIC(18,4),
    TIPO_MOV CHAR(1),
    UND VARCHAR(4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_AQUISICAO NUMERIC(18,4),
    TTL_PRC_CUSTO_MED NUMERIC(18,4),
    TTL_PRC_VENDA NUMERIC(18,4),
    TTL_CUSTO_AQUISICAO NUMERIC(18,4),
    DT_VENCTO_PRC_VENDA DATE,
    LOCALIZACAO_1 INTEGER,
    LOCALIZACAO_2 INTEGER,
    LOCALIZACAO_3 INTEGER,
    LOCALIZACAO_1_NOME VARCHAR(50),
    LOCALIZACAO_2_NOME VARCHAR(50),
    LOCALIZACAO_3_NOME VARCHAR(50))
AS
declare variable codigo integer;
declare variable k_prc_custo_med numeric(18,4);
declare variable k_prc_venda numeric(18,4);
declare variable k_custo_aquisicao numeric(18,4);
begin
  /* */
  for select prd.codigo, prd.nome, prd.unidade, prd.fornecedor, prd.marca, prd.grupo, prd.subgrupo,
      prd.prc_custo_med, prd.prc_venda, prd.custo_aquisicao,
      prd.vencto_prc_venda,
      prd.localizacao_1,
      prd.localizacao_2,
      prd.localizacao_3,
      l1.descricao,
      l2.descricao,
      l3.descricao
      from est_produtos prd
      left join est_localizacao l1 on (l1.codigo = prd.localizacao_1 and l1.cnpj = prd.cnpj)
      left join est_localizacao l2 on (l2.codigo = prd.localizacao_2 and l2.cnpj = prd.cnpj)
      left join est_localizacao l3 on (l3.codigo = prd.localizacao_3  and l3.cnpj = prd.cnpj)
      where prd.cnpj = :cnpj and prd.ativo = 'S'
            and coalesce(prd.servico,'N') = 'N'
            and (prd.codigo = :codproduto or :codproduto = '')
            and (prd.marca = :codmarca or :codmarca = 0)
            and (prd.localizacao_1 = :codlocalizacao1 or :codlocalizacao1 = 0)
            and (prd.localizacao_2 = :codlocalizacao2 or :codlocalizacao2 = 0)
            and (prd.localizacao_3 = :codlocalizacao3 or :codlocalizacao3 = 0)
            and (prd.grupo = :codgrupo or :codgrupo = 0)
            and (prd.subgrupo = :codsubgrupo or :codsubgrupo = 0)
            and (prd.fornecedor = :codfornecedor or :codfornecedor = 0)
      into :produto, :nome_produto, :und, :cod_fornecedor, :cod_marca, :cod_grupo, :cod_subgrupo,
      :PRC_CUSTO_MED, :PRC_VENDA, :CUSTO_AQUISICAO, :dt_vencto_prc_venda,
      :localizacao_1,
      :localizacao_2,
      :localizacao_3,
      localizacao_1_nome,
      localizacao_2_nome,
      localizacao_3_nome
  do
  begin
      if (:cpl = 'N') then
      begin
       PRC_CUSTO_MED = 0;
       PRC_VENDA = 0;
       CUSTO_AQUISICAO = 0;
      end

         
      fornecedor = '<Fornecedor não definido>';
      grupo = '<Grupo não definido>';
      marca = '<Marca não definida>';
      subgrupo = '<SubGrupo não definido>';
      data_mov = null;
      origem = '';
      qtde_ant = 0;
      qtde = 0;
      tipo_mov = '';
      saldo = 0;


      /*fornecedor*/
      select f.nome_razao from glo_pessoas_fj f
      where f.cnpj = :cnpj and f.codigo = :cod_fornecedor
      into :fornecedor;

      /*marca*/
      select m.nome from est_marcas m
      where m.cnpj = :cnpj and m.codigo = :cod_marca
      into :marca;

      /*grupo*/
      select g.nome from est_grupos g
      where g.cnpj = :cnpj and g.codigo = :cod_grupo
      into :grupo;

      /*sub-grupo*/
      select s.nome from est_subgrupos s
      where s.cnpj = :cnpj and s.grupo = :cod_grupo and s.subgrupo = :cod_subgrupo
      into :subgrupo;

      /*estou pegando dt. do movto, mas o correto e a 'dt. kardex'*/
      select max(k.codigo) from est_kardex k
      where k.cnpj = :cnpj and k.produto = :produto and k.dt_movto <= :data_base
      into :codigo;


      select k.dt_movto, k.origem, k.qtdade_ant, k.qtdade, K.tipo_es,
      k.prd_custo_aquisicao, k.prd_prc_venda, k.vdi_custo_med from est_kardex k
      where k.cnpj = :cnpj and k.codigo = :codigo
      into :data_mov, :origem, :qtde_ant, :qtde, :tipo_mov,
      :k_custo_aquisicao, :k_prc_venda, :k_prc_custo_med ;

      /*se houver dados do kardex o procedimento ira pegar deles,
      caso contrario pegará do cadastro de produtos*/
      if (:k_custo_aquisicao is not null) then
        custo_aquisicao = :k_custo_aquisicao;

      if (:k_prc_venda is not null) then
        prc_venda = :k_prc_venda;

      if (:k_prc_custo_med is not null) then
        prc_custo_med = :k_prc_custo_med;



      if (:origem = 'CNT') then
        saldo = :qtde;
      else
      begin
        if (:tipo_mov = 'S') then
           qtde = (:qtde * -1);

        saldo = :qtde_ant + :qtde;
      end

      TTL_PRC_CUSTO_MED = (:prc_custo_med * :saldo);
      TTL_PRC_VENDA = (:prc_venda * :saldo);
      TTL_CUSTO_AQUISICAO = (:custo_aquisicao * :saldo);

      suspend;
  end
END
^

ALTER PROCEDURE PCD_LST_POSICAO_EST2 (
    CNPJ VARCHAR(14),
    DATA_BASE DATE,
    CODPRODUTO VARCHAR(15),
    CODGRUPO INTEGER,
    CODSUBGRUPO INTEGER,
    CODMARCA INTEGER,
    CODFORNECEDOR INTEGER,
    CODLOCALIZACAO1 INTEGER,
    CODLOCALIZACAO2 INTEGER,
    CODLOCALIZACAO3 INTEGER,
    CPL CHAR(1))
RETURNS (
    PRODUTO VARCHAR(15))
AS
begin
  /* */
  for select prd.codigo
      from est_produtos prd
      where prd.cnpj = :cnpj and prd.ativo = 'S'
      into
      :produto
  do
  begin


      suspend;
  end
END
^

ALTER PROCEDURE PCD_LT_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    COD_VENDA INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE DTPERIODO2 DATE;
DECLARE VARIABLE DTPERIODO1 DATE;
DECLARE VARIABLE CONTRATO INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE DESC_ACRESC_CP INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE NOME_CLIENTE VARCHAR(50);
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE SUB_UNIDADE INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE COPIAS_EXCESSO INTEGER;
DECLARE VARIABLE VLR_COPIA_EXCESSO NUMERIC(18,4);
DECLARE VARIABLE TOTAL_COPIAS INTEGER;
DECLARE VARIABLE FRANQUIA INTEGER;
DECLARE VARIABLE VALOR_LEITURA NUMERIC(18,4);
DECLARE VARIABLE VALOR_TOTAL_COPIAS_EXCENTE NUMERIC(18,4);
DECLARE VARIABLE OBSERVACAO BLOB SUB_TYPE 1 SEGMENT SIZE 200 CHARACTER SET ASCII;
DECLARE VARIABLE COMPLEMENTO VARCHAR(100);
DECLARE VARIABLE PERIODO VARCHAR(100);
begin
  select e.pdv_natureza from sis_empresas e
  where e.cnpj = :cnpj
  into :cfop;


  select lt.valor_leitura, lt.data_referencia, psa.codigo, psa.nome_razao, coalesce(lt.copias_excesso,0),
  coalesce(lt.total_copias,0), coalesce(lt.ctr_valor_copia_excedente,0), coalesce(lt.DESC_ACRESC_CP,0), lt.valor_leitura,
  lt.observacao, LT.ctr_franquia, LT.VALOR_TOTAL_COPIAS_EXCENTE, lt.periodo
  from ofc_leituras lt
  inner join ofc_grp_contratos ct on (ct.cnpj = lt.cnpj and ct.codigo = lt.contrato)
  inner join glo_pessoas_fj psa on (psa.cnpj = ct.cnpj and ct.cod_cliente = psa.codigo)
  where lt.cnpj = :cnpj and lt.codigo = :codigo
  into :total, :data, :pessoa_fj, :nome_cliente, :copias_excesso, :total_copias,
  :vlr_copia_excesso, :desc_acresc_cp, :valor_leitura, :observacao, :franquia, :VALOR_TOTAL_COPIAS_EXCENTE, :periodo;

  if (:data is null) then
  begin
    select data from data_servidor into
    :data;
  end

  if (coalesce(:cfop,0) = 0) then
    cfop = 5102;
  /*criando o cabeçalho da venda*/
  cod_venda = gen_id(FAT_VENDAS_GE,1);
  insert into fat_vendas (cnpj, codigo, data, pessoa_fj, nome, usuario, vendedor,natureza,
                         enviada_cx, fechada, cancelada,selecionada,historico,desc_acres,
                         observacao)
                  values (:cnpj, :cod_venda, :data, :pessoa_fj, :nome_cliente,0,1,:cfop,
                        'N','N','N','N', :historico,0 ,(
                        :observacao||' Registro Gerado Automaticamente a partir da Leitura: '||:codigo));



  /*criando os itens da venda
  sequencia = 1;
  for select prd.codigo, prd.nome, 1 , coalesce(cti.valor,0),prd.unidade, prd.subunidade
  from ofc_leituras_itens lti
  inner join ofc_contratos_itens cti on (lti.cnpj = cti.cnpj and lti.cod_item_contrato = cti.codigo)
  inner join est_produtos prd on (prd.cnpj = cti.cnpj and prd.codigo = cti.cod_produto)
  where cti.cnpj = :cnpj and lti.leitura = :codigo and coalesce(cti.valor,0) > 0
  into :produto, :nome_produto,:qtde, :unitario, :unidade, :sub_unidade
  do
  begin
      insert into fat_vendas_itens (cnpj, codigo, produto, nome_produto, sequencia, quantidade,
                                  prc_unitario,icm, ipi, unidade, subunidade)
                         values  (:cnpj, :cod_venda, :produto, :nome_produto ,:sequencia, :qtde,
                                  :unitario, 0, 0,:unidade, :sub_unidade);

      sequencia = sequencia + 1;
  end */

  /*Inserindo valor do contrato*/
  select prd.codigo, prd.nome, prd.unidade, prd.subunidade from est_produtos prd
    where prd.cnpj = :cnpj and prd.codigo = '100.001.1'
    into :produto, :nome_produto, :unidade, :sub_unidade;

  /*segundo alessandra a franquia so e colocada no complmento do item quando tem copia excedente*/
  if (copias_excesso > 0) then
   complemento = '  TOTAL DE '||(:franquia)||' COPIAS';


  insert into fat_vendas_itens (cnpj, codigo, produto, nome_produto, sequencia, quantidade,
                                  prc_unitario,icm, ipi, unidade, subunidade,servico)
                         values  (:cnpj, :cod_venda, :produto, :nome_produto ,:sequencia, 1,
                                  (:valor_leitura - coalesce(:valor_total_copias_excente,0)), 0, 0,:unidade, :sub_unidade, coalesce(:periodo,'')||coalesce(:complemento,''));

  /*inserindo o produto "Cópias excedentes"*/
  if (:copias_excesso > 0) then
  begin
    select prd.codigo, prd.nome, prd.unidade, prd.subunidade from sis_empresas e
    inner join est_produtos prd on (prd.cnpj = e.cnpj and prd.codigo = e.ofc_lt_produto_copias)
    where e.cnpj = :cnpj
    into :produto, :nome_produto, :unidade, :sub_unidade;

    qtde = 1;
    unitario = :VALOR_TOTAL_COPIAS_EXCENTE;
    complemento = '  TOTAL DE '||(coalesce(:copias_excesso,0) + coalesce(:desc_acresc_cp,0))||' COPIAS EM EXCESSO';
    insert into fat_vendas_itens (cnpj, codigo, produto, nome_produto, sequencia, quantidade,
                                  prc_unitario,icm, ipi, unidade, subunidade, SERVICO)
                         values  (:cnpj, :cod_venda, :produto, :nome_produto ,:sequencia, :qtde,
                                  :unitario, 0, 0,:unidade, :sub_unidade, :complemento);
  end

  /*atualizando, "vinculando" a venda com a ordem de serviço*/
  update ofc_leituras lt set lt.venda = :cod_venda, lt.gera_faturamento = 'S'
  where lt.cnpj = :cnpj and lt.codigo = :codigo ;

  suspend;
END
^

ALTER PROCEDURE PCD_MIGRA_CONTRATO_LEITURA (
    CNPJ VARCHAR(14))
RETURNS (
    CONT INTEGER)
AS
DECLARE VARIABLE COD_CLIENTE INTEGER;
DECLARE VARIABLE COD_CONTRATO INTEGER;
DECLARE VARIABLE NUM_CONTRATO VARCHAR(30);
DECLARE VARIABLE DT_INICIO DATE;
DECLARE VARIABLE DT_FIM DATE;
DECLARE VARIABLE ATIVO CHAR(1);
DECLARE VARIABLE INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE VALOR_CONTRATO NUMERIC(18,4);
DECLARE VARIABLE VALOR_COPIA_EXCEDENTE NUMERIC(18,4);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE GERA_FATURAMENTO CHAR(1);
DECLARE VARIABLE GERA_LEITURA CHAR(1);
DECLARE VARIABLE FRANQUIA_COPIAS INTEGER;
DECLARE VARIABLE DIA_BASE INTEGER;
DECLARE VARIABLE EXISTE1 INTEGER;
DECLARE VARIABLE EXISTE2 INTEGER;
DECLARE VARIABLE GERA_MENSALIDADE CHAR(1);
begin
  for select
        COD_CLIENTE ,
        COD_CONTRATO ,
        NUM_CONTRATO ,
        DT_INICIO ,
        DT_FIM  ,
        ATIVO ,
        /*INFORMACOES ,*/
        VALOR_CONTRATO ,
        VALOR_COPIA_EXCEDENTE ,
        DATA  ,
        GERA_FATURAMENTO ,
        GERA_LEITURA ,
        FRANQUIA_COPIAS ,
        DIA_BASE        ,
        GERA_MENSALIDADE,
        ct.cnpj
        from ofc_contratoS ct
        into
        :COD_CLIENTE ,
        :COD_CONTRATO ,
        :NUM_CONTRATO ,
        :DT_INICIO ,
        :DT_FIM  ,
        :ATIVO ,
        /*:INFORMACOES , */
        :VALOR_CONTRATO ,
        :VALOR_COPIA_EXCEDENTE ,
        :DATA  ,
        :GERA_FATURAMENTO ,
        :GERA_LEITURA ,
        :FRANQUIA_COPIAS ,
        :DIA_BASE ,
        :gera_mensalidade,
        :cnpj
  do
  begin
    select count(*) from ofc_grp_contratos gp
    where gp.cod_cliente = :cod_cliente
    into :existe1;

    select count(*) from ofc_grp_contratos_itens gp2
    where gp2.pessoa_fj = :cod_cliente
    into :existe2;

    if ((coalesce(:existe1,0) = 0) and (coalesce(:existe2,0) = 0)) then
    begin
      insert into OFC_GRP_CONTRATOS (CNPJ,
                                     COD_CLIENTE,
                                     COD_CONTRATO,
                                     NUM_CONTRATO,
                                     DT_INICIO,
                                     DT_FIM,
                                     ATIVO,
                                     INFORMACOES,
                                     VALOR_CONTRATO,
                                     VALOR_COPIA_EXCEDENTE,
                                     DATA,
                                     GERA_FATURAMENTO,
                                     GERA_LEITURA,
                                     FRANQUIA_COPIAS,
                                     DIA_BASE,
                                     GERA_MENSALIDADE)
                             values(:CNPJ,
                                     :COD_CLIENTE,
                                     :COD_CONTRATO,
                                     :NUM_CONTRATO,
                                     :DT_INICIO,
                                     :DT_FIM,
                                     :ATIVO,
                                     :INFORMACOES,
                                     :VALOR_CONTRATO,
                                     :VALOR_COPIA_EXCEDENTE,
                                     :DATA,
                                     :GERA_FATURAMENTO,
                                     :GERA_LEITURA,
                                     :FRANQUIA_COPIAS,
                                     :DIA_BASE,
                                     :GERA_MENSALIDADE);


                                     CONT = CONT + 1;

      suspend;
    end


  end

end
^

ALTER PROCEDURE PCD_MS_ESTORNA_FATURAMENTOS (
    CNPJ VARCHAR(14),
    MS_CODIGO INTEGER,
    CODIGO INTEGER)
AS
begin
  execute procedure extorna_venda(:cnpj,:codigo);
  update ofc_mensalidades ms set ms.faturamento = null, ms.selecionado = 'N' where ms.cnpj = :cnpj and ms.codigo = :ms_codigo;
  delete from fat_vendas_parcelamento where cnpj = :cnpj and codigo = :codigo;
  delete from fat_vendas_itens where cnpj = :cnpj and codigo = :codigo;
  delete from fat_vendas where cnpj = :cnpj and codigo = :codigo;
  suspend;
end
^

ALTER PROCEDURE PCD_MS_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    DATA_CX DATE,
    CONTA INTEGER,
    DT_VENCTO DATE)
RETURNS (
    COD_FATURAMENTO INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE NOME_CLIENTE VARCHAR(50);
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE VALOR_MENSALIDADE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE SUB_UNIDADE INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE COPIAS_EXCESSO INTEGER;
DECLARE VARIABLE VLR_COPIA_EXCESSO NUMERIC(18,4);
DECLARE VARIABLE TOTAL_COPIAS INTEGER;
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE FORMA_PAGTO_INTERVALO INTEGER;
begin
  select e.forma_pagto_mensalidade from sis_empresas e
  where e.cnpj = :cnpj
  into :FORMA_PAGTO;


  select ms.valor_mensalidade, ms.data_referencia, psa.codigo, psa.nome_razao, ms.VALOR_MENSALIDADE
  from ofc_mensalidades ms
  inner join ofc_contratos ct on (ct.cnpj = ms.cnpj and ct.codigo = ms.contrato)
  inner join glo_pessoas_fj psa on (psa.cnpj = ct.cnpj and ct.cod_cliente = psa.codigo)
  where ms.cnpj = :cnpj and ms.codigo = :codigo
  into :total, :data, :pessoa_fj, :nome_cliente, :VALOR_MENSALIDADE;

  if (:data is null) then
  begin
    select data from data_servidor into
    :data;
  end
            
  /*criando o cabeçalho da venda*/
  cod_faturamento = gen_id(FAT_VENDAS_GE,1);
  insert into fat_vendas (cnpj, codigo, data, pessoa_fj, nome,vendedor,natureza,
                         enviada_cx, fechada, cancelada,selecionada,historico,total, desc_acres,
                         observacao,
                         usuario,data_caixa,turno,forma_pgto,tipo_venda)
                  values (:cnpj, :cod_faturamento, :data, :pessoa_fj, :nome_cliente,1,5102,
                        'N','N','N','N', ('Registro Gerado Automaticamente a partir do Módulo de Mensalidades: '||:codigo),:valor_mensalidade,0,(
                        'Registro Gerado Automaticamente a partir do Módulo de Mensalidades: '||:codigo),
                        :usuario, :data_cx, :turno,:forma_pagto,'Ven');


  /*criando os itens da venda*/
  sequencia = 1;
  for select prd.codigo, prd.nome, 1 , coalesce(msi.valor,0),prd.unidade, prd.subunidade
  from ofc_mensalidades_itens msi
  inner join ofc_contratos_itens cti on (msi.cnpj = cti.cnpj and msi.cod_item_contrato = cti.codigo)
  inner join est_produtos prd on (prd.cnpj = cti.cnpj and prd.codigo = cti.cod_produto)
  where cti.cnpj = :cnpj and msi.cod_mensalidade = :codigo and coalesce(msi.valor,0) > 0
  into :produto, :nome_produto,:qtde, :unitario, :unidade, :sub_unidade
  do
  begin
      insert into fat_vendas_itens (cnpj, codigo, produto, nome_produto, sequencia, quantidade,
                                  prc_unitario,icm, ipi, unidade, subunidade)
                         values  (:cnpj, :cod_faturamento, :produto, :nome_produto ,:sequencia, :qtde,
                                  :unitario, 0, 0,:unidade, :sub_unidade);

      sequencia = sequencia + 1;
  end

  /*Gerando o parcelamento da venda*/
  insert into  fat_vendas_parcelamento (
                                        CNPJ          ,
                                        CODIGO        ,/*codigo do faturamento*/
                                        VENCTO        ,
                                        PARCELA       ,
                                        VALOR)
                               values(:cnpj,
                                      :cod_faturamento,
                                      :dt_vencto,
                                      '1/1',
                                      :valor_mensalidade);

  /*gerando financeiro*/
  execute procedure ENCERRA_VENDA(:cnpj,:cod_faturamento,:data_cx,:usuario,:conta,:turno,'N');

  /*atualizando, "vinculando" a venda com a ordem de serviço*/
  update ofc_mensalidades ms set ms.faturamento = :cod_faturamento, ms.gera_faturamento = 'S', ms.selecionado = 'N'
  where ms.cnpj = :cnpj and ms.codigo = :codigo ;

  suspend;
END
^

ALTER PROCEDURE PCD_NFE_FATURAMENTOS (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    CODIGO INTEGER,
    NUM_NF INTEGER,
    NUM_CF INTEGER,
    TRP_PLACA VARCHAR(8),
    TRP_UF_PLACA VARCHAR(2),
    CANCELADA CHAR(1),
    TOTAL FLOAT,
    TOTAL_NF FLOAT,
    DESC_ACRESC FLOAT,
    DATA DATE,
    DATA_CX DATE,
    SELECIONADO CHAR(1),
    ID_AGRUPADOR INTEGER,
    CFOP INTEGER,
    NATUREZA VARCHAR(50),
    DEST_CPF_CNPJ VARCHAR(14),
    DEST_CEP VARCHAR(8),
    DEST_LOGRADOURO VARCHAR(100),
    DEST_NUMERO VARCHAR(15),
    DEST_COMPLEMENTO VARCHAR(50),
    DEST_BAIRRO VARCHAR(50),
    DEST_COD_CIDADE INTEGER,
    DEST_CIDADE VARCHAR(50),
    DEST_UF VARCHAR(2),
    DEST_FONE VARCHAR(20),
    DEST_IE VARCHAR(20),
    DEST_RAZAO_SOCIAL VARCHAR(50),
    ICM FLOAT,
    VALOR_ICM_SUBST FLOAT,
    BASE_ICM FLOAT,
    BASE_ICM_SUBST FLOAT,
    SCNPJ VARCHAR(14),
    PSA_CODIGO INTEGER,
    NFE_PROTOCOLO VARCHAR(200),
    NFE_RECIBO VARCHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    AVISTA CHAR(1),
    OUTROS CHAR(1),
    ES CHAR(1),
    NFE_CHAVE VARCHAR(80),
    NFE_AUTORIZADA CHAR(1),
    OBSERVACAO VARCHAR(200),
    PGTO_FRETE CHAR(1),
    TRP_NOME VARCHAR(50),
    TRP_MOTORISTA VARCHAR(50),
    TRP_NUMERO VARCHAR(50),
    TRP_ESPECIE VARCHAR(50),
    TRP_PESO_BRUTO FLOAT,
    TRP_PESO_LIQUIDO FLOAT,
    TRP_QTDE FLOAT,
    TRP_CPF_CNPJ VARCHAR(50),
    TRP_ENDERECO VARCHAR(50),
    TRP_CIDADE2 VARCHAR(50),
    TRP_CIDADE VARCHAR(50),
    TRP_CPF_CNPJ2 VARCHAR(14),
    TRP_UF VARCHAR(2),
    TRP_IE VARCHAR(50),
    MSG_FISCAL BLOB SUB_TYPE 1 SEGMENT SIZE 200)
AS
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE TROCA_PROPRIEDADE CHAR(1);
begin
  scnpj = :cnpj;
  select coalesce(cfg.glo_propriedade_equipamentos,'N') from sis_configuracoes cfg
  where cfg.cnpj = :cnpj
  into :troca_propriedade;

  for select    vd.codigo,
                VD.placa,
                VD.uf_placa,
                substring(vd.observacao from 1 for 200),
                vd.num_cupom,
                vd.num_nf,
                vd.cancelada,
                vd.total,
                vd.total_nota,
                vd.desc_acres,
                vd.data,
                vd.data_caixa,
                coalesce(vd.nfe_selecionado,'N') nfe_selecionado,
                vd.id_agrupador,
                NAT.cfop,
                psa.cpf_cgc ,
                psa.cep ,
                dlgd.nome ,
                psa.numero ,
                psa.complemento ,
                dbr.nome ,
                dcdd.cod_ibge dest_cod_cidade,
                dcdd.nome dest_cidade,
                dcdd.uf dest_uf,
                psa.fone dest_fone,
                psa.rg_ie dest_IE,
                psa.nome_razao,
                vd.propriedade,
                psa.codigo,
                nat.cfop_descricao,
                vd.ICM ,
                vd.VALOR_ICM_SUBST ,
                vd.BASE_ICM ,
                vd.BASE_ICM_SUBST,
                pgt.AVISTA,
                pgt.outros,
                NAT.es,
                vd.nfe_xml,
                vd.nfe_chave,
                vd.nfe_autorizada,
                coalesce(vd.PGTO_FRETE,'1'),
                vd.trp_nome,
                vd.trp_numero,
                vd.trp_especie,
                vd.trp_peso_bruto,
                vd.trp_peso_liquido,
                vd.trp_qtde,
                trp.cpf_cnpj,
                trp.endereco,
                trp.cidade,
                trp.uf,
                trp.ie,
                trp.nome,
                VD.trp_cidade,
                VD.trp_cpf_cnpj,
                nat.msg_fiscal
    from fat_vendas vd
    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
    inner join glo_pessoas_fj psa on (vd.cnpj = psa.cnpj and vd.pessoa_fj = psa.codigo)
    inner join fin_formas_pagto pgt on (vd.cnpj = pgt.cnpj and vd.forma_pgto = pgt.codigo)
    left join glo_transportadoras trp on (trp.cnpj = vd.cnpj and trp.codigo = vd.transportadora)
    left join glo_logradouros dlgd on (psa.endereco = dlgd.codigo and psa.cnpj = dlgd.cnpj)
    left join glo_bairros dbr on (dbr.codigo = psa.bairro and dbr.cnpj = psa.cnpj)
    left join glo_cidades dcdd on (dcdd.codigo = psa.cidade and dcdd.cnpj = psa.cnpj)
    where vd.cnpj = :cnpj /*and vd.fechada = 'S' and vd.enviada_cx = 'S' and vd.es = 'S' */
    and ((vd.codigo = :venda) or (:venda = 0))
    into
    :codigo, :TRP_placa, :TRP_uf_placa, :observacao, :num_cf, :num_nf, :cancelada, :total, :total_nf, :desc_acresc, :data, :data_cx, :selecionado,
    :id_agrupador, :cfop, :dest_cpf_cnpj, :dest_cep, :dest_logradouro, :dest_numero,
    :dest_complemento, :dest_bairro, :dest_cod_cidade, :dest_cidade, :dest_uf, :dest_fone, :dest_ie, :dest_razao_social,
    :propriedade, :psa_codigo, :natureza,
    :ICM ,
    :VALOR_ICM_SUBST,
    :BASE_ICM,
    :BASE_ICM_SUBST,
    :avista,
    :outros,
    :es,
    :nfe_xml,
    :nfe_chave,
    :nfe_autorizada,
    :pgto_frete,
    :trp_motorista ,
    :TRP_NUMERO,
    :TRP_ESPECIE,
    :TRP_PESO_BRUTO,
    :TRP_PESO_LIQUIDO,
    :TRP_QTDE,
    :trp_cpf_cnpj,
    :trp_endereco,
    :trp_cidade,
    :trp_uf,
    :trp_ie,
    :trp_nome,
    :trp_cidade2,
    :trp_cpf_cnpj2,
    :msg_fiscal
    do
    begin
      if (:msg_fiscal is not null) then
         msg_fiscal = :msg_fiscal||'  '||COALESCE(:observacao,0);
      else
        msg_fiscal = COALESCE(:observacao,0);

      if ((:propriedade is not null) and (troca_propriedade = 'N')) then
      begin
        select pp.nome, pp.ie, coalesce(lgd.nome,''),
        br.nome, pp.cep, cdd.nome, cdd.uf, cdd.cod_ibge, pp.numero
        from fat_vendas vd
        inner join glo_propriedades pp on (pp.cnpj = vd.cnpj and pp.propriedade = vd.propriedade and pp.pessoa_fj = vd.pessoa_fj)
        left join glo_logradouros lgd on (lgd.codigo = pp.endereco and lgd.cnpj = pp.cnpj)
        left join glo_bairros br on (br.codigo = pp.bairro and br.cnpj = pp.cnpj)
        left join glo_cidades cdd on (cdd.codigo = pp.cidade and pp.cnpj = cdd.cnpj)
        where vd.cnpj = :cnpj and vd.pessoa_fj = :psa_codigo and vd.codigo = :codigo
        into :dest_complemento, :dest_ie, :dest_logradouro, :dest_bairro, :dest_cep, :dest_cidade, :dest_uf, :dest_cod_cidade, :dest_numero;
      end

      suspend;
    end
end
^

ALTER PROCEDURE PCD_NFE_FATURAMENTOS_ITENS (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    NITEM INTEGER,
    CFOP INTEGER,
    CPROD VARCHAR(15),
    CXPRODUTO VARCHAR(50),
    QCOM FLOAT,
    UCOM VARCHAR(4),
    VPROD FLOAT,
    VUNCOM FLOAT,
    QTRIB FLOAT,
    UTRIB VARCHAR(4),
    VUTRIB FLOAT,
    TRIB_MODALIDADE VARCHAR(50),
    PICMS NUMERIC(18,4),
    VICMS NUMERIC(18,4),
    VBC NUMERIC(18,4),
    PICMS_SUB NUMERIC(18,4),
    VICMS_SUB NUMERIC(18,4),
    VBC_SUB NUMERIC(18,4),
    CST VARCHAR(10),
    CODIGO_NCM VARCHAR(50),
    TRIB_PIS CHAR(2),
    TRIB_COFINS CHAR(2),
    TRIB_IPI CHAR(2),
    CSOSN INTEGER,
    COD_GETIN VARCHAR(15))
AS
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE PSA_CODIGO INTEGER;
DECLARE VARIABLE TROCA_PROPRIEDADE CHAR(1);
DECLARE VARIABLE ALIQUOTA NUMERIC(18,4);
DECLARE VARIABLE ALIQUOTA_PROD NUMERIC(18,4);
DECLARE VARIABLE ICM NUMERIC(18,4);
DECLARE VARIABLE ICM_SUBS NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOICM NUMERIC(18,4);
DECLARE VARIABLE BASECALCULOSUBSTITUICAO NUMERIC(18,4);
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CT INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE UF_VENDA CHAR(2);
DECLARE VARIABLE UF_EMIT CHAR(2);
begin
  NITEM = 0;
  for select
               vdi.cfop,
               VDI.produto,
               substring(coalesce(PRD.nome,1) from 1 for 25)||'-'||substring (coalesce(vdi.complemento,'') from 1 for 24),
               vdi.quantidade,
               vdi.unidade,
               (vdi.prc_unitario * vdi.quantidade),
               vdi.prc_unitario,
               vdi.quantidade,
               vdi.unidade,
               vdi.prc_unitario,
               PRD.TRIB_MODALIDADE,
               VDI.aliquota_icms,
               VDI.ICM,
               VDI.ICM_SUBS,
               VDI.BASECALCULOICM,
               VDI.BASECALCULOSUBSTITUICAO,
               VDI.cte,
               VDI.ctie,
               prd.trib_aliq_est,
               prd.trib_pis,
               prd.trib_cofins,
               prd.trib_ipi,
               PRD.codigo_ncm,
               coalesce(prd.csosn,102),
               prd.COD_GETIN
    from fat_vendas_itens vdi
    inner join est_produtos prd on (prd.cnpj = vdi.cnpj and prd.codigo = vdi.produto)
    where vdi.cnpj = :cnpj and vdi.codigo = :venda
    into
    :cfop,
    :cprod,
    :cxproduto,
    :QCOM,
    :ucom ,
    :vprod,
    :vuncom,
    :qtrib ,
    :utrib,
    :vutrib,
    :trib_modalidade,
    :ALIQUOTA,
    :ICM,
    :ICM_SUBS,
    :BASECALCULOICM,
    :BASECALCULOSUBSTITUICAO,
    :CTE,
    :CTIE,
    :aliquota_prod,
    :trib_pis,
    :trib_cofins,
    :trib_ipi,
    :codigo_ncm,
    :csosn,
    :COD_GETIN
    do
    begin
      NITEM = NITEM + 1;
      if (:aliquota is null) then
        aliquota = :aliquota_prod;

      if (:aliquota is null) then
        aliquota = 17;

      picms_sub = 0;
      vicms_sub = 0;
      vbc_sub = 0;
      picms = 0;
      vicms = 0;
      vbc = 0;

      select  vd.uf from fat_vendas vd
      where vd.cnpj = :cnpj and vd.codigo = :venda
      into :uf_venda;

      select  e.nfe_emit_uf from sis_empresas E
      where e.cnpj = :cnpj
      into :uf_emit;

      if (:uf_emit <> :uf_venda ) then
        ct = :ctie;
      else
        ct = :cte;

      if (:ct = 1) then
        cst = 'cst00';
      else if (:ct = 2) then
        cst = 'cst20';
      else if (:ct = 3) then
        cst = 'cst40'; /*o cst30 é utilizado para o isento mas com cobrança por substituicao*/
      else if (:ct = 5) then /*diferido*/
        cst = 'cst51';
      else if (:ct = 6) then /*icms cobrado anteriormente por subistuicao tributaria */
        cst = 'cst60';

      if (:ct = 6) then
      begin
        picms_sub = :aliquota;
        vicms_sub = :icm_subs;
        vbc_sub = :basecalculosubstituicao;
      end
      else
      begin
        picms = :aliquota;
        vicms = :icm;
        vbc = :basecalculoicm;
      end

      /* (cst00, cst10, cst20, cst30, cst40, cst41, cst50, cst51, cst60, cst70, cst80, cst81, cst90)   */

      /*
        1 - Tributada Integralmente
        2 - Tributada com Redução na Base de Cálculo
        3 - Isento de ICMS
        4 - ICMS não incidência
        5 - Diferido
        6 - Substituição Tributária
        7 - ISS
      */

     suspend;
    end
end
^

ALTER PROCEDURE PCD_NFE_VERIFICA_NUM_NF (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    NUM_NF VARCHAR(20),
    SERIE VARCHAR(3))
RETURNS (
    EXISTE_NF INTEGER,
    EXISTE_XML INTEGER)
AS
DECLARE VARIABLE TAMANHO INTEGER;
DECLARE VARIABLE INICIO INTEGER;
DECLARE VARIABLE NUM_NF_XML INTEGER;
begin
  select * from GETLENGTH(:num_nf)
  into :tamanho;

  if (:tamanho = 1) then
    inicio = 224;
  if (:tamanho = 2) then
    inicio = 223;
  else if (:tamanho = 3) then
    inicio = 222;
  else if (:tamanho = 4) then
    inicio = 221;
  else if (:tamanho = 5) then                                                                                                                     
    inicio = 220;
  else if (:tamanho = 6) then
    inicio = 219;

  existe_xml = 0;
  existe_nf = 0;
  /*---verificando xml--*/
  select max(vd.codigo) from fat_vendas vd
  where vd.cnpj = :cnpj and vd.codigo <> :codigo and coalesce(substring(vd.nfe_xml from :inicio for :tamanho) ,'0') = :num_nf
  and vd.serie = :serie and coalesce(substring(vd.nfe_xml from (:inicio - 1) for 1) ,'0') = '0'
  into :existe_xml;

  /*---verificando num-nf --*/
  select max(vd.codigo) from fat_vendas vd
  where vd.cnpj = :cnpj and vd.codigo <> :codigo and vd.num_nf = :num_nf
  and vd.serie = :serie
  into :existe_nf;

  suspend;
end
^

ALTER PROCEDURE PCD_NFENT_EXPORTA_ITENS_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    PSA_CODIGO INTEGER,
    SERIE CHAR(10),
    DATA_ENTRADA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    BASE_IPI FLOAT,
    IND_TRIB_IPI CHAR(1),
    IND_TRIB_ICMS CHAR(1),
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_PCT_RED_BASE FLOAT,
    PRODUTO_ALIQ_IPI FLOAT,
    DESP_ACESSORIAS FLOAT,
    PRODUTO_ALIQ_ICMS FLOAT,
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_ISS FLOAT,
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    REDUCAO FLOAT,
    CNPJ_EMITENTE VARCHAR(15),
    VLR_ICM_SUBS_ITEM FLOAT)
AS
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE XCTE INTEGER;
DECLARE VARIABLE PERC_ESTADUAL FLOAT;
DECLARE VARIABLE PERC_INTERESTADUAL FLOAT;
DECLARE VARIABLE VLR_PRODUTOS FLOAT;
DECLARE VARIABLE VLR_DESPESAS FLOAT;
DECLARE VARIABLE VLR_ICM_SUBS FLOAT;
DECLARE VARIABLE FRETE_LF CHAR(1);
begin

  select c.ALIQUOTA_ISS from sis_configuracoes c
  where c.cnpj = :cnpj
  into :aliquota_iss;

  for select distinct et.ndocto, et.FRETE_LF, PSA.codigo
      from est_entradas et
      inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
      where et.cnpj = :cnpj and (
                                  (coalesce(et.proc_qtd,'N') = 'S')
                                  or
                                  (coalesce(et.proc_fin,'N') = 'S')
                                  or
                                  (coalesce(et.proc_custo,'N') = 'S')
                                )
                            and (et.data_nf between :data1 and :data2) /*and et.ndocto = '0004774'*/
      into :num_nf, :frete_lf, :psa_codigo

  do
  begin
        if (frete_lf = 'S') then
        begin
            /*Aplicando o frete nas despesas acessorias*/
            select sum(

                            coalesce(et.VLR_EMBALAGEM,0)  +
                            coalesce(et.VLR_SEGURO,0)  +
                            coalesce(et.VLR_FRETE,0)  +
                            coalesce(et.VLR_IPI,0)  +
                            coalesce(et.TAXAS,0)  -
                            coalesce(et.VLR_DESCONTO,0) +
                            coalesce(et.VLR_ICM_SUBS,0)
                           ),
                           sum(et.vlr_produtos),
                           sum(et.vlr_icm_subs)

            from est_entradas et
            where et.cnpj = :cnpj and (et.data_nf between :data1 and :data2) and et.ndocto = :num_nf
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end
        else
        begin
            select
               sum(

                coalesce(et.VLR_EMBALAGEM,0)  +
                coalesce(et.VLR_SEGURO,0)  +
                coalesce(et.VLR_IPI,0)  +
                coalesce(et.TAXAS,0)  -
                coalesce(et.VLR_DESCONTO,0) +
                coalesce(et.VLR_ICM_SUBS,0)
               ),
               sum(et.vlr_produtos), sum(et.vlr_icm_subs)
            from est_entradas et
            where et.cnpj = :cnpj and (et.data_nf between :data1 and :data2) and et.ndocto = :num_nf
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end


      num_item = 0;
      for select et.data_nf, et.serie_nf, coalesce(nat.mov_estoque,'N'), psa.cpf_cgc
          from est_entradas et
          inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
          where et.cnpj = :cnpj and (et.data_nf between :data1 and :data2) and et.ndocto = :num_nf
          into :data_entrada, :serie,  :movimenta_mercadoria, :cnpj_emitente
      do
      begin
          for select eti.produto, eti.cfop, substring(prd.unidade from 1 for 3), prd.cte, prd.ctie,
              eti.quantidade, eti.prc_unitario, eti.descontos, (eti.prc_unitario * eti.quantidade),
              eti.ipi, eti.ipi_produto, prd.nome, prd.nome,
              eti.icm, eti.icm_subs
               from est_entradas_itens eti
              inner join est_produtos prd on (prd.codigo = eti.produto and eti.cnpj = prd.cnpj)
              where eti.cnpj = :cnpj and eti.ndocto = :num_nf
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :aliquota_ipi, :valor_ipi,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            base_icms = 0;
            base_icms_sub = 0;
            base_ipi = 0;
            produto_pct_red_base = 0;
            produto_aliq_ipi = :aliquota_ipi;
            produto_aliq_icms = 17;
            ind_trib_ipi= 'I';
            ind_trib_icms = 'T';

            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
           begin
             sit_trib = '000';
             base_icms = :valor_item;
           end
           else if (:xcte = 2) then
           begin
             sit_trib = '020';

             select r.perc_estadual, r.perc_interestadual from est_reducoes r
             inner join est_produtos prd on (prd.cnpj = r.cnpj and prd.reducao = r.codigo)
             where prd.cnpj = :cnpj and prd.codigo = :cod_produto
             into :perc_estadual, :perc_interestadual;

             if (:psa_uf = 'MS') then
               reducao = :perc_estadual;
             else
               reducao = :perc_interestadual;

             produto_pct_red_base = :reducao;

             base_icms = :valor_item - ((:valor_item * :reducao)/100.00);
           end
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
           begin
             sit_trib = '060';
             base_icms = :valor_item;
           end
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '010';

           if (:aliquota_ipi > 0) then
           begin
             base_ipi = :valor_item;
             ind_trib_ipi= 'T';
           end

           produto_sit_trib = :sit_trib;
           num_item = num_item + 1;
           aliquota_icms = 17;

           desp_acessorias = ((((:valor_item * 100)/:vlr_produtos) * :vlr_despesas)/100);
           vlr_icm_subs_item = ((((:valor_item * 100)/:vlr_produtos) * :vlr_icm_subs)/100);
           suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_NFENT_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_ENTRADA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    BASE_IPI FLOAT,
    IND_TRIB_IPI CHAR(1),
    IND_TRIB_ICMS CHAR(1),
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_PCT_RED_BASE FLOAT,
    PRODUTO_ALIQ_IPI FLOAT,
    DESP_ACESSORIAS FLOAT,
    PRODUTO_ALIQ_ICMS FLOAT,
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_ISS FLOAT,
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    REDUCAO FLOAT,
    CNPJ_EMITENTE VARCHAR(15),
    VLR_ICM_SUBS_ITEM FLOAT)
AS
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE XCTE INTEGER;
DECLARE VARIABLE PERC_ESTADUAL FLOAT;
DECLARE VARIABLE PERC_INTERESTADUAL FLOAT;
DECLARE VARIABLE VLR_PRODUTOS FLOAT;
DECLARE VARIABLE VLR_DESPESAS FLOAT;
DECLARE VARIABLE VLR_ICM_SUBS FLOAT;
DECLARE VARIABLE FRETE_LF CHAR(1);
begin

  select c.ALIQUOTA_ISS from sis_configuracoes c
  where c.cnpj = :cnpj
  into :aliquota_iss;

  for select distinct et.ndocto, et.FRETE_LF, et.pessoa_fj
      from est_entradas et
      inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
      where et.cnpj = :cnpj and (
                                  (coalesce(et.proc_qtd,'N') = 'S')
                                  or
                                  (coalesce(et.proc_fin,'N') = 'S')
                                  or
                                  (coalesce(et.proc_custo,'N') = 'S')
                                )
                            and (et.data_ent between :data1 and :data2) /*and et.ndocto = '0004774'*/
      into :num_nf, :frete_lf, :pessoa_fj

  do
  begin
        if (frete_lf = 'S') then
        begin
            /*Aplicando o frete nas despesas acessorias*/
            select sum(

                            coalesce(et.VLR_EMBALAGEM,0)  +
                            coalesce(et.VLR_SEGURO,0)  +
                            coalesce(et.VLR_FRETE,0)  +
                            coalesce(et.VLR_IPI,0)  +
                            coalesce(et.TAXAS,0)  -
                            coalesce(et.VLR_DESCONTO,0) +
                            coalesce(et.VLR_ICM_SUBS,0)
                           ),
                           sum(et.vlr_produtos),
                           sum(et.vlr_icm_subs)

            from est_entradas et
            where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end
        else
        begin
            select
               sum(

                coalesce(et.VLR_EMBALAGEM,0)  +
                coalesce(et.VLR_SEGURO,0)  +
                coalesce(et.VLR_IPI,0)  +
                coalesce(et.TAXAS,0)  -
                coalesce(et.VLR_DESCONTO,0) +
                coalesce(et.VLR_ICM_SUBS,0)
               ),
               sum(et.vlr_produtos), sum(et.vlr_icm_subs)
            from est_entradas et
            where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end


      num_item = 0;
      for select et.data_ent, et.serie_nf, coalesce(nat.mov_estoque,'N'), psa.cpf_cgc
          from est_entradas et
          inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
          where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
          into :data_entrada, :serie,  :movimenta_mercadoria, :cnpj_emitente
      do
      begin
          for select eti.produto, eti.cfop, substring(prd.unidade from 1 for 3), prd.cte, prd.ctie,
              eti.quantidade, eti.prc_unitario, eti.descontos, (eti.prc_unitario * eti.quantidade),
              eti.ipi_produto, eti.ipi_produto, prd.nome, prd.nome,
              eti.icm, eti.icm_subs
               from est_entradas_itens eti
              inner join est_produtos prd on (prd.codigo = eti.produto and eti.cnpj = prd.cnpj)
              where eti.cnpj = :cnpj and eti.ndocto = :num_nf and eti.pessoa_fj = :pessoa_fj
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :aliquota_ipi, :valor_ipi,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            base_icms = 0;
            base_icms_sub = 0;
            base_ipi = 0;
            produto_pct_red_base = 0;
            produto_aliq_ipi = :aliquota_ipi;
            produto_aliq_icms = 17;
            ind_trib_ipi= 'I';
            ind_trib_icms = 'T';

            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
           begin
             sit_trib = '000';
             base_icms = :valor_item;
           end
           else if (:xcte = 2) then
           begin
             sit_trib = '020';

             select r.perc_estadual, r.perc_interestadual from est_reducoes r
             inner join est_produtos prd on (prd.cnpj = r.cnpj and prd.reducao = r.codigo)
             where prd.cnpj = :cnpj and prd.codigo = :cod_produto
             into :perc_estadual, :perc_interestadual;

             if (:psa_uf = 'MS') then
               reducao = :perc_estadual;
             else
               reducao = :perc_interestadual;

             produto_pct_red_base = :reducao;

             base_icms = :valor_item - ((:valor_item * :reducao)/100.00);
           end
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
           begin
             sit_trib = '060';
             base_icms = :valor_item;
           end
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '010';

           if (:aliquota_ipi > 0) then
           begin
             base_ipi = :valor_item;
             ind_trib_ipi= 'T';
           end

           produto_sit_trib = :sit_trib;
           num_item = num_item + 1;
           aliquota_icms = 17;

           desp_acessorias = ((((:valor_item * 100)/:vlr_produtos) * :vlr_despesas)/100);

           valor_ipi = ((:valor_item)*  ( :aliquota_ipi / 100));

           vlr_icm_subs_item = ((((:valor_item * 100)/:vlr_produtos) * :vlr_icm_subs)/100);

           suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_NFS_EXPORTA_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT)
AS
DECLARE VARIABLE XCFOP VARCHAR(4);
begin
  for select vd.serie, vd.num_nf, max(vd.data_caixa), sum(vd.total_nota), sum(vd.total), sum(vd.base_icm), sum(vd.icm),
             psa.cpf_cgc,psa.uf, vd.pgto_frete,  max(vd.data_caixa), vd.natureza, sum(vd.base_icm_subst),
             sum(vd.valor_icm_subst), case coalesce(vd.cancelada,'N')
                            when 'N' then '0'
                            when 'S' then '1'
                          end, psa.rg_ie, psa.codigo
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and nat.es = 'S'
      group by  vd.serie, vd.num_nf, psa.cpf_cgc,psa.uf, vd.pgto_frete, vd.natureza, vd.cancelada,
      psa.rg_ie, psa.codigo
      into :serie, :num_nf, :data_saida, :valor_contabil, :valor_mercadorias, :base_calculo_icms, :icms_debitado,
      :cliente_cpf_cnpj, :cliente_uf, :tipo_frete,  :data_documento, :cfop, :base_calculo_icms_sub,
      :imposto_retido_icms_sub,:nota_cancelada,:cliente_ie, :psa_codigo
  do
  begin
    /*xcfop = cast(:cfop as varchar(4));
    if ((substring(xcfop from 1 for 2) = '54') or ((substring(xcfop from 1 for 2) = '64'))) then
    begin
      aliquota_icms = 0;
      base_calculo_icms = 0;
      vlr_outros = :valor_contabil;
    end
    else
    begin
      aliquota_icms = 17;
      vlr_outros = 0;
    end
    condicao_venda = '0'; /*a vista*/
    suspend;
  end

end
^

ALTER PROCEDURE PCD_NFS_EXPORTA_ITENS_EXACTUS (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    VLR_OUTROS FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE XCTE INTEGER;
DECLARE VARIABLE DESC_ACRES FLOAT;
DECLARE VARIABLE VD_TOTAL FLOAT;
begin
  for select distinct vd.num_nf
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and nat.es = 'S'
      into :num_nf
  do
  begin
      num_item = 0;
      /*no caso de notas impressas para varios pedidos juntos*/
      select max(vd.data_caixa)
             from fat_vendas vd
             inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
             inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
             where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
      into :data_saida;

      for select vd.codigo, vd.serie, PSA.uf, coalesce(nat.mov_estoque,'N'), vd.desc_acres, vd.total
          from fat_vendas vd
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
          into :cod_venda, :serie, :psa_uf, :movimenta_mercadoria, :desc_acres, :vd_total
      do
      begin

          for select vdi.produto, VDI.cfop, substring(prd.unidade from 1 for 3), vdi.cte, vdi.ctie,
              vdi.quantidade, vdi.prc_unitario,
              ((vdi.desconto /** vdi.quantidade*/) - /*inversão de sinais, por conta do desc negativo*/
              (
               ((((vdi.prc_unitario * vdi.quantidade) * 100)/:vd_total) * :desc_acres)/100)
               /
               vdi.quantidade),
              (vdi.prc_unitario * vdi.quantidade),
              vdi.basecalculoicm, vdi.basecalculosubstituicao,
              prd.nome, prd.nome,
              vdi.icm, vdi.icm_subs


               from fat_vendas_itens vdi
              inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
              where vdi.cnpj = :cnpj and vdi.codigo = :cod_venda
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :base_icms, :base_icms_sub,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            valor_item = (:valor_item - (:desconto * :qtde));
            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
             sit_trib = '010';
           else if (:xcte = 2) then
             sit_trib = '020';
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
             sit_trib = '060';
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '000';

            produto_sit_trib = :sit_trib;
            num_item = num_item + 1;

            if (:xcte = 6) then
            begin
              aliquota_icms = 0;
              vlr_outros = :valor_item;
            end
            else
            begin
              aliquota_icms = 17;
              vlr_outros = 0;
            end
            suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_NFS_EXPORTA_ITENS_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    DATA_SAIDA DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    VLR_OUTROS FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1))
AS
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE XCTE INTEGER;
DECLARE VARIABLE DESC_ACRES FLOAT;
DECLARE VARIABLE VD_TOTAL FLOAT;
begin
  for select distinct vd.num_nf
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and nat.es = 'S'
      into :num_nf
  do
  begin
      num_item = 0;
      /*no caso de notas impressas para varios pedidos juntos*/
      select max(vd.data_caixa)
             from fat_vendas vd
             inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
             inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
             where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
      into :data_saida;

      for select vd.codigo, vd.serie, PSA.uf, coalesce(nat.mov_estoque,'N'), vd.desc_acres, vd.total
          from fat_vendas vd
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
          into :cod_venda, :serie, :psa_uf, :movimenta_mercadoria, :desc_acres, :vd_total
      do
      begin

          for select vdi.produto, VDI.cfop, substring(prd.unidade from 1 for 3), vdi.cte, vdi.ctie,
              vdi.quantidade, vdi.prc_unitario,
              ((vdi.desconto /** vdi.quantidade*/) - /*inversão de sinais, por conta do desc negativo*/
              (
               ((((vdi.prc_unitario * vdi.quantidade) * 100)/:vd_total) * :desc_acres)/100)
               /
               vdi.quantidade),
              (vdi.prc_unitario * vdi.quantidade),
              vdi.basecalculoicm, vdi.basecalculosubstituicao,
              prd.nome, prd.nome,
              vdi.icm, vdi.icm_subs


               from fat_vendas_itens vdi
              inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
              where vdi.cnpj = :cnpj and vdi.codigo = :cod_venda
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :base_icms, :base_icms_sub,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            valor_item = (:valor_item - (:desconto * :qtde));
            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
             sit_trib = '010';
           else if (:xcte = 2) then
             sit_trib = '020';
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
             sit_trib = '060';
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '000';

            produto_sit_trib = :sit_trib;
            num_item = num_item + 1;

            if (:xcte = 6) then
            begin
              aliquota_icms = 0;
              vlr_outros = :valor_item;
            end
            else
            begin
              aliquota_icms = 17;
              vlr_outros = 0;
            end
            suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_NFS_EXPORTA_PROSOFT (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF INTEGER,
    SERIE CHAR(10),
    MODELO VARCHAR(4),
    DATA_SAIDA DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT)
AS
DECLARE VARIABLE XCFOP VARCHAR(4);
begin
  for select vd.serie,
             vd.num_nf,
             max(vd.data_caixa),
             sum(vd.total_nota),
             sum(vd.total),
             sum(vd.base_icm),
             sum(vd.icm),
             psa.cpf_cgc,psa.uf,
             vd.pgto_frete,
             max(vd.data_caixa),
             vd.natureza,
             sum(vd.base_icm_subst),
             sum(vd.valor_icm_subst),
             case coalesce(vd.cancelada,'N')
                            when 'N' then '0'
                            when 'S' then '1'
             end,
             psa.rg_ie,
             psa.codigo,
             d.codigo_fiscal
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      left join sis_serienf s on (s.cnpj = vd.cnpj and s.serie = vd.serie)
      left join glo_tipos_docto d on (d.cnpj = s.cnpj and d.sigla = s.tipo_docto)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and nat.es = 'S'
      group by  vd.serie, vd.num_nf, psa.cpf_cgc,psa.uf, vd.pgto_frete, vd.natureza, vd.cancelada,
      psa.rg_ie, psa.codigo, d.codigo_fiscal
      into :serie,
           :num_nf,
           :data_saida,
           :valor_contabil,
           :valor_mercadorias,
           :base_calculo_icms,
           :icms_debitado,
           :cliente_cpf_cnpj,
           :cliente_uf,
           :tipo_frete,
           :data_documento,
           :cfop,
           :base_calculo_icms_sub,
           :imposto_retido_icms_sub,
           :nota_cancelada,
           :cliente_ie,
           :psa_codigo,
           :modelo
  do
  begin
    xcfop = cast(:cfop as varchar(4));
    if ((substring(xcfop from 1 for 2) = '54') or ((substring(xcfop from 1 for 2) = '64'))) then
    begin
      aliquota_icms = 0;
      base_calculo_icms = 0;
      vlr_outros = :valor_contabil;
    end
    else
    begin
      aliquota_icms = 17;
      vlr_outros = 0;
    end
    condicao_venda = '0'; /*a vista*/
    suspend;
  end

  /*for select et.serie_nf,
             et.ndocto,
             et.data_ent,
             case et.frete_lf
                when 'S' then (
                                coalesce(et.vlr_produtos,0) +
                                coalesce(et.VLR_EMBALAGEM,0)  +
                                coalesce(et.VLR_SEGURO,0)  +
                                coalesce(et.VLR_FRETE,0)  +
                                coalesce(et.VLR_IPI,0)  +
                                coalesce(et.TAXAS,0)  -
                                coalesce(et.VLR_DESCONTO,0) +
                                coalesce(et.VLR_ICM_SUBS,0)
                              )
                else  (
                        coalesce(et.vlr_produtos,0) +
                        coalesce(et.VLR_EMBALAGEM,0)  +
                        coalesce(et.VLR_SEGURO,0)  +
                        coalesce(et.VLR_IPI,0)  +
                        coalesce(et.TAXAS,0)  -
                        coalesce(et.VLR_DESCONTO,0) +
                        coalesce(et.VLR_ICM_SUBS,0)
                      )
             end ,
             et.vlr_produtos,
             et.VLR_BC_ICM,
             et.vlr_icm,
             psa.cpf_cgc,
             psa.uf,
             '0',
             et.data_ent,
             et.natureza,
             et.vlr_bc_icm base_icms_sub,
             et.vlr_icm_subs,
             '0',
             psa.rg_ie,
             psa.codigo,
             et.perc_icm
      from est_entradas et
      inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
      left join GLO_TIPOS_DOCTO tp on (tp.cnpj = et.cnpj and tp.sigla = et.TIPO_DOCTO)
      where et.cnpj = :cnpj and ((coalesce(et.proc_qtd,'N') = 'S')
      or (coalesce(et.proc_fin,'N') = 'S')
      or (coalesce(et.proc_custo,'N') = 'S'))
      and (et.data_ent between :data1 and :data2)
      into :serie,
           :num_nf,
           :data_saida,
           :valor_contabil,
           :valor_mercadorias,
           :base_calculo_icms,
           :icms_debitado,
           :cliente_cpf_cnpj,
           :cliente_uf,
           :tipo_frete,
           :data_documento,
           :cfop,
           :base_calculo_icms_sub,
           :imposto_retido_icms_sub,
           :nota_cancelada,
           :cliente_ie,
           :psa_codigo,
           :aliquota_icms
      do
      begin
         suspend;
      end  */

end
^

ALTER PROCEDURE PCD_OFC_EST_LEITURA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    VENDA INTEGER)
RETURNS (
    COD_FATURAMENTO INTEGER)
AS
DECLARE VARIABLE EXISTE INTEGER;
begin
  select vd.codigo from fat_vendas vd
  where vd.codigo = :venda
  into :cod_faturamento;

  if (:cod_faturamento is null) then
  begin
    update ofc_leituras lt set gera_faturamento = 'N', fechada = 'N', venda = null
    where lt.cnpj = :cnpj and lt.codigo = :codigo;

    cod_faturamento = 0;
  end
  suspend;
END
^

ALTER PROCEDURE PCD_OFC_LEITURA_GERA_ITENS (
    CNPJ VARCHAR(14),
    CONTRATO INTEGER,
    LEITURA INTEGER,
    DATA_REFERENCIA DATE,
    TIPO CHAR(1))
AS
DECLARE VARIABLE OFC_CONTRATO INTEGER;
DECLARE VARIABLE GP_COD_CLIENTE INTEGER;
DECLARE VARIABLE GP_COD_CLIENTE_ITEM INTEGER;
DECLARE VARIABLE XCLIENTE INTEGER;
DECLARE VARIABLE ITEM INTEGER;
DECLARE VARIABLE ULTIMA_LEITURA INTEGER;
DECLARE VARIABLE DT_ULTIMA_LEITURA DATE;
DECLARE VARIABLE COD_ULTIMA_LEITURA INTEGER;
begin
  /*quando o codigo for de grupo empresarial*/
  if (:tipo <> 0) then
  begin
      /*localiznado os clintes vinculados ao grupo empresarial*/
      for select distinct gp.cod_cliente from ofc_grp_contratos gp
          left join ofc_grp_contratos_itens gpi on (gpi.cnpj = gp.cnpj and gp.codigo = gpi.cod_grupo)
          where gp.cnpj = :cnpj
          and gp.codigo = :contrato
          and coalesce(gp.gera_leitura,'S') = 'S' /*se o grupo de contrato gera leitura, por padrão todos geram*/
          and coalesce(gpi.ativo,'S') = 'S'/*se os membros (cad. pessoas) deste grupo estão ativos, por padrão todos são ativos*/
      into :gp_cod_cliente
      do
      begin
         /*localizando os contratos (ATENDIMENTO) destes clientes*/
         for select ct.codigo, CT.cod_cliente from ofc_contratos ct
             where ( (ct.cod_cliente = :gp_cod_cliente))
             and ct.ativo = 'S' /*se o contrato de atendimento está ativo, (não defini como padrao 'S' pois o campo já esta sendo mantido pelos usuarios)*/
             and coalesce(ct.gera_leitura,'S') = 'S'  /*se o contrato de atendimento gera leitura, por padrão todos gerarão leitura*/
             into :OFC_contrato, :xcliente
         do
         begin
             /*Localizando todos os itens do contrato de atendimento*/
             for select cti.codigo from ofc_contratos_itens cti
                 where cti.contrato = :OFC_contrato and cti.cnpj = :cnpj
                 and cti.ativo = 'S' /*se o item do contrato de atendimento esta ativo, (não defini como padrao 'S' pois o campo já esta sendo mantido pelos usuarios)*/
                 and coalesce(cti.gera_leitura,'S') = 'S' /*se o item do contrato de atendimento gera leitura, por padrao todos geram*/
                 into :item
             do
             begin
               if (:item = 929) then
                 item = 929;

               /*pegando a ultima data em que foi realizada a leitura para este item*/
               select max(lt.data_referencia) from ofc_leituras lt
               inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
               where lti.codigo = :item and lt.data_referencia <= :data_referencia
               and lt.codigo < :leitura
               into :dt_ultima_leitura;
            
               /*pegando o ultimo codigo de leitura que tenha sido realizado na ultima data,
               serve no caso de ter havido duas leituras na mesma dada*/
               select max(lt.codigo) from ofc_leituras lt
               inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
               where lt.data_referencia = :dt_ultima_leitura and lti.codigo = :item
               and lt.data_referencia <= :data_referencia and lt.codigo < :leitura
               into :cod_ultima_leitura;
            
               /*pegando efetivamente o valor da leitura*/
               select lti.leitura_atual from ofc_leituras_itens lti
               where lti.leitura = :cod_ultima_leitura
               into :ultima_leitura;
            
               insert into ofc_leituras_itens (cnpj, leitura, cod_item_contrato, ultima_leitura, cod_cliente,TESTE)
               values (:cnpj, :leitura, :item, :ultima_leitura, :xcliente, :ofc_contrato||'-1'||:xcliente);
             end
         end
      end

      /*localiznado os clintes vinculados ao grupo empresarial*/
      for select  gpi.pessoa_fj from ofc_grp_contratos gp
          left join ofc_grp_contratos_itens gpi on (gpi.cnpj = gp.cnpj and gp.codigo = gpi.cod_grupo)
          where gp.cnpj = :cnpj and gp.codigo = :contrato
          and coalesce(gp.gera_leitura,'S') = 'S' /*se o grupo de contrato gera leitura, por padrão todos geram*/
          and coalesce(gpi.ativo,'S') = 'S'/*se os membros (cad. pessoas) deste grupo estão ativos, por padrão todos são ativos*/
      into  :gp_cod_cliente_item
      do
      begin
         /*localizando os contratos (ATENDIMENTO) destes clientes*/
         for select ct.codigo, CT.cod_cliente from ofc_contratos ct
             where ((ct.cod_cliente = :gp_cod_cliente_item) )
             and ct.ativo = 'S' /*se o contrato de atendimento esta ativo, (não defini como padrao 'S' pois o campo já esta sendo mantido pelos usuarios)*/
             and coalesce(ct.gera_leitura,'S') = 'S'  /*se o contrato de atendimento gera leitura, por padrão todos gerarão leitura*/
             into :OFC_contrato, :xcliente
         do
         begin
             /*Localizando todos os itens do contrato de atendimento*/
             for select cti.codigo from ofc_contratos_itens cti
                 where cti.contrato = :OFC_contrato and cti.cnpj = :cnpj
                 and cti.ativo = 'S' /*se o item do contrato de atendimento esta ativo, (não defini como padrao 'S' pois o campo já esta sendo mantido pelos usuarios)*/
                 and coalesce(cti.gera_leitura,'S') = 'S' /*se o item do contrato de atendimento gera leitura, por padrao todos geram*/
                 into :item
             do
             begin
               /*pegando a ultima data em que foi realizada a leitura para este item*/
               select max(lt.data_referencia) from ofc_leituras lt
               inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
               where lti.codigo = :item and lt.data_referencia <= :data_referencia
               and lt.codigo < :leitura
               into :dt_ultima_leitura;
            
               /*pegando o ultimo codigo de leitura que tenha sido realizado na ultima data,
               serve no caso de ter havido duas leituras na mesma dada*/
               select max(lt.codigo) from ofc_leituras lt
               inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
               where lt.data_referencia = :dt_ultima_leitura and lti.codigo = :item
               and lt.data_referencia <= :data_referencia and lt.codigo < :leitura
               into :cod_ultima_leitura;
            
               /*pegando efetivamente o valor da leitura*/
               select lti.leitura_atual from ofc_leituras_itens lti
               where lti.leitura = :cod_ultima_leitura
               into :ultima_leitura;
            
               insert into ofc_leituras_itens (cnpj, leitura, cod_item_contrato, ultima_leitura, cod_cliente,TESTE)
               values (:cnpj, :leitura, :item, :ultima_leitura, :xcliente, :ofc_contrato||'-2'||:xcliente);
             end
         end
      end
  end
  else /*descontinuado*/
  begin
    /*Localizando todos os itens do contrato de atendimento*/
     for select cti.codigo from ofc_contratos_itens cti
         where cti.contrato = :contrato and cti.cnpj = :cnpj and cti.ativo = 'S'
         into :item
     do
     begin
       select ct.cod_cliente from ofc_contratos ct
       where ct.cnpj = :cnpj and ct.codigo = :contrato
       into :xcliente;

       /*pegando a ultima data em que foi realizada a leitura para este item*/
       select max(lt.data_referencia) from ofc_leituras lt
       inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
       where lti.codigo = :item and lt.data_referencia <= :data_referencia
       and lt.codigo < :leitura
       into :dt_ultima_leitura;
    
       /*pegando o ultimo codigo de leitura que tenha sido realizado na ultima data,
       serve no caso de ter havido duas leituras na mesma dada*/
       select max(lt.codigo) from ofc_leituras lt
       inner join ofc_leituras_itens lti on (lti.cnpj = lt.cnpj and lti.leitura = lt.codigo)
       where lt.data_referencia = :dt_ultima_leitura and lti.codigo = :item
       and lt.data_referencia <= :data_referencia and lt.codigo < :leitura
       into :cod_ultima_leitura;
    
       /*pegando efetivamente o valor da leitura*/
       select lti.leitura_atual from ofc_leituras_itens lti
       where lti.leitura = :cod_ultima_leitura
       into :ultima_leitura;
    
       insert into ofc_leituras_itens(cnpj, leitura, cod_item_contrato, ultima_leitura, cod_cliente)
       values (:cnpj, :leitura, :item, :ultima_leitura, :xcliente);
     end
  end
end
^

ALTER PROCEDURE PCD_OFC_LEITURA_UPD_TOTAL (
    CNPJ VARCHAR(14),
    LEITURA INTEGER,
    ITEM_LEITURA INTEGER)
AS
DECLARE VARIABLE FRANQUIA_COPIAS INTEGER;
DECLARE VARIABLE SALDO INTEGER;
DECLARE VARIABLE EXCESSO_COPIAS INTEGER;
DECLARE VARIABLE VALOR_CONTRATO NUMERIC(18,4);
DECLARE VARIABLE VALOR_COPIA_EXCEDENTE NUMERIC(18,4);
DECLARE VARIABLE TOTAL_EXCEDENTE NUMERIC(18,4);
DECLARE VARIABLE VALOR_TOTAL_EXCENTE NUMERIC(15,4);
DECLARE VARIABLE DESC_COPIAS INTEGER;
begin
  select coalesce(lt.ctr_franquia,0), coalesce(lt.ctr_valor,0), coalesce(lt.ctr_valor_copia_excedente,0)
  from ofc_leituras_itens lt
  where lt.codigo = :item_leitura
  into :franquia_copias, :valor_contrato, :valor_copia_excedente;

  select coalesce(sum(lti.saldo_leitura),0) from ofc_leituras_itens lti
  where lti.leitura = :leitura and lti.cnpj = :cnpj
  into :saldo;

  if (:saldo > :franquia_copias) then
  begin
   excesso_copias = coalesce(:saldo,0) - coalesce(:franquia_copias,0);
   valor_total_excente = (coalesce(:excesso_copias,0) * coalesce(:valor_copia_excedente,0));
  end
  else
  begin
   excesso_copias = 0;
   valor_total_excente = 0;
  end

  select coalesce(l.desc_acresc_cp,0) from ofc_leituras l
  where l.cnpj = :cnpj and l.codigo = :leitura
  into :desc_copias;

  total_excedente = ((:excesso_copias + :desc_copias) * :valor_copia_excedente);

  update ofc_leituras lt set lt.VALOR_TOTAL_COPIAS_EXCENTE = :valor_total_excente, lt.total_copias = :saldo, lt.copias_excesso = :excesso_copias, lt.valor_leitura = (:valor_contrato +:total_excedente)
  where lt.codigo = :leitura and lt.cnpj = :cnpj;

  suspend;
END
^

ALTER PROCEDURE PCD_OFC_MEDIA_COPIA (
    CNPJ VARCHAR(14),
    LEITURA INTEGER,
    DATA_REF DATE)
AS
DECLARE VARIABLE ULT_DATA_REF DATE;
DECLARE VARIABLE ULT_LEITURA INTEGER;
DECLARE VARIABLE LEITURA_ATUAL INTEGER;
DECLARE VARIABLE COD_ITEM_CONTRATO INTEGER;
DECLARE VARIABLE MEDIA_DIARIA INTEGER;
DECLARE VARIABLE DIAS FLOAT;
begin
  for select lti.cod_item_contrato, lti.leitura_atual from ofc_leituras_itens lti
      where lti.leitura = :leitura
  into :cod_item_contrato, :leitura_atual
  do
  begin
     /*verificando se existe mais de um registro para este item*/
     select max(lt.data_referencia) from ofc_leituras_itens lti
     inner join ofc_leituras lt on (lt.cnpj = lti.cnpj and lt.codigo = lti.leitura)
     where lt.data_referencia < :data_ref and lti.cod_item_contrato = :cod_item_contrato
     and lt.fechada = 'S'
     into :ult_data_ref;

     select max(lti.leitura_atual) from ofc_leituras_itens lti
     inner join ofc_leituras lt on (lt.cnpj = lti.cnpj and lt.codigo = lti.leitura)
     where lt.data_referencia = :ult_data_ref and lti.cod_item_contrato = :cod_item_contrato
     and lt.fechada = 'S'
     into :ult_leitura;

     if (:leitura_atual > :ult_leitura) then
     begin
       /*media_decimal = ((:leitura_atual - :ult_leitura)/(:data_ref - :ult_data_ref));
       select * from round2(:media_decimal) into :media_diaria;*/
       dias = :data_ref - :ult_data_ref;
       select * from round2((:leitura_atual - :ult_leitura)/(:dias)) into :media_diaria;

       update ofc_contratos_itens cti set cti.media_copias = :media_diaria
       where cti.cnpj = :cnpj and cti.codigo = :cod_item_contrato;
     end
  end
END
^

ALTER PROCEDURE PCD_OFC_MENSALIDADES_GERA_ITENS (
    CNPJ VARCHAR(14),
    CONTRATO INTEGER,
    COD_MENSALIDADE INTEGER,
    DATA_REFERENCIA DATE)
AS
DECLARE VARIABLE ITEM INTEGER;
DECLARE VARIABLE VALOR_ITEM NUMERIC(18,4);
begin
 for select cti.codigo, cti.valor from ofc_contratos_itens cti
     where cti.contrato = :contrato and cti.cnpj = :cnpj and cti.ativo = 'S'
     into :item, :valor_item
 do
 begin
   insert into ofc_mensalidades_itens (cnpj, cod_mensalidade, cod_item_contrato, valor )
   values (:cnpj, :cod_mensalidade, :item, :valor_item);
 end

 suspend;
END
^

ALTER PROCEDURE PCD_OS_GERA_VENDA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    COD_VENDA INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE NOME_CLIENTE VARCHAR(50);
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE SUB_UNIDADE INTEGER;
DECLARE VARIABLE TECNICO INTEGER;
DECLARE VARIABLE PESSOA_VDD INTEGER;
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE SEQUENCIA INTEGER;
DECLARE VARIABLE CREDITO NUMERIC(18,4);
DECLARE VARIABLE DEBITO NUMERIC(18,4);
DECLARE VARIABLE INFORMACOES BLOB SUB_TYPE 0 SEGMENT SIZE 80;
DECLARE VARIABLE OBS_VENDA VARCHAR(200);
begin
  select ofc.total, ofc.data_fechamento, ofc.historico, ofc.data_fechamento, ofc.nome,
  coalesce(ofc.debitos,0), coalesce(ofc.creditos,0), ofc.mecanico, ofc.informacoes
  from ofc_ordem_servico ofc
  where ofc.cnpj = :cnpj and ofc.codigo = :codigo and ofc.pessoa_fj = :pessoa_fj
  into :total, :data, :historico, :data, :nome_cliente, :debito, :credito, :tecnico, :informacoes;

  select max(mec.pessoa_fj) from ofc_mecanicos mec
  where mec.cnpj = :cnpj and mec.codigo = :tecnico
  into :pessoa_vdd;
    
  select max(vdd.codigo) from fat_vendedor vdd
  where vdd.cnpj = :cnpj and vdd.pessoa_fj = :pessoa_vdd
  into :vendedor;

  select e.pdv_natureza from sis_empresas e
  where e.cnpj = :cnpj
  into :cfop;

  select psa.nome_razao from glo_pessoas_fj psa
  where psa.codigo = :pessoa_fj
  into :nome_cliente;

  if (:data is null) then
  begin
    select data from data_servidor into
    :data;
  end


  OBS_VENDA = substring(:informacoes from 1 for 200);
  /*criando o cabeçalho da venda*/
  cod_venda = gen_id(FAT_VENDAS_GE,1);
  /*informacoes = /*'Registro Gerado Automaticamente a partir da OS: '||:codigo||:informacoes; */

  insert into fat_vendas (cnpj, codigo, data, pessoa_fj, nome, usuario, vendedor,natureza,
                         enviada_cx, fechada, cancelada,selecionada,historico,desc_acres,
                         observacao)
                  values (:cnpj, :cod_venda, :data, :pessoa_fj, :nome_cliente,0,:vendedor,:cfop,
                        'N','N','N','N', :historico, (:credito-:debito),(:obs_venda
                        ));



  /*criando os itens da venda*/
  sequencia = 1;
  for select osi.produto, osi.nome, osi.quantidade, osi.unitario, prd.unidade, prd.subunidade, osi.codigo_tecnico
  from ofc_ordem_servico_servico osi
  inner join est_produtos prd on (prd.cnpj = osi.cnpj and prd.codigo = osi.produto)
  where osi.cnpj = :cnpj and osi.codigo = :codigo
  into :produto, :nome_produto,:qtde, :unitario, :unidade, :sub_unidade, :tecnico
  do
  begin
      select max(mec.pessoa_fj) from ofc_mecanicos mec
      where mec.cnpj = :cnpj and mec.codigo = :tecnico
      into :pessoa_vdd;

      select max(vdd.codigo) from fat_vendedor vdd
      where vdd.cnpj = :cnpj and vdd.pessoa_fj = :pessoa_vdd
      into :vendedor;

      insert into fat_vendas_itens (cnpj, codigo, produto, nome_produto, sequencia, quantidade,
                                  prc_unitario,icm, ipi, unidade, subunidade,vendedor)
                         values  (:cnpj, :cod_venda, :produto, :nome_produto ,:sequencia, :qtde,
                                  :unitario, 0, 0,:unidade, :sub_unidade, :vendedor);

      sequencia = sequencia + 1;
  end

  /*atualizando, "vinculando" a venda com a ordem de serviço*/
  update ofc_ordem_servico ofc set ofc.venda = :cod_venda
  where ofc.cnpj = :cnpj and ofc.codigo = :codigo and ofc.pessoa_fj = :pessoa_fj;

  suspend;
END
^

ALTER PROCEDURE PCD_RECIBO_REC (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    REIMPRESSAO CHAR(1))
RETURNS (
    CLI_CODIGO INTEGER,
    CLI_NOME VARCHAR(80),
    CLI_CPF_CNPJ VARCHAR(20),
    VLR_BAIXA NUMERIC(18,4),
    RECIBO INTEGER,
    REC_CODIGO INTEGER,
    REC_PARCELA VARCHAR(6),
    REC_VLR_BAIXA NUMERIC(18,4),
    REC_SALDO NUMERIC(18,4),
    REC_JUROS NUMERIC(18,4),
    REC_MULTA NUMERIC(18,4),
    REC_VALOR_NOMINAL NUMERIC(18,4),
    REC_BX_PARCIAL NUMERIC(18,4),
    REC_SALDO_NOMINAL NUMERIC(18,4),
    REC_DESCONTOS NUMERIC(18,4),
    REC_DOCTO VARCHAR(20),
    REC_HISTORICO VARCHAR(100),
    BX_HISTORICO VARCHAR(100),
    REC_VENDA INTEGER,
    REC_DT_LANCTO DATE,
    EP_NOME VARCHAR(50),
    EP_ENDERECO VARCHAR(100),
    EP_BAIRRO VARCHAR(50),
    EP_CIDADE VARCHAR(50),
    EP_FONE VARCHAR(20),
    EP_FAX VARCHAR(20),
    EP_CNPJ VARCHAR(20),
    TIPO_BAIXA VARCHAR(50),
    IMPRESSAO VARCHAR(50),
    NUM_NF INTEGER)
AS
DECLARE VARIABLE TX_JUROS_APOS FLOAT;
DECLARE VARIABLE TX_JUROS_ATE FLOAT;
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE TOLERANCIA_JUROS INTEGER;
DECLARE VARIABLE MULTA_FINANCEIRA FLOAT;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE DT_EMISSAO DATE;
DECLARE VARIABLE DT_VENCTO DATE;
DECLARE VARIABLE DT_LANCTO DATE;
DECLARE VARIABLE DATA_ULT_BX DATE;
DECLARE VARIABLE LOCAL_COBRANCA INTEGER;
DECLARE VARIABLE TP_PESSOA CHAR(1);
DECLARE VARIABLE INTEGRAL CHAR(1);
begin
  select rb.valor, rb.codigo, coalesce(rb.integral,'N') from fin_recibos rb
  where rb.cnpj = :cnpj and rb.planilha = :codigo
  into :vlr_baixa, :recibo, :integral;

  /*Dados da Empresa*/
  select EP.NOME, EP.ENDERECO, EP.bairro, (coalesce(EP.CIDADE,'')||'-'||coalesce(EP.uf,'')), EP.FONE,
  ep.fax from sis_empresas ep
  where ep.cnpj = :cnpj
  into :ep_nome, :ep_endereco, :ep_bairro, :ep_cidade, :ep_fone,
  :ep_fax;

  EP_CNPJ = substring(:cnpj from 1 for 2)||'.'||substring(:cnpj from 3 for 3)||'.'||substring(:cnpj from 6 for 3)||'/'||substring(:cnpj from 9 for 4)||'-'||substring(:cnpj from 13 for 2);

  if (coalesce(:integral,'S') = 'S') then
    tipo_baixa = '( Baixa Integral )';
  else  
    tipo_baixa = '( Baixa Parcial )';

  if (coalesce(reimpressao,'N') = 'N') then
    impressao = '1º Impressão';
  else
    impressao = 'Reimpressão';

  for select psa.codigo, coalesce(psa.nome_razao,''), rec.codigo, rec.parcela,
      rec.dt_emissao, rec.dt_vencto, rec.dt_lancto, coalesce(rec.valor,0), coalesce(rec.vlr_parcial,0),
      rec.historico_bx, rec.historico,  rec.codigo_vn, coalesce(rec.local_cobranca,0), psa.cpf_cgc,
      rec.dt_lancto, psa.pessoa, rec.juros, rec.descontos, rec.vlr_baixa, rec.docto, vd.num_nf
      from fin_baixas_receber rec
      inner join glo_pessoas_fj psa on (rec.pessoa_fj = psa.codigo and psa.cnpj = rec.cnpj)
      left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
      left join fat_vendas vd on (vd.codigo = rec.codigo_vn and vd.cnpj = rec.cnpj and vd.pessoa_fj = rec.pessoa_fj)
      left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
      where rec.cnpj = :cnpj and ((rec.planilha = :codigo) or (:codigo = 0))
      into :cli_codigo, :cli_nome, :rec_codigo, :REC_parcela,
      :DT_EMISSAO, :DT_VENCTO, :DT_LANCTO, :REC_VALOR_NOMINAL, :REC_BX_PARCIAL,
      :bx_historico, :rec_historico, :rec_venda, :local_cobranca, :cli_cpf_cnpj,
      :rec_dt_lancto, :tp_pessoa, :rec_juros, :rec_descontos, :rec_vlr_baixa, :rec_docto, :num_nf
  do
  begin

  if (:tp_pessoa = 'J') then
    cli_cpf_cnpj = substring(:cli_cpf_cnpj from 1 for 2)||'.'||substring(:cli_cpf_cnpj from 3 for 3)||'.'||substring(:cli_cpf_cnpj from 6 for 3)||'/'||substring(:cli_cpf_cnpj from 9 for 4)||'-'||substring(:cli_cpf_cnpj from 13 for 2);
  else
    cli_cpf_cnpj = substring(:cli_cpf_cnpj from 1 for 3)||'.'||substring(:cli_cpf_cnpj from 4 for 3)||'.'||substring(:cli_cpf_cnpj from 7 for 3)||'-'||substring(:cli_cpf_cnpj from 10 for 2);

    rec_saldo_nominal = :rec_valor_nominal - :rec_vlr_baixa;
    data = :dt_vencto;

    if (:data_ult_bx > :dt_vencto) then
        data = :data_ult_bx;
  
    /*select p.saldo, p.juros, p.multa
    from pcd_sub_rel_receber(:cnpj,:cli_codigo,:rec_codigo,:dt_cx,:tipo_juros,:tx_juros_ate,:tx_juros_apos,:tolerancia_juros,:multa_financeira,:cidade,:rec_venda,:data,:REC_SALDO_NOMINAL,:local_cobranca) p
    into :rec_saldo, :rec_juros, :rec_multa;*/
  
  
    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_AUX_CONTAGEM_ESTOQUE (
    CNPJ VARCHAR(18),
    IDMARCA INTEGER,
    IDGRUPO INTEGER,
    IDSUBGRUPO INTEGER,
    ATIVO CHAR(1))
RETURNS (
    PRD_ATIVO CHAR(1),
    PRD_CNPJ CHAR(14),
    PRD_CODIGO VARCHAR(15),
    PRD_CODIGO_2 VARCHAR(15),
    PRD_EST_MAX NUMERIC(18,4),
    PRD_EST_MIN NUMERIC(18,4),
    PRD_GRUPO INTEGER,
    PRD_LOCALIZACAO_1 VARCHAR(30),
    PRD_LOCALIZACAO_2 VARCHAR(30),
    PRD_LOCALIZACAO_3 VARCHAR(30),
    PRD_MARCA INTEGER,
    PRD_NOME VARCHAR(50),
    PRD_POSSUI_LOTE CHAR(1),
    PRD_QTDADE_1 NUMERIC(18,4),
    PRD_QTDADE_2 NUMERIC(18,4),
    PRD_QTDADE_MAX NUMERIC(18,4),
    PRD_QTDADE_MIN NUMERIC(18,4),
    PRD_SUBGRUPO INTEGER,
    PRD_SUBUNIDADE INTEGER,
    PRD_UNIDADE CHAR(4),
    GRP_NOME VARCHAR(50),
    SGRP_NOME VARCHAR(50),
    LOTE_LOTE VARCHAR(10),
    LOTE_VALIDADE TIMESTAMP)
AS
BEGIN
  /* Procedure Text */
  FOR
  SELECT prd.ativo, prd.cnpj, prd.codigo, prd.codigo_2, prd.est_max, prd.est_min,
  prd.grupo, prd.localizacao_1, prd.localizacao_2, prd.localizacao_3, prd.marca,
  prd.nome, prd.possui_lote, prd.qtdade_1, prd.qtdade_2, prd.qtdade_max, prd.qtdade_min,
  prd.subgrupo, prd.subunidade, prd.unidade
  FROM est_produtos prd
  WHERE (prd.cnpj = :CNPJ) and
  (prd.marca = :IDMARCA OR 0 = :IDMARCA) AND (COALESCE(prd.ativo,'N') = COALESCE(:ATIVO,'N'))AND
  (prd.grupo = :IDGRUPO OR 0 = :IDGRUPO) AND (prd.subgrupo = :IDSUBGRUPO OR 0 = :IDSUBGRUPO)
  INTO
  :prd_ativo,    :prd_cnpj,          :prd_codigo,        :prd_codigo_2,      :prd_est_max,    :prd_est_min,
  :prd_grupo,    :prd_localizacao_1, :prd_localizacao_2, :prd_localizacao_3, :prd_marca,
  :prd_nome,     :prd_possui_lote,   :prd_qtdade_1,      :prd_qtdade_2,      :prd_qtdade_max, :prd_qtdade_min,
  :prd_subgrupo, :prd_subunidade,    :prd_unidade
  DO BEGIN

    /* Aloca Nome do Grupo */
    select grp.nome from est_grupos grp where grp.codigo = :prd_grupo
    into :grp_nome;

    /* Aloca Nome do Sub-Grupo */
    select sgrp.nome from est_subgrupos sgrp where sgrp.subgrupo = :prd_subgrupo
    into :sgrp_nome;
    
    /*
    Pensar certinho sobre o lote do produto.
    Tem que relacionar todos os lotes do produto e sair somente
    os lotes que não foram vendas, caso possuir venda deverá
    verificar se não houve devolução.
      */
/*    for select lote.lote, lote.validade from est_lote_produto lote where lote.produto = :prd_codigo
    into :lote_lote, :lote_validade;
*/
  SUSPEND;
  END
END
^

ALTER PROCEDURE PCD_REL_COM_COBRADOR (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    CODIGO INTEGER,
    COD_COBRADOR INTEGER,
    COBRADOR VARCHAR(50),
    CLIENTE VARCHAR(75),
    COD_DOCTO INTEGER,
    VLR_NOMINAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    VLR_JUROS NUMERIC(18,4),
    VLR_DESCONTOS NUMERIC(18,4),
    DT_VENCTO DATE,
    DT_PAGTO DATE,
    ATRASO INTEGER,
    HR_COB TIME,
    DATA_COB DATE)
AS
DECLARE VARIABLE CODIGO_REC INTEGER;
DECLARE VARIABLE COD_CLIENTE INTEGER;
begin
  /*Relatório de Comissões por Cobrador*/
  for select bx.codigo, bx.codigo_cr, bx.codigo_vn, bx.vlr_baixa,
      bx.valor, bx.juros, bx.descontos, coalesce(bx.pessoa_fj,'')||'-'||coalesce(psa.nome_razao,''),
      bx.dt_vencto, bx.dt_baixa, bx.pessoa_fj
      from fin_baixas_receber bx
      inner join glo_pessoas_fj psa on (psa.cnpj = bx.cnpj and psa.codigo = bx.pessoa_fj)
      where (bx.dt_baixa between :data1 and :data2) and bx.cnpj = :cnpj
      into :codigo, :codigo_rec, :cod_docto, :vlr_baixa,
      :vlr_nominal, :vlr_juros, :vlr_descontos, :cliente,
      :dt_vencto, :dt_pagto, :cod_cliente
  do
  begin
      cod_cobrador = null;
      cobrador = null;
      /*pegando a ultima data de cobrança da da conta a receber*/
      select max(cbr.data_cobranca) from fin_cobrancas cbr
      where cbr.receber = :codigo_rec and cbr.cnpj = :cnpj and cbr.pessoa_fj = :cod_cliente
      into :data_cob;

      /*pegando a ultima hora de cobrança da conta a receber*/
      select max(cbr.hr_cobranca) from fin_cobrancas cbr
      where cbr.receber = :codigo_rec and cbr.cnpj = :cnpj
      and cbr.pessoa_fj = :cod_cliente and cbr.data_cobranca = :data_cob
      into :hr_cob;

      /*encontrando o ultimo cobrador*/
      select cbr.cobrador from fin_cobrancas cbr
      where cbr.receber = :codigo_rec and cbr.cnpj = :cnpj
      and cbr.pessoa_fj = :cod_cliente and cbr.data_cobranca = :data_cob
      and cbr.hr_cobranca = :hr_cob
      into :cod_cobrador;

      /*nome do cobrador*/
      select cb.nome from fin_cobrador cb
      where cb.codigo = :cod_cobrador and cb.cnpj = :cnpj
      into :cobrador;

      atraso = (:dt_pagto - :dt_vencto);

      if (:atraso < 0) then
         atraso = 0;

      if (:cobrador is not null) then
         suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_COMISSAO (
    CNPJ VARCHAR(14),
    QUITADO CHAR(1))
RETURNS (
    CM_CNPJ VARCHAR(14),
    CM_CODIGO INTEGER,
    CM_COD_VENDA INTEGER,
    CM_COD_VENDEDOR INTEGER,
    CMP_COD_RECEBER INTEGER,
    CMP_PARC_CR VARCHAR(6),
    CMP_PCT_LIBERADO NUMERIC(18,4),
    CMP_PCT_PAGO NUMERIC(18,4),
    CMP_PCT_VLR_TOTAL NUMERIC(18,4),
    VD_DATA DATE,
    VD_DT_CX DATE,
    VD_TOTAL NUMERIC(18,4),
    VD_ENTRADA NUMERIC(18,4),
    VD_DESC_ACRESC NUMERIC(18,4),
    VD_TOTAL_LIQ NUMERIC(18,4),
    VD_COD_PAGTO INTEGER,
    VD_COD_CLIENTE INTEGER,
    VD_CLIENTE VARCHAR(50),
    VD_FORMA_PAGTO VARCHAR(80),
    VDI_QTDE NUMERIC(18,4),
    VDI_PRC_UNITARIO NUMERIC(18,4),
    VDI_DESCONTO NUMERIC(18,4),
    VDI_CUSTO NUMERIC(18,4),
    VDI_TTL_ITEM NUMERIC(18,4),
    PRD_CODIGO VARCHAR(15),
    PRD_NOME VARCHAR(50),
    VDD_NOME VARCHAR(50),
    PRD_COD_NOME VARCHAR(80))
AS
begin
  cm_cnpj = :cnpj;
  /* Relatorio de comissão por vendedor*/
  for select cm.codigo, cm.cod_venda, cm.cod_vendedor,
      cmp.cod_receber, cmp.parc_cr, cmp.pct_liberado, cmp.pct_pago, cmp.vlr_total
      from cm_comissao cm
      inner join cm_comissao_parc cmp on (cmp.cnpj = cm.cnpj and cm.codigo = cmp.cod_comissao)
      where cm.cnpj = :cnpj
      into :cm_codigo, :cm_cod_venda, :cm_cod_vendedor, :cmp_cod_receber, :cmp_parc_cr, :cmp_pct_liberado,
      :cmp_pct_pago, :cmp_pct_vlr_total
  do
  begin
     /*somente o nome do vendedor and coalesce(cm.quitado,'N') = :quitado */
     select vdd.nome from fat_vendedor vdd
     where vdd.codigo = :cm_cod_vendedor and vdd.cnpj = :cnpj
     into :vdd_nome;

     /*------------------------------------------Dados da venda-----------------------------------------------*/
     for select vd.data, vd.data_caixa, coalesce(vd.total,0), coalesce(vd.desc_acres,0),
         (coalesce(vd.total,0) + coalesce(vd.desc_acres,0)), vd.forma_pgto, pgt.nome,
         coalesce(vdi.quantidade,0), coalesce(vdi.prc_unitario,0), coalesce(vdi.prc_custo,0), coalesce(vdi.desconto,0),
         (coalesce(vdi.quantidade,0) * (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0))),
         coalesce(vdi.produto,''), coalesce(prd.nome,''), vd.pessoa_fj, psa.nome_razao, vd.entrada
         from fat_vendas vd
         inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and vd.cnpj = psa.cnpj)
         inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vdi.codigo = vd.codigo)
         inner join est_produtos prd on (prd.cnpj = vdi.cnpj and vdi.produto = prd.codigo)
         inner join fin_formas_pagto pgt on (vd.cnpj = pgt.cnpj and pgt.codigo = vd.forma_pgto)
         where vd.codigo = :cm_cod_venda
         into :vd_data, :vd_dt_cx, :vd_total, :vd_desc_acresc,
              :vd_total_liq, :vd_cod_pagto, :vd_forma_pagto,
              :vdi_qtde, :vdi_prc_unitario, :vdi_custo, :vdi_desconto,
              :vdi_ttl_item,
              :prd_codigo, :prd_nome, :vd_cod_cliente, :vd_cliente, :VD_ENTRADA
    do
    begin
      prd_cod_nome = (:prd_codigo||'-'||:prd_nome);
      suspend;
    end
  end
END
^

ALTER PROCEDURE PCD_REL_COMISSAO_REC (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    VD_CODIGO INTEGER,
    DATA DATE,
    VD_DT_CAIXA DATE,
    PESSOA_FJ INTEGER,
    CLIENTE VARCHAR(55),
    DOCTO VARCHAR(15),
    TOTAL NUMERIC(18,4),
    COD_REC INTEGER,
    COD_ORIGEM INTEGER,
    ORIGEM VARCHAR(10),
    LIQUIDO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VLR_COMISSAO NUMERIC(18,4),
    VLR_BX_ORIG NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    PCT_BAIXA NUMERIC(18,4),
    NUM_NF INTEGER,
    TIPO CHAR(1))
AS
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE PCT_REP_DEV NUMERIC(18,4);
DECLARE VARIABLE FAT_DEV_VALOR NUMERIC(18,4);
DECLARE VARIABLE FAT_VED_VALOR NUMERIC(18,4);
DECLARE VARIABLE FAT_VD INTEGER;
DECLARE VARIABLE FAT_DEV INTEGER;
DECLARE VARIABLE FAT_PSA INTEGER;
DECLARE VARIABLE PCT_CM_LIB_VISTA NUMERIC(18,4);
DECLARE VARIABLE PCT_CM_LIB_PRAZO NUMERIC(18,4);
begin
  /*Parte do relatorio de comissões de vendedor por recebimento*/
  /*######################## Recebidas - Vendas ##########################*/
   select coalesce(e.cm_lib_pct_vd_prazo,0), coalesce(e.cm_lib_pct_vd_vista,0) from sis_empresas e
   where e.cnpj = :cnpj
   into :pct_cm_lib_prazo, :pct_cm_lib_vista;

  /*DT-LANCTO é efetivamente a data da baixa enquando que a DT-BAIXA é a data do caixa */
  for select bx.codigo, bx.dt_baixa , psa.nome_razao,
             bx.vlr_baixa, bx.codigo_cr, bx.codigo_vn,
             'Rec/Venda',bx.juros, bx.descontos,
             (coalesce(bx.vlr_baixa,0) - coalesce(bx.juros,0) + coalesce(bx.descontos,0)),
             vd.num_nf, VD.pct_comissao, bx.valor, vd.pessoa_fj, vd.codigo, (vd.total + vd.desc_acres)
  from fin_baixas_receber bx
  inner join fat_vendas vd on (bx.codigo_vn = vd.codigo and bx.pessoa_fj = vd.pessoa_fj and bx.cnpj = vd.cnpj)
  inner join glo_pessoas_fj psa on (bx.pessoa_fj = psa.codigo and bx.cnpj = psa.cnpj)
  where vd.cnpj = :cnpj and vd.fechada = 'S' and vd.enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((vd.cancelada <> 'S') or (vd.cancelada is null)) /*e que não estiverem canceladas*/
  and vd.vendedor = :vendedor and (bx.dt_baixa between :data_ini and :data_fin)
  into :codigo, :data, :cliente, :total, :cod_rec, :cod_origem, :origem,:juros, :desconto, :liquido,
  :num_nf, :porcentagem, :valor, :fat_psa, :fat_vd, :fat_ved_valor
  do
  begin
   /*totalizando as devoluções para debitar da comissão que foram feitas antes da data de baixa
   do contas à receber*/
   select sum(vd.total + vd.desc_acres) from fat_vendas vd
   inner join est_natureza nat on (nat.codigo = vd.natureza and vd.cnpj = nat.cnpj)
   where vd.id_agrupador = :fat_vd and vd.pessoa_fj = :fat_psa
   and nat.gera_financeiro = 'S' and nat.devolucao = 'S' and nat.es = 'E'
   and vd.fechada = 'S' and VD.enviada_cx = 'S' and coalesce(vd.cancelada,'N') = 'N'
   into :fat_dev_valor;

   if (:fat_dev_valor > 0) then
     tipo = 'R'; /*Reduzida*/
   else
     tipo = 'I'; /*Integral*/

   /*total de devoluções*/
   fat_dev_valor = coalesce(:fat_dev_valor,0);

   /*descobrindo quanto que as devoluções representam no total do faturamento, provavelmente
   deve deverá ser um valor inferior ao valor de vendas, inferior a 100*/
   pct_rep_dev = ((fat_dev_valor)/fat_ved_valor);

   /*Percentual da baixa a ser considerada para comissão*/
   pct_baixa = (1 - coalesce(pct_rep_dev,0));

   /*arredondando pra duas casas
   select sai from round2(:pct_rep_dev)
   into :pct_rep_dev; */
   vlr_bx_orig = :total;
   if (:total <= :valor) then
   begin
     /*aplicando o valor da redução, pois :pct_rep_dev é inferior a 1*/
     if (:pct_rep_dev > 0) then
       total = :total * :pct_baixa;

     vlr_comissao = (:total * :porcentagem)/100.00;
   end
   else
   begin
      /*aplicando o valor da redução, pois :pct_rep_dev é inferior a 1*/
     if (:pct_rep_dev > 0) then
        valor = :valor * :pct_baixa;

     vlr_comissao = (:valor * :porcentagem)/100.00;
   end

   /*se existe comissão liberada de venda a prazo esta deverá ser debitada do recebimento*/
   if (:pct_cm_lib_prazo > 0) then
     vlr_comissao = ((:vlr_comissao * (100 - :pct_cm_lib_prazo))/100);

   pct_baixa = :pct_baixa * 100;

   suspend;
  end


 /*######################## Recebidas - Trocas ##########################*/
  for select bx.codigo, bx.dt_baixa, psa.nome_razao,
             bx.vlr_baixa, bx.codigo_cr, bx.codigo_trc,
             'Rec/Troca',bx.juros, bx.descontos,
             (coalesce(bx.vlr_baixa,0) - coalesce(bx.juros,0) + coalesce(bx.descontos,0)) from
  fin_baixas_receber bx
  inner join fat_trocas trc on (bx.codigo_trc = trc.codigo and bx.pessoa_fj = trc.pessoa_fj and bx.cnpj = trc.cnpj)
  inner join glo_pessoas_fj psa on (bx.pessoa_fj = psa.codigo and bx.cnpj = psa.cnpj)
  where trc.cnpj = :cnpj and trc.fechado = 'S' and trc.enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and (coalesce(trc.cancelada,'') <> 'S')/*e que não estiverem canceladas*/
  and trc.vendedor = :vendedor and (bx.dt_baixa between :data_ini and :data_fin)
  into :codigo, :data, :cliente, :total, :cod_rec, :cod_origem, :origem
  ,:juros, :desconto, :liquido
  do
  begin
    vlr_bx_orig = :total;
    tipo = 'I';
    pct_baixa = 0    ;
    suspend;  
  end
END
^

ALTER PROCEDURE PCD_REL_COMISSAO_TRC (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    CLIENTE VARCHAR(50),
    PESSOA_FJ INTEGER,
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    TIPO_MOV CHAR(10),
    LIQUIDO NUMERIC(18,4),
    PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE PGTO_AVISTA CHAR(1);
begin
  /*Procedimento utilizado para alimentar o relatorio de Comissão de Vendedores por Recebimentos
  este pesquisa especificamente em trocas e pega os valores de trocas faturadas a vista e
  entradas das que foram parceladas*/
  for select trc.codigo, trc.data_caixa, trc.pessoa_fj, coalesce(trc.total,0),
    coalesce(trc.desc_acresc,0),coalesce(trc.total_2,0),coalesce(trc.desc_acresc_2,0),
    coalesce(trc.entrada,0),coalesce(trc.dinheiro,0),coalesce(trc.cheque,0), coalesce(trc.cartao,0),
    coalesce(trc.ticket,0), trc.pgto_avista
    from fat_trocas trc
    where trc.cnpj = :cnpj and trc.fechado = 'S' and trc.enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
    and ((trc.cancelada <> 'S') or (trc.cancelada is null)) /*e que não estiverem canceladas*/
    and trc.vendedor = :vendedor and (trc.data_caixa between :data_ini and :data_fin)
    into :codigo, :data, :pessoa_fj, :total, :desc_acresc, :total_2,
    :desc_acresc_2, :entrada, :dinheiro, :cheque, :cartao, :ticket, :pgto_avista
  do
  begin

    /*desconto acrescimo ja vem negativo se for desconto por isso somo*/
    liquido = (:total_2 + :desc_acresc_2) - (:total + :desc_acresc);

    vista = :dinheiro + :cartao + :cheque + :ticket;
    prazo = :liquido - :vista;

    if (:pgto_avista = 'S') then
      tipo_mov = 'Vista';
    else
      tipo_mov = 'Prazo';

    select coalesce(nome_razao,'') from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :cliente;

    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_COMISSAO_VED (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    CLIENTE VARCHAR(55),
    NATUREZA INTEGER,
    DOCTO VARCHAR(15),
    TOTAL NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    VISTA NUMERIC(18,4),
    FORM_PAGTO INTEGER,
    PRAZO NUMERIC(18,4),
    VLR_COMISSAO NUMERIC(18,4),
    TIPO_MOV VARCHAR(10),
    TIPO_FAT VARCHAR(10),
    ID_AGRUPADOR INTEGER)
AS
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE PCT_CM_LIB_VISTA NUMERIC(18,4);
DECLARE VARIABLE PCT_CM_LIB_PRAZO NUMERIC(18,4);
DECLARE VARIABLE TIPO_VENDA CHAR(3);
begin
  select coalesce(e.cm_lib_pct_vd_prazo,0), coalesce(e.cm_lib_pct_vd_vista,0) from sis_empresas e
  where e.cnpj = :cnpj
  into :pct_cm_lib_prazo, :pct_cm_lib_vista;
  /*Procedimento para para calcular as comissões dos vendedores por recebimento*/
  /*##########################  procurando em vendas #######################*/
  for select vd.codigo, vd.data_caixa, vd.pessoa_fj, vd.num_nf,
  vd.num_cupom, vd.natureza, desc_acres, entrada,
  dinheiro, cheque, cartao, ticket,total, vd.forma_pgto, vd.troco, coalesce(vd.tipo_venda,''),
  vd.pct_comissao
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo)
  where vd.cnpj = :cnpj and fechada = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and coalesce(cancelada,'N') = 'N'and nat.computa_venda = 'S' and nat.es = 'S'
  and vd.vendedor = :vendedor and (vd.data_caixa between :data_ini and :data_fin)
  into :codigo, :data, :pessoa_fj, :num_nf,
       :num_cupom,  :natureza, :desc_acresc, :entrada,
       :dinheiro, :cheque, :cartao, :ticket,
       :total, :form_pagto, :troco, :tipo_venda,
       :porcentagem
  do
  begin
    /*setando o nº do documento cupom fiscal e Nota */
    if ((:num_nf is not null) and (:num_nf <> 0)) then
      docto = ('NF-'|| cast (:num_nf as varchar(12)));
    else if ((:num_cupom is not null) and (:num_cupom <> 0)) then
      docto = ('CP-'|| cast (:num_cupom as varchar(12)));

    tipo_fat = 'NORMAL';
    /*desconto acrescimo ja vem negativo se for desconto por isso somo*/
    liquido = coalesce(:total,0) + coalesce(:desc_acresc,0);
    vista = coalesce(:dinheiro,0) + coalesce(:cartao,0) + coalesce(:cheque,0) + coalesce(:ticket,0) + coalesce(:troco,0);
    prazo = coalesce(:liquido,0) - coalesce(:vista,0);

    /*evitando problema de arredondamento*/
    if (:prazo < 0.1) then
      prazo = 0;

    if (((:vista > 0) and (:tipo_venda <> 'FFT') and (:prazo <= 0)) or ((:vista=0) and (:prazo = 0))) then
      tipo_mov = 'Vista';
    else
      tipo_mov = 'Prazo';


    vlr_comissao = (((:vista * coalesce(:pct_cm_lib_vista,0))/100)  * :porcentagem)/100.00;
    vlr_comissao = vlr_comissao + (((:prazo * coalesce(:pct_cm_lib_prazo,0))/100)  * :porcentagem)/100.00;

    select coalesce(nome_razao,'') from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :cliente;

    suspend;
  end

  /*Listando as devoluções para poder debitar do total dos demais faturamentos */
  /*##########################  procurando em vendas #######################*/
  for select vd.codigo, vd.data_caixa, vd.pessoa_fj, vd.num_nf,
  vd.num_cupom, vd.natureza, desc_acres, entrada,
  dinheiro, cheque, cartao, ticket,total, vd.forma_pgto, vd.troco, coalesce(vd.tipo_venda,''),
  vd.pct_comissao, vd.id_agrupador
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo)
  where vd.cnpj = :cnpj and fechada = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and coalesce(cancelada,'N') = 'N' and nat.es = 'E' and nat.devolucao = 'S' and nat.gera_financeiro = 'S'
  and vd.vendedor = :vendedor and (vd.data_caixa between :data_ini and :data_fin) and vd.id_agrupador is not null
  into :codigo, :data, :pessoa_fj, :num_nf,
       :num_cupom,  :natureza, :desc_acresc, :entrada,
       :dinheiro, :cheque, :cartao, :ticket,
       :total, :form_pagto, :troco, :tipo_venda,
       :porcentagem, :id_agrupador
  do
  begin
    tipo_fat = 'DEVOLUCAO';
    /*setando o nº do documento cupom fiscal e Nota */
    if ((:num_nf is not null) and (:num_nf <> 0)) then
      docto = ('NF-'|| cast (:num_nf as varchar(12)));
    else if ((:num_cupom is not null) and (:num_cupom <> 0)) then
      docto = ('CP-'|| cast (:num_cupom as varchar(12)));


    /*desconto acrescimo ja vem negativo se for desconto por isso somo*/
    liquido = :total + :desc_acresc;
    vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
    prazo = :liquido - :vista;

    /*evitando problema de arredondamento*/
    if (:prazo < 0.1) then
      prazo = 0;

    if (((:vista > 0) and (:tipo_venda <> 'FFT') and (:prazo <= 0)) or ((:vista=0) and (:prazo = 0))) then
      tipo_mov = 'Vista';
    else
      tipo_mov = 'Prazo';


    vlr_comissao = (:vista * :porcentagem)/100.00;

    vlr_comissao = vlr_comissao * -1;
    liquido = liquido * -1;
    vista = vista  * -1;
    prazo = prazo * -1;
    select coalesce(nome_razao,'') from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :cliente;

    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_COMISSOES_TERC_BX (
    CNPJ VARCHAR(14),
    CODIGO_CR INTEGER,
    CODIGO_PG INTEGER,
    CODIGO INTEGER)
RETURNS (
    COD_BAIXA INTEGER,
    VLR_COMISSAO NUMERIC(18,4),
    PCT_BAIXA NUMERIC(18,4),
    VALOR_BAIXA NUMERIC(18,4),
    STATUS CHAR(1))
AS
DECLARE VARIABLE COD_BX_PAGAR INTEGER;
DECLARE VARIABLE COD_BX_RECEBER INTEGER;
DECLARE VARIABLE VALOR_CONTA NUMERIC(18,4);
begin
  /*Pegando os resgistros de contas à receber*/
  for select cm.cod_bx_receber, cm.valor, cm.status from cm2_comissao_parc cm
      where cm.cnpj = :cnpj and cm.cod_receber = :codigo_cr and cm.status <> 'F'
      into :cod_bx_receber, :vlr_comissao, :status
  do
  begin
    select bx.valor, bx.vlr_baixa from fin_baixas_receber bx
    where bx.cnpj = :cnpj and bx.codigo = :cod_bx_receber
    into :valor_conta, :valor_baixa;

    pct_baixa = ((:valor_baixa*100)/:valor_conta);

    cod_baixa = :cod_bx_receber;

    suspend;
  end

  /*Pegando os resgistros de contas à pagar*/
  for select cm.cod_bx_pagar, cm.valor, cm.status from cm2_comissao_parc cm
      where cm.cnpj = :cnpj and cm.cod_pagar = :codigo_pg and cm.status <> 'F'
      into :cod_bx_pagar, :vlr_comissao, :status
  do
  begin
     select bx.valor, bx.vlr_baixa from fin_baixas_pagar bx
     where bx.cnpj = :cnpj and bx.codigo = :cod_bx_pagar
     into :valor_conta, :valor_baixa;

     pct_baixa = ((:valor_baixa*100)/:valor_conta);

     cod_baixa = :cod_bx_pagar;
     suspend;
  end

  if (:cod_baixa is null) then
  begin
    /*Pegando os resgistros de contas à pagar*/
    for select cm.valor, cm.status from cm2_comissao_parc cm
        where cm.cnpj = :cnpj and cm.cod_venda = :codigo and cm.status <> 'F'
        into  :vlr_comissao, :status
    do
    begin
       select (vd.total + vd.desc_acres) from fat_vendas vd
       where vd.cnpj = :cnpj and vd.codigo = :codigo
       into :valor_baixa;

       valor_conta = :valor_baixa;
       pct_baixa = 100;

       suspend;
    end
  end
end
^

ALTER PROCEDURE PCD_REL_COMISSOES_TERCEIROS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    AGENTE VARCHAR(100),
    VLR_COMISSAO NUMERIC(18,4),
    VLR_CONTA NUMERIC(18,4),
    SALDO_COMISSAO NUMERIC(18,4),
    COD_PAGAR INTEGER,
    COD_RECEBER INTEGER,
    RCNPJ VARCHAR(14),
    RCODIGO INTEGER)
AS
begin
  /*cnpj de retorno, necessario por conta do link direto entre datasets*/
  rcnpj = :cnpj;
  rcodigo = :codigo;
  for select (cm.cod_pessoa ||' - '||psa.nome_razao) Agente, cm.cod_receber, cm.valor  from cm2_comissao_parc cm
      inner join glo_pessoas_fj psa on (psa.cnpj = cm.cnpj and psa.codigo = cm.cod_pessoa)
      where cm.cnpj = :cnpj and cm.cod_venda = :codigo and cm.status = 'F' and cm.cod_receber is not null
      into :agente, :cod_receber, :vlr_comissao
  do
  begin
      select rec.valor from fin_contas_receber rec
      where rec.cnpj = :cnpj and rec.codigo = :cod_receber
      into :vlr_conta;

      if (coalesce(:vlr_conta,0)=0) then
      begin
        /*como a conta a receber ja não existe mais estou pegando o valor da parcela do baixas de receber*/
        select max(bx.valor) from fin_baixas_receber bx
        where bx.cnpj = :cnpj and bx.codigo_cr = :cod_receber
        into :vlr_conta;
      end
      suspend;
  end

  for select (cm.cod_pessoa ||' - '||psa.nome_razao) Agente,cm.cod_pagar, cm.valor   from cm2_comissao_parc cm
      inner join glo_pessoas_fj psa on (psa.cnpj = cm.cnpj and psa.codigo = cm.cod_pessoa)
      where cm.cnpj = :cnpj and cm.cod_venda = :codigo and cm.status = 'F' and cm.cod_pagar is not null
      into :agente, :cod_pagar, :vlr_comissao
  do
  begin
      select pg.valor from fin_contas_pagar pg
      where pg.cnpj = :cnpj and pg.codigo = :cod_pagar
      into :vlr_conta;

      if (coalesce(:vlr_conta,0)=0) then
      begin
        /*como a conta a receber ja não existe mais estou pegando o valor da parcela do baixas de receber*/
        select max(bx.valor) from fin_baixas_pagar bx
        where bx.cnpj = :cnpj and bx.codigo_pg = :cod_pagar
        into :vlr_conta;
      end
      suspend;
  end

  /*Não tem receber ou pagar, VENDA A VISTA*/
  if (:vlr_conta is null) then
  begin
    for select (cm.cod_pessoa ||' - '||psa.nome_razao) Agente, cm.valor   from cm2_comissao_parc cm
      inner join glo_pessoas_fj psa on (psa.cnpj = cm.cnpj and psa.codigo = cm.cod_pessoa)
      where cm.cnpj = :cnpj and cm.cod_venda = :codigo and cm.status = 'F'
      into :agente,  :vlr_comissao
    do
    begin
      select (vd.total + vd.desc_acres) from fat_vendas vd
      where vd.cnpj = :cnpj and vd.codigo = :codigo
      into :vlr_conta;

      suspend;
    end
  end
end
^

ALTER PROCEDURE PCD_REL_CT13 (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    INSC_ESTADUAL VARCHAR(15),
    CNPJ_PROPRIEDADE VARCHAR(14),
    PECUARISTA VARCHAR(50),
    PROPRIEDADE VARCHAR(50),
    CIDADE_PROPRIEDADE VARCHAR(50),
    ENDERECO_PROPRIEDADE VARCHAR(50),
    ENDERECO_PECUARISTA VARCHAR(50),
    CEP VARCHAR(50),
    EMAIL VARCHAR(80),
    CELULAR VARCHAR(20),
    CIDADE_PECUARISTA VARCHAR(50),
    UF VARCHAR(2),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    NUM_DOSES NUMERIC(18,4),
    NUM_NF INTEGER,
    DATA_FABRICACAO DATE,
    DATA_COMPRA DATE,
    PARTIDA VARCHAR(10),
    LABORATORIO VARCHAR(50))
AS
DECLARE VARIABLE CIDADE_CLI INTEGER;
DECLARE VARIABLE CIDADE_PROP INTEGER;
begin
  /* Procedure Text */
  for select  pp.ie, pp.cpf, psa.nome_razao, pp.nome, lgd2.nome, pp.cidade,
  coalesce(lgd1.nome,'')||' nº'||coalesce(psa.numero,''), psa.cep, psa.email, psa.celular, psa.cidade, psa.uf, psa.fone, psa.fax, vdi.quantidade, mrc.nome,
  lote.lote, lote.validade, vd.num_nf, vd.data from fat_vendas vd
  inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and vd.cnpj = psa.cnpj) /*pessoas*/
  left join glo_logradouros lgd1 on (psa.endereco = lgd1.codigo and psa.cnpj = lgd1.cnpj) /*Endereço do cliente*/
  left join glo_propriedades pp on (pp.pessoa_fj = psa.codigo and pp.cnpj = psa.cnpj) /*propriedades*/
  inner join fat_vendas_itens vdi on (vdi.codigo = vd.codigo and vd.cnpj = vdi.cnpj) /*Itens da Venda*/
  inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj) /*Produtos ou vacinas*/
  left join est_marcas mrc on (mrc.codigo = prd.marca and mrc.cnpj = prd.cnpj) /*Marcas que equivalerão ao laboratório*/
  left join est_lote_produto lote on (lote.codigo = vdi.codigo_lote  and vdi.produto = lote.produto and lote.cnpj = vdi.cnpj) /*Lotes do produto*/
  left join glo_logradouros lgd2 on (lgd2.codigo = pp.endereco and pp.cnpj = lgd2.cnpj) /*Endereço da propriedade*/
  where vd.codigo = :venda and vd.cnpj = :cnpj and vd.pessoa_fj = :pessoa_fj and pp.propriedade = vd.propriedade
  into :insc_estadual, :cnpj_propriedade, :pecuarista, :propriedade, :endereco_propriedade, :cidade_prop,
  :endereco_pecuarista, :cep, :email, :celular, :cidade_cli, :uf, :fone, :fax, :num_doses, :laboratorio,
  :partida, :data_fabricacao, :num_nf, :data_compra
  do
  begin
     /*fazer inner join com cidades deixava a consulta muito lenta*/

     /*cidade do pecuarista*/
     select cdd.nome from glo_cidades cdd where cdd.codigo = :cidade_cli and cdd.cnpj = :cnpj
     into :cidade_pecuarista;

     /*cidade da propriedade */
     select cdd.nome from glo_cidades cdd where cdd.codigo = :cidade_prop and cdd.cnpj = :cnpj
     into :cidade_propriedade;
   suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_DEMONSTRATIVO (
    CNPJ VARCHAR(14),
    MES INTEGER,
    ANO INTEGER)
RETURNS (
    CODIGO INTEGER,
    AGRUPADOR INTEGER,
    NOME VARCHAR(50),
    VALOR1 FLOAT,
    VALOR2 FLOAT,
    VALOR3 FLOAT,
    VALOR4 FLOAT,
    VALOR5 FLOAT,
    VALOR6 FLOAT,
    SMES1 VARCHAR(10),
    SMES2 VARCHAR(10),
    SMES3 VARCHAR(10),
    SMES4 VARCHAR(10),
    SMES5 VARCHAR(10),
    SMES6 VARCHAR(10))
AS
DECLARE VARIABLE MES1 INTEGER;
DECLARE VARIABLE MES2 INTEGER;
DECLARE VARIABLE MES3 INTEGER;
DECLARE VARIABLE MES4 INTEGER;
DECLARE VARIABLE MES5 INTEGER;
DECLARE VARIABLE MES6 INTEGER;
DECLARE VARIABLE ANO1 INTEGER;
DECLARE VARIABLE ANO2 INTEGER;
DECLARE VARIABLE ANO3 INTEGER;
DECLARE VARIABLE ANO4 INTEGER;
DECLARE VARIABLE ANO5 INTEGER;
DECLARE VARIABLE ANO6 INTEGER;
DECLARE VARIABLE VLR_AUX FLOAT;
DECLARE VARIABLE MESAUX INTEGER;
DECLARE VARIABLE ANOAUX INTEGER;
begin
  /*------Mes 6-------*/
  mes6 = :mes;
  ano6 = :ano;
  if (mes6 <= 9) then
    smes6 = '0'||:mes6||'/'||:ano6;
  else
    smes6 = :mes6||'/'||:ano6;

  /*------Mes 5-------*/
  if ((mes6 - 1) = 0) then
  begin
    mes5 = 12;
    ano5 = (ano6 - 1);
  end
  else
  begin
    mes5 = (mes6 - 1);
    ano5 = ano6;
  end
  if (mes5 <= 9) then
    smes5 = '0'||:mes5||'/'||:ano5;
  else
    smes5 = :mes5||'/'||:ano5;

  /*--------Mes 4-------*/
  if ((mes5 - 1) = 0) then
  begin
    mes4 = 12;
    ano4 = (ano5 - 1);
  end
  else
  begin
    mes4 = (mes5 - 1);
    ano4 = ano5;
  end
  if (mes4 <= 9) then
    smes4 = '0'||:mes4||'/'||:ano4;
  else
    smes4 = :mes4||'/'||:ano4;


  /*--------Mes 3-------*/
  if ((mes4 - 1) = 0) then
  begin
    mes3 = 12;
    ano3 = (ano4 - 1);
  end
  else
  begin
    mes3 = (mes4 - 1);
    if (:mes3 <= 9) then
     mes3 = '0'||:mes3;
    ano3 = ano4;
  end

  if (mes3 <= 9) then
    smes3 = '0'||:mes3||'/'||:ano3;
  else
    smes3 = :mes3||'/'||:ano3;

  /*--------Mes 2-------*/
  if ((mes3 - 1) = 0) then
  begin
    mes2 = 12;
    ano2 = (ano3 - 1);
  end
  else
  begin
    mes2 = (mes3 - 1);
    ano2 = ano3;
  end
  if (mes2 <= 9) then
    smes2 = '0'||:mes2||'/'||:ano2;
  else
    smes2 = :mes2||'/'||:ano2;

   /*--------Mes 1-------*/
  if ((mes2 - 1) = 0) then
  begin
    mes1 = 12;
    ano1 = (ano2 - 1);
  end
  else
  begin
    mes1 = (mes2 - 1);
    ano1 = ano2;
  end
  if (mes1 <= 9) then
    smes1 = '0'||:mes1||'/'||:ano1;
  else
    smes1 = :mes1||'/'||:ano1;

 codigo = 2000; /*Código do "Lucro Bruto"*/
 nome = 'Saldo Geral';
 agrupador = -1;
    valor1 = 0;
    valor2 = 0;
    valor3 = 0;
    valor4 = 0;
    valor5 = 0;
    valor6 = 0;
    suspend;

    /*1º-----------------------------------------Montando Valores de Receitas(Vendas)-----------------------------------------------------*/
    codigo = 1000; /*Código do "Lucro Bruto"*/
    nome = 'Lucro Bruto';
    agrupador = 2000;
        valor1 = 0;
        valor2 = 0;
        valor3 = 0;
        valor4 = 0;
        valor5 = 0;
        valor6 = 0;
        suspend;

        /*2º--------------------------------------------Receita Liquida-------------------------------------------*/
        codigo = 1001; /*Código da "Receita Líquida"*/
        nome = 'Receita Líquida';
        agrupador = 1000;
            valor1 = 0;
            valor2 = 0;
            valor3 = 0;
            valor4 = 0;
            valor5 = 0;
            valor6 = 0;
            suspend;
        
            /*----------------------------------Vendas -------------------------------------------------------------*/
            codigo = 1011;
            nome = 'Saldo de Trocas';
            agrupador = 1001;
        
                for select extract(month from trc.data_caixa), extract (year from trc.data_caixa),
                    sum((coalesce(trc.total_2,0) + coalesce(trc.desc_acresc_2,0)) - (coalesce(trc.total,0) + coalesce(trc.desc_acresc,0)))
                    from fat_trocas trc
                    where coalesce(trc.fechado,'N') = 'S' and coalesce(trc.enviada_cx,'N') = 'S'
                    and coalesce(trc.cancelada,'N') = 'N' and trc.cnpj = :cnpj
                    and  extract (year from trc.data_caixa) >= :ano1 and extract (year from trc.data_caixa) <= :ano6
                    group by extract (month from trc.data_caixa), extract (year from trc.data_caixa)
                    into :mes, :ano, :vlr_aux
                do
                begin
                  if ((:mes = :mes1) and (:ano = :ano1)) then
                    valor1 = :vlr_aux;
                  else if ((:mes = :mes2) and (:ano = :ano2)) then
                    valor2 = :vlr_aux;
                  else if ((:mes = :mes3) and (:ano = :ano3)) then
                    valor3 = :vlr_aux;
                  else if ((:mes = :mes4) and (:ano = :ano4)) then
                    valor4 = :vlr_aux;
                  else if ((:mes = :mes5) and (:ano = :ano5)) then
                    valor5 = :vlr_aux;
                  else if ((:mes = :mes6) and (:ano = :ano6)) then
                    valor6 = :vlr_aux;
        
                end
                suspend;


            /*----------------------------------Vendas -------------------------------------------------------------*/
            codigo = 1005;
            nome = 'Venda Bruta';
            agrupador = 1001;
        
                for select extract(month from vd.data_caixa), extract (year from vd.data_caixa),
                    sum(coalesce(vd.total,0) + coalesce(vd.desc_acres,0))
                    from fat_vendas vd
                    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
                    where coalesce(vd.fechada,'N') = 'S' and coalesce(vd.enviada_cx,'N') = 'S'
                    and coalesce(vd.cancelada,'N') = 'N' and vd.cnpj = :cnpj and coalesce(nat.computa_venda,'N') = 'S' and nat.es = 'S'
                    and  extract (year from vd.data_caixa) >= :ano1 and extract (year from vd.data_caixa) <= :ano6
                    group by extract (month from vd.data_caixa), extract (year from vd.data_caixa)
                    into :mes, :ano, :vlr_aux
                do
                begin
                  if ((:mes = :mes1) and (:ano = :ano1)) then
                    valor1 = :vlr_aux;
                  else if ((:mes = :mes2) and (:ano = :ano2)) then
                    valor2 = :vlr_aux;
                  else if ((:mes = :mes3) and (:ano = :ano3)) then
                    valor3 = :vlr_aux;
                  else if ((:mes = :mes4) and (:ano = :ano4)) then
                    valor4 = :vlr_aux;
                  else if ((:mes = :mes5) and (:ano = :ano5)) then
                    valor5 = :vlr_aux;
                  else if ((:mes = :mes6) and (:ano = :ano6)) then
                    valor6 = :vlr_aux;
        
                end
                suspend;


            /*1.2.1º--------------------------------------------Devoluções-------------------------------------------------*/
            codigo = 1002; /*Código do "Lucro Bruto"*/
            nome = 'Devoluções';
            agrupador = 1001;
                valor1 = 0;
                valor2 = 0;
                valor3 = 0;
                valor4 = 0;
                valor5 = 0;
                valor6 = 0;
                for select extract (month from vd.data_caixa), extract (year from vd.data_caixa),
                    sum(coalesce(vd.total,0) + coalesce(vd.desc_acres,0))
                    from fat_vendas vd
                    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
                    where coalesce(vd.fechada,'N') = 'S' and coalesce(vd.enviada_cx,'N') = 'S'
                    and coalesce(vd.cancelada,'N') = 'N' and vd.cnpj = :cnpj
                    and coalesce(nat.devolucao,'N') = 'S' and nat.es = 'E'
                    and  extract (year from vd.data_caixa) >= :ano1 and extract (year from vd.data_caixa) <= :ano6
                    group by extract (month from vd.data_caixa), extract (year from vd.data_caixa)
                    into :mes, :ano, :vlr_aux
                do
                begin
                  vlr_aux = (:vlr_aux * -1);
        
                  if ((:mes = :mes1) and (:ano = :ano1)) then
                    valor1 = :vlr_aux;
                  else if ((:mes = :mes2) and (:ano = :ano2)) then
                    valor2 = :vlr_aux;
                  else if ((:mes = :mes3) and (:ano = :ano3)) then
                    valor3 = :vlr_aux;
                  else if ((:mes = :mes4) and (:ano = :ano4)) then
                    valor4 = :vlr_aux;
                  else if ((:mes = :mes5) and (:ano = :ano5)) then
                    valor5 = :vlr_aux;
                  else if ((:mes = :mes6) and (:ano = :ano6))then
                    valor6 = :vlr_aux;
                end

                suspend;

            /*1.2.1º--------------------------------------------Bonificações-------------------------------------------------*/
            codigo = 1012;
            nome = 'Bonificações';
            agrupador = 1001;
                valor1 = 0;
                valor2 = 0;
                valor3 = 0;
                valor4 = 0;
                valor5 = 0;
                valor6 = 0;
                for select extract (month from vd.data_caixa), extract (year from vd.data_caixa),
                    sum(coalesce(vd.total,0) + coalesce(vd.desc_acres,0))
                    from fat_vendas vd
                    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
                    where coalesce(vd.fechada,'N') = 'S' and coalesce(vd.enviada_cx,'N') = 'S'
                    and coalesce(vd.cancelada,'N') = 'N' and vd.cnpj = :cnpj
                    and coalesce(nat.ttl_res_bonificacao,'N') = 'S' and nat.es = 'S'
                    and  extract (year from vd.data_caixa) >= :ano1 and extract (year from vd.data_caixa) <= :ano6
                    group by extract (month from vd.data_caixa), extract (year from vd.data_caixa)
                    into :mes, :ano, :vlr_aux
                do
                begin
                  valor1 = 0;
                  valor2 = 0;
                  valor3 = 0;
                  valor4 = 0;
                  valor5 = 0;
                  valor6 = 0;
                  vlr_aux = (:vlr_aux * -1);
        
                  if ((:mes = :mes1) and (:ano = :ano1)) then
                    valor1 = :vlr_aux;
                  else if ((:mes = :mes2) and (:ano = :ano2)) then
                    valor2 = :vlr_aux;
                  else if ((:mes = :mes3) and (:ano = :ano3)) then
                    valor3 = :vlr_aux;
                  else if ((:mes = :mes4) and (:ano = :ano4)) then
                    valor4 = :vlr_aux;
                  else if ((:mes = :mes5) and (:ano = :ano5)) then
                    valor5 = :vlr_aux;
                  else if ((:mes = :mes6) and (:ano = :ano6)) then
                    valor6 = :vlr_aux;
                end

                suspend;
        
            /*--------------------------------------------Despesas com Vendas(CMV)-----------------------------------*/
            for select distinct ct.codigo, ct.agrupador, ct.nome from fin_centro_custo ct
                where coalesce(ct.exclui_demostrativo_financeiro,'N') = 'N' and ct.cnpj = :cnpj
                and coalesce(ct.cmv,'N') = 'S'
                into :codigo, :agrupador, :nome
            do
            begin
              if (coalesce(:agrupador,0) = 0 ) then
                agrupador = 1001;

              valor1 = 0;
              valor2 = 0;
              valor3 = 0;
              valor4 = 0;
              valor5 = 0;
              valor6 = 0;

              for select extract(month from aux.dt_emissao), extract(year from aux.dt_emissao),
                  coalesce(sum(aux.valor),0) from
                  (select distinct pg.codigo codigo_pg, pg.valor, pg.dt_emissao from fin_contas_pagar pg
                  where extract (year from pg.dt_emissao) >= :ano1 and extract (year from pg.dt_emissao) <= :ano6
                  and pg.centro_custo = :codigo and pg.cnpj = :cnpj
                  union   /*Pegando todas as 'contas' que ja n estao + em contas a pagar pq foram baixadas*/
                  select distinct bx.codigo_pg, bx.valor, bx.dt_emissao from fin_baixas_pagar bx
                  where extract (year from bx.dt_emissao) >= :ano1 and extract (year from bx.dt_emissao) <= :ano6
                  and bx.centro_custo = :codigo and bx.cnpj = :cnpj
                  and (0 = (select count(*) from fin_contas_pagar pg2 where pg2.cnpj = :cnpj and pg2.centro_custo = :codigo and pg2.codigo = bx.codigo_pg))
                  ) as aux
                  group by extract (month from aux.dt_emissao) , extract (year from aux.dt_emissao)
              into :mes, :ano, :vlr_aux
              do
              begin
                vlr_aux = (:vlr_aux * -1);
        
                if ((:mes = :mes1) and (:ano = :ano1)) then
                  valor1 = :vlr_aux;
                else if ((:mes = :mes2) and (:ano = :ano2)) then
                  valor2 = :vlr_aux;
                else if ((:mes = :mes3) and (:ano = :ano3)) then
                  valor3 = :vlr_aux;
                else if ((:mes = :mes4) and (:ano = :ano4)) then
                  valor4 = :vlr_aux;
                else if ((:mes = :mes5) and (:ano = :ano5)) then
                  valor5 = :vlr_aux;
                else if ((:mes = :mes6) and (:ano = :ano6)) then
                  valor6 = :vlr_aux;
        
              end
              /*for select extract(month from pg.dt_baixa), extract(year from pg.dt_baixa),
                  coalesce(sum(pg.vlr_baixa),0) from fin_baixas_pagar pg
                  where extract (year from pg.dt_vencto) >= :ano1 and extract (year from pg.dt_vencto) <= :ano6
                  and pg.centro_custo = :codigo and pg.cnpj = :cnpj
                  group by extract (month from pg.dt_baixa) , extract (year from pg.dt_baixa)
              into :mes, :ano, :vlr_aux
              do
              begin
                vlr_aux = (:vlr_aux * -1);
    
                if ((:mes = :mes1) and (:ano = :ano1)) then
                  valor1 = :vlr_aux;
                else if ((:mes = :mes2) and (:ano = :ano2)) then
                  valor2 = :vlr_aux;
                else if ((:mes = :mes3) and (:ano = :ano3)) then
                  valor3 = :vlr_aux;
                else if ((:mes = :mes4) and (:ano = :ano4)) then
                  valor4 = :vlr_aux;
                else if ((:mes = :mes5) and (:ano = :ano5)) then
                  valor5 = :vlr_aux;
                else if ((:mes = :mes6) and (:ano = :ano6)) then
                  valor6 = :vlr_aux;
    
              end*/
              suspend;
              valor1 = 0;
              valor2 = 0;
              valor3 = 0;
              valor4 = 0;
              valor5 = 0;
              valor6 = 0;
            end
        
        codigo = 1013;
        nome = 'Custo de Venda';
        agrupador = 1000;

            for select extract(month from vd.data_caixa), extract (year from vd.data_caixa),
                    sum(coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0))
                    from fat_vendas vd
                    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
                    inner join fat_vendas_itens vdi on (vdi.codigo = vd.codigo and vd.cnpj = vdi.cnpj)
                    where coalesce(vd.fechada,'N') = 'S' and coalesce(vd.enviada_cx,'N') = 'S'
                    and coalesce(vd.cancelada,'N') = 'N' and vd.cnpj = :cnpj and coalesce(nat.computa_venda,'N') = 'S' and nat.es = 'S'
                    and  extract (year from vd.data_caixa) >= :ano1 and extract (year from vd.data_caixa) <= :ano6
                    group by extract (month from vd.data_caixa), extract (year from vd.data_caixa)
                    into :mes, :ano, :vlr_aux
            do
            begin
                  vlr_aux = (:vlr_aux * -1);
                  if ((:mes = :mes1) and (:ano = :ano1)) then
                    valor1 = :vlr_aux;
                  else if ((:mes = :mes2) and (:ano = :ano2))  then
                    valor2 = :vlr_aux;
                  else if ((:mes = :mes3) and (:ano = :ano3)) then
                    valor3 = :vlr_aux;
                  else if ((:mes = :mes4) and (:ano = :ano4)) then
                    valor4 = :vlr_aux;
                  else if ((:mes = :mes5) and (:ano = :ano5)) then
                    valor5 = :vlr_aux;
                  else if ((:mes = :mes6) and (:ano = :ano6)) then
                    valor6 = :vlr_aux;
        
            end
            suspend;




    /*1º Nivel--------------------------------------------Despesas-----------------------------------*/
    for select distinct ct.codigo, ct.agrupador, ct.nome from fin_centro_custo ct
        where coalesce(ct.exclui_demostrativo_financeiro,'N') = 'N' and ct.cnpj = :cnpj
        and coalesce(ct.cmv,'N') = 'N'
        into :codigo, :agrupador, :nome
    do
    begin
      if (:agrupador is null) then
        agrupador = 2000;

      valor1 = 0;
      valor2 = 0;
      valor3 = 0;
      valor4 = 0;
      valor5 = 0;
      valor6 = 0;

      for select extract(month from aux.dt_emissao), extract(year from aux.dt_emissao),
          coalesce(sum(aux.valor),0) from
          (select distinct pg.codigo codigo_pg, pg.valor, pg.dt_emissao from fin_contas_pagar pg
           where extract (year from pg.dt_emissao) >= :ano1 and extract (year from pg.dt_emissao) <= :ano6
           and pg.centro_custo = :codigo and pg.cnpj = :cnpj
           union   /*Pegando todas as 'contas' que ja n estao + em contas a pagar pq foram baixadas*/
           select distinct bx.codigo_pg, bx.valor, bx.dt_emissao from fin_baixas_pagar bx
           where extract (year from bx.dt_emissao) >= :ano1 and extract (year from bx.dt_emissao) <= :ano6
           and bx.centro_custo = :codigo and bx.cnpj = :cnpj
           and (0 = (select count(*) from fin_contas_pagar pg2 where pg2.cnpj = :cnpj and pg2.centro_custo = :codigo and pg2.codigo = bx.codigo_pg))
           union /*Pegando as retiradas de caixa que não tem como destino o deposito bancario*/
            select distinct cx.planilha codigo_pg,   valor,  cx.data dt_emissao
            from fat_caixas_movimentos cx
            inner join ctb_planoconta ctb on (ctb.cnpj = cx.cnpj and ctb.conta = cx.conta)
            WHERE cx.tipo = 'D' and  coalesce(ctb.banco,0) = 0
            and extract (year from cx.data) >= :ano1 and extract (year from cx.data) <= :ano6
            and cx.centro_custo = :codigo and cx.cnpj = :cnpj
           ) as aux
          group by extract (month from aux.dt_emissao) , extract (year from aux.dt_emissao)
      into :mes, :ano, :vlr_aux
      do
      begin
        vlr_aux = (:vlr_aux * -1);

        if ((:mes = :mes1) and (:ano = :ano1)) then
          valor1 = :vlr_aux;
        else if ((:mes = :mes2) and (:ano = :ano2)) then
          valor2 = :vlr_aux;
        else if ((:mes = :mes3) and (:ano = :ano3)) then
          valor3 = :vlr_aux;
        else if ((:mes = :mes4) and (:ano = :ano4)) then
          valor4 = :vlr_aux;
        else if ((:mes = :mes5) and (:ano = :ano5)) then
          valor5 = :vlr_aux;
        else if ((:mes = :mes6) and (:ano = :ano6)) then
          valor6 = :vlr_aux;

      end

      /*for select extract(month from pg.dt_baixa), extract(year from pg.dt_baixa),
          coalesce(sum(pg.vlr_baixa),0) from fin_baixas_pagar pg
          where extract (year from pg.dt_baixa) >= :ano1 and extract (year from pg.dt_baixa) <= :ano6
          and pg.centro_custo = :codigo and pg.cnpj = :cnpj
          group by extract (month from pg.dt_baixa) , extract (year from pg.dt_baixa)
      into :mes, :ano, :vlr_aux
      do
      begin
        vlr_aux = (:vlr_aux * -1);

        if ((:mes = :mes1) and (:ano = :ano1)) then
          valor1 = :vlr_aux;
        else if ((:mes = :mes2) and (:ano = :ano2)) then
          valor2 = :vlr_aux;
        else if ((:mes = :mes3) and (:ano = :ano3)) then
          valor3 = :vlr_aux;
        else if ((:mes = :mes4) and (:ano = :ano4)) then
          valor4 = :vlr_aux;
        else if ((:mes = :mes5) and (:ano = :ano5)) then
          valor5 = :vlr_aux;
        else if ((:mes = :mes6) and (:ano = :ano6)) then
          valor6 = :vlr_aux;

      end*/
      suspend;

    end
END
^

ALTER PROCEDURE PCD_REL_DEVOLUCOES (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    N_DOCTO INTEGER,
    NOME_RAZAO VARCHAR(70),
    COD_VENDA INTEGER,
    DATA DATE,
    CFOP INTEGER,
    TIPO_VENDA CHAR(3),
    DATA_CAIXA DATE,
    VLR_BRUTO NUMERIC(18,4),
    VLR_DESC_ACRESC NUMERIC(18,4),
    VLR_TOTAL NUMERIC(18,4),
    VLR_BASE_ICM NUMERIC(18,4),
    VLR_ICM NUMERIC(18,4),
    VLR_ICM_SUB NUMERIC(18,4),
    VLR_BASE_ICM_SUB NUMERIC(18,4),
    CANCELADA CHAR(1),
    STATUS VARCHAR(10),
    TIPO_DOC INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE TOTAL_SIMPLES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
begin
  /* Procedimento requisitado peo frigorífico(Fechamento Contábil) ou Vendas Fiscais sgund o alessandro,/
  este tem a função de listar todas as vendas no período inclusive as canceladas
  no entanto as canceladas não devem computatar no valor total do relatório */

  if (dt_fin is null) then
    dt_fin = '01.01.3001';

  if (dt_ini is null) then
  dt_ini = '01.01.1901';


  for select vd.codigo, coalesce(vd.num_nf,0),coalesce(vd.num_cupom,0) ,coalesce(vd.natureza,0),
      coalesce(vd.tipo_venda,''), vd.data, vd.data_caixa,
      coalesce(vd.desc_acres,0),  coalesce(vd.base_icm,0),coalesce(vd.icm,0),
      vd.pessoa_fj,coalesce(vd.base_icm_subst,0),
      coalesce(vd.valor_icm_subst,0), coalesce(vd.cancelada,''), coalesce(vd.total_nota,0),
      coalesce(vd.total,0)
      from fat_vendas vd
      inner join est_natureza nat on (vd.natureza = nat.codigo)
      where (vd.data_caixa between :dt_ini and :dt_fin) and vd.cnpj = :cnpj
      and vd.fechada = 'S' and /*isso vai filtrar somente vendas c/cupons ou com NF
      (((vd.num_cupom <> 0) and (vd.num_cupom is not null)) or ((vd.num_nf <> 0) and (vd.num_nf is not null)))
      and*/ nat.devolucao ='S'
      order by vd.data_caixa
      into :cod_venda, :num_nf, :num_cupom, :cfop, :tipo_venda,:data,:data_caixa,:vlr_desc_acresc
      ,:vlr_base_icm, :vlr_icm, :pessoa_fj, :vlr_base_icm_sub, :vlr_icm_sub,:cancelada,:total_nota,:total_simples
  do
      begin
      vlr_total = (:total_simples + :vlr_desc_acresc);
      vlr_bruto = :total_simples;
      /*existem cliente que usam os valores em Total e Total_nota
      if (:total_nota = 0) then
      begin

      end
      else
      begin
        vlr_total = (:total_nota + :vlr_desc_acresc);
        vlr_bruto = :total_nota;
      end*/

      /*Nº do documento fiscal*/
      if ((:num_cupom <> 0) and (:num_cupom is not null)) then
      begin
        n_docto = :num_cupom;
        tipo_doc = 1;
      end
      else
      begin
        n_docto = :num_nf;
        tipo_doc = 2;
      end

      /*pegando o nome do cliente*/
      /*se der pau coloca esse
      select coalesce(psa.nome_razao,'') from glo_pessoas_fj psa*/
      select coalesce(codigo,'')||'-'||coalesce(nome_razao,'') from glo_pessoas_fj psa
      where psa.codigo =:pessoa_fj and psa.cnpj = :cnpj
      into :nome_razao;

      /*zerando valores de notas canceladas p/não influenciar no total*/
      if (:cancelada = 'S') then
      begin
         status = 'Cancelada';
         VLR_BRUTO = 0;
         VLR_DESC_ACRESC = 0;
         VLR_TOTAL = 0;
         VLR_BASE_ICM = 0;
         VLR_ICM = 0;
         VLR_ICM_SUB = 0;
      end
      else
        status = '';

      /*descobrindo a tributação da nota modificação feita p/o frigorífico(João)
      segundo o joão uma mesma nota não conteria items c/tributações diferentes*/
      select max(fvi.cte), max(fvi.ctie) from fat_vendas_itens fvi
      where fvi.codigo = :cod_venda and fvi.cnpj = :cnpj
      into :cte, :ctie;

    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_ENT_PRODUTOS (
    CNPJ VARCHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    FORNECEDOR VARCHAR(65),
    DATA_NF DATE,
    NDOC VARCHAR(20),
    PRODUTO VARCHAR(80),
    NUM_NF VARCHAR(20),
    QTDE NUMERIC(18,4),
    VLR_UNITARIO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    ORIGEM CHAR(3),
    DESCONTO_NOTA NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    COD_FORN INTEGER,
    AQUI CHAR(3),
    CFOP INTEGER)
AS
DECLARE VARIABLE REPRESENTA NUMERIC(18,4);
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE DESCONTO_ITEM NUMERIC(18,4);
DECLARE VARIABLE DESCONTO_RATEIO NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ITEMS NUMERIC(15,4);
begin
  /* Procedimento Fornecerá dados para o relatório Analitico/Gerencial - Sintético requisitado pelo frigorífico*/
  for select vd.data_caixa, psa.codigo, psa.nome_razao, cast(vd.num_nf as varchar(20)),
  coalesce(vd.desc_acres,0),  vd.total_nota, vd.codigo, vd.natureza
  from fat_vendas vd
    inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
    inner join glo_pessoas_fj psa on (vd.pessoa_fj = psa.codigo and vd.cnpj = psa.cnpj)
    where vd.cnpj = :cnpj and (vd.data_caixa between :dt_inicial and :dt_final) and vd.fechada = 'S'
    and vd.enviada_cx = 'S' and vd.cancelada <> 'S' and nat.es = 'E'
    into :data_nf, :cod_forn,  :fornecedor,:num_nf, :desconto_nota, :total_nota, :codigo, :cfop
  do
  begin
      origem = 'VND';
      TOTAL_ITEMS = 0;
      aqui = 'NAO';
      for select (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)),
          ((coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)) * coalesce(vdi.quantidade,0)),
          coalesce(vdi.quantidade,0) ,(vdi.produto ||'-'||prd.nome)
          from fat_vendas_itens vdi
          inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
          where vdi.codigo = :codigo and vdi.cnpj = :cnpj
        into  :vlr_unitario, :total_item, :qtde, :produto
      do
      begin
         /*rateando o desconto da nota*/
         if (:desconto_nota < 0) then /*desconto sempre negativo*/
         begin
           representa = (:total_item * 100) / :total_nota;
           desconto_rateio = (:representa * :desconto_nota)/100;
           vlr_unitario = :vlr_unitario + (:desconto_rateio/:qtde);
           total_item = :vlr_unitario * :qtde;
         end
         ndoc = cast (:codigo as varchar(20));
         suspend;

         total_items = :total_items + :total_item;
      end

      if (:total_items <> :total_nota) then
           aqui = 'SIM';

  end

  /* Pesquisando em entradas*/
  /* arredonda(EntradasVLR_PRODUTOS.Value +
                            EntradasVLR_EMBALAGEM.Value +
                            EntradasVLR_SEGURO.Value + EntradasVLR_FRETE.VALUE +
                            EntradasVLR_IPI.Value +
                            EntradasTAXAS.Value -
                            EntradasVLR_DESCONTO.Value+EntradasVLR_ICM_SUBS.VALUE,2); */
  /*2º O kaiser estes são os valores que representam o total da Noda e Desconto da nota
  respectivamente VLR_PRODUTOS, VLR_DESCONTO  */
  for select ent.data_nf, psa.codigo, psa.nome_razao,
  ent.ndocto, ent.vlr_produtos, ent.vlr_desconto, ent.natureza, ent.pessoa_fj
  from EST_ENTRADAS ent
    inner join glo_pessoas_fj psa on (ent.pessoa_fj = psa.codigo and ent.cnpj = psa.cnpj)
    where ent.cnpj = :cnpj and (ent.data_ent between :dt_inicial and :dt_final)
    into :data_nf, :cod_forn, :fornecedor,:num_nf, :total_nota, :desconto_nota, :cfop, :pessoa_fj

  do
  begin                                                                                                /*  DESCONTOS*/
    origem = 'ENT';
    total_items = 0;
    aqui = 'NAO';
    ndoc = :num_nf;
    for select (coalesce(eti.prc_unitario,0) - coalesce(eti.descontos,0)),
        ((coalesce(eti.prc_unitario,0) - coalesce(eti.descontos,0)) * coalesce(eti.quantidade,0)),
         coalesce(eti.quantidade,0) ,(eti.produto ||'-'||prd.nome)
        from EST_ENTRADAS_ITENS eti
        inner join est_produtos prd on (prd.codigo = eti.produto and prd.cnpj = eti.cnpj)
        where eti.ndocto = :num_nf and eti.cnpj = :cnpj and eti.pessoa_fj = :pessoa_fj
        into  :vlr_unitario, :total_item, :qtde, :produto
    do
    begin
      /*rateando o desconto da nota*/
      if (:desconto_nota < 0) then /*desconto sempre negativo*/
      begin
           representa = (:total_item * 100) / :total_nota;
           desconto_rateio = (:representa * :desconto_nota)/100;
           vlr_unitario = :vlr_unitario +(:desconto_rateio/:qtde);
           total_item = :vlr_unitario * :qtde;
      end
      suspend;
      total_items = :total_items + :total_item;
    end

    if (:total_items <> :total_nota) then
      aqui = 'SIM';
  end
END
^

ALTER PROCEDURE PCD_REL_ENTRADAS_PRODUTOS (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    PESSOA_FJ INTEGER)
AS
begin
  /*este procedimento tem por objetivo buscar todos os items de um determinado
  perido e empresa, transendo seus respectivos valores ja c/desconto por item
  e o valor rateado de desconto da nota, este servirá de base para a consulta
  que alimentará o relatório de Entradas por produtos */
  for select prd.nome, Ent.pessoa_fj, coalesce(Enti.Quantidade,0), coalesce(Enti.PRC_CUSTO,0)
    from Est_Entradas Ent
    inner join est_natureza nat on (Ent.natureza = nat.codigo and Ent.cnpj = nat.cnpj)
    inner join Est_Entradas_itens EntI on (Ent.cnpj = eNTi.cnpj and Ent.ndocto = EntI.Ndocto
    and Ent.pessoa_fj = EntI.pessoa_fj )
    inner join est_produtos prd on (prd.codigo = Enti.produto and Enti.cnpj = prd.cnpj)
    where (ent.data_ref between :dini and :dfim) and Ent.cnpj = :cnpj
    and ent.proc_qtd = 'S' and nat.es = 'E'
    into :produto, :pessoa_fj, :qtde, :valor
  do
  begin
    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_EQUIPAMENTOS (
    CNPJ VARCHAR(15),
    DATA1 DATE,
    DATA2 DATE,
    PR_REGIAO INTEGER,
    PR_CLIENTE INTEGER,
    PR_MARCA INTEGER,
    PR_MODELO INTEGER,
    PR_EQUIPAMENTO VARCHAR(15),
    PR_TPCONTRATO INTEGER,
    PR_CONTRATO INTEGER,
    PR_CIDADE INTEGER,
    PR_SERIE VARCHAR(30),
    ATIVO CHAR(1))
RETURNS (
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(90),
    SERIE VARCHAR(30),
    MRC_CODIGO INTEGER,
    MARCA VARCHAR(50),
    MODELO VARCHAR(50),
    MDL_CODIGO INTEGER,
    MEDIA_COPIAS INTEGER,
    COD_CLIENTE INTEGER,
    CHAMADOS_SUB INTEGER,
    CHAMADOS_TIT INTEGER,
    KM_RODADO FLOAT,
    TEMPO_RESP_VENC INTEGER,
    TEMPO_RESP_MED FLOAT,
    PSA_FANTASIA VARCHAR(80),
    REG_CODIGO INTEGER,
    REG_NOME VARCHAR(50),
    BAIRRO VARCHAR(50),
    ENDERECO VARCHAR(100),
    CIDADE VARCHAR(60),
    FONE VARCHAR(20),
    TOTAL_CHAMADOS INTEGER,
    COD_TIPO_CONTRATO INTEGER)
AS
declare variable tmp_resp_ctr integer;
begin
  if (:PR_REGIAO is null) then
    PR_REGIAO = 0;

  if(:PR_CLIENTE is null) then
    pr_cliente = 0;

  if(:PR_MARCA is null) then
    PR_MARCA = 0;

  if (:PR_MODELO is null) then
    PR_MODELO = 0;

  if (:PR_TPCONTRATO is null) then
    PR_TPCONTRATO = 0;

  if (:pr_contrato is null) then
    pr_contrato = 0;

  if (:pr_cidade is null) then
    pr_cidade = 0;

  if (:PR_EQUIPAMENTO is null) then
    PR_EQUIPAMENTO = '';

  if (:PR_SERIE is null) then
    PR_SERIE = '';

  /*pegando todos os produtos ativos*/
  for select prd.codigo, prd.nome||' ('||prd.serie||')', prd.serie, coalesce(mrc.nome,'Não determinada'),
      mrc.codigo , coalesce(mdl.nome,'Não determinado'), mdl.codigo,
      cti.media_copias, ct.cod_cliente, ct.cod_contrato,
      cti.tempo_resposta, coalesce(psa.codigo,'')||'-'||coalesce(psa.nome_razao,''), reg.codigo,
      coalesce(reg.nome,'Não determinada'),
      ('End: '||coalesce(lgd.nome,'')||' Nº '||coalesce(psa.numero,'')),
      br.nome,
      coalesce(cdd.nome,'')||'-'||coalesce(cdd.uf,''),
      psa.fone
      from ofc_contratos_itens cti
      inner join ofc_contratos ct on (ct.codigo = cti.contrato and ct.cnpj = cti.cnpj)
      left join glo_tipo_contrato     ctr on (ct.cod_contrato   = ctr.codigo    and ctr.cnpj  = ct.cnpj)
      left join glo_pessoas_fj        psa on (ct.cod_cliente = psa.codigo     and psa.cnpj = ct.cnpj)
      left join glo_logradouros       lgd on (psa.endereco = lgd.codigo and psa.cnpj = lgd.cnpj)
      left join glo_bairros       br on (psa.bairro = br.codigo and psa.cnpj = br.cnpj)
      left join glo_cidades       cdd on (psa.cidade = cdd.codigo and psa.cnpj = cdd.cnpj)
      left join  glo_regioes           reg on (reg.codigo     = psa.regiao     and reg.cnpj = ct.cnpj)
      left join est_produtos          prd on (prd.codigo     = cti.cod_produto and cti.cnpj  = prd.cnpj)
      left join est_marcas             mrc on (prd.marca      = mrc.codigo  and mrc.cnpj  = prd.cnpj)
      left join glo_modelo_propriedade mdl on (prd.modelo     = mdl.codigo     and mdl.cnpj = prd.cnpj)
      where (ct.cnpj = :cnpj)
      and (cti.ativo = :ativo or :ativo = '')
      and (reg.codigo = :pr_regiao or :pr_regiao = 0)
      and (psa.codigo = :pr_cliente  or :pr_cliente = 0)
      and (mrc.codigo = :pr_marca or :pr_marca = 0)
      and (mdl.codigo = :pr_modelo or :pr_modelo = 0)
      and (ctr.codigo = :pr_tpcontrato or :pr_tpcontrato = 0)
      and (ct.codigo = :pr_contrato or :pr_contrato = 0)
      and (cdd.codigo = :pr_cidade or :pr_cidade = 0)
      and (cti.cod_produto = :PR_EQUIPAMENTO or :PR_EQUIPAMENTO = '')
      and (upper(prd.serie) = upper(:pr_serie) or :pr_serie = '')
      INTO :COD_PRODUTO, :PRODUTO, :SERIE, :MARCA, :MRC_CODIGO , :MODELO, :MDL_CODIGO , :MEDIA_COPIAS, :COD_CLIENTE,
      :cod_tipo_contrato, :tmp_resp_ctr, :psa_fantasia, :reg_codigo, :reg_nome,
      :endereco,
      :bairro,
      :cidade,
      :fone
  do
  begin

    /*encontrando número de chamados no periodo que foram substitutos  */
    select count(*) from ofc_ordem_servico o
    where o.tipo_tecnico = 'S'
    and o.cnpj = :cnpj
    and (o.data between :data1 and :data2)
    and o.produto = :cod_produto
    and (o.pessoa_fj = :cod_cliente or :cod_cliente = 0)
    into :chamados_sub;

    if (:chamados_sub is null) then
       chamados_sub = 0;

    /*atendimenos titulares */
    select count(*) from ofc_ordem_servico o
    where coalesce(o.tipo_tecnico,'T') = 'T'
    and o.cnpj = :cnpj
    and (o.data between :data1 and :data2)
    and o.produto = :cod_produto
    and (o.pessoa_fj = :cod_cliente or :cod_cliente = 0)
    into :chamados_tit;

    if (:chamados_tit is null) then
       chamados_tit = 0;

    /*km rodados        */
    select sum(o.km_rodado) from ofc_ordem_servico o
    where o.cnpj = :cnpj
    and (o.data between :data1 and :data2)
    and o.produto = :cod_produto
    and (o.pessoa_fj = :cod_cliente or :cod_cliente = 0)
    into :km_rodado;

    if (:km_rodado is null) then
       km_rodado = 0;

    /*tempo resposta vencido  */
    select count(*) from ofc_ordem_servico o
    where o.cnpj = :cnpj
    and (o.data between :data1 and :data2)
    and o.produto = :cod_produto
    and (o.pessoa_fj = :cod_cliente or :cod_cliente = 0)
    and o.tempo_resposta > :tmp_resp_ctr
    into :tempo_resp_venc;

    if (:tempo_resp_venc is null) then
       tempo_resp_venc = 0;

    /*tempo resposta medio   */
    select coalesce(avg(o.tempo_resposta),0) from ofc_ordem_servico o
    where o.cnpj = :cnpj and (o.data between :data1 and :data2)
    and o.produto = :cod_produto
    and (o.pessoa_fj = :cod_cliente or :cod_cliente = 0)
    into :tempo_resp_med;

    if (:tempo_resp_med is null) then
       tempo_resp_med = 0;

    total_chamados = :chamados_sub + :chamados_tit;
    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_PAGAR (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    DT_CX DATE,
    TIPO CHAR(1))
RETURNS (
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DOCTO VARCHAR(20),
    TIPO_DOCTO CHAR(3),
    CLIENTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    VALOR_NOMINAL FLOAT,
    BX_PARCIAL FLOAT,
    SALDO FLOAT,
    COD_CLASSIFICACAO INTEGER,
    CLASSIFICACAO VARCHAR(50),
    COD_LOCALCOBRANCA INTEGER,
    LOCALCOBRANCA VARCHAR(50),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    COD_REGIAO INTEGER,
    REGIAO VARCHAR(50),
    FONE VARCHAR(20),
    CONTATO VARCHAR(30),
    LOCAL_TRABALHO VARCHAR(50),
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(50),
    UNIDADE VARCHAR(4),
    SUBUNIDADE INTEGER,
    PRD_QTDE FLOAT,
    PRD_UNITARIO FLOAT,
    PRD_DESCONTO FLOAT,
    PRD_TOTAL FLOAT,
    DATA_ULT_BX DATE,
    JUROS FLOAT,
    MULTA FLOAT,
    DESCTO_RES FLOAT,
    ARQ_MORTO CHAR(1),
    VENDA INTEGER)
AS
BEGIN EXIT; END
^

ALTER PROCEDURE PCD_REL_PRODUTOS (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    ICOD_PRODUTO VARCHAR(15),
    CLIENTE INTEGER,
    GRUPO INTEGER,
    SUB_GRUPO INTEGER,
    MARCA INTEGER)
RETURNS (
    PRODUTO VARCHAR(50),
    QTDE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    DESC_RATEADO NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    COD_PRODUTO VARCHAR(15))
AS
DECLARE VARIABLE VD_TOTAL NUMERIC(18,4);
DECLARE VARIABLE VD_DESC NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ITEM NUMERIC(18,4);
DECLARE VARIABLE PCT_REP NUMERIC(18,4);
DECLARE VARIABLE VLR_REP NUMERIC(18,4);
begin
  /*este procedimento tem por objetivo buscar todos os items de um determinado
  perido e empresa, transendo seus respectivos valores ja c/desconto por item
  e o valor rateado de desconto da nota, este servirá de base para a consulta
  que alimentará o reltório de produtos (Frigorífico são luiz)*/
  for select prd.codigo, prd.nome, vd.pessoa_fj, coalesce(vdi.quantidade,0),
    (coalesce(vdi.prc_unitario,0)), coalesce(vd.desc_acres,0),
    coalesce(vd.total,0)
    from fat_vendas vd
    inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
    inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
    left join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
    where ((vd.data_caixa between :dini and :dfim) or vd.data_caixa is null) and vd.cnpj = :cnpj
    and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(cancelada,'N') = 'N'
    and coalesce(vd.fechada,'N') = 'S'
    and ((prd.grupo = :grupo) or (:grupo  = 0))
    and ((prd.subgrupo = :sub_grupo) or (:sub_grupo  = 0))
    and ((prd.marca = :marca) or (:marca  = 0))
    and ((vd.pessoa_fj = :cliente) or (:cliente  = 0))
    and ((prd.codigo = :icod_produto) or (:icod_produto  = ''))
    into :cod_produto, :produto, :pessoa_fj, :qtde, :valor, :vd_desc, :vd_total
  do
  begin
    total_item = (:qtde * :valor);

    /*descobrindo quanto que o total de items deste produto representa no total desta nota
    pra podermos fazer o rateio do desconto da nota*/
    if (:vd_total > 0) then
      pct_rep = ((:total_item * 100)/:vd_total);

    desc_rateado = (:pct_rep * :vd_desc)/100;

    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_RECEBER (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    DT_CX DATE,
    TIPO CHAR(1))
RETURNS (
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DOCTO VARCHAR(20),
    TIPO_DOCTO CHAR(3),
    CLIENTE VARCHAR(50),
    NOME_CLIENTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    PARCELA VARCHAR(6),
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    VALOR_NOMINAL FLOAT,
    BX_PARCIAL FLOAT,
    SALDO FLOAT,
    COD_CLASSIFICACAO INTEGER,
    CLASSIFICACAO VARCHAR(50),
    COD_LOCALCOBRANCA INTEGER,
    LOCALCOBRANCA VARCHAR(50),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    COD_REGIAO INTEGER,
    REGIAO VARCHAR(50),
    CIDADE_NOME VARCHAR(50),
    COD_ROTA INTEGER,
    ROTA VARCHAR(50),
    FONE VARCHAR(20),
    CONTATO VARCHAR(30),
    LOCAL_TRABALHO VARCHAR(50),
    DATA_ULT_BX DATE,
    JUROS FLOAT,
    MULTA FLOAT,
    DESCTO_RES FLOAT,
    ARQ_MORTO CHAR(1),
    VENDA INTEGER,
    VLR_COMISSAO FLOAT,
    PORCENTAGEM FLOAT,
    CIDADE INTEGER,
    NUM_NF INTEGER,
    XMULTA FLOAT)
AS
DECLARE VARIABLE TX_JUROS_APOS FLOAT;
DECLARE VARIABLE TX_JUROS_ATE FLOAT;
DECLARE VARIABLE TIPO_JUROS CHAR(1);
DECLARE VARIABLE TOLERANCIA_JUROS INTEGER;
DECLARE VARIABLE MULTA_FINANCEIRA FLOAT;
DECLARE VARIABLE DATA DATE;
begin
  /*------------------------------------Parâmetros para Cálculo----------------------------------------*/
  select e.tx_juros_apos, e.tx_juros_ate, e.tipo_taxa
  from sis_empresas e
  where cnpj = :cnpj
  into :tx_juros_apos, :tx_juros_ate, :tipo_juros;

  /*tolerância de juros*/
  select coalesce(c.tolerancia_juros,0), coalesce(c.multa_financeira,0)
  from sis_configuracoes c
  where cnpj = :cnpj
  into :tolerancia_juros, :multa_financeira;

  if (upper(:tipo) = 'V') then
  begin
      /*Dt. Vencimento*/
      for select psa.codigo, coalesce(psa.nome_razao,''), rec.tipo_docto, rec.codigo, rec.docto, rec.parcela,
          rec.dt_emissao, rec.dt_vencto, rec.dt_lancto, coalesce(rec.valor,0), coalesce(rec.vlr_parcial,0),
          rec.historico, coalesce(rec.local_cobranca,0), psa.cidade, psa.fone, substring(cli.comprador from 1 for 30), rec.codigo_vn,
          coalesce(rec.arquivo_morto,'N'),
          psa.regiao, coalesce(reg.nome,'Região não definida'), rec.data_ult_baixa, VD.pct_comissao,
          coalesce(CDD.nome,'Cidade não definida'), vd.num_nf
          from fin_contas_receber rec
          inner join glo_pessoas_fj psa on (rec.pessoa_fj = psa.codigo and psa.cnpj = rec.cnpj)
          left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
          left join fat_vendas vd on (vd.codigo = rec.codigo_vn and vd.cnpj = rec.cnpj and vd.pessoa_fj = rec.pessoa_fj)
          left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
          left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
          where rec.cnpj = :cnpj and (rec.dt_vencto between :data1 and :data2)
          into :cod_cliente, :nome_cliente, :tipo_docto, :cod_receber, :docto, :parcela,
          :dt_emissao, :dt_vencto, :dt_lancto, :valor_nominal, :bx_parcial,
          :historico, :cod_localcobranca,:cidade, :fone, :contato, :venda, :arq_morto,
          :cod_regiao, :regiao, :data_ult_bx, :porcentagem,
          :cidade_nome, :num_nf
      do
      begin
        cliente = :cod_cliente||'-'||substring(:nome_cliente from 1 for 38);

        saldo = :valor_nominal - :bx_parcial;

        vlr_comissao = (:saldo * :porcentagem) /100.00;
        data = :dt_vencto;

        if (:data_ult_bx > :dt_vencto) then
            data = :data_ult_bx;

        select p.saldo, p.cod_rota, p.rota, p.cod_classificacao, p.local_trabalho, p.classificacao,
        p.localcobranca,p.cod_vendedor, p.nome_vendedor, p.descto_res,p.juros, p.multa
        from pcd_sub_rel_receber(:cnpj,:cod_cliente,:cod_receber,:dt_cx,:tipo_juros,:tx_juros_ate,:tx_juros_apos,:tolerancia_juros,:multa_financeira,:cidade,:venda,:data,:saldo,:cod_localcobranca) p
        into :saldo, :cod_rota, :rota, :cod_classificacao, :local_trabalho, :classificacao,
             :localcobranca, :cod_vendedor, :nome_vendedor, :descto_res, :juros, :xmulta;

        multa = :xmulta;

        suspend;
      end
  end
  else if (upper(:tipo) = 'L') then
  begin
      /*Dt. Lancto*/
      for select psa.codigo, coalesce(psa.nome_razao,''), rec.tipo_docto, rec.codigo, rec.docto, rec.parcela,
          rec.dt_emissao, rec.dt_vencto, rec.dt_lancto, coalesce(rec.valor,0), coalesce(rec.vlr_parcial,0),
          rec.historico, coalesce(rec.local_cobranca,0), psa.cidade, psa.fone, substring(cli.comprador from 1 for 30), rec.codigo_vn, coalesce(rec.arquivo_morto,'N'),
          psa.regiao, coalesce(reg.nome,'Região não definida'), rec.data_ult_baixa, VD.pct_comissao,
          coalesce(CDD.nome,'Cidade não definida'), vd.num_nf
          from fin_contas_receber rec
          inner join glo_pessoas_fj psa on (rec.pessoa_fj = psa.codigo and psa.cnpj = rec.cnpj)
          left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
          left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
          left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
          left join fat_vendas vd on (vd.codigo = rec.codigo_vn and vd.cnpj = rec.cnpj and vd.pessoa_fj = rec.pessoa_fj)
          where rec.cnpj = :cnpj and (rec.dt_lancto between :data1 and :data2)
          into :cod_cliente, :nome_cliente, :tipo_docto, :cod_receber, :docto, :parcela,
          :dt_emissao, :dt_vencto, :dt_lancto, :valor_nominal, :bx_parcial, :historico, :cod_localcobranca,
          :cidade, :fone, :contato, :venda, :arq_morto,
          :cod_regiao, :regiao,:data_ult_bx, :porcentagem,
          :cidade_nome, :num_nf
      do
      begin
        /*usuários requisitaram o código do cliente no receber*/
        cliente = :cod_cliente||'-'||substring(:nome_cliente from 1 for 38);
        /*Calculando valores de Receber - Parametro para verificar o vencimento é a data do caixa*/
        saldo = :valor_nominal - :bx_parcial;
    
        data = :dt_vencto;
        if (:data_ult_bx > :dt_vencto) then
            data = :data_ult_bx;

    
        saldo = :valor_nominal - :bx_parcial;
    
        vlr_comissao = (:saldo * :porcentagem) /100.00;

        if (:data_ult_bx > :dt_vencto) then
            data = :data_ult_bx;

        select p.saldo, p.cod_rota, p.rota, p.cod_classificacao, p.local_trabalho, p.classificacao,
        p.localcobranca,p.cod_vendedor, p.nome_vendedor, p.descto_res,p.juros, p.multa
        from pcd_sub_rel_receber(:cnpj,:cod_cliente,:cod_receber,:dt_cx,:tipo_juros,:tx_juros_ate,:tx_juros_apos,:tolerancia_juros,:multa_financeira,:cidade,:venda,:data,:saldo,:cod_localcobranca) p
        into :saldo, :cod_rota, :rota, :cod_classificacao, :local_trabalho, :classificacao,
             :localcobranca, :cod_vendedor, :nome_vendedor, :descto_res, :juros, :xmulta;

        multa = :xmulta;

        suspend;
      end
  end
  else
  begin
      /*Dt. Lancto*/
      for select psa.codigo, coalesce(psa.nome_razao,''), rec.tipo_docto, rec.codigo, rec.docto, rec.parcela,
          rec.dt_emissao, rec.dt_vencto, rec.dt_lancto, coalesce(rec.valor,0), coalesce(rec.vlr_parcial,0),
          rec.historico, coalesce(rec.local_cobranca,0), psa.cidade, psa.fone, cli.comprador, rec.codigo_vn, coalesce(rec.arquivo_morto,'N'),
          psa.regiao, coalesce(reg.nome,'Região não definida'), rec.data_ult_baixa, VD.pct_comissao,
          coalesce(CDD.nome,'Cidade não definida'), vd.num_nf
          from fin_contas_receber rec
          inner join glo_pessoas_fj psa on (rec.pessoa_fj = psa.codigo and psa.cnpj = rec.cnpj)
          left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
          left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
          left join glo_cidades cdd on (cdd.codigo = psa.cidade and psa.cnpj = cdd.cnpj)
          left join fat_vendas vd on (vd.codigo = rec.codigo_vn and vd.cnpj = rec.cnpj and vd.pessoa_fj = rec.pessoa_fj)
          where rec.cnpj = :cnpj and (rec.dt_emissao between :data1 and :data2)
          into :cod_cliente, :nome_cliente, :tipo_docto, :cod_receber, :docto, :parcela,
          :dt_emissao, :dt_vencto, :dt_lancto, :valor_nominal, :bx_parcial, :historico, :cod_localcobranca,
          :cidade, :fone, :contato, :venda, :arq_morto, :cod_regiao, :regiao,:data_ult_bx, :porcentagem,
          :cidade_nome, :num_nf
      do
      begin
        cliente = :cod_cliente||'-'||substring(:nome_cliente from 1 for 38);
        /*Calculando valores de Receber - Parametro para verificar o vencimento é a data do caixa*/
        saldo = :valor_nominal - :bx_parcial;
        vlr_comissao = (:saldo * :porcentagem) /100.00;
        data = :dt_vencto;
        if (:data_ult_bx > :dt_vencto) then
            data = :data_ult_bx;
    

        select p.saldo, p.cod_rota, p.rota, p.cod_classificacao, p.local_trabalho, p.classificacao,
        p.localcobranca,p.cod_vendedor, p.nome_vendedor, p.descto_res,p.juros, p.multa
        from pcd_sub_rel_receber(:cnpj,:cod_cliente,:cod_receber,:dt_cx,:tipo_juros,:tx_juros_ate,:tx_juros_apos,:tolerancia_juros,:multa_financeira,:cidade,:venda,:data,:saldo,:cod_localcobranca) p
        into :saldo, :cod_rota, :rota, :cod_classificacao, :local_trabalho, :classificacao,
             :localcobranca, :cod_vendedor, :nome_vendedor, :descto_res, :juros, :xmulta;

        multa = :xmulta;
        suspend;
      end
  end
END
^

ALTER PROCEDURE PCD_REL_SUGESTAO_COMPRA (
    CNPJ VARCHAR(18),
    DATA1 DATE,
    DATA2 DATE,
    COD_FORNECEDOR2 INTEGER)
RETURNS (
    CODIGO VARCHAR(15),
    PRODUTO VARCHAR(80),
    VMM FLOAT,
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    FORNECEDOR VARCHAR(50),
    COD_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    COD_SUBGRUPO INTEGER,
    SUBGRUPO VARCHAR(50),
    UNIDADE VARCHAR(4),
    QTDE_PEDIDA FLOAT,
    QTDE_MAX FLOAT,
    QTDE_MIN FLOAT,
    QTDE FLOAT,
    COD_FORNECEDOR INTEGER)
AS
DECLARE VARIABLE EST_MAX FLOAT;
DECLARE VARIABLE EST_MIN FLOAT;
DECLARE VARIABLE MESES INTEGER;
begin
  /*Percorrendo registros de estoque mínimo*/
  for select prd.codigo,prd.nome, prd.unidade, prd.marca, prd.grupo, prd.subgrupo, prd.qntde_pedida, prd.qtdade_2,
      prd.est_min, prd.est_max, prd.fornecedor
      from est_produtos prd
      where (prd.qtdade_2 < prd.est_min) and prd.cnpj = :cnpj and prd.ativo = 'S' and
      coalesce(prd.neg_qtdade_2,'N') = 'N' and coalesce(prd.servico,'N') = 'N'
      and ((prd.fornecedor = :cod_fornecedor2) or (:cod_fornecedor2 = 0))
  into :codigo, :produto, :unidade, :cod_marca, :cod_grupo, :cod_subgrupo, :qtde_pedida, :qtde,
      :est_min, :est_max, :cod_fornecedor
  do
  begin
    /* Qtde sugerida*/
    qtde_min = (:est_min - :qtde);
    qtde_max = (:est_max - :qtde);

    /*fornecedor*/
    select psa.nome_razao from glo_pessoas_fj psa
    where psa.cnpj = :cnpj and psa.codigo = :cod_fornecedor
    into :fornecedor;

    /*marca de produtos*/
    select mr.nome from est_marcas mr
    where mr.cnpj = :cnpj and mr.codigo = :cod_marca
    into :marca;

    /*grupo de produtos*/
    select gr.nome from est_grupos gr
    where gr.cnpj = :cnpj and gr.codigo = :cod_grupo
    into :grupo;

    /*subgrupo de produtos*/
    select sgr.nome from est_subgrupos sgr
    where sgr.cnpj = :cnpj and sgr.subgrupo = :cod_subgrupo
    and sgr.grupo = :cod_grupo
    into :subgrupo;


    meses = (:data2 - :data1);
    meses = (meses/30);

    /*calculando a venda média mensal*/
    select sum(vdi.quantidade) from fat_vendas_itens vdi
    inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
    where (vd.data_caixa between :data1 and :data2) and vdi.produto = :codigo
    and coalesce(vd.fechada,'N') = 'S' and coalesce(vd.enviada_cx,'N') = 'S'
    and coalesce(vd.cancelada,'N') = 'N'
    into :vmm;

    vmm = (:vmm/:meses);


    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_TITULOS_PENDENTES (
    CNPJ VARCHAR(14),
    E_PESSOA_FJ INTEGER,
    E_DT_VENCTO_1 DATE,
    E_DT_VENCTO_2 DATE,
    E_DT_EMISSAO_1 DATE,
    E_DT_EMISSAO_2 DATE,
    E_JUROS NUMERIC(18,4),
    E_DESCONTO NUMERIC(18,4),
    DTBASE DATE)
RETURNS (
    CODIGO INTEGER,
    TIPO VARCHAR(20),
    COD_PESSOA INTEGER,
    NOME_PESSOA VARCHAR(70),
    DOCTO VARCHAR(20),
    TIPO_DOCTO VARCHAR(3),
    DT_EMISSAO DATE,
    DATA_ULT_BX DATE,
    DT_VENCIMENTO DATE,
    INDEXADOR VARCHAR(20),
    QTDE_INDEXADOR NUMERIC(18,4),
    VARIACAO_INDEXADOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    SALDO_FINAL NUMERIC(18,4),
    VALOR_NOMINAL NUMERIC(18,4),
    AMORTIZACAO NUMERIC(18,4),
    SALDO_NOMINAL NUMERIC(18,4),
    B_JUROS NUMERIC(18,4),
    B_DESCONTOS NUMERIC(18,4),
    B_SALDO_FINAL NUMERIC(18,4),
    B_VALOR_NOMINAL NUMERIC(18,4),
    B_AMORTIZACAO NUMERIC(18,4),
    B_SALDO_NOMINAL NUMERIC(18,4),
    COD_VENDA INTEGER)
AS
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE SALDO FLOAT;
DECLARE VARIABLE TX_JUROS_APOS FLOAT;
DECLARE VARIABLE TX_JUROS_ATE FLOAT;
DECLARE VARIABLE TX_JUROS_CLIENTE FLOAT;
DECLARE VARIABLE IDX_SALDO_QTDE FLOAT;
DECLARE VARIABLE IDX_VLR_TOTAL FLOAT;
DECLARE VARIABLE X_DESCONTO FLOAT;
DECLARE VARIABLE TIPO_TAXA CHAR(1);
DECLARE VARIABLE TOLERANCIA_JUROS INTEGER;
DECLARE VARIABLE DIAS INTEGER;
DECLARE VARIABLE CF INTEGER;
DECLARE VARIABLE NF INTEGER;
DECLARE VARIABLE IDX_COTACAO_FAT FLOAT;
DECLARE VARIABLE IDX_COTACAO_HJ FLOAT;
DECLARE VARIABLE COD_MOEDA INTEGER;
DECLARE VARIABLE COD_IDX INTEGER;
begin
  /*Juros*/
  select e.tx_juros_apos, e.tx_juros_ate, e.tipo_taxa
  from sis_empresas e
  where cnpj = :cnpj
  into :tx_juros_apos, :tx_juros_ate, :tipo_taxa;
    
  /*tolerância de juros*/
  select coalesce(c.tolerancia_juros,0)
  from sis_configuracoes c
  where cnpj = :cnpj
  into :tolerancia_juros;

  for select '1 - RECEBER', rec.codigo, psa.codigo, coalesce(psa.nome_razao,''), rec.tipo_docto, rec.docto,
      rec.dt_emissao, rec.dt_vencto, coalesce(rec.valor,0), coalesce(rec.vlr_parcial,0), rec.data_ult_baixa,
      vd.num_cupom, vd.num_nf, coalesce(rec.idx_qtde,0), coalesce(rec.cod_indexador,0),coalesce(rec.idx_cotacao,0),
      (coalesce(rec.idx_qtde,0) - coalesce(rec.idx_vlr_parcial,0)), rec.codigo_vn
      from fin_contas_receber rec
      inner join glo_pessoas_fj psa on (rec.pessoa_fj = psa.codigo and psa.cnpj = rec.cnpj)
      left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
      left join fat_vendas vd on (vd.codigo = rec.codigo_vn and vd.cnpj = rec.cnpj and vd.pessoa_fj = rec.pessoa_fj)
      where rec.cnpj = :cnpj
      and (rec.dt_vencto between :e_dt_vencto_1 and :e_dt_vencto_2)
      and (rec.dt_emissao between :e_dt_emissao_1 and :e_dt_emissao_2)
      and  ((rec.pessoa_fj = :e_pessoa_fj) or (:e_pessoa_fj = 0))
      into :tipo, :codigo, :cod_pessoa, :nome_pessoa, :tipo_docto, :docto,
      :dt_emissao, :dt_vencimento,  :valor_nominal, :amortizacao, :data_ult_bx,
      :cf, :nf, :qtde_indexador, :cod_idx, :idx_cotacao_fat,
      :idx_saldo_qtde, :cod_venda
  do
  begin
      if (:cod_idx > 0) then
      begin
        select md.codigo, md.sigla from fin_moeda md
        where md.codigo = :cod_idx
        into :cod_moeda, :indexador;

        /*pegando a cotação de hoje*/
        select coalesce(ct.valor,0) from fin_cotacoes ct
        where ct.cod_moeda = :cod_moeda and ct.data = :dtbase
        into :idx_cotacao_hj;

        idx_vlr_total = (:idx_saldo_qtde * :idx_cotacao_hj);
        variacao_indexador = (:idx_vlr_total - (:valor_nominal - :amortizacao));
      end


      saldo_nominal = :valor_nominal - :amortizacao;
      saldo = :saldo_nominal;

      data = :dt_vencimento;

      /*neste caso tomamos como parametro de dt. de vencimento, pois houve uma baixa
      parcial após o vencimento*/
      if (:data_ult_bx > :dt_vencimento) then
        data = :data_ult_bx;

      select coalesce(cli.taxa_juros,0) from glo_clientes cli
      where cli.cnpj = :cnpj and cli.pessoa_fj = :cod_pessoa
      into :tx_juros_cliente;

      if (:e_juros > -1) then /*sinal que foi definido um juros diferenciado*/
      begin
        tx_juros_apos = :e_juros;
        tx_juros_ate  = :e_juros;
      end
      else if (:tx_juros_cliente > 0) then
      begin
        tx_juros_apos = :tx_juros_cliente;
        tx_juros_ate = :tx_juros_cliente;
      end

      /*coloquei esta validação para não ter de modificar o procedimento que calcular o valor de juros, pois
      ele é utilizado em outras partes do banco*/
      if (:e_juros = 0) then
        juros = 0;
      else
      begin
        select coalesce(valor_juros,0) from pcd_calcula_juros(:cnpj,:saldo,:DATA,:dtbase,:TX_JUROS_ATE,:tx_juros_apos,:tipo_taxa,:tolerancia_juros)
        into :juros;
      end

      juros = coalesce(juros,0);
      saldo = coalesce(:saldo,0) + coalesce(:juros,0) ;

      /*Calculando descontos por antecipação */
      if (:e_desconto > 0) then
      begin
        /*Dias de antecipação*/
        dias = (:dt_vencimento - :dtbase); /*N = Período*/

        if (:dias > 0) then
        begin
          /*Calculando o desconto por dia de antecipação*/
          x_desconto = (:e_desconto / 30.00);

          descontos = (:saldo * (:x_desconto * :dias)) /100;
        end
        else
          descontos = 0;
      end
      descontos = coalesce(:descontos,0);

      saldo_final = coalesce(:saldo,0) - coalesce(:descontos,0) + coalesce(:variacao_indexador,0);


      /*valores utilizados para totalização no relatorio*/
      B_JUROS = JUROS;
      B_DESCONTOS = DESCONTOS;
      B_SALDO_FINAL = SALDO_FINAL;
      B_VALOR_NOMINAL = VALOR_NOMINAL;
      B_AMORTIZACAO = AMORTIZACAO;
      B_SALDO_NOMINAL = SALDO_NOMINAL;
      suspend;
  end

  for select '2 - PAGAR', pg.codigo, psa.codigo, coalesce(psa.nome_razao,''), pg.tipo_docto, pg.docto,
      pg.dt_emissao, pg.dt_vencto, coalesce(pg.valor,0), coalesce(pg.vlr_parcial,0), pg.dt_ultima_baixa,
      coalesce(pg.idx_qtde,0), coalesce(pg.cod_indexador,0),coalesce(pg.idx_cotacao,0),
      (coalesce(pg.idx_qtde,0) - coalesce(pg.idx_vlr_parcial,0)), pg.codigo_vn
      from fin_contas_pagar pg
      inner join glo_pessoas_fj psa on (pg.pessoa_fj = psa.codigo and psa.cnpj = pg.cnpj)
      left join fat_vendas vd on (vd.codigo = pg.codigo_vn and vd.cnpj = pg.cnpj and vd.pessoa_fj = pg.pessoa_fj)
      where pg.cnpj = :cnpj
      and (pg.dt_vencto between :e_dt_vencto_1 and :e_dt_vencto_2)
      and (pg.dt_emissao between :e_dt_emissao_1 and :e_dt_emissao_2)
      and  ((pg.pessoa_fj = :e_pessoa_fj) or (:e_pessoa_fj = 0))
      into :tipo, :codigo, :cod_pessoa, :nome_pessoa, :tipo_docto, :docto,
      :dt_emissao, :dt_vencimento,  :valor_nominal, :amortizacao, :data_ult_bx,
      :qtde_indexador, :cod_idx, :idx_cotacao_fat,
      :idx_saldo_qtde, :cod_venda
  do
  begin
      if (:cod_idx > 0) then
      begin
        select ct.cod_moeda, md.nome from fin_cotacoes ct
        inner join fin_moeda md on (md.codigo = ct.cod_moeda)
        where ct.codigo = :cod_idx
        into :cod_moeda, :indexador;

        /*pegando a cotação de hoje*/
        select coalesce(ct.valor,0) from fin_cotacoes ct
        where ct.cod_moeda = :cod_moeda and ct.data = :dtbase
        into :idx_cotacao_hj;

        idx_vlr_total = (:idx_saldo_qtde * :idx_cotacao_hj);
        variacao_indexador = (:idx_vlr_total - (:valor_nominal - :amortizacao));
      end


      juros = 0;

      saldo_nominal = :valor_nominal - :amortizacao;

      saldo = :saldo_nominal;

      data = :dt_vencimento;

      /*neste caso tomamos como parametro de dt. de vencimento, pois houve uma baixa
      parcial após o vencimento*/
      if (:data_ult_bx > :dt_vencimento) then
        data = :data_ult_bx;


      tx_juros_apos = 0;
      tx_juros_ate  = 0;
      juros = coalesce(juros,0);
      saldo = coalesce(:saldo,0) + coalesce(:juros,0) ;

      /*Calculando descontos por antecipação */
      if (:e_desconto > 0) then
      begin
        /*Dias de antecipação*/
        dias = (:dt_vencimento - :dtbase); /*N = Período*/

        if (:dias > 0) then
        begin
          /*Calculando o desconto por dia de antecipação*/
          x_desconto = (:e_desconto / 30.00);

          descontos = (:saldo * (:x_desconto * :dias)) /100;
        end
        else
          descontos = 0;
      end
      descontos = coalesce(:descontos,0);

      saldo_final = coalesce(:saldo,0) - coalesce(:descontos,0) + coalesce(:variacao_indexador,0);

      B_JUROS = (-1 * JUROS);
      B_DESCONTOS = (-1 * DESCONTOS);
      B_SALDO_FINAL = (-1 * SALDO_FINAL);
      B_VALOR_NOMINAL = (-1 * VALOR_NOMINAL);
      B_AMORTIZACAO = (-1 * AMORTIZACAO);
      B_SALDO_NOMINAL = (-1 * SALDO_NOMINAL);
      suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_VD_GRUPO (
    CNPJ VARCHAR(14),
    VENDEDOR INTEGER,
    CLIENTE INTEGER,
    FECHADA CHAR(1),
    DATAINI DATE,
    DATAFIM DATE,
    TIPO_CUSTO INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_PRODUTO VARCHAR(80),
    DATA DATE,
    DATA_CAIXA DATE,
    NOME_RAZAO VARCHAR(50),
    NOME VARCHAR(50),
    QTDE NUMERIC(18,4),
    VLR_VENDA NUMERIC(18,4),
    VLR_DESCONTO NUMERIC(18,4),
    VLR_BRUTO NUMERIC(18,4),
    VLR_CUSTO NUMERIC(18,4))
AS
DECLARE VARIABLE VD_TOTAL NUMERIC(18,4);
DECLARE VARIABLE VD_DESC_ACRES NUMERIC(18,4);
begin
  for select vd.codigo, psa.nome_razao, coalesce(vd.desc_acres,0), coalesce(vd.total,0),
      vd.data, vd.data_caixa, vd.fechada from fat_vendas vd
      inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
      inner join glo_pessoas_fj psa on (vd.pessoa_fj = psa.codigo and vd.cnpj = psa.cnpj)
      where vd.cnpj = :cnpj and coalesce(vd.total,0) > 0 and ((vd.data_caixa between :dataini  and :datafim))
      and (coalesce(vd.cancelada,'N') = 'N') and nat.es = 'S' and nat.computa_venda = 'S'
      and ((vd.pessoa_fj = :cliente) or (:cliente = 0))
      and ((coalesce(vd.fechada,'N') = :fechada))
  into :codigo, :nome_razao, :vd_desc_acres, :vd_total,
       :data, :data_caixa, :fechada
  do
  begin
      for select (coalesce(vdi.produto,'')||'-'||coalesce(prd.nome,'')),
          sum(vdi.quantidade),
          sum(((vdi.prc_unitario - vdi.prc_unit_original) * vdi.quantidade) +((((vdi.prc_unitario * vdi.quantidade) * 100)/:vd_total) * :vd_desc_acres)/100),
          case :tipo_custo
            when 1 then sum(vdi.quantidade * coalesce(vdi.prc_custo,0))
            when 0 then sum(vdi.quantidade * coalesce(vdi.custo_medio,0))
          end,
          sum(vdi.quantidade * (vdi.prc_unit_original)) ,
          sum((vdi.quantidade * (vdi.prc_unitario))+(((((vdi.quantidade * vdi.prc_unitario) * 100)/:vd_total)* :vd_desc_acres)/100)),
          coalesce(grp.nome,'<Sem Grupo>')
          from fat_vendas_itens vdi
          left join est_produtos prd on (vdi.produto = prd.codigo and vdi.cnpj = prd.cnpj)
          left join est_grupos grp on (grp.codigo = prd.grupo and grp.cnpj = prd.cnpj)
          where vdi.cnpj = :cnpj and vdi.codigo = :codigo and grp.selecionado = 'S'
          and ((vdi.vendedor = :vendedor) or (:vendedor = 0))
          group by vdi.produto, prd.nome, grp.nome
      into :nome_produto,
           :qtde,
           :vlr_desconto,
           :vlr_custo,
           :vlr_bruto,
           :vlr_venda,
           :nome
      do
      begin
        suspend;
      end
  end
END
^

ALTER PROCEDURE PCD_REL_VENDAS_GERAIS (
    CNPJ VARCHAR(14),
    DT_INI DATE,
    DT_FIN DATE)
RETURNS (
    N_DOCTO INTEGER,
    NOME_RAZAO VARCHAR(70),
    COD_VENDA INTEGER,
    DATA DATE,
    CFOP INTEGER,
    TIPO_VENDA CHAR(3),
    DATA_CAIXA DATE,
    VLR_BRUTO NUMERIC(18,4),
    VLR_DESC_ACRESC NUMERIC(18,4),
    VLR_TOTAL NUMERIC(18,4),
    VLR_BASE_ICM NUMERIC(18,4),
    VLR_ICM NUMERIC(18,4),
    VLR_ICM_SUB NUMERIC(18,4),
    VLR_BASE_ICM_SUB NUMERIC(18,4),
    CANCELADA CHAR(1),
    STATUS VARCHAR(10),
    TIPO_DOC INTEGER,
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CUPOM INTEGER;
DECLARE VARIABLE TOTAL_SIMPLES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
begin
  /* Procedimento requisitado peo frigorífico(Fechamento Contábil) ou Vendas Fiscais sgund o alessandro,/
  este tem a função de listar todas as vendas no período inclusive as canceladas
  no entanto as canceladas não devem computatar no valor total do relatório */



  for select vd.codigo, coalesce(vd.num_nf,0),coalesce(vd.num_cupom,0) ,coalesce(vd.natureza,0),
      coalesce(vd.tipo_venda,''), vd.data, vd.data_caixa,
      coalesce(vd.desc_acres,0),  coalesce(vd.base_icm,0),coalesce(vd.icm,0),
      vd.pessoa_fj,coalesce(vd.base_icm_subst,0),
      coalesce(vd.valor_icm_subst,0), coalesce(vd.cancelada,''), coalesce(vd.total_nota,0),
      coalesce(vd.total,0)
      from fat_vendas vd
      inner join est_natureza nat on (vd.natureza = nat.codigo)
      where (vd.data_caixa between :dt_ini and :dt_fin) and vd.cnpj = :cnpj
      and vd.fechada = 'S' and /*isso vai filtrar somente vendas c/cupons ou com NF*/
      ((coalesce(vd.num_cupom,0) > 0) or (coalesce(vd.num_nf,0) > 0))
      and nat.computa_venda = 'S' and nat.es = 'S'
      order by vd.data_caixa
      into :cod_venda, :num_nf, :num_cupom, :cfop, :tipo_venda,:data,:data_caixa,:vlr_desc_acresc
      ,:vlr_base_icm, :vlr_icm, :pessoa_fj, :vlr_base_icm_sub, :vlr_icm_sub,:cancelada,:total_nota,:total_simples
  do
      begin
      vlr_total = (:total_simples + :vlr_desc_acresc);
      vlr_bruto = :total_simples;


      /*Nº do documento fiscal*/
      n_docto = 0;
      if (:num_nf > 0) then
      begin
        n_docto = :num_nf;
        tipo_doc = 2;
      end
      else if (:num_cupom > 0) then
      begin
        n_docto = :num_cupom;
        tipo_doc = 1;
      end

      /*pegando o nome do cliente*/
      /*se der pau coloca esse
      select coalesce(psa.nome_razao,'') from glo_pessoas_fj psa*/
      select coalesce(codigo,'')||'-'||coalesce(nome_razao,'') from glo_pessoas_fj psa
      where psa.codigo =:pessoa_fj and psa.cnpj = :cnpj
      into :nome_razao;

      /*zerando valores de notas canceladas p/não influenciar no total*/
      if (:cancelada = 'S') then
      begin
         status = 'Cancelada';
         VLR_BRUTO = 0;
         VLR_DESC_ACRESC = 0;
         VLR_TOTAL = 0;
         VLR_BASE_ICM = 0;
         VLR_ICM = 0;
         VLR_ICM_SUB = 0;
      end
      else
        status = '';

      /*descobrindo a tributação da nota modificação feita p/o frigorífico(João)
      segundo o joão uma mesma nota não conteria items c/tributações diferentes*/
      select max(fvi.cte), max(fvi.ctie) from fat_vendas_itens fvi
      where fvi.codigo = :cod_venda and fvi.cnpj = :cnpj
      into :cte, :ctie;

    suspend;
  end
END
^

ALTER PROCEDURE PCD_REL_VENDAS_MARCA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO_VD INTEGER,
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    TOTAL_ITEM NUMERIC(18,4),
    PESO NUMERIC(18,4),
    TOTAL_PESO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CLIENTE VARCHAR(100),
    COD_MARCA INTEGER,
    MARCA VARCHAR(50),
    N_DOCTO INTEGER,
    DATA_CX DATE,
    DATA_VD DATE,
    CFOP INTEGER,
    UND VARCHAR(10),
    PRODUTO VARCHAR(70),
    SEQUENCIA INTEGER)
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE REP NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE DESC_PROP NUMERIC(18,4);
DECLARE VARIABLE NUM_NF INTEGER;
DECLARE VARIABLE NUM_CP INTEGER;
DECLARE VARIABLE AUX_UNITARIO NUMERIC(18,4);
begin
     for select fv.codigo, fv.vendedor, fv.fechada, fv.total,  coalesce(fv.desc_acres,0), fv.pessoa_fj,
         fv.num_cupom, fv.num_nf, fv.data_caixa, fv.data, nat.codigo
         from fat_vendas fv
         inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
         where fv.cnpj = :cnpj and ((fv.data_caixa between :dini  and :dfim) or (fv.data_caixa is null))
         and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
         into :codigo_vd, :vendedor, :fechada, :total, :desc_acresc,:pessoa_fj,
         :num_cp, :num_nf, :data_cx, :data_vd, :cfop
     do
     begin
        /*Definindo o nº do documento fiscal caso ele exista é claro*/
        if (:num_cp = 0) then
          n_docto = :num_nf;
        else
          n_docto = :num_cp;

        select cast (coalesce(psa.codigo,0) as varchar(15))||'-'||coalesce(psa.nome_razao,'') from glo_pessoas_fj psa
        where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
        into :cliente;

        /*percorrendo itens*/
        for select coalesce(fvi.quantidade,0), coalesce(fvi.prc_unitario,0), coalesce(fvi.desconto,0),
            coalesce(mrc.codigo,0), coalesce(mrc.nome,'SEM MARCA'),coalesce(PRD.unidade,'')||'-'||coalesce(prd.subunidade,0),
            coalesce(prd.codigo,'')||'-'||coalesce(prd.nome,''), fvi.sequencia, fvi.peso, fvi.peso * fvi.quantidade
            from  fat_vendas_itens fvi
            left join est_produtos prd on (prd.codigo = fvi.produto and fvi.cnpj = prd.cnpj)
            left join est_marcas mrc on (mrc.codigo = prd.marca and prd.cnpj = mrc.cnpj)
            where fvi.codigo = :codigo_vd and fvi.cnpj = :cnpj
            into :quantidade, :unitario, :desconto,
            :cod_marca, :marca, :UND, :produto, :sequencia, :peso, :total_peso
        do
        begin
          /*até então aqui é desconsiderado o desconto dado na nf. que terá se ser rateado entre os itens*/
          total_item = ((:unitario) * :quantidade);
          if (:total > 0) then
          begin
            /*Descobrindo qnto o item representa na NF*/
            rep = (:total_item * 100/:total);
  
            /*Desconto proporcional*/
            desc_prop = (:rep * :desc_acresc/100);
  
            /*Apos descoberto o desconto aplicando no item*/
            total_item = :total_item + :desc_prop;
          end
          desconto =  :desc_prop;

          suspend;
        end
     end
END
^

ALTER PROCEDURE PCD_REL_VENDAS_PERIODO (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    TOTAL_BRUTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    DATA TIMESTAMP,
    DATA_CX DATE,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    OBSERVACAO VARCHAR(80),
    TIPO_MOV CHAR(5),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CANCELADA CHAR(1),
    PRD_COD CHAR(15),
    PRD_NOME CHAR(50),
    PRD_UNIDADE CHAR(4),
    PRD_SUBUNIDADE INTEGER,
    PRD_QUANTIDADE NUMERIC(18,4),
    PRD_PRC_UNITARIO NUMERIC(18,4),
    PRD_DESCONTO NUMERIC(18,4),
    PRD_TOTAL NUMERIC(18,4),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    DOCTO CHAR(15))
AS
DECLARE VARIABLE TOTAL_SIMPLES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_TRC NUMERIC(18,4);
DECLARE VARIABLE TOTAL_2 NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC_2 NUMERIC(18,4);
DECLARE VARIABLE SALDO NUMERIC(18,4);
DECLARE VARIABLE NOME VARCHAR(50);
BEGIN
  /* O Relatorio permite filtro de:
  (Fiscal ou Não Fiscal)
  Natureza
  Cliente
  Vendedor
  Usuario
  Vendas Abertas
  Vendas Fechadas
  Trocas
  */

  /*Isso determinará se a venda usa total fiscal ou não*/

  /*procurando em vendas*/
  for select vd.codigo, data, coalesce(fechada,'N'), historico, vd.pessoa_fj,
     usuario, vd.vendedor,natureza, num_nf, num_cupom,
     coalesce(desc_acres,0), coalesce(entrada,0),coalesce(dinheiro,0),
     coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0),
     coalesce(total_nota,0),coalesce(total,0),coalesce(VD.troco,0), vd.nome, vd.nome_consumidor, vd.data_caixa
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
  where ((vd.data_caixa between :dini and :dfim) or (vd.data_caixa is null)) and vd.cnpj = :cnpj
  and  nat.es = 'S' and nat.computa_venda = 'S' and coalesce(cancelada,'N') = 'N'
  into  :codigo,:data,:fechada,:historico,:pessoa_fj,
        :usuario,:vendedor, :natureza, :num_nf,:num_cupom,
        :desc_acres,:entrada,:dinheiro, :cheque,:cartao,
        :ticket,:total_nota, :total_simples, :troco, :nome_consumidor, :nome, :DATA_CX
  do
  begin
      docto = '';
      /* Se for consumidor e estiver preenchido pega o do consumidor */
      if (:pessoa_fj = 1 and coalesce(:nome,'')<>'') then
        nome_consumidor = :nome;
      else
      begin
        select nome_razao from glo_pessoas_fj psa
        where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
        into :nome_consumidor;
      end


        total = (:total_simples + :desc_acres);
        total_bruto = :total_simples;
      /*existem cliente que usam os valores em Total e Total_nota
      if (:total_nota = 0) then
      begin
      end
      else
      begin
        total = (:total_nota + :desc_acres);
        total_bruto = :total_nota;
      end*/

      vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
      vlr_prazo = :total - :vlr_vista; /*desconto acrescimo ja vem negativo se for desconto por isso somo*/

      /*arredondamento*/
      if (:vlr_prazo < 0.01) then
        vlr_prazo = 0;

      desconto = :desc_acres;

      if ((:num_nf <> 0) and (:num_nf is not null)) then
        docto = 'NF-'||cast (:num_nf as char(10));
      else if ((:num_nf <> 0) and (:num_nf is not null)) then
        docto = 'CP-'||cast (:num_nf as char(10));

      for select prd.codigo, prd.nome, prd.unidade, prd.SUBUNIDADE, fvi.quantidade, fvi.prc_unitario,
        fvi.desconto, (fvi.quantidade * ( coalesce(fvi.prc_unitario,0)))  from
        fat_vendas_itens fvi
        inner join est_produtos prd on (fvi.produto = prd.codigo and fvi.cnpj = prd.cnpj)
        where fvi.codigo = :codigo and fvi.cnpj = :cnpj
        into :prd_cod, :prd_nome, :prd_unidade, :prd_subunidade, :prd_quantidade,
        :prd_prc_unitario, :prd_desconto, :prd_total
      do
      begin
        suspend;
      end

  end

  /*########################## Trocas ######################################*/
  for select trc.codigo, data, coalesce(trc.fechado,''), pessoa_fj, usuario, vendedor,
      coalesce(entrada,0),coalesce(dinheiro,0),
      coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0),
      coalesce(total,0), coalesce(desc_acresc,0), coalesce(total_2,0), coalesce(desc_acresc_2,0),
      entrada, trc.nome_consumidor
      from fat_trocas trc
      where (trc.data_caixa between :dini and :dfim) and trc.cnpj = :cnpj
      and coalesce(cancelada,'N') = 'N'
      into :codigo,:data, :fechada,:pessoa_fj, :usuario,:vendedor,
      :entrada, :dinheiro, :cheque,:cartao, :ticket,
      :total_trc, :desc_acres, :total_2, :desc_acresc_2,
      :entrada, :nome
  do
  begin
    if (:pessoa_fj = 1 and coalesce(:nome,'')<>'') then
        nome_consumidor = :nome;
    else
    begin
        select nome_razao from glo_pessoas_fj psa
        where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
        into :nome_consumidor;
    end

    docto  = 'TRC';
    saldo = (:total_2 + :desc_acresc_2) - (:total + :desc_acres);


    saldo = (:total_2 + :desc_acresc_2) - (:total_trc + :desc_acres);
    if (saldo > 0) then
    begin
      vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
      if (vlr_vista > saldo) then
        vlr_vista = saldo;
      vlr_Prazo = :saldo - :vlr_vista;
    end
    else
    begin
      vlr_vista = :saldo;
      vlr_Prazo = 0;
    end

    /*vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
    vlr_Prazo = :saldo - :vlr_vista;*/

    total = SALDO;
    total_bruto = SALDO;
    desconto = 0;
    natureza = 0;
    for select prd.codigo, prd.nome, prd.unidade, prd.SUBUNIDADE, fti.quantidade, fti.prc_unitario,
        fti.desconto, (fti.quantidade * fti.prc_unitario)  from
        fat_trocas_itens fti
        inner join est_produtos prd on (fti.produto = prd.codigo and fti.cnpj = prd.cnpj)
        where fti.codigo = :codigo and fti.cnpj = :cnpj
        into :prd_cod, :prd_nome, :prd_unidade, :prd_subunidade, :prd_quantidade,
        :prd_prc_unitario, :prd_desconto, :prd_total
    do
    begin
      SUSPEND;
    end

  end
END
^

ALTER PROCEDURE PCD_REL_VENDAS_PERIODO_SINT (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    TOTAL NUMERIC(18,4),
    TOTAL_BRUTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    DATA DATE,
    DATA_CX DATE,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    OBSERVACAO VARCHAR(80),
    TIPO_MOV CHAR(5),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    CANCELADA CHAR(1),
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4),
    DOCTO CHAR(15))
AS
DECLARE VARIABLE TOTAL_SIMPLES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE SALDO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_TRC NUMERIC(18,4);
DECLARE VARIABLE TOTAL_2 NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC_2 NUMERIC(18,4);
BEGIN
  /* O Relatorio permite filtro de:
  (Fiscal ou Não Fiscal)
  Natureza
  Cliente
  Vendedor
  Usuario
  Vendas Abertas
  Vendas Fechadas
  Trocas
  */

  /*Isso determinará se a venda usa total fiscal ou não*/

  /*procurando em vendas*/
  for select vd.codigo, data, fechada, vd.pessoa_fj,
     usuario , vd.vendedor,natureza, coalesce(num_nf,0),
     coalesce(num_cupom,0), coalesce(desc_acres,0),
     coalesce(entrada,0),coalesce(dinheiro,0),
     coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0),
     coalesce(total_nota,0),coalesce(total,0),coalesce(VD.troco,0),
     VD.data_caixa, vd.nome_consumidor
  from fat_vendas vd
  inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
  where ((vd.data_caixa between :dini and :dfim) or (vd.data_caixa is null)) and vd.cnpj = :cnpj
  and nat.computa_venda = 'S' and nat.es = 'S' and ((cancelada <> 'S') or (cancelada is null))
  into  :codigo,:data,:fechada,:pessoa_fj,
        :usuario,:vendedor, :natureza, :num_nf,:num_cupom,
        :desc_acres,:entrada,:dinheiro, :cheque,:cartao,
        :ticket, :total_nota, :total_simples, :troco, :data_cx, :nome_consumidor
  do
  begin
      /* Cliente CONSUMIDOR, pegar o nome digitado na venda */
      if(:pessoa_fj <> 1)then
      begin
          select psa.nome_razao from glo_pessoas_fj psa
          where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
          into :nome_consumidor;
      end

      /*existem cliente que usam os valores em Total e Total_nota*/
      docto = '';
      desconto = :desc_acres;

        total = (:total_simples + :desc_acres);
        total_bruto = :total_simples;
      /*if (:total_nota = 0) then
      begin
      end
      else
      begin
        total = (:total_nota + :desc_acres);
        total_bruto = :total_nota;
      end*/

      vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
       /*por conta do faturamento no caixa*/
      if (:vlr_vista = :total_bruto) then
      begin
        vlr_prazo = 0;
        vlr_vista = :total;
      end
      else
        vlr_prazo = :total - :vlr_vista; 

      /*arredondamento*/
      if (:vlr_prazo < 0.01) then
        vlr_prazo = 0;



      if ((:num_nf <> 0) and (:num_nf is not null)) then
        docto = 'NF-'||cast (:num_nf as char(10));
      else if ((:num_cupom <> 0) and (:num_cupom is not null)) then
        docto = 'CP-'||cast (:num_cupom as char(10));

      suspend;
  end

  for select trc.codigo, data, trc.fechado, pessoa_fj, usuario, vendedor,
      coalesce(entrada,0),coalesce(dinheiro,0),
      coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0),
      coalesce(total,0), coalesce(desc_acresc,0), coalesce(total_2,0), coalesce(desc_acresc_2,0),
      entrada, data_caixa, trc.nome_consumidor
  from fat_trocas trc
  where ((trc.data_caixa between :dini and :dfim) or (trc.data_caixa is null)) and trc.cnpj = :cnpj
  and ((cancelada <> 'S') or (cancelada is null))
  into :codigo,:data, :fechada,:pessoa_fj, :usuario,:vendedor,
      :entrada, :dinheiro, :cheque,:cartao, :ticket,
      :total_trc, :desc_acres, :total_2, :desc_acresc_2,
      :entrada, :data_cx, :nome_consumidor
  do
  begin
    if (:codigo = 395) then
      codigo = :codigo;

    /* Cliente CONSUMIDOR, pegar o nome digitado na venda */
    if(:pessoa_fj <> 1)then
    begin
        select psa.nome_razao from glo_pessoas_fj psa
        where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
        into :nome_consumidor;
    end

    docto  = 'TRC';
    saldo = (:total_2 + :desc_acresc_2) - (:total_trc + :desc_acres);
    if (saldo > 0) then
    begin
      vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
      if (vlr_vista > saldo) then
        vlr_vista = saldo;
      vlr_Prazo = :saldo - :vlr_vista;
    end
    else
    begin
      vlr_vista = :saldo;
      vlr_Prazo = 0;
    end

    natureza = NULL;
    total = SALDO;
    total_bruto = SALDO;
    desconto = 0;
    SUSPEND;

  end
END
^

ALTER PROCEDURE PCD_REPROCESSA_CUSTO_MEDIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    DATA DATE)
RETURNS (
    CUSTOMEDIO FLOAT)
AS
DECLARE VARIABLE DATA_ENT DATE;
DECLARE VARIABLE QTDE FLOAT;
DECLARE VARIABLE CUSTO FLOAT;
DECLARE VARIABLE DATATEMP DATE;
DECLARE VARIABLE CODTEMP INTEGER;
DECLARE VARIABLE QTDETEMP FLOAT;
DECLARE VARIABLE CUSTOTEMP FLOAT;
DECLARE VARIABLE SQTDE FLOAT;
DECLARE VARIABLE EQTDE FLOAT;
DECLARE VARIABLE QTDEESTOQUE FLOAT;
DECLARE VARIABLE CUSTOESTOQUE FLOAT;
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE DATAMIN DATE;
DECLARE VARIABLE CODKARDEX INTEGER;
DECLARE VARIABLE ESTINICIAL FLOAT;
begin
  delete from TEMP_CUSTO_MEDIO;

  for select et.ndocto, et.data_ent from est_entradas et
      inner join est_entradas_itens eti on (eti.cnpj = et.cnpj and eti.ndocto = et.ndocto)
      where et.data_ent <= :data and eti.produto = :produto and et.cnpj = :cnpj and et.proc_custo = 'S'
      order by et.data_ent
  into :ndocto, :datamin
  do
  begin
    custoestoque = 0;
    break;
  end

  select max(codigo) from est_kardex k
  where k.cnpj = :cnpj and k.produto = :produto and k.dt_kardex <= :datamin and k.ndocto <> :ndocto
  and ((k.origem <> 'ENTF') or (k.origem <> 'ENTF-E'))
  into :codkardex;

  select case k.tipo_es
              when 'S' then (k.qtdade_ant - k.qtdade)
              else (k.qtdade_ant + k.qtdade)
         end
         from est_kardex k
  where k.codigo = :codkardex
  into :estinicial;

  for select et.ndocto, et.data_ent from est_entradas et
      inner join est_entradas_itens eti on (eti.cnpj = et.cnpj and eti.ndocto = et.ndocto)
      where et.data_ent <= :data and eti.produto = :produto and et.cnpj = :cnpj and et.proc_custo = 'S'
      order by et.data_ent
  into :ndocto, :data_ent
  do
  begin
    /*select max(codigo) from est_kardex k
    where k.cnpj = :cnpj and k.produto = :produto and k.dt_movto <= :data_ent and k.ndocto = :ndocto
    into :codkardex;
    
    select k.qtdade_ant
    from est_kardex k
    where k.codigo = :codkardex
    into :estinicial; */
    
    custoestoque = 0;

    select max(temp.codigo) from temp_custo_medio temp
    into :codtemp;

    if (coalesce(:codtemp,0) > 0) then
    begin
        /*pegando a data e quantidade anterior do estoque*/
        select temp.dt_ent, temp.qtde, temp.custo_medio  from temp_custo_medio temp
        where temp.codigo = :codtemp
        into :datatemp, :qtdetemp, :custotemp;
    
        /*vendas do item efetuadas no periodo*/
        select sum(vdi.quantidade) from fat_vendas_itens vdi
        inner join fat_vendas vd on (vd.cnpj = :cnpj and vdi.codigo = vd.codigo)
        inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
        where vdi.cnpj = :cnpj and vdi.produto = :produto and (vd.data between :datatemp and :data_ent)
        and coalesce(vd.fechada,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N' and nat.es = 'S' and nat.mov_estoque = 'S'
        into :sqtde;
    
        /*considerando também as devoluções*/
        select sum(vdi.quantidade) from fat_vendas_itens vdi
        inner join fat_vendas vd on (vd.cnpj = :cnpj and vdi.codigo = vd.codigo)
        inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
        where vdi.cnpj = :cnpj and vdi.produto = :produto and (vd.data between :datatemp and :data_ent)
        and coalesce(vd.fechada,'N') = 'E' and coalesce(vd.cancelada,'N') = 'N' and nat.es = 'S' and nat.mov_estoque = 'S'
        into :eqtde;
    
        qtdeestoque = (:qtdetemp - (coalesce(:sqtde,0) - coalesce(:eqtde,0)));
        custoestoque = (:qtdeestoque * :custotemp);
    end

    for select eti2.prc_unitario, eti2.quantidade from est_entradas_itens eti2
        where eti2.cnpj = :cnpj and eti2.produto = :produto and eti2.ndocto = :ndocto
        into :custo, :qtde
    do
    begin
      /*produto ja tem estoque*/
      if (:custoestoque > 0) then
        customedio = ((:qtdeestoque * :custotemp) + (:qtde * :custo))/(:qtde + :qtdeestoque);
      else
        customedio = :custo;

      qtdeestoque = coalesce(:qtdeestoque,0) + coalesce(:qtde,0) + coalesce(:estinicial,0);
      estinicial = 0;

      insert into temp_custo_medio (QTDE, CUSTO, CUSTO_MEDIO, dt_ent)
      values (:qtdeestoque, cast(:custo as float), cast(:customedio as float), :data_ent);
    end
  end
  suspend;
end
^

ALTER PROCEDURE PCD_RESUMO_CAIXA (
    CNPJ VARCHAR(14),
    DATA_CX DATE,
    USUARIO INTEGER,
    TURNO INTEGER,
    CONTA INTEGER)
RETURNS (
    DIN_VDVISTA NUMERIC(18,4),
    DIN_VDPRAZO NUMERIC(18,4),
    DIN_RECBTO NUMERIC(18,4),
    CHVISTA_VDVISTA NUMERIC(18,4),
    CHVISTA_VDPRAZO NUMERIC(18,4),
    CHVISTA_RECBTO NUMERIC(18,4),
    CHPRE_VDVISTA NUMERIC(18,4),
    CHPRE_VDPRAZO NUMERIC(18,4),
    CHPRE_RECBTO NUMERIC(18,4),
    CRTVISTA_VDVISTA NUMERIC(18,4),
    CRTVISTA_VDPRAZO NUMERIC(18,4),
    CRTVISTA_RECBTO NUMERIC(18,4),
    CRTPRE_VDVISTA NUMERIC(18,4),
    CRTPRE_VDPRAZO NUMERIC(18,4),
    CRTPRE_RECBTO NUMERIC(18,4),
    TICKET_VDVISTA NUMERIC(18,4),
    TICKET_VDPRAZO NUMERIC(18,4),
    TICKET_RECBTO NUMERIC(18,4),
    TOTAL_DINHEIRO NUMERIC(18,4),
    TOTAL_CHEQUE_VISTA NUMERIC(18,4),
    TOTAL_CHEQUE_PRE NUMERIC(18,4),
    TOTAL_CARTAO_VISTA NUMERIC(18,4),
    TOTAL_CARTAO_PRE NUMERIC(18,4),
    TOTAL_TROCO NUMERIC(18,4),
    TROCO_VDVISTA NUMERIC(18,4),
    TROCO_VDPRAZO NUMERIC(18,4),
    TOTAL_VALE_TROCO NUMERIC(18,4),
    TOTAL_GERAL NUMERIC(18,4),
    TOTAL_CHEQUE NUMERIC(18,4),
    TOTAL_CARTAO NUMERIC(18,4),
    TOTAL_TICKET NUMERIC(18,4),
    TOTAL_ENTCX NUMERIC(18,4),
    TOTAL_SAIDACX NUMERIC(18,4),
    TOTAL_VDVISTA NUMERIC(18,4),
    TOTAL_VDPRAZO NUMERIC(18,4),
    TOTAL_PARCELADO NUMERIC(18,4),
    TOTAL_CAIXA NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    CP_SLD_ANT CHAR(1),
    AB_CXDINHEIRO NUMERIC(18,4),
    AB_CXMOEDA NUMERIC(18,4),
    AB_CXCHEQUE NUMERIC(18,4),
    AB_CXCHEQUE_PRAZO NUMERIC(18,4),
    AB_CXTICKET NUMERIC(18,4),
    AB_CXTOTAL NUMERIC(18,4))
AS
DECLARE VARIABLE TRC_VALE CHAR(1);
DECLARE VARIABLE CH_INFLUENCIA CHAR(1);
DECLARE VARIABLE EXIBE_ACERTO CHAR(1);
DECLARE VARIABLE CRT_INFLUENCIA CHAR(1);
DECLARE VARIABLE MUDOU CHAR(1);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE TIPO_VENDA VARCHAR(3);
DECLARE VARIABLE VLR_PRAZO NUMERIC(18,4);
DECLARE VARIABLE VLR_VISTA NUMERIC(18,4);
DECLARE VARIABLE TIPO VARCHAR(5);
DECLARE VARIABLE CHEQUE_VISTA CHAR(1);
DECLARE VARIABLE CARTAO_VISTA_AUX VARCHAR(1);
DECLARE VARIABLE DATA_LANCTO_CRT DATE;
DECLARE VARIABLE DATA_REEMB_CRT DATE;
DECLARE VARIABLE DATA_LANCTO_CH DATE;
DECLARE VARIABLE DATA_PRE_CH DATE;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE VAR_VLR_CH NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_CRT NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_RECBTO NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_CAIXA NUMERIC(18,4);
DECLARE VARIABLE TIPOMOV CHAR(1);
DECLARE VARIABLE TOTAL_ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE TOTAL_SAIDAS NUMERIC(18,4);
DECLARE VARIABLE DIGITA_CRT CHAR(1);
DECLARE VARIABLE DIGITA_CH CHAR(1);
DECLARE VARIABLE FORMA_PGTO INTEGER;
DECLARE VARIABLE FORMA_VISTA CHAR(1);
begin
  /*zerando valores*/
  CRTPRE_VDPRAZO   = 0;
  CRTVISTA_VDPRAZO = 0;
  CHPRE_VDPRAZO    = 0;
  CHVISTA_VDPRAZO  = 0;
  DIN_VDVISTA      = 0;
  DIN_VDPRAZO      = 0;
  DIN_RECBTO       = 0;
  CHVISTA_VDVISTA  = 0;
  CHVISTA_RECBTO   = 0;
  CHPRE_VDVISTA    = 0;
  CHPRE_RECBTO     = 0;
  CRTVISTA_VDVISTA = 0;
  CRTVISTA_RECBTO  = 0;
  CRTPRE_VDVISTA   = 0;

  CRTPRE_RECBTO    = 0;
  TICKET_VDVISTA   = 0;
  TICKET_VDPRAZO   = 0;
  TICKET_RECBTO    = 0;
  TOTAL_DINHEIRO   = 0;
  TOTAL_CHEQUE_VISTA = 0;
  TOTAL_CHEQUE_PRE   = 0;
  TOTAL_CARTAO_VISTA = 0;
  TOTAL_CARTAO_PRE   = 0;
  TOTAL_TROCO        = 0;
  TOTAL_VALE_TROCO   = 0;
  TOTAL_CARTAO_VISTA = 0;
  TOTAL_GERAL        = 0;
  TOTAL_CHEQUE       = 0;
  TOTAL_CARTAO       = 0;
  TOTAL_TICKET       = 0;
  TOTAL_ENTCX        = 0;
  TOTAL_SAIDACX      = 0;
  TOTAL_VDVISTA      = 0;
  TOTAL_VDPRAZO      = 0;
  TOTAL_PARCELADO    = 0;

  troco_vdvista      = 0;
  troco_vdprazo      = 0;
  select emp.crt_influencia_venda, emp.ch_influencia_venda, emp.DIG_CHEQUE_VENDA, emp.dig_cartao_venda, coalesce(emp.exibe_acerto_contas,'N')
  from sis_empresas emp
  where emp.cnpj = :cnpj
  into :ch_influencia, :crt_influencia, :digita_ch, :diGita_crt, :exibe_acerto;

 /*#######################################################NOVO CAIXA######################################################*/
 /*vendas*/
  for select vd.codigo, coalesce(desc_acres,0), coalesce(entrada,0),
  coalesce(dinheiro,0), coalesce(cheque,0), coalesce(cartao,0),coalesce(TICKET,0),
  coalesce(total,0), tipo_venda,coalesce(troco,0), coalesce(vale_troco,''), vd.forma_pgto
  from fat_vendas vd/*pego as vendas que estemjam na data de caixa */
  inner join est_natureza nat on (vd.natureza = nat.codigo  and vd.cnpj = nat.cnpj)
  where vd.cnpj = :cnpj and usuario = :usuario and data_caixa = :data_cx
  and turno = :turno and fechada = 'S' and enviada_cx = 'S'
  and nat.computa_venda = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :desc_acres, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :tipo_venda, :troco, :trc_vale, :forma_pgto
  do
  begin
   select coalesce(pgt.avista,'N') from fin_formas_pagto pgt
   where pgt.cnpj = :cnpj and pgt.codigo = :forma_pgto
   into :forma_vista;

     if (:codigo = 17210) then
      codigo = :codigo;
    /*troco em vendas*/
    /*troco feito em vale*/
    if(:trc_vale = 'S') then
      total_vale_troco = :total_vale_troco + troco;
    else
      total_troco = :total_troco + troco;

    total_dinheiro = :total_dinheiro + dinheiro;
    total_ticket = :total_ticket + :ticket;

    /*Neste procedimento há uma verificação */
    Mudou = 'N';
    vlr_vista = coalesce(:dinheiro,0) + coalesce(:cartao,0) + coalesce(:cheque,0) + coalesce(:ticket,0) + coalesce(:troco,0);

    if ((:vlr_vista = 0) and (:forma_vista = 'S')) then
       vlr_vista = :total + :desc_acres;

    vlr_prazo = (:total + :desc_acres) - :vlr_vista;/*desconto já vem negativo*/

    /*acertando diferenças de arredondamentos*/
    if (:vlr_prazo < 0.01) then
      vlr_prazo = 0;

    if (((:VLR_vista > 0) and (:tipo_venda <> 'FFT') and (:vlr_prazo = 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

   /**************Esse bloco é so pra determinar se a venda é transformada em a prazo caso tenha DOCS a prazo**********/
    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if ((:cartao > 0) and (:crt_influencia = 'S')) then
      begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso from fin_movimento_cartao crt
          where crt.venda = :codigo and crt.cnpj = :cnpj
          into :data_lancto_crt, :data_reemb_crt
          do
          begin
            if (:data_reemb_crt > :data_lancto_crt) then
              cartao_vista_aux = 'N';
          end
      end

      if ((:cheque > 0) and (:ch_influencia = 'S')) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
      begin
        tipo = 'Prazo';
        MUDOU = 'S'; /*status do movimento mudou*/
      end

    end

    total = (:total + :desc_acres);
   /*****************************************FINAL DO BLOCO ACIMA***************************************************/

   /*Vlrs. a Vista*/
   if (tipo = 'Vista')then
   begin
     /*Não estou debitando o troco diretamente aqui .. dpois eu explico*/
     troco_vdvista = :troco_vdvista + troco;

     TOTAL_VDVISTA = :TOTAL_VDVISTA + :total;

     /*Dinheiro de venda vista*/
     din_vdvista = :din_vdvista + :dinheiro;
     ticket_vdvista = :ticket_vdvista + :ticket;
     /*verificando cheques na venda a vista*/
     if (:cheque > 0) then
     begin
        /*se não há desdobramento todos os cheques são a vista*/
        if (:digita_ch <> 'S') then
        begin
          chvista_vdvista      = :chvista_vdvista + :cheque;
          total_cheque_vista   = :total_cheque_vista + :cheque;
          total_cheque         = :total_cheque + :cheque;
        end

         /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date,ch.valor  from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdvista    = :chpre_vdvista + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque     = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdvista    = :chvista_vdvista + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque       = :total_cheque + :var_vlr_ch;
          end
        end
     end

     if (:cartao > 0) then
     begin
        if (:digita_crt <> 'S') then
        begin
          crtvista_vdvista      = :crtvista_vdvista + :cartao;
          total_cartao_vista    = :total_cartao_vista + :cartao;
          total_cartao          = :total_cartao + :cartao;
        end

        for select crt.data, crt.reembolso, crt.valor from fin_movimento_cartao crt
        where crt.venda = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdvista    = :crtpre_vdvista + :var_vlr_crt;
            total_cartao_pre  = :total_cartao_pre + :var_vlr_crt;
            total_cartao      = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdvista    = :crtvista_vdvista + :var_vlr_crt;
            total_cartao_vista  = :total_cartao_vista + :var_vlr_crt;
            total_cartao        = :total_cartao + :var_vlr_crt;
          end
        end
      end

   end /*Vlrs. a Prazo*/
   else if (tipo = 'Prazo')then
   begin
     troco_vdprazo = :troco_vdprazo + troco;
     /* Aqui na verdade são vlrs. de entrada do crediário*/
     /*Dinheiro de venda a prazo */
     din_vdprazo = :din_vdprazo + :dinheiro;
     ticket_vdprazo = :ticket_vdprazo + :ticket;
     var_vlr_ch = 0;
     var_vlr_crt = 0;
     /*verificando cheques na venda a vista*/
     if (:cheque > 0) then
     begin
        if (:digita_ch <> 'S') then
          chvista_vdprazo = :chvista_vdprazo + :cheque;
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date,coalesce(ch.valor,0)  from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdprazo    = :chpre_vdprazo + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque     = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdprazo    = :chvista_vdprazo + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque       = :total_cheque + :var_vlr_ch;
          end
        end
     end

     if (:cartao > 0) then
     begin
        if (:digita_crt <> 'S') then
          crtvista_vdprazo = :crtvista_vdprazo + :cartao;

        for select crt.data, crt.reembolso,coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.venda = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdprazo    = :crtpre_vdprazo + :var_vlr_crt;
            total_cartao_pre  = :total_cartao_pre + :var_vlr_crt;
            total_cartao      = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdprazo    = :crtvista_vdprazo + :var_vlr_crt;
            total_cartao_vista  = :total_cartao_vista + :var_vlr_crt;
            total_cartao        = :total_cartao + :var_vlr_crt;
          end

        end
      end
     TOTAL_VDPRAZO = :total_vdprazo + :total;                    /*os valores de cartão são expostos, de modo que eles tem de ser debitados do parcelado "*/
     TOTAL_PARCELADO = :TOTAL_PARCELADO + (:total - :entrada);/* - (:var_vlr_crt + :var_vlr_ch);*/
   end
  end

  /*Trocas*/
  for select codigo, entrada, dinheiro, cheque, cartao, TICKET,
  ((coalesce(total_2,0) + coalesce(desc_acresc_2,0))-(coalesce(Total,0) + coalesce(desc_acresc,0)))
  from fat_trocas trc/*pego as vendas que estemjam na data de caixa */
  where cnpj = :cnpj and usuario = :usuario and data_caixa = :data_cx
  and turno = :turno and fechado = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total
  do
  begin
    total_dinheiro = :total_dinheiro + dinheiro;
    total_ticket   = :total_ticket + :ticket;

    vlr_vista      = :dinheiro + :cartao + :cheque + :ticket;
    if (:vlr_vista > :total) then
    begin
      troco_vdvista = :troco_vdvista + (:vlr_vista - :total);
      vlr_vista = :total;
    end
    vlr_prazo = :total - :vlr_vista;
    /*pq existem trocas em que´só á entradas de mercadorias
    ficando com um  valor a vista negativo*/
    if (((:VLR_vista <> 0) and (:vlr_prazo <= 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if ((:cartao > 0) and (:crt_influencia = 'S')) then
      begin
        /*verificando se cartão a vista ou prazo*/
        /*porque pode ser um parcelamento de cartão*/
        for select crt.data, crt.reembolso from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
            cartao_vista_aux = 'N';
        end
      end

      if ((:cheque > 0) and (:ch_influencia = 'S')) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
        tipo = 'Prazo';
    end


    /*Vlrs. a Vista*/
    if (tipo = 'Vista')then
    begin
      /*Não estou debitando o troco diretamente aqui .. dpois eu explico*/
      TOTAL_VDVISTA = :TOTAL_VDVISTA + vlr_vista;

      /*Dinheiro de venda vista*/
      din_vdvista = :din_vdvista + :dinheiro;
      ticket_vdvista = :ticket_vdvista + :ticket;
      /*verificando cheques na venda a vista*/
      if (:cheque > 0) then
      begin
        for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdvista    = :chpre_vdvista + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque     = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdvista    = :chvista_vdvista + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque       = :total_cheque + :var_vlr_ch;
          end
        end
      end
    
      if (:cartao > 0) then
      begin
        for select crt.data, crt.reembolso,coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdvista    = :crtpre_vdvista + :var_vlr_crt;
            total_cartao_pre  = :total_cartao_pre + :var_vlr_crt;
            total_cartao      = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdvista    = :crtvista_vdvista + :var_vlr_crt;
            total_cartao_vista  = :total_cartao_vista + :var_vlr_crt;
            total_cartao        = :total_cartao + :var_vlr_crt;
          end
    
        end
      end
    
    end /*Vlrs. a Prazo*/
    else if (tipo = 'Prazo')then
    begin
      /* Aqui na verdade são vlrs. de entrada do crediário*/
      var_vlr_ch = 0;
      /*Dinheiro de venda a prazo */
      din_vdprazo = :din_vdprazo + :dinheiro;
      ticket_vdprazo = :ticket_vdprazo + :ticket;
      var_vlr_crt = 0;
      var_vlr_ch = 0;
      /*verificando cheques na venda a vista*/
      if (:cheque > 0) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdprazo    = :chpre_vdprazo + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque     = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdprazo    = :chvista_vdprazo + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque       = :total_cheque + :var_vlr_ch;
          end
        end
      end
    
      if (:cartao > 0) then
      begin
        for select crt.data, crt.reembolso, coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdprazo    = :crtpre_vdprazo + :var_vlr_crt;
            total_cartao_pre  = :total_cartao_pre + :var_vlr_crt;
            total_cartao      = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdprazo    = :crtvista_vdprazo + :var_vlr_crt;
            total_cartao_vista  = :total_cartao_vista + :var_vlr_crt;
            total_cartao        = :total_cartao + :var_vlr_crt;
          end
    
        end
      end
      TOTAL_PARCELADO = :TOTAL_PARCELADO + (:total - :entrada);/* - :var_vlr_crt - :var_vlr_ch;*/
      total_vdprazo = :total_vdprazo + :total;
    end /*final prazo*/
  end


  /*cheques em receber*/
  for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
  where ch.venda is null and ch.troca is null
  and ch.cnpj = :cnpj and ch.data_caixa = :data_cx and ch.usuario = :usuario and ch.turno = :turno
  into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
  do
  begin
    if (:data_pre_ch > :data_lancto_ch) then
    begin
      chpre_recbto     = :chpre_recbto + :var_vlr_ch;
      total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
      total_cheque     = :total_cheque + :var_vlr_ch;
    end
    else
    begin
      chvista_recbto     = :chvista_recbto + :var_vlr_ch;
      total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
      total_cheque       = :total_cheque + :var_vlr_ch;
    end
  end

  /*data no cartão é a data do caixa*/
  for select crt.data, crt.reembolso, coalesce(crt.valor,0) from fin_movimento_cartao crt
  where crt.venda is null and crt.troca is null and crt.cnpj = :cnpj
  and crt.turno = :turno and crt.usuario = :usuario and crt.data = :data_cx
  into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
  do
  begin
    if (:data_reemb_crt > :data_lancto_crt) then
    begin
      crtpre_recbto     = :crtpre_recbto + :var_vlr_crt;
      total_cartao_pre  = :total_cartao_pre + :var_vlr_crt;
      total_cartao      = :total_cartao + :var_vlr_crt;
    end
    else
    begin
      crtvista_recbto     = :crtvista_recbto + :var_vlr_crt;
      total_cartao_vista  = :total_cartao_vista + :var_vlr_crt;
      total_cartao        = :total_cartao + :var_vlr_crt;
    end
  end

  for select coalesce(cx.valor,0), coalesce(cx.tipo,'') from fat_caixas_movimentos cx
  where cx.data = :data_cx and cx.turno = :turno and cx.conta = :conta and cx.usuario = :usuario
  into :var_vlr_caixa, :tipomov
  do
  begin
    if (:tipomov = 'C') then
      total_entcx = :var_vlr_caixa + :total_entcx;
    else
      total_saidacx = :var_vlr_caixa + :total_saidacx;
  end

  if (:exibe_acerto = 'N') then
  begin
    /*Contas pagas também totalizando nas saidas do caixa*/
    select coalesce(sum(bx.vlr_baixa),0) from fin_baixas_pagar bx
    where bx.dt_baixa =:data_cx and bx.turno = :turno
    and bx.conta = :conta and bx.cnpj = :cnpj and bx.usuario = :usuario
    into :var_vlr_caixa;

    /*total de dinheiro do recbemento*/
    select sum(coalesce(bx.vlr_baixa,0)) from fin_baixas_receber bx
    where bx.dt_baixa =:data_cx and bx.turno = :turno
    and bx.conta = :conta and bx.cnpj = :cnpj and bx.usuario = :usuario
    into :din_recbto;
  end
  else
  begin
    /*Contas pagas também totalizando nas saidas do caixa*/
    select coalesce(sum(bx.vlr_baixa),0) from fin_baixas_pagar bx
    where bx.dt_baixa =:data_cx and bx.turno = :turno
    and bx.conta = :conta and bx.cnpj = :cnpj and bx.usuario = :usuario
    and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
    and (coalesce(bx.act_tipo_baixa,'1') <> '3') /*3 é Aviso Bancário*/
    into :var_vlr_caixa;

    /*total de dinheiro do recbemento*/
    select sum(coalesce(bx.vlr_baixa,0)) from fin_baixas_receber bx
    where bx.dt_baixa =:data_cx and bx.turno = :turno
    and bx.conta = :conta and bx.cnpj = :cnpj and bx.usuario = :usuario
    and (coalesce(bx.act_tipo_baixa,'1') <> '4') /*4 é renegociacao*/
    and (coalesce(bx.act_tipo_baixa,'1') <> '3') /*3 é Aviso Bancário*/
    into :din_recbto;
  end

  if (:var_vlr_caixa is null) then
    var_vlr_caixa = 0;

  total_saidacx = :var_vlr_caixa + :total_saidacx;

  if (:din_recbto is null) then
    din_recbto = 0;

  din_recbto = :din_recbto - (:crtpre_recbto + :crtvista_recbto + :chpre_recbto + :chvista_recbto);
  total_dinheiro = :total_dinheiro + :din_recbto;
  TOTAL_PARCELADO = :TOTAL_PARCELADO - (:chpre_vdprazo + :chvista_vdprazo + :crtvista_vdprazo + :crtpre_vdprazo);

  /*Totalizadores do caixa*/
  total_entradas = (:total_dinheiro + :total_cartao + :total_cheque + :total_ticket + :total_entcx);

  if (:total_saidacx < 0) then
    total_saidacx = :total_saidacx * (-1);

  if (:total_troco < 0) then
    total_troco = :total_troco * (-1);

  total_saidas = (:total_saidacx + :total_troco);


  select coalesce(CX_COMP_SLD_ANT,'') from sis_empresas emp
  where emp.cnpj = :cnpj
  into :cp_sld_ant;

  /*valores de abertura de caixa*/
  select coalesce(cx.dinheiro,0), coalesce(cx.cheque,0), coalesce(cx.cheque_prazo,0), coalesce(cx.moedas,0),
  coalesce(cx.ticket,0) from fat_caixas cx
  where cx.usuario = :usuario and cx.data = :data_cx
  and cx.turno = :turno and cx.cnpj = :cnpj and cx.conta = :conta
  into :ab_cxdinheiro, :ab_cxcheque,:ab_cxcheque_prazo, :ab_cxmoeda, :ab_cxticket;

  ab_cxtotal = (:ab_cxdinheiro + :ab_cxcheque + :ab_cxticket + :ab_cxcheque_prazo + :ab_cxmoeda);

  /*adicionando os valores de abertura ao total do caixa*/
  total_caixa = ab_cxtotal;

  if (:cp_sld_ant = 'S') then
  begin
    select coalesce(saldo,0) from
    saldo_anterior_caixa(:cnpj, :usuario,:conta, :data_cx, :turno)
    into :saldo_anterior;

    total_caixa =  :total_caixa + (:total_entradas - :total_saidas + :saldo_anterior);
    /*contabilizando o saldo anterior também no saldo de abertura*/
    ab_cxtotal = :ab_cxtotal + :saldo_anterior;
  end
  else
    total_caixa =  :total_caixa + (:total_entradas - :total_saidas);





  suspend;
END
^

ALTER PROCEDURE PCD_RESUMO_CAIXA_PERIODO (
    CNPJ VARCHAR(14),
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    DIN_VDVISTA NUMERIC(18,4),
    DIN_VDPRAZO NUMERIC(18,4),
    DIN_RECBTO NUMERIC(18,4),
    CHVISTA_VDVISTA NUMERIC(18,4),
    CHVISTA_VDPRAZO NUMERIC(18,4),
    CHVISTA_RECBTO NUMERIC(18,4),
    CHPRE_VDVISTA NUMERIC(18,4),
    CHPRE_VDPRAZO NUMERIC(18,4),
    CHPRE_RECBTO NUMERIC(18,4),
    CRTVISTA_VDVISTA NUMERIC(18,4),
    CRTVISTA_VDPRAZO NUMERIC(18,4),
    CRTVISTA_RECBTO NUMERIC(18,4),
    CRTPRE_VDVISTA NUMERIC(18,4),
    CRTPRE_VDPRAZO NUMERIC(18,4),
    CRTPRE_RECBTO NUMERIC(18,4),
    TICKET_VDVISTA NUMERIC(18,4),
    TICKET_VDPRAZO NUMERIC(18,4),
    TICKET_RECBTO NUMERIC(18,4),
    TOTAL_DINHEIRO NUMERIC(18,4),
    TOTAL_CHEQUE_VISTA NUMERIC(18,4),
    TOTAL_CHEQUE_PRE NUMERIC(18,4),
    TOTAL_CARTAO_VISTA NUMERIC(18,4),
    TOTAL_CARTAO_PRE NUMERIC(18,4),
    TOTAL_TROCO NUMERIC(18,4),
    TROCO_VDVISTA NUMERIC(18,4),
    TROCO_VDPRAZO NUMERIC(18,4),
    TOTAL_VALE_TROCO NUMERIC(18,4),
    TOTAL_GERAL NUMERIC(18,4),
    TOTAL_CHEQUE NUMERIC(18,4),
    TOTAL_CARTAO NUMERIC(18,4),
    TOTAL_TICKET NUMERIC(18,4),
    TOTAL_ENTCX NUMERIC(18,4),
    TOTAL_SAIDACX NUMERIC(18,4),
    TOTAL_VDVISTA NUMERIC(18,4),
    TOTAL_VDPRAZO NUMERIC(18,4),
    TOTAL_PARCELADO NUMERIC(18,4),
    TOTAL_CAIXA NUMERIC(18,4),
    SALDO_ANTERIOR NUMERIC(18,4),
    CP_SLD_ANT CHAR(1),
    AB_CXDINHEIRO NUMERIC(18,4),
    AB_CXMOEDA NUMERIC(18,4),
    AB_CXCHEQUE NUMERIC(18,4),
    AB_CXCHEQUE_PRAZO NUMERIC(18,4),
    AB_CXTICKET NUMERIC(18,4),
    AB_CXTOTAL NUMERIC(18,4))
AS
DECLARE VARIABLE TRC_VALE CHAR(1);
DECLARE VARIABLE DATA_CX DATE;
DECLARE VARIABLE CH_INFLUENCIA CHAR(1);
DECLARE VARIABLE CRT_INFLUENCIA CHAR(1);
DECLARE VARIABLE MUDOU CHAR(1);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE TIPO_VENDA VARCHAR(3);
DECLARE VARIABLE VLR_PRAZO NUMERIC(18,4);
DECLARE VARIABLE VLR_VISTA NUMERIC(18,4);
DECLARE VARIABLE TIPO VARCHAR(5);
DECLARE VARIABLE CHEQUE_VISTA CHAR(1);
DECLARE VARIABLE CARTAO_VISTA_AUX VARCHAR(1);
DECLARE VARIABLE DATA_LANCTO_CRT DATE;
DECLARE VARIABLE DATA_REEMB_CRT DATE;
DECLARE VARIABLE DATA_LANCTO_CH DATE;
DECLARE VARIABLE DATA_PRE_CH DATE;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE VAR_VLR_CH NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_CRT NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_RECBTO NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE VAR_VLR_CAIXA NUMERIC(18,4);
DECLARE VARIABLE TIPOMOV CHAR(1);
DECLARE VARIABLE TOTAL_ENTRADAS NUMERIC(18,4);
DECLARE VARIABLE TOTAL_SAIDAS NUMERIC(18,4);
DECLARE VARIABLE DIGITA_CRT CHAR(1);
DECLARE VARIABLE DIGITA_CH CHAR(1);
begin
  /*zerando valores*/
  CRTPRE_VDPRAZO = 0;
  CRTVISTA_VDPRAZO = 0;
  CHPRE_VDPRAZO = 0;
  CHVISTA_VDPRAZO = 0;
  DIN_VDVISTA = 0;
  DIN_VDPRAZO = 0;
  DIN_RECBTO = 0;
  CHVISTA_VDVISTA = 0;
  CHVISTA_RECBTO = 0;
  CHPRE_VDVISTA = 0;
  CHPRE_RECBTO = 0;
  CRTVISTA_VDVISTA = 0;
  CRTVISTA_RECBTO = 0;
  CRTPRE_VDVISTA = 0;

  CRTPRE_RECBTO = 0;
  TICKET_VDVISTA = 0;
  TICKET_VDPRAZO = 0;
  TICKET_RECBTO = 0;
  TOTAL_DINHEIRO = 0;
  TOTAL_CHEQUE_VISTA = 0;
  TOTAL_CHEQUE_PRE = 0;
  TOTAL_CARTAO_VISTA = 0;
  TOTAL_CARTAO_PRE = 0;
  TOTAL_TROCO = 0;
  TOTAL_VALE_TROCO = 0;
  TOTAL_CARTAO_VISTA = 0;
  TOTAL_GERAL = 0;
  TOTAL_CHEQUE = 0;
  TOTAL_CARTAO = 0;
  TOTAL_TICKET = 0;
  TOTAL_ENTCX = 0;
  TOTAL_SAIDACX = 0;
  TOTAL_VDVISTA = 0;
  TOTAL_VDPRAZO = 0;
  TOTAL_PARCELADO = 0;

  troco_vdvista = 0;
  troco_vdprazo = 0;
  select emp.crt_influencia_venda, emp.ch_influencia_venda, emp.DIG_CHEQUE_VENDA, emp.dig_cartao_venda
  from sis_empresas emp
  where emp.cnpj = :cnpj
  into :ch_influencia, :crt_influencia, :digita_ch, :diGita_crt;



  /*Trocas*/
  for select codigo, entrada, dinheiro, cheque, cartao, TICKET,
  ((coalesce(total_2,0) + coalesce(desc_acresc_2,0))-(coalesce(Total,0) + coalesce(desc_acresc,0))), data_caixa
  from fat_trocas trc/*pego as vendas que estemjam na data de caixa */
  where cnpj = :cnpj and (data_caixa between :data_ini and :data_fin)
  and fechado = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total, :data_cx
  do
  begin
    total_dinheiro = :total_dinheiro + dinheiro;
    total_ticket = :total_ticket + :ticket;

    vlr_vista = :dinheiro + :cartao + :cheque + :ticket;
    if (:vlr_vista > :total) then
    begin
      troco_vdvista = :troco_vdvista + (:vlr_vista - :total);
      vlr_vista = :total;
    end


    vlr_prazo = :total - :vlr_vista;
    /*pq existem trocas em que´só á entradas de mercadorias
    ficando com um  valor a vista negativo*/
    if (((:VLR_vista <> 0) and (:vlr_prazo <= 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if ((:cartao > 0) and (:crt_influencia = 'S')) then
      begin
        /*verificando se cartão a vista ou prazo*/
        /*porque pode ser um parcelamento de cartão*/
        for select crt.data, crt.reembolso from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
            cartao_vista_aux = 'N';
        end
      end

      if ((:cheque > 0) and (:ch_influencia = 'S')) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
        tipo = 'Prazo';
    end


    /*Vlrs. a Vista*/
    if (tipo = 'Vista')then
    begin
      /*Não estou debitando o troco diretamente aqui .. dpois eu explico*/
      TOTAL_VDVISTA = :TOTAL_VDVISTA + vlr_vista;

      /*Dinheiro de venda vista*/
      din_vdvista = :din_vdvista + :dinheiro;
      ticket_vdvista = :ticket_vdvista + :ticket;
      /*verificando cheques na venda a vista*/
      if (:cheque > 0) then
      begin
        for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdvista = :chpre_vdvista + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdvista = :chvista_vdvista + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
        end
      end
    
      if (:cartao > 0) then
      begin
        for select crt.data, crt.reembolso,coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdvista = :crtpre_vdvista + :var_vlr_crt;
            total_cartao_pre = :total_cartao_pre + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdvista = :crtvista_vdvista + :var_vlr_crt;
            total_cartao_vista = :total_cartao_vista + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
    
        end
      end
    
    end /*Vlrs. a Prazo*/
    else if (tipo = 'Prazo')then
    begin
      /* Aqui na verdade são vlrs. de entrada do crediário*/
      var_vlr_ch = 0;
      /*Dinheiro de venda a prazo */
      din_vdprazo = :din_vdprazo + :dinheiro;
      ticket_vdprazo = :ticket_vdprazo + :ticket;
      var_vlr_crt = 0;
      var_vlr_ch = 0;
      /*verificando cheques na venda a vista*/
      if (:cheque > 0) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdprazo = :chpre_vdprazo + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdprazo = :chvista_vdprazo + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
        end
      end
    
      if (:cartao > 0) then
      begin
        for select crt.data, crt.reembolso, coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.troca = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdprazo = :crtpre_vdprazo + :var_vlr_crt;
            total_cartao_pre = :total_cartao_pre + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdprazo = :crtvista_vdprazo + :var_vlr_crt;
            total_cartao_vista = :total_cartao_vista + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
    
        end
      end
      TOTAL_PARCELADO = :TOTAL_PARCELADO + (:total - :entrada);/* - :var_vlr_crt - :var_vlr_ch;*/
      total_vdprazo = :total_vdprazo + :total;
    end /*final prazo*/
  end

  /*#######################################################NOVO CAIXA######################################################*/
 /*vendas*/
  for select vd.codigo, coalesce(desc_acres,0), coalesce(entrada,0),
  coalesce(dinheiro,0), coalesce(cheque,0), coalesce(cartao,0),coalesce(TICKET,0),
  coalesce(total,0), tipo_venda,coalesce(troco,0), coalesce(vale_troco,''), data_caixa
  from fat_vendas vd/*pego as vendas que estemjam na data de caixa */
  inner join est_natureza nat on (vd.natureza = nat.codigo  and vd.cnpj = nat.cnpj)
  where vd.cnpj = :cnpj and (data_caixa between :data_ini and :data_fin)
  and fechada = 'S' and enviada_cx = 'S' and nat.es = 'S' and nat.computa_venda = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :desc_acres, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :tipo_venda, :troco, :trc_vale, :data_cx
  do
  begin
     if (:codigo = 17210) then
      codigo = :codigo;
    /*troco em vendas*/
    /*troco feito em vale*/
    if(:trc_vale = 'S') then
      total_vale_troco = :total_vale_troco + troco;
    else
      total_troco = :total_troco + troco;

    total_dinheiro = :total_dinheiro + dinheiro;
    total_ticket = :total_ticket + :ticket;

    /*Neste procedimento há uma verificação */
    Mudou = 'N';
    vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
    vlr_prazo = (:total + :desc_acres) - :vlr_vista;/*desconto já vem negativo*/

    /*acertando diferenças de arredondamentos*/
    if (:vlr_prazo < 0.01) then
      vlr_prazo = 0;

    if (((:VLR_vista > 0) and (:tipo_venda <> 'FFT') and (:vlr_prazo = 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

   /**************Esse bloco é so pra determinar se a venda é transformada em a prazo caso tenha DOCS a prazo**********/
    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if ((:cartao > 0) and (:crt_influencia = 'S')) then
      begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso from fin_movimento_cartao crt
          where crt.venda = :codigo and crt.cnpj = :cnpj
          into :data_lancto_crt, :data_reemb_crt
          do
          begin
            if (:data_reemb_crt > :data_lancto_crt) then
              cartao_vista_aux = 'N';
          end
      end

      if ((:cheque > 0) and (:ch_influencia = 'S')) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
      begin
        tipo = 'Prazo';
        MUDOU = 'S'; /*status do movimento mudou*/
      end

    end

    total = (:total + :desc_acres);
   /*****************************************FINAL DO BLOCO ACIMA***************************************************/

   /*Vlrs. a Vista*/
   if (tipo = 'Vista')then
   begin
     /*Não estou debitando o troco diretamente aqui .. dpois eu explico*/
     troco_vdvista = :troco_vdvista + troco;

     TOTAL_VDVISTA = :TOTAL_VDVISTA + :total;

     /*Dinheiro de venda vista*/
     din_vdvista = :din_vdvista + :dinheiro;
     ticket_vdvista = :ticket_vdvista + :ticket;
     /*verificando cheques na venda a vista*/
     if (:cheque > 0) then
     begin
        /*se não há desdobramento todos os cheques são a vista*/
        if (:digita_ch <> 'S') then
        begin
          chvista_vdvista = :chvista_vdvista + :cheque;
          total_cheque_vista = :total_cheque_vista + :cheque;
          total_cheque = :total_cheque + :cheque;
        end

         /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date,ch.valor  from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdvista = :chpre_vdvista + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdvista = :chvista_vdvista + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
        end
     end

     if (:cartao > 0) then
     begin
        if (:digita_crt <> 'S') then
        begin
          crtvista_vdvista = :crtvista_vdvista + :cartao;
          total_cartao_vista = :total_cartao_vista + :cartao;
          total_cartao = :total_cartao + :cartao;
        end

        for select crt.data, crt.reembolso, crt.valor from fin_movimento_cartao crt
        where crt.venda = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdvista = :crtpre_vdvista + :var_vlr_crt;
            total_cartao_pre = :total_cartao_pre + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdvista = :crtvista_vdvista + :var_vlr_crt;
            total_cartao_vista = :total_cartao_vista + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
        end
      end

   end /*Vlrs. a Prazo*/
   else if (tipo = 'Prazo')then
   begin
     troco_vdprazo = :troco_vdprazo + troco;
     /* Aqui na verdade são vlrs. de entrada do crediário*/
     /*Dinheiro de venda a prazo */
     din_vdprazo = :din_vdprazo + :dinheiro;
     ticket_vdprazo = :ticket_vdprazo + :ticket;
     var_vlr_ch = 0;
     var_vlr_crt = 0;
     /*verificando cheques na venda a vista*/
     if (:cheque > 0) then
     begin
        if (:digita_ch <> 'S') then
          chvista_vdprazo = :chvista_vdprazo + :cheque;
        /*verificando se Cheque a vista ou prazo*/
        /*pode ser varios cheques*/
        for select ch.data_caixa, ch.pre_date,coalesce(ch.valor,0)  from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
          begin
            chpre_vdprazo = :chpre_vdprazo + :var_vlr_ch;
            total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
          else
          begin
            chvista_vdprazo = :chvista_vdprazo + :var_vlr_ch;
            total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
            total_cheque = :total_cheque + :var_vlr_ch;
          end
        end
     end

     if (:cartao > 0) then
     begin
        if (:digita_crt <> 'S') then
          crtvista_vdprazo = :crtvista_vdprazo + :cartao;

        for select crt.data, crt.reembolso,coalesce(crt.valor,0) from fin_movimento_cartao crt
        where crt.venda = :codigo and crt.cnpj = :cnpj
        into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
        do
        begin
          if (:data_reemb_crt > :data_lancto_crt) then
          begin
            crtpre_vdprazo = :crtpre_vdprazo + :var_vlr_crt;
            total_cartao_pre = :total_cartao_pre + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end
          else
          begin
            crtvista_vdprazo = :crtvista_vdprazo + :var_vlr_crt;
            total_cartao_vista = :total_cartao_vista + :var_vlr_crt;
            total_cartao = :total_cartao + :var_vlr_crt;
          end

        end
      end
     TOTAL_VDPRAZO = :total_vdprazo + :total;                    /*os valores de cartão são expostos, de modo que eles tem de ser debitados do parcelado "*/
     TOTAL_PARCELADO = :TOTAL_PARCELADO + (:total - :entrada);/* - (:var_vlr_crt + :var_vlr_ch);*/
   end
  end
  /*cheques em receber*/
  for select ch.data_caixa, ch.pre_date, coalesce(ch.valor,0)  from fin_cheques ch
  where ch.venda is null and ch.troca is null
  and ch.cnpj = :cnpj and (ch.data_caixa between :data_ini and :data_fin)
  into :data_lancto_ch, :data_pre_ch, :var_vlr_ch
  do
  begin
    if (:data_pre_ch > :data_lancto_ch) then
    begin
      chpre_recbto = :chpre_recbto + :var_vlr_ch;
      total_cheque_pre = :total_cheque_pre + :var_vlr_ch;
      total_cheque = :total_cheque + :var_vlr_ch;
    end
    else
    begin
      chvista_recbto = :chvista_recbto + :var_vlr_ch;
      total_cheque_vista = :total_cheque_vista + :var_vlr_ch;
      total_cheque = :total_cheque + :var_vlr_ch;
    end
  end

  /*data no cartão é a data do caixa*/
  for select crt.data, crt.reembolso, coalesce(crt.valor,0) from fin_movimento_cartao crt
  where crt.venda is null and crt.troca is null and crt.cnpj = :cnpj
  and (crt.data between :data_ini and :data_fin)
  into :data_lancto_crt, :data_reemb_crt, :var_vlr_crt
  do
  begin
    if (:data_reemb_crt > :data_lancto_crt) then
    begin
      crtpre_recbto = :crtpre_recbto + :var_vlr_crt;
      total_cartao_pre = :total_cartao_pre + :var_vlr_crt;
      total_cartao = :total_cartao + :var_vlr_crt;
    end
    else
    begin
      crtvista_recbto = :crtvista_recbto + :var_vlr_crt;
      total_cartao_vista = :total_cartao_vista + :var_vlr_crt;
      total_cartao = :total_cartao + :var_vlr_crt;
    end
  end

  for select coalesce(cx.valor,0), coalesce(cx.tipo,'') from fat_caixas_movimentos cx
  where (cx.data between :data_ini and :data_fin)
  into :var_vlr_caixa, :tipomov
  do
  begin
    if (:tipomov = 'C') then
      total_entcx = :var_vlr_caixa + :total_entcx;
    else
      total_saidacx = :var_vlr_caixa + :total_saidacx;
  end

  /*Contas pagas também totalizando nas saidas do caixa*/
  select sum(coalesce(bx.vlr_baixa,0)) from fin_baixas_pagar bx
  where (bx.dt_baixa between :data_ini and :data_fin) and bx.cnpj = :cnpj
  into :var_vlr_caixa;

  if (:din_recbto is null) then
    var_vlr_caixa = 0;

  total_saidacx = :var_vlr_caixa + :total_saidacx;

  /*total de dinheiro do recbemento*/
  select sum(coalesce(bx.vlr_baixa,0)) from fin_baixas_receber bx
  where (bx.dt_baixa between :data_ini and :data_fin) and bx.cnpj = :cnpj
  into :din_recbto;

  if (:din_recbto is null) then
    din_recbto = 0;

  din_recbto = :din_recbto - (:crtpre_recbto + :crtvista_recbto + :chpre_recbto + :chvista_recbto);
  total_dinheiro = :total_dinheiro + :din_recbto;
  TOTAL_PARCELADO = :TOTAL_PARCELADO - (:chpre_vdprazo + :chvista_vdprazo + :crtvista_vdprazo + :crtpre_vdprazo);

  /*Totalizadores do caixa*/
  total_entradas = (:total_dinheiro + :total_cartao + :total_cheque + :total_ticket + :total_entcx);

  if (:total_saidacx < 0) then
    total_saidacx = :total_saidacx * (-1);

  if (:total_troco < 0) then
    total_troco = :total_troco * (-1);

  total_saidas = (:total_saidacx + :total_troco);


   /*select coalesce(CX_COMP_SLD_ANT,'') from sis_empresas emp
  where emp.cnpj = :cnpj
  into :cp_sld_ant;

  valores de abertura de caixa - Isso não irá existir
  select coalesce(cx.dinheiro,0), coalesce(cx.cheque,0), coalesce(cx.cheque_prazo,0), coalesce(cx.moedas,0),
  coalesce(cx.ticket,0) from fat_caixas cx
  where cx.usuario = :usuario and cx.data = :data_cx
  and cx.turno = :turno and cx.cnpj = :cnpj and cx.conta = :conta
  into :ab_cxdinheiro, :ab_cxcheque,:ab_cxcheque_prazo, :ab_cxmoeda, :ab_cxticket;

  ab_cxtotal = (:ab_cxdinheiro + :ab_cxcheque + :ab_cxticket + :ab_cxcheque_prazo + :ab_cxmoeda); */

  /*adicionando os valores de abertura ao total do caixa
  total_caixa = ab_cxtotal;

  if (:cp_sld_ant = 'S') then
  begin
    select coalesce(saldo,0) from
    saldo_anterior_caixa(:cnpj, :usuario,:conta, :data_ini, :turno)
    into :saldo_anterior;

    total_caixa =  :total_caixa + (:total_entradas - :total_saidas + :saldo_anterior);
    /*contabilizando o saldo anterior também no saldo de abertura
    ab_cxtotal = :ab_cxtotal + :saldo_anterior;
  end
  else */
    total_caixa =  :total_caixa + (:total_entradas - :total_saidas);

  suspend;
END
^

ALTER PROCEDURE PCD_RET_VLR_VENDA (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    DESC_ATUAL NUMERIC(18,4))
RETURNS (
    TTL_UNT_ORIG NUMERIC(18,4),
    TTL_UNT NUMERIC(18,4),
    TTL_VENDA NUMERIC(18,4),
    TTL_DESCTO NUMERIC(18,4),
    TTL_PERCT NUMERIC(18,4),
    DESCTO_RES NUMERIC(18,4),
    VALIDO CHAR(1))
AS
DECLARE VARIABLE UNT_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE UNT_VALOR NUMERIC(18,4);
DECLARE VARIABLE UNT_DIFERENCIADO NUMERIC(18,4);
DECLARE VARIABLE UNT_PROMOCAO NUMERIC(18,4);
DECLARE VARIABLE UNT_ESPECIAL NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE DESCTO_MAX NUMERIC(18,4);
DECLARE VARIABLE TTL_DESCTO_RES NUMERIC(18,4);
DECLARE VARIABLE TTL_PERCT_RES NUMERIC(18,4);
DECLARE VARIABLE TTL_UNT_ORIG_RES NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCTO_RES NUMERIC(18,4);
begin
  /*Procedimento será utilizado para a valiadação de descontos nos formulários de vendas
  e de faturamento */

  ttl_unt_orig = 0;
  ttl_unt_orig_res = 0;
  ttl_unt = 0;
  /*--------------INICIANDO VERIFICAÇÃO PARA SABER SE O DESCONTO É VALIDO--------------------------*/
  select coalesce(emp.desconto_maximo,0) from sis_empresas emp
  where emp.cnpj = :cnpj
  into  :descto_max;

  /*pergando vlrs. de venda*/
  select coalesce(vd.total,0), coalesce(vd.desc_acres,0), vd.pessoa_fj
  from fat_vendas vd
  where vd.cnpj = :cnpj and vd.codigo = :venda
  into :ttl_venda, :desc_acres, :pessoa_fj;


  /*percorrendo os itens*/
  for select vdi.produto, coalesce(vdi.prc_unit_original,0), (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)),
  vdi.quantidade from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :venda
      into :produto,:unt_original, :unt_valor, :qtde
  do
  begin

     /*pegando o preço da promoção*/
     select coalesce(pro.valor,0) from est_promocao pro
     where pro.cnpj = :cnpj and pro.produto = :produto
     into :unt_promocao;

     if (:unt_promocao is null) then
       unt_promocao = 0;



     select coalesce(prc.resultado,0) from GLO_PRECOS_ESPECIAIS prc
     where prc.cnpj = :cnpj and prc.pessoa_fj = :pessoa_fj and prc.produto = :produto
     into :unt_especial;

     if (:unt_especial is null) then
       unt_especial = 0;

      /*se os dois forem 0 então não temos preço diferenciado*/
     if ((:unt_promocao = 0) and (:unt_especial = 0)) then
        unt_diferenciado = 0;
     else if (:unt_promocao = 0) then
        unt_diferenciado = :unt_especial;
     else if (:unt_especial = 0) then
        unt_diferenciado = :unt_promocao;
     else if ((:unt_promocao > 0) and (:unt_promocao <= :unt_especial)) then
        unt_diferenciado = :unt_promocao;
     else if ((:unt_especial > 0) and (:unt_especial < :unt_promocao)) then
        unt_diferenciado = :unt_especial;

     /*totalizando os valores originais */
     if ((:unt_diferenciado > 0)) then
       ttl_unt_orig = :ttl_unt_orig + (:unt_diferenciado * :qtde);
     else
       ttl_unt_orig = :ttl_unt_orig +(:unt_original * :qtde);


    /*--------------INICIANDO VERIFICAÇÃO PARA SABER O QUANTO RESTA DE DESCTO---------------------*/
    /*Essa é uma questão bastante complexa pois devemos considerar muitas variantes, ex:
    1. Quando um produto for vendido no PREÇO DA PROMOÇÃO, então NÃO devemos considerar que ele já
       tenha recebido algum desconto, mas sim que o preço original 'passou' a ser o preço da promoção,
       portanto o usuário ainda poderá dar o descto máximo sobre o item no total da venda.

    2. Quando um produto for vendido por PREÇO ESPECIAL então nós devemos levar em consideração a
       diferença de valores como um desconto dado, portanto se esse desconto não atingir o descto máximo
       o sistema deverá permitir que o usuário aplique está diferença no total da venda, mas caso
       exceda ele NÃO deve sugerir um 'Descto. Negativo'

    3. Quando for um preço normal, em que o usuário tenha dado um desconto acima do permitido,
    com autorização do supervisor, o sistema também não poderá sugerir um 'Descto. Negativo' */

    if ((:unt_diferenciado > 0) and (:unt_diferenciado = :unt_promocao)) then /*preço promocional*/
      ttl_unt_orig_res = :ttl_unt_orig_res + (:unt_diferenciado * :qtde);
    else if ((:unt_diferenciado > 0) and (:unt_diferenciado < (:unt_original - ((:unt_original * :descto_max)/100.00)))) then /*Descto. especial > Descto max permitido*/
      ttl_unt_orig_res = :ttl_unt_orig_res +((:unt_diferenciado + ((:unt_diferenciado * :descto_max)/100.00)) * :qtde);
    else if (:unt_valor < (:unt_original - ((:unt_original * :descto_max)/100.00))) then /*Descto acima do permitido*/
      ttl_unt_orig_res = :ttl_unt_orig_res +((:unt_valor + ((:unt_valor * :descto_max)/100.00)) * :qtde);
    else
       ttl_unt_orig_res = :ttl_unt_orig_res +(:unt_original * :qtde);
    /*----------------------------------------------------------final-------------------------------------------------------*/

    /*totalizando os valores unitários*/
    ttl_unt = :ttl_unt +(:unt_valor * :qtde);
  end

  ttl_descto = (:ttl_unt_orig - (:ttl_venda + :desc_atual));
  ttl_perct = (:ttl_descto * 100.00) / (:ttl_unt_orig);

  /*até aqui verificando se o desconto dado é valido ou não*/
  if (:ttl_perct <= :descto_max) then
    valido = 'S';
  else
    valido = 'N';

  /*------------verificando quanto de desconto ainda resta--------------------*/
  ttl_descto_res = (:ttl_unt_orig_res - (:ttl_venda + :desc_atual));
  ttl_perct_res = (:ttl_descto_res * 100.00) / (:ttl_venda);

  pct_descto_res = (:descto_max - coalesce(:ttl_perct_res,0));
  descto_res = (:pct_descto_res * :ttl_unt_orig)/100.00;
  /*------------verificando quanto de desconto ainda resta--------------------*/
  suspend;
END
^

ALTER PROCEDURE PCD_REUTILIZAR_N_NF (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QTDE NUMERIC(18,4);
begin
  for select vdi.produto, vdi.quantidade from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :codigo
      into :produto, :qtde
  do
  begin
    /*atualizando o estoque fiscal do produto, decrementando obviamente*/
    update est_produtos prd set prd.qtdade_1 = coalesce(prd.qtdade_1,0) - coalesce(:qtde,0)
    where prd.cnpj = :cnpj and prd.codigo = :produto;
  end

  /*limpando a numeração de NF*/
  update fat_vendas vd set vd.num_cupom = 0, vd.num_nf = 0, vd.nfe_chave = null, vd.nfe_xml = null, vd.nfe_protocolo = null, vd.nfe_recibo = null, vd.nfe_autorizada = null
  where vd.cnpj = :cnpj and vd.codigo = :codigo;

end
^

ALTER PROCEDURE PCD_SELECIONA_VENDA (
    CNPJ VARCHAR(18),
    VENDA INTEGER,
    VELHO CHAR(1))
AS
declare variable novo char(1);
begin
  if(:VELHO = 'S') then
    NOVO = 'N';
  else
    NOVO = 'S';

  update fat_vendas set selecionada = :novo
  where cnpj = :cnpj and codigo = :venda;
  suspend;
END
^

ALTER PROCEDURE PCD_SET_NF_AGRUPADA (
    CNPJ VARCHAR(18),
    PESSOA_FJ INTEGER,
    NUMERO INTEGER,
    SERIE CHAR(3),
    DATA_NF DATE)
AS
begin
  update fat_vendas v set num_nf = :numero, serie = :serie, v.nf_agrupada = 'S', v.dt_emissao_nf = :data_nf, selecionada = 'N'
  where cnpj = :cnpj and v.pessoa_fj = :pessoa_fj and v.selecionada = 'S';
     
  /*atualiza a serie*/
  update sis_serienf set ultimo_numero = :numero
  where cnpj = :cnpj and serie = :serie ;
END
^

ALTER PROCEDURE PCD_SET_SALDO_ORCAMENTO (
    CNPJ VARCHAR(18),
    COD_VENDA INTEGER,
    COD_ORCAMENTO INTEGER,
    OLD_FECHADA CHAR(1),
    NEW_FECHADA CHAR(1))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE QTDE FLOAT;
DECLARE VARIABLE QTDE1 FLOAT;
DECLARE VARIABLE QTDE2 FLOAT;
DECLARE VARIABLE COMPROMETER_ESTOQUE CHAR(1);
DECLARE VARIABLE FATOR INTEGER;
DECLARE VARIABLE STATUS INTEGER;
begin

  select coalesce(oc.comprometer_estoque,'N') from fat_orcamentos oc
  where oc.cnpj = :cnpj and oc.codigo = :cod_orcamento
  into :comprometer_estoque;

  /*se o orçamento não compromete estoque então saio dos cálculos*/
  if (:comprometer_estoque = 'N') then
    exit;

  /*venda estornada, logo terei de creditar o orçamento*/
  if ((:new_fechada = 'N') and (:old_fechada= 'S')) then
    fator = -1;
  if ((:new_fechada = 'S') and (:old_fechada= 'N')) then
    fator = 1;

  /*o procedure é chamado em qualquer update, antes de fechar ou estornar por isso valido*/
  if (fator is null) then
     exit;
  /*Achando o orçamento relacionado*/
  for select vdi.produto, vdi.quantidade from fat_vendas vd
      inner join fat_vendas_itens vdi on (vd.codigo = vdi.codigo and vd.cnpj = vdi.cnpj)
      where vd.cnpj = :cnpj and vd.codigo = :cod_venda and vd.orcamento  = :cod_orcamento
      into :produto, :qtde
  do
  begin
    qtde = :qtde * :fator;

    /*atualizando a qtde faturada do orçamento*/
    update fat_orcamentos_itens oci set oci.qtde_faturada = coalesce(oci.qtde_faturada,0) + :qtde
    where oci.produto = :produto and oci.cnpj = :cnpj and oci.codigo = :cod_orcamento;
  end

  /*setando o status do orçamento*/
  select sum(fti.quantidade), sum(fti.qtde_faturada) from fat_orcamentos_itens fti
  where fti.cnpj = :cnpj and fti.codigo = :cod_orcamento
  into :qtde1, :qtde2;

  if (coalesce(:qtde1,0) <= coalesce(:qtde2,0)) then
     status = 3;
  else if (coalesce(:qtde2,0) > 0) then
     status = 2;
  else if (coalesce(:qtde2,0) = 0) then
     status = 1;

  update fat_orcamentos ft set ft.status = :status
  where ft.codigo = :cod_orcamento and ft.cnpj = :cnpj and ft.status <> 4;
END
^

ALTER PROCEDURE PCD_SINTEG_50 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_DOCTO DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    BASE_CALCULO_ICMS FLOAT,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT,
    VLR_ISENTO FLOAT,
    VLR_BASE FLOAT,
    EMISSORDOCUMENTO CHAR(1),
    MODELO INTEGER,
    CODIGO_FISCAL CHAR(4))
AS
DECLARE VARIABLE XCFOP VARCHAR(4);
begin
  for select
             psa.cpf_cgc,
             vd.serie,
             vd.num_nf,
             max(vd.data_caixa),
             sum(vd.total_nota),
             sum(vd.total),
             sum(vd.base_icm),
             sum(vd.icm),
             psa.uf,
             vd.pgto_frete,
             max(vd.data_caixa),
             vd.natureza,
             sum(vd.base_icm_subst),
             sum(vd.valor_icm_subst),
             coalesce(vd.cancelada,'N'),
             psa.rg_ie,
             psa.codigo,
             sum(vd.sinteg_vlr_contabil),
             sum(vd.sinteg_vlr_isento),
             sum(vd.sinteg_vlr_outros),
             t.codigo_fiscal
      from fat_vendas vd
      inner join sis_serienf s on (s.cnpj = vd.cnpj and s.serie = vd.serie)
      inner join glo_tipos_docto t on (s.tipo_docto = t.sigla and s.cnpj = t.cnpj)
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S'
      group by  vd.serie, vd.num_nf, psa.cpf_cgc, psa.uf, vd.pgto_frete, vd.natureza, vd.cancelada, psa.rg_ie, psa.codigo,t.codigo_fiscal
      into :cliente_cpf_cnpj,
           :serie,
           :num_nf,
           :data_docto,
           :valor_contabil,
           :valor_mercadorias,
           :base_calculo_icms,
           :icms_debitado,
           :cliente_uf,
           :tipo_frete,
           :data_documento,
           :cfop,
           :base_calculo_icms_sub,
           :imposto_retido_icms_sub,
           :nota_cancelada,
           :cliente_ie,
           :psa_codigo,
           :vlr_base ,
           :vlr_isento,
           :vlr_outros,
           :codigo_fiscal

  do
  begin
    /*transferindo para o procedimento todos as validações que estavam na aplicação*/
    if (:num_nf = '6426') then
       num_nf = '6426';

    EMISSORDOCUMENTO = 'P';
    modelo = 55;
    xcfop = cast(:cfop as varchar(4));
    if ((substring(xcfop from 1 for 2) = '54') or ((substring(xcfop from 1 for 2) = '64')) or ((substring(xcfop from 1 for 2) = '59')) or ((substring(xcfop from 1 for 2) = '19'))) then
    begin
      aliquota_icms = 0;
      base_calculo_icms = 0;
      icms_debitado = 0;
      base_calculo_icms_sub = 0;
      imposto_retido_icms_sub = 0;
    end
    else
    begin
      aliquota_icms = 17;
      if (coalesce(:base_calculo_icms,0) <= 0) then
        icms_debitado = 0;

      if ((coalesce(:base_calculo_icms,0)<=0) and (coalesce(:base_calculo_icms_sub,0)<=0)) then
        aliquota_icms = 0;
    end

    condicao_venda = '0'; /*a vista*/

    /*calculando os valores de */
    vlr_outros = coalesce(:valor_contabil,0) - coalesce(:base_calculo_icms,0);

    if (:NOTA_CANCELADA = 'S') then
    begin
       valor_contabil = 0;
       valor_mercadorias = 0;
       base_calculo_icms = 0;
       icms_debitado = 0;
       base_calculo_icms_sub = 0;
       imposto_retido_icms_sub = 0;
       vlr_base = 0;
       vlr_isento = 0;
       vlr_outros = 0;
    end

    suspend;
  end

  for select psa.cpf_cgc,
             et.serie_nf,
             et.ndocto,
             et.data_ent,
             case et.frete_lf
                 when 'S' then (
                                coalesce(et.vlr_produtos,0) +
                                coalesce(et.VLR_EMBALAGEM,0)  +
                                coalesce(et.VLR_SEGURO,0)  +
                                coalesce(et.VLR_FRETE,0)  +
                                coalesce(et.VLR_IPI,0)  +
                                coalesce(et.TAXAS,0)  -
                                coalesce(et.VLR_DESCONTO,0) +
                                coalesce(et.VLR_ICM_SUBS,0)
                               )
                 else  (
                                coalesce(et.vlr_produtos,0) +
                                coalesce(et.VLR_EMBALAGEM,0)  +
                                coalesce(et.VLR_SEGURO,0)  +
                                coalesce(et.VLR_IPI,0)  +
                                coalesce(et.TAXAS,0)  -
                                coalesce(et.VLR_DESCONTO,0) +
                                coalesce(et.VLR_ICM_SUBS,0)
                               )
               end ,
               et.vlr_produtos,
               et.VLR_BC_ICM,
               et.vlr_icm,
               psa.uf,
               case et.frete_lf
                 when 'S' then '1'
                 else '0'
               end,
               et.data_ent,
               et.natureza,
               et.vlr_bc_icm_subs, /*base calculo icms sub*/
               et.vlr_icm_subs,
               'N', /*nf cancelada*/
               psa.rg_ie,
               psa.codigo,
               et.perc_icm

        from est_entradas et
        inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
        left join GLO_TIPOS_DOCTO tp on (tp.cnpj = et.cnpj and tp.sigla = et.TIPO_DOCTO)
        where et.cnpj = :cnpj and
        ((coalesce(et.proc_qtd,'N') = 'S')
        or (coalesce(et.proc_fin,'N') = 'S')
        or (coalesce(et.proc_custo,'N') = 'S'))
        and (et.data_ent between :data1 and :data2)
        into   :cliente_cpf_cnpj,
               :serie,
               :num_nf,
               :data_docto,
               :valor_contabil,
               :valor_mercadorias,
               :base_calculo_icms,
               :icms_debitado,
               :cliente_uf,
               :tipo_frete,
               :data_documento,
               :cfop,
               :base_calculo_icms_sub,
               :imposto_retido_icms_sub,
               :nota_cancelada,
               :cliente_ie,
               :psa_codigo,
               :aliquota_icms
  do
  begin
    /*calculando os valores de */
    vlr_outros = coalesce(:valor_contabil,0) - coalesce(:base_calculo_icms,0);
    EMISSORDOCUMENTO = 'T';
    modelo = 55;
    xcfop = cast(:cfop as varchar(4));
    condicao_venda = '0'; /*a vista*/
    suspend;
  end
end
^

ALTER PROCEDURE PCD_SINTEG_53 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_DOCTO DATE,
    VALOR_CONTABIL FLOAT,
    VALOR_MERCADORIAS FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CLIENTE_CPF_CNPJ VARCHAR(15),
    CLIENTE_UF VARCHAR(2),
    CLIENTE_IE VARCHAR(20),
    TIPO_FRETE CHAR(1),
    CONDICAO_VENDA CHAR(1),
    DATA_DOCUMENTO DATE,
    CFOP INTEGER,
    BASE_CALCULO_ICMS_SUB FLOAT,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NOTA_CANCELADA CHAR(1),
    PSA_CODIGO INTEGER,
    VLR_OUTROS FLOAT,
    VLR_ISENTO FLOAT,
    VLR_BASE FLOAT,
    EMISSORDOCUMENTO CHAR(1),
    CODIGO_FISCAL CHAR(4),
    SITUACAO CHAR(1))
AS
DECLARE VARIABLE XCFOP VARCHAR(4);
begin
  /*REGISTRO 53 SOMENTE ENTRADAS*/
  for select psa.cpf_cgc,
             et.serie_nf,
             et.ndocto,
             et.data_ent,
             case et.frete_lf
                 when 'S' then (
                                coalesce(et.vlr_produtos,0) +
                                coalesce(et.VLR_EMBALAGEM,0)  +
                                coalesce(et.VLR_SEGURO,0)  +
                                coalesce(et.VLR_FRETE,0)  +
                                coalesce(et.VLR_IPI,0)  +
                                coalesce(et.TAXAS,0)  -
                                coalesce(et.VLR_DESCONTO,0) +
                                coalesce(et.VLR_ICM_SUBS,0)
                               )
                 else  (
                                coalesce(et.vlr_produtos,0) +
                                coalesce(et.VLR_EMBALAGEM,0)  +
                                coalesce(et.VLR_SEGURO,0)  +
                                coalesce(et.VLR_IPI,0)  +
                                coalesce(et.TAXAS,0)  -
                                coalesce(et.VLR_DESCONTO,0) +
                                coalesce(et.VLR_ICM_SUBS,0)
                               )
               end ,
               et.vlr_produtos,
               psa.uf,
               case et.frete_lf
                 when 'S' then '1'
                 else '0'
               end,
               et.data_ent,
               et.natureza,
               vlr_bc_icm_subs, /*base calculo icms sub*/
               et.vlr_icm_subs,
               '0', /*nf cancelada*/
               psa.rg_ie,
               psa.codigo,
               et.perc_icm,
               TP.codigo_fiscal

        from est_entradas et
        inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
        left join GLO_TIPOS_DOCTO tp on (tp.cnpj = et.cnpj and tp.sigla = et.TIPO_DOCTO)
        where et.cnpj = :cnpj and
        ((coalesce(et.proc_qtd,'N') = 'S')
        or (coalesce(et.proc_fin,'N') = 'S')
        or (coalesce(et.proc_custo,'N') = 'S'))
        and (et.data_ent between :data1 and :data2) and et.vlr_bc_icm_subs > 0
        into   :cliente_cpf_cnpj,
               :serie,
               :num_nf,
               :data_docto,
               :valor_contabil,
               :valor_mercadorias,
               :cliente_uf,
               :tipo_frete,
               :data_documento,
               :cfop,
               :base_calculo_icms_sub,
               :imposto_retido_icms_sub,
               :nota_cancelada,
               :cliente_ie,
               :psa_codigo,
               :aliquota_icms,
               :codigo_fiscal
  do
  begin
    situacao = 'N';

    EMISSORDOCUMENTO = 'T';
    xcfop = cast(:cfop as varchar(4));
    condicao_venda = '0'; /*a vista*/
    suspend;
  end
end
^

ALTER PROCEDURE PCD_SINTEG_54 (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    PSA_CPF_CNPJ VARCHAR(15),
    NUM_NF VARCHAR(20),
    SERIE CHAR(10),
    DATA_MOVTO DATE,
    ICMS_DEBITADO FLOAT,
    ALIQUOTA_ICMS FLOAT,
    CFOP INTEGER,
    IMPOSTO_RETIDO_ICMS_SUB FLOAT,
    NUM_ITEM INTEGER,
    COD_PRODUTO VARCHAR(15),
    UNIDADE VARCHAR(3),
    SIT_TRIB CHAR(3),
    QTDE FLOAT,
    PRECO_UNITARIO FLOAT,
    DESP_ACESSORIAS FLOAT,
    DESCONTO FLOAT,
    VALOR_ITEM FLOAT,
    BASE_ICMS FLOAT,
    BASE_ICMS_SUB FLOAT,
    PRODUTO_DESCRICAO VARCHAR(50),
    PRODUTO_SIT_TRIB CHAR(3),
    PRODUTO_FANTASIA VARCHAR(50),
    MOVIMENTA_MERCADORIA CHAR(1),
    INDICACAO_TRIBUTACAO CHAR(1),
    ALIQUOTA_IPI FLOAT,
    VALOR_IPI FLOAT,
    BASE_IPI FLOAT,
    CODIGO_FISCAL CHAR(4))
AS
DECLARE VARIABLE BASE_CALCULO_ICMS FLOAT;
DECLARE VARIABLE BASE_CALCULO_ICMS_ST FLOAT;
DECLARE VARIABLE PERC_ESTADUAL FLOAT;
DECLARE VARIABLE REDUCAO FLOAT;
DECLARE VARIABLE PERC_INTERESTADUAL FLOAT;
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE PRODUTO_PCT_RED_BASE FLOAT;
DECLARE VARIABLE VLR_DESPESAS FLOAT;
DECLARE VARIABLE VLR_PRODUTOS FLOAT;
DECLARE VARIABLE VLR_ICM_SUBS FLOAT;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PSA_UF CHAR(2);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE XCTE INTEGER;
DECLARE VARIABLE DESC_ACRES FLOAT;
DECLARE VARIABLE VD_TOTAL FLOAT;
DECLARE VARIABLE FRETE_LF CHAR(1);
DECLARE VARIABLE XCFOP VARCHAR(4);
DECLARE VARIABLE XALIQUOTA_ICMS FLOAT;
begin
  for select distinct vd.num_nf
      from fat_vendas vd
      inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.codigo = 3610
      and coalesce(vd.num_nf,0) > 0 and vd.enviada_cx = 'S' and vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N'
                                        
      into :num_nf
  do
  begin
      num_item = 0;
      /*no caso de notas impressas para varios pedidos juntos*/
      select max(vd.data_caixa)
             from fat_vendas vd
             inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
             inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
             where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
      into :data_movto;

     /* if (:data_movto is null) then
      begin
        select max(vd.data_caixa)
             from fat_vendas vd
             inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
             inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
             where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
        into :data_movto;
      end */

      for select psa.cpf_cgc, vd.serie, vd.codigo,  PSA.uf, coalesce(nat.mov_estoque,'N'), vd.desc_acres, vd.total,
          t.CODIGO_FISCAL, coalesce(nat.perc_icms,17)
          from fat_vendas vd
          inner join sis_serienf s on (s.cnpj = vd.cnpj and s.serie = vd.serie)
          inner join glo_tipos_docto t on (s.tipo_docto = t.sigla and s.cnpj = t.cnpj)
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and psa.codigo = vd.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2) and vd.num_nf = :num_nf
          into :psa_cpf_cnpj, :serie, :cod_venda,  :psa_uf, :movimenta_mercadoria, :desc_acres, :vd_total, :CODIGO_FISCAL, :xaliquota_icms
      do
      begin
          serie = '1';
          for select vdi.produto, VDI.cfop, substring(prd.unidade from 1 for 3), vdi.cte, vdi.ctie,
              vdi.quantidade, vdi.prc_unitario,
              ((vdi.desconto /** vdi.quantidade*/) - /*inversão de sinais, por conta do desc negativo*/
              (
               ((((vdi.prc_unitario * vdi.quantidade) * 100)/:vd_total) * :desc_acres)/100)
               /
               vdi.quantidade),
              (vdi.prc_unitario * vdi.quantidade),
              vdi.basecalculoicm, vdi.basecalculosubstituicao,
              prd.nome, prd.nome,
              vdi.icm, vdi.icm_subs
              from fat_vendas_itens vdi
              inner join est_produtos prd on (prd.codigo = vdi.produto and vdi.cnpj = prd.cnpj)
              where vdi.cnpj = :cnpj and vdi.codigo = :cod_venda
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :base_icms, :base_icms_sub,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            ALIQUOTA_ICMS = XALIQUOTA_ICMS;
            /*desconto não deve aparecer */
            desconto = 0;
            valor_item = (:valor_item - (:desconto * :qtde));
            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
             sit_trib = '010';
           else if (:xcte = 2) then
             sit_trib = '020';
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
             icms_debitado = 0;
              base_icms = 0;
              imposto_retido_icms_sub = 0;
              base_icms_sub = 0;
              aliquota_icms = 0;
           end
           else if (:xcte = 5) then
           begin
             sit_trib = '051';
             icms_debitado = 0;
              base_icms = 0;
              imposto_retido_icms_sub = 0;
              base_icms_sub = 0;
              aliquota_icms = 0;
           end
           else if (:xcte = 6) then
             sit_trib = '060';
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '000';

            produto_sit_trib = :sit_trib;
            num_item = num_item + 1;

            XCFOP = cast(:cfop as varchar(4));
            if ((substring(xcfop from 1 for 2) = '54') or ((substring(xcfop from 1 for 2) = '64'))
            or ((substring(xcfop from 1 for 2) = '59'))or ((substring(xcfop from 1 for 2) = '19'))) then
            begin
              icms_debitado = 0;
              base_icms = 0;
              imposto_retido_icms_sub = 0;
              base_icms_sub = 0;
              aliquota_icms = 0;
            end

            suspend;
          end
      end
  end

  /*-------------------------------------------------------Itens Entrada de Mercadorias-----------------------------------------------*/


  for select distinct et.ndocto, et.FRETE_LF, et.pessoa_fj
      from est_entradas et
      inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
      inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
      where et.cnpj = :cnpj and (
                                  (coalesce(et.proc_qtd,'N') = 'S')
                                  or
                                  (coalesce(et.proc_fin,'N') = 'S')
                                  or
                                  (coalesce(et.proc_custo,'N') = 'S')
                                )
                            and (et.data_ent between :data1 and :data2)
      into :num_nf, :frete_lf, :pessoa_fj

  do
  begin
        if (frete_lf = 'S') then
        begin
            /*Aplicando o frete nas despesas acessorias*/
            select sum(

                            coalesce(et.VLR_EMBALAGEM,0)  +
                            coalesce(et.VLR_SEGURO,0)  +
                            coalesce(et.VLR_FRETE,0)  +
                            coalesce(et.VLR_IPI,0)  +
                            coalesce(et.TAXAS,0)  -
                            coalesce(et.VLR_DESCONTO,0) +
                            coalesce(et.VLR_ICM_SUBS,0)
                           ),
                           sum(et.vlr_produtos),
                           sum(et.vlr_icm_subs)

            from est_entradas et
            where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end
        else
        begin
            select
               sum(

                coalesce(et.VLR_EMBALAGEM,0)  +
                coalesce(et.VLR_SEGURO,0)  +
                coalesce(et.VLR_IPI,0)  +
                coalesce(et.TAXAS,0)  -
                coalesce(et.VLR_DESCONTO,0) +
                coalesce(et.VLR_ICM_SUBS,0)
               ),
               sum(et.vlr_produtos), sum(et.vlr_icm_subs)
            from est_entradas et
            where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
            into :vlr_despesas, :vlr_produtos, :vlr_icm_subs;
        end


      num_item = 0;
      for select et.data_ent, et.serie_nf, coalesce(nat.mov_estoque,'N'), psa.cpf_cgc, ET.PERC_ICM, et.vlr_bc_icm, et.vlr_bc_icm_subs
          from est_entradas et
          inner join glo_pessoas_fj psa on (psa.cnpj = et.cnpj and psa.codigo = et.pessoa_fj)
          inner join est_natureza nat on (nat.cnpj = et.cnpj and nat.codigo = et.natureza)
          where et.cnpj = :cnpj and (et.data_ent between :data1 and :data2) and et.ndocto = :num_nf and et.pessoa_fj = :pessoa_fj
          into :data_movto, :serie,  :movimenta_mercadoria, :psa_cpf_cnpj, :aliquota_icms, :base_calculo_icms, :base_calculo_icms_st
      do
      begin
          serie = '1';
          for select eti.produto, eti.cfop, substring(prd.unidade from 1 for 3), prd.cte, prd.ctie,
              eti.quantidade, eti.prc_unitario, eti.descontos, (eti.prc_unitario * eti.quantidade),
              eti.ipi_produto, eti.ipi_produto, prd.nome, prd.nome,
              eti.icm, eti.icm_subs
               from est_entradas_itens eti
              inner join est_produtos prd on (prd.codigo = eti.produto and eti.cnpj = prd.cnpj)
              where eti.cnpj = :cnpj and eti.ndocto = :num_nf and eti.pessoa_fj = :pessoa_fj
              into :cod_produto, :cfop, :unidade, :cte, :ctie,
              :qtde, :preco_unitario, :desconto, :valor_item,
              :aliquota_ipi, :valor_ipi,
              :produto_descricao, :produto_fantasia,
              :icms_debitado, :imposto_retido_icms_sub

          do
          begin
            if (:num_nf = '6374') then
              num_nf = '6374';

            base_icms = 0;
            base_icms_sub = 0;
            base_ipi = 0;
            produto_pct_red_base = 0;
            aliquota_ipi = :aliquota_ipi;

            if (:psa_uf = 'MS') then
              xcte = :cte;
            else
              xcte = :ctie;

           indicacao_tributacao = 'T';
           if (:xcte = 1) then
           begin
             sit_trib = '000';
             base_icms = :valor_item;
           end
           else if (:xcte = 2) then
           begin
             sit_trib = '020';

             select r.perc_estadual, r.perc_interestadual from est_reducoes r
             inner join est_produtos prd on (prd.cnpj = r.cnpj and prd.reducao = r.codigo)
             where prd.cnpj = :cnpj and prd.codigo = :cod_produto
             into :perc_estadual, :perc_interestadual;

             if (:psa_uf = 'MS') then
               reducao = :perc_estadual;
             else
               reducao = :perc_interestadual;

             produto_pct_red_base = :reducao;

             base_icms = :valor_item - ((:valor_item * :reducao)/100.00);
           end
           else if (:xcte = 3) then
           begin
             sit_trib = '040';
             indicacao_tributacao = 'I';
           end
           else if (:xcte = 5) then
             sit_trib = '051';
           else if (:xcte = 6) then
           begin
             sit_trib = '060';
             base_icms = :valor_item;
           end
           else if (:xcte = 7) then
             sit_trib = '090';
           else
             sit_trib = '010';

           if (:aliquota_ipi > 0) then
             base_ipi = :valor_item;

           produto_sit_trib = :sit_trib;
           num_item = num_item + 1;

           desp_acessorias = ((((:valor_item * 100)/:vlr_produtos) * :vlr_despesas)/100);

           valor_ipi = ((:valor_item)*  ( :aliquota_ipi / 100));

           imposto_retido_icms_sub = ((((:valor_item * 100)/:vlr_produtos) * :vlr_icm_subs)/100);

           IF (coalesce(:base_calculo_icms,0) = 0) then
           begin
             aliquota_icms = 0;
             base_icms = 0;
           end
           else
           if (:base_calculo_icms_st = 0) then
           begin
             base_icms_sub = 0;
             imposto_retido_icms_sub = 0;
             vlr_icm_subs = 0;
           end
           suspend;
          end
      end
  end

end
^

ALTER PROCEDURE PCD_SINTEG_60D (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    DATA_MOVTO DATE,
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    PRD_DESCRICAO VARCHAR(50),
    PRD_UNIDADE VARCHAR(3))
AS
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CANCELADA CHAR(1);
DECLARE VARIABLE TRIB_ALIQ_EST FLOAT;
begin
      select max(s.num_ser_ecf) from EXP_CTB_CF_PROSOFT s
      where s.cnpj = :cnpj and (s.data_movimento between :data1 and :data2)
      into :num_ser_ecf;

      for select vd.dt_emissao_cf, substring(vdi.produto from 1 for 14),sum(vdi.quantidade),
      sum(
            (
              vdi.quantidade * (vdi.prc_unitario)
            )
            +
            (
             (
              (
               (
                (vdi.quantidade * vdi.prc_unitario) * 100
               )/vd.total
              )* vd.desc_acres
             )/100
            )
         ) ,
         PRD.cte,
         PRD.TRIB_ALIQ_EST,
         VD.cancelada,
         prd.nome,
         COALESCE(PRD.unidade,'UND')
          from fat_vendas_itens vdi
          inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
          inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
          where vd.cnpj = :cnpj and (vd.dt_emissao_cf between :data1 and :data2) and vd.num_cupom > 0
          group by vd.dt_emissao_cf, substring(vdi.produto from 1 for 14),PRD.cte, PRD.TRIB_ALIQ_EST, VD.cancelada,prd.nome, PRD.unidade
          into :data_movto, :cod_produto, :qtde,  :valor, :cte, :aliquota, :cancelada, :prd_descricao, :prd_unidade
      do
      begin
           sit_trib = '';
           /*Substituição Tributária F
            Isento I
            Não Incidência N
            Cancelamentos CANC
            Descontos DESC
            ISSQN ISS


            1 - Tributada Integralmente
            2 - Tributada com Redução na Base de Cálculo
            3 - Isento de ICMS
            4 - ICMS não incidência
            5 - Diferido
            6 - Substituição Tributária
            7 - ISS
            */

           if (:cte = 3) then
             sit_trib = 'I';
           else if (:cte = 4) then
             sit_trib = 'N';
           else if (:cte = 6) then
             sit_trib = 'F';
           else if (:cte = 7) then
             sit_trib = 'ISS';
           else
           begin
             base_icms = :valor;
             valor_icms = ((:base_icms * :aliquota)/100);
           end

           if (:cancelada = 'S') then
             sit_trib = 'CANC';

            suspend;
      end
end
^

ALTER PROCEDURE PCD_SINTEG_60I (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    DATA_MOVTO DATE,
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    PRD_DESCRICAO VARCHAR(50),
    PRD_UNIDADE VARCHAR(3),
    NUM_CUPOM INTEGER,
    N_ITEM INTEGER)
AS
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CUPOM_ANTIGO INTEGER;
DECLARE VARIABLE CANCELADA CHAR(1);
DECLARE VARIABLE TRIB_ALIQ_EST FLOAT;
begin
      select max(s.num_ser_ecf) from EXP_CTB_CF_PROSOFT s
      where s.cnpj = :cnpj and (s.data_movimento between :data1 and :data2)
      into :num_ser_ecf;

      for select vd.dt_emissao_cf, vd.NUM_CUPOM, substring(vdi.produto from 1 for 14), vdi.quantidade,
            (
              vdi.prc_unitario
            )
            +
            (
             (
              (
               (
                vdi.quantidade * vdi.prc_unitario
               )
               /vd.total
              )
              * vd.desc_acres
             )
             /vdi.quantidade
            ),


         PRD.cte,
         PRD.TRIB_ALIQ_EST,
         VD.cancelada,
         prd.nome,
         PRD.unidade
          from fat_vendas_itens vdi
          inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
          inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
          where vd.cnpj = :cnpj and (vd.dt_emissao_cf between :data1 and :data2) and vd.num_cupom > 0
          order by vd.num_cupom
          into :data_movto, :num_cupom, :cod_produto, :qtde,  :valor, :cte, :aliquota, :cancelada, :prd_descricao, :prd_unidade
      do
      begin
           if (coalesce(:cupom_antigo,0) <> :num_cupom) then
           begin
             n_item = 1;
             cupom_antigo = :num_cupom;
           end
           else
             n_item = :n_item + 1;

           sit_trib = '';
           /*Substituição Tributária F
            Isento I
            Não Incidência N
            Cancelamentos CANC
            Descontos DESC
            ISSQN ISS


            1 - Tributada Integralmente
            2 - Tributada com Redução na Base de Cálculo
            3 - Isento de ICMS
            4 - ICMS não incidência
            5 - Diferido
            6 - Substituição Tributária
            7 - ISS
            */

           if (:cte = 3) then
             sit_trib = 'I';
           else if (:cte = 4) then
             sit_trib = 'N';
           else if (:cte = 6) then
             sit_trib = 'F';
           else if (:cte = 7) then
             sit_trib = 'ISS';
           else
           begin
             base_icms = (:qtde * :valor);
             valor_icms = ((:base_icms * :aliquota)/100);
           end

           if (:cancelada = 'S') then
             sit_trib = 'CANC';

            suspend;
      end
end
^

ALTER PROCEDURE PCD_SINTEG_60R (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE)
RETURNS (
    NUM_SER_ECF VARCHAR(20),
    COD_PRODUTO VARCHAR(14),
    SIT_TRIB CHAR(4),
    QTDE FLOAT,
    VALOR FLOAT,
    ALIQUOTA FLOAT,
    BASE_ICMS FLOAT,
    VALOR_ICMS FLOAT,
    MESANO VARCHAR(6))
AS
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CANCELADA CHAR(1);
DECLARE VARIABLE TRIB_ALIQ_EST FLOAT;
begin
      mes = extract (month FROM :data1);
      ANO = extract (YEAR FROM :data1);
      if (:mes <=9) then
        mesano = '0'||:mes||:ano;
      else
        mesano = :mes||:ano;
      select max(s.num_ser_ecf) from EXP_CTB_CF_PROSOFT s
      where s.cnpj = :cnpj and (s.data_movimento between :data1 and :data2)
      into :num_ser_ecf;

      for select  substring(vdi.produto from 1 for 14),sum(vdi.quantidade),
      sum(
            (
              vdi.quantidade * (vdi.prc_unitario)
            )
            +
            (
             (
              (
               (
                (vdi.quantidade * vdi.prc_unitario) * 100
               )/vd.total
              )* vd.desc_acres
             )/100
            )
         ) ,
         PRD.cte,
         PRD.TRIB_ALIQ_EST,
         VD.cancelada
          from fat_vendas_itens vdi
          inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
          inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
          where vd.cnpj = :cnpj and (vd.dt_emissao_cf between :data1 and :data2) and vd.num_cupom > 0
          group by  substring(vdi.produto from 1 for 14),PRD.cte, PRD.TRIB_ALIQ_EST, VD.cancelada
          into  :cod_produto, :qtde,  :valor, :cte, :aliquota, :cancelada
      do
      begin
           sit_trib = '';
           /*Substituição Tributária F
            Isento I
            Não Incidência N
            Cancelamentos CANC
            Descontos DESC
            ISSQN ISS


            1 - Tributada Integralmente
            2 - Tributada com Redução na Base de Cálculo
            3 - Isento de ICMS
            4 - ICMS não incidência
            5 - Diferido
            6 - Substituição Tributária
            7 - ISS
            */

           if (:cte = 3) then
             sit_trib = 'I';
           else if (:cte = 4) then
             sit_trib = 'N';
           else if (:cte = 6) then
             sit_trib = 'F';
           else if (:cte = 7) then
             sit_trib = 'ISS';
           else
           begin
             base_icms = :valor;
             valor_icms = ((:base_icms * :aliquota)/100);
           end

           if (:cancelada = 'S') then
             sit_trib = 'CANC';

            suspend;
      end
end
^

ALTER PROCEDURE PCD_SUB_PCD_EST_MAX_MIN (
    CNPJ VARCHAR(18),
    GRUPO INTEGER,
    PRD_CODIGO VARCHAR(15),
    TIPO INTEGER)
RETURNS (
    PRD_ESTOQUE NUMERIC(18,4))
AS
DECLARE VARIABLE MESES_MIN INTEGER;
DECLARE VARIABLE MESES_MAX INTEGER;
DECLARE VARIABLE DT_PESQUISA DATE;
DECLARE VARIABLE QTDE_PERIODO NUMERIC(18,4);
DECLARE VARIABLE BASE INTEGER;
begin

    /* Percorro a configuração do grupo dos produtos*/
    select grp.minimo, grp.maximo, grp.base  from est_grupos grp
    where grp.cnpj = :cnpj and grp.codigo = :grupo
    into  :meses_min, :meses_max, :base;
    
    /*decrementando a data de hj em x dias - Base(Meses * 30)*/
    dt_pesquisa = cast ('today' as date);
    dt_pesquisa = (:dt_pesquisa - (:base * 30));
    
    /*pesquisando todas as vendas no período determinado pelo grupo para se descobrir a
    qtde de produto comercializada no período*/
    select sum(vdi.quantidade) from fat_vendas vd
    inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
    inner join fat_vendas_itens vdi on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
    where vd.cnpj = :cnpj and vdi.produto = :prd_codigo and vd.data_caixa >= :dt_pesquisa
    and coalesce(vd.fechada,'N') = 'S' and coalesce(vd.cancelada,'N') = 'N'
    and coalesce(vd.enviada_cx,'N') = 'S' and nat.es = 'S' and nat.computa_venda = 'S'
    and nat.ativa = 'S'
    into :qtde_periodo;
    
    qtde_periodo = coalesce(:qtde_periodo,0);
    
    /*média mensal de vendas*/
    qtde_periodo = (:qtde_periodo / :base);
    
    /*arredondamento*/
    select sai from round2(:qtde_periodo) into :qtde_periodo;
    
    /*estoque mínimo*/
    /*qtde média do período para calcular o mínimo necessário*/
    if (:tipo = 1) then
       prd_estoque = (:qtde_periodo * :meses_min);
    else if (:tipo = 2) then /*estoque máximo*/
       prd_estoque = (:qtde_periodo * :meses_max);

    suspend;
END
^

ALTER PROCEDURE PCD_SUB_REL_RECEBER (
    CNPJ VARCHAR(14),
    COD_CLIENTE INTEGER,
    COD_RECEBER INTEGER,
    DT_CX DATE,
    TIPO_JUROS CHAR(1),
    TX_JUROS_ATE NUMERIC(18,4),
    TX_JUROS_APOS NUMERIC(18,4),
    TOLERANCIA_JUROS INTEGER,
    MULTA_FINANCEIRA NUMERIC(18,4),
    CIDADE INTEGER,
    VENDA INTEGER,
    DATA DATE,
    VLR_CONTA NUMERIC(18,4),
    COD_LOCALCOBRANCA INTEGER)
RETURNS (
    DESCTO_RES NUMERIC(15,2),
    COD_VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    LOCALCOBRANCA VARCHAR(50),
    CLASSIFICACAO VARCHAR(50),
    COD_CLASSIFICACAO INTEGER,
    LOCAL_TRABALHO VARCHAR(50),
    ROTA VARCHAR(50),
    COD_ROTA INTEGER,
    SALDO NUMERIC(18,4),
    JUROS FLOAT,
    MULTA FLOAT)
AS
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE JUROS_CLIENTE NUMERIC(18,4);
DECLARE VARIABLE XMULTA NUMERIC(18,4);
begin
        select coalesce(cli.taxa_juros,0) from glo_clientes cli
        where cli.cnpj = :cnpj and cli.pessoa_fj = :cod_cliente
        into :juros_cliente;

        if (:juros_cliente > 0) then
        begin
          tx_juros_apos = :juros_cliente;
          tx_juros_ate = :juros_cliente;
        end

        saldo = :vlr_conta;
        /*Calculando valores de Receber - Parametro para verificar o vencimento é a data do caixa*/
        select coalesce(valor_multa,0) from pcd_calcula_multa_rec(:cnpj,:cod_receber,:cod_cliente,:venda,:dt_cx,:tolerancia_juros, :multa_financeira)
        into :xmulta;
        saldo = :saldo + :xmulta ;
    
        select coalesce(valor_juros,0) from pcd_calcula_juros(:cnpj,:saldo,:DATA,:dt_cx,:TX_JUROS_ATE,:tx_juros_apos,:tipo_juros,:tolerancia_juros)
        into :juros;
        saldo = :saldo + :juros ;
    
    
        /*Rota na qual a cidade pertence.. ms ela poderá pertencer a mais de uma rota
        por isso o max.. pra evitar erro na select.. fz oq..*/
        select max(rt.codigo), max(rt.nome) from crg_rotas rt
        inner join crg_rotas_cidades rtc on (rt.cnpj = rtc.cnpj and rt.codigo = rtc.rota)
        where rtc.cidade = :cidade and rtc.cnpj = :cnpj
        into :cod_rota, :rota;


        /*classificação do cliente*/
        select coalesce(cli.cod_classif,0), cli.local_trabalho  from glo_clientes cli
        where cli.pessoa_fj = :cod_cliente and cli.cnpj = :cnpj
        into :cod_classificacao, :local_trabalho;
    
        select cl.nome from glo_classificacao cl
        where cl.codigo = :cod_classificacao and cl.cnpj = :cnpj
        into :classificacao;

        if (:classificacao is null) then
          classificacao = 'Classificação não definida';

        select cb.nome from fin_local_cobranca cb
        where cb.codigo = :cod_localcobranca and cb.cnpj = :cnpj
        into :localcobranca;

        if (:localcobranca is null ) then
           localcobranca = 'L. Cob. não definido';

        /*valores de venda*/
        select vd.vendedor, vdd.nome, coalesce(vd.desc_acres,0), vd.total, coalesce(vd.descto_res,0) from fat_vendas vd
        inner join fat_vendedor vdd on (vd.vendedor = vdd.codigo and vdd.cnpj = vd.cnpj)
        where vd.cnpj = :cnpj and vd.codigo = :venda and vd.pessoa_fj = :cod_cliente
        into :cod_vendedor, :nome_vendedor, :desc_acres, :total,:descto_res;
    
        /*Calculando o desconto que ainda poderá ser aplicado sobre as contas a receber*/

        /*descobrindo quanto o descto-res representa na venda (%)*/
        descto_res = 0;
        if ((:total + :desc_acres) > 0) then
        begin
          descto_res = (:descto_res * 100)/(:total + :desc_acres);
          descto_res = (:saldo * :descto_res)/100.00;
        end

        multa = :xmulta;
  suspend;
END
^

ALTER PROCEDURE PCD_TESTANDO (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    DESC_ATUAL NUMERIC(18,4))
RETURNS (
    TTL_VENDA NUMERIC(18,4),
    DESCTO_RES NUMERIC(18,4),
    VALIDO CHAR(1))
AS
DECLARE VARIABLE UNT_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE UNT_VALOR NUMERIC(18,4);
DECLARE VARIABLE UNT_PROMOCAO NUMERIC(18,4);
DECLARE VARIABLE UNT_ESPECIAL NUMERIC(18,4);
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE QTDE NUMERIC(18,4);
DECLARE VARIABLE DESCTO_MAX NUMERIC(18,4);
DECLARE VARIABLE VLR_DESCT_ITEM NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCT_ITEM NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCT_REST_ITEM NUMERIC(18,4);
DECLARE VARIABLE VLR_DESCT_REST_ITEM NUMERIC(18,4);
DECLARE VARIABLE TTL_DESCT_REST NUMERIC(18,4);
begin
  /*Procedimento será utilizado para a valiadação de descontos nos formulários de vendas
  e de faturamento */


  /*--------------INICIANDO VERIFICAÇÃO PARA SABER SE O DESCONTO É VALIDO--------------------------*/
  vlr_desct_item = 0;
  pct_desct_item = 0;
  pct_desct_rest_item = 0;
  vlr_desct_rest_item = 0;
  ttl_desct_rest = 0;

  select coalesce(emp.desconto_maximo,0) from sis_empresas emp
  where emp.cnpj = :cnpj
  into  :descto_max;


  /*pergando vlrs. de venda*/
  select coalesce(vd.total,0), coalesce(vd.desc_acres,0), vd.pessoa_fj
  from fat_vendas vd
  where vd.cnpj = :cnpj and vd.codigo = :venda
  into :ttl_venda, :desc_acres, :pessoa_fj;

  /*entao o cliente não controla desconto,ou seja, pode dar o desconto que quiser*/
  if ((:descto_max = 0) or (:ttl_venda = 0))then
  begin
    descto_res = (:ttl_venda + :desc_acres);
    valido = 'S';
    suspend;
    exit;
  end


  /*percorrendo os itens*/
  for select vdi.produto, coalesce(vdi.prc_unit_original,0), (coalesce(vdi.prc_unitario,0) - coalesce(vdi.desconto,0)),
  vdi.quantidade from fat_vendas_itens vdi
      where vdi.cnpj = :cnpj and vdi.codigo = :venda
      into :produto,:unt_original, :unt_valor, :qtde
  do
  begin
     unt_especial = 0;
     unt_promocao = 0;
     /*pegando o preço da promoção*/
     select coalesce(pro.valor,0) from est_promocao pro
     where pro.cnpj = :cnpj and pro.produto = :produto
     into :unt_promocao;

     if (:unt_promocao is null) then
       unt_promocao = 0;



     select coalesce(prc.resultado,0) from GLO_PRECOS_ESPECIAIS prc
     where prc.cnpj = :cnpj and prc.pessoa_fj = :pessoa_fj and prc.produto = :produto
     into :unt_especial;

     if (:unt_especial is null) then
       unt_especial = 0;

      /*Caso o valor seja especial ou normal ele cai aqui*/
     if ((:unt_promocao = 0) or ((:unt_especial < :unt_promocao) and (:unt_especial > 0))) then
     begin
       if (:unt_original = 0) then
          unt_original = :unt_valor;

       if (:unt_original > 0) then
       begin
         vlr_desct_item = :unt_original - :unt_valor;
         pct_desct_item = (:vlr_desct_item * 100.00)/:unt_original;
       end
       else
       begin
         vlr_desct_item = 100;
         pct_desct_item = 100;
       end

       /*ainda dar isso de resto de desconto*/
       if ((:pct_desct_item < :descto_max)) then
       begin
         /*pde acontecer deste vlr ser menor e até ser negativo, se aplicado um acréscimo*/
         if (:pct_desct_item > 0) then
         begin
           pct_desct_rest_item = (:descto_max - :pct_desct_item);
           vlr_desct_rest_item = (((:unt_original *:qtde)* :pct_desct_rest_item)/100.00);
           ttl_desct_rest = (:ttl_desct_rest + :vlr_desct_rest_item);
         end
         else
         begin
           pct_desct_rest_item = (:descto_max);
           vlr_desct_rest_item = (((:unt_original * :pct_desct_rest_item)/100.00) * :qtde);
           vlr_desct_rest_item =  vlr_desct_rest_item + ((:unt_valor - :unt_original)* :qtde);
           ttl_desct_rest = (:ttl_desct_rest + :vlr_desct_rest_item);
         end
       end
     end
     else if ((:unt_especial = 0) or ((:unt_promocao > 0) and (:unt_promocao <= :unt_especial))) then
     begin /*Valor em Promoção*/
        vlr_desct_item = :unt_promocao - :unt_valor;
        pct_desct_item = (:vlr_desct_item * 100.00)/:unt_promocao;

        if ((:pct_desct_item < :descto_max)) then
        begin
          pct_desct_rest_item = (:descto_max - :pct_desct_item);
          vlr_desct_rest_item = ((:unt_promocao * :pct_desct_rest_item)/100.00)*:qtde;
          ttl_desct_rest = (:ttl_desct_rest + :vlr_desct_rest_item);
        end
     end
  end
  select * from round2(:ttl_desct_rest) into :ttl_desct_rest;
  select * from round2(:desc_atual) into :desc_atual;
  /*até aqui verificando se o desconto dado é valido ou não*/
  descto_res = (:ttl_desct_rest + :desc_atual);

  if (:descto_res >=0) then
    valido = 'S';
  else
    valido = 'N';

  update fat_vendas vd set vd.descto_res = :descto_res where vd.cnpj = :cnpj and vd.codigo = :venda;

  suspend;
END
^

ALTER PROCEDURE PCD_TOTAL_FISCAL (
    CNPJ VARCHAR(14),
    DTINI DATE,
    DTFIN DATE,
    CLIENTE INTEGER)
RETURNS (
    CTE5VLRICMS NUMERIC(18,4),
    CTE5TOTAL NUMERIC(18,4),
    CTE5BASEICMS NUMERIC(18,4),
    CTEESTBASEICMS NUMERIC(18,4),
    CTEESTVLRICMS NUMERIC(18,4),
    CTEESTTOTAL NUMERIC(18,4),
    CTEINTBASEICMS NUMERIC(18,4),
    CTEINTVLRICMS NUMERIC(18,4),
    CTEINTTOTAL NUMERIC(18,4),
    CTE3BASEICMS NUMERIC(18,4),
    CTE3VLRICMS NUMERIC(18,4),
    CTE3TOTAL NUMERIC(18,4),
    CTEDIVBASEICMS NUMERIC(18,4),
    CTEDIVVLRICMS NUMERIC(18,4),
    CTEDIVTOTAL NUMERIC(18,4),
    CTEDEVBASEICMS NUMERIC(18,4),
    CTEDEVVLRICMS NUMERIC(18,4),
    CTEDEVTOTAL NUMERIC(18,4))
AS
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE BASEICMS NUMERIC(18,4);
DECLARE VARIABLE VLRICMS NUMERIC(18,4);
DECLARE VARIABLE COD_VENDA INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE UF CHAR(2);
DECLARE VARIABLE UF_EMP CHAR(2);
DECLARE VARIABLE TTL_DIVERSOS CHAR(1);
begin
  /*1 - Tributada Integralmente
        2 - Tributada com Redução na Base de Cálculo
        3 - Isento no calculo
        4 - ICMS não incidência
        5 - Diferido
        6 - Substituição Tributária
        7 - ISS
    */

  /* Procedure Text */
  cte3total = 0;
  cte3baseicms = 0;
  cte3vlricms = 0;

  cte5total = 0;
  cte5baseicms = 0;
  cte5vlricms = 0;

  cteesttotal = 0;
  cteestbaseicms = 0;
  cteestvlricms = 0;

  cteinttotal = 0;
  cteintbaseicms =  0;
  cteintvlricms = 0;

  ctedivtotal = 0;
  ctedivbaseicms = 0;
  ctedivvlricms = 0;

  CTEDEVBASEICMS = 0;
  CTEDEVVLRICMS = 0;
  CTEDEVTOTAL = 0;

  /*dentro deste procedure repete-se o mesmo código, modificado apenas o where para se adequar
  ao filtro do relatório de vendas fiscais*/
  if (:cliente is null) then
  begin
      /*calculando os totais de devolução*/
      select sum(coalesce(vd.base_icm,0)), sum(coalesce(vd.icm,0)), sum(coalesce(vd.total_nota,0))
      from fat_vendas vd /*não preciso colocar no filtro que são notas de entrada, pq se ttl-res.. so estara ='s' qndo for entrada*/
      inner join est_natureza nat on (nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :dtini and :dtfin)
      and vd.fechada = 'S' and vd.cancelada = 'N' and nat.devolucao = 'S'
      and (((vd.num_cupom <> 0) and (vd.num_cupom is not null)) or ((vd.num_nf <> 0) and (vd.num_nf is not null)))
      into :ctedevbaseicms, :ctedevvlricms, :ctedevtotal;

      for select vd.codigo,coalesce(vd.total_nota,0),coalesce(vd.base_icm,0), coalesce(vd.icm,0),  vd.pessoa_fj,
          nat.ttl_res_diversos from fat_vendas vd
          inner join est_natureza nat on (nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :dtini and :dtfin)
          and vd.fechada = 'S' and vd.cancelada = 'N' and nat.computa_venda = 'S' and nat.es = 'S' and
          (((vd.num_cupom <> 0) and (vd.num_cupom is not null)) or ((vd.num_nf <> 0) and (vd.num_nf is not null)))
          into :cod_venda, :total, :baseicms, :vlricms, :pessoa_fj, :ttl_diversos
      do
      begin
        /*totalizador de diversos que não se enquadram em nenhuma das especificações logo abaixo*/
        /*quando uma movimentação*/
        if (:ttl_diversos = 'S') then
        begin
          ctedivtotal = :ctedivtotal + :total;
          ctedivbaseicms = :ctedivbaseicms + :baseicms;
          ctedivvlricms = :ctedivvlricms + :vlricms;
        end
        else
        begin
          /*calculando tributações estaduais*/
          select psa.uf from glo_pessoas_fj psa where psa.codigo = :pessoa_fj
          into :uf;
      
          select uf from sis_empresas emp into :uf_emp;
      
  
          /*cliente estadual*/
          if (:uf = :uf_emp) then
          begin
              select max(vdi.cte) from fat_vendas_itens vdi where vdi.codigo = :cod_venda and vdi.cnpj = :cnpj
              into :cte;
              
              if (:cte = 3) then /*3 - Isento de ICMS*/
              begin
                  cte3total = :cte3total + :total;
                  cte3baseicms = :cte3baseicms + :baseicms;
                  cte3vlricms = :cte3vlricms + :vlricms;
              end
              else if (:cte = 5) then /*5 - Diferido*/
              begin
                  cte5total = cte5total + :total;
                  cte5baseicms = cte5baseicms + :baseicms;
                  cte5vlricms =  cte5vlricms + :vlricms;
              end
              else
              begin /* - Estadual */
                  cteesttotal = :cteesttotal + :total;
                  cteestbaseicms = :cteestbaseicms + :baseicms;
                  cteestvlricms = :cteestvlricms + :vlricms;
              end
          end
          else/*tributação inter stadual*/
          begin
              cteinttotal = :cteinttotal + :total;
              cteintbaseicms = :cteintbaseicms + :baseicms;
              cteintvlricms = :cteintvlricms + :vlricms;
          end
        end
      end
      suspend;
  end
  else /*filtrando por cliente*/
  begin
      /*calculando os totais de devolução*/
      select sum(coalesce(vd.base_icm,0)), sum(coalesce(vd.icm,0)), sum(coalesce(vd.total_nota,0))
      from fat_vendas vd /*não preciso colocar no filtro que são notas de entrada, pq se ttl-res.. so estara ='s' qndo for entrada*/
      inner join est_natureza nat on (nat.codigo = vd.natureza)
      where vd.cnpj = :cnpj and (vd.data_caixa between :dtini and :dtfin)
      and vd.fechada = 'S' and vd.cancelada = 'N' and nat.devolucao = 'S' and  vd.pessoa_fj = :cliente
      and (((vd.num_cupom <> 0) and (vd.num_cupom is not null)) or ((vd.num_nf <> 0) and (vd.num_nf is not null)))
      into :ctedevbaseicms, :ctedevvlricms, :ctedevtotal;

      for select vd.codigo, vd.total_nota, vd.base_icm, vd.icm,  vd.pessoa_fj from fat_vendas vd
          inner join est_natureza nat on (nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :dtini and :dtfin)
          and nat.computa_venda = 'S' and nat.es = 'S'
          and vd.fechada = 'S' and vd.cancelada = 'N' and  vd.pessoa_fj = :cliente and
          (((vd.num_cupom <> 0) and (vd.num_cupom is not null)) or ((vd.num_nf <> 0) and (vd.num_nf is not null)))
          into :cod_venda, :total, :baseicms, :vlricms, :pessoa_fj
      do
      begin
        /*calculando tributações estaduais*/
        select psa.uf from glo_pessoas_fj psa where psa.codigo = :pessoa_fj
        into :uf;
    
        select uf from sis_empresas emp into :uf_emp;
    
        /*cliente estadual*/
        if (:uf = :uf_emp) then
        begin
            select max(vdi.cte) from fat_vendas_itens vdi where vdi.codigo = :cod_venda and vdi.cnpj = :cnpj
            into :cte;
            
            if (:cte = 3) then /*3 - Isento de ICMS*/
            begin
                cte3total = :cte3total + :total;
                cte3baseicms = :cte3baseicms + :baseicms;
                cte3vlricms = :cte3vlricms + :vlricms;
            end
            else if (:cte = 5) then /*5 - Diferido*/
            begin
                cte5total = cte5total + :total;
                cte5baseicms = cte5baseicms + :baseicms;
                cte5vlricms =  cte5vlricms + :vlricms;
            end
            else
            begin
                cteesttotal = :cteesttotal + :total;
                cteestbaseicms = :cteestbaseicms + :baseicms;
                cteestvlricms = :cteestvlricms + :vlricms;
            end
        end
        else/*tributação inter stadual*/
        begin
            cteinttotal = :cteinttotal + :total;
            cteintbaseicms = :cteintbaseicms + :baseicms;
            cteintvlricms = :cteintvlricms + :vlricms;
        end
      end
      suspend;
  end
END
^

ALTER PROCEDURE PCD_TTL_VD_VISTA_PRAZO (
    CNPJ VARCHAR(14),
    USUARIO INTEGER,
    DATA_CX DATE,
    TURNO INTEGER,
    VISTA CHAR(1))
RETURNS (
    TOTAL NUMERIC(18,4))
AS
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE ENTRADA NUMERIC(18,4);
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE TROCO NUMERIC(18,4);
DECLARE VARIABLE TIPO_VENDA VARCHAR(3);
DECLARE VARIABLE VLR_PRAZO NUMERIC(18,4);
DECLARE VARIABLE VLR_VISTA NUMERIC(18,4);
DECLARE VARIABLE TIPO VARCHAR(5);
DECLARE VARIABLE CHEQUE_VISTA CHAR(1);
DECLARE VARIABLE CARTAO_VISTA_AUX VARCHAR(1);
DECLARE VARIABLE DATA_LANCTO_CRT DATE;
DECLARE VARIABLE DATA_REEMB_CRT DATE;
DECLARE VARIABLE DATA_LANCTO_CH DATE;
DECLARE VARIABLE DATA_PRE_CH DATE;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE MUDOU CHAR(1);
begin
  /* Procedimento retornará o total de vendas a vista ou de vendas a prazo do caixa
  dependendo do parâmetro Vista = 'S' ou 'N', utilizado no resumo de caixa (PCD_RESUMO_CAIXA)*/
  /*vendas*/
  for select codigo, desc_acres, entrada, dinheiro, cheque, cartao, TICKET,
  total, tipo_venda, troco
  from fat_vendas vd/*pego as vendas que estemjam na data de caixa */
  where cnpj = :cnpj and usuario = :usuario and data_caixa = :data_cx
  and turno = :turno and fechada = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :desc_acres, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :tipo_venda, :troco
  do
  begin
    Mudou = 'N';
    vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
    vlr_prazo = (:total + :desc_acres) - :vlr_vista;/*desconto já vem negativo*/

    if (:vlr_prazo < 0.01) then
      vlr_prazo = 0;

    if (((:VLR_vista > 0) and (:tipo_venda <> 'FFT') and (:vlr_prazo = 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if (:cartao > 0) then
      begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso from fin_movimento_cartao crt
          where crt.venda = :codigo and crt.cnpj = :cnpj
          into :data_lancto_crt, :data_reemb_crt
          do
          begin
            if (:data_reemb_crt > :data_lancto_crt) then
              cartao_vista_aux = 'N';
          end
      end

      if (:cheque > 0) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.venda = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
      begin
        tipo = 'Prazo';
        MUDOU = 'S'; /*status do movimento mudou*/
      end

    end
    if ((Vista = 'N') and (MUDOU = 'N'))then
       Total = vlr_prazo;
    else
       Total = (:total + :desc_acres);
    /*não retorno o total da venda, mas so o valor parcelado*/


    if ((Vista = 'S' and Tipo = 'Vista') or (Vista = 'N' and Tipo = 'Prazo')) then
      suspend;
  end

  /*Trocas*/
  for select codigo, entrada, dinheiro, cheque, cartao, TICKET,
  (total_2 - Total)
  from fat_trocas trc/*pego as vendas que estemjam na data de caixa */
  where cnpj = :cnpj and usuario = :usuario and data_caixa = :data_cx
  and turno = :turno and fechado = 'S' and enviada_cx = 'S' /*que estejam fechadas e envidas p/o caixa*/
  and ((cancelada <> 'S') or (cancelada is null)) /*e que não estiverem canceladas*/
  into :codigo, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total
  do
  begin
    vlr_vista = :dinheiro + :cartao + :cheque + :ticket;
    vlr_prazo = :total - :vlr_vista;

    if (((:VLR_vista > 0) and (:tipo_venda <> 'FFT') and (:vlr_prazo <= 0)) or ((:VLR_vista=0) and (:VLR_prazo = 0))) then
      tipo = 'Vista';
    else
      tipo = 'Prazo';

    if ((tipo = 'Vista') and ((:cartao > 0) or (:cheque > 0))) then
    begin
      cheque_vista = 'S';
      cartao_vista_aux = 'S';
      if (:cartao > 0) then
      begin
          /*verificando se cartão a vista ou prazo*/
          /*porque pode ser um parcelamento de cartão*/
          for select crt.data, crt.reembolso from fin_movimento_cartao crt
          where crt.troca = :codigo and crt.cnpj = :cnpj
          into :data_lancto_crt, :data_reemb_crt
          do
          begin
            if (:data_reemb_crt > :data_lancto_crt) then
              cartao_vista_aux = 'N';
          end
      end

      if (:cheque > 0) then
      begin
        /*verificando se Cheque a vista ou prazo*/
        for select ch.data_caixa, ch.pre_date from fin_cheques ch
        where ch.troca = :codigo and ch.cnpj = :cnpj
        into :data_lancto_ch, :data_pre_ch
        do
        begin
          if (:data_pre_ch > :data_lancto_ch) then
            cheque_vista = 'N';
        end
      end

      if ((:cheque_vista = 'S') and (:cartao_vista_aux = 'S')) then
        tipo = 'Vista';
      else
        tipo = 'Prazo';
    end

    /*não retorno o total da venda, mas so o valor parcelado*/
    if (Vista = 'N') then
      Total = vlr_prazo;

    if ((Vista = 'S' and Tipo = 'Vista') or (Vista = 'N' and Tipo = 'Prazo')) then
      suspend;
  end
END
^

ALTER PROCEDURE PCD_VENDA_TERCEIRO (
    CNPJ VARCHAR(14),
    DATA1 DATE,
    DATA2 DATE,
    TIPO CHAR(10),
    TIPO_DT CHAR(10))
RETURNS (
    CODIGO INTEGER,
    DATA_VD DATE,
    VLR_TOTAL FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_LIQUIDO FLOAT,
    TTL_CUSTO_ITENS FLOAT,
    LB_PCT FLOAT,
    LB_VLR FLOAT,
    COD_VENDEDOR INTEGER,
    VENDEDOR VARCHAR(50),
    COD_TERCEIRO INTEGER,
    TERCEIRO VARCHAR(50),
    COD_CLIENTE INTEGER,
    CLIENTE VARCHAR(50),
    COD_FORNECEDOR INTEGER,
    COD_MARCA INTEGER,
    COD_SUBGRUPO INTEGER,
    COD_GRUPO INTEGER,
    COD_PRODUTO VARCHAR(15),
    PRODUTO VARCHAR(50),
    COM_VISTA FLOAT,
    COM_PRAZO FLOAT)
AS
DECLARE VARIABLE SLD_AUX FLOAT;
DECLARE VARIABLE TTL_VD_AUX FLOAT;
DECLARE VARIABLE PCD_RP_AUX FLOAT;
DECLARE VARIABLE DESCTO_AUX FLOAT;
DECLARE VARIABLE ENTRADA FLOAT;
DECLARE VARIABLE FORMA_PAGTO INTEGER;
DECLARE VARIABLE VISTA CHAR(1);
DECLARE VARIABLE PCT_COM_VISTA FLOAT;
DECLARE VARIABLE PCT_COM_PRAZO FLOAT;
begin
  /*Dt. Caixa*/
  if (TIPO_DT = 'C') then
  begin
    /*Sintético -- Sem itens*/
    if (TIPO = 'S') then
    begin
      for select vd.data, vd.codigo,  coalesce(vd.total,0) Total , coalesce(vd.desc_acres,0) Desconto,
            (coalesce(vd.total,0) + coalesce(vd.desc_acres,0)) Vlr_Liquido, vdd.nome, tc.codigo, tc.nome,
            psa.codigo, psa.nome_razao, coalesce(tc.com_prazo,0), coalesce(tc.com_vista,0), coalesce(vd.entrada,0), vd.forma_pgto
            from fat_vendas vd
            inner join fat_terceiros tc on (vd.terceiro = tc.codigo and tc.cnpj = tc.cnpj)
            inner join fat_vendedor vdd on (vdd.codigo = vd.vendedor and vd.cnpj = vdd.cnpj)
            inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and vd.pessoa_fj = psa.codigo)
            inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
            where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
            and vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N'
            and nat.computa_venda = 'S' and nat.es = 'S'
            into :data_vd, :codigo, :vlr_total, :vlr_desconto, :vlr_liquido, :vendedor, :cod_terceiro, :terceiro,
            :cod_cliente, :cliente, :PCT_COM_PRAZO, :PCT_COM_VISTA, :entrada, :forma_pagto
      do
      begin
          com_vista = 0;
          com_prazo = 0;

          select pg.avista from fin_formas_pagto pg
          where pg.codigo = :forma_pagto and pg.cnpj = :cnpj
          into :vista;

          if (:vista = 'S') then
            com_vista = ((:PCT_COM_VISTA * :vlr_liquido)/100);
          else
          begin
            if (:entrada >0) then
              com_vista = ((:PCT_COM_VISTA * :entrada)/100);

            com_prazo = ((:PCT_COM_PRAZO * (:vlr_liquido - :entrada))/100);
          end
            


          select sum(coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0)) from fat_vendas_itens vdi
          where vdi.codigo = :codigo and vdi.cnpj = :cnpj
          into :ttl_custo_itens;

           /*lucro bruto em valor*/
          lb_vlr = (:vlr_liquido - :ttl_custo_itens);

          /*lucro bruto em %*/
          if (:ttl_custo_itens  = 0) then
            lb_pct = 0;
          else
            lb_pct =  (:lb_vlr * 100)/:ttl_custo_itens;
          suspend;
      end
    end
    else
    begin
      for select vd.data, vd.codigo, vdd.nome, tc.codigo, tc.nome,
          psa.codigo, psa.nome_razao, coalesce(vd.total,0), coalesce(vd.desc_acres,0),
          coalesce(tc.com_prazo,0), coalesce(tc.com_vista,0), coalesce(vd.entrada,0), vd.forma_pgto
          from fat_vendas vd
          inner join fat_terceiros tc on (vd.terceiro = tc.codigo and tc.cnpj = tc.cnpj)
          inner join fat_vendedor vdd on (vdd.codigo = vd.vendedor and vd.cnpj = vdd.cnpj)
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and vd.pessoa_fj = psa.codigo)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data_caixa between :data1 and :data2)
          and vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N'
          and nat.computa_venda = 'S' and nat.es = 'S'
          into :data_vd, :codigo, :vendedor, :cod_terceiro, :terceiro,
          :cod_cliente, :cliente, :ttl_vd_aux, :descto_aux, :PCT_COM_PRAZO, :PCT_COM_VISTA,:entrada, :forma_pagto
      do
      begin

        com_vista = 0;
        com_prazo = 0;

        select pg.avista from fin_formas_pagto pg
        where pg.codigo = :forma_pagto and pg.cnpj = :cnpj
        into :vista;

        vlr_liquido = :ttl_vd_aux + :descto_aux;

        if (:vista ='S') then
          com_vista = ((:PCT_COM_VISTA * :vlr_liquido)/100);
        else
        begin
          if (:entrada >0) then
            com_vista = ((:PCT_COM_VISTA * :entrada)/100);

          com_prazo = ((:PCT_COM_PRAZO * (:vlr_liquido - :entrada))/100);
        end

        for select prd.codigo, prd.marca, prd.grupo, prd.subgrupo, prd.fornecedor,
            coalesce(vdi.prc_unitario,0) * coalesce(vdi.quantidade,0),
            coalesce(vdi.desconto,0) * coalesce(vdi.quantidade,0),
            coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0), prd.nome
            from fat_vendas_itens vdi
            inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
            where vdi.codigo = :codigo and vdi.cnpj = :cnpj
            into :cod_produto, :cod_marca, :cod_grupo, :cod_subgrupo,
            :cod_fornecedor, :vlr_total, :vlr_desconto, :ttl_custo_itens, :produto
        do
        begin
          /*total do item liquido*/
           vlr_liquido = (:vlr_total - :vlr_desconto);

          /*porcentagem que o item representa no total da venda*/
           pcd_rp_aux = (:vlr_liquido * 100)/:ttl_vd_aux;

          /*rateando o desconto no item - Lembrando que o descto na vd. é negativo*/
           vlr_liquido = (:vlr_liquido + ((:pcd_rp_aux * :descto_aux)/100));

          /*lucro bruto em valor*/
           lb_vlr = (:vlr_liquido - :ttl_custo_itens);

           if (:ttl_custo_itens  = 0) then
            lb_pct = 0;
           else
            lb_pct =  (:lb_vlr * 100)/:ttl_custo_itens;

           suspend;
        end
      end  
    end
  end
  else
  begin
    /*Sintético -- Sem itens*/
    if (TIPO = 'S') then
    begin
      for select vd.data, vd.codigo,  coalesce(vd.total,0) Total , coalesce(vd.desc_acres,0) Desconto,
            (coalesce(vd.total,0) + coalesce(vd.desc_acres,0)) Vlr_Liquido, vdd.nome, tc.codigo, tc.nome,
            psa.codigo, psa.nome_razao, coalesce(tc.com_prazo,0), coalesce(tc.com_vista,0),
            coalesce(vd.entrada,0), vd.forma_pgto
            from fat_vendas vd
            inner join fat_terceiros tc on (vd.terceiro = tc.codigo and tc.cnpj = tc.cnpj)
            inner join fat_vendedor vdd on (vdd.codigo = vd.vendedor and vd.cnpj = vdd.cnpj)
            inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and vd.pessoa_fj = psa.codigo)
            inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
            where vd.cnpj = :cnpj and (vd.data between :data1 and :data2)
            and vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N'
            and nat.computa_venda = 'S' and nat.es = 'S'
            into :data_vd, :codigo, :vlr_total, :vlr_desconto, :vlr_liquido, :vendedor, :cod_terceiro, :terceiro,
            :cod_cliente, :cliente, :PCT_COM_PRAZO, :PCT_COM_VISTA, :entrada, :forma_pagto
      do
      begin
          com_vista = 0;
          com_prazo = 0;

          select pg.avista from fin_formas_pagto pg
          where pg.codigo = :forma_pagto and pg.cnpj = :cnpj
          into :vista;


          if (:vista = 'S') then
            com_vista = ((:PCT_COM_VISTA * :vlr_liquido)/100);
          else
          begin
            if (:entrada >0) then
              com_vista = ((:PCT_COM_VISTA * :entrada)/100);

            com_prazo = ((:PCT_COM_PRAZO * (:vlr_liquido - :entrada))/100);
          end
            


          select sum(coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0)) from fat_vendas_itens vdi
          where vdi.codigo = :codigo and vdi.cnpj = :cnpj
          into :ttl_custo_itens;

           /*lucro bruto em valor*/
          lb_vlr = (:vlr_liquido - :ttl_custo_itens);

          /*lucro bruto em %*/
          if (:ttl_custo_itens  = 0) then
            lb_pct = 0;
          else
            lb_pct =  (:lb_vlr * 100)/:ttl_custo_itens;
          suspend;
      end
    end
    else
    begin
      for select vd.data, vd.codigo, vdd.nome, tc.codigo, tc.nome,
          psa.codigo, psa.nome_razao, coalesce(vd.total,0), coalesce(vd.desc_acres,0),
          coalesce(tc.com_prazo,0), coalesce(tc.com_vista,0), coalesce(vd.entrada,0), vd.forma_pgto
          from fat_vendas vd
          inner join fat_terceiros tc on (vd.terceiro = tc.codigo and tc.cnpj = tc.cnpj)
          inner join fat_vendedor vdd on (vdd.codigo = vd.vendedor and vd.cnpj = vdd.cnpj)
          inner join glo_pessoas_fj psa on (psa.cnpj = vd.cnpj and vd.pessoa_fj = psa.codigo)
          inner join est_natureza nat on (nat.cnpj = vd.cnpj and nat.codigo = vd.natureza)
          where vd.cnpj = :cnpj and (vd.data between :data1 and :data2)
          and vd.fechada = 'S' and coalesce(vd.cancelada,'N') = 'N'
          and nat.computa_venda = 'S' and nat.es = 'S'
          into :data_vd, :codigo, :vendedor, :cod_terceiro, :terceiro,
          :cod_cliente, :cliente, :ttl_vd_aux, :descto_aux, :PCT_COM_PRAZO, :PCT_COM_VISTA,:entrada, :forma_pagto
      do
      begin
        com_vista = 0;
        com_prazo = 0;

        select pg.avista from fin_formas_pagto pg
        where pg.codigo = :forma_pagto and pg.cnpj = :cnpj
        into :vista;

        vlr_liquido = :ttl_vd_aux + :descto_aux;

        if (:vista ='S') then
          com_vista = ((:PCT_COM_VISTA * :vlr_liquido)/100);
        else
        begin
          if (:entrada >0) then
            com_vista = ((:PCT_COM_VISTA * :entrada)/100);

          com_prazo = ((:PCT_COM_PRAZO * (:vlr_liquido - :entrada))/100);
        end

        for select prd.codigo, prd.marca, prd.grupo, prd.subgrupo, prd.fornecedor,
            coalesce(vdi.prc_unitario,0) * coalesce(vdi.quantidade,0),
            coalesce(vdi.desconto,0) * coalesce(vdi.quantidade,0),
            coalesce(vdi.prc_custo,0) * coalesce(vdi.quantidade,0), prd.nome
            from fat_vendas_itens vdi
            inner join est_produtos prd on (prd.codigo = vdi.produto and prd.cnpj = vdi.cnpj)
            where vdi.codigo = :codigo and vdi.cnpj = :cnpj
            into :cod_produto, :cod_marca, :cod_grupo, :cod_subgrupo,
            :cod_fornecedor, :vlr_total, :vlr_desconto, :ttl_custo_itens, :produto
        do
        begin
          /*total do item liquido*/
           vlr_liquido = (:vlr_total - :vlr_desconto);

          /*porcentagem que o item representa no total da venda*/
           pcd_rp_aux = (:vlr_liquido * 100)/:ttl_vd_aux;

          /*rateando o desconto no item - Lembrando que o descto na vd. é negativo*/
           vlr_liquido = (:vlr_liquido + ((:pcd_rp_aux * :descto_aux)/100));

          /*lucro bruto em valor*/
           lb_vlr = (:vlr_liquido - :ttl_custo_itens);

           if (:ttl_custo_itens  = 0) then
            lb_pct = 0;
           else
            lb_pct =  (:lb_vlr * 100)/:ttl_custo_itens;

           suspend;
        end
      end  
    end
  end
END
^

ALTER PROCEDURE PCD_VERIFICA_LIMITE (
    CNPJ VARCHAR(18),
    CLIENTE INTEGER,
    VALOR_VENDA NUMERIC(18,4),
    FORMA_PAGTO INTEGER)
RETURNS (
    VALIDO CHAR(1),
    LIMITE NUMERIC(18,4),
    TOTAL_CHEQUES NUMERIC(18,4),
    TOTAL_CHEQUES_N_CONCILIADO NUMERIC(18,4),
    TOTAL_CHEQUES_N_REAP NUMERIC(18,4),
    TOTAL_RECEBER NUMERIC(18,4),
    TOTAL_FATURAS NUMERIC(18,4),
    MOTIVO INTEGER)
AS
DECLARE VARIABLE INLCUI_ATUAL CHAR(1);
DECLARE VARIABLE VISTA CHAR(1);
DECLARE VARIABLE LIMITE_TEMPO INTEGER;
DECLARE VARIABLE CHEQUE_VALIDO CHAR(1);
DECLARE VARIABLE LMT_TEMPO_VALIDO CHAR(1);
DECLARE VARIABLE LMT_CRED_VALIDO CHAR(1);
DECLARE VARIABLE CONT_RECEBER INTEGER;
DECLARE VARIABLE CONT_FATURAS INTEGER;
begin
  /* Procedimento Verifica o limite de credito do caboclo*/
  /*utilizando o procedimento somarece.. pois ele já calcula valores de acréscimos
  de juros multas e etc...*/
  select coalesce(cli.limite_credito,0), coalesce(cli.limite_tempo,0) from glo_clientes cli
  where cli.pessoa_fj = :cliente and cli.cnpj = :cnpj
  into :limite, :limite_tempo;

  select coalesce(pgto.avista,'N') from fin_formas_pagto pgto
  where pgto.cnpj = :cnpj and pgto.codigo = :forma_pagto
  into :vista;

  /*Caso exista um limite de tempo ou limite de crédito entra para verificação*/
  if (((:limite > 0) or (limite_tempo > 0)) and (:vista = 'N')) then
  begin
    /*---------------------------Limite de tempo------------------------*/
    if (:limite_tempo > 0) then
    begin
       /*verificando se existe uma conta a receber fora do limite*/
       select count(*) from fin_contas_receber rec
       where (rec.dt_vencto + :limite_tempo) < cast('today' as date)
       and rec.pessoa_fj = :cliente and rec.cnpj = :cnpj
       into :cont_receber;

       /*verificando se existe uma conta a receber fora do limite*/
       select count(*) from fin_faturas ft
       where (ft.vencimento + :limite_tempo) < cast('today' as date)
       and ft.pessoa_fj = :cliente and ft.cnpj = :cnpj
       into :cont_faturas;
       /*caso não exista nenhuma fatura ou receber então
         o limite de tempo é válido*/
       if ((:cont_faturas +:cont_receber)= 0) then
         lmt_tempo_valido = 'S';
       else
         lmt_tempo_valido = 'N';
    end
    else
      lmt_tempo_valido = 'S';



    /*----------------Cheques devolvidos 2 vezes e não acertados-----------*/
    select sum(ch.valor) from fin_cheques ch
    where ch.pessoa_fj = :cliente and ch.vezes_devolucao > 1  and ch.data_acerto is null and ch.cnpj = :cnpj
    into :total_cheques;

    /*----------------Cheques devolvidos apenas uma vez-----------*/
    select sum(ch.valor) from fin_cheques ch
    where ch.pessoa_fj = :cliente and ch.vezes_devolucao = 1  and ch.data_reapres is null and ch.cnpj = :cnpj
    into :total_cheques_n_reap;

    /*Cheques em aberto*/
    select sum(ch.valor) from fin_cheques ch
    where ch.pessoa_fj = :cliente and ch.data_conciliacao is null and ch.cnpj = :cnpj
    into :total_cheques_n_conciliado;

    if (coalesce(:total_cheques,0)=0) then
      cheque_valido = 'S';
    else
      cheque_valido = 'N';

        
    /*---------------------------Limite de Crédito($$)------------------------*/
    if (:limite > 0) then
    begin
      /*Contas à Receber*/
      select sum(pcd.soma) soma FROM VERIFICA_LIMITE_RECEBER(:CNPJ,'01.01.1900', '01.01.2050', cast('today' as date),:limite_tempo,:cliente) pcd
      into :total_receber;

      /* FATURAS - Não tenho nada a ver com este código, não sei como elas funcionam, só peguei do SOMA_RECEBER_CLIENTE*/
      select sum(valor-desconto+juros) from fin_faturas
      where cnpj = :cnpj and pessoa_fj = :cliente and coalesce(baixada,'N')='N'
      into :total_faturas;

      select coalesce(cfg.INCLUI_VENDA_LIMITE,'N') from sis_configuracoes cfg
      where cfg.cnpj = :cnpj
      into :inlcui_atual;

      if ((:inlcui_atual = 'N') or (:vista = 'S')) then
         valor_venda = 0;

      if (:limite >= (:valor_venda + coalesce(:total_receber,0)+coalesce(:total_cheques,0)+coalesce(:total_faturas,0)+coalesce(:total_cheques_n_conciliado,0)+ coalesce(:total_cheques_n_reap,0) )) then
        lmt_cred_valido = 'S';
      else
        lmt_cred_valido = 'N';
    end
    else
       lmt_cred_valido = 'S';


    /*-------------------------------ULTIMA VERIFICAÇÃO----------------------------------*/
    /*Verificando se o limite de crédito, o limite de tempo, e o cheque são válidos------*/
    if ((lmt_cred_valido = 'S') and (cheque_valido = 'S') and (lmt_tempo_valido = 'S')) then
    begin
      valido = 'S';
      motivo = 0;
    end
    else
    begin
      valido = 'N';
      /*se não passar em nenhum, então mostrar a dupla mensagem*/
      if ((lmt_tempo_valido = 'N') and (lmt_cred_valido = 'N')) then
        motivo = 3;
      else if (lmt_tempo_valido = 'N') then
        motivo = 1;
      else
        motivo = 2;
    end

  end
  else
  begin
    motivo = 0;
    valido = 'S';
  end


  suspend;
END
^

ALTER PROCEDURE PCD_VERIFICA_VENDA_VINCULADA (
    CNPJ VARCHAR(14),
    ID_AGRUPADOR INTEGER,
    CFOP INTEGER,
    PRODUTO VARCHAR(15),
    QTDE NUMERIC(18,4))
AS
DECLARE VARIABLE DEVOLUCAO CHAR(1);
DECLARE VARIABLE REMESSA CHAR(1);
DECLARE VARIABLE ENTREGA_FUTURA CHAR(1);
DECLARE VARIABLE AUX_QTDE NUMERIC(18,4);
DECLARE VARIABLE CONT INTEGER;
begin
  if (:id_agrupador is not null) then
  begin
      select nat.devolucao, nat.remessa, coalesce(nat.entrega_futura,'N') from est_natureza nat
      where nat.cnpj = :cnpj and nat.codigo = :cfop
      into :devolucao, :remessa, :entrega_futura;
    
      /*verificando se o produto a ser movimento se encontra também no faturamento
      vinculado*/
      select count(*) from fat_vendas_itens vdi
      inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
      where vdi.cnpj = :cnpj and vd.codigo = :id_agrupador
      and vdi.produto = :produto
      into :cont;

      if (cont = 0) then
        exception FAT_VINCULADO_ITENS;

      if ((:devolucao = 'S') and (:entrega_futura = 'N')) then
      begin
        /*verificando se foi entregue alguma qtde para assim poder a devolução*/
        select sum(vdi.qtde_entregue) from fat_vendas_itens vdi
        inner join fat_vendas vd on (vd.cnpj = vdi.cnpj and vd.codigo = vdi.codigo)
        where vdi.cnpj = :cnpj and vd.codigo = :id_agrupador  and vdi.produto = :produto
        into :aux_qtde;
      end
      else if ((:devolucao = 'S') and (:entrega_futura = 'S')) then /*criado para permitir a devolução de entrega futura*/
        aux_qtde = :qtde;


     /*se qtde entregue... menor q a qtde de devolução!?...
         ou
     se saldo de estoque... menor q a qtde de remessa!?... sem chance*/
     if (:aux_qtde < :qtde) then
       exception fat_vinculado_itens1;
  end
END
^

ALTER PROCEDURE PCD_ZERA_ESTOQUE_GRADE
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
begin
  /*zerando os numeros, que zerarão o estoque dos dependentes grades e produtos*/
  update est_produtos_grades_numeros set estoque = 0;

  /*zerando os numeros, que zerarão o estoque dos dependentes grades e produtos*/
  for select distinct prd.codigo from est_produtos prd
      inner join est_produtos_grades g on (prd.codigo = g.produto and g.cnpj = prd.cnpj)
      into :produto
  do
  begin
    update est_produtos set qtdade_2 = 0, qtdade_1 =0
    where codigo = :produto;
  end

  suspend;
END
^

ALTER PROCEDURE PCT_ACT_GERA_ACERTO (
    CNPJ VARCHAR(14),
    DT_CAIXA DATE,
    HISTORICO VARCHAR(100),
    USUARIO INTEGER,
    TIPO_ACERTO INTEGER,
    VALOR_PAGAR NUMERIC(18,4),
    VALOR_RECEBER NUMERIC(18,4))
RETURNS (
    COD_ACERTO INTEGER)
AS
begin
   cod_acerto = GEN_ID(GEN_ACT_ACERTOCONTA_ID,1);

   insert into act_acertoconta(CNPJ,
                               CODIGO,
                               DATA,
                               DATA_CX,
                               HISTORICO,
                               USUARIO,
                               TIPO_ACERTO,
                               VALOR_PAGAR,
                               VALOR_RECEBER)
                    values     (:cnpj,
                               :cod_acerto,
                               current_date,
                               :dt_caixa,
                               :historico,
                               :usuario,
                               :tipo_acerto,
                               :valor_pagar,
                               :valor_receber);
  suspend;
end
^

ALTER PROCEDURE PDV_PRODUTO (
    E VARCHAR(14),
    C VARCHAR(15))
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO VARCHAR(1),
    ALIQUOTA_ECF VARCHAR(5),
    PESAVEL VARCHAR(1),
    NEG_QTDADE_2 CHAR(1),
    VALIDADE INTEGER)
AS
BEGIN
     Select PRC_REPOS, PRC_VENDA, VOLUME, PESO_LIQ, UNIDADE, NOME, ATIVO,
     ALIQUOTA_ECF, PROD_PESAVEL, NEG_QTDADE_2, VALIDADE
     From Est_Produtos
     Where Codigo = :C and CNPJ = :E
     INTO :PRC_REPOS, :PRC_VENDA, :VOLUME, :PESO_LIQ,
          :UNIDADE, :NOME, :ATIVO, :ALIQUOTA_ECF, :PESAVEL,
          :NEG_QTDADE_2, :VALIDADE ;
          
     SUSPEND;
END
^

ALTER PROCEDURE POSSUI_GRADE (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE INTEGER)
AS
BEGIN
      SELECT COUNT(GRADE)
      FROM EST_PRODUTOS_GRADES
      WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
      INTO :QUANTIDADE ;

      IF ( QUANTIDADE IS NULL )
      THEN
          QUANTIDADE = 0;

      SUSPEND;
END
^

ALTER PROCEDURE PROCESSA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20),
    DATA DATE,
    DATA_CX DATE,
    BANCO INTEGER)
AS
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE SOMA_ADMINISTRACAO NUMERIC(18,4);
DECLARE VARIABLE TAXA NUMERIC(18,4);
DECLARE VARIABLE CONTA_CARTAO_CAIXA INTEGER;
DECLARE VARIABLE CODIGO_CONT INTEGER;
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE ADMINISTRACAO_CARTAO_CAIXA INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
BEGIN
     select conta_cartao_caixa from sis_empresas  where cnpj = :cnpj
     into :conta_cartao_caixa;

     soma               = 0;
     soma_administracao = 0;

     for select valor, taxa  from fin_movimento_cartao
         where cnpj = :cnpj and processado = 'S' and conciliado = 'N'
     into :valor, :taxa
     do
     begin
        if (valor is null) then
          valor = 0;

        if (taxa is null) then
          taxa = 0;

        if (taxa > 0) then
        begin
          soma =  :soma + :valor - ( ( :valor * :taxa )/100);

          soma_administracao = :soma_administracao + ( ( :valor * :taxa )/100);
        end
        else
          soma = soma + valor;
     end


     if (:soma > 0 ) then
     begin
       /* planilha */
       select codigo from gerar_codigo ('PLANILHA',1) into :planilha;

       documento = 'CARTAO ' || cast(data as varchar(10));

       codigo_cont = gen_id(mov_contabil_ge, 1);

       insert into ctb_movimento_contabil
       (cnpj, codigo, data, tipo, documento, historico, valor, conta, origem, planilha, tipo_lancamento, cod_doc, data_conciliacao )
       values
       (:cnpj, :codigo_cont, :data_cx, 'C', :documento, ('CONCILIAÇÃO: '||cast('today' as date)), :soma, :banco, 'CRT', :planilha, 'A', 'CRT', :data );


       update fin_movimento_cartao  mvt set conciliado = 'S', data_conciliacao = :data, mvt.planilha = :planilha
       where cnpj = :cnpj and processado = 'S' and conciliado = 'N';

       update fin_movimento_cartao set processado = 'N'
       where cnpj = :cnpj and conciliado = 'S';
     end

     suspend;
END
^

ALTER PROCEDURE PROCESSA_CONCILIACAO_CHEQUE (
    CNPJ VARCHAR(20),
    DATA DATE,
    CODIGO INTEGER,
    USUARIO INTEGER,
    TURNO INTEGER,
    TIPO CHAR(1))
AS
DECLARE VARIABLE TOTAL_AVISTA NUMERIC(18,4);
DECLARE VARIABLE TOTAL_APRAZO NUMERIC(18,4);
DECLARE VARIABLE CONTA_AVISTA INTEGER;
DECLARE VARIABLE CONTA_APRAZO INTEGER;
DECLARE VARIABLE DOC_AVISTA VARCHAR(20);
DECLARE VARIABLE DOC_APRAZO VARCHAR(20);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE NBANCO CHAR(3);
DECLARE VARIABLE CONTA INTEGER;
DECLARE VARIABLE FORNECEDOR INTEGER;
begin
     Total_Avista = 0;
     Total_Aprazo = 0;

     /* seleciona a conta do banco que vai receber os cheques */
     if (:tipo = 'B') then
     begin
       select p.banco
       from ctb_planoconta p
       where p.conta = :codigo and p.cnpj = :cnpj
       into :nbanco;
       conta = codigo;
       fornecedor = 0;
     end /*fornecedor*/
     else IF (:tipo = 'F') then
     begin
       conta = 0;
       nbanco = 0;
       fornecedor = :codigo;
     end

     /* total de cheques a vista ea prazo*/
     select AVISTA, APRAZO
     from pcd_fin_somar_conciliacao(:cnpj) c
     into :total_avista, :total_aprazo;

     /* PLANILHA */
     select CODIGO from GERAR_CODIGO ('PLANILHA',1)
     into :PLANILHA;

     DOC_AVISTA = 'CHQ AVST ' || cast (:DATA as varchar(10));
     DOC_APRAZO  = 'CHQ PRZ ' || cast (:DATA as varchar(10));

     if (:nbanco > 0 ) then
     begin
       if (Total_AVista > 0) then /* concilia a cheques a vista */
       begin
         /*não sei porque mas o parâmetro que contêm o numero da conta_
         se chama banco. !?!?!?!?!!!!??*/
        execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:CNPJ, :DATA, 'C',
           :doc_avista, :doc_avista, :total_avista, :codigo, 'CHQ', :PLANILHA,
           0, :nbanco, 'A', '', 0);
       end

       if (Total_Aprazo > 0) then /* concilia a cheques a prazo */
       begin
         execute procedure INSERE_CTB_MOVIMENTO_CONTABIL(:CNPJ, :DATA, 'C',
           :doc_aprazo, :doc_aprazo, :total_aprazo, :codigo, 'CHQ', :PLANILHA,
           0, :nbanco, 'A', '', 0);
       end
     end

     if (:fornecedor <> 0) then
     begin
       update FIN_CHEQUES c
       set c.processado = 'S', c.conciliado = 'S', c.usuario_conc = :usuario, c.turno_conc = :turno,
       c.conta_conc = :conta, c.data_conciliacao = :data, c.fornecedor = :fornecedor,c.tipo = 'CC'
       ,c.cod_mvt_ctb = :planilha
       where c.processado <> 'S' and c.cnpj = :CNPJ and c.marcado = 'S' and c.data_conciliacao is null;
     end
     else
     begin
       update FIN_CHEQUES c
       set c.processado = 'S', c.conciliado = 'S', c.usuario_conc = :usuario, c.turno_conc = :turno,
       c.conta_conc = :conta, c.data_conciliacao = :data, c.tipo = 'CC', c.cod_mvt_ctb = :planilha
       where c.processado <> 'S' and c.cnpj = :CNPJ and c.marcado = 'S' and c.data_conciliacao is null;
     end
END
^

ALTER PROCEDURE PROCESSA_DESDOBRAMENTO_CONTABIL (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
AS
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE ORIGEM VARCHAR(15);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE TIPO CHAR(1);
DECLARE VARIABLE HISTORICO VARCHAR(100);
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE CONTRA_PARTIDA INTEGER;
DECLARE VARIABLE CONTA INTEGER;
begin
     FOR SELECT DOCUMENTO, HISTORICO, DATA, PESSOA_FJ, ORIGEM
     FROM CTB_DESDOBRA_MOVIMENTO
     WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA
     INTO :DOCUMENTO, :HISTORICO, :DATA, :PESSOA_FJ, :ORIGEM
     DO BEGIN
        FOR SELECT VALOR, TIPO, CONTA
        FROM CTB_DESDOBRA_MOVIMENTO_CONTAS
        WHERE CNPJ = :CNPJ AND PLANILHA = :PLANILHA AND PROCESSA = 'S'
        INTO :VALOR, :TIPO, :CONTA
        DO BEGIN

           CODIGO = GEN_ID(MOV_CONTABIL_GE, 1);

           /* DADOS DA BAIXA */
           ANO = EXTRACT ( YEAR  FROM :DATA );
           MES = EXTRACT ( MONTH FROM :DATA );

           CONTRA_PARTIDA = NULL ;

           IF ( PESSOA_FJ = 0 )
           THEN BEGIN
                PESSOA_FJ = NULL ;
           END

           INSERT INTO CTB_MOVIMENTO_CONTABIL (
           CNPJ,
           CODIGO,
           DATA,
           TIPO,
           DOCUMENTO,
           HISTORICO,
           MES,
           ANO,
           VALOR,
           CONTA,
           ORIGEM,
           PLANILHA,
           CONTRA_PARTIDA,
           BANCO,
           TIPO_LANCAMENTO,
           COD_DOC,
           FORNECEDOR,
           DATA_CONCILIACAO)
           VALUES (
           :CNPJ,
           :CODIGO,
           :DATA,
           :TIPO,
           :DOCUMENTO,
           :HISTORICO,
           :MES,
           :ANO,
           :VALOR,
           :CONTA,
           :ORIGEM,
           :PLANILHA,
           :CONTRA_PARTIDA,
           '',
           'A',
           '',
           :PESSOA_FJ,
           NULL
           );
        END
     END
END
^

ALTER PROCEDURE PRODUTO_CODIGO (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO TIMESTAMP,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA TIMESTAMP,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100),
    COMPROMETIDO NUMERIC(18,4))
AS
BEGIN
     /* MENORES */
     FOR SELECT
      CNPJ , CODIGO , CODIGO_INTERNO, CODIGO_2 , CNPJ_AGRUP , COD_AGRUP , NOME , MARCA , GRUPO ,
      SUBGRUPO ,  REDUCAO , UNIDADE , CTE , CTIE , QTDADE_1 , QTDADE_2 , LOCALIZACAO_1 ,
      LOCALIZACAO_2 , LOCALIZACAO_3 , NEG_QTDADE_2 , QTDADE_MIN , QTDADE_MAX ,
      COMPLEMENTO_NF , DT_ULT_COMPRA , QT_ULT_COMPRA , DT_ULT_VENDA , MARGEM_BRUTA ,
      PRC_REPOS , PRC_CUSTO_ANT , PRC_CUSTO_MED , PRC_VENDA , PRC_VENDA_ANT ,
      PRC_VENDA_MED , ALIQUOTA_ECF , ORIGEM , PESO_LIQ , PERC_FRETE , IPI ,
      VOLUME , PROD_PESAVEL , ETIQUETA_ENT , ATIVO , ULTIMO_FORNECEDOR , FORNECEDOR ,
      SUBUNIDADE , NOME_MARCA , PRC_CUSTO_CODIF, DT_ULT_ATU_PRECO, CUSTO_AQUISICAO,
      DT_ULT_ATU_PRECO, CUSTO_AQUISICAO, VENDE_FRACIONADO, QNTDE_EXPOSTA, POSSUI_LOTE,
      QNTDE_PEDIDA, PREVISAO_ENTREGA,  QNTDE_MAXIMA_VENDA, PIS, COFINS,
      COM_VENDA_VLR, COM_VENDA_PCT, PARTICIP_LUCRO, NAO_COBR_JUR_ATE, ATUALIZA_ARQ_EXTERNO,
      SERVICO, VALIDADE, CUSTO_INDEXADO, COMPLEMENTO, COMPROMETIDO
     FROM PRODUTO_CODIGOMENOR ( :EMPRESA, :PRODUTO )
     ORDER BY CODIGO ASC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA , :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
      :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO, VENDE_FRACIONADO, :QNTDE_EXPOSTA, :POSSUI_LOTE,
      :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
      :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO, :NAO_COBR_JUR_ATE,
      :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO, :COMPROMETIDO
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
      CNPJ , CODIGO , CODIGO_INTERNO, CODIGO_2 , CNPJ_AGRUP , COD_AGRUP , NOME , MARCA , GRUPO ,
      SUBGRUPO ,  REDUCAO , UNIDADE , CTE , CTIE , QTDADE_1 , QTDADE_2 , LOCALIZACAO_1 ,
      LOCALIZACAO_2 , LOCALIZACAO_3 , NEG_QTDADE_2 , QTDADE_MIN , QTDADE_MAX ,
      COMPLEMENTO_NF , DT_ULT_COMPRA , QT_ULT_COMPRA , DT_ULT_VENDA , MARGEM_BRUTA ,
      PRC_REPOS , PRC_CUSTO_ANT , PRC_CUSTO_MED , PRC_VENDA , PRC_VENDA_ANT ,
      PRC_VENDA_MED , ALIQUOTA_ECF , ORIGEM , PESO_LIQ , PERC_FRETE , IPI ,
      VOLUME , PROD_PESAVEL , ETIQUETA_ENT , ATIVO , ULTIMO_FORNECEDOR , FORNECEDOR ,
      SUBUNIDADE , NOME_MARCA , PRC_CUSTO_CODIF, DT_ULT_ATU_PRECO, CUSTO_AQUISICAO,
      VENDE_FRACIONADO, QNTDE_EXPOSTA, POSSUI_LOTE,
      QNTDE_PEDIDA, PREVISAO_ENTREGA,  QNTDE_MAXIMA_VENDA, PIS, COFINS,
      COM_VENDA_VLR, COM_VENDA_PCT, PARTICIP_LUCRO, NAO_COBR_JUR_ATE,
      ATUALIZA_ARQ_EXTERNO, SERVICO, VALIDADE, CUSTO_INDEXADO, COMPLEMENTO
     FROM PRODUTO_CODIGOMAIOR ( :EMPRESA, :PRODUTO )
     ORDER BY CODIGO ASC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO,  :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA , :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
      :VENDE_FRACIONADO, :QNTDE_EXPOSTA, :POSSUI_LOTE,
      :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
      :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO, :NAO_COBR_JUR_ATE, :ATUALIZA_ARQ_EXTERNO,
      :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE PRODUTO_CODIGOMAIOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100),
    COMPROMETIDO NUMERIC(18,4))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :EMPRESA
     INTO LOAD ;
     
     CONT = 0;
     
     FOR SELECT
      CNPJ ,
      CODIGO ,
      CODIGO_INTERNO,
      CODIGO_2 ,
      CNPJ_AGRUP ,
      COD_AGRUP ,
      NOME ,
      MARCA ,
      GRUPO ,
      SUBGRUPO ,
      REDUCAO ,
      UNIDADE ,
      CTE ,
      CTIE ,
      QTDADE_1 ,
      QTDADE_2 ,
      LOCALIZACAO_1 ,
      LOCALIZACAO_2 ,
      LOCALIZACAO_3 ,
      NEG_QTDADE_2 ,
      QTDADE_MIN ,
      QTDADE_MAX ,
      COMPLEMENTO_NF ,
      DT_ULT_COMPRA ,
      QT_ULT_COMPRA ,
      DT_ULT_VENDA ,
      MARGEM_BRUTA ,
      PRC_REPOS ,
      PRC_CUSTO_ANT ,
      PRC_CUSTO_MED ,
      PRC_VENDA ,
      PRC_VENDA_ANT ,
      PRC_VENDA_MED ,
      ALIQUOTA_ECF ,
      ORIGEM ,
      PESO_LIQ ,
      PERC_FRETE ,
      IPI ,
      VOLUME ,
      PROD_PESAVEL ,
      ETIQUETA_ENT ,
      ATIVO ,
      ULTIMO_FORNECEDOR ,
      FORNECEDOR ,
      SUBUNIDADE ,
      NOME_MARCA ,
      PRC_CUSTO_CODIF,
      DT_ULT_ATU_PRECO,
      CUSTO_AQUISICAO,
      QNTDE_EXPOSTA,
      POSSUI_LOTE,
      VENDE_FRACIONADO,
      QNTDE_PEDIDA ,
      PREVISAO_ENTREGA ,
      QNTDE_MAXIMA_VENDA ,
      PIS ,
      COFINS ,
      COM_VENDA_VLR ,
      COM_VENDA_PCT ,
      PARTICIP_LUCRO ,
      NAO_COBR_JUR_ATE,
      ATUALIZA_ARQ_EXTERNO,
      SERVICO,
      VALIDADE,
      CUSTO_INDEXADO,
      COMPLEMENTO
     FROM EST_PRODUTOS E
     WHERE CNPJ = :EMPRESA AND CODIGO > :PRODUTO
     PLAN (E ORDER IDX_EST_PRODUTOS_ATIVO)
     ORDER BY CNPJ ASC, CODIGO ASC , ATIVO ASC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA , :PRC_CUSTO_CODIF,  :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO, 
      :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
      :QNTDE_PEDIDA , :PREVISAO_ENTREGA , :QNTDE_MAXIMA_VENDA , :PIS ,
      :COFINS , :COM_VENDA_VLR , :COM_VENDA_PCT , :PARTICIP_LUCRO ,
      :NAO_COBR_JUR_ATE, :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE,
      :CUSTO_INDEXADO, :COMPLEMENTO
     DO BEGIN
        select sum(oci.quantidade) from fat_orcamentos oc
        inner join fat_orcamentos_itens oci on (oci.cnpj = oc.cnpj and oc.codigo = oci.codigo)
        where oc.comprometer_estoque = 'S' and oc.cnpj = :cnpj and oci.produto = :codigo and oc.status <= 2
        into :comprometido;

        IF ( CONT < :LOAD)
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD)
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE PRODUTO_CODIGOMENOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    COMPLEMENTO VARCHAR(100))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
BEGIN
      SELECT NUM_REG_LOAD
      FROM SIS_EMPRESAS
      WHERE CNPJ = :EMPRESA
      INTO LOAD ;
     
      CONT = 0;
     
      FOR SELECT
      CNPJ ,
      CODIGO ,
      CODIGO_INTERNO,
      CODIGO_2 ,
      CNPJ_AGRUP ,
      COD_AGRUP ,
      NOME ,
      MARCA ,
      GRUPO ,
      SUBGRUPO ,
      REDUCAO ,
      UNIDADE ,
      CTE ,
      CTIE ,
      QTDADE_1 ,
      QTDADE_2 ,
      LOCALIZACAO_1 ,
      LOCALIZACAO_2 ,
      LOCALIZACAO_3 ,
      NEG_QTDADE_2 ,
      QTDADE_MIN ,
      QTDADE_MAX ,
      COMPLEMENTO_NF ,
      DT_ULT_COMPRA ,
      QT_ULT_COMPRA ,
      DT_ULT_VENDA ,
      MARGEM_BRUTA ,
      PRC_REPOS ,
      PRC_CUSTO_ANT ,
      PRC_CUSTO_MED ,
      PRC_VENDA ,
      PRC_VENDA_ANT ,
      PRC_VENDA_MED ,
      ALIQUOTA_ECF ,
      ORIGEM ,
      PESO_LIQ ,
      PERC_FRETE ,
      IPI ,
      VOLUME ,
      PROD_PESAVEL ,
      ETIQUETA_ENT ,
      ATIVO ,
      ULTIMO_FORNECEDOR ,
      FORNECEDOR ,
      SUBUNIDADE ,
      NOME_MARCA ,
      PRC_CUSTO_CODIF,
      DT_ULT_ATU_PRECO,
      CUSTO_AQUISICAO,
      QNTDE_EXPOSTA,
      POSSUI_LOTE,
      VENDE_FRACIONADO,
      QNTDE_PEDIDA ,
      PREVISAO_ENTREGA ,
      QNTDE_MAXIMA_VENDA ,
      PIS ,
      COFINS ,
      COM_VENDA_VLR ,
      COM_VENDA_PCT ,
      PARTICIP_LUCRO ,
      NAO_COBR_JUR_ATE ,
      ATUALIZA_ARQ_EXTERNO,
      SERVICO,
      VALIDADE,
      CUSTO_INDEXADO,
      COMPLEMENTO
     FROM EST_PRODUTOS E
     WHERE CNPJ = :EMPRESA AND CODIGO <= :PRODUTO
     ORDER BY CNPJ DESC, CODIGO DESC, ATIVO DESC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA , :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
      :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
      :QNTDE_PEDIDA, :PREVISAO_ENTREGA, :QNTDE_MAXIMA_VENDA, :PIS, :COFINS, :COM_VENDA_VLR,
      :COM_VENDA_PCT, :PARTICIP_LUCRO, :NAO_COBR_JUR_ATE, :ATUALIZA_ARQ_EXTERNO,
      :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO
     DO BEGIN
        select sum(coalesce(oci.quantidade,0)-coalesce(oci.qtde_faturada,0)) from fat_orcamentos oc
        inner join fat_orcamentos_itens oci on (oci.cnpj = oc.cnpj and oc.codigo = oci.codigo)
        where oc.comprometer_estoque = 'S' and oc.cnpj = :cnpj and oci.produto = :codigo and
        coalesce(oci.quantidade,0)-coalesce(oci.qtde_faturada,0) > 0 and oc.status <= 2
        into :comprometido;

        IF ( CONT < :LOAD)
        then
            SUSPEND;

        CONT = CONT + 1;
        
        IF ( CONT > :LOAD)
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE PRODUTO_NOME (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    CNPJ VARCHAR(14),
    COMPLEMENTO VARCHAR(100),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO TIMESTAMP,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA TIMESTAMP,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    SECAO INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
BEGIN
     /* MENORES */
     FOR SELECT
      CNPJ , CODIGO , CODIGO_INTERNO, CODIGO_2 , CNPJ_AGRUP , COD_AGRUP , NOME , MARCA, SECAO, MODELO, GRUPO ,
      SUBGRUPO ,  REDUCAO , UNIDADE , CTE , CTIE , QTDADE_1 , QTDADE_2 , LOCALIZACAO_1 ,
      LOCALIZACAO_2 , LOCALIZACAO_3 , NEG_QTDADE_2 , QTDADE_MIN , QTDADE_MAX ,
      COMPLEMENTO_NF , DT_ULT_COMPRA , QT_ULT_COMPRA , DT_ULT_VENDA , MARGEM_BRUTA ,
      PRC_REPOS , PRC_CUSTO_ANT , PRC_CUSTO_MED , PRC_VENDA , PRC_VENDA_ANT ,
      PRC_VENDA_MED , ALIQUOTA_ECF , ORIGEM , PESO_LIQ , PERC_FRETE , IPI ,
      VOLUME , PROD_PESAVEL , ETIQUETA_ENT , ATIVO , ULTIMO_FORNECEDOR , FORNECEDOR ,
      SUBUNIDADE , NOME_MARCA , NOME_MODELO, PRC_CUSTO_CODIF, DT_ULT_ATU_PRECO, CUSTO_AQUISICAO,
      VENDE_FRACIONADO, QNTDE_EXPOSTA, POSSUI_LOTE,
      QNTDE_PEDIDA, PREVISAO_ENTREGA,  QNTDE_MAXIMA_VENDA, PIS, COFINS,
      COM_VENDA_VLR, COM_VENDA_PCT, PARTICIP_LUCRO,  NAO_COBR_JUR_ATE,
      ATUALIZA_ARQ_EXTERNO, SERVICO, VALIDADE, CUSTO_INDEXADO, COMPLEMENTO, COMPROMETIDO,
      est_min, est_max, SERIE, DEBITA_ICMS
     FROM PRODUTO_NOMEMENOR( :EMPRESA, :PRODUTO )
     ORDER BY NOME ASC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA, :SECAO, :MODELO, :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA, :NOME_MODELO, :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO, :VENDE_FRACIONADO,
      :QNTDE_EXPOSTA, :POSSUI_LOTE,
      :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
      :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
      :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO, :COMPROMETIDO,
      :EST_MIN,:EST_MAX, :SERIE, :DEBITA_ICMS
     DO BEGIN
        SUSPEND ;
     END
     
     /* MAIORES */
     FOR SELECT
      CNPJ , CODIGO , CODIGO_INTERNO, CODIGO_2 , CNPJ_AGRUP , COD_AGRUP , NOME , MARCA,SECAO, MODELO, GRUPO ,
      SUBGRUPO ,  REDUCAO , UNIDADE , CTE , CTIE , QTDADE_1 , QTDADE_2 , LOCALIZACAO_1 ,
      LOCALIZACAO_2 , LOCALIZACAO_3 , NEG_QTDADE_2 , QTDADE_MIN , QTDADE_MAX ,
      COMPLEMENTO_NF , DT_ULT_COMPRA , QT_ULT_COMPRA , DT_ULT_VENDA , MARGEM_BRUTA ,
      PRC_REPOS , PRC_CUSTO_ANT , PRC_CUSTO_MED , PRC_VENDA , PRC_VENDA_ANT ,
      PRC_VENDA_MED , ALIQUOTA_ECF , ORIGEM , PESO_LIQ , PERC_FRETE , IPI ,
      VOLUME , PROD_PESAVEL , ETIQUETA_ENT , ATIVO , ULTIMO_FORNECEDOR , FORNECEDOR ,
      SUBUNIDADE , NOME_MARCA, NOME_MODELO, PRC_CUSTO_CODIF,  DT_ULT_ATU_PRECO, CUSTO_AQUISICAO, VENDE_FRACIONADO,
      QNTDE_EXPOSTA, POSSUI_LOTE,
      QNTDE_PEDIDA, PREVISAO_ENTREGA,  QNTDE_MAXIMA_VENDA, PIS, COFINS,
      COM_VENDA_VLR, COM_VENDA_PCT, PARTICIP_LUCRO,  NAO_COBR_JUR_ATE,
      ATUALIZA_ARQ_EXTERNO, SERVICO, VALIDADE, CUSTO_INDEXADO, COMPLEMENTO, COMPROMETIDO,
      EST_MIN, EST_MAX, SERIE, DEBITA_ICMS
     FROM PRODUTO_NOMEMAIOR ( :EMPRESA, :PRODUTO )
     ORDER BY NOME ASC
     INTO 
      :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
      :MARCA, :SECAO, :MODELO , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
      :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
      :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
      :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
      :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
      :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
      :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
      :NOME_MARCA, :NOME_MODELO,  :PRC_CUSTO_CODIF,  :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
      :VENDE_FRACIONADO, :QNTDE_EXPOSTA, :POSSUI_LOTE,
      :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
      :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
      :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO, :COMPROMETIDO,
      :EST_MIN,:EST_MAX, :SERIE, :DEBITA_ICMS
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE PRODUTO_NOMEMAIOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    SECAO INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE COMPROMETIDO1 NUMERIC(18,4);
DECLARE VARIABLE COMPROMETIDO2 NUMERIC(18,4);
BEGIN
     SELECT NUM_REG_LOAD     FROM SIS_EMPRESAS
     WHERE CNPJ = :EMPRESA
     INTO LOAD ;
     
     CONT = 0;
     
     if (:produto <> ' ') then
     begin
         FOR SELECT
          CNPJ ,
          CODIGO ,
          CODIGO_INTERNO,
          CODIGO_2 ,
          CNPJ_AGRUP ,
          COD_AGRUP ,
          NOME ,
          MARCA ,
          SECAO,
          MODELO,
          GRUPO ,
          SUBGRUPO ,
          REDUCAO ,
          UNIDADE ,
          CTE ,
          CTIE ,
          QTDADE_1 ,
          QTDADE_2 ,
          LOCALIZACAO_1 ,
          LOCALIZACAO_2 ,
          LOCALIZACAO_3 ,
          NEG_QTDADE_2 ,
          QTDADE_MIN ,
          QTDADE_MAX ,
          COMPLEMENTO_NF ,
          DT_ULT_COMPRA ,
          QT_ULT_COMPRA ,
          DT_ULT_VENDA ,
          MARGEM_BRUTA ,
          PRC_REPOS ,
          PRC_CUSTO_ANT ,
          PRC_CUSTO_MED ,
          PRC_VENDA ,
          PRC_VENDA_ANT ,
          PRC_VENDA_MED ,
          ALIQUOTA_ECF ,
          ORIGEM ,
          PESO_LIQ ,
          PERC_FRETE ,
          IPI ,
          VOLUME ,
          PROD_PESAVEL ,
          ETIQUETA_ENT ,
          ATIVO ,
          ULTIMO_FORNECEDOR ,
          FORNECEDOR ,
          SUBUNIDADE ,
          NOME_MARCA ,
          NOME_MODELO,
          PRC_CUSTO_CODIF,
          DT_ULT_ATU_PRECO,
          CUSTO_AQUISICAO,
          QNTDE_EXPOSTA,
          POSSUI_LOTE,
          VENDE_FRACIONADO,
          QNTDE_PEDIDA,
          PREVISAO_ENTREGA,
          QNTDE_MAXIMA_VENDA,
          PIS,
          COFINS,
          COM_VENDA_VLR,
          COM_VENDA_PCT,
          PARTICIP_LUCRO,
          NAO_COBR_JUR_ATE,
          ATUALIZA_ARQ_EXTERNO,
          SERVICO,
          VALIDADE,
          CUSTO_INDEXADO,
          COMPLEMENTO,
          E.est_min,
          E.est_max,
          SERIE, E.debita_icms
          FROM EST_PRODUTOS E
          WHERE CNPJ = :EMPRESA AND CODIGO = :PRODUTO
          ORDER BY CNPJ ASC, NOME ASC , ATIVO ASC
          INTO
          :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
          :MARCA, SECAO, :MODELO , :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
          :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
          :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
          :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
          :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
          :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
          :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
          :NOME_MARCA, :NOME_MODELO , :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
          :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
          :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
          :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
          :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :complemento,
          :est_min, :est_max, :SERIE, :debita_icms
         DO BEGIN
            /*calculando estoque comprometido em orçamentos*/
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0)) from fat_orcamentos vd
            inner join fat_orcamentos_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and vd.comprometer_estoque = 'S' and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0) > 0  and vd.status <> 4
            into :comprometido1;

            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :codigo and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S' and vd.cancelada = 'N'
            into :comprometido2;

            comprometido = coalesce(:comprometido1,0) + coalesce(:comprometido2,0);
    
            IF ( CONT < :LOAD) then
                SUSPEND;
    
            CONT = CONT + 1;
            
            IF (CONT > :LOAD) then
                EXIT ;
         END
     end
     else
     begin
       FOR SELECT
          CNPJ ,
          CODIGO ,
          CODIGO_INTERNO,
          CODIGO_2 ,
          CNPJ_AGRUP ,
          COD_AGRUP ,
          NOME ,
          MARCA ,
          SECAO,
          MODELO,
          GRUPO ,
          SUBGRUPO ,
          REDUCAO ,
          UNIDADE ,
          CTE ,
          CTIE ,
          QTDADE_1 ,
          QTDADE_2 ,
          LOCALIZACAO_1 ,
          LOCALIZACAO_2 ,
          LOCALIZACAO_3 ,
          NEG_QTDADE_2 ,
          QTDADE_MIN ,
          QTDADE_MAX ,
          COMPLEMENTO_NF ,
          DT_ULT_COMPRA ,
          QT_ULT_COMPRA ,
          DT_ULT_VENDA ,
          MARGEM_BRUTA ,
          PRC_REPOS ,
          PRC_CUSTO_ANT ,
          PRC_CUSTO_MED ,
          PRC_VENDA ,
          PRC_VENDA_ANT ,
          PRC_VENDA_MED ,
          ALIQUOTA_ECF ,
          ORIGEM ,
          PESO_LIQ ,
          PERC_FRETE ,
          IPI ,
          VOLUME ,
          PROD_PESAVEL ,
          ETIQUETA_ENT ,
          ATIVO ,
          ULTIMO_FORNECEDOR ,
          FORNECEDOR ,
          SUBUNIDADE ,
          NOME_MARCA ,
          NOME_MODELO,
          PRC_CUSTO_CODIF,
          DT_ULT_ATU_PRECO,
          CUSTO_AQUISICAO,
          QNTDE_EXPOSTA,
          POSSUI_LOTE,
          VENDE_FRACIONADO,
          QNTDE_PEDIDA,
          PREVISAO_ENTREGA,
          QNTDE_MAXIMA_VENDA,
          PIS,
          COFINS,
          COM_VENDA_VLR,
          COM_VENDA_PCT,
          PARTICIP_LUCRO,
          NAO_COBR_JUR_ATE,
          ATUALIZA_ARQ_EXTERNO,
          SERVICO,
          VALIDADE,
          CUSTO_INDEXADO,
          COMPLEMENTO,
          E.est_min,
          E.est_max,
          SERIE, E.debita_icms
          FROM EST_PRODUTOS E
          WHERE CNPJ = :EMPRESA AND CODIGO >= :PRODUTO
          ORDER BY CNPJ ASC, NOME ASC , ATIVO ASC
          INTO
          :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
          :MARCA, :SECAO, :MODELO, :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
          :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
          :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
          :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
          :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
          :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
          :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
          :NOME_MARCA, :NOME_MODELO, :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
          :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
          :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
          :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
          :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :complemento,
          :est_min, :est_max, :SERIE, :debita_icms
         DO BEGIN
            /*calculando estoque comprometido em orçamentos*/
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0)) from fat_orcamentos vd
            inner join fat_orcamentos_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and vd.comprometer_estoque = 'S' and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0) > 0 and vd.status <> 4
            into :comprometido1;

            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :codigo and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S' and vd.cancelada = 'N'
            into :comprometido2;

            comprometido = coalesce(:comprometido1,0) + coalesce(:comprometido2,0);
    
            IF ( CONT < :LOAD) then
                SUSPEND;
    
            CONT = CONT + 1;
            
            IF (CONT > :LOAD) then
                EXIT ;
         END
     end
END
^

ALTER PROCEDURE PRODUTO_NOMEMENOR (
    EMPRESA VARCHAR(14),
    PRODUTO VARCHAR(50))
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CNPJ VARCHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP VARCHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    SECAO INTEGER,
    MODELO INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    REDUCAO INTEGER,
    UNIDADE VARCHAR(4),
    CTE INTEGER,
    CTIE INTEGER,
    QTDADE_1 FLOAT,
    QTDADE_2 FLOAT,
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 VARCHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF VARCHAR(1),
    DT_ULT_COMPRA DATE,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA DATE,
    MARGEM_BRUTA FLOAT,
    PRC_REPOS FLOAT,
    PRC_CUSTO_ANT FLOAT,
    PRC_CUSTO_MED FLOAT,
    PRC_VENDA FLOAT,
    PRC_VENDA_ANT FLOAT,
    PRC_VENDA_MED FLOAT,
    ALIQUOTA_ECF VARCHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ FLOAT,
    PERC_FRETE FLOAT,
    IPI FLOAT,
    VOLUME FLOAT,
    PROD_PESAVEL VARCHAR(1),
    ETIQUETA_ENT VARCHAR(1),
    ATIVO VARCHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_MODELO VARCHAR(80),
    PRC_CUSTO_CODIF VARCHAR(15),
    DT_ULT_ATU_PRECO DATE,
    VENDE_FRACIONADO CHAR(1),
    QNTDE_EXPOSTA FLOAT,
    POSSUI_LOTE CHAR(1),
    CUSTO_AQUISICAO FLOAT,
    QNTDE_PEDIDA FLOAT,
    PREVISAO_ENTREGA DATE,
    QNTDE_MAXIMA_VENDA FLOAT,
    PIS CHAR(1),
    COFINS CHAR(1),
    COM_VENDA_VLR FLOAT,
    COM_VENDA_PCT FLOAT,
    PARTICIP_LUCRO FLOAT,
    NAO_COBR_JUR_ATE INTEGER,
    ATUALIZA_ARQ_EXTERNO CHAR(1),
    SERVICO CHAR(1),
    VALIDADE INTEGER,
    CUSTO_INDEXADO NUMERIC(18,4),
    COMPROMETIDO NUMERIC(18,4),
    EST_MIN NUMERIC(18,4),
    EST_MAX NUMERIC(18,4),
    SERIE VARCHAR(30),
    DEBITA_ICMS CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE LOAD INTEGER;
DECLARE VARIABLE COMPROMETIDO1 NUMERIC(18,4);
DECLARE VARIABLE COMPROMETIDO2 NUMERIC(18,4);
BEGIN
     SELECT NUM_REG_LOAD
     FROM SIS_EMPRESAS
     WHERE CNPJ = :EMPRESA
     INTO LOAD ;
     
     CONT = 0;
     
     if (:produto <> ' ') then
     begin
         FOR SELECT
          CNPJ ,
          CODIGO ,
          CODIGO_INTERNO,
          CODIGO_2 ,
          CNPJ_AGRUP ,
          COD_AGRUP ,
          NOME ,
          MARCA ,
          SECAO,
          MODELO,
          GRUPO ,
          SUBGRUPO ,
          REDUCAO ,
          UNIDADE ,
          CTE ,
          CTIE ,
          QTDADE_1 ,
          QTDADE_2 ,
          LOCALIZACAO_1 ,
          LOCALIZACAO_2 ,
          LOCALIZACAO_3 ,
          NEG_QTDADE_2 ,
          QTDADE_MIN ,
          QTDADE_MAX ,
          COMPLEMENTO_NF ,
          DT_ULT_COMPRA ,
          QT_ULT_COMPRA ,
          DT_ULT_VENDA ,
          MARGEM_BRUTA ,
          PRC_REPOS ,
          PRC_CUSTO_ANT ,
          PRC_CUSTO_MED ,
          PRC_VENDA ,
          PRC_VENDA_ANT ,
          PRC_VENDA_MED ,
          ALIQUOTA_ECF ,
          ORIGEM ,
          PESO_LIQ ,
          PERC_FRETE ,
          IPI ,
          VOLUME ,
          PROD_PESAVEL ,
          ETIQUETA_ENT ,
          ATIVO ,
          ULTIMO_FORNECEDOR ,
          FORNECEDOR ,
          SUBUNIDADE ,
          NOME_MARCA ,
          NOME_MODELO,
          PRC_CUSTO_CODIF,
          DT_ULT_ATU_PRECO,
          CUSTO_AQUISICAO,
          QNTDE_EXPOSTA,
          POSSUI_LOTE,
          VENDE_FRACIONADO,
          QNTDE_PEDIDA,
          PREVISAO_ENTREGA,
          QNTDE_MAXIMA_VENDA,
          PIS,
          COFINS,
          COM_VENDA_VLR,
          COM_VENDA_PCT,
          PARTICIP_LUCRO,
          NAO_COBR_JUR_ATE,
          ATUALIZA_ARQ_EXTERNO,
          SERVICO,
          VALIDADE,
          CUSTO_INDEXADO,
          COMPLEMENTO,
          E.est_min,
          E.est_max,
          SERIE,
          E.debita_icms
         FROM EST_PRODUTOS E
         WHERE CNPJ = :EMPRESA AND CODIGO = :PRODUTO
         PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVOD)
         ORDER BY CNPJ DESC, NOME DESC , ATIVO DESC
         INTO 
          :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
          :MARCA ,:SECAO, :MODELO, :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
          :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
          :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
          :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
          :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
          :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
          :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
          :NOME_MARCA, :NOME_MODELO, :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
          :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
          :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
          :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
          :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO,
          :est_min, :est_max, :SERIE, :debita_icms
         DO BEGIN
           /**/
           /*calculando estoque comprometido em orçamentos*/
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0)) from fat_orcamentos vd
            inner join fat_orcamentos_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and vd.comprometer_estoque = 'S' and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0) > 0 and vd.status <> 4
            into :comprometido1;

            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :codigo and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S' and vd.cancelada = 'N'
            into :comprometido2;

            comprometido = coalesce(:comprometido1,0) + coalesce(:comprometido2,0);

            IF ( CONT < :LOAD) then
                SUSPEND;
    
            CONT = CONT + 1;
            
            IF ( CONT > :LOAD)
            then
                EXIT ;
         END
     end
     else
     begin
          FOR SELECT
          CNPJ ,
          CODIGO ,
          CODIGO_INTERNO,
          CODIGO_2 ,
          CNPJ_AGRUP ,
          COD_AGRUP ,
          NOME ,
          MARCA ,
          SECAO,
          MODELO,
          GRUPO ,
          SUBGRUPO ,
          REDUCAO ,
          UNIDADE ,
          CTE ,
          CTIE ,
          QTDADE_1 ,
          QTDADE_2 ,
          LOCALIZACAO_1 ,
          LOCALIZACAO_2 ,
          LOCALIZACAO_3 ,
          NEG_QTDADE_2 ,
          QTDADE_MIN ,
          QTDADE_MAX ,
          COMPLEMENTO_NF ,
          DT_ULT_COMPRA ,
          QT_ULT_COMPRA ,
          DT_ULT_VENDA ,
          MARGEM_BRUTA ,
          PRC_REPOS ,
          PRC_CUSTO_ANT ,
          PRC_CUSTO_MED ,
          PRC_VENDA ,
          PRC_VENDA_ANT ,
          PRC_VENDA_MED ,
          ALIQUOTA_ECF ,
          ORIGEM ,
          PESO_LIQ ,
          PERC_FRETE ,
          IPI ,
          VOLUME ,
          PROD_PESAVEL ,
          ETIQUETA_ENT ,
          ATIVO ,
          ULTIMO_FORNECEDOR ,
          FORNECEDOR ,
          SUBUNIDADE ,
          NOME_MARCA ,
          NOME_MODELO,
          PRC_CUSTO_CODIF,
          DT_ULT_ATU_PRECO,
          CUSTO_AQUISICAO,
          QNTDE_EXPOSTA,
          POSSUI_LOTE,
          VENDE_FRACIONADO,
          QNTDE_PEDIDA,
          PREVISAO_ENTREGA,
          QNTDE_MAXIMA_VENDA,
          PIS,
          COFINS,
          COM_VENDA_VLR,
          COM_VENDA_PCT,
          PARTICIP_LUCRO,
          NAO_COBR_JUR_ATE,
          ATUALIZA_ARQ_EXTERNO,
          SERVICO,
          VALIDADE,
          CUSTO_INDEXADO,
          COMPLEMENTO,
          E.est_min,
          E.est_max,
          SERIE, E.debita_icms
         FROM EST_PRODUTOS E
         WHERE CNPJ = :EMPRESA
         PLAN (E ORDER IDX_EST_PRODUTOS_NOMEATIVOD)
         ORDER BY CNPJ DESC, NOME DESC , ATIVO DESC
         INTO 
          :CNPJ ,  :CODIGO , :CODIGO_INTERNO, :CODIGO_2 , :CNPJ_AGRUP , :COD_AGRUP , :NOME ,
          :MARCA, SECAO, :MODELO, :GRUPO , :SUBGRUPO , :REDUCAO , :UNIDADE , :CTE , :CTIE ,
          :QTDADE_1 , :QTDADE_2 , :LOCALIZACAO_1 , :LOCALIZACAO_2 , :LOCALIZACAO_3 ,
          :NEG_QTDADE_2 , :QTDADE_MIN , :QTDADE_MAX , :COMPLEMENTO_NF , :DT_ULT_COMPRA ,
          :QT_ULT_COMPRA ,  :DT_ULT_VENDA , :MARGEM_BRUTA , :PRC_REPOS , :PRC_CUSTO_ANT ,
          :PRC_CUSTO_MED , :PRC_VENDA , :PRC_VENDA_ANT , :PRC_VENDA_MED , :ALIQUOTA_ECF ,
          :ORIGEM , :PESO_LIQ , :PERC_FRETE , :IPI , :VOLUME , :PROD_PESAVEL ,
          :ETIQUETA_ENT , :ATIVO , :ULTIMO_FORNECEDOR , :FORNECEDOR , :SUBUNIDADE ,
          :NOME_MARCA, :NOME_MODELO, :PRC_CUSTO_CODIF, :DT_ULT_ATU_PRECO, :CUSTO_AQUISICAO,
          :QNTDE_EXPOSTA, :POSSUI_LOTE, :VENDE_FRACIONADO,
          :QNTDE_PEDIDA, :PREVISAO_ENTREGA,  :QNTDE_MAXIMA_VENDA, :PIS, :COFINS,
          :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO,  :NAO_COBR_JUR_ATE,
          :ATUALIZA_ARQ_EXTERNO, :SERVICO, :VALIDADE, :CUSTO_INDEXADO, :COMPLEMENTO,
          :est_min, :est_max, :SERIE, :debita_icms
         DO BEGIN
           /*calculando estoque comprometido em orçamentos*/
            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0)) from fat_orcamentos vd
            inner join fat_orcamentos_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            where vd.cnpj = :cnpj and vdi.produto = :codigo and vd.comprometer_estoque = 'S' and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_faturada,0) > 0  and vd.status <> 4
            into :comprometido1;

            select sum(coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0)) from fat_vendas vd
            inner join fat_vendas_itens vdi on (vdi.cnpj = vd.cnpj and vd.codigo = vdi.codigo)
            inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
            where nat.entrega_futura = 'S' and vd.cnpj = :cnpj and vdi.produto = :codigo and
            coalesce(vdi.quantidade,0)-coalesce(vdi.qtde_entregue,0) > 0  and vd.fechada = 'S' and vd.cancelada = 'N'
            into :comprometido2;

            comprometido = coalesce(:comprometido1,0) + coalesce(:comprometido2,0);
    
            IF ( CONT < :LOAD) then
                SUSPEND;
    
            CONT = CONT + 1;
            
            IF ( CONT > :LOAD)
            then
                EXIT ;
         END         
     end
END
^

ALTER PROCEDURE PROXIMO_TURNO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    TURNO INTEGER)
AS
DECLARE VARIABLE ULT_TURNO INTEGER;
begin
     SELECT ULTIMO_TURNO FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :ULT_TURNO ;

     IF ( ULT_TURNO IS NULL )
     THEN BEGIN
          ULT_TURNO = 1;
     END

     SELECT MAX(TURNO) FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     INTO :TURNO ;

     IF ( TURNO IS NULL )
     THEN BEGIN
          TURNO = 1;
     END
     ELSE BEGIN
          IF ( TURNO >= :ULT_TURNO )
          THEN
              TURNO = 0 ;
     END
END
^

ALTER PROCEDURE QUANTIDADE_FISCAL (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
     Select QTDADE_1
     From Est_Produtos
     Where Codigo = :PRODUTO and CNPJ = :CNPJ
     INTO
         :QUANTIDADE ;
     SUSPEND;
END
^

ALTER PROCEDURE QUANTIDADE_PRODUTO (
    CNPJ CHAR(14),
    VENDA INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
begin
     SELECT QUANTIDADE
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA AND PRODUTO = :PRODUTO
     INTO :QUANTIDADE ;

     suspend;
END
^

ALTER PROCEDURE RECALCULA_FATURA (
    CNPJ CHAR(14),
    FATURA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
DECLARE VARIABLE VALOR NUMERIC(18,4);
begin
     SOMA     = 0  ;

     /* SOMA OS VALORES */
     SELECT SUM( VALOR - VLR_PARCIAL + JUROS_REC - DESCONTOS )
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FATURA
     INTO :VALOR ;

     IF ( VALOR IS NULL )
     THEN BEGIN
          VALOR = 0;
     END

     SOMA = SOMA + VALOR ;

     SELECT SUM( VALOR ) FROM FIN_FATURAS_ADICIONAL
     WHERE CNPJ = :CNPJ AND CODIGO = :FATURA
     INTO :VALOR ;

     IF ( VALOR IS NULL )
     THEN BEGIN
          VALOR = 0;
     END

     SOMA = SOMA + VALOR ;

     /* FATURAS AGRUPADAS */
     SELECT SUM( VALOR ) FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND AGRUPADORA = :FATURA
     INTO :VALOR ;

     IF ( VALOR IS NULL )
     THEN BEGIN
          VALOR = 0;
     END

     SOMA = SOMA - VALOR ;


     /* BAIXAS PARCIAIS */
     SELECT SUM( VALOR ) FROM FIN_FATURAS_PARCIAL
     WHERE CNPJ = :CNPJ AND CODIGO = :FATURA
     INTO :VALOR ;

     IF ( VALOR IS NULL )
     THEN BEGIN
          VALOR = 0;
     END

     SOMA = SOMA - VALOR ;


     UPDATE FIN_FATURAS SET VALOR = :SOMA
     WHERE CNPJ = :CNPJ AND CODIGO = :FATURA;

     suspend;
END
^

ALTER PROCEDURE REGORGANIZA_CLIENTES
AS
DECLARE VARIABLE CNPJ CHAR(14);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NUM INTEGER;
begin
     FOR  SELECT CNPJ, CODIGO
     FROM GLO_PESSOAS_FJ
     INTO :CNPJ, :PESSOA_FJ
     DO BEGIN
        SELECT COUNT(*) FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        INTO :NUM ;

        IF (( NUM IS NULL ) OR ( NUM = 0 ))
        THEN BEGIN
             INSERT INTO GLO_CLIENTES
             ( CNPJ, PESSOA_FJ, REQUISICAO, BLOQUEADO, FREQUENCIA, AJUSTE_AUT_FATURAS, CLASSIF, DIA_PREF_FAT, PERIODO_FATURAMENTO )
             VALUES
             ( :CNPJ, :PESSOA_FJ, 'N', 'N', 'Fre', 'N', 'B', 0, 'M' ) ;
        END
     END

     suspend;
END
^

ALTER PROCEDURE REGORGANIZA_FORNECEDORES
AS
DECLARE VARIABLE CNPJ CHAR(14);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NUM INTEGER;
begin
     FOR  SELECT CNPJ, CODIGO
     FROM GLO_PESSOAS_FJ
     WHERE CODIGO >= 464
     INTO :CNPJ, :PESSOA_FJ
     DO BEGIN
        SELECT COUNT(*) FROM GLO_FORNECEDORES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        INTO :NUM ;

        IF (( NUM IS NULL ) OR ( NUM = 0 ))
        THEN BEGIN
             INSERT INTO GLO_FORNECEDORES
             ( CNPJ, PESSOA_FJ )
             VALUES
             ( :CNPJ, :PESSOA_FJ ) ;
        END
     END

     suspend;
END
^

ALTER PROCEDURE REORGANIZA_DATA_VENDA (
    CNPJ CHAR(14))
AS
begin
     UPDATE FAT_VENDAS
     SET DATA_CAIXA = DATA
     WHERE CNPJ = :CNPJ AND
     ENVIADA_CX = 'S' AND FECHADA = 'S'
     AND DATA <> DATA_CAIXA
     ;
END
^

ALTER PROCEDURE REORGANIZA_PARC_ENT
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CNPJ CHAR(14);
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE PESSOA_FJ INTEGER ;
DECLARE VARIABLE DT_VENCTO DATE;
begin
     CONT  = 1;

     FOR SELECT
     CNPJ, NDOCTO, PESSOA_FJ, DT_VENCTO
     FROM EST_ENTRADAS_FATURAMENTO
     INTO
     :CNPJ, :NDOCTO, :PESSOA_FJ, :DT_VENCTO
     DO BEGIN
        UPDATE EST_ENTRADAS_FATURAMENTO
        SET SEQUENCIAL = :CONT
        WHERE
             CNPJ = :CNPJ AND
             NDOCTO = :NDOCTO AND
             PESSOA_FJ = :PESSOA_FJ AND
             DT_VENCTO = :DT_VENCTO ;

        CONT = :CONT  + 1;
     END
END
^

ALTER PROCEDURE REORGANIZA_PRODUTOS_GRADES (
    CNPJ CHAR(14))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE GRADE CHAR(4);
DECLARE VARIABLE ESTOQUE NUMERIC(18,4);
begin
  for select sum(estoque), produto, grade from est_produtos_grades_numeros
      group by produto, grade
      into :estoque, :produto, :grade
  do
  begin
    update est_produtos_grades set estoque = :estoque
    where (cnpj = :cnpj) and (produto = :produto) and (grade = :grade);
  end

  for select sum(estoque), produto from est_produtos_grades
      group by produto
      into :estoque, :produto
  do
  begin
    update est_produtos set qtdade_2 = :estoque where (cnpj = :cnpj) and (codigo = :produto);
  end
END
^

ALTER PROCEDURE REORGANIZA_RECEBER
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO    INTEGER;
DECLARE VARIABLE NUM    INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
DECLARE VARIABLE PARCELA VARCHAR(6);
begin
     FOR SELECT
     CODIGO,
     ANO,
     DOCTO,
     PARCELA
     FROM FIN_CONTAS_RECEBER
     INTO
     :CODIGO,
     :ANO,
     :DOCUMENTO,
     :PARCELA
     DO BEGIN
        SELECT COUNT(DOCTO)
        FROM FIN_BAIXAS_RECEBER
        WHERE DOCTO = :DOCUMENTO AND PARCELA = :PARCELA
        INTO :NUM ;

        IF ( NUM IS NULL )
        THEN BEGIN
             NUM = 0;
        END

        IF ( NUM > 0 )
        THEN BEGIN
             DELETE FROM FIN_CONTAS_RECEBER
             WHERE CODIGO = :CODIGO AND ANO = :ANO;
        END
     END
END
^

ALTER PROCEDURE REORGANIZA_VENDAS_PRAZO_VISTA
AS
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE GERAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE VISTA NUMERIC(18,4);
DECLARE VARIABLE PRAZO NUMERIC(18,4);
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE CNPJ CHAR(14);
DECLARE VARIABLE PLANILHA INTEGER;
DECLARE VARIABLE CONTA INTEGER;
DECLARE VARIABLE DOCUMENTO VARCHAR(20);
begin

     FOR SELECT CNPJ, DATA_CAIXA, SUM(TOTAL), SUM(DESC_ACRES), SUM(DINHEIRO + CHEQUE + CARTAO + TICKET + TROCO )
     FROM FAT_VENDAS
     WHERE FECHADA = 'S' AND CANCELADA <> 'S' /*AND DATA_CAIXA = '08/14/2003'*/
     GROUP BY CNPJ, DATA_CAIXA
     INTO :CNPJ, :DATA, :TOTAL, :DESC_ACRES, :VISTA
     DO BEGIN
        IF ( TOTAL IS NULL )
        THEN       
            TOTAL = 0;

        IF ( DESC_ACRES IS NULL )
        THEN       
            DESC_ACRES = 0;

        IF ( VISTA IS NULL )
        THEN       
            VISTA = 0;

        GERAL = :TOTAL + :DESC_ACRES ;

        PRAZO = :GERAL - :VISTA ;

        UPDATE FAT_CAIXAS
        SET VENDAS_VISTA = :VISTA, VENDAS_PRAZO = :PRAZO
        WHERE CNPJ = :CNPJ AND DATA = :DATA ;

        SELECT PLANILHA, CONTA FROM FAT_CAIXAS
        WHERE CNPJ = :CNPJ AND DATA = CAST( :DATA AS DATE )
        INTO :PLANILHA, :CONTA ;




     END
END
^

ALTER PROCEDURE RESPONDER_MENSAGEN (
    REMETENTE VARCHAR(10),
    DESTINATARIO VARCHAR(10),
    RESERVADO CHAR(1),
    ASSUNTO VARCHAR(50),
    MENSAGEM VARCHAR(120),
    DT_ENVIO TIMESTAMP)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE ANO INTEGER;
BEGIN
  ANO = 0;

  CODIGO = 0;

  INSERT INTO SIS_MENSAGENS (
    CODIGO,
    ANO,
    REMETENTE,
    DESTINATARIO,
    RESERVADO,
    ASSUNTO,
    MENSAGEM,
    DT_ENVIO
)
  VALUES (
    :CODIGO,
    :ANO,
    :REMETENTE,
    :DESTINATARIO,
    :RESERVADO,
    :ASSUNTO,
    :MENSAGEM,
    :DT_ENVIO
);
END
^

ALTER PROCEDURE ROUND2 (
    ENTRA DECIMAL(15,4))
RETURNS (
    SAI DECIMAL(15,2))
AS
DECLARE VARIABLE TEMP INTEGER;
begin
  TEMP = (CAST((ENTRA*100) AS INTEGER));
  SAI = TEMP/100.00;
  suspend;
END
^

ALTER PROCEDURE SALDO_ANTERIOR_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
DECLARE VARIABLE ULT_DATA DATE;
BEGIN
     if (turno>1) then
        turno = turno - 1;
     else
     begin
        select max(data) from fat_caixas cx
        where cnpj = :cnpj and usuario = :usuario
        and conta = :conta and fechado = 'S' and data <:data
        into :data;
     end

     SELECT cx.saldo
     FROM FAT_CAIXAS cx
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     FECHADO = 'S' AND
     DATA = :DATA AND
     TURNO = :TURNO
     INTO :SALDO ;

     SUSPEND;
END
^

ALTER PROCEDURE SALDO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
     /* DATA DA CAIXA */
     DATA = DATA - 1;

     SELECT SALDO
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     FECHADO = 'S' AND
     DATA = :DATA AND
     TURNO = :TURNO
     INTO :SALDO ;

     SUSPEND;
END
^

ALTER PROCEDURE SALDO_CAIXA_GERAL (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
     /* DATA DA CAIXA */
     DATA = DATA - 1;

     SELECT TROCO
     FROM FAT_CAIXA_GERAL
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     INTO :SALDO ;

     SUSPEND;
END
^

ALTER PROCEDURE SALDO_CAIXAS_FRENTISTAS (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(SALDO)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND DATA = :DATA AND TURNO <> 99
     INTO :SALDO ;

     SUSPEND;
END
^

ALTER PROCEDURE SALDO_CONTA_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CONTA INTEGER,
    NOME VARCHAR(50),
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     FOR SELECT CONTA, NOME
     FROM CTB_PLANOCONTA
     WHERE (( CNPJ = :CNPJ ) AND ( BANCO IS NOT NULL ))
     INTO :CONTA, :NOME
     DO BEGIN
        /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
        SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
        WHERE  CNPJ = :CNPJ AND DATA_CONCILIACAO <= :DATA
        AND CONTA = :CONTA AND TIPO = 'C'
        AND DATA_CONCILIACAO IS NOT NULL
        INTO SOMAC;

        IF ( SOMAC IS NULL )
        THEN
            SOMAC = 0;

        /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
        SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
        WHERE CNPJ = :CNPJ AND DATA_CONCILIACAO <= :DATA
        AND CONTA = :CONTA AND TIPO = 'D'
        AND DATA_CONCILIACAO IS NOT NULL
        INTO SOMAD;

        IF ( SOMAD IS NULL )
        THEN
            SOMAD = 0;

        suspend;
     END
END
^

ALTER PROCEDURE SALDO_CONTA_PERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDO_CONTA_PERIODO_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CODIGO_CONTABIL like :CONTA||'%'  AND TIPO = 'C'
     INTO SOMAC;

     IF ( SOMAC IS NULL )
     THEN
         SOMAC = 0;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'D'
     INTO SOMAD;

     IF ( SOMAD IS NULL )
     THEN
         SOMAD = 0;

     suspend;
END
^

ALTER PROCEDURE SALDO_CONTAIND_PERIODO_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDO_CONTAINDEXADO_PERIODO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDO_CONTAS_PERIODO (
    CNPJ CHAR(14),
    DATA_INI DATE,
    DATA_FIN DATE)
RETURNS (
    SALDO_INICIAL NUMERIC(18,4),
    SALDO_LANCADAS NUMERIC(18,4),
    SALDO_BAIXAS NUMERIC(18,4),
    SALDO_FINAL NUMERIC(18,4),
    ORIGEM CHAR(3))
AS
begin
     /* CADA CONTA LISTADA DEVERA TER SALDO INICIAL, ENTRADAS, SAIDAS E EXCLUIDAS */

     /* CONTAS A PAGAR */

     ORIGEM = 'PGR';

     /* CONTAS A PAGAR SALDO INICIAL */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_PAG )
     FROM FIN_CONTAS_PAGAR
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO < :DATA_INI  ) )
     INTO :SALDO_INICIAL ;

     /* CONTAS A PAGAR SALDO LANCADAS */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_PAG )
     FROM FIN_CONTAS_PAGAR
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO >= :DATA_INI AND DT_LANCTO <= :DATA_FIN ) )
     INTO :SALDO_LANCADAS ;

     /* CONTAS A PAGAR SALDO BAIXAS */
     SELECT SUM ( VLR_BAIXA )
     FROM FIN_BAIXAS_PAGAR
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_BAIXA >= :DATA_INI AND DT_BAIXA <= :DATA_FIN ) )
     INTO :SALDO_BAIXAS ;

     /* CONTAS A PAGAR SALDO FINAL */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_PAG )
     FROM FIN_CONTAS_PAGAR
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO >= :DATA_FIN ) )
     INTO :SALDO_FINAL ;

     IF ( SALDO_INICIAL IS NULL ) THEN
        SALDO_INICIAL = 0;

     IF ( SALDO_LANCADAS IS NULL ) THEN
        SALDO_LANCADAS = 0;

     IF ( SALDO_BAIXAS IS NULL ) THEN
        SALDO_BAIXAS = 0;

     IF ( SALDO_FINAL IS NULL ) THEN
        SALDO_FINAL = 0;

     suspend;

     /* CONTAS A RECEBER */

     ORIGEM = 'REC';

     /* CONTAS A RECEBER SALDO INICIAL */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_REC )
     FROM FIN_CONTAS_RECEBER
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO < :DATA_INI  ) )
     INTO :SALDO_INICIAL ;

     /* CONTAS A RECEBER SALDO LANCADAS */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_REC )
     FROM FIN_CONTAS_RECEBER
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO >= :DATA_INI AND DT_LANCTO <= :DATA_FIN ) )
     INTO :SALDO_LANCADAS ;

     /* CONTAS A RECEBER SALDO BAIXAS */
     SELECT SUM ( VLR_BAIXA )
     FROM FIN_BAIXAS_RECEBER
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_BAIXA >= :DATA_INI AND DT_BAIXA <= :DATA_FIN ) )
     INTO :SALDO_BAIXAS;

     /* CONTAS A PAGAR SALDO FINAL */
     SELECT SUM( VALOR - VLR_PARCIAL - DESCONTOS + JUROS_REC )
     FROM FIN_CONTAS_RECEBER
     WHERE ( ( CNPJ = :CNPJ ) AND ( DT_LANCTO >= :DATA_FIN ) )
     INTO :SALDO_FINAL ;

     IF ( SALDO_INICIAL IS NULL ) THEN
        SALDO_INICIAL = 0;

     IF ( SALDO_LANCADAS IS NULL ) THEN
        SALDO_LANCADAS = 0;

     IF ( SALDO_BAIXAS IS NULL ) THEN
        SALDO_BAIXAS = 0;

     IF ( SALDO_FINAL IS NULL ) THEN
        SALDO_FINAL = 0;

     suspend;

     /* AQUI SERÁ FEITO O QUE FOI VENDIDO A VISTA E O QUE FOI VENDIDO A PRAZO NO SISTEMA */
     ORIGEM = 'VNV'; /* VENDAS A VISTA */

     /* VENDAS A VISTA SALDO INICIAL */
     SELECT SUM( DINHEIRO + CHEQUE + CARTAO + TICKET - TROCO )
     FROM FAT_VENDAS
     WHERE ( ( CNPJ = :CNPJ ) AND ( DATA_CAIXA < :DATA_INI  ) )
     AND CANCELADA <> 'S' AND FECHADA = 'S' AND ENVIADA_CX = 'S'
     INTO :SALDO_INICIAL ;

     /* VENDAS A VISTA LANCADAS */
     SELECT SUM( DINHEIRO + CHEQUE + CARTAO + TICKET - TROCO )
     FROM FAT_VENDAS
     WHERE ( ( CNPJ = :CNPJ ) AND ( DATA_CAIXA >= :DATA_INI  AND DATA_CAIXA <= :DATA_FIN ) )
     AND CANCELADA <> 'S' AND FECHADA = 'S' AND ENVIADA_CX = 'S'
     INTO :SALDO_LANCADAS ;

     SALDO_BAIXAS = 0;
     SALDO_FINAL  = 0;

     IF ( SALDO_INICIAL IS NULL ) THEN
        SALDO_INICIAL = 0;

     IF ( SALDO_LANCADAS IS NULL ) THEN
        SALDO_LANCADAS = 0;

     IF ( SALDO_BAIXAS IS NULL ) THEN
        SALDO_BAIXAS = 0;

     IF ( SALDO_FINAL IS NULL ) THEN
        SALDO_FINAL = 0;

     suspend;

     ORIGEM = 'VNP'; /* VENDAS A PRAZO */

     /* VENDAS A PRAZO SALDO INICIAL */
     SELECT SUM( (TOTAL + DESC_ACRES) - ( DINHEIRO + CHEQUE + CARTAO + TICKET - TROCO ))
     FROM FAT_VENDAS
     WHERE ( ( CNPJ = :CNPJ ) AND ( DATA_CAIXA < :DATA_INI  ) )
     AND CANCELADA <> 'S' AND FECHADA = 'S' AND ENVIADA_CX = 'S'
     INTO :SALDO_INICIAL ;

     /* VENDAS A VISTA LANCADAS */
     SELECT SUM( (TOTAL + DESC_ACRES) - ( DINHEIRO + CHEQUE + CARTAO + TICKET - TROCO ))
     FROM FAT_VENDAS
     WHERE ( ( CNPJ = :CNPJ ) AND ( DATA_CAIXA >= :DATA_INI  AND DATA_CAIXA <= :DATA_FIN ) )
     AND CANCELADA <> 'S' AND FECHADA = 'S' AND ENVIADA_CX = 'S'
     INTO :SALDO_LANCADAS ;

     SALDO_BAIXAS = 0;
     SALDO_FINAL  = 0;

     IF ( SALDO_INICIAL IS NULL ) THEN
        SALDO_INICIAL = 0;

     IF ( SALDO_LANCADAS IS NULL ) THEN
        SALDO_LANCADAS = 0;

     IF ( SALDO_BAIXAS IS NULL ) THEN
        SALDO_BAIXAS = 0;

     IF ( SALDO_FINAL IS NULL ) THEN
        SALDO_FINAL = 0;

     suspend;
END
^

ALTER PROCEDURE SALDO_FLUXO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO_RECEBER NUMERIC(18,4),
    SALDO_PAGAR NUMERIC(18,4),
    SALDO_CHEQUE NUMERIC(18,4),
    SALDO_ESTOQUE NUMERIC(18,4))
AS
begin
     IF ( TURNO <= 1 )
     THEN BEGIN
          DATA = :DATA - 1;
     END
     ELSE BEGIN
          TURNO = :TURNO - 1;
     END

     SELECT
     SALDO_RECEBER, SALDO_PAGAR,
     SALDO_CHEQUE, SALDO_ESTOQUE
     FROM FAT_CAIXAS_FLUXO
     WHERE
     CNPJ    = :CNPJ    AND
     USUARIO = :USUARIO AND
     CONTA   = :CONTA   AND
     DATA    = :DATA    AND
     TURNO   = :TURNO
     INTO
     :SALDO_RECEBER, :SALDO_PAGAR,
     :SALDO_CHEQUE, :SALDO_ESTOQUE;

     suspend;
END
^

ALTER PROCEDURE SALDO_INICIAL_ESTOQUE_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SALDO NUMERIC(18,4))
AS
begin
     DATA = DATA - 1;

     SELECT SALDO_FINAL_ESTOQUE
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     INTO :SALDO ;

     suspend;
END
^

ALTER PROCEDURE SALDO_VENDAS_PRAZO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE DIA INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CONTA INTEGER;
begin
     /* CONTA A VISTA
     SELECT CONTA_VENDAS_PRAZO
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :CONTA ;

     /* EXTRAI DIA, MES E ANO
     DIA = EXTRACT ( DAY   FROM :DATA );
     MES = EXTRACT ( MONTH FROM :DATA );
     ANO = EXTRACT ( YEAR  FROM :DATA );

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO
     SELECT SUM ( VALOR )
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE EXTRACT (DAY   FROM DATA) <= :DIA
     AND EXTRACT   (MONTH FROM DATA) = :MES
     AND EXTRACT   (YEAR  FROM DATA) = :ANO
     AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS
     SELECT SUM ( VALOR )
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE EXTRACT (DAY   FROM DATA) <= :DIA
     AND EXTRACT   (MONTH FROM DATA) = :MES
     AND EXTRACT   (YEAR  FROM DATA) = :ANO
     AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;*/

     suspend;
END
^

ALTER PROCEDURE SALDO_VENDAS_VISTA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE DIA INTEGER;
DECLARE VARIABLE MES INTEGER;
DECLARE VARIABLE ANO INTEGER;
DECLARE VARIABLE CONTA INTEGER;
begin
     /* CONTA A VISTA */
     /*SELECT CONTA_VENDAS_VISTA
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :CONTA ;

     /* EXTRAI DIA, MES E ANO*/
  /*   DIA = EXTRACT ( DAY   FROM :DATA );
     MES = EXTRACT ( MONTH FROM :DATA );
     ANO = EXTRACT ( YEAR  FROM :DATA );

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO */
   /*  SELECT SUM ( VALOR )
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE EXTRACT (DAY   FROM DATA) <= :DIA
     AND EXTRACT   (MONTH FROM DATA) = :MES
     AND EXTRACT   (YEAR  FROM DATA) = :ANO
     AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
   /*  SELECT SUM ( VALOR )
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE EXTRACT (DAY   FROM DATA) <= :DIA
     AND EXTRACT   (MONTH FROM DATA) = :MES
     AND EXTRACT   (YEAR  FROM DATA) = :ANO
     AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;*/
  suspend;
END
^

ALTER PROCEDURE SALDOANT_CONTA (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     IF ( SOMAC IS NULL )
     THEN BEGIN
          SOMAC = 0;
     END

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND DATA < :DATA AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;

     IF ( SOMAD IS NULL )
     THEN BEGIN
          SOMAD = 0;
     END

     suspend;
END
^

ALTER PROCEDURE SALDOANT_CONTA_DRE (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
begin
     /*LEN = UDF_LENGTH(CONTA);*/
     /*UDF_COPY(CODIGO,1,:LEN) = :CONTA*/

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND TIPO = 'C' AND
     CODIGO like :CONTA||'%'
     INTO SOMAC;

     IF ( SOMAC IS NULL )
     THEN BEGIN
          SOMAC = 0;
     END

     /*UDF_COPY(CODIGO,1,:LEN) = :CONTA*/
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND DATA < :DATA AND TIPO = 'D' AND
     CODIGO like :CONTA||'%'
     INTO SOMAD;

     IF ( SOMAD IS NULL ) THEN
         SOMAD = 0;


     suspend;
END
^

ALTER PROCEDURE SALDOANT_CONTA_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
begin
     select * from getlength(:CONTA) into :len;
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND
     CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE CNPJ = :CNPJ AND DATA < :DATA AND
     CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDOANT_CONTACONC (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND DATA_CONCILIACAO < :DATA AND CONTA = :CONTA AND TIPO = 'C'
     AND DATA_CONCILIACAO IS NOT NULL
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE DEBITO CONCILIADOS*/
     SELECT SUM ( VALOR ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE DATA_CONCILIACAO < :DATA AND CONTA = :CONTA AND TIPO = 'D'
     AND DATA_CONCILIACAO IS NOT NULL AND CNPJ = :CNPJ
     INTO SOMAD;

     suspend;
END
^

ALTER PROCEDURE SALDOANTCONTABILIDADE (
    CNPJ VARCHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    CREDITO NUMERIC(18,8),
    DEBITO NUMERIC(18,8))
AS
DECLARE VARIABLE TAMANHO INTEGER;
begin
     /*  */
     
     SELECT SUM(VALOR) FROM VER_MOVIMENTO_CONTABIL(:CNPJ)
     WHERE TIPO =  'C' AND DATA < :DATA AND CNPJ = :CNPJ
     AND CODIGO_CONTABIL like  :CONTA||'%'
     INTO CREDITO;
     
     if (Credito is Null)
     then
         Credito = 0 ;
         
     SELECT SUM(VALOR) FROM VER_MOVIMENTO_CONTABIL(:CNPJ)
     WHERE TIPO =  'D' AND DATA < :DATA AND CNPJ = :CNPJ
     AND CODIGO_CONTABIL like :CONTA||'%'
     INTO DEBITO;
     
     if (Debito is Null)
     then
         Debito = 0 ;
     
  suspend;
END
^

ALTER PROCEDURE SALDOANTINDEXADO_CONTA (
    CNPJ CHAR(14),
    CONTA INTEGER,
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
begin
     /* SOMA TODAS OS LANCAMENTOS DE CREDITO INDEXADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND CONTA = :CONTA AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE DEBITO INDEXADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND DATA < :DATA AND CONTA = :CONTA AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDOANTINDEXADO_CONTA_RAZAO (
    CNPJ CHAR(14),
    CONTA VARCHAR(15),
    DATA DATE)
RETURNS (
    SOMAC NUMERIC(18,4),
    SOMAD NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
begin
     select * from getlength(:CONTA) into :len;

     /* SOMA TODAS OS LANCAMENTOS DE CREDITO INDEXADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND
     CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'C'
     INTO SOMAC;

     /* SOMA TODAS OS LANCAMENTOS DE DEBITO INDEXADOS*/
     SELECT SUM ( VALOR_INDEXADO ) FROM VER_MOVIMENTO_CONTABIL ( :CNPJ )
     WHERE  CNPJ = :CNPJ AND DATA < :DATA AND
     CODIGO_CONTABIL like :CONTA||'%' AND TIPO = 'D'
     INTO SOMAD;
  suspend;
END
^

ALTER PROCEDURE SALDOPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
begin
     SELECT SUM(VALOR) FROM CTB_DESDOBRA_MOVIMENTO_CONTAS
     WHERE TIPO =  'C' AND PLANILHA = :PLANILHA AND CNPJ = :CNPJ
     INTO :SOMA;

     suspend;
END
^

ALTER PROCEDURE SALDORESTANTEPLANILHA (
    CNPJ CHAR(14),
    PLANILHA INTEGER,
    TOTAL NUMERIC(18,4))
RETURNS (
    SOMA NUMERIC(18,4))
AS
DECLARE VARIABLE AUX NUMERIC(18,4);
begin
     SELECT SUM(VALOR) FROM CTB_DESDOBRA_MOVIMENTO_CONTAS
     WHERE PLANILHA = :PLANILHA AND CNPJ = :CNPJ
     INTO :AUX;

     IF ( :AUX IS NULL )
     THEN BEGIN
          SOMA = TOTAL ;
     END
     ELSE BEGIN
          SOMA = TOTAL - :AUX ;
     END

     suspend;
END
^

ALTER PROCEDURE SEL_VER_VENDAS (
    CNPJ CHAR(14),
    TP CHAR(1),
    I_CODIGO INTEGER,
    I_TIPO_VENDA CHAR(3),
    I_CLIENTE INTEGER,
    I_DATA DATE,
    I_DATA_CAIXA DATE)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_NF_XML VARCHAR(8),
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CARGA INTEGER,
    CANCELADA CHAR(1),
    SERIE CHAR(3),
    SELECIONADA CHAR(1),
    STATUS_CARREGAMENTO INTEGER,
    ORDEM_CARGA INTEGER,
    PSA_ATIVIDADE INTEGER,
    PSA_BAIRRO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_CEP VARCHAR(8),
    PSA_CIDADE INTEGER,
    PSA_COMPLEMENTO VARCHAR(30),
    PSA_CONTATO VARCHAR(30),
    PSA_CONVENIO INTEGER,
    PSA_CPF_CGC VARCHAR(15),
    PSA_DT_CADASTRO TIMESTAMP,
    PSA_DT_NASCIMENTO TIMESTAMP,
    PSA_EMISSOR VARCHAR(6),
    PSA_ENDERECO INTEGER,
    PSA_FANTASIA VARCHAR(50),
    PSA_FAX VARCHAR(20),
    PSA_FONE VARCHAR(20),
    PSA_INSC_MUNIC VARCHAR(15),
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_NUMERO VARCHAR(15),
    PSA_PESSOA CHAR(1),
    PSA_RG_IE VARCHAR(15),
    PSA_UF CHAR(2),
    LGD_NOME VARCHAR(50),
    BAI_NOME VARCHAR(50),
    CID_NOME VARCHAR(50),
    ID_AGRUPADOR INTEGER,
    ENTREGA_FUTURA CHAR(1),
    ATI_NOME VARCHAR(50),
    REG_NOME VARCHAR(50),
    PSA_EMAIL VARCHAR(80),
    PCT_COMISSAO NUMERIC(18,4),
    HORA TIME,
    NFE_CHAVE VARCHAR(80),
    NFE_SELECIONADO CHAR(1),
    NFE_VALIDADA CHAR(1),
    NFE_ASSINADA CHAR(1),
    NFE_TRANSMITIDA CHAR(1),
    NFE_AUTORIZADA CHAR(1),
    NFE_DANFE_IMPRESSO CHAR(1),
    N_SEQ_ECF CHAR(3),
    N_SERIE_ECF CHAR(20),
    NFE_PROTOCOLO CHAR(200),
    NFE_RECIBO CHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CONT_CARTAO INTEGER,
    CONT_CHEQUE INTEGER,
    VD_CHEQUE FLOAT,
    VD_CARTAO FLOAT,
    VD_DINHEIRO FLOAT,
    VD_ENTRADA FLOAT,
    DIVERG_CARTAO FLOAT,
    DIVERG_CHEQUE FLOAT,
    DT_EMISSAO_NF DATE,
    NFE_IMPRESSAO CHAR(1))
AS
declare variable inicio integer;
declare variable tamanho integer;
declare variable total_cheque float;
declare variable total_cartao float;
BEGIN

     FOR SELECT pessoa_fj, nome, codigo, data, total, desc_acres,
         fechada, historico, vendedor, usuario, data_caixa, conta_caixa,
         num_nf, num_cupom, natureza, tipo_venda,
         nome_consumidor, substring(observacao from 1 for 200), orcamento, local, enviada_cx, cancelada,
         base_icm, icm, base_icm_subst, valor_icm_subst, frete, seguro,
         despesas, ipi, total_nota, carga, vd.serie,coalesce(selecionada,'N'), status_carregamento,
         ordem_carga, id_agrupador, entrega_futura,pct_comissao, hora,
         substring( NFE_XML FROM 182 FOR 44) ,
        NFE_SELECIONADO        ,
        NFE_VALIDADA           ,
        NFE_ASSINADA           ,
        NFE_TRANSMITIDA        ,
        NFE_AUTORIZADA         ,
        NFE_DANFE_IMPRESSO     ,
        N_SEQ_ECF              ,
        N_SERIE_ECF,
        NFE_PROTOCOLO,
        NFE_RECIBO,
        NFE_XML,
        vd.cheque,
        vd.cartao,
        vd.dinheiro,
        vd.entrada,
        vd.DT_EMISSAO_NF,
        coalesce(s.nfe_impressao,'S')
        FROM FAT_VENDAS vd
        left join sis_serienf s on (s.cnpj = vd.cnpj and s.serie = vd.serie)
     WHERE (vd.CNPJ = :CNPJ) and vd.enviada_cx = 'S' AND (coalesce(FECHADA,'N') = :TP )  AND (coalesce(CANCELADA,'N') = 'N')
     and ((vd.tipo_venda = :i_tipo_venda) or (:i_tipo_venda = ''))
     and ((vd.pessoa_fj = :i_cliente) or (:i_cliente = 0))
     and ((vd.codigo = :i_codigo) or (:i_codigo = 0))
     and ((vd.data = :i_data) or (:i_data is null))
     and ((vd.data_caixa = :i_data_caixa) or (:i_data_caixa is null))
     INTO
         :PESSOA_FJ, :NOME, :CODIGO, :DATA, :TOTAL, :DESC_ACRES,
         :FECHADA, :HISTORICO, :VENDEDOR, :USUARIO, :DATA_CAIXA, :CONTA_CAIXA,
         :NUM_NF, :NUM_CUPOM, :NATUREZA, :TIPO_VENDA,
         :NOME_CONSUMIDOR, :OBSERVACAO, :ORCAMENTO, LOCAL, :ENVIADA_CX, :CANCELADA,
         :BASE_ICM, :ICM, :BASE_ICM_SUBST, :VALOR_ICM_SUBST, :FRETE, :SEGURO,
         :DESPESAS, :IPI, :TOTAL_NOTA, :CARGA, :SERIE, :SELECIONADA, :STATUS_CARREGAMENTO,
         :ordem_carga, :id_agrupador, :entrega_futura, :pct_comissao, :hora,
         :NFE_CHAVE ,
         :NFE_SELECIONADO        ,
         :NFE_VALIDADA           ,
         :NFE_ASSINADA           ,
         :NFE_TRANSMITIDA        ,
         :NFE_AUTORIZADA         ,
         :NFE_DANFE_IMPRESSO     ,
         :N_SEQ_ECF              ,
         :N_SERIE_ECF,
         :NFE_PROTOCOLO,
         :NFE_RECIBO,
         :NFE_XML,
         :VD_CHEQUE,
         :VD_CARTAO,
         :VD_DINHEIRO,
         :VD_ENTRADA,
         :dt_emissao_nf,
         :NFE_IMPRESSAO
     DO BEGIN
        vd_cartao = coalesce(:vd_cartao,0);
        vd_cheque = coalesce(:vd_cheque,0);

        /* CLIENTE */
        select count(*) from fin_movimento_cartao ctr
        where ctr.cnpj = :cnpj and ctr.venda = :codigo
        into :cont_cartao;


        select count(*) from fin_cheques ch
        where ch.cnpj = :cnpj and ch.venda = :codigo
        into :cont_cheque;

        select sum(valor) from fin_movimento_cartao ctr
        where ctr.cnpj = :cnpj and ctr.venda = :codigo
        into :total_cartao;
        total_cartao = coalesce(:total_cartao,0);


        select sum(valor) from fin_cheques ch
        where ch.cnpj = :cnpj and ch.venda = :codigo
        into :total_cheque;
        total_cheque = coalesce(:total_cheque,0);


        /*Avaliando se há divergencia nos valores de cartão, no entanto por questão de arredondamento só sera considerada se for superior a 1 */
        diverg_cartao = (:vd_cartao - :total_cartao);
        if (diverg_cartao < 0) then
          diverg_cartao = :diverg_cartao * -1;

        if (diverg_cartao < 1) then
          diverg_cartao = 0;


       /*Avaliando se há divergencia nos valores de cheque, no entanto por questão de arredondamento só sera considerada se for superior a 1  */
        diverg_cheque = (:vd_cheque - :total_cheque);
        if (diverg_cheque < 0) then
          diverg_cheque = :diverg_cheque * -1;

        if (diverg_cheque < 1) then
          diverg_cheque = 0;


        select * from GETLENGTH(:num_nf)
        into :tamanho;
        if (:tamanho = 1) then
          inicio = 224;
        if (:tamanho = 2) then
          inicio = 223;
        else if (:tamanho = 3) then
          inicio = 222;
        else if (:tamanho = 4) then
          inicio = 221;
        else if (:tamanho = 5) then
          inicio = 220;
        else if (:tamanho = 6) then
          inicio = 219;


        select coalesce(substring(vd.nfe_xml from :inicio for :tamanho) ,'0') from fat_vendas vd
        where vd.cnpj = :cnpj and vd.codigo = :codigo
        into :num_nf_xml;



        select psa.atividade,psa.bairro,psa.celular,psa.cep,psa.cidade,psa.complemento,
        psa.contato,psa.convenio ,psa.cpf_cgc,psa.dt_cadastro,psa.dt_nascimento,psa.emissor,
        psa.endereco,psa.fantasia,psa.fax,psa.fone,psa.insc_munic,psa.nome_razao,psa.numero,
        psa.pessoa,substring(psa.rg_ie from 1 for 15),psa.uf,
        lgd.nome, bai.nome, cid.nome, ati.nome, reg.nome, psa.email
        from glo_pessoas_fj psa
        left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
        left join glo_bairros bai on (psa.bairro = bai.codigo and bai.cnpj = psa.cnpj)
        left join glo_cidades cid on (psa.cidade = cid.codigo and cid.cnpj = psa.cnpj)
        left join glo_atividades ati on (ati.codigo = psa.atividade and psa.cnpj = ati.cnpj )
        left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
        where psa.codigo = :pessoa_fj and psa.cnpj = :cnpj
        into psa_atividade,psa_bairro,psa_celular,psa_cep,psa_cidade,psa_complemento,
        psa_contato,psa_convenio,psa_cpf_cgc,psa_dt_cadastro,psa_dt_nascimento,psa_emissor,
        psa_endereco,psa_fantasia,psa_fax,psa_fone,psa_insc_munic,psa_nome_razao,psa_numero,psa_pessoa,:psa_rg_ie,psa_uf,
        lgd_nome, bai_nome, cid_nome, ati_nome, reg_nome, psa_email;

        /* VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDOR AND CNPJ = :CNPJ
        INTO :NOMEVENDEDOR ;

        /* NATUREZA */
        SELECT NOME FROM EST_NATUREZA
        WHERE CODIGO = :NATUREZA AND CNPJ = :CNPJ
        INTO :NOMENATUREZA ;

        VLR_TOTAL = :TOTAL + :DESC_ACRES ;
        
        SUSPEND;
    END
END
^

ALTER PROCEDURE SELECIONA_COBRANCAS (
    INDICE VARCHAR(57),
    SELECIONADO CHAR(1))
AS
BEGIN
  /*não se faz mas seleção de cobranças, pois ela
  e apenas individual
  IF ( SELECIONADO = 'S' ) THEN
    selecionado = 'N';
  ELSE
    selecionado = 'S';

  UPDATE FIN_COBRANCAS
  SET SELECIONADO = :selecionado
  WHERE INDICE = :indice;*/
EXIT;
END
^

ALTER PROCEDURE SELECIONA_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1))
AS
BEGIN
     UPDATE FIN_CONTAS_PAGAR
     SET SELECIONADO = :SEL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO ;

  SUSPEND;
END
^

ALTER PROCEDURE SELECIONA_REC_CONVENIO_PERIODO (
    CNPJ CHAR(14),
    CONVENIO INTEGER,
    INICIAL DATE,
    FINAL DATE)
AS
DECLARE VARIABLE PESSOA_FJ  INTEGER;
DECLARE VARIABLE CONVENIADO INTEGER;
BEGIN
     /* PESSOAS FJ */
     FOR SELECT CODIGO
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIO
     INTO :PESSOA_FJ
     DO BEGIN
        /* BUSCA AS PARCELAS DO CONVENIO */
        UPDATE FIN_CONTAS_RECEBER
        SET SELECIONADO = 'S'
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIO AND DT_VENCTO >= :INICIAL AND DT_VENCTO <= :FINAL
        AND FATURA IS NULL ;

        FOR SELECT CODIGO
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CONVENIO = :PESSOA_FJ
        INTO :CONVENIADO
        DO BEGIN
           UPDATE FIN_CONTAS_RECEBER
           SET SELECIONADO = 'S'
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIADO AND DT_VENCTO >= :INICIAL AND
           DT_VENCTO <= :FINAL
           AND FATURA IS NULL  ;
        END
     END
END
^

ALTER PROCEDURE SELECIONA_RECEBER (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1))
AS
BEGIN
     UPDATE FIN_CONTAS_RECEBER
     SET SELECIONADO = :SEL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO ;

     SUSPEND;
END
^

ALTER PROCEDURE SELECIONA_RECEBER_LOJA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    SEL CHAR(1),
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN
     /* valor é o valor da conta  + os juros */
     If ( SEL = 'S' )
     THEN BEGIN
          UPDATE FIN_CONTAS_RECEBER
          SET SELECIONADO = :SEL, PARCIAL = :VALOR, JUROS_PARCIAL = :JUROS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO ;
     END
     ELSE BEGIN
          UPDATE FIN_CONTAS_RECEBER
          SET SELECIONADO = :SEL, PARCIAL = 0, JUROS_PARCIAL = 0
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE SELECIONA_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    OPCAO CHAR(1))
AS
BEGIN
     IF ( CODIGO > 0 ) /* SO MARCA QUANDO TEM UMA VENDA SELECIONADA */
     THEN BEGIN
          UPDATE FAT_VENDAS
          SET SELECIONADA = :OPCAO
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE SEQUENCIA_ETIQUETA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
begin
     SELECT MAX(SEQUENCIA) FROM EST_ESTIQUETA_PRODUTO
     WHERE CNPJ = :CNPJ
     INTO :CODIGO ;

     suspend;
END
^

ALTER PROCEDURE SEQUENCIA_ETIQUETA_IMPRIME (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
begin
     SELECT MAX(SEQUENCIA) FROM EST_ESTIQUETA_PRODUTO_IMPRIME
     WHERE CNPJ = :CNPJ
     INTO :CODIGO ;

     suspend;
END
^

ALTER PROCEDURE SETAR_IMP_NF_SERVICO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    IRRF NUMERIC(18,4),
    ISS NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4))
AS
begin
     UPDATE FAT_VENDAS
     SET PIS_COFINS_CSLL = :PIS_COFINS_CSLL,
     IRRF = :IRRF,
     ISS = :ISS,
     INSS = :INSS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO ;

     suspend;
END
^

ALTER PROCEDURE SINTEGRA_50_ALIQUOTAS_ENT (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    TOTAL NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA NUMERIC(18,4),
    CFOP INTEGER)
AS
BEGIN
     FOR SELECT
         CFOP,
         ICM,
         SUM(QUANTIDADE * (PRC_UNITARIO - DESCONTOS)),
         SUM(ICM * (QUANTIDADE * (PRC_UNITARIO - DESCONTOS))/100),
         SUM(ICM_SUBS),
         SUM(IPI * (QUANTIDADE * (PRC_UNITARIO - DESCONTOS))/100)
     FROM EST_ENTRADAS_ITENS
     WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
     GROUP BY CFOP, ICM
     INTO :CFOP, :ALIQUOTA, :TOTAL, :ICM, :ICM_SUBS, :IPI
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE SINTEGRA_75 (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO VARCHAR(15),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(4),
    IPI NUMERIC(18,4),
    COD_REDUCAO INTEGER,
    REDUCAO NUMERIC(18,4))
AS
DECLARE VARIABLE QTDE INTEGER;
begin
    for select p.codigo, p.nome, p.unidade, p.ipi, reducao
    from est_produtos p
    where p.cnpj = :cnpj
    into :CODIGO, :NOME, :UNIDADE, :IPI, :COD_REDUCAO DO
    BEGIN
      IF ( UNIDADE IS NULL )
      THEN
        UNIDADE = 'UN' ;
         
      select perc_estadual from
      est_reducoes
      where cnpj = :cnpj and Codigo =:reducao
      into :REDUCAO ;

      /* vou suspender todos os produtos sem me
      importar se ele tem movimento ou não
      QTDE = 0;
      SELECT Qtde
      From SINTEGRA_VER_REG_75
      ( :CNPJ, udf_trim(:Codigo), :DINI, :DFIM )
      INTO :QTDE ;

      IF ( QTDE IS NULL )
      THEN
        QTDE = 0;

      IF ( QTDE > 0 )
      THEN*/
         Suspend ;
    END
END
^

ALTER PROCEDURE SINTEGRA_VER_REG_75 (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DINI DATE,
    DFIM DATE)
RETURNS (
    QTDE INTEGER)
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE QUANTIDADE INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE NDOCTO VARCHAR(20);
begin
     /*esse procedimento pelo que tudo aparenta, apenas faz a contagem do número de produtos
     comercializado tanto de entrada, que os busca de acordo, c/o código passado e
     um intervalo de datas*/

     QTDE = 0;

     /*--------------------aqui percorre-se os registros de saida------------*/
     /*percorrendo tabela de vendas, c as vendas que estiverem dentro do intervalo
     e que forem da mesma empresa*/
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM
     AND NUM_NF > 0 and NUM_CUPOM = 0 and CANCELADA <> 'S'
     INTO :CODIGO DO
     BEGIN /*contando quantos itens do produto encontrado temos nesta venda*/
          SELECT COUNT(PRODUTO)
          FROM FAT_VENDAS_ITENS
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO
          INTO :QUANTIDADE ;

          QTDE = :QTDE + :QUANTIDADE;
     END


     /*--------------------aqui percorre-se os registros de entrada------------*/
     FOR SELECT NDOCTO, PESSOA_FJ
     FROM EST_ENTRADAS /*que forem da empresa e estiverem dentro do intervalo das datas*/
     WHERE CNPJ = :CNPJ AND DATA_NF >= :DINI AND DATA_NF <= :DFIM
     AND LOCAL_ESTOQUE = 1
     INTO :NDOCTO, :PESSOA_FJ DO
     BEGIN /*fazendo o mesmo processo de venda, contando os itens do movimento*/
          SELECT COUNT(PRODUTO)
          FROM EST_ENTRADAS_ITENS
          WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
          AND PRODUTO = :PRODUTO
          INTO :QUANTIDADE ;

          QTDE = :QTDE + :QUANTIDADE;
     END

     suspend;
END
^

ALTER PROCEDURE SIS_INF_RELACIONAMENTO (
    TABELA VARCHAR(31),
    CAMPO VARCHAR(31))
RETURNS (
    TABELA_REL VARCHAR(31),
    CAMPO_REL VARCHAR(31),
    CAMPO_RES VARCHAR(31))
AS
BEGIN
  /*  */
  SELECT TABELA_REL, CAMPO_REL, CAMPO_RES
  FROM SIS_RELACIONAMENTOS
  WHERE TABELA = :TABELA AND
        CAMPO = :CAMPO
  INTO :TABELA_REL, :CAMPO_REL, :CAMPO_RES;
  SUSPEND;
END
^

ALTER PROCEDURE SOMA_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VLR_BAIXA), SUM(JUROS), SUM(DESCONTOS)
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA
     INTO :SOMA, :JUROS, :DESCONTOS ;

     SUSPEND ;
END
^

ALTER PROCEDURE SOMA_BAIXA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VLR_BAIXA), SUM(JUROS), SUM(DESCONTOS)
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA
     INTO :SOMA, :JUROS, :DESCONTOS ;

     SUSPEND ;
END
^

ALTER PROCEDURE SOMA_CARTAO_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR) FROM FIN_MOVIMENTO_CARTAO
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO
     INTO :SOMA ;
     
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CARTAO_VISTA_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR)
     FROM FIN_MOVIMENTO_CARTAO
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO
     AND DATA = REEMBOLSO

     INTO :SOMA ;

     IF ( SOMA IS NULL )
     THEN
       SOMA = 0;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_ABERTOS (
    CNPJ VARCHAR(20))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES ABERTOS */
     SELECT SUM(VALOR) FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND CONCILIADO = 'N'
     INTO :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_ACERTADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES LANCADOS NA DATA ABERTOS */
     SELECT SUM(VALOR)
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND
     DATA_ACERTO = :DATA

     INTO :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_CONCILIADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES ABERTOS */
     SELECT SUM(VALOR) FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND DATA_CONCILIACAO = :DATA
     AND PROCESSADO = 'N'

     INTO :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_DEVOLVIDOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES DEVOLVIDOS NA DATA */
     SELECT SUM(VALOR)
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND
     DATA_DEVOLUCAO = :DATA

     INTO :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_DEVOLVIDOS_PESSOA (
    CNPJ VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES DEVOLVIDOS NA DATA */
  select sum(ch.valor) from fin_cheques ch
  where ch.pessoa_fj = :pessoa_fj and ch.cnpj = :cnpj and
  ch.vezes_devolucao > 0  and ch.data_acerto is null
  into :soma ;

  suspend;
END
^

ALTER PROCEDURE SOMA_CHEQUE_LANCADOS_DATA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA OS CHEQUES LANCADOS NA DATA ABERTOS */
     SELECT SUM(VALOR)
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND
     EMISSAO = :DATA

     INTO :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_PLANILHA (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR) FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND PLANILHA = :CODIGO
     INTO :SOMA ;
  SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR) FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO
     INTO :SOMA ;
  SUSPEND;
END
^

ALTER PROCEDURE SOMA_CHEQUE_VISTA_VENDA (
    CNPJ VARCHAR(20),
    CODIGO INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR) FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND VENDA = :CODIGO
     AND DATA_CAIXA = PRE_DATE

     INTO :SOMA ;

     IF ( SOMA IS NULL )
     THEN
       SOMA = 0;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_CONCILIACAO_CARTAO (
    CNPJ VARCHAR(20))
RETURNS (
    SOMA NUMERIC(18,4))
AS
DECLARE VARIABLE VALOR NUMERIC(18,4);
DECLARE VARIABLE AUX2 NUMERIC(18,4);
DECLARE VARIABLE AUX NUMERIC(18,4);
DECLARE VARIABLE TAXA NUMERIC(18,4);
BEGIN
     SOMA = 0;

     for select valor, taxa  from fin_movimento_cartao m
         where cnpj = :cnpj and  processado = 'S' and coalesce(m.conciliado,'N') = 'N'
         into :valor, :taxa
     do
     begin
        if (valor is null)then
          valor = 0;

        if (taxa is null) then
          taxa = 0;

        if (taxa > 0) then
        begin
          aux = ( (:valor * :taxa)/100);
          select * from round2(:aux) into :aux;

             aux2 =  :valor - aux;
             select * from round2(:aux2) into :aux2;

             soma =  :soma + aux2;
        end
        else
          soma = soma + valor ;
     end
     
     suspend;
END
^

ALTER PROCEDURE SOMA_ENTRADA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND FLUXO_CAIXA = :DATA
     INTO :SOMA ;

     SUSPEND ;
END
^

ALTER PROCEDURE SOMA_ENTRADA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FLUXO_CAIXA = :DATA
     INTO :SOMA ;

     SUSPEND ;
END
^

ALTER PROCEDURE SOMA_FATURA_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR)
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND VENCIMENTO <= :DATA AND BAIXADA <> 'S'
     INTO :SOMA;
END
^

ALTER PROCEDURE SOMA_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ 
     INTO :SOMA;
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_PAGAR_2MESES (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN

     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND
     DT_VENCTO < :FIM
     INTO :SOMA;
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_PAGAR_3MESES (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO < :DATA
     INTO :SOMA;
     
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_PAGAR_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO <= :DATA
     INTO :SOMA;
END
^

ALTER PROCEDURE SOMA_PAGAR_DATA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE)
AS
declare variable TOTALPAGAR NUMERIC(18,4);
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
     INTO :TOTALPAGAR;
     
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     FOR SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS),
            DT_VENCTO
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
     GROUP BY DT_VENCTO
     INTO :SOMA, :DATA
     DO BEGIN
        PORCENTAGEM = SOMA / TOTALPAGAR * 100 ;
        SUSPEND;
     END
END
^

ALTER PROCEDURE SOMA_PAGAR_DATA_ANALITICO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15))
AS
declare variable TOTALPAGAR NUMERIC(18,4);
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
     INTO :TOTALPAGAR;

     /* SOMA O TOTAL DE CONTAS A PAGAR */
     FOR SELECT SUM(VALOR-VLR_PARCIAL+JUROS_PAG-DESCONTOS),
            DT_VENCTO, PESSOA_FJ
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
     GROUP BY DT_VENCTO, PESSOA_FJ
     INTO :SOMA, :DATA, :PESSOA_FJ
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;
        
        PORCENTAGEM = SOMA / TOTALPAGAR * 100;
     
        SUSPEND;
     END
END
^

ALTER PROCEDURE SOMA_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-(VLR_PARCIAL+DESCONTOS)), COUNT(VALOR)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI
     AND DT_LANCTO <= :DFIM
     AND   SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     INTO
         :SOMA,
         :QUANTIDADE;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_PAGAR_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-(VLR_PARCIAL+DESCONTOS)), COUNT(VALOR)
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI
     AND DT_VENCTO <= :DFIM
     AND   SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     INTO
         :SOMA,
         :QUANTIDADE;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA O TOTAL DE CONTAS A RECEBER */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA IS NULL
     INTO :SOMA;
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_2MESES (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN

     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND
     DT_VENCTO < :FIM AND FATURA IS NULL
     INTO :SOMA;
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_3MESES (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO < :DATA
     AND FATURA IS NULL
     INTO :SOMA;
     
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_ABERTO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     /* SOMA O TOTAL DE CONTAS A PAGAR */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO <= :DATA
     INTO :SOMA;
END
^

ALTER PROCEDURE SOMA_RECEBER_CLIENTE (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    RECEBER NUMERIC(18,4),
    DATARECEBER DATE,
    FATURA NUMERIC(18,4),
    DATAFATURA DATE)
AS
BEGIN
     /* RECEBER */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS), MIN(DT_VENCTO)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ 
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :RECEBER,
         :DATARECEBER;
         
     /* FATURAS */
     SELECT SUM(VALOR-DESCONTO+JUROS), MIN(VENCIMENTO)
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ 
     AND PESSOA_FJ     = :PESSOA
     AND BAIXADA <> 'S'
     INTO
         :FATURA,
         :DATAFATURA;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_CLIENTE_PDV (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    RECEBER NUMERIC(18,4),
    DATARECEBER DATE,
    FATURA NUMERIC(18,4),
    DATAFATURA DATE)
AS
BEGIN
     /* RECEBER */
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS), MIN(DT_VENCTO)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ 
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :RECEBER,
         :DATARECEBER;
         
     /* FATURAS */
     SELECT SUM(VALOR-DESCONTO+JUROS), MIN(VENCIMENTO)
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ 
     AND PESSOA_FJ     = :PESSOA
     AND BAIXADA <> 'S'
     INTO
         :FATURA,
         :DATAFATURA;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_DATA (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    ARQ_MORTO CHAR(1))
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE)
AS
DECLARE VARIABLE TOTALRECEBER NUMERIC(18,4);
BEGIN
     /*pegando somente o arquivo morto*/
     if (:arq_morto = 'S') then
     begin
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       SELECT SUM(VALOR-VLR_PARCIAL)
       FROM FIN_CONTAS_RECEBER rec
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM  AND FATURA IS NULL
       and rec.arquivo_morto = 'S'
       INTO :TOTALRECEBER;
       
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       FOR SELECT SUM(VALOR-VLR_PARCIAL), DT_VENCTO
       FROM FIN_CONTAS_RECEBER rec
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM and rec.arquivo_morto = 'S'
       AND FATURA IS NULL
       GROUP BY DT_VENCTO
       INTO :SOMA, :DATA
       DO BEGIN
          PORCENTAGEM = SOMA / TOTALRECEBER * 100 ;
          SUSPEND;
       END
     end
     else if (:arq_morto = 'N') then
     begin
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       SELECT SUM(VALOR-VLR_PARCIAL)
       FROM FIN_CONTAS_RECEBER REC
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM  AND FATURA IS NULL and coalesce(arquivo_morto,'N') = 'N'
       INTO :TOTALRECEBER;
       
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       FOR SELECT SUM(VALOR-VLR_PARCIAL), DT_VENCTO
       FROM FIN_CONTAS_RECEBER rec
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM and coalesce(arquivo_morto,'N') = 'N'
       AND FATURA IS NULL
       GROUP BY DT_VENCTO
       INTO :SOMA, :DATA
       DO BEGIN
          PORCENTAGEM = SOMA / TOTALRECEBER * 100 ;
          SUSPEND;
       END
     end
     else
     begin
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       SELECT SUM(VALOR-VLR_PARCIAL)
       FROM FIN_CONTAS_RECEBER
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM  AND FATURA IS NULL
       INTO :TOTALRECEBER;
       
       /* SOMA O TOTAL DE CONTAS A RECEBER */
       FOR SELECT SUM(VALOR-VLR_PARCIAL), DT_VENCTO
       FROM FIN_CONTAS_RECEBER rec
       WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INI AND DT_VENCTO <= :FIM
       AND FATURA IS NULL
       GROUP BY DT_VENCTO
       INTO :SOMA, :DATA
       DO BEGIN
          PORCENTAGEM = SOMA / TOTALRECEBER * 100 ;
          SUSPEND;
       END
     end
END
^

ALTER PROCEDURE SOMA_RECEBER_DATA_ANALITICO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    PORCENTAGEM NUMERIC(18,4),
    DATA DATE,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    ARQ_MORTO CHAR(1),
    CODREC INTEGER)
AS
BEGIN EXIT; END
^

ALTER PROCEDURE SOMA_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS), COUNT(VALOR)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI
     AND DT_LANCTO <= :DFIM
     AND SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :SOMA,
         :QUANTIDADE;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_LOJA_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN
     SELECT SUM((VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS)+JUROS_PARCIAL),
     COUNT(VALOR), SUM(JUROS_PARCIAL)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI
     AND DT_LANCTO <= :DFIM
     AND SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :SOMA,
         :QUANTIDADE,
         :JUROS;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_LOJA_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4),
    JUROS NUMERIC(18,4))
AS
BEGIN /*retirei este codigo +JUROS_REC-DESCONTOS fabiano 05/11,2005*/
     SELECT SUM((VALOR-VLR_PARCIAL)+JUROS_PARCIAL),
     COUNT(VALOR), SUM(JUROS_PARCIAL)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI
     AND DT_VENCTO <= :DFIM
     AND   SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :SOMA,
         :QUANTIDADE,
         :JUROS;
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_RECEBER_VENCIMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PESSOA INTEGER)
RETURNS (
    QUANTIDADE INTEGER,
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR-VLR_PARCIAL+JUROS_REC-DESCONTOS), COUNT(VALOR)
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI
     AND DT_VENCTO <= :DFIM
     AND   SELECIONADO = 'S'
     AND PESSOA_FJ     = :PESSOA
     AND FATURA IS NULL
     INTO
         :SOMA,
         :QUANTIDADE;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_SANGRIAS (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER,
    DATA TIMESTAMP)
RETURNS (
    SOMA NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR)
     FROM FAT_CAIXAS_SANGRIAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA   = :CONTA   AND
     DATA    = :DATA    AND
     TURNO   = :TURNO
     INTO :SOMA ;

     IF ( SOMA IS NULL )
     THEN BEGIN
          SOMA = 0;
     END
END
^

ALTER PROCEDURE SOMA_VALORES_CAIXA (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    DINHEIRO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    MOEDAS NUMERIC(18,4),
    CHEQUE_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
BEGIN
     /* DATA DA CAIXA */
     SELECT
      SUM(DINHEIRO),
      SUM(TICKET),
      SUM(CHEQUE),
      SUM(CARTAO),
      SUM(MOEDAS)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     DATA = :DATA
     INTO
         :DINHEIRO,
         :TICKET,
         :CHEQUE,
         :CARTAO,
         :MOEDAS;

     /* DATA DA CAIXA */
     SELECT
      SUM(CHEQUE_PRAZO)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND DATA = :DATA AND TURNO <> 99
     INTO :CHEQUE_PRAZO ;

     /* SOMA CHEQUES A PRAZO Q FORAM LANCADOS PELO CAIXA GERAL*/
     IF ( CHEQUE_PRAZO IS NULL )
     THEN BEGIN
          CHEQUE_PRAZO = 0;
     END

     /* CHEQUES A VISTA */
     SELECT SUM(VALOR)
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA AND TURNO = 99 AND DATA_CAIXA = PRE_DATE
     INTO :SOMA ;

     IF ( SOMA IS NULL )
     THEN BEGIN
          SOMA = 0;
     END

     CHEQUE = CHEQUE + SOMA ;

     /* CHEQUES A PRAZO */
     SELECT SUM(VALOR)
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA AND TURNO = 99 AND DATA_CAIXA <> PRE_DATE
     INTO :SOMA ;

     IF ( SOMA IS NULL )
     THEN BEGIN
          SOMA = 0;
     END

     /* CHEQUE PRAZO */
     CHEQUE_PRAZO = :CHEQUE_PRAZO + :SOMA ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_VALORES_VENDAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    DINHEIRO NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    PRAZO NUMERIC(18,4),
    TROCO NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(vd.DINHEIRO), SUM(vd.CHEQUE), SUM(vd.CARTAO),
            SUM(vd.TICKET), SUM(vd.TOTAL+vd.DESC_ACRES), SUM(vd.TROCO)
     FROM FAT_VENDAS vd
     INNER JOIN est_natureza nat on (nat.codigo = vd.natureza)
     WHERE vd.CNPJ = :CNPJ
     AND vd.USUARIO = :USUARIO
     AND vd.DATA_CAIXA = :DATA
     AND vd.TURNO = :TURNO
     AND vd.FECHADA = 'S'
     AND vd.ENVIADA_CX = 'S'
     and nat.mov_caixa = 'S'
     INTO
     :DINHEIRO, :CHEQUE, :CARTAO,
     :TICKET, :PRAZO, :TROCO ;

     SUSPEND;
END
^

ALTER PROCEDURE SOMA_VENDA_SELECIONADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4),
    NUMERO INTEGER)
AS
BEGIN
     /* SELECIONA AS VENDAS DO CLIENTE */
     SELECT SUM(TOTAL+DESC_ACRES), COUNT(PESSOA_FJ)
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND SELECIONADA = 'S' AND (( DUPLICATA = 0 ) OR ( DUPLICATA IS NULL ))
     AND FECHADA = 'S' AND TIPO_VENDA = 'FFT' AND CANCELADA <> 'S'
     INTO :SOMA, :NUMERO ;
     
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_VENDA_SELECIONADA_AGRUPADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    SOMA NUMERIC(18,4),
    NUMERO INTEGER)
AS
BEGIN
     /* SELECIONA AS VENDAS DO CLIENTE */
     SELECT SUM(TOTAL+DESC_ACRES), COUNT(PESSOA_FJ)
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND SELECIONADA = 'S' AND (( DUPLICATA = 0 ) OR ( DUPLICATA IS NULL))
     AND FECHADA = 'S' AND TIPO_VENDA = 'FFT' AND CANCELADA <> 'S'
     AND (( NUM_NF IS NULL ) OR ( NUM_NF = 0 ))
     INTO :SOMA, :NUMERO ;
     
     SUSPEND;
END
^

ALTER PROCEDURE SOMA_VENDAS_FRMPAGTO_AGRUPADAS (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
     FOR SELECT SUM(VALOR_ORIGINAL), SUM(JUROS), TIPO_PAGTO
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DT_CAIXA AND USUARIO_CAIXA = :USR_CAIXA
     AND CONTA_CAIXA = :CNTA_CAIXA AND TURNO = :TURNO
     GROUP BY TIPO_PAGTO
     INTO
         :VALOR_ORIGINAL,
         :JUROS,
         :TIPO_PAGTO
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE SOMA_VENDAS_FRMPAGTO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
     FOR SELECT SUM(VALOR_ORIGINAL), SUM(JUROS), TIPO_PAGTO
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     GROUP BY TIPO_PAGTO
     INTO
         :VALOR_ORIGINAL,
         :JUROS,
         :TIPO_PAGTO
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE SP_FORMAT_FLOAT (
    VALOR VARCHAR(30))
RETURNS (
    SAI VARCHAR(30))
AS
DECLARE VARIABLE TAMANHO INTEGER;
begin
  /* Procedure Text */
  /*tamanho da string*/
  select * from getlength(:valor) into :tamanho;

  /*'0.00' - unidade*/
  if (:tamanho = 4) then
    sai = substring(:valor from 1 for 1)||','||substring(:valor from 3 for 2);
  else if (:tamanho = 5) then /*'00.00' - dezena*/
    sai = substring(:valor from 1 for 2)||','||substring(:valor from 4 for 2);
  else if (:tamanho = 6) then /*'000.00' - centena*/
    sai = substring(:valor from 1 for 3)||','||substring(:valor from 5 for 2);
  else if (:tamanho = 7) then /*'0000.00' - unidade milhar*/
    sai = substring(:valor from 1 for 1)||'.'||substring(:valor from 2 for 3)||','||substring(:valor from 6 for 2);
  else if (:tamanho = 8) then /*'00 000.00' - dezena milhar*/
    sai = substring(:valor from 1 for 2)||'.'||substring(:valor from 3 for 3)||','||substring(:valor from 7 for 2);
  else if (:tamanho = 9) then /*'000 000.00' - centena milhar*/
    sai = substring(:valor from 1 for 3)||'.'||substring(:valor from 4 for 3)||','||substring(:valor from 8 for 2);
  else if (:tamanho = 10) then /*'0 000 000.00' - unidade milhao*/
    sai = substring(:valor from 1 for 1)||'.'||substring(:valor from 2 for 3)||'.'||substring(:valor from 5 for 3)||','||substring(:valor from 9 for 2);
  else if (:tamanho = 11) then /*'00 000 000.00' - dezena milhao*/
    sai = substring(:valor from 1 for 2)||'.'||substring(:valor from 3 for 3)||'.'||substring(:valor from 6 for 3)||','||substring(:valor from 10 for 2);
  else if (:tamanho = 12) then /*'000 000 000.00' - centena milhao*/
    sai = substring(:valor from 1 for 3)||'.'||substring(:valor from 4 for 3)||'.'||substring(:valor from 7 for 3)||','||substring(:valor from 11 for 2);
  suspend;
END
^

ALTER PROCEDURE SP_SUBSTRING (
    SRC VARCHAR(255) CHARACTER SET ISO8859_1,
    START_AT INTEGER,
    NLEN INTEGER)
RETURNS (
    RESULT VARCHAR(255) CHARACTER SET ISO8859_1)
AS
DECLARE VARIABLE POS INTEGER;
DECLARE VARIABLE PFX VARCHAR(255) CHARACTER SET ISO8859_1;
DECLARE VARIABLE C CHAR(1) CHARACTER SET ISO8859_1;
BEGIN

  IF ( START_AT <= 0 ) THEN START_AT = 1;
  IF ( START_AT > 255 ) THEN START_AT = 255;

  IF ( NLEN > 255 ) THEN NLEN = 255;
  IF ( NLEN < 1 OR NLEN IS NULL ) THEN NLEN = 1;


  RESULT = '';
  PFX = SRC;
  POS = 1;

   IF ( START_AT > 1 ) THEN
   BEGIN
     POS = 1;
     WHILE ( POS < START_AT ) DO
     BEGIN
       POS = :POS + 1;
       PFX = substring(PFX from 2 for 999);
     END
   END

   POS = START_AT;
   WHILE ( POS < NLEN + START_AT ) DO
   BEGIN
       POS = :POS + 1;
       c = substring(PFX FROM 1 FOR 1);
       RESULT = RESULT || C ;
       PFX = substring(PFX from 2 for 999);
   END
   SUSPEND;
END
^

ALTER PROCEDURE STRREPLACE (
    TEXTO VARCHAR(255) CHARACTER SET ISO8859_1,
    SEARCH CHAR(1),
    REPLACE CHAR(1))
RETURNS (
    RETORNO VARCHAR(255))
AS
DECLARE VARIABLE TEMPSTRING VARCHAR(255) CHARACTER SET ISO8859_1;
DECLARE VARIABLE CARACTER CHAR(1);
DECLARE VARIABLE TAMANHO INTEGER;
BEGIN
  TAMANHO = 0;
  TEMPSTRING = SUBSTRING(TEXTO FROM 1 FOR 255);
  retorno = '';
  IF (TEXTO > '') THEN
    WHILE ((:TAMANHO < 255) AND (:TEMPSTRING <> '')) DO
    BEGIN
      caracter = UPPER(SUBSTRING(TEMPSTRING FROM 1 FOR 1));
      if ( :caracter = (:search||' ') ) then
      begin
        if (:replace <> '') then
          retorno = (:retorno||:replace);
      end
      else
        retorno = (:retorno||:caracter);

      TAMANHO = :TAMANHO + 1;
      TEMPSTRING = SUBSTRING(TEMPSTRING FROM 2 FOR 255);
    END
    SUSPEND;
END
^

ALTER PROCEDURE TRANSFERE_NOTA_ENTRE_CLIENTE (
    CNPJ VARCHAR(14),
    VENDA INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE FAT_VENDAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA ;
END
^

ALTER PROCEDURE TRANSFERE_NOTAFATURA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    FATURA INTEGER,
    DESTINO INTEGER)
AS
DECLARE VARIABLE CODIGO_VENDA INTEGER;
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE SOMA NUMERIC(18,4);
begin
     /* SELECIONA O CLIENTE DO DESTINO */
     SELECT PESSOA_FJ
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND CODIGO = :DESTINO
     INTO :PESSOA_FJ ;

     /* SELECIONA A VENDA */
     SELECT CODIGO_VN FROM  FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO
     INTO :CODIGO_VENDA ;

     IF ( CODIGO_VENDA IS NULL ) /* O CONTAS A RECEBER FOI LANCADO MANUALMENTE */
     THEN BEGIN
          /* ALTERA O CONTAS A RECEBER */
          UPDATE FIN_CONTAS_RECEBER SET FATURA = :DESTINO, PESSOA_FJ = :PESSOA_FJ
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO;
     END
     ELSE BEGIN /* O CONTAS A RECEBER FOI LANCADO PELAS VENDAS */
          /* VERIFICA A VENDA SE É UMA FATURA FUTURA */
          UPDATE FAT_VENDAS
          SET PESSOA_FJ = :PESSOA_FJ, DUPLICATA = :DESTINO
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_VENDA ;

          /* ALTERA O CONTAS A RECEBER */
          UPDATE FIN_CONTAS_RECEBER SET FATURA = :DESTINO, PESSOA_FJ = :PESSOA_FJ
          WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND ANO = :ANO;
     END

     /* RECALCULA A ORIGEM */
     SELECT SOMA FROM  RECALCULA_FATURA ( :CNPJ, :FATURA  )
     INTO :SOMA ;

     /* RECALCULA O DESTINO */
     SELECT SOMA FROM  RECALCULA_FATURA ( :CNPJ, :DESTINO )
     INTO :SOMA ;
END
^

ALTER PROCEDURE TRANSFERIR_ATIVIDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE GLO_PESSOAS_FJ
     SET ATIVIDADE = :DESTINO
     WHERE CNPJ = :CNPJ AND ATIVIDADE = :ORIGEM ;

     DELETE FROM GLO_ATIVIDADES
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;
END
^

ALTER PROCEDURE TRANSFERIR_BAIRRO (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE GLO_PESSOAS_FJ
     SET BAIRRO = :DESTINO
     WHERE CNPJ = :CNPJ AND BAIRRO = :ORIGEM ;

     UPDATE GLO_PROPRIEDADES
     SET BAIRRO = :DESTINO
     WHERE CNPJ = :CNPJ AND BAIRRO = :ORIGEM ;

     DELETE FROM GLO_BAIRROS
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;
END
^

ALTER PROCEDURE TRANSFERIR_CIDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE CRG_ROTAS_CIDADES
     SET CIDADE = :DESTINO
     WHERE CNPJ = :CNPJ AND CIDADE = :ORIGEM ;

     UPDATE GLO_PESSOAS_FJ
     SET CIDADE = :DESTINO
     WHERE CNPJ = :CNPJ AND CIDADE = :ORIGEM ;

     UPDATE GLO_PROPRIEDADES
     SET CIDADE = :DESTINO
     WHERE CNPJ = :CNPJ AND CIDADE = :ORIGEM ;

     DELETE FROM GLO_CIDADES
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;
END
^

ALTER PROCEDURE TRANSFERIR_LOGRADOURO (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE GLO_PESSOAS_FJ
     SET ENDERECO = :DESTINO
     WHERE CNPJ = :CNPJ AND ENDERECO = :ORIGEM ;

     UPDATE GLO_PROPRIEDADES
     SET ENDERECO = :DESTINO
     WHERE CNPJ = :CNPJ AND ENDERECO = :ORIGEM ;

     DELETE FROM GLO_LOGRADOUROS
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;
END
^

ALTER PROCEDURE TRANSFERIR_PESSOA_FJ (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER)
AS
begin
     UPDATE CRG_MOTORISTAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE act_acertoconta act
     SET act.pessoa_recibo = :DESTINO
     WHERE CNPJ = :CNPJ AND act.pessoa_recibo = :ORIGEM ;


     /* CRIAR UMA NOTA DE ENTRADA IDENTICA A DE ORIGEM PARA O DESTINO */
     UPDATE EST_ENTRADAS_ITENS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE est_entradas_faturamento
     SET PESSOA_FJ = :DESTINO, COD_CREDOR = :destino
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;


     UPDATE EST_ENTRADAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE EST_KARDEX
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE EST_TRANSPORTADORES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_CAIXAS_MOVIMENTOS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_COTACOES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_CUPOM
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_NOTAS_PRAZO
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_ORCAMENTOS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FAT_TERCEIROS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE fat_vendedor
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     update fat_vendas_itens_comissoes
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE CM2_COMISSAO_PARC
     SET COD_PESSOA = :DESTINO
     WHERE CNPJ = :CNPJ AND COD_PESSOA = :ORIGEM ;

     UPDATE FAT_VENDAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_ANALISE_CUSTO
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_BAIXAS_PAGAR
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_BAIXAS_RECEBER
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_CHEQUES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_COBRANCAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_CONTAS_PAGAR
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_CONTAS_RECEBER
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_FATURAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE FIN_CHEQUES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE GLO_CONTAS_PESSOAS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE GLO_INDICACOES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE GLO_PRECOS_ESPECIAIS
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     UPDATE GLO_PROPRIEDADES
     SET PESSOA_FJ = :DESTINO
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     /* APAGANDO CLIENTE E FORNECEDOR */
     DELETE FROM GLO_CLIENTES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     DELETE FROM GLO_FORNECEDORES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :ORIGEM ;

     update ofc_ordem_servico os set os.cod_contato = :destino
     where os.cnpj = :cnpj and os.cod_contato = :origem ;

     DELETE FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :ORIGEM ;
END
^

ALTER PROCEDURE TRANSFERIR_PRODUTO (
    CNPJ CHAR(14),
    ORIGEM VARCHAR(15),
    DESTINO VARCHAR(15))
AS
DECLARE VARIABLE QUANTIDADE_FIS NUMERIC(18,4);
DECLARE VARIABLE QUANTIDADE_FISC NUMERIC(18,4);
DECLARE VARIABLE NDOCTO VARCHAR(20);
DECLARE VARIABLE PESSOA_FJ INTEGER;
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE UNIDADE CHAR(4);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO NUMERIC(18,5);
DECLARE VARIABLE PERC_LUCRO NUMERIC(12,2);
DECLARE VARIABLE PRC_VENDA NUMERIC(18,4);
DECLARE VARIABLE PRC_VENDA_ANT NUMERIC(18,4);
DECLARE VARIABLE PRC_CUSTO NUMERIC(18,4);
DECLARE VARIABLE ICM NUMERIC(18,4);
DECLARE VARIABLE ICM_SUBS NUMERIC(18,4);
DECLARE VARIABLE IPI NUMERIC(18,4);
DECLARE VARIABLE IPI_PRODUTO NUMERIC(18,4);
DECLARE VARIABLE TAXAS NUMERIC(18,4);
DECLARE VARIABLE DESCONTOS NUMERIC(18,4);
DECLARE VARIABLE EMBALAGEM NUMERIC(18,4);
DECLARE VARIABLE FRETE NUMERIC(18,4);
DECLARE VARIABLE SEGURO NUMERIC(18,4);
DECLARE VARIABLE NOME_PRODUTO VARCHAR(50);
DECLARE VARIABLE SUBUNIDADE INTEGER;
DECLARE VARIABLE LOTE INTEGER;
DECLARE VARIABLE CTE INTEGER;
DECLARE VARIABLE CTIE INTEGER;
DECLARE VARIABLE CODIGO_INTERNO INTEGER;
DECLARE VARIABLE CONVERSAO NUMERIC(18,4);
DECLARE VARIABLE PRC_UNITARIO_DOLAR NUMERIC(18,5);
DECLARE VARIABLE ORDEM INTEGER;
DECLARE VARIABLE SECUNDARIO VARCHAR(15);
DECLARE VARIABLE CFOP INTEGER;
begin
     /*pegando o có
     select codigo from est_produtos
     where codigo_interno = cast(:origem as integer) and cnpj = :cnpj
     into :origem;

     select codigo from est_produtos
     where codigo_interno = cast(:destino as integer) and cnpj = :cnpj
     into :destino; */

     /*descobrindo a qtde de estoque do produto a ser trasnferido*/
     select coalesce(p.qtdade_1,0), coalesce(p.qtdade_2,0)
     from est_produtos p
     where codigo = :origem and cnpj = :cnpj
     into quantidade_fisc, quantidade_fis ;

     /*----------------------- modificando os dados das tabels  para o novo produto--------------------------------*/
     /*Tabela de Alterações de produtos*/
     update est_alteraprecos_produtos p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     /*Tabela de Contagem de Produtos
     update est_contagem_produtos p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     /*Tabela de Itens de Entrada
     update est_entradas_itens p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     /*Achando os produtos a serem substituidos
     for select ndocto,pessoa_fj,produto,unidade,quantidade,prc_unitario,perc_lucro,
           prc_venda,prc_venda_ant,prc_custo,icm,icm_subs,ipi,ipi_produto,taxas,descontos,
           embalagem,frete,seguro,nome_produto,subunidade,lote,cte,ctie,codigo_interno,
           conversao,prc_unitario_dolar,ordem,secundario,cfop from est_entradas_itens
           where produto = :origem and cnpj = :cnpj
     into :ndocto,:pessoa_fj,:produto,:unidade,:quantidade,:prc_unitario,:perc_lucro,
          :prc_venda,:prc_venda_ant,:prc_custo,:icm,:icm_subs,:ipi,:ipi_produto,:taxas,:descontos,
          :embalagem,:frete,:seguro,:nome_produto,:subunidade,:lote,:cte,:ctie,:codigo_interno,
          :conversao,:prc_unitario_dolar,:ordem,:secundario,:cfop
     do
     begin

       delete from est_entradas_itens eti
       where eti.cnpj = :cnpj and eti.ndocto = :ndocto and eti.pessoa_fj = :pessoa_fj and eti.produto = :produto;


       INSERT INTO EST_ENTRADAS_ITENS (CNPJ,NDOCTO,PESSOA_FJ,PRODUTO,UNIDADE,QUANTIDADE,PRC_UNITARIO,PERC_LUCRO,PRC_VENDA,PRC_VENDA_ANT,PRC_CUSTO,ICM,ICM_SUBS,IPI,IPI_PRODUTO,TAXAS,DESCONTOS,EMBALAGEM,FRETE,SEGURO,NOME_PRODUTO,SUBUNIDADE,LOTE,CTE,CTIE,CODIGO_INTERNO,CONVERSAO,PRC_UNITARIO_DOLAR,ORDEM,SECUNDARIO,CFOP)
       VALUES (:cnpj,:ndocto,:pessoa_fj,:destino,:unidade,:quantidade,:prc_unitario,:perc_lucro,
               :prc_venda,:prc_venda_ant,:prc_custo,:icm,:icm_subs,:ipi,:ipi_produto,:taxas,:descontos,
               :embalagem,:frete,:seguro,:nome_produto,:subunidade,:lote,:cte,:ctie,:codigo_interno,
               :conversao,:prc_unitario_dolar,:ordem,:secundario,:cfop);
     end*/


     /*Tabela de Produtos que estão para imprimir etiquetas*/
     update est_estiqueta_produto p
     set p.codigo = :destino
     where codigo = :origem and cnpj = :cnpj ;

     /*Tabela de Inventário*/
     update est_inventario p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     /*Tabela do relatório Kardex*/
     update est_kardex p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     /*Tabela das aplicações de Produtos*/
     update est_produtos_aplicacoes p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     update est_produtos_similares p
     set p.produto_a = :destino
     where produto_a = :origem and cnpj = :cnpj ;

     update est_produtos_similares p
     set p.produto_b = :destino
     where produto_b = :origem and cnpj = :cnpj ;

     update fat_orcamentos_itens p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     update fat_vendas_itens p
     set p.produto = :destino
     where produto = :origem and cnpj = :cnpj ;

     update fat_vendas_itens p
     set p.produtofis = :destino
     where produtofis = :origem and cnpj = :cnpj ;

     update est_produtos p
     set p.qtdade_1 = qtdade_1 + :quantidade_fisc,
     p.qtdade_2 = p.qtdade_2 + :quantidade_fis
     where codigo = :destino and cnpj = :cnpj  ;

     update ofc_contratos_itens c
     set c.cod_produto = :destino
     where c.cnpj = :cnpj and c.cod_produto = :origem;

     update glo_clientes_produtos cl
     set cl.cod_produto = :destino
     where cl.cnpj = :cnpj and cl.cod_produto = :origem;

     update ofc_ordem_servico os
     set os.produto = :destino
     where os.cnpj = :cnpj and os.produto = :origem;

     update ofc_ordem_servico_servico osi
     set osi.produto = :destino
     where osi.cnpj = :cnpj and osi.produto = :origem;

     delete from est_produtos
     where codigo = :origem and cnpj = :cnpj ;
END
^

ALTER PROCEDURE TRANSFERIR_PROPRIEDADE (
    CNPJ CHAR(14),
    ORIGEM INTEGER,
    DESTINO INTEGER,
    PORIGEM INTEGER,
    PDESTINO INTEGER)
AS
begin
  update fat_vendas vd set vd.pessoa_fj = :pdestino, vd.propriedade = :destino
  where vd.cnpj = :cnpj and vd.pessoa_fj = :porigem and vd.propriedade = :origem;

  delete from glo_propriedades pp where pp.cnpj = :cnpj and pp.pessoa_fj = :porigem and pp.propriedade = :origem;
END
^

ALTER PROCEDURE TROCA_CENTRO_PAGAR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    ANO INTEGER,
    CENTRO INTEGER)
AS
begin
     UPDATE FIN_BAIXAS_PAGAR
     SET CENTRO_CUSTO = :CENTRO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND
     ANO = :ANO   ;
END
^

ALTER PROCEDURE TROCA_PRODUTO_FISCAL (
    CNPJ CHAR(14),
    VENDA INTEGER,
    PRODUTO VARCHAR(15),
    FISCAL VARCHAR(15))
AS
begin
     /* TROCA O CODIGO DO PRODUTO FISCAL */
     UPDATE FAT_VENDAS_ITENS
     SET FAT_VENDAS_ITENS.PRODUTOFIS = :FISCAL
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA AND PRODUTO = :PRODUTO ;
END
^

ALTER PROCEDURE TROCAS_DIARIA_ENT (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            SUM(QUANTIDADE)
        FROM FAT_TROCAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND TIPO = 'E' AND
        PRODUTO = :PRODUTO
        INTO  :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE TROCAS_DIARIA_SAI (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT
            SUM(QUANTIDADE)
        FROM FAT_TROCAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND TIPO = 'S' AND
        PRODUTO = :PRODUTO
        INTO  :QUANTIDADE
        DO BEGIN
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE TROCO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    SALDO NUMERIC(18,4))
AS
DECLARE VARIABLE CONT INTEGER;
BEGIN
     IF ( TURNO = 1 )
     THEN BEGIN
          /* DATA DO CAIXA */
          DATA  = DATA - 1;

          /* ULTIMO TURNO */
          SELECT TURNO FROM ULTIMO_TURNO ( :CNPJ, :DATA )
          INTO :TURNO ;
     END
     ELSE BEGIN
          TURNO = TURNO - 1;
     END

     SELECT COUNT (*)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     DATA = :DATA AND
     TURNO = :TURNO
     INTO :CONT ;

     IF ( CONT IS NULL )
     THEN
         CONT = 0;

     IF ( CONT <= 0 )
     THEN BEGIN
          SELECT TROCO
          FROM FAT_CAIXAS
          WHERE CNPJ = :CNPJ AND
          DATA = :DATA AND
          TURNO = :TURNO
          INTO :SALDO ;
     END
     ELSE BEGIN
          SELECT TROCO
          FROM FAT_CAIXAS
          WHERE CNPJ = :CNPJ AND
          DATA = :DATA AND
          TURNO = :TURNO AND
          USUARIO = :USUARIO
          INTO :SALDO ;
     END

     SUSPEND;
END
^

ALTER PROCEDURE ULTIMA_CONTA (
    CONTA VARCHAR(15))
RETURNS (
    ULTIMACONTA VARCHAR(15))
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE LEN2 INTEGER;
BEGIN
     /*TAMANHO DA VARIAVEL*/
     ultimaconta = '';
     /*
     select * from getlength(:CONTA) into :len;
     IF (LEN = 0)
     THEN BEGIN
          LEN2 = 1;
     END

     IF (LEN = 1)
     THEN BEGIN
          LEN2 = 4;
     END

     IF (LEN = 4)
     THEN BEGIN
          LEN2 = 7;
     END

     IF (LEN = 7)
     THEN BEGIN
          LEN2 = 10;
     END

     IF (LEN = 10)
     THEN BEGIN
          LEN2 = 15;
     END

     IF (LEN = 15)
     THEN BEGIN
          LEN2 = 15;
     END

     IF ( LEN <> 0)
     THEN BEGIN
          Select max(UDF_COPY(Codigo, 1, :LEN2)) From CTB_PLANOCONTA
          Where UDF_COPY(Codigo, 1, :LEN) = :CONTA and  udf_length(CODIGO) = :LEN2
          INTO :ULTIMACONTA ;
     END
     ELSE BEGIN
          Select max(UDF_COPY(Codigo, 1, 1)) From CTB_PLANOCONTA
          INTO :ULTIMACONTA ;
     END*/
     SUSPEND;
END
^

ALTER PROCEDURE ULTIMA_DATA_CAIXA (
    CNPJ VARCHAR(20),
    D DATE)
RETURNS (
    DATA DATE)
AS
BEGIN
     SELECT MAX(DATA)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND FECHADO = 'S' AND DATA < :D
     INTO :DATA ;

     SUSPEND;
END
^

ALTER PROCEDURE ULTIMA_DUPLICATA (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
     /*ATUALIZA O NUMERO DO CUPOM*/
     SELECT DUPLICATA FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :CODIGO  ;
END
^

ALTER PROCEDURE ULTIMA_GRADE (
    CNPJ CHAR(14))
RETURNS (
    GRADE CHAR(4))
AS
BEGIN
      SELECT MAX(GRADE)
      FROM EST_PRODUTOS_GRADES
      WHERE CNPJ = :CNPJ
      INTO :GRADE ;

      IF ( GRADE IS NULL ) THEN
        GRADE = 'AAAA' ;

      SUSPEND ;
END
^

ALTER PROCEDURE ULTIMO_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    D DATE)
RETURNS (
    DATA DATE,
    TURNO INTEGER)
AS
DECLARE VARIABLE TURNOS INTEGER;
DECLARE VARIABLE USR_CAIXA_GERAL CHAR(1);
DECLARE VARIABLE CAIXA_EXPORADICO CHAR(1);
BEGIN
     SELECT ULTIMO_TURNO
     FROM SIS_EMPRESAS
     WHERE CNPJ = :CNPJ
     INTO :TURNOS ;

     SELECT USR_CAIXA_GERAL, CAIXA_EXPORADICO
     FROM FAT_USUARIOS_CAIXA
     WHERE CNPJ = :CNPJ AND USUARIO = :USUARIO AND CONTA = :CONTA
     INTO :USR_CAIXA_GERAL, :CAIXA_EXPORADICO ;

     IF (( TURNOS = 1 ) OR ( TURNOS IS NULL ))
     THEN BEGIN
          IF ( CAIXA_EXPORADICO = 'S' )
          THEN BEGIN
               SELECT CAST('today' AS DATE)
               FROM rdb$database
               INTO :DATA ;
          END
          ELSE BEGIN
               SELECT MAX(DATA)
               FROM FAT_CAIXAS
               WHERE CNPJ = :CNPJ AND
               USUARIO = :USUARIO AND
               CONTA = :CONTA
               INTO :DATA ;

               DATA = DATA + 1;
          END

          IF ( USR_CAIXA_GERAL = 'S' )
          THEN BEGIN
               TURNO = 99 ;
          END
     END
     ELSE BEGIN
          IF ( USR_CAIXA_GERAL = 'S' )
          THEN BEGIN
               IF ( CAIXA_EXPORADICO = 'S' )
               THEN BEGIN
                    SELECT CAST('today' AS DATE)
                    FROM rdb$database
                    INTO :DATA ;

                    SELECT MAX(TURNO)
                    FROM FAT_CAIXAS
                    WHERE
                    CNPJ = :CNPJ AND DATA = :D AND TURNO = 99
                    INTO :TURNO;
               END
               ELSE BEGIN
                    SELECT MAX(TURNO), MAX(DATA)
                    FROM FAT_CAIXAS
                    WHERE
                    CNPJ = :CNPJ AND DATA = :D AND TURNO = 99
                    INTO :TURNO, :DATA ;

                    DATA = DATA + 1;
               END
          END
          ELSE BEGIN
               SELECT MAX(TURNO)
               FROM FAT_CAIXAS
               WHERE
               CNPJ = :CNPJ AND DATA = :D AND TURNO <> 99
               INTO :TURNO ;

               DATA = :D ;
          END

          IF ( TURNO IS NULL )
          THEN BEGIN
               TURNO = 0;
          END

          IF (( TURNO = TURNOS ) OR ( USR_CAIXA_GERAL = 'S' ))
          THEN BEGIN
               TURNO = 99 ;
          END
     END

     SUSPEND;
END
^

ALTER PROCEDURE ULTIMO_CAIXA_FECHADO (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER)
RETURNS (
    DATA DATE)
AS
BEGIN
     SELECT MAX(DATA)
     FROM FAT_CAIXAS
     WHERE CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND FECHADO = 'S'

     INTO :DATA ;

     SUSPEND;
END
^

ALTER PROCEDURE ULTIMO_CHEQUE (
    CNPJ VARCHAR(14),
    CONTA INTEGER)
RETURNS (
    CHEQUE INTEGER)
AS
BEGIN
     Select ULTIMO_CHEQUE From CTB_PLANOCONTA
     Where CONTA = :CONTA and  CNPJ = :CNPJ
     INTO :CHEQUE ;

     SUSPEND;
END
^

ALTER PROCEDURE ULTIMO_TURNO (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    TURNO INTEGER)
AS
BEGIN
     DATA = DATA - 1;

     SELECT MAX(TURNO)
     FROM FAT_CAIXAS
     WHERE
     CNPJ = :CNPJ AND DATA = :DATA
     INTO :TURNO ;

     SUSPEND;
END
^

ALTER PROCEDURE VALIDA_CLIENTE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    UF CHAR(2),
    COD_VEND INTEGER,
    COD_FPAGTO INTEGER,
    REQUISICAO CHAR(1),
    DIA_PREF_FAT INTEGER,
    LIMITE_TEMPO INTEGER,
    LIMITE_CREDITO NUMERIC(18,4),
    CLASSIF CHAR(1),
    BLOQUEADO CHAR(1),
    CPF_CNPJ VARCHAR(15),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBS2 BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ASSINA_NOTA CHAR(1),
    CONTROLA_PLACA CHAR(1),
    CONTROLA_KM CHAR(1),
    NAO_COBR_JUR_ATE FLOAT,
    TAXA_JUROS FLOAT,
    CLASSIFICACAO INTEGER,
    VALOR_MAXIMO_RETIRADA FLOAT,
    LIMITE_DIARIO_RETIRADA FLOAT,
    ALIQUOTA_DESCONTO FLOAT,
    CONS_REV CHAR(1),
    SENHA_PDV VARCHAR(6))
AS
BEGIN
     Select Pessoa_Fj, Cod_Vend, Cod_FPagto, Requisicao,
     Dia_Pref_Fat, Limite_Tempo, Limite_Credito,
     Classif, Bloqueado, Obs, Cod_classif,
     Controla_placa, Controla_Km, Assina_Nota, Nao_Cobr_Jur_Ate, Taxa_Juros,
     VALOR_MAXIMO_RETIRADA, LIMITE_RETIRADAS_DIARIA,
     ALIQUOTA_DESCONTO, CONS_REV, SENHA_PDV
     from Glo_Clientes
     Where Pessoa_Fj = :CODIGO and CNPJ = :CNPJ
     INTO :Pessoa_Fj, :Cod_Vend, :Cod_FPagto, :Requisicao,
     :Dia_Pref_Fat, :Limite_Tempo, :Limite_Credito,
     :Classif, :Bloqueado, :Obs, :Classificacao ,
     :Controla_placa, :Controla_Km, :Assina_Nota, :Nao_Cobr_Jur_Ate, :Taxa_Juros,
     :VALOR_MAXIMO_RETIRADA, :LIMITE_DIARIO_RETIRADA, :ALIQUOTA_DESCONTO, :cons_rev,
     :SENHA_PDV ;


     Select codigo, Nome_Razao, Obs, CPF_CGC, UF
     from Glo_Pessoas_Fj
     Where  Codigo = :CODIGO and CNPJ = :CNPJ
     INTO :pessoa_fj, :Nome, :Obs2, :CPF_CNPJ, :UF;

     SUSPEND;
END
^

ALTER PROCEDURE VALIDA_CONVENIO (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    CODIGO INTEGER)
RETURNS (
    NOME VARCHAR(50))
AS
BEGIN
     SELECT NOME_RAZAO
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND CONVENIO = :PESSOA_FJ
     ORDER BY CNPJ, CODIGO
     INTO :NOME;

     SUSPEND;
END
^

ALTER PROCEDURE VALIDA_CPF_CNPJ (
    CNPJ VARCHAR(14),
    CAMPO VARCHAR(14))
RETURNS (
    VALIDO CHAR(1))
AS
DECLARE VARIABLE ACHOU INTEGER;
begin
     SELECT COUNT(CPF_CGC) FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CPF_CGC = :CAMPO
     INTO :ACHOU ;

     IF (( ACHOU IS NULL ) OR ( ACHOU = 0 ))
     THEN BEGIN
          VALIDO = 'S';
     END
     ELSE BEGIN
          VALIDO = 'N';
     END

     suspend;
END
^

ALTER PROCEDURE VALIDA_FORNECEDOR (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CONTABILIDADE INTEGER,
    UF CHAR(2))
AS
BEGIN
     Select Pessoa_Fj, Contabilidade
     from Glo_Fornecedores
     Where Pessoa_Fj = :CODIGO and CNPJ = :CNPJ
     INTO :Pessoa_Fj, :Contabilidade ;
     
     Select Nome_Razao, UF
     from Glo_Pessoas_Fj
     Where Codigo = :Pessoa_fj and CNPJ = :CNPJ
     INTO :Nome, UF;
     
     SUSPEND;
END
^

ALTER PROCEDURE VALIDA_PESSOA_FJ (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    NOME VARCHAR(50),
    UF CHAR(2),
    CPF_CNPJ VARCHAR(15),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    OBS2 BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CLASSIFICACAO INTEGER)
AS
BEGIN
     SELECT NOME_RAZAO, UF, CPF_CGC, OBS
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :NOME, :UF, :CPF_CNPJ, :OBS ;

     Select Obs, Cod_classif
     from Glo_Clientes
     Where Pessoa_Fj = :CODIGO and CNPJ = :CNPJ
     INTO :Obs2, :Classificacao ;

     SUSPEND;
END
^

ALTER PROCEDURE VALIDA_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15),
    VENDEDOR INTEGER)
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    VALIDA_MULT_QTDE_MIN CHAR(1),
    PRC_VENDA NUMERIC(18,4),
    VENCTO_PRC_VENDA DATE,
    PRC_CUSTO_MED NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO CHAR(1),
    ALIQUOTA_ECF CHAR(5),
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    NEG_QTDADE_2 CHAR(1),
    SUBUNIDADE INTEGER,
    COMPLEMENTO_NF CHAR(1),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    IPI NUMERIC(18,4),
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1),
    MARCA VARCHAR(50),
    MARGEM_BRUTA NUMERIC(18,4),
    QTDADE_CONVERSAO NUMERIC(18,4),
    SERVICO CHAR(1),
    SECUNDARIO VARCHAR(15),
    COMPLEMENTO VARCHAR(100),
    PERC_FRETE NUMERIC(18,4),
    QNTDE_MINIMA_VENDA NUMERIC(18,4),
    UND_PRIMARIA CHAR(4),
    FATOR_CONVERSAO FLOAT)
AS
DECLARE VARIABLE COD_MARCA INTEGER;
DECLARE VARIABLE EXIBE_TBL CHAR(1);
BEGIN
  select coalesce(e.exibe_tbl,'N') from sis_empresas e
  where e.cnpj = :cnpj
  into :exibe_tbl;

     Select PRC_REPOS,
            PRC_VENDA,
            Volume,
            Peso_Liq,
            Unidade,
            NOME,
            ATIVO,
            ALIQUOTA_ECF,
            QTDADE_1,
            QTDADE_2,
            SUBUNIDADE,
            ORIGEM,
            CTE,
            CTIE,
            REDUCAO,
            IPI,
            MARGEM_BRUTA,
            VENDE_FRACIONADO,
            POSSUI_LOTE,
            COMPLEMENTO_NF,
            MARCA,
            NEG_QTDADE_2,
            SERVICO,
            CODIGO_2,
            COMPLEMENTO,
            PERC_FRETE,
            VALIDA_MULT_QTDE_MIN,
            qntde_minima_venda,
            UND_PRIMARIA,
            FATOR_CONVERSAO,
            prd.PRC_CUSTO_MED, prd.VENCTO_PRC_VENDA
     from est_produtos prd
     where codigo = :produto and cnpj = :cnpj
     order by cnpj, codigo
     into
         :PRC_REPOS,
         :PRC_VENDA,
         :Volume,
         :Peso_Liq,
         :Unidade,
         :NOME,
         :ATIVO,
         :ALIQUOTA_ECF,
         :QTDADE_1,
         :QTDADE_2,
         :SUBUNIDADE,
         :ORIGEM,
         :CTE,
         :CTIE,
         :REDUCAO,
         :IPI,
         :MARGEM_BRUTA,
         :VENDE_FRACIONADO,
         :POSSUI_LOTE,
         :COMPLEMENTO_NF,
         :COD_MARCA,
         :NEG_QTDADE_2,
         :SERVICO,
         :SECUNDARIO,
         :COMPLEMENTO,
         :PERC_FRETE,
         :VALIDA_MULT_QTDE_MIN,
         :qntde_minima_venda,
         :und_primaria,
         :fator_conversao,
         :PRC_CUSTO_MED,
         :VENCTO_PRC_VENDA;

     select nome from est_marcas
     where cnpj = :cnpj and codigo = :cod_marca
     into :marca ;

     select unidades from est_unidades
     where cnpj = :cnpj and sigla = :unidade
     into :qtdade_conversao ;

     if ((exibe_tbl = 'S') and (coalesce(:VENDEDOR,0) > 0 )) then
     begin
       prc_venda = null;
       select itbl.valor from fat_itemtabelapreco itbl
       inner join fat_tabelapreco tbl on (tbl.cnpj = itbl.cnpj and itbl.cod_tabelapreco = tbl.codigo)
       /*vinculando TabelaPreco-->TabelaN<---Vendedor*/
       inner join fat_tbl_vd_tabela tvdt on (tvdt.cnpj = tbl.cnpj and tvdt.cod_tabela = tbl.codigo)
       inner join fat_tbl_vendedor tvd on (tvd.cnpj = tvdt.cnpj and tvd.codigo = tvdt.cod_tbl_vendedor)
       inner join est_produtos prd on (prd.cnpj = itbl.cnpj and prd.codigo = itbl.produto)
       where  itbl.produto = :produto and tvd.cod_vendedor = :vendedor and itbl.cnpj = :cnpj
       and (current_date between tbl.iniciovigencia and tbl.fimvigencia)
       and (current_date between itbl.datainiciovigencia and itbl.datafimvigencia)
       into :prc_venda;

       if (:prc_venda is null) then
         exception VALIDA_PRD_ITEM_TBL;
     end


     SUSPEND;

END
^

ALTER PROCEDURE VALIDA_PRODUTO_SECUNDARIO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    PRC_REPOS NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO_LIQ NUMERIC(18,4),
    UNIDADE VARCHAR(4),
    NOME VARCHAR(50),
    ATIVO CHAR(1),
    ALIQUOTA_ECF CHAR(5),
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    NEG_QTDADE_2 CHAR(1),
    SUBUNIDADE INTEGER,
    COMPLEMENTO_NF CHAR(1),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    IPI INTEGER,
    VENDE_FRACIONADO CHAR(1),
    POSSUI_LOTE CHAR(1),
    MARCA VARCHAR(50),
    MARGEM_BRUTA NUMERIC(18,4),
    QTDADE_CONVERSAO NUMERIC(18,4),
    SERVICO CHAR(1),
    SECUNDARIO VARCHAR(15))
AS
DECLARE VARIABLE COD_MARCA INTEGER;
BEGIN
     Select PRC_REPOS, PRC_VENDA, Volume, Peso_Liq,
     Unidade, NOME, ATIVO, ALIQUOTA_ECF, QTDADE_1, QTDADE_2,
     SUBUNIDADE, ORIGEM, CTE, CTIE, REDUCAO, IPI, MARGEM_BRUTA,
     VENDE_FRACIONADO, POSSUI_LOTE, COMPLEMENTO_NF, MARCA, NEG_QTDADE_2,
     SERVICO, CODIGO
     From Est_Produtos
     Where Codigo_2 = :PRODUTO and CNPJ = :CNPJ
     ORDER BY CNPJ, CODIGO_2
     INTO
         :PRC_REPOS, :PRC_VENDA, :Volume, :Peso_Liq,
         :Unidade, :NOME, :ATIVO, :ALIQUOTA_ECF, :QTDADE_1, :QTDADE_2,
         :SUBUNIDADE, :ORIGEM, :CTE, :CTIE, :REDUCAO, :IPI, :MARGEM_BRUTA,
         :VENDE_FRACIONADO, :POSSUI_LOTE, :COMPLEMENTO_NF, :COD_MARCA, :NEG_QTDADE_2,
         :SERVICO, :SECUNDARIO ;

     SELECT NOME FROM EST_MARCAS
     WHERE CNPJ = :CNPJ AND CODIGO = :COD_MARCA
     INTO :MARCA ;

     SELECT UNIDADES FROM EST_UNIDADES
     WHERE CNPJ = :CNPJ AND SIGLA = :UNIDADE
     INTO :QTDADE_CONVERSAO ;

     SUSPEND;
END
^

ALTER PROCEDURE VALOR_SERVICO_MOTOR (
    CNPJ CHAR(14),
    MOTOR INTEGER,
    SERVICO INTEGER)
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
      SELECT VALOR
      FROM OFC_MOTORES_SERVICOS
      WHERE CNPJ = :CNPJ AND MOTOR = :MOTOR AND SERVICO = :SERVICO
      INTO :VALOR ;

      SUSPEND;
END
^

ALTER PROCEDURE VENDA_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT QUANTIDADE
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :QUANTIDADE
        DO BEGIN
           SUSPEND ;
        END
     END
END
^

ALTER PROCEDURE VENDAS_DIARIA (
    CNPJ CHAR(14),
    DATA DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     PLAN (FAT_VENDAS ORDER FAT_VENDAS_CAIXA)
     ORDER BY CNPJ, DATA_CAIXA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT QUANTIDADE
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        AND PRODUTO = :PRODUTO
        ORDER BY CNPJ, CODIGO, PRODUTO
        INTO :QUANTIDADE
        DO BEGIN
           SUSPEND ;
        END
     END
END
^

ALTER PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
     FOR SELECT SUM(VALOR_ORIGINAL), SUM(JUROS), TIPO_PAGTO
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     GROUP BY TIPO_PAGTO
     INTO
         :VALOR_ORIGINAL,
         :JUROS,
         :TIPO_PAGTO
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS_CAIXA (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
     FOR SELECT SUM(VALOR_ORIGINAL), SUM(JUROS), NOME_FORMA
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DT_CAIXA AND USUARIO_CAIXA = :USR_CAIXA
     AND CONTA_CAIXA = :CNTA_CAIXA AND TURNO = :TURNO
     GROUP BY NOME_FORMA
     INTO
         :VALOR_ORIGINAL,
         :JUROS,
         :TIPO_PAGTO
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VENDAS_FRMPAGTO_AGRUPADAS_GERAL (
    CNPJ CHAR(14),
    DT_CAIXA DATE)
RETURNS (
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30))
AS
BEGIN
     FOR SELECT SUM(VALOR_ORIGINAL), SUM(JUROS), NOME_FORMA
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND
     DATA_CAIXA = :DT_CAIXA
     GROUP BY NOME_FORMA
     INTO
         :VALOR_ORIGINAL,
         :JUROS,
         :TIPO_PAGTO
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VENDAS_MENSAIS (
    CNPJ CHAR(14),
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :INICIAL AND DATA_CAIXA <= :FINAL
     PLAN (FAT_VENDAS ORDER FAT_VENDAS_CAIXA)
     ORDER BY CNPJ, DATA_CAIXA
     INTO :CODIGO
     DO BEGIN
        FOR SELECT QUANTIDADE, PRODUTO
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :QUANTIDADE, :PRODUTO
        DO BEGIN
           SUSPEND ;
        END
     END
END
^

ALTER PROCEDURE VENDAS_PERIODO_PRODUTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE SOMA NUMERIC(18,4);
BEGIN
     QUANTIDADE = 0;

     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM
     AND FECHADA = 'S'
     INTO :CODIGO
     DO BEGIN
        FOR SELECT SUM(QUANTIDADE)
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO
        INTO :SOMA
        DO BEGIN
           IF ( SOMA IS NULL )
           THEN
              SOMA = 0;

           QUANTIDADE = QUANTIDADE + SOMA ;
        END
     END

     SUSPEND ;
END
^

ALTER PROCEDURE VER_ANALISE_CUSTOS (
    CNPJ CHAR(14),
    VENDA INTEGER,
    NOVO NUMERIC(18,4))
RETURNS (
    CODIGO INTEGER,
    PESSOA INTEGER,
    TOTAL NUMERIC(18,4),
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_2 NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    NOME VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    MARGEM NUMERIC(18,4),
    MARGEM_2 NUMERIC(18,4))
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE DIFERENCA NUMERIC(18,4);
DECLARE VARIABLE INDICE NUMERIC(18,4);
BEGIN
     SOMA = 0;

     FOR SELECT
     QUANTIDADE, CUSTO, UNITARIO
     FROM FIN_ANALISE_CUSTO_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA
     ORDER BY CNPJ, CODIGO
     INTO :QUANTIDADE, :PRC_CUSTO, :PRC_UNITARIO
     DO BEGIN
        /* SOMA TOTAL */
        SOMA = :SOMA + ( :QUANTIDADE * :PRC_UNITARIO );
     END

     IF ( SOMA > NOVO )
     THEN BEGIN
          /* MARGEM MENOR */
          DIFERENCA = SOMA - NOVO ;

          IF ( SOMA > 0 )
          THEN BEGIN
               INDICE = :DIFERENCA * 100 / SOMA ;
          END
          ELSE BEGIN
               INDICE = 0;
          END
     END
     ELSE BEGIN
          /* MARGEM MENOR */
          DIFERENCA = SOMA - NOVO ;

          IF ( SOMA > 0 )
          THEN BEGIN
               INDICE = :DIFERENCA * 100 / SOMA ;
          END
          ELSE BEGIN
               INDICE = 0;
          END
     END

     FOR SELECT CODIGO, PESSOA_FJ, TOTAL, NOME, DATA
     FROM FIN_ANALISE_CUSTO
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA
     ORDER BY CNPJ, CODIGO
     INTO :CODIGO, :PESSOA, :TOTAL, :NOME, :DATA
     DO BEGIN
        FOR SELECT
        PRODUTO, QUANTIDADE, CUSTO, NOME, UNITARIO
        FROM FIN_ANALISE_CUSTO_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :PRODUTO, :QUANTIDADE, :PRC_CUSTO, :NOME_PRODUTO, :PRC_UNITARIO
        DO BEGIN
           IF ( :PRC_CUSTO > 0 )
           THEN BEGIN
                MARGEM = ( :PRC_UNITARIO - :PRC_CUSTO ) / :PRC_CUSTO * 100;
           END
           ELSE BEGIN
                MARGEM = 100;
           END

           /* APLICANDO INDICE */
           IF ( NOVO > 0 )
           THEN BEGIN
                PRC_UNITARIO_2 = :PRC_UNITARIO - ( :PRC_UNITARIO * :INDICE ) / 100 ;

                IF ( PRC_CUSTO > 0 )
                THEN BEGIN
                     MARGEM_2 = ( :PRC_UNITARIO_2 - :PRC_CUSTO ) / :PRC_CUSTO * 100;
                END
                ELSE BEGIN
                     MARGEM_2 = 100 ;
                END
           END
           ELSE BEGIN
                MARGEM_2 = :MARGEM ;
           END

           SUSPEND ;
        END
     END
END
^

ALTER PROCEDURE VER_BAIXA_NOTAS_FATURAS (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO, CODIGO_VN, ANO_VN,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM,
            AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA, TURNO
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA AND USUARIO = :USUARIO AND TURNO = :TRN
     AND ( FATURA > 0 ) AND ORIGEM <> 'FFT'
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO, :CODIGO_VN, :ANO_VN,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM,
            :AVISO, :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA, :NUMBOLETO, :NUMDUPLICATA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :NOME, :CPF_CGC ;

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_NOTAS_FATURAS_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO, CODIGO_VN, ANO_VN,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM,
            AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA, TURNO
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA
     AND ( FATURA > 0 ) AND ORIGEM <> 'FFT'
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO, :CODIGO_VN, :ANO_VN,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM,
            :AVISO, :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA, :NUMBOLETO, :NUMDUPLICATA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :NOME, :CPF_CGC ;

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
DECLARE VARIABLE COD_ACERTOCONTA INTEGER;
DECLARE VARIABLE DATA_MOVTO_BC INTEGER;
DECLARE VARIABLE CTB_DT_AVISO_BANCARIO CHAR(1);
BEGIN
      select CTB_DT_AVISO_BANCARIO from sis_empresas e
     where e.cnpj = :cnpj
     into :CTB_DT_AVISO_BANCARIO;

     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO,
            COD_INDEXADOR,
            IDX_DATABASE ,
            IDX_COTACAO,
            IDX_QTDE,
            bx.cod_acertoconta
     FROM FIN_BAIXAS_PAGAR bx
     WHERE CNPJ = :CNPJ
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO,
            :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde, :COD_ACERTOCONTA
     DO BEGIN

        if (coalesce(ctb_dt_aviso_bancario,'N') = 'S') then
        begin
            select min(ctb.data_conciliacao) from ctb_movimento_contabil ctb
            where ctb.cod_acertoconta = :cod_acertoconta and ctb.cnpj = :cnpj
            into :DATA_MOVTO_BC;
    
              if (DATA_MOVTO_BC is not null) then
               dt_baixa = :DATA_MOVTO_BC;
        end

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END
        
        /* CENTRO DE CUSTO */
        SELECT NOME FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_BAIXA (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
DECLARE VARIABLE COD_ACERTOCONTA INTEGER;
DECLARE VARIABLE DATA_MOVTO_BC INTEGER;
DECLARE VARIABLE CTB_DT_AVISO_BANCARIO CHAR(1);
BEGIN
     select CTB_DT_AVISO_BANCARIO from sis_empresas e
     where e.cnpj = :cnpj
     into :CTB_DT_AVISO_BANCARIO;

     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS, VLR_BAIXA,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO,
            COD_INDEXADOR,
            IDX_DATABASE ,
            IDX_COTACAO,
            IDX_QTDE,
            bx.cod_acertoconta
     FROM FIN_BAIXAS_PAGAR bx
     WHERE CNPJ = :CNPJ AND DT_BAIXA >= :DINI AND DT_BAIXA <= :DFIM
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS, :VLR_BAIXA,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO, :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde,
            :COD_ACERTOCONTA
     DO BEGIN
        
        if (coalesce(ctb_dt_aviso_bancario,'N') = 'S') then
        begin
            select min(ctb.data_conciliacao) from ctb_movimento_contabil ctb
            where ctb.cod_acertoconta = :cod_acertoconta and ctb.cnpj = :cnpj
            into :DATA_MOVTO_BC;
    
            if ((DATA_MOVTO_BC is not null) AND (:ctb_dt_aviso_bancario = 'S')) then
               dt_baixa = :DATA_MOVTO_BC;
        end

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM,
            CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO
     FROM FIN_BAIXAS_PAGAR
     WHERE ( CNPJ = :CNPJ AND DT_BAIXA = :DATA
     AND USUARIO = :USUARIO AND TURNO = :TRN AND CONTA = :CONTA )
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :NOME, :CPF_CGC ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_GERAL (
    CNPJ CHAR(14),
    DATA DATE,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM,
            CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO
     FROM FIN_BAIXAS_PAGAR
     WHERE ( CNPJ = :CNPJ AND DT_BAIXA = :DATA AND CONTA = :CONTA )
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :NOME, :CPF_CGC ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_HISTORICO (
    CNPJ CHAR(14),
    CODIGO_PAGAR INTEGER,
    ANO_PAGAR INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS, VLR_BAIXA,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND CODIGO_PG = :CODIGO_PAGAR
     AND ANO_PG = :ANO_PAGAR
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS, :VLR_BAIXA,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_PG INTEGER,
    ANO_PG SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    VLR_PARCIAL NUMERIC(18,4),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, VLR_BAIXA, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI AND DT_LANCTO <= :DFIM
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :VLR_BAIXA, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_PAGAR_PESSOA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_PG INTEGER,
    ANO_PG INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS_PAG NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    PLANILHA INTEGER,
    ANO_ENT INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    AGRUPADOR INTEGER,
    NOME_AGRUPADOR VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    TURNO INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_PG, ANO_PG, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_PAG, DESCONTOS_PAG, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, CENTRO_CUSTO, DUPLICATA, CONFERIDA,
            TURNO
     FROM FIN_BAIXAS_PAGAR
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :COD
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_PG, :ANO_PG, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS_PAG, :BOLETO, :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA,
            :TURNO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;
        
        IF (AGRUPADOR > 0)
        THEN BEGIN
             /* CENTRO DE CUSTO */
             SELECT NOME FROM FIN_CENTRO_CUSTO
             WHERE CODIGO = :AGRUPADOR AND CNPJ = :CNPJ
             INTO :NOME_AGRUPADOR ;
        END
        
        /* CENTRO DE CUSTO */
        SELECT NOME FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4),
    NUM_NF INTEGER,
    NUM_CF INTEGER)
AS
BEGIN
     for select cnpj, codigo, ano, codigo_cr, ano_cr, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_baixa, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn, ano_vn, aviso,
            dt_aviso, dt_baixa, historico_bx, juros, descontos,
            planilha, taxa_juros, tipo_juros, numboleto, numduplicata, fatura,
            turno, COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     from fin_baixas_receber
     where cnpj = :cnpj
     into
            :cnpj, :codigo, :ano, :codigo_cr, :ano_cr, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_baixa, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
            :dt_aviso, :dt_baixa, :historico_bx, :juros, :descontos,
            :planilha, :taxa_juros, :tipo_juros, :numboleto, :numduplicata, :fatura,
            :turno, :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
     do begin
        num_cf = 0;
        num_nf = 0;

        select vd.num_cupom, vd.num_nf from fat_vendas vd where vd.codigo = :codigo_vn and vd.cnpj = :cnpj
        into :num_cf, :num_nf;

        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_BAIXA (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER,
    USUARIO INTEGER,
    CONTA INTEGER,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     /*fabiano.. avaliando vlr-baixa: aqui (FIN-BAIXAS-RECEBER) nos temos ambos os valores separados
     valor que é o valor original da conta-receber, e o :VLR-BAIXA que representa o :VLR-BAIXA = :VALOR da conta receber
     - :DESCONTO + :JUROS*/
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            VLR_BAIXA, PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR, USUARIO, CONTA,
            COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA >= :DINI AND DT_BAIXA <= :DFIM AND
     (( FATURA = 0 ) OR ( FATURA IS NULL ))
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS, :VLR_BAIXA,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA,
            :NUMBOLETO, :NUMDUPLICATA, :TURNO, :COBRADOR, :USUARIO, :CONTA,
            :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
     DO BEGIN
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, :UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END

     /*fabiano.. avaliando vlr-baixa: aqui  é a mesma situação do codigo a cima*/
     /* NOTAS DE FATURAS */
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            VLR_BAIXA, PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR, CONTA,
            COD_INDEXADOR, IDX_DATABASE, IDX_COTACAO, IDX_QTDE
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA >= :DINI AND DT_BAIXA <= :DFIM
     AND ( FATURA > 0 ) AND ORIGEM <> 'FFT'
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS, :VLR_BAIXA,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA,
            :NUMBOLETO, :NUMDUPLICATA,
            :TURNO, :COBRADOR, :CONTA,
            :COD_INDEXADOR, :IDX_DATABASE, :IDX_COTACAO, :IDX_QTDE
     DO BEGIN
        LOCAL = 'FFT' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, :UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END

     CODIGO     = NULL;
     ANO        = NULL;
     CODIGO_CR  = NULL;
     ANO_CR     = NULL;
     PARCELA    = NULL;
     TAXA_JUROS = NULL;
     BOLETO     = NULL;
     TIPO_JUROS = NULL;
     ORIGEM     = NULL;
     JUROS_REC  = NULL;
     DESCONTOS_REC = NULL;
     JUROS      = NULL;
     DESCONTOS  = NULL;
     HISTORICO  = NULL;
     HISTORICO_BX = NULL;
     DT_EMISSAO   = NULL;
     DT_VENCTO    = NULL;
     DT_LANCTO    = NULL;
     DOCTO        = NULL;

     /*fabiano.. avaliando vlr-baixa: aqui (FIN-FATURAS-PARCIAL) nós não temos um correspondente ao VALOR(FIN_BAIXAS_RECEBER), pois
     o campo VALOR(FIN-FATURA-PARCIAL)  é atribuido diretamente para :VLR-BAIXA deixando provavelmente o :VALOR retorne
     null nas tuplas deste suspend */
     FOR SELECT CODIGO, HISTORICO, VALOR, PLANILHA, TURNO, DATA_CAIXA,
     JUROS_RECEBIDOS, DESCONTOS_CONCEDIDOS, CONTA
     FROM FIN_FATURAS_PARCIAL
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM
     ORDER BY CNPJ, DATA_CAIXA, USUARIO, CONTA
     INTO :FATURA, :HISTORICO, :VALOR, :PLANILHA, :TURNO, :DT_BAIXA,
     :JUROS, :DESCONTOS, :CONTA
     DO BEGIN
        DOCTO = CAST(:FATURA AS VARCHAR(20));

        PARCELA = '01/01';

        LOCAL = 'FPC' ;

        VLR_BAIXA = :VALOR ;  /*<-------aqui*/

        SELECT NOME, PESSOA_FJ, VENCIMENTO, DATA FROM FIN_FATURAS
        WHERE CNPJ = :CNPJ AND CODIGO = :FATURA
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :PESSOA_FJ, :DT_VENCTO, :DT_EMISSAO ;

        DT_LANCTO = :DT_EMISSAO ;

        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, :UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END


     /* FATURAS */
     CODIGO     = NULL;
     ANO        = NULL;
     CODIGO_CR  = NULL;
     ANO_CR     = NULL;
     PARCELA    = NULL;
     TAXA_JUROS = NULL;
     BOLETO     = NULL;
     TIPO_JUROS = NULL;
     ORIGEM     = NULL;
     JUROS_REC  = NULL;
     DESCONTOS_REC = NULL;
     JUROS      = NULL;
     DESCONTOS  = NULL;
     HISTORICO  = NULL;
     HISTORICO_BX = NULL;
     DT_EMISSAO   = NULL;
     DT_VENCTO    = NULL;
     DT_LANCTO    = NULL;
     DOCTO        = NULL;

     /*fabiano.. avaliando vlr-baixa: já aqui (FIN-FATURAS)
     temos o :VLR-BAIXA montado com :VALOR + :JUROS - :DESCONTOS*/

     FOR SELECT CODIGO, HISTORICO, VALOR, TURNO, DATA_BAIXA,
     NOME, PESSOA_FJ, VENCIMENTO, DATA , JUROS, DESCONTO, CONTA
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND DATA_BAIXA >= :DINI AND DATA_BAIXA <= :DFIM
     ORDER BY CNPJ, DATA_BAIXA, USUARIO
     INTO :FATURA, :HISTORICO, :VALOR,  :TURNO, :DT_BAIXA,
          :NOME, :PESSOA_FJ, :DT_VENCTO, :DT_EMISSAO,
          :JUROS, :DESCONTOS, :CONTA
     DO BEGIN
        PLANILHA = 0;

        DOCTO = CAST(:FATURA AS VARCHAR(20));

        PARCELA = '01/01';

        LOCAL = 'FAT' ;

        VLR_BAIXA = :VALOR + :JUROS - :DESCONTOS;

        DT_LANCTO = :DT_EMISSAO ;

        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, :UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TRN INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO, CODIGO_VN, ANO_VN,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM,
            AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA AND USUARIO = :USUARIO AND TURNO = :TRN
     AND CONTA = :CONTA
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO, :CODIGO_VN, :ANO_VN,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM,
            :AVISO, :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA, :NUMBOLETO, :NUMDUPLICATA,
            :TURNO, :COBRADOR
     DO BEGIN
        LOCAL = 'REC' ;
        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :NOME, :CPF_CGC ;

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_CAIXA_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     /* fabiano 28/07/2005
     esse relatorio aparentemente lista as contas recebidas dos clientes, ele é usado no relatorio de caixa por
     periodo mas possivelmente em outros tambem */


     /*quando o parametro de conta for passado */
     if (conta is not null) then
     begin
       FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
              DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO, CODIGO_VN, ANO_VN,
              VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM,
              AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
              PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
              TURNO, COBRADOR
       FROM FIN_BAIXAS_RECEBER
       WHERE CNPJ = :CNPJ AND ( DT_BAIXA >= :INI AND DT_BAIXA <= :FIM )
       AND (CONTA = :CONTA)
       INTO
              :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
              :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO, :CODIGO_VN, :ANO_VN,
              :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM,
              :AVISO, :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
              :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA, :NUMBOLETO, :NUMDUPLICATA,
              :TURNO, :COBRADOR
       DO BEGIN
          LOCAL = 'REC' ;
  
          /* PESSOAS FJ */
          SELECT NOME_RAZAO, CPF_CGC
          FROM   GLO_PESSOAS_FJ
          WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
          PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
          ORDER BY CNPJ, CODIGO
          INTO
              :NOME, :CPF_CGC ;
  
          SUSPEND;
       END
     end
     else
     begin
       /*quando a caixa não for passada por parametro entrao nao filtro por ela
       como é o caso de relatorio de caixa por periodo onde não me interessa o caixa*/
       for select cnpj, codigo, ano, codigo_cr, ano_cr, pessoa_fj, dt_emissao,
              dt_vencto, dt_lancto, docto, parcela, historico, codigo_vn, ano_vn,
              valor, vlr_baixa, vlr_parcial, juros_rec, descontos_rec, boleto, origem,
              aviso, dt_aviso, dt_baixa, historico_bx, juros, descontos,
              planilha, taxa_juros, tipo_juros, fatura, numboleto, numduplicata,
              turno, cobrador
       from fin_baixas_receber
       where cnpj = :cnpj and ( dt_baixa >= :ini and dt_baixa <= :fim )
       into
              :cnpj, :codigo, :ano, :codigo_cr, :ano_cr, :pessoa_fj, :dt_emissao,
              :dt_vencto, :dt_lancto, :docto, :parcela, :historico, :codigo_vn, :ano_vn,
              :valor, :vlr_baixa, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem,
              :aviso, :dt_aviso, :dt_baixa, :historico_bx, :juros, :descontos,
              :planilha, :taxa_juros, :tipo_juros, :fatura, :numboleto, :numduplicata,
              :turno, :cobrador
       do begin
          local = 'rec' ;
  
          /* pessoas fj */
          select nome_razao, cpf_cgc
          from   glo_pessoas_fj
          where cnpj = :cnpj and codigo = :pessoa_fj
          plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
          order by cnpj, codigo
          into
              :nome, :cpf_cgc ;
  
          suspend;
       end
     end
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_BAIXA TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    NOMECONVENIADO VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    COBRADOR INTEGER,
    LOCAL INTEGER)
AS
DECLARE VARIABLE CODIGO_AUX INTEGER;
BEGIN
IF ( CONVENIO > 0)
THEN BEGIN
     /* PESSOAS FJ */
     FOR SELECT CODIGO, ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIO
     INTO :PESSOA_FJ, :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC
     DO BEGIN
        /* ZERA OS CONVENIADOS */
        CONVENIADO        = NULL ;
        NOMECONVENIADO    = NULL ;
        CPF_CGCCONVENIADO = NULL ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;
          
        /* BUSCA AS PARCELAS DO CONVENIO */
        FOR SELECT CODIGO, ANO, DT_EMISSAO,
        DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
        VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
        ANO_VN, AVISO, DT_AVISO, NUMBOLETO, NUMDUPLICATA,
        FATURA, VLR_PARCIAL, COBRADOR, LOCAL_COBRANCA, VLR_BAIXA, JUROS, DESCONTOS,
        DT_BAIXA
        FROM FIN_BAIXAS_RECEBER
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIO
        and (coalesce(act_tipo_baixa,'1') <> '4')
        AND FATURA IS NULL
        INTO
            :CODIGO, :ANO, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL, :COBRADOR, :LOCAL,
            :VLR_BAIXA, :JUROS, :DESCONTOS, :DT_BAIXA
        DO BEGIN
           SUSPEND;
        END

        FOR SELECT CODIGO, NOME_RAZAO, CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CONVENIO = :PESSOA_FJ
        INTO :CONVENIADO, :NOMECONVENIADO, :CPF_CGCCONVENIADO
        DO BEGIN
           FOR SELECT CODIGO, ANO, DT_EMISSAO,
           DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
           VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
           ANO_VN, AVISO, DT_AVISO, NUMBOLETO, NUMDUPLICATA,
           LOCAL_COBRANCA, VLR_BAIXA, JUROS, DESCONTOS, DT_BAIXA
           FROM FIN_BAIXAS_RECEBER
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIADO
           and (coalesce(act_tipo_baixa,'1') <> '4')
           AND FATURA IS NULL
           INTO
               :CODIGO, :ANO, :DT_EMISSAO,
               :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
               :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
               :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO,
               :NUMBOLETO, :NUMDUPLICATA, :LOCAL, :VLR_BAIXA, :JUROS, :DESCONTOS, :DT_BAIXA
           DO BEGIN
              SUSPEND;
           END
        END
     END
END
ELSE BEGIN
     /* BUSCA AS PARCELAS DO CONVENIO */
     FOR SELECT PESSOA_FJ, CODIGO, ANO, DT_EMISSAO,
     DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
     VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
     ANO_VN, AVISO, DT_AVISO, NUMBOLETO, NUMDUPLICATA,
     COBRADOR, LOCAL_COBRANCA, VLR_BAIXA, JUROS, DESCONTOS, DT_BAIXA
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA IS NULL
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
         :PESSOA_FJ, :CODIGO, :ANO, :DT_EMISSAO,
         :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
         :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
         :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO,
         :NUMBOLETO, :NUMDUPLICATA, :COBRADOR, :LOCAL,
         :VLR_BAIXA, :JUROS, :DESCONTOS, :DT_BAIXA
     DO BEGIN
        CODIGO_AUX = :PESSOA_FJ;

         /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, CONVENIO,
        NUMERO, CEP, UF
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :CONVENIADO,
             :NUMERO, :CEP, :UF ;
        
        IF (( CONVENIADO = 0 ) or ( CONVENIADO IS NULL ))
        THEN BEGIN
             /* ZERA OS CONVENIADOS */
             CONVENIADO        = NULL ;
             NOMECONVENIADO    = NULL ;
             CPF_CGCCONVENIADO = NULL ;
             
             /* LOGRADOUTOS */
             SELECT NOME FROM GLO_LOGRADOUROS
             WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
             INTO :ENDERECO ;
        
             /* CIDADES */
             SELECT NOME FROM GLO_CIDADES
             WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
             INTO :CIDADE ;

             /* BAIRROS */
             SELECT NOME FROM GLO_BAIRROS
             WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
             INTO :BAIRRO ;
          
             SUSPEND;
        END
        ELSE BEGIN
             NOMECONVENIADO    = :NOME    ;
             CPF_CGCCONVENIADO = :CPF_CGC ;
        
             SELECT CODIGO, ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
             NUMERO, CEP, UF
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIADO
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_FJ, :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
                  :NUMERO, :CEP, :UF ;

             CONVENIADO        = :CODIGO_AUX ;

             /* LOGRADOUTOS */
             SELECT NOME FROM GLO_LOGRADOUROS
             WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
             INTO :ENDERECO ;
        
             /* CIDADES */
             SELECT NOME FROM GLO_CIDADES
             WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
             INTO :CIDADE ;

             /* BAIRROS */
             SELECT NOME FROM GLO_BAIRROS
             WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
             INTO :BAIRRO ;
          
             SUSPEND;
       END
    END
END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_FATURA (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, NUMBOLETO, NUMDUPLICATA, FATURA,
            TURNO, COBRADOR
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FAT
     ORDER BY CNPJ, FATURA
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :NUMBOLETO, :NUMDUPLICATA, :FATURA,
            :TURNO, :COBRADOR
     DO BEGIN
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    CODIGO_VN INTEGER,
    ANO_VN INTEGER,
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    PLANILHA INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO, CODIGO_VN, ANO_VN,
            VALOR, VLR_BAIXA, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM,
            AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA = :DATA
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO, :CODIGO_VN, :ANO_VN,
            :VALOR, :VLR_BAIXA, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM,
            :AVISO, :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA, :NUMBOLETO, :NUMDUPLICATA,
            :TURNO, :COBRADOR
     DO BEGIN
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT NOME_RAZAO, CPF_CGC
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :NOME, :CPF_CGC ;

        SUSPEND;
        
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    FATURA INTEGER,
    VLR_PARCIAL NUMERIC(18,4),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            PLANILHA, TAXA_JUROS, TIPO_JUROS, VLR_BAIXA, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_EMISSAO >= :DINI AND DT_EMISSAO <= :DFIM
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :VLR_BAIXA, :FATURA,
            :NUMBOLETO, :NUMDUPLICATA, :TURNO, :COBRADOR
     DO BEGIN
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_PESSOA (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO INTEGER,
    CODIGO_CR INTEGER,
    ANO_CR INTEGER,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    PLANILHA INTEGER,
    ANO_VN INTEGER,
    AVISO INTEGER,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     for select cnpj, codigo, ano, codigo_cr, ano_cr, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_baixa, vlr_parcial, juros_rec, descontos_rec, boleto, origem, codigo_vn, ano_vn, aviso,
            dt_aviso, dt_baixa, historico_bx, juros, descontos,
            planilha, taxa_juros, tipo_juros, numboleto, numduplicata, fatura,
            turno,
            rec.COD_INDEXADOR,
            rec.IDX_DATABASE ,
            rec.IDX_COTACAO,
            rec.IDX_QTDE
     from fin_baixas_receber rec
     where cnpj = :cnpj and rec.pessoa_fj = :cliente
     into
            :cnpj, :codigo, :ano, :codigo_cr, :ano_cr, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_baixa, :vlr_parcial, :juros_rec, :descontos_rec, :boleto, :origem, :codigo_vn, :ano_vn, :aviso,
            :dt_aviso, :dt_baixa, :historico_bx, :juros, :descontos,
            :planilha, :taxa_juros, :tipo_juros, :numboleto, :numduplicata, :fatura,
            :turno,
            :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     do begin
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BAIXA_RECEBER_VENDEDOR (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    CODIGO_CR INTEGER,
    ANO_CR SMALLINT,
    PESSOA_FJ INTEGER,
    DT_BAIXA DATE,
    DT_EMISSAO DATE,
    DT_VENCTO DATE,
    DT_LANCTO DATE,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    HISTORICO_BX VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    VLR_BAIXA NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS_REC NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    BOLETO CHAR(1),
    TIPO_JUROS CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PLANILHA INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO DATE,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    FATURA INTEGER,
    CPF_CGC VARCHAR(15),
    NUMBOLETO INTEGER,
    NUMDUPLICATA INTEGER,
    TURNO INTEGER,
    LOCAL CHAR(3),
    COBRADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, CODIGO_CR, ANO_CR, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS_REC, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, DT_BAIXA, HISTORICO_BX, JUROS, DESCONTOS,
            VLR_BAIXA, PLANILHA, TAXA_JUROS, TIPO_JUROS, FATURA, NUMBOLETO, NUMDUPLICATA,
            TURNO, COBRADOR
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_BAIXA >= :DINI AND DT_BAIXA <= :DFIM
     and (coalesce(act_tipo_baixa,'1') <> '4')
     INTO
            :CNPJ, :CODIGO, :ANO, :CODIGO_CR, :ANO_CR, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS_REC, :BOLETO, :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO,
            :DT_AVISO, :DT_BAIXA, :HISTORICO_BX, :JUROS, :DESCONTOS, :VLR_BAIXA,
            :PLANILHA, :TAXA_JUROS, :TIPO_JUROS, :FATURA,
            :NUMBOLETO, :NUMDUPLICATA, :TURNO, :COBRADOR
     DO BEGIN
        LOCAL = 'REC' ;

        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, :UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* VENDAS */
        SELECT VENDEDOR, NOME_VENDEDOR
        FROM FAT_VENDAS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_VN
        ORDER BY CNPJ, CODIGO
        INTO :VENDEDOR, :NOME_VENDEDOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_BALANCETE_ANALITICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(60),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50))
AS
BEGIN
     FOR SELECT CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO,
            MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA,
            CONTRA_PARTIDA, CNPJ, CODIGO_CONTABIL,
            CREDITO, DEBITO
     FROM VER_MOVIMENTO_CONTABIL(:EMPRESA)
     WHERE DATA >= :DATINI AND DATA <= :DATFIM AND CNPJ = :EMPRESA
     AND CODIGO_CONTABIL >= :CODINI AND CODIGO_CONTABIL <= :CODFIM
     INTO
         :CODIGO, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA,
         :CONTRA_PARTIDA, :CNPJ, :CODIGO_CONTABIL, :CREDITO,
         :DEBITO
     DO BEGIN
        
        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_BALANCETE_SINTETICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50),
    ANTERIOR NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE COD INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
DECLARE VARIABLE AUXC NUMERIC(18,4);
DECLARE VARIABLE AUXD NUMERIC(18,4);
BEGIN
     CNPJ = :EMPRESA ;

     FOR SELECT CONTA, CODIGO, CONTAPAI, NOME
     FROM  CTB_PLANOCONTA
     WHERE CODIGO >= :CODINI AND CODIGO <= :CODFIM
     AND CNPJ = :EMPRESA
     ORDER BY CNPJ, CODIGO
     INTO
         :CONTA, :CODIGOPLANO, :CONTAPAI, :NOME
     DO BEGIN
        /* TAMANHO DA CONTA */

        CREDITO = 0;
        DEBITO  = 0;
        
        AUXD = 0;
        AUXC = 0;

        /* SALDO ANTERIOR */
        FOR SELECT CONTA
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :EMPRESA AND CODIGO like :CODIGOPLANO||'%'
        ORDER BY CNPJ, CODIGO
        INTO :COD
        DO BEGIN
           FOR SELECT SUM(VALOR), TIPO
           FROM CTB_MOVIMENTO_CONTABIL
           WHERE CNPJ = :CNPJ AND CONTA = :COD AND DATA < :DATINI
           GROUP BY TIPO
           INTO :AUX, :TIPO
           DO BEGIN
              IF ( AUX IS NULL )
              THEN
                  AUX = 0 ;

              IF ( TIPO = 'C' )
              THEN BEGIN
                   AUXC = :AUXC + :AUX ;
              END
              ELSE BEGIN
                   AUXD = :AUXD + :AUX ;
              END
           END
        END

        ANTERIOR = AUXD - AUXC  ;

        /* CREDITO E DEBITO */
        FOR SELECT CONTA
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :EMPRESA AND CODIGO like :CODIGOPLANO||'%'
        INTO :COD
        DO BEGIN
           FOR SELECT SUM(VALOR), TIPO
           FROM CTB_MOVIMENTO_CONTABIL
           WHERE CNPJ = :CNPJ AND CONTA = :COD AND DATA >= :DATINI AND DATA <= :DATFIM
           GROUP BY TIPO
           INTO :AUX, :TIPO
           DO BEGIN
              IF ( AUX IS NULL )
              THEN
                  AUX = 0 ;

              IF ( TIPO = 'C' )
              THEN BEGIN
                   CREDITO = :CREDITO + :AUX ;
              END
              ELSE BEGIN
                   DEBITO = :DEBITO + :AUX ;
              END
           END
        END

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_BALANCETE_SINTETICO_DIARIO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    GRUPO INTEGER)
RETURNS (
    CODIGOPLANO VARCHAR(15),
    TIPO CHAR(1),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT CONTA, CODIGO_CONTABIL, TIPO, SUM(VALOR)
     FROM VER_MOVIMENTO_CONTABIL ( :EMPRESA )
     WHERE CONTA IN ( SELECT CONTA FROM CTB_CONFIGURA_RELATORIO_CONTAS
                      WHERE CNPJ = :EMPRESA AND CODIGO = :GRUPO
                    )
     AND DATA >= :DATINI AND DATA <= :DATFIM
     GROUP BY CONTA, CODIGO_CONTABIL, TIPO
     INTO :CONTA, :CODIGOPLANO, :TIPO, :VALOR
     DO BEGIN
        SELECT NOME
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :EMPRESA AND CONTA = :CONTA
        INTO :NOME ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_BALANCETE_SINTETICO_GRUPO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15),
    GRUPO INTEGER)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    DATA DATE,
    TIPO CHAR(1),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    CONTA INTEGER,
    NOME VARCHAR(50),
    ANTERIOR NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE COD INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
DECLARE VARIABLE AUXC NUMERIC(18,4);
DECLARE VARIABLE AUXD NUMERIC(18,4);
BEGIN
     CNPJ = :EMPRESA ;

     FOR SELECT CONTA, CODIGO, CONTAPAI, NOME
     FROM  CTB_PLANOCONTA
     WHERE CODIGO >= :CODINI AND CODIGO <= :CODFIM AND CNPJ = :CNPJ
     AND CONTA IN ( SELECT CONTA FROM CTB_CONFIGURA_RELATORIO_CONTAS
                    WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO )
     ORDER BY CNPJ, CODIGO
     INTO
         :CONTA, :CODIGOPLANO, :CONTAPAI, :NOME
     DO BEGIN
        /* TAMANHO DA CONTA */
        select * from getlength(:CODIGOPLANO) into :LEN;

        CREDITO = 0;
        DEBITO  = 0;
        
        AUXD = 0;
        AUXC = 0;

        /* SALDO ANTERIOR */
        FOR SELECT CONTA
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :EMPRESA AND CODIGO like :CODIGOPLANO||'%'
        INTO :COD
        DO BEGIN
           FOR SELECT SUM(VALOR), TIPO
           FROM CTB_MOVIMENTO_CONTABIL
           WHERE CNPJ = :CNPJ AND CONTA = :COD AND DATA < :DATINI
           GROUP BY TIPO
           INTO :AUX, :TIPO
           DO BEGIN
              IF ( AUX IS NULL )
              THEN
                  AUX = 0 ;

              IF ( TIPO = 'C' )
              THEN BEGIN
                   AUXC = :AUXC + :AUX ;
              END
              ELSE BEGIN
                   AUXD = :AUXD + :AUX ;
              END
           END
        END

        ANTERIOR = AUXD - AUXC  ;

        /* CREDITO E DEBITO */
        FOR SELECT CONTA
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :EMPRESA AND CODIGO like :CODIGOPLANO||'%'
        INTO :COD
        DO BEGIN
           FOR SELECT SUM(VALOR), TIPO
           FROM CTB_MOVIMENTO_CONTABIL
           WHERE CNPJ = :CNPJ AND CONTA = :COD AND DATA >= :DATINI AND DATA <= :DATFIM
           GROUP BY TIPO
           INTO :AUX, :TIPO
           DO BEGIN
              IF ( AUX IS NULL )
              THEN
                  AUX = 0 ;

              IF ( TIPO = 'C' )
              THEN BEGIN
                   CREDITO = :CREDITO + :AUX ;
              END
              ELSE BEGIN
                   DEBITO = :DEBITO + :AUX ;
              END
           END
        END

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_BALANCETE_SINTETICO1 (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    TIPO CHAR(1),
    CODIGO_CONTABIL VARCHAR(15),
    NOME VARCHAR(50))
AS
BEGIN
     CNPJ = :EMPRESA ;

     FOR SELECT TIPO, SUM(VALOR), CODIGO_CONTABIL
     FROM VER_MOVIMENTO_CONTABIL ( :EMPRESA )
     WHERE DATA >= :DATINI AND DATA <= :DATFIM
     AND CODIGO_CONTABIL >= :CODINI AND CODIGO_CONTABIL <= :CODFIM
     GROUP BY TIPO, CODIGO_CONTABIL
     INTO :TIPO, :VALOR, :CODIGO_CONTABIL
     DO BEGIN
        IF ( TIPO = 'C' )
        THEN BEGIN
             CREDITO = :VALOR  ;
             DEBITO  = 0       ;
        END
        ELSE BEGIN
             CREDITO = 0       ;
             DEBITO  = :VALOR  ;
        END

        CODIGOPLANO = :CODIGO_CONTABIL ;

        SELECT NOME, CONTAPAI, CONTA
        FROM CTB_PLANOCONTA
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_CONTABIL
        INTO :NOME, :CONTAPAI, :CONTA ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_CARTAO_CAIXA (
    CNPJ CHAR(14),
    USUARIO INTEGER,
    DATA DATE,
    CONTA INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO DATE,
    ADMINISTRADORA INTEGER,
    NOME_ADM VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4))
AS
begin
     FOR SELECT
         CODIGO, CPF_CNPJ, CLIENTE, REEMBOLSO, ADMINISTRADORA,
         VALOR, NUM_CARTAO, NUM_BANCO, NUM_CONTA,
         CONCILIADO, TIPO_DOC, DOCUMENTO, VENDA, PESSOA_FJ,
         TIPO, NUM_PARCELAS, TAXA
     FROM FIN_MOVIMENTO_CARTAO
     WHERE CNPJ = :CNPJ AND
           USUARIO = :USUARIO AND DATA = :DATA
           AND CONTA = :CONTA AND TURNO = :TURNO
     INTO
         :CODIGO, :CPF_CNPJ, :CLIENTE, :REEMBOLSO, :ADMINISTRADORA,
         :VALOR, :NUM_CARTAO, :NUM_BANCO, :NUM_CONTA,
         :CONCILIADO, :TIPO_DOC, :DOCUMENTO, :VENDA, :PESSOA_FJ,
         :TIPO, :NUM_PARCELAS, :TAXA
     DO BEGIN
        SELECT NOME FROM FIN_ADMINISTRADORA
        WHERE CNPJ = :CNPJ AND CODIGO = :ADMINISTRADORA
        INTO :NOME_ADM ;

        suspend;
     END
END
^

ALTER PROCEDURE VER_CARTAO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CODIGO INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO DATE,
    ADMINISTRADORA INTEGER,
    NOME_ADM VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4))
AS
begin
     FOR SELECT
         CODIGO, CPF_CNPJ, CLIENTE, REEMBOLSO, ADMINISTRADORA,
         VALOR, NUM_CARTAO, NUM_BANCO, NUM_CONTA,
         CONCILIADO, TIPO_DOC, DOCUMENTO, VENDA, PESSOA_FJ,
         TIPO, NUM_PARCELAS, TAXA
     FROM FIN_MOVIMENTO_CARTAO
     WHERE CNPJ = :CNPJ AND DATA = :DATA
     INTO
         :CODIGO, :CPF_CNPJ, :CLIENTE, :REEMBOLSO, :ADMINISTRADORA,
         :VALOR, :NUM_CARTAO, :NUM_BANCO, :NUM_CONTA,
         :CONCILIADO, :TIPO_DOC, :DOCUMENTO, :VENDA, :PESSOA_FJ,
         :TIPO, :NUM_PARCELAS, :TAXA
     DO BEGIN
        SELECT NOME FROM FIN_ADMINISTRADORA
        WHERE CNPJ = :CNPJ AND CODIGO = :ADMINISTRADORA
        INTO :NOME_ADM ;

        suspend;
     END
END
^

ALTER PROCEDURE VER_CLIENTE (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    EMAIL VARCHAR(80),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER,
    ENDERECO VARCHAR(65),
    PESSOA CHAR(1),
    RG_IE VARCHAR(15),
    REGIAO INTEGER,
    NOME_REGIAO VARCHAR(50),
    ATIVIDADE INTEGER,
    NOME_ATIVIDADE VARCHAR(50),
    BAIRRO INTEGER,
    NOME_BAIRRO VARCHAR(50),
    CIDADE INTEGER,
    NOME_CIDADE VARCHAR(50),
    DT_NASCIMENTO TIMESTAMP,
    CELULAR VARCHAR(20))
AS
DECLARE VARIABLE COD_CLASSIFICACAO INTEGER;
DECLARE VARIABLE COD_ENDERECO INTEGER;
DECLARE VARIABLE NUMERO VARCHAR(15);
BEGIN
     /* DADOS DAS PESSOAS */
     FOR SELECT CNPJ, email, CODIGO, NOME_RAZAO, FONE, FANTASIA, CPF_CGC, UF,
     ORDEM, ENDERECO, NUMERO, PESSOA, substring(RG_IE from 1 for 15), REGIAO, ATIVIDADE, BAIRRO,
     DT_NASCIMENTO, CELULAR, cidade
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ 
     INTO :EMPRESA, :email, :CODIGO, :NOME_RAZAO, :FONE, :FANTASIA, :CPF_CGC, :UF,
     :ORDEM, :COD_ENDERECO ,:NUMERO, :PESSOA, :RG_IE, :REGIAO, :ATIVIDADE, :BAIRRO,
     :DT_NASCIMENTO, :CELULAR, :cidade
     DO BEGIN
          COD_CLASSIFICACAO = NULL;
          CLASSIFICACAO     = NULL;
          ENDERECO          = NULL;

          /* ATIVIDADE */
          SELECT nome
          FROM glo_atividades
          WHERE CNPJ = :CNPJ AND codigo = :ATIVIDADE
          INTO NOME_ATIVIDADE;

          /* BAIRRO */
          SELECT nome
          FROM glo_bairros
          WHERE CNPJ = :CNPJ AND codigo = :BAIRRO
          INTO NOME_BAIRRO;

          /* BAIRRO */
          SELECT cdd.nome
          FROM glo_cidades cdd
          WHERE CNPJ = :CNPJ AND codigo = :cidade
          INTO :nome_cidade;

          /* REGIAO */
          SELECT nome
          FROM glo_regioes
          WHERE CNPJ = :CNPJ AND codigo = :REGIAO
          INTO NOME_REGIAO;

          select coalesce(bloqueado,'N'), cod_classif
          from glo_clientes
          where cnpj = :cnpj and pessoa_fj = :codigo
          order by cnpj, pessoa_fj
          into :bloqueado, :cod_classificacao ;
  
          pessoa_fj = :codigo;
          /* CLASSIFICACAO */
          SELECT NOME FROM GLO_CLASSIFICACAO
          WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIFICACAO
          INTO :CLASSIFICACAO ;
          
          /* ENDERECO */
          SELECT NOME FROM GLO_LOGRADOUROS
          WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
          INTO :ENDERECO ;
  
          ENDERECO = SUBSTRING(:ENDERECO || ',N ' || :NUMERO FROM  1 FOR 65);

          suspend;
     END
END
^

ALTER PROCEDURE VER_CLIENTE_DADOS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    CONJUGE VARCHAR(50),
    PAI VARCHAR(50),
    MAE VARCHAR(50))
AS
BEGIN
     SELECT CONJUGE, MAE, PAI
     FROM GLO_CLIENTES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
     INTO :CONJUGE, :PAI, :MAE ;

     SUSPEND;
END
^

ALTER PROCEDURE VER_CLIENTES_CHEQUE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN EXIT; END
^

ALTER PROCEDURE VER_CODIGO_ROTA (
    CNPJ VARCHAR(14),
    CIDADE INTEGER)
RETURNS (
    ROTA INTEGER)
AS
BEGIN
     FOR SELECT ROTA FROM CRG_ROTAS_CIDADES
     WHERE CNPJ = :CNPJ AND CIDADE = :CIDADE
     INTO :ROTA
     DO BEGIN
        SUSPEND;
        EXIT;
     END
END
^

ALTER PROCEDURE VER_CONTAS_PESSOAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    BANCO CHAR(3),
    NOME_BANCO VARCHAR(50),
    AGENCIA VARCHAR(15),
    CONTA VARCHAR(15),
    DV_AGENCIA CHAR(1),
    DV_CONTA CHAR(1))
AS
BEGIN
      FOR SELECT
             BANCO,
             AGENCIA,
             CONTA,
             DV_AGENCIA,
             DV_CONTA
      FROM GLO_CONTAS_PESSOAS
      WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
      INTO 
           :BANCO,
           :AGENCIA,
           :CONTA,
           :DV_AGENCIA,
           :DV_CONTA
      DO
      BEGIN
           SELECT NOME FROM FIN_BANCO
           WHERE CODIGO = :BANCO
           INTO :NOME_BANCO ;
           
           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_CONVENIO (
    CNPJ VARCHAR(14),
    CONVENIO INTEGER)
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER)
AS
DECLARE VARIABLE COD_CLASSIFICACAO INTEGER;
BEGIN
     /* DADOS DAS PESSOAS */
     FOR SELECT CNPJ, CODIGO, NOME_RAZAO, FONE, FANTASIA, CPF_CGC, UF, ORDEM
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CONVENIO = :CONVENIO
     INTO :EMPRESA, :CODIGO, :NOME_RAZAO, :FONE, :FANTASIA, :CPF_CGC, :UF, :ORDEM
     DO BEGIN
        SELECT PESSOA_FJ, BLOQUEADO, COD_CLASSIF
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO AND BLOQUEADO <> 'S'
        ORDER BY CNPJ, PESSOA_FJ
        INTO :PESSOA_FJ, :BLOQUEADO, :COD_CLASSIFICACAO ;

        /* CLASSIFICACAO */
        SELECT NOME FROM GLO_CLASSIFICACAO
        WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIFICACAO
        INTO :CLASSIFICACAO ;
        
        IF (PESSOA_FJ IS NOT NULL)
        THEN BEGIN
             SUSPEND;
             PESSOA_FJ = NULL;
        END
     END
END
^

ALTER PROCEDURE VER_CONVENIOS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
DECLARE VARIABLE FORMA INTEGER;
BEGIN
     FOR SELECT
             CODIGO,
             NOME_RAZAO,
             FANTASIA,
             ATIVIDADE,
             ENDERECO,
             NUMERO,
             COMPLEMENTO,
             BAIRRO,
             CIDADE,
             UF,
             CEP,
             FONE,
             FAX,
             CELULAR,
             PESSOA,
             CPF_CGC,
             RG_IE,
             CONTATO,
             DT_NASCIMENTO,
             DT_CADASTRO,
             EMAIL,
             OBS,
             INSC_MUNIC,
             ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ AND CODIGO IN ( SELECT CONVENIO FROM GLO_PESSOAS_FJ WHERE CNPJ = :CNPJ )
      INTO
           :CODIGO,
           :NOME_RAZAO,
           :FANTASIA,
           :COD_ATIVIDADE,
           :COD_ENDERECO,
           :NUMERO,
           :COMPLEMENTO,
           :COD_BAIRRO,
           :COD_CIDADE,
           :UF,
           :CEP,
           :FONE,
           :FAX,
           :CELULAR,
           :PESSOA,
           :CPF_CGC,
           :RG_IE,
           :CONTATO,
           :DT_NASCIMENTO,
           :DT_CADASTRO,
           :EMAIL,
           :OBS,
           :INSC_MUNIC,
           :ORDEM
      DO
      BEGIN
           IF ( :DT_NASCIMENTO IS NULL )
           THEN BEGIN
                DT_NASCIMENTO = '01/01/1900';
           END

           IF ( :DT_CADASTRO IS NULL )
           THEN BEGIN
                DT_CADASTRO = '01/01/1900';
           END

           COMPRADOR     = NULL;
           PRAZO         = NULL;
           BLOQUEADO     = NULL;
           COD_VENDEDOR  = NULL;
           COD_CLASSIF   = NULL;
           FORMA         = NULL;
           ASSINA_NOTA   = NULL;
           FREQUENCIA    = NULL;
           NOME_CLASSIF  = NULL;


           /* REGIAO */
           SELECT ROTA FROM VER_CODIGO_ROTA ( :CNPJ, :COD_CIDADE )
           INTO :REGIAO ;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;

           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           /* DADOS DOS CLIENTES */
           SELECT COMPRADOR, PRAZO, BLOQUEADO,
           COD_VEND, COD_CLASSIF, COD_FPAGTO, ASSINA_NOTA, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           PLAN (GLO_CLIENTES INDEX (GLO_CLIENTES_PESSOA))
           ORDER BY CNPJ, PESSOA_FJ
           INTO :COMPRADOR, :PRAZO, :BLOQUEADO, :COD_VENDEDOR,
           :COD_CLASSIF, :FORMA, :ASSINA_NOTA, :FREQUENCIA ;

           IF ( COMPRADOR IS NULL )
           THEN BEGIN
                COMPRADOR = '';
           END

           IF ( BLOQUEADO IS NULL )
           THEN BEGIN
                BLOQUEADO = '';
           END

           IF ( ASSINA_NOTA IS NULL )
           THEN BEGIN
                ASSINA_NOTA = 'N';
           END

           /* DADOS DO VENDEDOR */
           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_VENDEDOR
           INTO :NOME_VENDEDOR ;

           /* DADOS DO CLASSIFICACAO */
           SELECT NOME FROM GLO_CLASSIFICACAO
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIF
           INTO :NOME_CLASSIF ;

           /* DADOS DA FORMA DE PAGTO */
           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA_PAGTO ;

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_COTAS_POR_VENDEDOR (
    CNPJ CHAR(14))
RETURNS (
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    VALOR NUMERIC(18,4),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
begin
     FOR SELECT CODIGO, NOME
     FROM FAT_VENDEDOR
     WHERE CNPJ = :CNPJ
     INTO :VENDEDOR, :NOME_VENDEDOR
     DO BEGIN
        FOR SELECT GRUPO, SUBGRUPO,
                   VALOR, COMISSAO_VISTA, COMISSAO_PRAZO
        FROM EST_SUBGRUPOS_COTAS
        WHERE CNPJ = :CNPJ AND VENDEDOR = :VENDEDOR
        INTO :GRUPO, :SUBGRUPO, :VALOR,
             :COMISSAO_VISTA, :COMISSAO_PRAZO
        DO BEGIN
           SELECT NOME FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
           INTO :NOME_GRUPO ;

           SELECT NOME FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND SUBGRUPO = :SUBGRUPO AND
           GRUPO = :GRUPO
           INTO :NOME_SUBGRUPO ;

           suspend;
        END
     END
END
^

ALTER PROCEDURE VER_COTAS_VENDEDORES (
    CNPJ CHAR(14),
    VENDEDOR INTEGER)
RETURNS (
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    VALOR NUMERIC(18,4),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
begin
     FOR SELECT GRUPO, SUBGRUPO,
                VALOR, COMISSAO_VISTA, COMISSAO_PRAZO
     FROM EST_SUBGRUPOS_COTAS
     WHERE CNPJ = :CNPJ AND VENDEDOR = :VENDEDOR
     INTO :GRUPO, :SUBGRUPO, :VALOR,
          :COMISSAO_VISTA, :COMISSAO_PRAZO
     DO BEGIN
         SELECT NOME FROM EST_GRUPOS
         WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
         INTO :NOME_GRUPO ;

         SELECT NOME FROM EST_SUBGRUPOS
         WHERE CNPJ = :CNPJ AND SUBGRUPO = :SUBGRUPO AND
         GRUPO = :GRUPO
         INTO :NOME_SUBGRUPO ;

         suspend;
     END
END
^

ALTER PROCEDURE VER_CPF_CNPJ (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CPF_CNPJ VARCHAR(15))
AS
begin
     SELECT CPF_CGC FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
     ORDER BY CNPJ, CODIGO
     INTO :CPF_CNPJ ;

     suspend;
END
^

ALTER PROCEDURE VER_CRG_CARGAS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    MOTORISTA INTEGER,
    NOME_MOTORISTA VARCHAR(50),
    VEICULO CHAR(8),
    ROTA INTEGER,
    NOME_ROTA VARCHAR(50),
    KM_SAIDA NUMERIC(18,4),
    KM_CHEGADA NUMERIC(18,4),
    DATA_SAIDA DATE,
    DATA_CHEGADA DATE,
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4))
AS
BEGIN
     FOR SELECT 
             MOTORISTA, VEICULO, ROTA, KM_SAIDA,
             KM_CHEGADA, DATA_SAIDA, DATA_CHEGADA, PESO, VOLUME
      FROM CRG_CARGAS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO 
           :MOTORISTA, :VEICULO, :ROTA, :KM_SAIDA, :KM_CHEGADA,
           :DATA_SAIDA, :DATA_CHEGADA, :PESO, :VOLUME
      DO BEGIN
         SELECT NOME FROM CRG_MOTORISTAS
         WHERE CNPJ = :CNPJ AND PESSOA_FJ = :MOTORISTA
         INTO :NOME_MOTORISTA ;
         
         SELECT NOME FROM CRG_ROTAS
         WHERE CNPJ = :CNPJ AND CODIGO = :ROTA
         INTO :NOME_ROTA ;
      
         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_CTB_CHEQUE (
    CNPJ CHAR(14),
    CONTA INTEGER)
RETURNS (
    CHEQUE INTEGER,
    DATA TIMESTAMP,
    BANCO VARCHAR(50),
    VALOR NUMERIC(18,4),
    HISTORICO VARCHAR(100),
    IMPRESSO CHAR(1),
    PESSOA_FJ INTEGER,
    ORIGEM CHAR(1),
    PLANILHA INTEGER,
    CONTABILIDADE CHAR(1),
    NOME VARCHAR(50),
    NOMINAL CHAR(1),
    PRE_DATE DATE,
    COD_ACERTO INTEGER)
AS
DECLARE VARIABLE NUM_BANCO CHAR(3);
BEGIN
     for select 
             cheque,
             data,
             valor,
             historico,
             impresso,
             pessoa_fj,
             origem,
             planilha,
             contabilidade,
             nominal,
             pre_date,
             cod_acertoconta
      from ctb_cheque
      where cnpj = :cnpj and conta = :conta
      into :cheque,
           :data,
           :valor,
           :historico,
           :impresso,
           :pessoa_fj,
           :origem,
           :planilha,
           :contabilidade,
           :nominal,
           :pre_date,
           :cod_acerto
      do
      begin
        /* pessoas fj */
        select nome_razao from glo_pessoas_fj where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome ;
            
            
        select banco from ctb_planoconta where cnpj = :cnpj and conta = :conta
        into :num_banco;
        
        select nome from fin_banco where codigo = :num_banco
        into :banco ;
      
        suspend;
      end
END
^

ALTER PROCEDURE VER_CTB_CONFIGURA_REL_CONTAS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    CONTA INTEGER,
    NOME VARCHAR(50))
AS
BEGIN
      FOR SELECT
             CONTA
      FROM CTB_CONFIGURA_RELATORIO_CONTAS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :CONTA
      DO BEGIN
         SELECT NOME FROM CTB_PLANOCONTA
         WHERE CNPJ = :CNPJ AND CONTA = :CONTA
         INTO :NOME ;

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_DADOS_BAIXA_VENDA (
    CNPJ CHAR(14),
    VENDA INTEGER)
RETURNS (
    DATA_BAIXA DATE,
    BANCO VARCHAR(15))
AS
DECLARE VARIABLE CONTA INTEGER;
DECLARE VARIABLE COD_BANCO CHAR(3);
begin
     FOR SELECT DT_BAIXA, CONTA
     FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_VN = :VENDA
     INTO :DATA_BAIXA, :CONTA
     DO BEGIN
       SELECT BANCO
       FROM CTB_PLANOCONTA
       WHERE CNPJ = :CNPJ AND CONTA = :CONTA
       INTO :COD_BANCO ;

     /* SELECT UDF_COPY(NOME,1,13)*/
       SELECT substring(NOME from 1 for 13)
       FROM FIN_BANCO
       WHERE CODIGO = :COD_BANCO
       INTO :BANCO ;

       suspend;
     END
END
^

ALTER PROCEDURE VER_DADOS_FATURA (
    CNPJ CHAR(14),
    PESSOA INTEGER,
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    JUROS_DIA NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    DUPLICATA VARCHAR(30),
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14),
    BAIXAS_PARCIAIS NUMERIC(18,4),
    BAIXAS_PARCIAIS_DIA NUMERIC(18,4))
AS
BEGIN
     for select codigo, pessoa_fj, data,
         valor, desconto, juros, vencimento, historico,
         banco, enviada, tipo, boleto, duplicata, obs, agrupadora,
         data_baixa, usuario, valor_original, ultima_bx_parcial, baixas_parciais
     FROM FIN_FATURAS
     where cnpj = :cnpj and pessoa_fj = :pessoa and baixada = 'N'
     into :codigo, :pessoa_fj, :data, :valor, :desconto, :juros, :vencimento,
          :historico, :banco, :enviada, :tipo, :boleto, :duplicata, :obs, :agrupadora,
          :data_baixa, :usuario, :valor_original, :ultima_bx_parcial, :baixas_parciais
     do begin
        select sum(valor+juros_recebidos), sum(juros_recebidos)
        from fin_faturas_parcial
        where cnpj = :cnpj and codigo = :codigo and
        data_caixa >= :dini and data_caixa <= :dfim
        into :baixas_parciais_dia, :juros_dia ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_ENT_ITENS_AGRUPADO (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER,
    INICIAL DATE,
    FINAL DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE FLOAT,
    PRC_CUSTO FLOAT,
    PRC_CUSTO_DIG FLOAT,
    NOME_PRODUTO VARCHAR(50))
AS
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     IF (( :NDOCTO <> '' ) AND ( :PESSOA_FJ > 0 ))
     THEN BEGIN
          FOR SELECT NDOCTO, PESSOA_FJ
          FROM EST_ENTRADAS
          WHERE NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ AND CNPJ = :CNPJ
          AND DATA_NF >= :INICIAL AND DATA_NF <= :FINAL
          ORDER BY CNPJ, NDOCTO, PESSOA_FJ
          INTO :NDOCTO, :PESSOA_FJ
          DO BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM EST_ENTRADAS_ITENS
             WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                SELECT NOME FROM EST_PRODUTOS
                WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                ORDER BY CNPJ, CODIGO
                INTO :NOME_PRODUTO ;

                SUSPEND;
             END
          END

          /* TABELA DE VENDAS */
          /* VENDAS COM NATUREZA DE ENTRADA ( DEVOLUCAO ) */
          FOR SELECT VD.CODIGO
          FROM FAT_VENDAS VD
          inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
          WHERE VD.CNPJ = :CNPJ AND DATA_CAIXA >= :INICIAL
          AND DATA_CAIXA <= :FINAL AND FECHADA = 'S'
          AND ENVIADA_CX = 'S' AND CANCELADA <> 'S'
          AND NAT.ES = 'S' AND PESSOA_FJ = :PESSOA_FJ AND VD.CODIGO = CAST(:NDOCTO AS INTEGER)
          INTO :CODIGO
          DO
          BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM FAT_VENDAS_ITENS
             WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                   SUSPEND;
             END
          END
     END

     IF (( :NDOCTO <> '' ) AND ( :PESSOA_FJ <= 0 ))
     THEN BEGIN
          FOR SELECT NDOCTO, PESSOA_FJ
          FROM EST_ENTRADAS
          WHERE NDOCTO = :NDOCTO AND DATA_NF >= :INICIAL AND DATA_NF <= :FINAL
          AND CNPJ = :CNPJ
          ORDER BY CNPJ, NDOCTO, PESSOA_FJ
          INTO :NDOCTO, :PESSOA_FJ
          DO BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM EST_ENTRADAS_ITENS
             WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                SELECT NOME FROM EST_PRODUTOS
                WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                ORDER BY CNPJ, CODIGO
                INTO :NOME_PRODUTO ;

                SUSPEND;
             END
         END

          /* TABELA DE VENDAS */
          /* VENDAS COM NATUREZA DE ENTRADA ( DEVOLUCAO ) */
          FOR SELECT VD.CODIGO
          FROM FAT_VENDAS VD
          inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
          WHERE VD.CNPJ = :CNPJ AND DATA_CAIXA >= :INICIAL
          AND DATA_CAIXA <= :FINAL AND FECHADA = 'S'
          AND ENVIADA_CX = 'S' AND CANCELADA <> 'S'
          AND NAT.ES = 'S' AND VD.CODIGO = CAST(:NDOCTO AS INTEGER)
          INTO :CODIGO
          DO
          BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM FAT_VENDAS_ITENS
             WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                   SUSPEND;
             END
          END
     END

     IF (( :NDOCTO = '' ) AND ( :PESSOA_FJ <= 0 ))
     THEN BEGIN
          /* TABELA DE ENTRADAS */
          FOR SELECT NDOCTO, PESSOA_FJ
          FROM EST_ENTRADAS
          WHERE DATA_NF >= :INICIAL AND DATA_NF <= :FINAL AND CNPJ = :CNPJ
          ORDER BY CNPJ, NDOCTO, PESSOA_FJ
          INTO :NDOCTO, :PESSOA_FJ
          DO BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM EST_ENTRADAS_ITENS
             WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                SELECT NOME FROM EST_PRODUTOS
                WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                ORDER BY CNPJ, CODIGO
                INTO :NOME_PRODUTO ;

                SUSPEND;
             END
          END

          /* TABELA DE VENDAS */
          /* VENDAS COM NATUREZA DE ENTRADA ( DEVOLUCAO ) */
          FOR SELECT VD.CODIGO
          FROM FAT_VENDAS VD
          inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
          WHERE VD.CNPJ = :CNPJ AND DATA_CAIXA >= :INICIAL
          AND DATA_CAIXA <= :FINAL AND FECHADA = 'S'
          AND ENVIADA_CX = 'S' AND CANCELADA <> 'S'
          AND NAT.ES = 'S'
          INTO :CODIGO
          DO
          BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM FAT_VENDAS_ITENS
             WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                   SUSPEND;
             END
          END
     END

     IF (( :NDOCTO = '' ) AND ( :PESSOA_FJ > 0 ))
     THEN BEGIN
          FOR SELECT NDOCTO, PESSOA_FJ
          FROM EST_ENTRADAS
          WHERE DATA_NF >= :INICIAL AND DATA_NF <= :FINAL AND CNPJ = :CNPJ
          AND PESSOA_FJ = :PESSOA_FJ
          ORDER BY CNPJ, NDOCTO, PESSOA_FJ
          INTO :NDOCTO, :PESSOA_FJ
          DO BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM EST_ENTRADAS_ITENS
             WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                SELECT NOME FROM EST_PRODUTOS
                WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                ORDER BY CNPJ, CODIGO
                INTO :NOME_PRODUTO ;

                SUSPEND;
             END
          END

          /* TABELA DE VENDAS */
          /* VENDAS COM NATUREZA DE ENTRADA ( DEVOLUCAO ) */
          FOR SELECT VD.CODIGO
          FROM FAT_VENDAS VD
          inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
          WHERE VD.CNPJ = :CNPJ AND DATA_CAIXA >= :INICIAL
          AND DATA_CAIXA <= :FINAL AND FECHADA = 'S'
          AND ENVIADA_CX = 'S' AND CANCELADA <> 'S'
          AND NAT.ES = 'S' AND PESSOA_FJ = :PESSOA_FJ
          INTO :CODIGO
          DO
          BEGIN
             FOR SELECT PRODUTO, SUM(QUANTIDADE), SUM(PRC_CUSTO*QUANTIDADE),
             SUM(PRC_UNITARIO*QUANTIDADE)
             FROM FAT_VENDAS_ITENS
             WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
             GROUP BY PRODUTO
             INTO  :PRODUTO, :QUANTIDADE,  :PRC_CUSTO, :PRC_CUSTO_DIG
             DO BEGIN
                   SUSPEND;
             END
          END

     END
END
^

ALTER PROCEDURE VER_EST_ENT_ITENS_CONF (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    QUANTIDADE FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_VENDA FLOAT,
    IPI FLOAT,
    DESCONTOS FLOAT,
    FRETE FLOAT,
    NOME_PRODUTO VARCHAR(50),
    ORDEM INTEGER)
AS
BEGIN
     FOR SELECT
         PRODUTO, QUANTIDADE, PRC_UNITARIO, PRC_VENDA, IPI, DESCONTOS, FRETE,
         ORDEM
     FROM EST_ENTRADAS_ITENS
     WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND PESSOA_FJ = :PESSOA_FJ
     INTO  :PRODUTO, :QUANTIDADE, :PRC_UNITARIO, :PRC_VENDA, :IPI, :DESCONTOS, :FRETE,
     :ORDEM
     DO BEGIN
        SELECT NOME FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO :NOME_PRODUTO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_ENTRADAS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    NDOCTO VARCHAR(20),
    PRODUTO VARCHAR(15),
    UNIDADE CHAR(4),
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PERC_LUCRO NUMERIC(12,2),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    IPI_PRODUTO NUMERIC(18,4),
    TAXAS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    EMBALAGEM NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    DATA_NF TIMESTAMP,
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    NATUREZA INTEGER)
AS
BEGIN
     IF ( PESSOA_FJ > 0 )
     THEN BEGIN
        FOR SELECT NDOCTO, DATA_NF,  DATA_REF, DATA_ENT, SERIE_NF, NATUREZA,
        NOME
        FROM EST_ENTRADAS
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        INTO :NDOCTO, :DATA_NF,  :DATA_REF, :DATA_ENT, :SERIE_NF, :NATUREZA, :NOME
        DO BEGIN
           FOR SELECT
           PRODUTO, UNIDADE, QUANTIDADE, PRC_UNITARIO, PERC_LUCRO, PRC_VENDA,
           PRC_VENDA_ANT, PRC_CUSTO, ICM, ICM_SUBS, IPI, IPI_PRODUTO, TAXAS,
           DESCONTOS, EMBALAGEM, FRETE, SEGURO, NOME_PRODUTO, SUBUNIDADE
           FROM EST_ENTRADAS_ITENS
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND NDOCTO =:NDOCTO
           INTO
             :PRODUTO, :UNIDADE, :QUANTIDADE, :PRC_UNITARIO,
             :PERC_LUCRO, :PRC_VENDA, :PRC_VENDA_ANT, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :IPI_PRODUTO, :TAXAS, :DESCONTOS,
             :EMBALAGEM, :FRETE, :SEGURO, :NOME_PRODUTO, :SUBUNIDADE
           DO BEGIN
              SUSPEND;
           END
        END
     END
     ELSE BEGIN
        FOR SELECT NDOCTO, DATA_NF,  DATA_REF, DATA_ENT, SERIE_NF, NATUREZA,
        NOME, PESSOA_FJ
        FROM EST_ENTRADAS
        WHERE CNPJ = :CNPJ
        INTO :NDOCTO, :DATA_NF,  :DATA_REF, :DATA_ENT, :SERIE_NF, :NATUREZA, :NOME,
        :PESSOA_FJ
        DO BEGIN
           FOR SELECT
           PRODUTO, UNIDADE, QUANTIDADE, PRC_UNITARIO, PERC_LUCRO, PRC_VENDA,
           PRC_VENDA_ANT, PRC_CUSTO, ICM, ICM_SUBS, IPI, IPI_PRODUTO, TAXAS,
           DESCONTOS, EMBALAGEM, FRETE, SEGURO, NOME_PRODUTO, SUBUNIDADE
           FROM EST_ENTRADAS_ITENS
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND NDOCTO =:NDOCTO
           INTO
             :PRODUTO, :UNIDADE, :QUANTIDADE, :PRC_UNITARIO,
             :PERC_LUCRO, :PRC_VENDA, :PRC_VENDA_ANT, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :IPI_PRODUTO, :TAXAS, :DESCONTOS,
             :EMBALAGEM, :FRETE, :SEGURO, :NOME_PRODUTO, :SUBUNIDADE
           DO BEGIN
              SUSPEND;
           END
        END
     END
END
^

ALTER PROCEDURE VER_EST_ENTRADAS_CONFERENTE (
    CNPJ CHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    NDOCTO VARCHAR(20),
    NDOCTOINT INTEGER,
    PESSOA_FJ INTEGER,
    DATA_NF TIMESTAMP,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    TAXAS FLOAT,
    VLR_EMBALAGEM FLOAT,
    VLR_FRETE FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_PRODUTOS FLOAT,
    VLR_SEGURO FLOAT,
    VLR_BC_ICM FLOAT,
    PERC_ICM FLOAT,
    VLR_ICM FLOAT,
    VLR_IPI FLOAT,
    VLR_ICM_SUBS FLOAT,
    PROC_QTD CHAR(1),
    PROC_FIN CHAR(1),
    PROC_CUSTO CHAR(1),
    FRETE_LF CHAR(1))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE UTILIZA_DOCTOS_INT_ENTR CHAR(1);
BEGIN
     select utiliza_doctos_int_entr from sis_empresas
     where cnpj = :cnpj
     into :utiliza_doctos_int_entr ;

     for select et.ndocto, et.pessoa_fj, data_nf,
                natureza, data_ref, data_ent, serie_nf,
                et.taxas, vlr_embalagem, vlr_frete,
                vlr_desconto, vlr_seguro, vlr_bc_icm,
                perc_icm, vlr_icm, vlr_ipi, vlr_icm_subs,
                proc_qtd, proc_fin, frete_lf, vlr_produtos,
                proc_custo
     from est_entradas et
     where et.cnpj = :cnpj and (data_ent between :dt_inicial and :dt_final)
     order by et.ndocto, et.pessoa_fj
     into :ndocto, :pessoa_fj, :data_nf,
          :natureza, :data_ref, :data_ent, :serie_nf,
          :taxas, :vlr_embalagem, :vlr_frete,
          :vlr_desconto, :vlr_seguro, :vlr_bc_icm,
          :perc_icm, :vlr_icm, :vlr_ipi, :vlr_icm_subs,
          :proc_qtd, :proc_fin, :frete_lf, :vlr_produtos,
          :proc_custo
     do begin

        if (utiliza_doctos_int_entr <> 'N') then
        begin
--          select inteiro from digitos(:ndocto)
--          into :ndoctoint;
        end
        else
          ndoctoint = 0;
     
        select nome_razao from glo_pessoas_fj
        where cnpj = :cnpj and  codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome_razao ;

        /*pegando somente os que possuem itens*/
        select count(*) from est_entradas_itens eti
        where eti.cnpj = :cnpj and eti.pessoa_fj = :pessoa_fj and eti.ndocto = :ndocto
        into :cont;


           suspend;
        
     END



    /* VENDAS COM NATUREZA DE ENTRADA*/
    for select vd.pessoa_fj, vd.natureza, vd.num_nf, vd.total, vd.data_caixa, vd.codigo, nat.perc_icms,
    vd.desc_acres
    from fat_vendas vd
    inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
    where vd.cnpj = :cnpj and (vd.data_caixa between :dt_inicial and :dt_final) and vd.fechada = 'S'
    and vd.enviada_cx = 'S' and vd.cancelada <> 'S' and nat.es = 'E'
    into :pessoa_fj, :natureza, :ndocto, :vlr_produtos, :data_nf, :ndoctoint, :perc_icm,
    :vlr_desconto
    do
    begin
       vlr_bc_icm = :vlr_produtos ;
       data_ref   = :data_nf      ;
       data_ent   = :data_nf      ;
       serie_nf   = 'VND'         ;
    
       select psa.nome_razao from glo_pessoas_fj psa
       where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
       into :nome_razao ;
       
       suspend;
    end
END
^

ALTER PROCEDURE VER_EST_ENTRADAS_MANUAL
RETURNS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    GRUPO INTEGER,
    FORNECEDOR INTEGER,
    NDOCTO VARCHAR(20),
    NOME_GRUPO VARCHAR(50),
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    VLR_CAIXA NUMERIC(18,4),
    VLR_EMBALAGEM NUMERIC(18,4),
    VLR_COMPRA NUMERIC(18,4),
    VLR_IPI NUMERIC(18,4),
    VLR_FRETE_PROPRIO NUMERIC(18,4),
    VLR_FRETE_TERCEIRO NUMERIC(18,4),
    VLR_TRIBUTACAO_CREDITO NUMERIC(18,4),
    VLR_OUTRAS_DESPESAS NUMERIC(18,4),
    QUANTIDADE NUMERIC(18,4),
    VLR_VENDA NUMERIC(18,4),
    VLR_LUCRO NUMERIC(18,4),
    VLR_CUSTO_TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    VLR_RENTABILIDADE NUMERIC(18,4),
    VLR_ICM_VENDA NUMERIC(18,4),
    MARGEM_LUCRO NUMERIC(18,4),
    TOT_FRETE_TERCEIRO NUMERIC(18,4),
    TOT_ICM_CREDITO NUMERIC(18,4),
    TOT_ICM_DEBITO NUMERIC(18,4),
    TOT_RENTABILIDADE NUMERIC(18,4),
    TOT_IPI NUMERIC(18,4),
    TOT_DESP_OPERACIONAL NUMERIC(18,4),
    TOT_DESP_FEDERAL NUMERIC(18,4),
    TOT_FRETE_PROPRIO NUMERIC(18,4),
    HORA TIME,
    VLR_VENDA_ANTERIOR NUMERIC(18,4))
AS
BEGIN
  FOR SELECT CNPJ,
             CODIGO,
             DATA,
             PRODUTO,
             NOME,
             VLR_CAIXA,
             VLR_EMBALAGEM,
             VLR_COMPRA,
             VLR_IPI,
             VLR_FRETE_PROPRIO,
             VLR_FRETE_TERCEIRO,
             VLR_TRIBUTACAO_CREDITO,
             VLR_OUTRAS_DESPESAS,
             QUANTIDADE,
             VLR_VENDA,
             VLR_LUCRO,
             VLR_CUSTO_TOTAL,
             FECHADA,
             VLR_RENTABILIDADE,
             VLR_ICM_VENDA,
             MARGEM_LUCRO,
             TOT_FRETE_TERCEIRO,
             TOT_ICM_CREDITO,
             TOT_ICM_DEBITO,
             TOT_RENTABILIDADE,
             TOT_IPI,
             TOT_DESP_OPERACIONAL,
             TOT_DESP_FEDERAL,
             TOT_FRETE_PROPRIO,
             HORA,
             VLR_VENDA_ANTERIOR,
             FORNECEDOR,
             NDOCTO
      FROM EST_ENTRADAS_MANUAL
      INTO :CNPJ,
           :CODIGO,
           :DATA,
           :PRODUTO,
           :NOME,
           :VLR_CAIXA,
           :VLR_EMBALAGEM,
           :VLR_COMPRA,
           :VLR_IPI,
           :VLR_FRETE_PROPRIO,
           :VLR_FRETE_TERCEIRO,
           :VLR_TRIBUTACAO_CREDITO,
           :VLR_OUTRAS_DESPESAS,
           :QUANTIDADE,
           :VLR_VENDA,
           :VLR_LUCRO,
           :VLR_CUSTO_TOTAL,
           :FECHADA,
           :VLR_RENTABILIDADE,
           :VLR_ICM_VENDA,
           :MARGEM_LUCRO,
           :TOT_FRETE_TERCEIRO,
           :TOT_ICM_CREDITO,
           :TOT_ICM_DEBITO,
           :TOT_RENTABILIDADE,
           :TOT_IPI,
           :TOT_DESP_OPERACIONAL,
           :TOT_DESP_FEDERAL,
           :TOT_FRETE_PROPRIO,
           :HORA,
           :VLR_VENDA_ANTERIOR,
           :FORNECEDOR,
           :NDOCTO
  DO
  BEGIN
    SELECT GRUPO
    FROM EST_PRODUTOS
    WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
    INTO :GRUPO ;

    IF ( GRUPO IS NULL )
    THEN
        GRUPO = 1  ;

    SELECT NOME FROM EST_GRUPOS
    WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
    INTO :NOME_GRUPO ;
    
    SUSPEND;
  END
END
^

ALTER PROCEDURE VER_EST_ENTRADAS_SINTEGRA (
    CNPJ CHAR(14),
    DT_INICIAL DATE,
    DT_FINAL DATE)
RETURNS (
    NDOCTO VARCHAR(20),
    NDOCTOINT INTEGER,
    PESSOA_FJ INTEGER,
    DATA_NF TIMESTAMP,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    TAXAS FLOAT,
    CNPJ_CPF VARCHAR(20),
    IE_RG VARCHAR(20),
    UF CHAR(2),
    VLR_EMBALAGEM FLOAT,
    VLR_FRETE FLOAT,
    VLR_DESCONTO FLOAT,
    VLR_PRODUTOS FLOAT,
    VLR_SEGURO FLOAT,
    VLR_BC_ICM FLOAT,
    PERC_ICM FLOAT,
    VLR_ICM FLOAT,
    VLR_IPI FLOAT,
    VLR_ICM_SUBS FLOAT,
    PROC_QTD CHAR(1),
    PROC_FIN CHAR(1),
    PROC_CUSTO CHAR(1),
    FRETE_LF CHAR(1))
AS
BEGIN EXIT; END
^

ALTER PROCEDURE VER_EST_ENTRADAS_SINTEGRA_ITENS (
    CNPJ CHAR(14),
    NDOCTO VARCHAR(20),
    PESSOA_FJ INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    UNIDADE CHAR(4),
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PERC_LUCRO NUMERIC(12,2),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    IPI_PRODUTO NUMERIC(18,4),
    TAXAS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    EMBALAGEM NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    SUBUNIDADE INTEGER,
    DATA_NF TIMESTAMP,
    DATA_REF TIMESTAMP,
    DATA_ENT TIMESTAMP,
    SERIE_NF CHAR(3),
    NATUREZA INTEGER,
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    ORDEM INTEGER)
AS
BEGIN FOR SELECT DATA_NF,  DATA_REF, DATA_ENT, SERIE_NF, NATUREZA
      FROM EST_ENTRADAS
      WHERE CNPJ = :CNPJ AND NDOCTO = :NDOCTO AND
      PESSOA_FJ = :PESSOA_FJ
      INTO :DATA_NF,  :DATA_REF, :DATA_ENT, :SERIE_NF, :NATUREZA
      DO BEGIN
         FOR SELECT
         PRODUTO, UNIDADE, QUANTIDADE, PRC_UNITARIO, PERC_LUCRO, PRC_VENDA,
         PRC_VENDA_ANT, PRC_CUSTO, ICM, ICM_SUBS, IPI, IPI_PRODUTO, TAXAS,
         DESCONTOS, EMBALAGEM, FRETE, SEGURO, NOME_PRODUTO, SUBUNIDADE,
         ORDEM
         FROM EST_ENTRADAS_ITENS
         WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ AND NDOCTO =:NDOCTO
         INTO
           :PRODUTO, :UNIDADE, :QUANTIDADE, :PRC_UNITARIO,
           :PERC_LUCRO, :PRC_VENDA, :PRC_VENDA_ANT, :PRC_CUSTO,
           :ICM, :ICM_SUBS, :IPI, :IPI_PRODUTO, :TAXAS, :DESCONTOS,
           :EMBALAGEM, :FRETE, :SEGURO, :NOME_PRODUTO, :SUBUNIDADE,
           :ORDEM
         DO BEGIN
           SELECT ORIGEM, CTE, CTIE FROM EST_PRODUTOS P
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
           ORDER BY CNPJ, CODIGO
           INTO :ORIGEM, :CTE, :CTIE;

           IF ( ORIGEM IS NULL )
           THEN
             ORIGEM = 0;
           
           IF ( CTE IS NULL )
           THEN
             CTE = 0;

           IF ( CTIE IS NULL )
           THEN
             CTIE = 0;

           SUSPEND;
         END
      END
END
^

ALTER PROCEDURE VER_EST_ESTIQUETA_PRODUTO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    NOME VARCHAR(50),
    GRUPO VARCHAR(50),
    MARCA VARCHAR(50),
    COR VARCHAR(50),
    SUBGRUPO VARCHAR(50),
    EMPRESA VARCHAR(50),
    VALOR NUMERIC(18,4),
    QUANTIDADE INTEGER,
    SEQUENCIA INTEGER,
    NUMERO VARCHAR(6),
    GRADE CHAR(4),
    CONT_NUMEROS INTEGER)
AS
DECLARE VARIABLE G INTEGER;
DECLARE VARIABLE S INTEGER;
DECLARE VARIABLE M INTEGER;
BEGIN
      SELECT NOME
      FROM SIS_EMPRESAS
      WHERE CNPJ = :CNPJ
      INTO :EMPRESA ;

      FOR SELECT
         CODIGO, NOME, VALOR, QUANTIDADE, SEQUENCIA,
         NUMERO, GRADE
      FROM EST_ESTIQUETA_PRODUTO_IMPRIME e
      WHERE CNPJ = :CNPJ
      INTO :CODIGO, :NOME, :VALOR, :QUANTIDADE,
           :SEQUENCIA, :NUMERO, :GRADE
      DO BEGIN
         select count(*) from est_produtos_grades_numeros n
         where n.cnpj = :cnpj and n.produto = :codigo
         into :CONT_NUMEROS;

         SELECT NOME_COR
         FROM EST_PRODUTOS_GRADES
         WHERE CNPJ = :CNPJ AND PRODUTO = :CODIGO AND GRADE = :GRADE
         INTO :COR ;

         SELECT GRUPO, SUBGRUPO, MARCA, CODIGO_2
         FROM EST_PRODUTOS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO :G, :S, :M, :CODIGO_2 ;

         SELECT NOME
         FROM EST_MARCAS
         WHERE CNPJ = :CNPJ AND CODIGO = :M
         INTO :MARCA ;

         SELECT NOME
         FROM EST_GRUPOS
         WHERE CNPJ = :CNPJ AND CODIGO = :G
         INTO :GRUPO ;

         SELECT NOME
         FROM EST_SUBGRUPOS
         WHERE CNPJ = :CNPJ AND GRUPO = :G AND SUBGRUPO = :S
         INTO :SUBGRUPO ;

         SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_FECHAMENTO_MES (
    CNPJ CHAR(14),
    MES INTEGER,
    ANO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    DATA TIMESTAMP,
    SALDO_INICIAL NUMERIC(18,4),
    ENTRADAS NUMERIC(18,4),
    SAIDAS NUMERIC(18,4),
    GRUPO INTEGER,
    CUSTO NUMERIC(18,4),
    SUB_GRUPO INTEGER)
AS
BEGIN
      FOR SELECT PRODUTO, DATA,
      SALDO_INICIAL, ENTRADAS, SAIDAS
      FROM EST_FECHAMENTO_MES
      WHERE CNPJ = :CNPJ AND ANO = :ANO AND MES = :MES
      INTO :PRODUTO,
           :DATA,
           :SALDO_INICIAL,
           :ENTRADAS,
           :SAIDAS
      DO
      BEGIN
           SELECT GRUPO, SUBGRUPO, PRC_REPOS, NOME
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           ORDER BY CNPJ, CODIGO
           INTO :GRUPO, :SUB_GRUPO, :CUSTO, :NOME;

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_EST_GRADES (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER)
AS
BEGIN
      FOR SELECT CODIGO, NOME, INICIAL, FINAL, INTERVALO
      FROM EST_GRADES
      WHERE CNPJ = :CNPJ
      INTO :CODIGO, :NOME, :INICIAL, :FINAL, :INTERVALO
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_EST_GRADES_ADICIONAL (
    CNPJ CHAR(14),
    GRADE INTEGER)
RETURNS (
    CODIGO VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
     FOR SELECT
             CODIGO,
             ORDEM
     FROM EST_GRADES_ADICIONAL
     WHERE CNPJ = :CNPJ AND GRADE = :GRADE
     INTO :CODIGO,
          :ORDEM
     DO BEGIN
        IF ( ORDEM IS NULL )
        THEN
            ORDEM = 0;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_GRADES_NUMEROS (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER,
    GRADE VARCHAR(6),
    ORDEM INTEGER)
AS
BEGIN
      FOR SELECT CODIGO, NOME, INICIAL, FINAL, INTERVALO
      FROM EST_GRADES
      WHERE CNPJ = :CNPJ
      INTO :CODIGO, :NOME, :INICIAL, :FINAL, :INTERVALO
      DO BEGIN
         FOR SELECT CODIGO, ORDEM
         FROM EST_GRADES_ADICIONAL
         WHERE CNPJ = :CNPJ AND GRADE = :CODIGO
         INTO :GRADE, :ORDEM
         DO BEGIN
            SUSPEND;
         END
      END
END
^

ALTER PROCEDURE VER_EST_POSICAO_DIARIA (
    CNPJ CHAR(14),
    DINICIAL DATE,
    DFINAL DATE)
RETURNS (
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    LEITURA NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VENDA NUMERIC(18,4),
    CONTAGEM NUMERIC(18,4),
    POSICAO NUMERIC(18,4),
    INICIAL NUMERIC(18,4),
    CUSTO NUMERIC(18,4),
    TROCAS_SAI NUMERIC(18,4),
    TROCAS_ENT NUMERIC(18,4),
    GARANTIAS_SAI NUMERIC(18,4),
    GARANTIAS_ENT NUMERIC(18,4))
AS
BEGIN
     FOR SELECT
         DATA, PRODUTO, NOME,
         LEITURA, ENTRADA, VENDA,
         CONTAGEM, POSICAO, INICIAL, CUSTO,
         TROCAS_SAI, TROCAS_ENT, GARANTIAS_ENT, GARANTIAS_SAI
     FROM EST_POSICAO_DIARIA
     WHERE CNPJ = :CNPJ AND DATA >= :DINICIAL AND DATA <= :DFINAL
     ORDER BY CNPJ, DATA, PRODUTO
     INTO
        :DATA, :PRODUTO, :NOME,
        :LEITURA, :ENTRADA, :VENDA,
        :CONTAGEM, :POSICAO, :INICIAL, :CUSTO,
        :TROCAS_SAI, :TROCAS_ENT, :GARANTIAS_ENT, :GARANTIAS_SAI
     DO
     BEGIN
          SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_POSICAO_DIARIA_GRUPO (
    CNPJ CHAR(14),
    DINICIAL DATE,
    DFINAL DATE,
    GRUPO INTEGER)
RETURNS (
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    LEITURA NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    VENDA NUMERIC(18,4),
    CONTAGEM NUMERIC(18,4),
    POSICAO NUMERIC(18,4),
    INICIAL NUMERIC(18,4),
    GARANTIAS_SAI NUMERIC(18,4),
    GARANTIAS_ENT NUMERIC(18,4),
    TROCAS_SAI NUMERIC(18,4),
    TROCAS_ENT NUMERIC(18,4))
AS
BEGIN
     FOR SELECT
         DATA, PRODUTO, NOME,
         LEITURA, ENTRADA, VENDA,
         CONTAGEM, POSICAO, INICIAL,
         GARANTIAS_ENT, GARANTIAS_SAI,
         TROCAS_ENT, TROCAS_SAI
     FROM EST_POSICAO_DIARIA
     WHERE CNPJ = :CNPJ AND DATA >= :DINICIAL AND DATA <= :DFINAL
     AND GRUPO = :GRUPO
     ORDER BY CNPJ, DATA, PRODUTO
     INTO
        :DATA, :PRODUTO, :NOME,
        :LEITURA, :ENTRADA, :VENDA,
        :CONTAGEM, :POSICAO, :INICIAL,
        :GARANTIAS_ENT, :GARANTIAS_SAI,
        :TROCAS_ENT, :TROCAS_SAI
     DO
     BEGIN
          SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_POSICAO_ESTOQUE_GRADE (
    CNPJ CHAR(14))
RETURNS (
    ESTOQUE NUMERIC(15,4),
    CODIGO VARCHAR(15),
    NUMERO VARCHAR(6),
    ORDEM INTEGER,
    GRADE CHAR(4),
    CODIGO_2 VARCHAR(15),
    ATIVO CHAR(1),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    PRODUTO VARCHAR(50),
    MARCA VARCHAR(50),
    PERFIL VARCHAR(50),
    COR VARCHAR(50),
    CODPERFIL INTEGER,
    CODMARCA INTEGER,
    VALOR NUMERIC(18,4))
AS
BEGIN
  for
    select pgn.estoque, pgn.produto, pgn.numero, pgn.ordem, pgn.grade,
    p.codigo_2, p.ativo, p.grupo, p.subgrupo, p.nome, p.nome_marca, p.marca,
    p.prc_venda
    from est_produtos_grades_numeros pgn
    inner join est_produtos p on (p.codigo = pgn.produto)
    where p.cnpj = :cnpj
    into :estoque, :codigo, :numero, :ordem, :grade, :codigo_2, :ativo, :grupo,
         :subgrupo, :produto, :marca, :codmarca, :valor
  do
  begin
    for select g.nome, g.codigo, pg.nome_cor
    from est_produtos_grades pg
    inner join est_grades g on (g.codigo = pg.perfil)
    where pg.cnpj = :cnpj and pg.produto = :codigo
    into :perfil, :codperfil, :cor do
    begin
      suspend;
    end
  end
END
^

ALTER PROCEDURE VER_EST_PRODUTOS (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    NOME_MARCA VARCHAR(50),
    PRC_CUSTO_CODIF VARCHAR(15),
    ATUALIZAR CHAR(1))
AS
BEGIN
  FOR SELECT CNPJ,
             CODIGO,
             CODIGO_2,
             CNPJ_AGRUP,
             COD_AGRUP,
             NOME,
             MARCA,
             GRUPO,
             SUBGRUPO,
             REDUCAO,
             UNIDADE,
             CTE,
             CTIE,
             QTDADE_1,
             QTDADE_2,
             LOCALIZACAO_1,
             LOCALIZACAO_2,
             LOCALIZACAO_3,
             NEG_QTDADE_2,
             QTDADE_MIN,
             QTDADE_MAX,
             COMPLEMENTO_NF,
             DT_ULT_COMPRA,
             QT_ULT_COMPRA,
             DT_ULT_VENDA,
             MARGEM_BRUTA,
             PRC_REPOS,
             PRC_CUSTO_ANT,
             PRC_CUSTO_MED,
             PRC_VENDA,
             PRC_VENDA_ANT,
             PRC_VENDA_MED,
             ALIQUOTA_ECF,
             ORIGEM,
             PESO_LIQ,
             PERC_FRETE,
             IPI,
             VOLUME,
             PROD_PESAVEL,
             ETIQUETA_ENT,
             ATIVO,
             ULTIMO_FORNECEDOR,
             FORNECEDOR,
             SUBUNIDADE,
             NOME_MARCA,
             PRC_CUSTO_CODIF ,
             ATUALIZAR
      FROM EST_PRODUTOS
      WHERE CNPJ = :EMPRESA
      INTO :CNPJ,
           :CODIGO,
           :CODIGO_2,
           :CNPJ_AGRUP,
           :COD_AGRUP,
           :NOME,
           :MARCA,
           :GRUPO,
           :SUBGRUPO,
           :REDUCAO,
           :UNIDADE,
           :CTE,
           :CTIE,
           :QTDADE_1,
           :QTDADE_2,
           :LOCALIZACAO_1,
           :LOCALIZACAO_2,
           :LOCALIZACAO_3,
           :NEG_QTDADE_2,
           :QTDADE_MIN,
           :QTDADE_MAX,
           :COMPLEMENTO_NF,
           :DT_ULT_COMPRA,
           :QT_ULT_COMPRA,
           :DT_ULT_VENDA,
           :MARGEM_BRUTA,
           :PRC_REPOS,
           :PRC_CUSTO_ANT,
           :PRC_CUSTO_MED,
           :PRC_VENDA,
           :PRC_VENDA_ANT,
           :PRC_VENDA_MED,
           :ALIQUOTA_ECF,
           :ORIGEM,
           :PESO_LIQ,
           :PERC_FRETE,
           :IPI,
           :VOLUME,
           :PROD_PESAVEL,
           :ETIQUETA_ENT,
           :ATIVO,
           :ULTIMO_FORNECEDOR,
           :FORNECEDOR,
           :SUBUNIDADE,
           :NOME_MARCA,
           :PRC_CUSTO_CODIF,
           :ATUALIZAR
  DO
      BEGIN
           SELECT NOME FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
           INTO :NOME_GRUPO ;

           SELECT NOME FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
           INTO :NOME_SUBGRUPO ;
           
           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_EST_PRODUTOS_GRADES (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ CHAR(14),
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CNPJ_AGRUP CHAR(14),
    COD_AGRUP VARCHAR(15),
    NOME VARCHAR(50),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    REDUCAO INTEGER,
    UNIDADE CHAR(4),
    CTE SMALLINT,
    CTIE SMALLINT,
    QTDADE_1 NUMERIC(18,4),
    QTDADE_2 NUMERIC(18,4),
    LOCALIZACAO_1 VARCHAR(30),
    LOCALIZACAO_2 VARCHAR(30),
    LOCALIZACAO_3 VARCHAR(30),
    NEG_QTDADE_2 CHAR(1),
    QTDADE_MIN INTEGER,
    QTDADE_MAX INTEGER,
    COMPLEMENTO_NF CHAR(1),
    DT_ULT_COMPRA TIMESTAMP,
    QT_ULT_COMPRA INTEGER,
    DT_ULT_VENDA TIMESTAMP,
    MARGEM_BRUTA NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_ANT NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    PRC_VENDA_ANT NUMERIC(18,4),
    PRC_VENDA_MED NUMERIC(18,4),
    ALIQUOTA_ECF CHAR(5),
    ORIGEM SMALLINT,
    PESO_LIQ NUMERIC(18,4),
    PERC_FRETE NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PROD_PESAVEL CHAR(1),
    ETIQUETA_ENT CHAR(1),
    ATIVO CHAR(1),
    ULTIMO_FORNECEDOR INTEGER,
    FORNECEDOR INTEGER,
    SUBUNIDADE INTEGER,
    PRC_CUSTO_CODIF VARCHAR(15),
    GRADE CHAR(4),
    MATERIAL INTEGER,
    COR INTEGER,
    ULTIMA_COMPRA TIMESTAMP,
    QTDADE_COMPRA NUMERIC(18,4),
    ULTIMA_VENDA TIMESTAMP,
    QTDADE_VENDA NUMERIC(18,4),
    ESTOQUE NUMERIC(18,4),
    PERFIL INTEGER,
    INICIAL INTEGER,
    FINAL INTEGER,
    INTERVALO INTEGER,
    NOME_PERFIL VARCHAR(50),
    NOME_COR VARCHAR(50),
    NOME_MATERIAL VARCHAR(50),
    NUMERO INTEGER)
AS
BEGIN
  FOR SELECT CNPJ,
             CODIGO,
             CODIGO_2,
             CNPJ_AGRUP,
             COD_AGRUP,
             NOME,
             MARCA,
             GRUPO,
             SUBGRUPO,
             REDUCAO,
             UNIDADE,
             CTE,
             CTIE,
             QTDADE_1,
             QTDADE_2,
             LOCALIZACAO_1,
             LOCALIZACAO_2,
             LOCALIZACAO_3,
             NEG_QTDADE_2,
             QTDADE_MIN,
             QTDADE_MAX,
             COMPLEMENTO_NF,
             DT_ULT_COMPRA,
             QT_ULT_COMPRA,
             DT_ULT_VENDA,
             MARGEM_BRUTA,
             PRC_REPOS,
             PRC_CUSTO_ANT,
             PRC_CUSTO_MED,
             PRC_VENDA,
             PRC_VENDA_ANT,
             PRC_VENDA_MED,
             ALIQUOTA_ECF,
             ORIGEM,
             PESO_LIQ,
             PERC_FRETE,
             IPI,
             VOLUME,
             PROD_PESAVEL,
             ETIQUETA_ENT,
             ATIVO,
             ULTIMO_FORNECEDOR,
             FORNECEDOR,
             SUBUNIDADE,
             NOME_MARCA,
             PRC_CUSTO_CODIF
      FROM EST_PRODUTOS
      WHERE CNPJ = :EMPRESA
      INTO :CNPJ,
           :CODIGO,
           :CODIGO_2,
           :CNPJ_AGRUP,
           :COD_AGRUP,
           :NOME,
           :MARCA,
           :GRUPO,
           :SUBGRUPO,
           :REDUCAO,
           :UNIDADE,
           :CTE,
           :CTIE,
           :QTDADE_1,
           :QTDADE_2,
           :LOCALIZACAO_1,
           :LOCALIZACAO_2,
           :LOCALIZACAO_3,
           :NEG_QTDADE_2,
           :QTDADE_MIN,
           :QTDADE_MAX,
           :COMPLEMENTO_NF,
           :DT_ULT_COMPRA,
           :QT_ULT_COMPRA,
           :DT_ULT_VENDA,
           :MARGEM_BRUTA,
           :PRC_REPOS,
           :PRC_CUSTO_ANT,
           :PRC_CUSTO_MED,
           :PRC_VENDA,
           :PRC_VENDA_ANT,
           :PRC_VENDA_MED,
           :ALIQUOTA_ECF,
           :ORIGEM,
           :PESO_LIQ,
           :PERC_FRETE,
           :IPI,
           :VOLUME,
           :PROD_PESAVEL,
           :ETIQUETA_ENT,
           :ATIVO,
           :ULTIMO_FORNECEDOR,
           :FORNECEDOR,
           :SUBUNIDADE,
           :NOME_MARCA,
           :PRC_CUSTO_CODIF
  DO
      BEGIN
           NUMERO = 0;

           SELECT NOME FROM EST_MARCAS
           WHERE CNPJ = :CNPJ AND CODIGO = :MARCA
           INTO :NOME_MARCA ;

           SELECT NOME FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
           INTO :NOME_GRUPO ;

           SELECT NOME FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
           INTO :NOME_SUBGRUPO ;

           FOR SELECT
               GRADE, MATERIAL, COR, ULTIMA_COMPRA, QTDADE_COMPRA,
               ULTIMA_VENDA, QTDADE_VENDA, ESTOQUE, PERFIL
           FROM EST_PRODUTOS_GRADES
           WHERE CNPJ = :CNPJ AND PRODUTO = :CODIGO
           INTO
               :GRADE, :MATERIAL, :COR, :ULTIMA_COMPRA, :QTDADE_COMPRA,
               :ULTIMA_VENDA, :QTDADE_VENDA, :ESTOQUE, :PERFIL
           DO BEGIN
              IF ( PERFIL IS NULL )
              THEN BEGIN
                   NOME_PERFIL   = NULL;
                   INICIAL       = 0   ;
                   FINAL         = 0   ;
                   INTERVALO     = 0   ;
                   NOME_COR      = '<>' ;
                   NOME_MATERIAL = '<>' ;
                   PERFIL        = 0   ;

                   SUSPEND;
              END
              ELSE BEGIN
                SELECT NOME, INICIAL, FINAL, INTERVALO
                FROM EST_GRADES
                WHERE CNPJ = :CNPJ AND CODIGO = :PERFIL
                INTO :NOME_PERFIL, :INICIAL, :FINAL, :INTERVALO ;

                SELECT NOME_COR, NOME_MATERIAL
                FROM EST_PRODUTOS_GRADES
                WHERE CNPJ = :CNPJ AND PRODUTO = :CODIGO AND GRADE = :GRADE
                INTO :NOME_COR, :NOME_MATERIAL ;

                SUSPEND;
              END
            END
      END
END
^

ALTER PROCEDURE VER_EST_PRODUTOS_GRADES_NUMEROS (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    GRADE CHAR(4))
RETURNS (
    ESTOQUE NUMERIC(18,4),
    NUMERO VARCHAR(6),
    ORDEM INTEGER)
AS
DECLARE VARIABLE LETRA CHAR(1);
DECLARE VARIABLE ACHOU CHAR(1);
DECLARE VARIABLE I INTEGER;
DECLARE VARIABLE LEN INTEGER;
BEGIN
     FOR SELECT
             NUMERO,
             ORDEM,
             ESTOQUE
     FROM EST_PRODUTOS_GRADES_NUMEROS
     WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND GRADE = :GRADE
     INTO
           :NUMERO,
           :ORDEM,
             :ESTOQUE
     DO BEGIN
        IF ( ORDEM IS NULL )
        THEN BEGIN
             IF ( NUMERO IS NOT NULL )
             THEN BEGIN
                  I = 1;

                  ACHOU = 'N';

                  select * from getlength(:NUMERO) into :len;

                  WHILE ( I <= LEN ) DO
                  BEGIN
                       select * from sp_substring(:numero,:i,1)
                       into :letra;

                       IF ( NOT (LETRA IN ('1', '2', '3', '4', '5', '6', '7', '8', '9', '0') ))
                       THEN BEGIN
                            ACHOU = 'S' ;
                       END

                       I = I + 1;
                  END

                  IF ( ACHOU = 'N' )
                  THEN BEGIN
                       ORDEM = CAST(NUMERO AS INTEGER) + 100;
                  END
                  ELSE BEGIN
                       ORDEM = 0;
                  END
             END
             ELSE BEGIN
                  ORDEM = 0;
             END
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_EST_PRODUTOS_TRIBUT_REVENDA (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    CTE INTEGER,
    CTIE INTEGER)
AS
BEGIN
  FOR SELECT
             CTE,
             CTIE
      FROM EST_PRODUTOS_TRIBUT_REVENDA
      WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
      INTO
           :CTE,
           :CTIE
  DO
  BEGIN
    SUSPEND;
  END
END
^

ALTER PROCEDURE VER_EST_PROMOCAO (
    CNPJ CHAR(14),
    PRODUTO VARCHAR(15),
    DATA DATE)
RETURNS (
    VALOR NUMERIC(18,4))
AS
BEGIN
      SELECT VALOR
      FROM EST_PROMOCAO
      WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND VALIDADE <= :DATA
      AND VALIDADE_FINAL >= :DATA
      INTO :VALOR ;

      SUSPEND;
END
^

ALTER PROCEDURE VER_FAT_CAIXA_GERAL_VENDEDOR (
    CNPJ CHAR(14),
    DATA DATE)
AS
DECLARE VARIABLE VENDEDOR INTEGER;
DECLARE VARIABLE NOME VARCHAR(50) CHARACTER SET NONE;
DECLARE VARIABLE DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE CHEQUE NUMERIC(18,4);
DECLARE VARIABLE CARTAO NUMERIC(18,4);
DECLARE VARIABLE TICKET NUMERIC(18,4);
DECLARE VARIABLE PRAZO NUMERIC(18,4);
begin
   delete from fat_caixa_geral_vendedor ftv where ftv.cnpj = :cnpj and ftv.data = :data;
   /*percorrendo vendedores da empresa e que forem ativos*/
   for select codigo, nome
   from fat_vendedor
   where cnpj = :cnpj and ativo = 'S'
   into :vendedor, :nome
   do begin
       /*totalizando tickets*/
       select sum(coalesce(vd.ticket,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data
       into :ticket;
       if (:ticket is null) then
        ticket = 0;

       /*totalizando à prazo*/
       select sum(coalesce(vd.aprazo,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data
       into :prazo;
       /*as vendas quando sao feitas a prazo, não alimentam o campo aprazo da tabela fat_vendas por isso eu pesquiso o total e a forma de pagto*/
       if ((:prazo = 0) or (:prazo is null)) then
       begin                                                                                                           /*1 é a vista logo ela e a prazo*/
          select sum(coalesce(vd.total,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data and vd.forma_pgto <> 1
          into :prazo;
          if (:prazo is null) then
            prazo = 0;
       end

       /*totalizando cartao */
       select sum(coalesce(vd.cartao,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data
       into :cartao;
       if (:cartao is null) then
        cartao = 0;

       /*totalizando cheque */
       select sum(coalesce(vd.cheque,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data
       into :cheque;
       if (:cheque is null) then
        cheque = 0;

       /*totalizando dinheiro */
       select sum(coalesce(vd.dinheiro,0)) from fat_vendas vd where vd.cnpj = :cnpj and vd.vendedor = :vendedor and vd.data_caixa = :data
       into :dinheiro; 
       if (:dinheiro is null) then
        dinheiro = 0;

       insert into fat_caixa_geral_vendedor (cnpj, data, vendedor, nome, dinheiro, cheque,cartao, ticket, prazo)
       values (:cnpj, :data, :vendedor, :nome, :dinheiro,:cheque, :cartao, :ticket, :prazo);
   end
   suspend;
END
^

ALTER PROCEDURE VER_FAT_CAIXAS_MOVIMENTOS (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    DOCUMENTO VARCHAR(20),
    DATA TIMESTAMP,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    NOME_CONTRAPARTIDA VARCHAR(50),
    CONTRA_PARTIDA INTEGER,
    NOME VARCHAR(50),
    TIPO CHAR(1))
AS
BEGIN
      FOR SELECT
             DOCUMENTO,
             DATA,
             HISTORICO,
             VALOR,
             TIPO,
             NOME_CONTRAPARTIDA,
             CONTRA_PARTIDA,
             NOME
      FROM FAT_CAIXAS_MOVIMENTOS
      WHERE CNPJ =  :CNPJ   AND
            DATA >= :DINI  AND
            DATA <= :DFIM
      INTO 
           :DOCUMENTO,
           :DATA,
           :HISTORICO,
           :VALOR,
           :TIPO,
           :NOME_CONTRAPARTIDA,
           :CONTRA_PARTIDA,
           :NOME
      DO BEGIN
         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_CAIXAS_RESUMO_MOVTOS (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    CREDITO NUMERIC(18,4),
    DEBITO NUMERIC(18,4))
AS
BEGIN
     SELECT SUM(VALOR)
     FROM FAT_CAIXAS_RESUMO_MOVTOS
     WHERE CNPJ = :CNPJ AND DATA = :DATA AND TIPO = 'C'
     INTO :CREDITO ;

     SELECT SUM(VALOR)
     FROM FAT_CAIXAS_RESUMO_MOVTOS
     WHERE CNPJ = :CNPJ AND DATA = :DATA AND TIPO = 'D'
     INTO :DEBITO ;

     SUSPEND;
END
^

ALTER PROCEDURE VER_FAT_GARANTIAS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
BEGIN
     IF ( ORCAMENTO > 0 )
     THEN BEGIN
          SELECT PESSOA_FJ, CODIGO, DATA, TOTAL, TOTAL_2,
            FECHADO, OBSERVACAO, VENDEDOR, (TOTAL + DESC_ACRESC), (TOTAL_2 + DESC_ACRESC_2),
            DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, ENVIADA_CX, ENTRADA, DINHEIRO, CHEQUE,
            CARTAO, TICKET, DATA_CAIXA, USUARIO, TURNO
           FROM FAT_GARANTIAS
           WHERE CNPJ = :CNPJ AND CODIGO = :ORCAMENTO
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL, :TOTAL_2,
           :FECHADO, :OBSERVACAO, :VENDEDOR,
           :VLR_TOTAL, :VLR_TOTAL_2, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :ENVIADA_CX, :ENTRADA, :DINHEIRO,
           :CHEQUE, :CARTAO, :TICKET, :DATA_CAIXA, :USUARIO, :TURNO ;
    
           SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
           ORDER BY CNPJ, CODIGO
           INTO :NOME_RAZAO ;

           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR ;

           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA ;
     
           SUSPEND;
     END
     ELSE BEGIN
          FOR SELECT PESSOA_FJ, CODIGO, DATA, TOTAL, TOTAL_2,
            FECHADO, OBSERVACAO, VENDEDOR, (TOTAL + DESC_ACRESC),
            (TOTAL_2 + DESC_ACRESC_2), DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, ENVIADA_CX, ENTRADA, DINHEIRO, CHEQUE,
            CARTAO, TICKET, DATA_CAIXA, USUARIO, TURNO
           FROM FAT_GARANTIAS
           WHERE CNPJ = :CNPJ
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL, :TOTAL_2,
           :FECHADO, :OBSERVACAO, :VENDEDOR, :VLR_TOTAL,
           :VLR_TOTAL_2, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :ENVIADA_CX, :ENTRADA, :DINHEIRO,
           :CHEQUE, :CARTAO, :TICKET, :DATA_CAIXA, :USUARIO, :TURNO
           DO BEGIN
             SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :NOME_RAZAO ;

             SELECT NOME FROM FAT_VENDEDOR
             WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
             INTO :NOME_VENDEDOR ;

             SELECT NOME FROM FIN_FORMAS_PAGTO
             WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
             INTO :NOME_FORMA ;
     
             SUSPEND;
          END
     END
END
^

ALTER PROCEDURE VER_FAT_GARANTIAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    VLR_PARC_LC NUMERIC(18,4),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     if (PESSOA <> 0) then
     BEGIN
         FOR SELECT CODIGO, DATA_CAIXA, FECHADO, PESSOA_FJ, USUARIO, VENDEDOR,
                ENVIADA_CX, FORMA_PGTO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRESC, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, OBSERVACAO, VLR_PARC_LC,
                NOME_CONSUMIDOR, (TOTAL + DESC_ACRESC) AS VALOR_LIQUID, TOTAL_2, DESC_ACRESC_2
         FROM FAT_GARANTIAS
         WHERE ENVIADA_CX = 'S' AND DATA >= :DINI AND DATA <= :DFIM AND CNPJ = :CNPJ
         AND PESSOA_FJ = :PESSOA
         INTO  :CODIGO,:DATA,:FECHADA,:PESSOA_FJ,
               :USUARIO,:VENDEDOR,:ENVIADA_CX,:FORMA_PGTO,
               :TIPO_DOCTO,:LOCAL_COBRANCA, :DESC_ACRESC,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :NOME_CONSUMIDOR,:VLRLIQUIDO,:TOTAL_2, :DESC_ACRESC_2
         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDOR
              INTO :NOME_VENDEDOR;

            SUSPEND;
         END /* FATURAS */
       END
       ELSE BEGIN
         FOR SELECT CODIGO, DATA_CAIXA, FECHADO, PESSOA_FJ, USUARIO, VENDEDOR,
                ENVIADA_CX, FORMA_PGTO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRESC, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, OBSERVACAO, VLR_PARC_LC, NOME_CONSUMIDOR, (TOTAL + DESC_ACRESC) AS VALOR_LIQUID
         FROM FAT_GARANTIAS
         WHERE ENVIADA_CX = 'S' AND DATA >= :DINI AND DATA <= :DFIM AND CNPJ = :CNPJ
         INTO  :CODIGO,:DATA,:FECHADA,:PESSOA_FJ,
               :USUARIO,:VENDEDOR,:ENVIADA_CX,:FORMA_PGTO,
               :TIPO_DOCTO,:LOCAL_COBRANCA,:DESC_ACRESC,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :NOME_CONSUMIDOR,:VLRLIQUIDO
         DO BEGIN
                SELECT NOME_RAZAO
                FROM GLO_PESSOAS_FJ
                WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
                PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
                ORDER BY CNPJ, CODIGO
                INTO :PESSOA_RAZAO;

                SELECT NOME
                FROM FAT_VENDEDOR
                WHERE CODIGO = :VENDEDOR
                INTO :NOME_VENDEDOR;

                SUSPEND;
         END /* FATURAS */
       END
END
^

ALTER PROCEDURE VER_FAT_ORCAMENTOS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    COMPROMETER_ESTOQUE CHAR(1))
AS
BEGIN
     IF ( ORCAMENTO > 0 )
     THEN BEGIN
          SELECT PESSOA_FJ, CODIGO, DATA, TOTAL,
             OBSERVACAO, VENDEDOR,
            (TOTAL + DESC_ACRESC),
            DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, NOME_CONSUMIDOR, NOME, COMPROMETER_ESTOQUE
           FROM FAT_ORCAMENTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :ORCAMENTO
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL,
            :OBSERVACAO, :VENDEDOR,
           :VLR_TOTAL, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :NOME_CONSUMIDOR, :NOME_RAZAO, :COMPROMETER_ESTOQUE ;
    
/*           SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
           ORDER BY CNPJ, CODIGO
           INTO :NOME_RAZAO ;*/

           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR ;

           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA ;
     
           SUSPEND;
     END
     ELSE BEGIN
          FOR SELECT PESSOA_FJ, CODIGO, DATA, TOTAL,
             OBSERVACAO, VENDEDOR,
            (TOTAL + DESC_ACRESC),
            DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, NOME_CONSUMIDOR, COMPROMETER_ESTOQUE
           FROM FAT_ORCAMENTOS
           WHERE CNPJ = :CNPJ
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL,
            :OBSERVACAO, :VENDEDOR,
           :VLR_TOTAL, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :NOME_CONSUMIDOR, :COMPROMETER_ESTOQUE
          DO BEGIN
             SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :NOME_RAZAO ;

             SELECT NOME FROM FAT_VENDEDOR
             WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
             INTO :NOME_VENDEDOR ;

             SELECT NOME FROM FIN_FORMAS_PAGTO
             WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
             INTO :NOME_FORMA ;
     
             SUSPEND;
          END
     END
END
^

ALTER PROCEDURE VER_FAT_ORCAMENTOS_ITENS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    COMPLEMENTO VARCHAR(100),
    CODIGO INTEGER,
    DESCONTO FLOAT,
    ICM FLOAT,
    ICM_SUBS FLOAT,
    IPI FLOAT,
    PESO FLOAT,
    PORC_DESC FLOAT,
    PRC_CUSTO FLOAT,
    PRC_UNIT_ORIGINAL FLOAT,
    PRC_UNITARIO FLOAT,
    PRC_UNITARIO_2 FLOAT,
    PRODUTO VARCHAR(15),
    MARCA VARCHAR(30),
    MARCA_2 VARCHAR(30),
    QUANTIDADE FLOAT,
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    VOLUME FLOAT,
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT orc.CODIGO, orc.DESCONTO, orc.ICM, orc.ICM_SUBS, orc.IPI, orc.PESO,
            orc.PORC_DESC, orc.PRC_CUSTO, orc.PRC_UNIT_ORIGINAL, orc.PRC_UNITARIO,
            orc.PRODUTO, orc.QUANTIDADE, orc.SEQUENCIA, orc.UNIDADE, orc.VOLUME, orc.MARCA, orc.MARCA_2,
            orc.PRC_UNITARIO_2, orc.NOME_PRODUTO, coalesce(prod.complemento,'')
     FROM FAT_ORCAMENTOS_ITENS orc
     left join est_produtos prod on (orc.cnpj = prod.cnpj and orc.produto=prod.codigo)
     WHERE orc.CNPJ = :CNPJ AND orc.CODIGO = :ORCAMENTO
     INTO
          :CODIGO, :DESCONTO, :ICM, :ICM_SUBS, :IPI, :PESO,
          :PORC_DESC, :PRC_CUSTO, :PRC_UNIT_ORIGINAL, :PRC_UNITARIO,
          :PRODUTO, :QUANTIDADE, :SEQUENCIA, :UNIDADE, :VOLUME,
          :MARCA, :MARCA_2, :PRC_UNITARIO_2, :NOME, :complemento
     DO BEGIN

         SUSPEND;
         
     END
END
^

ALTER PROCEDURE VER_FAT_TROCAS (
    CNPJ CHAR(14),
    ORCAMENTO INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    DATA TIMESTAMP,
    VALIDADE TIMESTAMP,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    ENVIADA_CX CHAR(1),
    FECHADO CHAR(1),
    OBSERVACAO VARCHAR(80),
    NOME_RAZAO VARCHAR(50),
    NOME_FORMA VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    VENDEDOR INTEGER,
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    CLIENTE VARCHAR(30),
    PESO NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    FORMA INTEGER,
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
BEGIN
     IF ( ORCAMENTO > 0 )
     THEN BEGIN
          SELECT PESSOA_FJ, CODIGO, DATA, TOTAL, TOTAL_2,
            FECHADO, OBSERVACAO, VENDEDOR, (TOTAL + DESC_ACRESC), (TOTAL_2 + DESC_ACRESC_2),
            DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, ENVIADA_CX, ENTRADA, DINHEIRO, CHEQUE,
            CARTAO, TICKET, DATA_CAIXA, USUARIO, TURNO
           FROM FAT_TROCAS
           WHERE CNPJ = :CNPJ AND CODIGO = :ORCAMENTO
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL, :TOTAL_2,
           :FECHADO, :OBSERVACAO, :VENDEDOR,
           :VLR_TOTAL, :VLR_TOTAL_2, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :ENVIADA_CX, :ENTRADA, :DINHEIRO,
           :CHEQUE, :CARTAO, :TICKET, :DATA_CAIXA, :USUARIO, :TURNO ;
    
           SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
           ORDER BY CNPJ, CODIGO
           INTO :NOME_RAZAO ;

           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR ;

           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA ;
     
           SUSPEND;
     END
     ELSE BEGIN
          FOR SELECT PESSOA_FJ, CODIGO, DATA, TOTAL, TOTAL_2,
            FECHADO, OBSERVACAO, VENDEDOR, (TOTAL + DESC_ACRESC),
            (TOTAL_2 + DESC_ACRESC_2), DESC_ACRESC, PESO, VOLUME, FORMA_PGTO, VALIDADE,
            DESC_ACRESC_2, CLIENTE, ENVIADA_CX, ENTRADA, DINHEIRO, CHEQUE,
            CARTAO, TICKET, DATA_CAIXA, USUARIO, TURNO
           FROM FAT_TROCAS
           WHERE CNPJ = :CNPJ
           INTO :PESSOA_FJ, :CODIGO, :DATA, :TOTAL, :TOTAL_2,
           :FECHADO, :OBSERVACAO, :VENDEDOR, :VLR_TOTAL,
           :VLR_TOTAL_2, :DESC_ACRESC, :PESO, :VOLUME, :FORMA,
           :VALIDADE, :DESC_ACRESC_2, :CLIENTE, :ENVIADA_CX, :ENTRADA, :DINHEIRO,
           :CHEQUE, :CARTAO, :TICKET, :DATA_CAIXA, :USUARIO, :TURNO
           DO BEGIN
             SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :NOME_RAZAO ;

             SELECT NOME FROM FAT_VENDEDOR
             WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
             INTO :NOME_VENDEDOR ;

             SELECT NOME FROM FIN_FORMAS_PAGTO
             WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
             INTO :NOME_FORMA ;
     
             SUSPEND;
          END
     END
END
^

ALTER PROCEDURE VER_FAT_TROCAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    VLR_PARC_LC NUMERIC(18,4),
    NOME_CONSUMIDOR VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     if (PESSOA <> 0) then
     BEGIN
         FOR SELECT CODIGO, DATA_CAIXA, FECHADO, PESSOA_FJ, USUARIO, VENDEDOR,
                ENVIADA_CX, FORMA_PGTO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRESC, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, OBSERVACAO, VLR_PARC_LC,
                NOME_CONSUMIDOR, (TOTAL + DESC_ACRESC) AS VALOR_LIQUID, TOTAL_2, DESC_ACRESC_2
         FROM FAT_TROCAS
         WHERE FECHADO = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
         AND PESSOA_FJ = :PESSOA
         INTO  :CODIGO,:DATA,:FECHADA,:PESSOA_FJ,
               :USUARIO,:VENDEDOR,:ENVIADA_CX,:FORMA_PGTO,
               :TIPO_DOCTO,:LOCAL_COBRANCA, :DESC_ACRESC,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :NOME_CONSUMIDOR,:VLRLIQUIDO,:TOTAL_2, :DESC_ACRESC_2
         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDOR
              INTO :NOME_VENDEDOR;

            SUSPEND;
         END /* FATURAS */
       END
       ELSE BEGIN
         FOR SELECT CODIGO, DATA_CAIXA, FECHADO, PESSOA_FJ, USUARIO, VENDEDOR,
                ENVIADA_CX, FORMA_PGTO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRESC, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, OBSERVACAO, VLR_PARC_LC, NOME_CONSUMIDOR, (TOTAL + DESC_ACRESC) AS VALOR_LIQUID,
                TOTAL_2, DESC_ACRESC_2
         FROM FAT_TROCAS
         WHERE FECHADO = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
         INTO  :CODIGO,:DATA,:FECHADA,:PESSOA_FJ,
               :USUARIO,:VENDEDOR,:ENVIADA_CX,:FORMA_PGTO,
               :TIPO_DOCTO,:LOCAL_COBRANCA,:DESC_ACRESC,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :NOME_CONSUMIDOR,:VLRLIQUIDO, :TOTAL_2, :DESC_ACRESC_2
         DO BEGIN
                SELECT NOME_RAZAO
                FROM GLO_PESSOAS_FJ
                WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
                PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
                ORDER BY CNPJ, CODIGO
                INTO :PESSOA_RAZAO;

                SELECT NOME
                FROM FAT_VENDEDOR
                WHERE CODIGO = :VENDEDOR
                INTO :NOME_VENDEDOR;

                SUSPEND;
         END /* FATURAS */
       END
END
^

ALTER PROCEDURE VER_FAT_VENDAS
RETURNS (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    USUARIO INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  FOR SELECT CNPJ,
             CODIGO,
             DATA,
             FECHADA,
             HISTORICO,
             PESSOA_FJ,
             USUARIO,
             VENDEDOR,
             NATUREZA,
             ENVIADA_CX,
             FORMA_PGTO,
             NUM_NF,
             NUM_CUPOM,
             PROPRIEDADE,
             CONVENIADO,
             TIPO_DOCTO,
             LOCAL_COBRANCA,
             DESC_ACRES,
             ENTRADA,
             DINHEIRO,
             CHEQUE,
             CARTAO,
             TICKET,
             TOTAL,
             TROCO,
             substring(observacao from 1 for 200),
             VLR_PARC_LC,
             TERCEIRO,
             CARGA,
             VOLUME,
             PESO,
             REQUISICAO,
             DESCRICAO,
             TIPO_VENDA,
             NOME_CONSUMIDOR,
             ORCAMENTO
      FROM FAT_VENDAS
      INTO :CNPJ,
           :CODIGO,
           :DATA,
           :FECHADA,
           :HISTORICO,
           :PESSOA_FJ,
           :USUARIO,
           :VENDEDOR,
           :NATUREZA,
           :ENVIADA_CX,
           :FORMA_PGTO,
           :NUM_NF,
           :NUM_CUPOM,
           :PROPRIEDADE,
           :CONVENIADO,
           :TIPO_DOCTO,
           :LOCAL_COBRANCA,
           :DESC_ACRES,
           :ENTRADA,
           :DINHEIRO,
           :CHEQUE,
           :CARTAO,
           :TICKET,
           :TOTAL,
           :TROCO,
           :OBSERVACAO,
           :VLR_PARC_LC,
           :TERCEIRO,
           :CARGA,
           :VOLUME,
           :PESO,
           :REQUISICAO,
           :DESCRICAO,
           :TIPO_VENDA,
           :NOME_CONSUMIDOR,
           :ORCAMENTO
  DO
      BEGIN
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ABERTAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
BEGIN
   /*Procedimento modificado para ser utilizado na consulta de Pendencias - (frmLimiteCredito)
   utilizado para mostrar vendas em aberto
   */
   if (pessoa > 0) then
   begin
      for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
                cheque, cartao, ticket, total, substring(observacao from 1 for 200), vlr_parc_lc, terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, (total + desc_acres) as valor_liquid, local, data_caixa,
                conta_caixa, cancelada, base_icm_subst , valor_icm_subst ,
                frete ,  seguro ,  despesas ,  ipi , total_nota, selecionada,
                base_icm, icm, nat.nome, nat.perc_icms, nat.mensagem_1, nat.mensagem_2
      from fat_vendas vd
      inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
      where ((data_caixa between :dini and :dfim) or :data_caixa is null) and vd.cnpj = :cnpj
      and pessoa_fj = :pessoa and coalesce(cancelada,'N') =  'N'
      and nat.es = 'S' and nat.computa_venda = 'S' and vd.fechada <> 'S'
      into  :codigo,:data,:fechada,:historico,:pessoa_fj,
            :usuario,:vendedor, :natureza,:enviada_cx,:forma_pgto,
            :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
            :local_cobranca,:desc_acres,:entrada,:dinheiro,
            :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
            :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
            :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido, :local,
            :data_caixa, :conta_caixa, :cancelada,
            :base_icm_subst , :valor_icm_subst, :frete,
            :seguro,  :despesas ,  :ipi , :total_nota, :selecionada,
            :base_icm, :icm, :nome_natureza, :perc_icms, :mensagem_nat1,
            :mensagem_nat2
      do begin
         select nome_razao, cpf_cgc
         from glo_pessoas_fj
         where cnpj = :cnpj and codigo = :pessoa_fj
         into :pessoa_razao, :cpf_cgc ;


         select nome
         from fat_vendedor
         where cnpj = :cnpj and codigo = :vendedor
         into :nome_vendedor;

         select nome, fatura_futura
         from fin_formas_pagto
         where cnpj = :cnpj and codigo = :forma_pgto
         into :nome_forma, :fatura_futura;
         
         suspend;
     end
   end
   else
   begin
     for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
                cheque, cartao, ticket, total, substring(observacao from 1 for 200), vlr_parc_lc, terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, (total + desc_acres) as valor_liquid, local, data_caixa,
                conta_caixa, cancelada, base_icm_subst , valor_icm_subst ,
                frete ,  seguro ,  despesas ,  ipi , total_nota, selecionada,
                base_icm, icm, nat.nome, nat.perc_icms, nat.mensagem_1, nat.mensagem_2
      from fat_vendas vd
      inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
      where ((data_caixa between :dini and :dfim) or :data_caixa is null) and vd.cnpj = :cnpj
      and coalesce(cancelada,'N') =  'N' and nat.es = 'S' and nat.computa_venda = 'S'
      and vd.fechada <> 'S'
      into  :codigo,:data,:fechada,:historico,:pessoa_fj,
            :usuario,:vendedor, :natureza,:enviada_cx,:forma_pgto,
            :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
            :local_cobranca,:desc_acres,:entrada,:dinheiro,
            :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
            :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
            :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido, :local,
            :data_caixa, :conta_caixa, :cancelada,
            :base_icm_subst , :valor_icm_subst, :frete,
            :seguro,  :despesas ,  :ipi , :total_nota, :selecionada,
            :base_icm, :icm, :nome_natureza, :perc_icms, :mensagem_nat1,
            :mensagem_nat2
      do begin
         select nome_razao, cpf_cgc
         from glo_pessoas_fj
         where cnpj = :cnpj and codigo = :pessoa_fj
         into :pessoa_razao, :cpf_cgc ;


         select nome
         from fat_vendedor
         where cnpj = :cnpj and codigo = :vendedor
         into :nome_vendedor;

         select nome, fatura_futura
         from fin_formas_pagto
         where cnpj = :cnpj and codigo = :forma_pgto
         into :nome_forma, :fatura_futura;
         suspend;
     end 
      
   end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_AGRUPADAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER,
    CODIGO_PRODUTO VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, LOCAL, DATA_CAIXA,
                CONTA_CAIXA, CANCELADA, BASE_ICM_SUBST , VALOR_ICM_SUBST ,
                FRETE ,  SEGURO ,  DESPESAS ,  IPI , TOTAL_NOTA, SELECIONADA,
                BASE_ICM, ICM
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
      AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND DUPLICATA = 0 AND
      TIPO_VENDA = 'FFT' AND (( NUM_NF IS NULL ) OR ( NUM_NF <= 0 )) 
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDOR, :NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :LOCAL,
            :DATA_CAIXA, :CONTA_CAIXA, :CANCELADA,
            :BASE_ICM_SUBST , :VALOR_ICM_SUBST, :FRETE,
            :SEGURO,  :DESPESAS ,  :IPI , :TOTAL_NOTA, :SELECIONADA,
            :BASE_ICM, :ICM
      DO BEGIN
         FOR SELECT PRODUTO
         FROM FAT_VENDAS_ITENS
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :CODIGO_PRODUTO
         INTO :PRODUTO DO
         BEGIN
              SELECT NOME_RAZAO, CPF_CGC
              FROM GLO_PESSOAS_FJ
              WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
              PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
              ORDER BY CNPJ, CODIGO
              INTO :PESSOA_RAZAO, :CPF_CGC ;

              /* NOME NATUREZA */
              SELECT NOME, PERC_ICMS, MENSAGEM_1, MENSAGEM_2 FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA, :PERC_ICMS, :MENSAGEM_NAT1, :MENSAGEM_NAT2 ;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
              INTO :NOME_VENDEDOR;

              SELECT NOME, FATURA_FUTURA
              FROM FIN_FORMAS_PAGTO
              WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
              INTO :NOME_FORMA, :FATURA_FUTURA;
         
              SUSPEND;
         END
     END /* FATURAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ANALISE (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;

     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO     = ANO - 1;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

          SELECT SUM(TOTAL + DESC_ACRES)
          FROM FAT_VENDAS F
          INNER JOIN EST_NATUREZA N ON (F.natureza = N.codigo)
          WHERE F.CNPJ = :CNPJ  AND N.COMPUTA_VENDA = 'S' AND N.es = 'S'
          AND EXTRACT ( MONTH FROM F.DATA_CAIXA ) = :MES_FIM
          AND EXTRACT ( YEAR FROM F.DATA_CAIXA )  = :ANO
          AND F.FECHADA = 'S' AND F.ENVIADA_CX = 'S' AND ( (CANCELADA <> 'S') OR ( CANCELADA IS NULL ))
          AND N.ES = 'S'
          INTO :SOMA ;

          SUSPEND;

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ANALISE_CUSTOS (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;
     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO     = ANO - 1;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO     = ANO - 1;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

          SOMA = 0;

          FOR SELECT F.CODIGO
          FROM FAT_VENDAS F
          INNER JOIN EST_NATUREZA N ON (F.natureza = N.codigo)
          WHERE F.CNPJ = :CNPJ AND  N.COMPUTA_VENDA = 'S'
          AND  N.es = 'S' AND EXTRACT ( MONTH FROM F.DATA_CAIXA ) = :MES_FIM
          AND EXTRACT ( YEAR FROM F.DATA_CAIXA )  = :ANO
          AND F.FECHADA = 'S' AND F.ENVIADA_CX = 'S'
          AND ( (CANCELADA <> 'S') OR ( CANCELADA IS NULL ))
          AND N.ES = 'S'
          INTO :CODIGO
          DO BEGIN
             FOR SELECT SUM(QUANTIDADE * PRC_CUSTO)
             FROM FAT_VENDAS_ITENS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             GROUP BY CNPJ, CODIGO
             ORDER BY CNPJ, CODIGO
             INTO :AUX DO
             BEGIN
                  IF ( AUX IS NULL )
                  THEN BEGIN
                       AUX = 0;
                  END

                  SOMA = SOMA + AUX ;
             END
          END

          SUSPEND;

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ANALISE_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER)
AS
DECLARE VARIABLE DATAFIM DATE;
BEGIN
     DATAFIM = DATAINI + 6;

     SEMANA = 1;

     WHILE ( SEMANA <= 4 ) DO
     BEGIN
          SELECT SUM(F.TOTAL + F.DESC_ACRES)
          FROM FAT_VENDAS F
          INNER JOIN EST_NATUREZA N ON (f.natureza = n.codigo)
          WHERE F.CNPJ = :CNPJ and  N.COMPUTA_VENDA = 'S'
          AND DATA_CAIXA >= :DATAINI
          AND DATA_CAIXA <= :DATAFIM
          AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND
          ((CANCELADA <> 'S') OR ( CANCELADA IS NULL ))
          AND N.ES = 'S'
          INTO :SOMA ;

          SUSPEND;

          DATAINI = DATAFIM + 1;

          IF ( SEMANA < 3 )
          THEN BEGIN
               DATAFIM = DATAINI + 6;
          END
          ELSE
            DATAFIM = ULTIMODIA;

          SEMANA = SEMANA + 1;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ANALISE_PLACA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    CLIENTE INTEGER)
RETURNS (
    PESSOA_FJ INTEGER,
    DATA_CAIXA TIMESTAMP,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PLACA VARCHAR(8),
    SOMA NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER)
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;
     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12  ;
               ANO = ANO - 1 ;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO = ANO - 1 ;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO = ANO - 1 ;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO = ANO - 1 ;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO = ANO - 1 ;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO = ANO - 1 ;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

          SOMA = 0;

          FOR SELECT F.PESSOA_FJ, F.CODIGO,
          F.VENDEDOR, ( F.TOTAL + F.DESC_ACRES ), F.DATA_CAIXA
          FROM FAT_VENDAS F
          INNER JOIN EST_NATUREZA N ON
          ( N.COMPUTA_VENDA = 'S' )
          WHERE F.CNPJ = :CNPJ
          AND EXTRACT ( MONTH FROM F.DATA_CAIXA ) = :MES_FIM
          AND EXTRACT ( YEAR FROM F.DATA_CAIXA )  = :ANO
          AND F.FECHADA = 'S' AND F.ENVIADA_CX = 'S'
          AND ((F.CANCELADA <> 'S') OR (F.CANCELADA IS NULL))
          AND F.PESSOA_FJ = :CLIENTE AND N.ES = 'S'
          INTO :PESSOA_FJ, :CODIGO, :VENDEDOR, :TOTAL,
             :DATA_CAIXA
          DO BEGIN
             /* PLACA */
             SELECT PLACA
             FROM FAT_VENDAS_VEICULO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             INTO :PLACA ;

             /* VENDEDOR */
             SELECT NOME
             FROM FAT_VENDEDOR
             WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
             INTO :NOME_VENDEDOR ;

             FOR SELECT SUM(QUANTIDADE * PRC_CUSTO)
             FROM FAT_VENDAS_ITENS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             GROUP BY CNPJ, CODIGO
             ORDER BY CNPJ, CODIGO
             INTO :AUX DO
             BEGIN
                  IF ( AUX IS NULL )
                  THEN BEGIN
                       AUX = 0;
                  END

                  SOMA = SOMA + AUX ;
             END

             SUSPEND;
          END

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CAIXA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  for select codigo, historico, pessoa_fj, vendedor, natureza, forma_pgto,
  num_nf, num_cupom, propriedade, conveniado, tipo_docto, local_cobranca,
  desc_acres, entrada, dinheiro, cheque, cartao, ticket,
  total, substring(observacao from 1 for 200), vlr_parc_lc, terceiro, carga,
  volume, peso, requisicao, descricao, tipo_venda, nome_consumidor,
  orcamento, troco
  from fat_vendas
  where cnpj = :cnpj and usuario = :usuario and data_caixa = :data
  and turno = :turno and fechada = 'S' and enviada_cx = 'S'
  and ((cancelada <> 'S') or (cancelada is null))
  into :codigo, :historico, :pessoa_fj, :vendedor, :natureza, :forma_pgto,
       :num_nf, :num_cupom, :propriedade, :conveniado, :tipo_docto, :local_cobranca,
       :desc_acres, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :observacao, :vlr_parc_lc, :terceiro, :carga, :volume, :peso, :requisicao,
       :descricao, :tipo_venda, :nome_consumidor, :orcamento, :troco
  do
  begin
    select mov_caixa
    from est_natureza
    where cnpj = :cnpj and codigo = :natureza
    into :mov_caixa ;

    select nome_razao from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :nome ;
    suspend;
  end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CAIXA_ABERTAS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER,
    ENVIADA_CX CHAR(1))
AS
BEGIN
     FOR SELECT
         CODIGO, HISTORICO, PESSOA_FJ, VENDEDOR,
         NATUREZA, FORMA_PGTO, NUM_NF, NUM_CUPOM,
         PROPRIEDADE, CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA,
         DESC_ACRES, ENTRADA, DINHEIRO, CHEQUE, CARTAO, TICKET,
         TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO, CARGA,
         VOLUME, PESO, REQUISICAO, DESCRICAO, TIPO_VENDA, NOME_CONSUMIDOR,
         ORCAMENTO, TROCO, DATA, ENVIADA_CX
      FROM FAT_VENDAS
      WHERE CNPJ = :CNPJ AND FECHADA = 'N'
      INTO :CODIGO, :HISTORICO, :PESSOA_FJ, :VENDEDOR, :NATUREZA, :FORMA_PGTO,
           :NUM_NF, :NUM_CUPOM, :PROPRIEDADE, :CONVENIADO, :TIPO_DOCTO, :LOCAL_COBRANCA,
           :DESC_ACRES, :ENTRADA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET, :TOTAL,
           :OBSERVACAO, :VLR_PARC_LC, :TERCEIRO, :CARGA, :VOLUME, :PESO, :REQUISICAO,
           :DESCRICAO, :TIPO_VENDA, :NOME_CONSUMIDOR, :ORCAMENTO, :TROCO, :DATA, :ENVIADA_CX
      DO
      BEGIN
           SELECT MOV_CAIXA
           FROM EST_NATUREZA
           WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
           INTO :MOV_CAIXA ;

           SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
           ORDER BY CNPJ, CODIGO
           INTO :NOME ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CAIXA_AGRUPADA (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
      FOR SELECT
         vd.VENDEDOR, SUM(vd.DESC_ACRES), SUM(vd.ENTRADA),
         SUM(vd.DINHEIRO), SUM(vd.CHEQUE), SUM(vd.CARTAO), SUM(vd.TICKET),
         SUM(vd.TOTAL), SUM(vd.TROCO)
      FROM FAT_VENDAS vd
      inner join est_natureza nat on (nat.codigo = vd.natureza)
      WHERE vd.CNPJ = :CNPJ AND vd.USUARIO = :USUARIO AND vd.DATA_CAIXA = :DATA AND vd.TURNO = :TURNO
      AND vd.FECHADA = 'S' AND vd.ENVIADA_CX = 'S' AND ((vd.CANCELADA <> 'S') OR (vd.CANCELADA IS NULL))
      and nat.mov_caixa = 'S'
      GROUP BY VENDEDOR
      INTO :VENDEDOR, :DESC_ACRES, :ENTRADA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET,
           :TOTAL, :TROCO
      DO
      BEGIN
           SELECT NOME, COM_VISTA, COM_PRAZO
           FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME, :COM_VISTA, :COM_PRAZO ;

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CAIXA_CANCELADA (
    CNPJ VARCHAR(14),
    DATA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    MOV_CAIXA CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER,
    DATA_CANCELAMENTO TIMESTAMP)
AS
BEGIN
     FOR SELECT
         CODIGO, HISTORICO, PESSOA_FJ, VENDEDOR,
         NATUREZA, FORMA_PGTO, NUM_NF, NUM_CUPOM,
         PROPRIEDADE, CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA,
         DESC_ACRES, ENTRADA, DINHEIRO, CHEQUE, CARTAO, TICKET,
         TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO, CARGA,
         VOLUME, PESO, REQUISICAO, DESCRICAO, TIPO_VENDA, NOME_CONSUMIDOR,
         ORCAMENTO, TROCO, DATA_CANCELAMENTO
      FROM FAT_VENDAS
      WHERE CNPJ = :CNPJ AND DATA_CANCELAMENTO = :DATA
      INTO :CODIGO, :HISTORICO, :PESSOA_FJ, :VENDEDOR, :NATUREZA, :FORMA_PGTO,
           :NUM_NF, :NUM_CUPOM, :PROPRIEDADE, :CONVENIADO, :TIPO_DOCTO, :LOCAL_COBRANCA,
           :DESC_ACRES, :ENTRADA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET, :TOTAL,
           :OBSERVACAO, :VLR_PARC_LC, :TERCEIRO, :CARGA, :VOLUME, :PESO, :REQUISICAO,
           :DESCRICAO, :TIPO_VENDA, :NOME_CONSUMIDOR, :ORCAMENTO, :TROCO,
           :DATA_CANCELAMENTO
      DO
      BEGIN
           SELECT MOV_CAIXA
           FROM EST_NATUREZA
           WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
           INTO :MOV_CAIXA ;

           SELECT NOME_RAZAO FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
           ORDER BY CNPJ, CODIGO
           INTO :NOME ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CAIXA_PERIODO (
    CNPJ VARCHAR(14),
    INI TIMESTAMP,
    FIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VENDEDOR INTEGER,
    NATUREZA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    NOME VARCHAR(50),
    ORCAMENTO INTEGER)
AS
BEGIN
  for select codigo, historico, pessoa_fj, vendedor, natureza, forma_pgto,
  num_nf, num_cupom, propriedade, conveniado, tipo_docto, local_cobranca,
  desc_acres, entrada, dinheiro, cheque, cartao, ticket, total, substring(observacao from 1 for 200),
  vlr_parc_lc, terceiro, carga, volume, peso, requisicao, descricao, tipo_venda,
  nome_consumidor, orcamento, troco
  from fat_vendas
  where cnpj = :cnpj and data_caixa >= :ini and data_caixa <= :fim
  and fechada = 'S' and enviada_cx = 'S' and ((cancelada <> 'S') or (cancelada is null))
  into :codigo, :historico, :pessoa_fj, :vendedor, :natureza, :forma_pgto,
       :num_nf, :num_cupom, :propriedade, :conveniado, :tipo_docto, :local_cobranca,
       :desc_acres, :entrada, :dinheiro, :cheque, :cartao, :ticket, :total,
       :observacao, :vlr_parc_lc, :terceiro, :carga, :volume, :peso, :requisicao,
       :descricao, :tipo_venda, :nome_consumidor, :orcamento, :troco
  do
  begin
    select nome_razao from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
    order by cnpj, codigo
    into :nome;

    suspend;
  end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CIDADE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    CIDADE INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    CODIGO_CIDADE INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     if (:cidade is not null) then
     begin
           FOR SELECT vd.CODIGO, DATA_CAIXA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                    NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                    CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                    CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                    CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                    ORCAMENTO, (TOTAL + DESC_ACRES), nat.nome, psa.nome_razao
         FROM FAT_VENDAS vd
         inner join glo_pessoas_fj psa on (psa.codigo = vd.pessoa_fj and psa.cnpj = vd.cnpj)
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND vd.CNPJ = :CNPJ
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL)) and nat.es = 'S'
         and psa.cidade = :cidade and nat.computa_venda = 'S'
         INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
               :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
               :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
               :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
               :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :NOME_NATUREZA, :PESSOA_RAZAO
    
         DO BEGIN

            SELECT NOME
            FROM FAT_VENDEDOR
            WHERE CODIGO = :VENDEDO
            INTO :NOME_VENDEDOR;
    
            SUSPEND;
         END
     end
     else
     begin
       FOR SELECT vd.CODIGO, DATA_CAIXA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                  NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                  CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                  CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                  CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                  ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
       FROM FAT_VENDAS vd
       inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
       WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND vd.CNPJ = :CNPJ
       AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL)) and nat.es = 'S'
       INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
             :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
             :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
             :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
             :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
             :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
             :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO
  
       DO BEGIN
  
          SELECT NOME_RAZAO, CIDADE
          FROM GLO_PESSOAS_FJ
          WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
          INTO :PESSOA_RAZAO, :CODIGO_CIDADE;
  
          SELECT NOME
          FROM EST_NATUREZA
          WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
          INTO :NOME_NATUREZA;
  
          SELECT NOME
          FROM FAT_VENDEDOR
          WHERE CODIGO = :VENDEDO
          INTO :NOME_VENDEDOR;
  
  
          SUSPEND;
       END
     end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     if (PESSOA <> 0) then
     BEGIN
         FOR SELECT vd.CODIGO, DATA_CAIXA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
         FROM FAT_VENDAS vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND vd.CNPJ = :CNPJ
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
         AND PESSOA_FJ = :PESSOA and nat.es = 'S'
         INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
               :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
               :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
               :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
               :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO

         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;

              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDO
              INTO :NOME_VENDEDOR;


            SUSPEND;
         END /* FATURAS */
       END
       ELSE
       BEGIN
             FOR SELECT vd.CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
         FROM FAT_VENDAS vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
         AND vd.CNPJ = :CNPJ and nat.es = 'S'
         INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
               :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
               :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
               :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
               :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO
         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;


              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA;
              
              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDO
              INTO :NOME_VENDEDOR;

            SUSPEND;
         END /* FATURAS */
       END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_COMISSAO (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN
  /*Filtro por vendedor*/
  if (vendedor <> 0) then
  begin
    /*Percorrendo trocas*/
    for select codigo,data, coalesce(fechado,'N'), pessoa_fj, usuario, vendedor, enviada_cx, forma_pgto,tipo_docto,
        local_cobranca,
        coalesce(desc_acresc,0),
        coalesce(entrada,0),
        coalesce(dinheiro,0),
        coalesce(cheque,0)
        ,coalesce(cartao,0),
        coalesce(ticket,0),
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
        substring(trc.observacao from 1 for 200),vlr_parc_lc, volume,peso,nome_consumidor,
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))) valor_liquid,
        data_caixa,cancelada from fat_trocas  trc
        where (( data_caixa between :dini and :dfim) or (data_caixa is null))
        and cnpj = :cnpj and vendedor = :vendedor and coalesce(cancelada,'N') = 'N'
        into :codigo,:data,:fechada,:pessoa_fj,:usuario,:vendedo,:enviada_cx,:forma_pgto,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro, :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :volume,:peso,:nome_consumidor,:vlrliquido, :data_caixa, :cancelada
    do
    begin

      tipo_venda  = 'TRC';
      troco = 0;
      desconto = 0;
      quantidade = 1;
      prc_unitario =  :total;
      desc_acres = 0;
      nome_produto = 'TROCA';

      /*se o saldo da troca for negativo então termos de debitar da comissão*/
      if (:total < 0) then
        dinheiro = :total;

      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;
      
      select nome, com_vista, com_prazo
      from fat_vendedor
      where codigo = :vendedo
      into :nome_vendedor, :com_vista, :com_prazo;
    
      suspend;
    end
  
    /*Percorrendo vendas*/
    for select vd.codigo, data, coalesce(fechada,'N'), historico, pessoa_fj, usuario,
        natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
        conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
        cheque, cartao, ticket, total, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
        carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
        orcamento, (coalesce(total,0) + coalesce(desc_acres,0)) as valor_liquid , data_caixa,
        troco, cancelada, nat.nome
        from fat_vendas vd
        inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
        where (vd.data_caixa between :dini and :dfim) and vd.cnpj = :cnpj
        and nat.computa_venda = 'S' and nat.es = 'S'
        and coalesce(cancelada,'N') = 'N'
        into  :codigo,:data,:fechada,:historico,:pessoa_fj,
        :usuario,:natureza,:enviada_cx,:forma_pgto,
        :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro,
        :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
        :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
        :data_caixa, :troco, :cancelada, :nome_natureza
    do
    begin
      /*Nome do cliente*/
      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;


      /*Dados dos Itens*/
      for select produto, sequencia, quantidade, prc_unitario,
          prc_custo, desconto, porc_desc, unidade, vendedor
          from fat_vendas_itens
          where codigo = :codigo and cnpj = :cnpj and vendedor = :vendedor
          into :produto, :sequencia, :quantidade, :prc_unitario,
          :prc_custo, :desconto, :porc_desc, :unidade, :vendedo
      do
      begin
        select nome from est_produtos
        where cnpj = :cnpj and codigo = :produto
        into nome_produto ;

        /*Dados do vendedor*/
        select nome, com_vista, com_prazo
        from fat_vendedor
        where codigo = :vendedo
        into :nome_vendedor, :com_vista, :com_prazo;

        suspend;
      end

    end
  end
  else /*Sem filtro por vendedor*/
  begin
    for select codigo,data, coalesce(fechado,'N'), pessoa_fj, usuario, vendedor, enviada_cx, forma_pgto,tipo_docto,
        local_cobranca,coalesce(desc_acresc,0), coalesce(entrada,0),coalesce(dinheiro,0),coalesce(cheque,0)
        ,coalesce(cartao,0), coalesce(ticket,0),
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0)))
        , substring(observacao from 1 for 200),vlr_parc_lc,
        volume,peso,nome_consumidor,
        ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))) valor_liquid,
        data_caixa,cancelada from fat_trocas
        where (( data_caixa between :dini and :dfim ) or (data_caixa is null)) and cnpj = :cnpj
        and coalesce(cancelada,'N') = 'N'
        into :codigo,:data,:fechada,:pessoa_fj,:usuario,:vendedo,:enviada_cx,:forma_pgto,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro, :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :volume,:peso,:nome_consumidor,:vlrliquido, :data_caixa, :cancelada
    do
    begin
      if (:codigo = 395) then
        codigo = :codigo;
      tipo_venda  = 'TRC';
      troco = 0;
      desconto = 0;
      quantidade = 1;
      prc_unitario =  :total;
      desc_acres = 0;
      nome_produto = 'TROCA';

      /*se o saldo da troca for negativo então termos de debitar da comissão*/
      if (:total < 0) then
        dinheiro = :total;

      /*Sawana modas foram encontrados trocas em que os valores dem $ eram superiores
      ao vlr total da troca */
      if (:dinheiro > :total) then
         dinheiro = :total;

      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;
      
      select nome, com_vista, com_prazo
      from fat_vendedor
      where codigo = :vendedo
      into :nome_vendedor, :com_vista, :com_prazo;
    
      suspend;
    end
    
    for select vd.codigo, data, coalesce(fechada,'N'), historico, pessoa_fj, usuario, vendedor,
        natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
        conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
        cheque, cartao, ticket, total, substring(observacao from 1 for 200), vlr_parc_lc, terceiro,
        carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
        orcamento, (coalesce(total,0) + coalesce(desc_acres,0)) as valor_liquid, data_caixa, troco,
        cancelada, nat.nome
        from fat_vendas vd
        inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
        where (data_caixa  between :dini and :dfim) and vd.cnpj = :cnpj
        and nat.computa_venda = 'S' and nat.es = 'S' and coalesce(cancelada,'N') = 'N'
        into  :codigo,:data,:fechada,:historico,:pessoa_fj,
        :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
        :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro,
        :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
        :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
        :data_caixa, :troco, :cancelada, :nome_natureza
    do
    begin
      /*Nome do cliente*/
      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;

      /*Dados Itens*/
      for select produto, sequencia, quantidade, prc_unitario,
          prc_custo, desconto, porc_desc, unidade, vendedor
          from fat_vendas_itens
          where cnpj = :cnpj and codigo = :codigo
          into :produto, :sequencia, :quantidade, :prc_unitario,
          :prc_custo, :desconto, :porc_desc, :unidade, :vendedo
      do
      begin
        select nome from est_produtos
        where cnpj = :cnpj and codigo = :produto
        into nome_produto ;
      
        /*Dados vendedor*/
        select nome, com_vista, com_prazo
        from fat_vendedor
        where codigo = :vendedo
        into :nome_vendedor, :com_vista, :com_prazo;

        suspend;
      end
    end
  end/*fim else*/
END
^

ALTER PROCEDURE VER_FAT_VENDAS_COMISSAO_GERAL (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    SEQUENCIA INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4))
AS
BEGIN

  /*Filtrado por vendedor - Não fiz este pcd, apenas identei fb*/
  if (vendedor <> 0) then
  begin
    for select vd.codigo, data, fechada, historico, pessoa_fj, usuario,
        natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
        conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
        cheque, cartao, ticket, total, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
        carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
        orcamento, (total + desc_acres) as valor_liquid , data_caixa,
        troco, cancelada, nat.nome
        from fat_vendas vd
        inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
        where ( data_caixa between :dini and :dfim ) or ( data_caixa is null )
        and vd.cnpj = :cnpj and vendedor = :vendedor and nat.es = 'S' and nat.computa_venda = 'S'
        and fechada = 'S' and cancelada <> 'S'
        into  :codigo,:data,:fechada,:historico,:pessoa_fj,
        :usuario,:natureza,:enviada_cx,:forma_pgto,
        :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro,
        :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
        :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
        :data_caixa, :troco, :cancelada, :nome_natureza
    do
    begin
      /*apenas pegando o nome do cliente*/
      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;
  
      /*Dados do vendedor*/
      select nome, com_vista, com_prazo
      from fat_vendedor
      where codigo = :vendedo
      into :nome_vendedor, :com_vista, :com_prazo;

      /*dados dos itens*/
      for select produto, sequencia, quantidade, prc_unitario,
          prc_custo, desconto, porc_desc, unidade, vendedor
          from fat_vendas_itens
          where cnpj = :cnpj and codigo = :codigo
          into :produto, :sequencia, :quantidade, :prc_unitario,
          :prc_custo, :desconto, :porc_desc, :unidade, :vendedo
      do
      begin
        select nome from est_produtos
        where cnpj = :cnpj and codigo = :produto
        into nome_produto ;
  
        suspend;
      end

    end
  end
  else /* Sem filtro por vendedor */
  begin
    for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
        natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
        conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
        cheque, cartao, ticket, total, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
        carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
        orcamento, (total + desc_acres) as valor_liquid, data_caixa, troco,
        cancelada, nat.nome from fat_vendas vd
        inner join est_natureza nat on (nat.codigo = vd.natureza and nat.cnpj = vd.cnpj)
        where (data_caixa between :dini and :dfim ) or ( data_caixa is null )
        and vd.cnpj = :cnpj and fechada = 'S' and cancelada <> 'S'
        and nat.es = 'S' and nat.computa_venda = 'S'
        into  :codigo,:data,:fechada,:historico,:pessoa_fj,
        :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
        :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
        :local_cobranca,:desc_acres,:entrada,:dinheiro,
        :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
        :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
        :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
        :data_caixa, :troco, :cancelada, :nome_natureza
    do
    begin
      /*apenas pegando o nome do cliente*/
      select nome, com_vista, com_prazo
      from fat_vendedor
      where codigo = :vendedo
      into :nome_vendedor, :com_vista, :com_prazo;

      /*Dados do vendedor*/
      select nome_razao
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :pessoa_razao;

    
      /*dados dos itens*/
      for select produto, sequencia, quantidade, prc_unitario,
          prc_custo, desconto, porc_desc, unidade, vendedor
          from fat_vendas_itens
          where cnpj = :cnpj and codigo = :codigo
          into :produto, :sequencia, :quantidade, :prc_unitario,
          :prc_custo, :desconto, :porc_desc, :unidade, :vendedo
      do
      begin
          select nome from est_produtos
          where cnpj = :cnpj and codigo = :produto
          into nome_produto ;
          
          suspend;
      end

    end /* faturas */
  end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_COR (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    PRODUTO VARCHAR(15),
    SEQUENCIA INTEGER)
RETURNS (
    COR INTEGER,
    NOME VARCHAR(50),
    QUANTIDADE NUMERIC(18,4))
AS
BEGIN
     FOR SELECT
     COR, QUANTIDADE, NOME
     FROM FAT_VENDAS_COR
     WHERE ((CNPJ = :CNPJ) AND (CODIGO = :CODIGO) AND ( PRODUTO = :PRODUTO ) AND ( SEQUENCIA = :SEQUENCIA ))
     INTO :COR, :QUANTIDADE, :NOME DO
     BEGIN
          SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CUSTOS_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER)
AS
DECLARE VARIABLE DATAFIM DATE;
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
BEGIN
     DATAFIM = DATAINI + 6;

     SEMANA = 1;

     WHILE ( SEMANA <= 4 ) DO
     BEGIN
          SOMA = 0;

          FOR SELECT CODIGO
          FROM FAT_VENDAS
          WHERE CNPJ = :CNPJ
          AND DATA_CAIXA >= :DATAINI
          AND DATA_CAIXA <= :DATAFIM
          AND FECHADA = 'S' AND ENVIADA_CX = 'S'
          INTO :CODIGO
          DO BEGIN
             FOR SELECT SUM(QUANTIDADE * PRC_CUSTO)
             FROM FAT_VENDAS_ITENS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
             GROUP BY CNPJ, CODIGO
             ORDER BY CNPJ, CODIGO
             INTO :AUX DO
             BEGIN
                  IF ( AUX IS NULL )
                  THEN BEGIN
                       AUX = 0;
                  END

                  SOMA = SOMA + AUX ;
             END
          END

          SUSPEND;

          DATAINI = DATAFIM + 1;

          IF ( SEMANA < 3 )
          THEN BEGIN
               DATAFIM = DATAINI + 6;
          END
          ELSE
            DATAFIM = ULTIMODIA;

          SEMANA = SEMANA + 1;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CX_AGRUP_PERIODO (
    CNPJ VARCHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
BEGIN
      FOR SELECT
         VENDEDOR, SUM(DESC_ACRES), SUM(ENTRADA),
         SUM(DINHEIRO), SUM(CHEQUE), SUM(CARTAO), SUM(TICKET),
         SUM(TOTAL+DESC_ACRES), SUM(TROCO)
      FROM FAT_VENDAS
      WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :INI AND DATA_CAIXA <= :FIM
      AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') or (CANCELADA IS NULL))
      GROUP BY VENDEDOR
      INTO :VENDEDOR, :DESC_ACRES, :ENTRADA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET,
           :TOTAL, :TROCO
      DO
      BEGIN
           SELECT NOME, COM_VISTA, COM_PRAZO
           FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :NOME, :COM_VISTA, :COM_PRAZO ;

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_CX_AGRUPADA_VEND (
    CNPJ VARCHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    VENDEDOR INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    COM_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE A_DESC_ACRES NUMERIC(18,4);
DECLARE VARIABLE A_ENTRADA NUMERIC(18,4);
DECLARE VARIABLE A_DINHEIRO NUMERIC(18,4);
DECLARE VARIABLE A_CHEQUE NUMERIC(18,4);
DECLARE VARIABLE A_CARTAO NUMERIC(18,4);
DECLARE VARIABLE A_TICKET NUMERIC(18,4);
DECLARE VARIABLE A_TROCO NUMERIC(18,4);
DECLARE VARIABLE A_TOTAL NUMERIC(18,4);
DECLARE VARIABLE A_VISTA NUMERIC(18,4);
DECLARE VARIABLE A_PRAZO NUMERIC(18,4);
DECLARE VARIABLE A_LIQUIDO NUMERIC(18,4);
DECLARE VARIABLE A_PORC NUMERIC(18,4);
BEGIN
      FOR SELECT CODIGO, NOME, COM_VISTA, COM_PRAZO
      FROM FAT_VENDEDOR
      WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
      INTO :VENDEDOR, :NOME, :COM_VISTA, :COM_PRAZO
      DO BEGIN
         FOR SELECT
         CODIGO, DESC_ACRES, ENTRADA, DINHEIRO, CHEQUE,
         CARTAO, TICKET, TOTAL, TROCO
         FROM FAT_VENDAS
         WHERE CNPJ = :CNPJ AND USUARIO = :USUARIO AND DATA_CAIXA = :DATA
         AND TURNO = :TURNO AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND CANCELADA <> 'S'
         AND VENDEDOR = :VENDEDOR
         INTO :CODIGO, :A_DESC_ACRES, :A_ENTRADA, :A_DINHEIRO,
              :A_CHEQUE, :A_CARTAO, :A_TICKET, :A_TOTAL, :A_TROCO
         DO BEGIN
            A_VISTA = :A_DINHEIRO + :A_CHEQUE + :A_CARTAO + :A_TICKET - :A_TROCO;

            A_PRAZO = :A_TOTAL - :A_VISTA;

            /* DEVE SER NEGATIVO NO DESCONTO PARA QUE ELE ACRESCENTE QDO FOR ACRESC E DESCONTE QDO FOR ACRESCIMO */
            A_LIQUIDO = :A_VISTA + :A_PRAZO - :A_DESC_ACRES;

            FOR SELECT SUM( QUANTIDADE * ( PRC_UNITARIO  ))
            FROM FAT_VENDAS_ITENS
            WHERE :CNPJ = :CNPJ AND CODIGO = :CODIGO
            INTO :UNITARIO DO
            BEGIN
                 IF (A_LIQUIDO > 0)
                 THEN
                     A_PORC     = UNITARIO / A_LIQUIDO ;

                 DESC_ACRES = A_PORC * A_DESC_ACRES ;
                 ENTRADA    = A_PORC * A_ENTRADA    ;
                 DINHEIRO   = A_PORC * A_DINHEIRO   ;
                 CHEQUE     = A_PORC * A_CHEQUE     ;
                 CARTAO     = A_PORC * A_CARTAO     ;
                 TICKET     = A_PORC * A_TICKET     ;
                 TROCO      = A_PORC * A_TROCO      ;
                 TOTAL      = A_PORC * A_TOTAL      ;
/*                 COM_VISTA  = A_PORC * A_COM_VISTA  ;
                 COM_PRAZO  = A_PORC * A_COM_PRAZO  ;
  */
                 SUSPEND;
            END
         END
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FATURA_FUTURAS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    PERC_ICMS NUMERIC(18,4),
    MENSAGEM_NAT1 VARCHAR(50),
    MENSAGEM_NAT2 VARCHAR(50))
AS
BEGIN
   IF (PESSOA > 0)
   THEN BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, LOCAL, DATA_CAIXA,
                CONTA_CAIXA, CANCELADA, BASE_ICM_SUBST , VALOR_ICM_SUBST ,
                FRETE ,  SEGURO ,  DESPESAS ,  IPI , TOTAL_NOTA, SELECIONADA,
                BASE_ICM, ICM
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
      AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND (( DUPLICATA = 0 ) or ( DUPLICATA IS NULL ))
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDOR, :NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :LOCAL,
            :DATA_CAIXA, :CONTA_CAIXA, :CANCELADA,
            :BASE_ICM_SUBST , :VALOR_ICM_SUBST, :FRETE,
            :SEGURO,  :DESPESAS ,  :IPI , :TOTAL_NOTA, :SELECIONADA,
            :BASE_ICM, :ICM
      DO BEGIN
         SELECT NOME_RAZAO, CPF_CGC
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO :PESSOA_RAZAO, :CPF_CGC ;

         /* NOME NATUREZA */
         SELECT NOME, PERC_ICMS, MENSAGEM_1, MENSAGEM_2 FROM EST_NATUREZA
         WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
         INTO :NOME_NATUREZA, :PERC_ICMS, :MENSAGEM_NAT1,
         :MENSAGEM_NAT2 ;

         SELECT NOME
         FROM FAT_VENDEDOR
         WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
         INTO :NOME_VENDEDOR;

         SELECT NOME, FATURA_FUTURA
         FROM FIN_FORMAS_PAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
         INTO :NOME_FORMA, :FATURA_FUTURA;
         
         SUSPEND;
     END /* FATURAS */
   END
   ELSE BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, LOCAL, DATA_CAIXA,
                CONTA_CAIXA, CANCELADA, BASE_ICM_SUBST , VALOR_ICM_SUBST ,
                FRETE ,  SEGURO ,  DESPESAS ,  IPI , TOTAL_NOTA, SELECIONADA,
                BASE_ICM, ICM
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
      AND CANCELADA <> 'S' AND (( DUPLICATA = 0 ) or ( DUPLICATA IS NULL ))
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDOR, :NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :LOCAL,
            :DATA_CAIXA, :CONTA_CAIXA, :CANCELADA,
            :BASE_ICM_SUBST , :VALOR_ICM_SUBST, :FRETE,
            :SEGURO,  :DESPESAS ,  :IPI , :TOTAL_NOTA, :SELECIONADA,
            :BASE_ICM, :ICM
      DO BEGIN
         SELECT NOME_RAZAO
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO :PESSOA_RAZAO;

         /* NOME NATUREZA */
         SELECT NOME, PERC_ICMS, MENSAGEM_1, MENSAGEM_2 FROM EST_NATUREZA
         WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
         INTO :NOME_NATUREZA, :PERC_ICMS, :MENSAGEM_NAT1,
         :MENSAGEM_NAT2 ;

         SELECT NOME
         FROM FAT_VENDEDOR
         WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
         INTO :NOME_VENDEDOR;

         SELECT NOME, FATURA_FUTURA
         FROM FIN_FORMAS_PAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
         INTO :NOME_FORMA, :FATURA_FUTURA;
         
         SUSPEND;
     END /* FATURAS */
   END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FRMPAGTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
     FOR SELECT FORMA_PGTO, SEQUENCIA,
                VALOR_ORIGINAL, JUROS, TIPO_PAGTO,
                NOME_FORMA, BANCO, CONTA, DV_CONTA,
                AGENCIA, DV_AGENCIA, CHEQUE, DV_CHEQUE,
                AVISTA
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
           :FORMA_PGTO, :SEQUENCIA, :VALOR_ORIGINAL,
           :JUROS, :TIPO_PAGTO, :NOME_FORMA,
           :BANCO, :CONTA, :DV_CONTA,
           :AGENCIA, :DV_AGENCIA, :CHEQUE, :DV_CHEQUE,
           :AVISTA
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FRMPAGTO_CAIXA (
    CNPJ CHAR(14),
    DT_CAIXA DATE,
    USR_CAIXA INTEGER,
    CNTA_CAIXA INTEGER,
    TURNO INTEGER)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
     FOR SELECT FORMA_PGTO, SEQUENCIA,
                VALOR_ORIGINAL, JUROS, TIPO_PAGTO,
                NOME_FORMA, BANCO, CONTA, DV_CONTA,
                AGENCIA, DV_AGENCIA, CHEQUE, DV_CHEQUE,
                AVISTA
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DT_CAIXA AND
     USUARIO_CAIXA = :USR_CAIXA AND CONTA_CAIXA = :CNTA_CAIXA AND TURNO = :TURNO
     ORDER BY NOME_FORMA
     INTO
           :FORMA_PGTO, :SEQUENCIA, :VALOR_ORIGINAL,
           :JUROS, :TIPO_PAGTO, :NOME_FORMA,
           :BANCO, :CONTA, :DV_CONTA,
           :AGENCIA, :DV_AGENCIA, :CHEQUE, :DV_CHEQUE,
           :AVISTA
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FRMPAGTO_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    FORMA_PGTO INTEGER,
    SEQUENCIA INTEGER,
    VALOR_ORIGINAL NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    TIPO_PAGTO VARCHAR(30),
    NOME_FORMA VARCHAR(30),
    BANCO CHAR(3),
    CONTA VARCHAR(20),
    DV_CONTA CHAR(1),
    AGENCIA VARCHAR(6),
    DV_AGENCIA CHAR(1),
    CHEQUE VARCHAR(6),
    DV_CHEQUE CHAR(1),
    AVISTA CHAR(1))
AS
BEGIN
     FOR SELECT FORMA_PGTO, SEQUENCIA,
                VALOR_ORIGINAL, JUROS, TIPO_PAGTO,
                NOME_FORMA, BANCO, CONTA, DV_CONTA,
                AGENCIA, DV_AGENCIA, CHEQUE, DV_CHEQUE,
                AVISTA
     FROM FAT_VENDAS_FRMPAGTO
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     ORDER BY NOME_FORMA
     INTO
           :FORMA_PGTO, :SEQUENCIA, :VALOR_ORIGINAL,
           :JUROS, :TIPO_PAGTO, :NOME_FORMA,
           :BANCO, :CONTA, :DV_CONTA,
           :AGENCIA, :DV_AGENCIA, :CHEQUE, :DV_CHEQUE,
           :AVISTA
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FUTURAS_CAIXA (
    CNPJ VARCHAR(14),
    D DATE,
    CONTA INTEGER,
    USR INTEGER,
    TURNO INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    AVISTA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    APRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE SOMAJUROS NUMERIC(18,4);
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, LOCAL, DATA_CAIXA,
                CONTA_CAIXA, CANCELADA, BASE_ICM_SUBST , VALOR_ICM_SUBST ,
                FRETE ,  SEGURO ,  DESPESAS ,  IPI , TOTAL_NOTA, SELECIONADA,
                BASE_ICM, ICM, TROCO
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA = :D AND CNPJ = :CNPJ
      AND USUARIO = :USR AND CANCELADA <> 'S' AND CONTA_CAIXA = :CONTA
      AND TURNO = :TURNO
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDOR, :NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :LOCAL,
            :DATA_CAIXA, :CONTA_CAIXA, :CANCELADA,
            :BASE_ICM_SUBST , :VALOR_ICM_SUBST, :FRETE,
            :SEGURO,  :DESPESAS ,  :IPI , :TOTAL_NOTA, :SELECIONADA,
            :BASE_ICM, :ICM, :TROCO
      DO BEGIN
         SELECT NOME_RAZAO, CPF_CGC
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO :PESSOA_RAZAO, :CPF_CGC ;

         SELECT NOME
         FROM EST_NATUREZA
         WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
         INTO :NOME_NATUREZA;

         SELECT NOME
         FROM FAT_VENDEDOR
         WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
         INTO :NOME_VENDEDOR;

         SELECT NOME, FATURA_FUTURA
         FROM FIN_FORMAS_PAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
         INTO :NOME_FORMA, :FATURA_FUTURA;

         SELECT SUM(VALOR_ORIGINAL), SUM(JUROS) FROM FAT_VENDAS_FRMPAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND AVISTA = 'S'
         INTO :SOMA, :SOMAJUROS ;

         AVISTA = :SOMA     ;
         JUROS  = SOMAJUROS ;

         IF ( JUROS IS NULL )
         THEN
             JUROS = 0;
         
         SELECT SUM(VALOR_ORIGINAL), SUM(JUROS) FROM FAT_VENDAS_FRMPAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND AVISTA <> 'S'
         INTO :SOMA, :SOMAJUROS ;

         IF ( SOMAJUROS IS NULL )
         THEN
             SOMAJUROS = 0;

         APRAZO = :SOMA ;
         JUROS  = :JUROS + :SOMAJUROS ;

         SUSPEND;
     END /* FATURAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_FUTURAS_GERAL (
    CNPJ VARCHAR(14),
    D DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    MOV_CAIXA CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    CPF_CGC VARCHAR(15),
    NOME_FORMA VARCHAR(50),
    FATURA_FUTURA VARCHAR(1),
    ORCAMENTO INTEGER,
    VENDEDOR INTEGER,
    LOCAL INTEGER,
    CANCELADA CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    SELECIONADA CHAR(1),
    NOME_VENDEDOR VARCHAR(50),
    AVISTA NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    APRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE SOMA NUMERIC(18,4);
DECLARE VARIABLE SOMAJUROS NUMERIC(18,4);
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, LOCAL, DATA_CAIXA,
                CONTA_CAIXA, CANCELADA, BASE_ICM_SUBST , VALOR_ICM_SUBST ,
                FRETE ,  SEGURO ,  DESPESAS ,  IPI , TOTAL_NOTA, SELECIONADA,
                BASE_ICM, ICM, TROCO
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA = :D AND CNPJ = :CNPJ AND CANCELADA <> 'S'
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDOR, :NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO, :LOCAL,
            :DATA_CAIXA, :CONTA_CAIXA, :CANCELADA,
            :BASE_ICM_SUBST , :VALOR_ICM_SUBST, :FRETE,
            :SEGURO,  :DESPESAS ,  :IPI , :TOTAL_NOTA, :SELECIONADA,
            :BASE_ICM, :ICM, :TROCO
      DO BEGIN
         SELECT NOME_RAZAO, CPF_CGC
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO :PESSOA_RAZAO, :CPF_CGC ;

         SELECT NOME, MOV_CAIXA
         FROM EST_NATUREZA
         WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
         INTO :NOME_NATUREZA, :MOV_CAIXA;

         SELECT NOME
         FROM FAT_VENDEDOR
         WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
         INTO :NOME_VENDEDOR;

         SELECT NOME, FATURA_FUTURA
         FROM FIN_FORMAS_PAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :FORMA_PGTO
         INTO :NOME_FORMA, :FATURA_FUTURA;

         SELECT SUM(VALOR_ORIGINAL), SUM(JUROS) FROM FAT_VENDAS_FRMPAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND AVISTA = 'S'
         INTO :SOMA, :SOMAJUROS ;

         AVISTA = :SOMA     ;
         JUROS  = SOMAJUROS ;

         IF ( JUROS IS NULL )
         THEN
             JUROS = 0;
         
         SELECT SUM(VALOR_ORIGINAL), SUM(JUROS) FROM FAT_VENDAS_FRMPAGTO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND AVISTA <> 'S'
         INTO :SOMA, :SOMAJUROS ;

         IF ( SOMAJUROS IS NULL )
         THEN
             SOMAJUROS = 0;

         APRAZO = :SOMA ;
         JUROS  = :JUROS + :SOMAJUROS ;

         SUSPEND;
     END /* FATURAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_GARANTIA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    GARANTIA INTEGER)
RETURNS (
    TEXTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    PRODUTO VARCHAR(15),
    NOME VARCHAR(50),
    COMPLEMENTO VARCHAR(100))
AS
BEGIN
     SELECT TEXTO
     FROM FAT_CARTA_GARANTIAS
     WHERE CNPJ = :CNPJ AND CODIGO = :GARANTIA
     INTO :TEXTO ;

     FOR SELECT PRODUTO, NOME_PRODUTO, COMPLEMENTO
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :NOME, :COMPLEMENTO
     DO
     BEGIN
          SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_GRUPO_SEL (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    NF INTEGER,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    NOME_GRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    COM_VENDA_VLR NUMERIC(18,4),
    COM_VENDA_PCT NUMERIC(18,4),
    TOTAL_PRODUTO NUMERIC(18,4),
    TOTAL_DESCONTO NUMERIC(18,4),
    PARTICIP_LUCRO NUMERIC(18,4),
    COM_VISTA_VENDEDOR NUMERIC(18,4),
    COM_PRAZO_VENDEDOR NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    COMPUTA_VENDA CHAR(1),
    PAGA_COMISSAO CHAR(1))
AS
DECLARE VARIABLE GRP INTEGER;
DECLARE VARIABLE CFOP INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PORC NUMERIC(18,4);
DECLARE VARIABLE SELECIONADO CHAR(1);
BEGIN
     FOR SELECT CODIGO, VENDEDOR, FECHADA, TOTAL, DESC_ACRES,
     DATA_CAIXA, PESSOA_FJ, NATUREZA, NUM_NF
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND ((DATA_CAIXA >= :DATAINI  AND DATA_CAIXA <= :DATAFIM))
     AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND (CANCELADA <> 'S' or CANCELADA IS NULL)
     INTO :CODIGO, :VENDEDOR, :FECHADA, :TOTAL, :DESC_ACRESC, :DATA,
     :PESSOA_FJ, :NATUREZA, :NF
     DO BEGIN
        PORC        = 0 ;
        UNITARIO    = 0 ;
        QUANTIDADE  = 0 ;
        UNITARIO    = 0 ;
        CUSTO       = 0 ;

        /* selecionando vendedor aparentemente*/
        SELECT vd.pessoa_fj
        FROM  fat_vendedor vd
        WHERE CNPJ = :CNPJ AND CODIGO = :vendedor
        INTO :pessoa_fj ;

        SELECT NOME_RAZAO
        FROM  GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        ORDER BY CNPJ, CODIGO
        INTO :NOME_RAZAO ;

        /* ITENS */
        FOR SELECT PRODUTO, QUANTIDADE, ( PRC_UNITARIO ),
        ( QUANTIDADE * PRC_CUSTO ), DESCONTO, PRC_UNITARIO, CFOP
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :PRODUTO, :QUANTIDADE, :UNITARIO, :CUSTO, :DESCONTO,
        :PRC_UNITARIO, :CFOP
        DO BEGIN
           VALOR = :UNITARIO;

           IF ( CFOP IS NULL )
           THEN
              CFOP = 5102;

           SELECT COMPUTA_VENDA, PAGA_COMISSAO
           FROM EST_NATUREZA
           WHERE CNPJ = :CNPJ AND CODIGO = :CFOP
           INTO :COMPUTA_VENDA, :PAGA_COMISSAO ;

           IF ( COMPUTA_VENDA IS NULL )
           THEN
               COMPUTA_VENDA = 'S';

           IF ( PAGA_COMISSAO IS NULL )
           THEN
               PAGA_COMISSAO = 'S';

           /* PORCENTAGEM DO VALOR UNITARIO EM CIMA DO TOTAL DA VENDA */
           IF ( TOTAL > 0 )
           THEN BEGIN
                PORC = ( :UNITARIO / :TOTAL );
           END
           ELSE BEGIN
                PORC = 0;
           END

           /* VALOR ATRIBUIDO DO ITEM NO TOTAL DO DESCONTO */
           DESC_ACRESC = ( :DESC_ACRESC * :PORC );

           /* ACUMULANDO O DESC/ACRESC DA VENDA NO ITEM */
           UNITARIO = :UNITARIO + :DESC_ACRESC ;

           IF ( :QUANTIDADE IS NULL )
           THEN BEGIN
                QUANTIDADE = 0 ;
           END

           IF ( :UNITARIO IS NULL )
           THEN BEGIN
                UNITARIO = 0 ;
           END

           IF ( :CUSTO IS NULL )
           THEN BEGIN
                CUSTO = 0 ;
           END

           TOTAL_PRODUTO = :quantidade * :unitario;
           Total_Desconto = :quantidade * :desconto;

           SELECT NOME, CODIGO, UNIDADE, SUBUNIDADE, GRUPO,
           COM_VENDA_VLR, COM_VENDA_PCT, PARTICIP_LUCRO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           ORDER BY CNPJ, CODIGO
           INTO :NOME_PRODUTO, :PRODUTO, :UNIDADE, :SUBUNIDADE, :GRP,
           :COM_VENDA_VLR, :COM_VENDA_PCT, :PARTICIP_LUCRO ;

           SELECT COM_VISTA, COM_PRAZO
           FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
           INTO :COM_VISTA_VENDEDOR, :COM_PRAZO_VENDEDOR ;

           FOR SELECT NOME, CODIGO, SELECIONADO
           FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND CODIGO = :GRP
           INTO :NOME_GRUPO, :GRUPO, :SELECIONADO
           DO BEGIN
              IF ( :SELECIONADO = 'S' ) then
                SUSPEND;
           END
        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_GRUPO_SINTETICO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE GRP INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PORC NUMERIC(18,4);
BEGIN
     FOR SELECT vd.CODIGO, VENDEDOR, FECHADA, TOTAL, DESC_ACRES
     FROM FAT_VENDAS vd
     inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
     WHERE vd.CNPJ = :CNPJ AND ((DATA_CAIXA between :DATAINI and :DATAFIM) OR ( DATA_CAIXA IS NULL ))
     and nat.computa_venda = 'S' and nat.es = 'S'
     INTO :CODIGO, :VENDEDOR, :FECHADA, :TOTAL, :DESC_ACRESC
     DO BEGIN
        PORC        = 0 ;
        UNITARIO    = 0 ;
        QUANTIDADE  = 0 ;
        UNITARIO    = 0 ;
        CUSTO       = 0 ;

        /* ITENS */
        FOR SELECT PRODUTO, coalesce(QUANTIDADE,0), (coalesce(PRC_UNITARIO,0) - coalesce(DESCONTO,0)),
        (coalesce(QUANTIDADE,0) * coalesce(PRC_CUSTO,0))
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :QUANTIDADE, :UNITARIO, :CUSTO
        DO
        BEGIN
           VALOR = :UNITARIO;

           /* PORCENTAGEM DO VALOR UNITARIO EM CIMA DO TOTAL DA VENDA */
           IF ( TOTAL > 0 )
           THEN BEGIN
                PORC = ( :UNITARIO / :TOTAL );
           END
           ELSE BEGIN
                PORC = 0;
           END

           /* VALOR ATRIBUIDO DO ITEM NO TOTAL DO DESCONTO */
           DESC_ACRESC = ( :DESC_ACRESC * :PORC );

           /* ACUMULANDO O DESC/ACRESC DA VENDA NO ITEM */
           UNITARIO = :UNITARIO + :DESC_ACRESC ;


           SELECT NOME, CODIGO, UNIDADE, SUBUNIDADE, GRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :NOME_PRODUTO, :PRODUTO, :UNIDADE, :SUBUNIDADE, :GRP ;

           FOR SELECT NOME, CODIGO
           FROM EST_GRUPOS
           WHERE CNPJ = :CNPJ AND NOME >= :NOME_INICIAL
           AND NOME <= :NOME_FINAL AND CODIGO = :GRP
           INTO :NOME_GRUPO, :GRUPO
           DO
           BEGIN
              SUSPEND;
           END

        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_HISTORICO (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_CAIXA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    CPF_CGC VARCHAR(20),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     FOR SELECT
         CODIGO, DATA_CAIXA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
         NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
         CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
         CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
         CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
         ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, DATA_CAIXA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA
     INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
           :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
           :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
           :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
           :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
           :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
           :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO,
           :DATA_CAIXA
     DO BEGIN
        SELECT NOME_RAZAO, CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :PESSOA_RAZAO, :CPF_CGC;

        SELECT NOME
        FROM EST_NATUREZA
        WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
        INTO :NOME_NATUREZA;

        SELECT NOME
        FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDO
        INTO :NOME_VENDEDOR;

        SUSPEND;

     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_INDICADOS (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    PORCENTAGEM NUMERIC(18,4))
AS
DECLARE VARIABLE CLIENTE INTEGER;
BEGIN
     FOR SELECT INDICADO, PORCENTAGEM
     FROM GLO_INDICACOES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA
     ORDER BY CNPJ, PESSOA_FJ
     INTO :CLIENTE, :PORCENTAGEM
     DO BEGIN
        FOR SELECT CODIGO, DATA_CAIXA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
        FROM FAT_VENDAS
        WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI
        AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
        AND PESSOA_FJ = :CLIENTE
        AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
        INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
              :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
              :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
              :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
              :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
              :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
              :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO
        DO BEGIN
              SELECT NOME_RAZAO
              FROM GLO_PESSOAS_FJ
              WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
              PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
              ORDER BY CNPJ, CODIGO
              INTO :PESSOA_RAZAO;

              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDO
              INTO :NOME_VENDEDOR;


            SUSPEND;
        END /* FATURAS */
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    ALIQUOTA_EST NUMERIC(18,4),
    ALIQUOTA_INT NUMERIC(18,4),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  FOR SELECT
             PRODUTO,
             SEQUENCIA,
             QUANTIDADE,
             PRC_UNITARIO,
             PRC_CUSTO,
             ICM,
             ICM_SUBS,
             IPI,
             VOLUME,
             PESO,
             DESCONTO,
             PORC_DESC,
             UNIDADE,
             PRC_UNIT_ORIGINAL,
             NOME_PRODUTO,
             ALIQUOTA,
             PRODUTOFIS,
             NOME_FIS,
             CTE,
             CTIE,
             ORIGEM,
             REDUCAO,
             SUBUNIDADE,
             ALIQUOTA_EST,
             ALIQUOTA_INT
      FROM FAT_VENDAS_ITENS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :PRODUTO,
           :SEQUENCIA,
           :QUANTIDADE,
           :PRC_UNITARIO,
           :PRC_CUSTO,
           :ICM,
           :ICM_SUBS,
           :IPI,
           :VOLUME,
           :PESO,
           :DESCONTO,
           :PORC_DESC,
           :UNIDADE,
           :PRC_UNIT_ORIGINAL,
           :NOME_PRODUTO,
           :ALIQUOTA,
           :PRODUTOFIS,
           :NOME_FIS,
           :CTE,
           :CTIE,
           :ORIGEM,
           :REDUCAO,
           :SUBUNIDADE,
           :ALIQUOTA_EST,
           :ALIQUOTA_INT
       DO
      BEGIN
           SELECT NOME FROM EST_PRODUTOS P
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
           ORDER BY CNPJ, CODIGO
           INTO :NOME ;

           IF ( ORIGEM IS NULL )
           THEN
             ORIGEM = 0;
           
           IF ( CTE IS NULL )
           THEN
             CTE = 0;

           IF ( CTIE IS NULL )
           THEN
             CTIE = 0;

        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ITENS_ALIQUOTA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA CHAR(3),
    NATUREZA INTEGER)
AS
BEGIN
      FOR SELECT NATUREZA
      FROM FAT_VENDAS
      WHERE CODIGO = :CODIGO
      INTO :NATUREZA DO
      BEGIN
        FOR SELECT
             ICM,
             ICM_SUBS,
             IPI,
             ALIQUOTA
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO
           :ICM,
           :ICM_SUBS,
           :IPI,
           :ALIQUOTA
        DO
        BEGIN
          SUSPEND;
        END
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ITENS_COMISSAO (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    VENDEDOR INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    GRUPO INTEGER,
    SUBGRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    COMISSAO_VISTA NUMERIC(18,4),
    COMISSAO_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE VISTA NUMERIC(18,4);
DECLARE VARIABLE PRAZO NUMERIC(18,4);
BEGIN
     FOR SELECT PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO,
                ICM, ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC,
                UNIDADE, PRC_UNIT_ORIGINAL, NOME_PRODUTO, ALIQUOTA,
                PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO, SUBUNIDADE
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     ORDER BY CNPJ, CODIGO
     INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO,
          :PRC_CUSTO, :ICM, :ICM_SUBS, :IPI, :VOLUME,
          :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
          :PRC_UNIT_ORIGINAL, :NOME_PRODUTO, :ALIQUOTA, :PRODUTOFIS,
          :NOME_FIS, :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE
     DO BEGIN
        VISTA = NULL;
        PRAZO = NULL;

        SELECT NOME, GRUPO, SUBGRUPO FROM EST_PRODUTOS P
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :GRUPO, :SUBGRUPO ;

        SELECT NOME FROM EST_GRUPOS
        WHERE CNPJ = :CNPJ AND CODIGO = :GRUPO
        INTO :NOME_GRUPO ;
           
        SELECT NOME FROM EST_SUBGRUPOS
        WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO
        INTO :NOME_SUBGRUPO ;

        SELECT AVISTA, APRAZO FROM FIN_COMISSAO_PRODUTO
        WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND VENDEDOR = :VENDEDOR
        INTO :VISTA, :PRAZO;

        IF ( VISTA IS NULL )
        THEN BEGIN
             VISTA = 0;
        END

        IF ( PRAZO IS NULL )
        THEN BEGIN
             PRAZO = 0;
        END

        COMISSAO_VISTA = VISTA ;
        COMISSAO_PRAZO = PRAZO ;

        IF (( COMISSAO_VISTA = 0 ) OR ( COMISSAO_PRAZO = 0 ))
        THEN BEGIN
             SELECT COMISSAO_VISTA, COMISSAO_PRAZO FROM EST_SUBGRUPOS_COTAS
             WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO AND SUBGRUPO = :SUBGRUPO AND
             VENDEDOR = :VENDEDOR
             INTO :VISTA, :PRAZO;

             IF ( VISTA IS NULL )
             THEN BEGIN
                  VISTA = 0;
             END

             IF ( PRAZO IS NULL )
             THEN BEGIN
                  PRAZO = 0;
             END

             IF ( COMISSAO_VISTA = 0 )
             THEN BEGIN
                  COMISSAO_VISTA = VISTA ;
             END

             IF ( COMISSAO_PRAZO = 0 )
             THEN BEGIN
                  COMISSAO_PRAZO = PRAZO ;
             END
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ITENS_FISCAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NOME VARCHAR(50),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    ALIQUOTA_EST NUMERIC(18,4),
    ALIQUOTA_INT NUMERIC(18,4),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
  FOR SELECT
             PRODUTO,
             SEQUENCIA,
             QUANTIDADE_FIS,
             PRC_UNITARIO_FIS,
             PRC_CUSTO,
             ICM,
             ICM_SUBS,
             IPI,
             VOLUME,
             PESO,
             DESCONTO,
             PORC_DESC,
             UNIDADE,
             PRC_UNIT_ORIGINAL,
             NOME_PRODUTO,
             ALIQUOTA,
             PRODUTOFIS,
             NOME_FIS,
             CTE,
             CTIE,
             ORIGEM,
             REDUCAO,
             SUBUNIDADE,
             ALIQUOTA_EST,
             ALIQUOTA_INT
      FROM FAT_VENDAS_ITENS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :PRODUTO,
           :SEQUENCIA,
           :QUANTIDADE,
           :PRC_UNITARIO,
           :PRC_CUSTO,
           :ICM,
           :ICM_SUBS,
           :IPI,
           :VOLUME,
           :PESO,
           :DESCONTO,
           :PORC_DESC,
           :UNIDADE,
           :PRC_UNIT_ORIGINAL,
           :NOME_PRODUTO,
           :ALIQUOTA,
           :PRODUTOFIS,
           :NOME_FIS,
           :CTE,
           :CTIE,
           :ORIGEM,
           :REDUCAO,
           :SUBUNIDADE,
           :ALIQUOTA_EST,
           :ALIQUOTA_INT
       DO
      BEGIN
           SELECT NOME FROM EST_PRODUTOS P
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
           ORDER BY CNPJ, CODIGO
           INTO :NOME ;

           IF ( ORIGEM IS NULL )
           THEN
             ORIGEM = 0;
           
           IF ( CTE IS NULL )
           THEN
             CTE = 0;

           IF ( CTIE IS NULL )
           THEN
             CTIE = 0;

        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_ITENS_SINTEGRA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    TOTAL NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    ALIQUOTA NUMERIC(18,4),
    CFOP INTEGER)
AS
DECLARE VARIABLE UF CHAR(2);
BEGIN
     /* VERIFICANDO SE É EST OU INT */
     SELECT UF FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :UF ;

     /*tratamento da D'talia que possui notas baseadas em valores fiscais de produtos*/
     if (:cnpj = '01737359000109') then
     begin
         IF ( UF = 'MS' )
         THEN BEGIN
            FOR SELECT
               CFOP, ALIQUOTA_EST,
               SUM(vdi.quantidade_fis * vdi.prc_unitario_fis),
               SUM(ICM), SUM(ICM_SUBS),SUM(IPI)
            FROM FAT_VENDAS_ITENS vdi
            WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
            GROUP BY CFOP, ALIQUOTA_EST
            INTO :CFOP, :ALIQUOTA, :TOTAL, :ICM, :ICM_SUBS, :IPI
            DO BEGIN
               SUSPEND;
            END
         END
         ELSE BEGIN
            FOR SELECT
               CFOP, ALIQUOTA_INT,
               SUM(vdi.quantidade_fis * vdi.prc_unitario_fis),
               SUM(ICM), SUM(ICM_SUBS),SUM(IPI)
            FROM FAT_VENDAS_ITENS vdi
            WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
            GROUP BY CFOP, ALIQUOTA_INT
            INTO :CFOP, :ALIQUOTA, :TOTAL, :ICM, :ICM_SUBS, :IPI
            DO BEGIN
               SUSPEND;
            END
         END
     end
     else
     begin
        IF ( UF = 'MS' )
        THEN BEGIN
            FOR SELECT
               CFOP, ALIQUOTA_EST,
               SUM(QUANTIDADE * (PRC_UNITARIO)),
               SUM(ICM), SUM(ICM_SUBS),SUM(IPI)
            FROM FAT_VENDAS_ITENS
            WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
            GROUP BY CFOP, ALIQUOTA_EST
            INTO :CFOP, :ALIQUOTA, :TOTAL, :ICM, :ICM_SUBS, :IPI
            DO BEGIN
               SUSPEND;
            END
         END
         ELSE BEGIN
            FOR SELECT
               CFOP, ALIQUOTA_INT,
               SUM(QUANTIDADE * (PRC_UNITARIO)),
               SUM(ICM), SUM(ICM_SUBS),SUM(IPI)
            FROM FAT_VENDAS_ITENS
            WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
            GROUP BY CFOP, ALIQUOTA_INT
            INTO :CFOP, :ALIQUOTA, :TOTAL, :ICM, :ICM_SUBS, :IPI
            DO BEGIN
               SUSPEND;
            END
         END
     end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_MAIORES_CLIENTES (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4))
AS
BEGIN
     FOR SELECT PESSOA_FJ,
                SUM(DESC_ACRES), SUM(ENTRADA), SUM(DINHEIRO),
                SUM(CHEQUE), SUM(CARTAO), SUM(TICKET), SUM(TOTAL),
                SUM((TOTAL + DESC_ACRES))
     FROM FAT_VENDAS vd
     inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
     WHERE ((vd.data_caixa between :DINI and :DFIM) or vd.data_caixa is null ) AND vd.CNPJ = :CNPJ
     AND FECHADA = 'S' AND coalesce(CANCELADA,'N') =  'N' and nat.computa_venda = 'S' and
     nat.es = 'S'
     GROUP BY PESSOA_FJ
     INTO  :PESSOA_FJ,
           :DESC_ACRES, :ENTRADA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET, :TOTAL,
           :VLRLIQUIDO
     DO BEGIN
        SELECT NOME_RAZAO
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        INTO :NOME;

        SUSPEND;
     END /* FATURAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_MARCA_SEL (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    CODIGO INTEGER,
    DATA DATE,
    PESSOA_FJ INTEGER,
    NF INTEGER,
    NATUREZA INTEGER,
    NOME_RAZAO VARCHAR(50),
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
DECLARE VARIABLE MARC INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PORC NUMERIC(18,4);
DECLARE VARIABLE SELECIONADO CHAR(1);
BEGIN
     FOR SELECT CODIGO, VENDEDOR, FECHADA, TOTAL, DESC_ACRES,
     DATA_CAIXA, PESSOA_FJ, NATUREZA, NUM_NF
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND (( DATA_CAIXA >= :DATAINI  AND DATA_CAIXA <= :DATAFIM )
     OR ( DATA_CAIXA IS NULL ))
     INTO :CODIGO, :VENDEDOR, :FECHADA, :TOTAL, :DESC_ACRESC, :DATA,
     :PESSOA_FJ, :NATUREZA, :NF
     DO BEGIN
        PORC        = 0 ;
        UNITARIO    = 0 ;
        QUANTIDADE  = 0 ;
        UNITARIO    = 0 ;
        CUSTO       = 0 ;

        /* PESSOAS FJ */
        SELECT NOME_RAZAO
        FROM  GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME_RAZAO ;

        /* ITENS */
        FOR SELECT PRODUTO, QUANTIDADE, ( PRC_UNITARIO ),
        ( QUANTIDADE * PRC_CUSTO ), DESCONTO, PRC_UNITARIO
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :PRODUTO, :QUANTIDADE, :UNITARIO, :CUSTO, :DESCONTO,
        :PRC_UNITARIO
        DO BEGIN
           VALOR = :UNITARIO;

           /* PORCENTAGEM DO VALOR UNITARIO EM CIMA DO TOTAL DA VENDA */
           IF ( TOTAL > 0 )
           THEN BEGIN
                PORC = ( :UNITARIO / :TOTAL );
           END
           ELSE BEGIN
                PORC = 0;
           END

           /* VALOR ATRIBUIDO DO ITEM NO TOTAL DO DESCONTO */
           DESC_ACRESC = ( :DESC_ACRESC * :PORC );

           /* ACUMULANDO O DESC/ACRESC DA VENDA NO ITEM */
           UNITARIO = :UNITARIO + :DESC_ACRESC ;

           IF ( :QUANTIDADE IS NULL )
           THEN BEGIN
                QUANTIDADE = 0 ;
           END

           IF ( :UNITARIO IS NULL )
           THEN BEGIN
                UNITARIO = 0 ;
           END

           IF ( :CUSTO IS NULL )
           THEN BEGIN
                CUSTO = 0 ;
           END

           SELECT NOME, CODIGO, UNIDADE, SUBUNIDADE, MARCA
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           ORDER BY CNPJ, CODIGO
           INTO :NOME_PRODUTO, :PRODUTO, :UNIDADE, :SUBUNIDADE, :MARC ;

           FOR SELECT NOME, CODIGO, SELECIONADO
           FROM EST_MARCAS
           WHERE CNPJ = :CNPJ AND CODIGO = :MARC
           INTO :NOME_MARCA, :MARCA, :SELECIONADO
           DO BEGIN
              IF ( :SELECIONADO = 'S' )
              THEN
                  SUSPEND;
           END
        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_MARCA_SINT_ADM (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
begin
  /*Não me pergunte porque este procedure esta construido assim.
  Não foi eu quem fiz. Apenas Identei. fb.*/

  /* Selecionando todas as marcas */
  for select nome, codigo from est_marcas
      where cnpj = :cnpj
      order by nome
      into :nome_marca, :marca
  do
  begin
    /*Selecionando todos os produtos daquela marca*/
    for select nome, codigo, unidade, subunidade
        from est_produtos
        where cnpj = :cnpj and marca = :marca
        order by nome
    into :nome_produto, :produto, :unidade, :subunidade
    do
    begin
      /*--> Esse unitário na verdade já é o preco do item menos o descto X a qtde.
        --> Custo é a mesma coisa, qtde X preco de custo
        --> Peso é a qtde X peso.*/
      for select quantidade, unitario, vendedor, fechada, custo, peso
          from ver_fatura_periodo_sint_adm( :cnpj, :dataini, :datafim, :produto )
          into  :quantidade, :valor, :vendedor, :fechada, :custo, :peso
      do
      begin
        suspend;
      end
    end /* produtos */
  end /* marcas */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_MARCA_SINTETICO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
BEGIN
     /* MARCAS */
     FOR SELECT NOME, CODIGO
     FROM EST_MARCAS
     WHERE CNPJ = :CNPJ AND NOME >= :NOME_INICIAL AND NOME <= :NOME_FINAL
     INTO :NOME_MARCA, :MARCA
     DO BEGIN
        FOR SELECT NOME, CODIGO, UNIDADE, SUBUNIDADE
        FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND MARCA = :MARCA
        ORDER BY CNPJ, MARCA
        INTO :NOME_PRODUTO, :PRODUTO, :UNIDADE, :SUBUNIDADE
        DO BEGIN
           FOR SELECT QUANTIDADE, UNITARIO, VENDEDOR, FECHADA, CUSTO, peso
           FROM VER_FATURA_PERIODO_SINTETICO
           ( :CNPJ, :DATAINI, :DATAFIM, :PRODUTO )
           INTO  :QUANTIDADE, :VALOR, :VENDEDOR, :FECHADA, :CUSTO, :peso
           DO BEGIN
               SUSPEND;
           END
        END /* PRODUTOS */
     END /* MARCAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_NATUREZA (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    COD_NATUREZA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
     if (COD_NATUREZA <> 0) then
     BEGIN
      FOR SELECT vd.CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
         FROM FAT_VENDAS vd
         inner join est_natureza nat on ( vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE (vd.data_caixa between :DINI and :DFIM) and  vd.CNPJ = :CNPJ AND NATUREZA = :COD_NATUREZA
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND (CANCELADA <> 'S' OR CANCELADA IS NULL)
        /* solicitação central eletrecidade para ver devoluções
        and nat.es = 'S' */
         ORDER BY NATUREZA, DATA, vd.CODIGO
         INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
               :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
               :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
               :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
               :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO

         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;

              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDO
              INTO :NOME_VENDEDOR;


            SUSPEND;
         END /* FATURAS */
       END
       ELSE
       BEGIN
             FOR SELECT vd.CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
                NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
                CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
                CHEQUE, CARTAO, TICKET, TOTAL, substring(vd.observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
                CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
                ORCAMENTO, (coalesce(TOTAL,0) + coalesce(DESC_ACRES,0)) AS VALOR_LIQUID
         FROM FAT_VENDAS vd
         inner join est_natureza nat on ( vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE (vd.data_caixa  between :DINI AND :DFIM) AND vd.CNPJ = :CNPJ
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND (CANCELADA <> 'S' OR CANCELADA IS NULL)
         and nat.es = 'S' and nat.computa_venda = 'S'
         ORDER BY NATUREZA, DATA, vd.CODIGO
         INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
               :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
               :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
               :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
               :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
               :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
               :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO
         DO BEGIN

             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_RAZAO;


              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
              INTO :NOME_NATUREZA;
              
              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VENDEDO
              INTO :NOME_VENDEDOR;
              
              
              
            SUSPEND;
         END /* FATURAS */
       END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_PARCELAMENTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENCTO TIMESTAMP,
    PARCELA VARCHAR(6),
    VALOR NUMERIC(18,4),
    BOLETO INTEGER)
AS
BEGIN
      FOR SELECT
             VENCTO,
             PARCELA,
             VALOR,
             BOLETO
      FROM FAT_VENDAS_PARCELAMENTO
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO 
           :VENCTO,
           :PARCELA,
           :VALOR,
           :BOLETO
      DO
      BEGIN
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_POR_GRUPO (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
DECLARE VARIABLE PORC NUMERIC(18,4);
DECLARE VARIABLE DESCTO NUMERIC(18,4);
BEGIN
     /* GRUPOS */
     FOR SELECT NOME, CODIGO
     FROM EST_GRUPOS
     WHERE CNPJ = :CNPJ AND NOME >= :NOME_INICIAL AND NOME <= :NOME_FINAL
     INTO :NOME_GRUPO, :GRUPO
     DO BEGIN
        FOR SELECT NOME, CODIGO
        FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND GRUPO = :GRUPO
        ORDER BY CNPJ, GRUPO
        INTO :NOME_PRODUTO, :PRODUTO
        DO BEGIN
           FOR SELECT
           CODIGO, PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
           ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
           ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
           SUBUNIDADE, ((PRC_UNITARIO) * QUANTIDADE) AS VALOR1
           FROM FAT_VENDAS_ITENS
           WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
           ORDER BY CNPJ, PRODUTO
           INTO :CODIGO, :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
                :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
                :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
                :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :VALOR
           DO BEGIN
              FOR SELECT CODIGO, NUM_NF, DATA, PESSOA_FJ, VENDEDOR, NATUREZA,
              TOTAL, DESC_ACRES, FECHADA
              FROM FAT_VENDAS
              WHERE CNPJ = :CNPJ AND (( DATA_CAIXA >= :DATAINI AND DATA_CAIXA <= :DATAFIM ) OR ( DATA_CAIXA IS NULL )) AND CODIGO = :CODIGO
              INTO :CODIGO, :NF, :DATA, :PESSOA_FJ, :VENDEDOR, :NATUREZA,
              :TOTAL, :DESC_ACRES, :FECHADA
              DO BEGIN
                 IF ( TOTAL > 0 )
                 THEN BEGIN
                      /* PORCENTAGEM DO ITEM NA VENDA */
                      PORC = ((:PRC_UNITARIO - :DESCONTO) / :TOTAL);

                      /* DESCONTO */
                      DESCTO = :DESC_ACRES * PORC ;

                      /* RETIRANDO O VALOR DO DESCONTO DO ITEM */
                      PRC_UNITARIO = :PRC_UNITARIO + :DESCTO;
                 END

                 SELECT NOME_RAZAO
                 FROM GLO_PESSOAS_FJ
                 WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
                 ORDER BY CNPJ, CODIGO
                 INTO :PESSOA_RAZAO ;

                 SELECT NOME
                 FROM FAT_VENDEDOR
                 WHERE CODIGO = :VENDEDOR
                 INTO :NOME_VENDEDOR ;

                 SELECT NOME
                 FROM EST_NATUREZA
                 WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
                 INTO :NOME_NATUREZA ;

                 SUSPEND;
              END /* VENDA */
           END /* VENDA ITENS */
        END /* PRODUTOS */
     END /* GRUPOS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_POR_MARCA (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    NOME_INICIAL VARCHAR(50),
    NOME_FINAL VARCHAR(50))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
     /* MARCAS */
     FOR SELECT NOME, CODIGO
     FROM EST_MARCAS
     WHERE CNPJ = :CNPJ AND NOME >= :NOME_INICIAL AND NOME <= :NOME_FINAL
     INTO :NOME_MARCA, :MARCA
     DO BEGIN
        FOR SELECT NOME, CODIGO
        FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND MARCA = :MARCA
        ORDER BY CNPJ, MARCA
        INTO :NOME_PRODUTO, :PRODUTO
        DO BEGIN
           FOR SELECT
           CODIGO, PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
           ICM_SUBS, IPI, VOLUME, PESO * QUANTIDADE, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
           ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
           SUBUNIDADE, ((PRC_UNITARIO) * QUANTIDADE) AS VALOR1
           FROM FAT_VENDAS_ITENS
           WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
           ORDER BY CNPJ, PRODUTO
           INTO :CODIGO, :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
                :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
                :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
                :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :VALOR
           DO BEGIN
              FOR SELECT CODIGO, NUM_NF, DATA, PESSOA_FJ, VENDEDOR, NATUREZA,
              TOTAL, DESC_ACRES, FECHADA
              FROM FAT_VENDAS
              WHERE CNPJ = :CNPJ AND (( DATA_CAIXA >= :DATAINI AND DATA_CAIXA <= :DATAFIM ) OR ( DATA_CAIXA IS NULL )) AND CODIGO = :CODIGO
              INTO :CODIGO, :NF, :DATA, :PESSOA_FJ, :VENDEDOR, :NATUREZA,
              :TOTAL, :DESC_ACRES, :FECHADA
              DO BEGIN
                 SELECT NOME_RAZAO
                 FROM GLO_PESSOAS_FJ
                 WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
                 ORDER BY CNPJ, CODIGO
                 INTO :PESSOA_RAZAO ;

                 SELECT NOME
                 FROM FAT_VENDEDOR
                 WHERE CODIGO = :VENDEDOR
                 INTO :NOME_VENDEDOR ;

                 SELECT NOME
                 FROM EST_NATUREZA
                 WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
                 INTO :NOME_NATUREZA ;

                 SUSPEND;
              END /* VENDA */
           END /* VENDA ITENS */
        END /* PRODUTOS */
     END /* MARCAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_POR_MARCA_ADM (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    MARCA INTEGER,
    NOME_MARCA VARCHAR(50),
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    FECHADA CHAR(1),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    UNIDADE CHAR(4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
    /*Na verdade este procedimento esta pegando simplesmente todos os itens de vendas que estejam
    dentro de determinado período e sejam Relamente vendas.*/
    for select fv.num_nf, fv.data, fv.pessoa_fj, fv.vendedor, fv.natureza, fv.total, fv.desc_acres, fv.fechada,fv.codigo, nat.nome
    from fat_vendas fv
        inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
        where fv.cnpj = :cnpj and ((fv.data_caixa between :dataini and :datafim) or fv.data_caixa is null)
        and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
        into :nf, :data, :pessoa_fj, :vendedor, :natureza,:total, :desc_acres, :fechada,:codigo, :nome_natureza
    do
    begin
        /*percorrendo as vendas atras de cada venda que tenha aquele produto*/
        for select
                fvi.produto, fvi.sequencia, fvi.quantidade, fvi.prc_unitario, fvi.prc_custo, fvi.icm,
                fvi.icm_subs, fvi.ipi, fvi.volume, fvi.peso * fvi.quantidade, fvi.desconto, fvi.porc_desc, fvi.unidade,
                fvi.prc_unit_original,fvi.aliquota, fvi.produtofis, fvi.nome_fis, fvi.cte, fvi.ctie, fvi.origem, fvi.reducao,
                fvi.subunidade, ((fvi.prc_unitario - fvi.desconto) * fvi.quantidade),
                prd.nome, prd.codigo, prd.nome_marca, prd.marca
            from fat_vendas_itens fvi
            inner join est_produtos prd on (prd.codigo = fvi.produto and prd.cnpj = fvi.cnpj)
            left  join est_marcas mrc on (prd.marca = mrc.codigo and prd.cnpj = mrc.cnpj)
            where fvi.cnpj = :cnpj and fvi.codigo = :codigo
            order by fvi.cnpj, fvi.produto
            into :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
                :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
                :prc_unit_original, :aliquota, :produtofis, :nome_fis,
                :cte, :ctie, :origem, :reducao, :subunidade, :valor,
                :nome_produto, :produto, :nome_marca, :marca
        do
        begin
        
            select nome_razao
            from glo_pessoas_fj
            where cnpj = :cnpj and codigo = :pessoa_fj
            order by cnpj, codigo
            into :pessoa_razao ;
            
            select nome
            from fat_vendedor
            where codigo = :vendedor
            into :nome_vendedor ;
            suspend;
        end
    end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_POR_PRODUTO (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP,
    CODIGO_PRODUTO VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    NF INTEGER,
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER,
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VALOR NUMERIC(18,4))
AS
BEGIN
 If (CODIGO_PRODUTO <> '') then
     BEGIN

     FOR SELECT CODIGO, NUM_NF, DATA_CAIXA, PESSOA_FJ, VENDEDOR, NATUREZA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DATAINI AND DATA_CAIXA <= :DATAFIM
     AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
     INTO :CODIGO, :NF, :DATA, :PESSOA_FJ, :VENDEDOR, :NATUREZA
     DO BEGIN
        FOR SELECT
        PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
        ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
        ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
        SUBUNIDADE, ((PRC_UNITARIO) * QUANTIDADE) AS VALOR1
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :CODIGO_PRODUTO
        ORDER BY CNPJ, CODIGO, PRODUTO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
             :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
             :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :VALOR
        DO BEGIN
           SELECT NOME, GRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :NOME_PRODUTO, :GRUPO ;
           
           SELECT NOME_RAZAO
           FROM GLO_PESSOAS_FJ
           WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
           INTO :PESSOA_RAZAO;

           SELECT NOME
           FROM FAT_VENDEDOR
           WHERE CODIGO = :VENDEDOR
           INTO :NOME_VENDEDOR;

           SELECT NOME
           FROM EST_NATUREZA
           WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
           INTO :NOME_NATUREZA;

           SUSPEND;
        END
     END
   END
 ELSE
     BEGIN

     FOR SELECT CODIGO, NUM_NF, DATA_CAIXA, PESSOA_FJ, VENDEDOR, NATUREZA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DATAINI AND DATA_CAIXA <= :DATAFIM
     AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
     INTO :CODIGO, :NF, :DATA, :PESSOA_FJ, :VENDEDOR, :NATUREZA
     DO BEGIN
        FOR SELECT
        PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
        ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
        ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
        SUBUNIDADE, ((PRC_UNITARIO) * QUANTIDADE) AS VALOR1
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
             :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
             :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE, :VALOR
        DO BEGIN

           SELECT NOME, GRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :NOME_PRODUTO, :GRUPO ;
           
            SELECT NOME_RAZAO
            FROM GLO_PESSOAS_FJ
            WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
            INTO :PESSOA_RAZAO;
            
            SELECT NOME
            FROM FAT_VENDEDOR
            WHERE CODIGO = :VENDEDOR
            INTO :NOME_VENDEDOR;

            SELECT NOME
            FROM EST_NATUREZA
            WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
            INTO :NOME_NATUREZA;

           SUSPEND;

        END
     END
   END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_PRODUTOS (
    CNPJ CHAR(14),
    DATAINI TIMESTAMP,
    DATAFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
     FOR SELECT CODIGO, DATA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DATAINI AND
     DATA_CAIXA <= :DATAFIM AND FECHADA = 'S'  AND ENVIADA_CX = 'S'
     AND (CANCELADA <> 'S' or CANCELADA IS NULL)
     INTO :CODIGO, :DATA
     DO BEGIN
        FOR SELECT
        PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
        ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
        ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
        SUBUNIDADE
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
             :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
             :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE
        DO BEGIN
           SELECT NOME, GRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :NOME_PRODUTO, :GRUPO ;
        
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_PRODUTOS_CARGA (
    CNPJ CHAR(14),
    CARGA INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
     FOR SELECT CODIGO, DATA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CARGA = :CARGA
     INTO :CODIGO, :DATA
     DO BEGIN
        FOR SELECT
        PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
        ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
        ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
        SUBUNIDADE
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
             :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
             :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
             :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE
        DO BEGIN
           SELECT NOME, GRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           INTO :NOME_PRODUTO, :GRUPO ;
        
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_PRODUTOS_FICHA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    SEQUENCIA SMALLINT,
    QUANTIDADE NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    UNIDADE CHAR(4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    ALIQUOTA CHAR(3),
    PRODUTOFIS VARCHAR(15),
    NOME_FIS VARCHAR(50),
    CTE INTEGER,
    CTIE INTEGER,
    ORIGEM INTEGER,
    REDUCAO INTEGER,
    SUBUNIDADE INTEGER)
AS
BEGIN
     FOR SELECT
     PRODUTO, SEQUENCIA, QUANTIDADE, PRC_UNITARIO, PRC_CUSTO, ICM,
     ICM_SUBS, IPI, VOLUME, PESO, DESCONTO, PORC_DESC, UNIDADE, PRC_UNIT_ORIGINAL,
     ALIQUOTA, PRODUTOFIS, NOME_FIS, CTE, CTIE, ORIGEM, REDUCAO,
     SUBUNIDADE
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :PRODUTO, :SEQUENCIA, :QUANTIDADE, :PRC_UNITARIO, :PRC_CUSTO,
          :ICM, :ICM_SUBS, :IPI, :VOLUME, :PESO, :DESCONTO, :PORC_DESC, :UNIDADE,
          :PRC_UNIT_ORIGINAL, :ALIQUOTA, :PRODUTOFIS, :NOME_FIS,
          :CTE, :CTIE, :ORIGEM, :REDUCAO, :SUBUNIDADE
     DO BEGIN
        SELECT NOME, GRUPO
        FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO :NOME_PRODUTO, :GRUPO ;
        
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_SINTEGRA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    CNPJ_CPF VARCHAR(20),
    IE_RG VARCHAR(20),
    SERIE CHAR(3),
    UF CHAR(2),
    PERC_ICMS NUMERIC(18,4),
    MODELO CHAR(3),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    E_S CHAR(1),
    DESPESAS NUMERIC(18,4))
AS
BEGIN
      FOR SELECT CODIGO, DATA, FECHADA, HISTORICO, PESSOA_FJ, USUARIO, VENDEDOR,
          NATUREZA, ENVIADA_CX, FORMA_PGTO, NUM_NF, NUM_CUPOM, PROPRIEDADE,
          CONVENIADO, TIPO_DOCTO, LOCAL_COBRANCA, DESC_ACRES, ENTRADA, DINHEIRO,
          CHEQUE, CARTAO, TICKET, TOTAL_NOTA, substring(observacao from 1 for 200), VLR_PARC_LC, TERCEIRO,
          CARGA, VOLUME,PESO,REQUISICAO,DESCRICAO,TIPO_VENDA,NOME_CONSUMIDOR,
          ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, DATA_CAIXA, TROCO,
          CANCELADA, SERIE, FRETE, SEGURO, DESPESAS
      FROM FAT_VENDAS
      WHERE CNPJ = :CNPJ AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM
      AND FECHADA = 'S'
      INTO  :CODIGO,:DATA,:FECHADA,:HISTORICO,:PESSOA_FJ,
            :USUARIO,:VENDEDO,:NATUREZA,:ENVIADA_CX,:FORMA_PGTO,
            :NUM_NF,:NUM_CUPOM,:PROPRIEDADE,:CONVENIADO,:TIPO_DOCTO,
            :LOCAL_COBRANCA,:DESC_ACRES,:ENTRADA,:DINHEIRO,
            :CHEQUE,:CARTAO,:TICKET,:TOTAL,:OBSERVACAO,:VLR_PARC_LC,
            :TERCEIRO,:CARGA,:VOLUME,:PESO,:REQUISICAO,:DESCRICAO,
            :TIPO_VENDA,:NOME_CONSUMIDOR,:ORCAMENTO, :VLRLIQUIDO,
            :DATA_CAIXA, :TROCO, :CANCELADA, :SERIE,
            :FRETE, :SEGURO, :DESPESAS
      DO BEGIN
         SELECT NOME_RAZAO, CPF_CGC, RG_IE, UF
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO :PESSOA_RAZAO, :CNPJ_CPF, :IE_RG, :UF;

         SELECT NOME, PERC_ICMS, nat.es
         FROM EST_NATUREZA nat
         WHERE CNPJ = :CNPJ AND CODIGO = :NATUREZA
         INTO :NOME_NATUREZA, PERC_ICMS,  :e_s;

         SELECT MODELO
         FROM SIS_SERIENF
         WHERE CNPJ = :CNPJ AND SERIE = :SERIE
         INTO :MODELO ;

         IF ( MODELO IS NULL )
         THEN
           MODELO = '01';
              
         SELECT NOME, COM_VISTA, COM_PRAZO
         FROM FAT_VENDEDOR
         WHERE CODIGO = :VENDEDO
         INTO :NOME_VENDEDOR, :COM_VISTA, :COM_PRAZO;

         IF ( CANCELADA IS NULL )
         THEN
           CANCELADA = 'N' ;

         SUSPEND;
      END /* FATURAS */
END
^

ALTER PROCEDURE VER_FAT_VENDAS_SUBGRUPO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE,
    COD_GRUPO INTEGER,
    COD_SUBGRUPO INTEGER)
RETURNS (
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    NOME_GRUPO VARCHAR(50),
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    NOME_PRODUTO VARCHAR(50),
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    QUANTIDADE NUMERIC(18,4),
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE GRP INTEGER;
DECLARE VARIABLE SUB_GRP INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE UNITARIO NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PORC NUMERIC(18,4);
BEGIN
     FOR SELECT CODIGO, VENDEDOR, FECHADA, TOTAL, DESC_ACRES
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND (( DATA_CAIXA >= :DATAINI  AND DATA_CAIXA <= :DATAFIM )
     OR ( DATA_CAIXA IS NULL ))
     INTO :CODIGO, :VENDEDOR, :FECHADA, :TOTAL, :DESC_ACRESC
     DO BEGIN
        PORC        = 0 ;
        UNITARIO    = 0 ;
        QUANTIDADE  = 0 ;
        UNITARIO    = 0 ;
        CUSTO       = 0 ;

        /* ITENS */
        FOR SELECT PRODUTO, QUANTIDADE, ( PRC_UNITARIO ), ( QUANTIDADE * PRC_CUSTO )
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
        ORDER BY CNPJ, CODIGO
        INTO :PRODUTO, :QUANTIDADE, :UNITARIO, :CUSTO
        DO BEGIN
           VALOR = :UNITARIO;

           /* PORCENTAGEM DO VALOR UNITARIO EM CIMA DO TOTAL DA VENDA */
           IF ( TOTAL > 0 )
           THEN BEGIN
                PORC = ( :UNITARIO / :TOTAL );
           END
           ELSE BEGIN
                PORC = 0;
           END

           /* VALOR ATRIBUIDO DO ITEM NO TOTAL DO DESCONTO */
           DESC_ACRESC = ( :DESC_ACRESC * :PORC );

           /* ACUMULANDO O DESC/ACRESC DA VENDA NO ITEM */
           UNITARIO = :UNITARIO + :DESC_ACRESC ;

           IF ( :QUANTIDADE IS NULL )
           THEN BEGIN
                QUANTIDADE = 0 ;
           END

           IF ( :UNITARIO IS NULL )
           THEN BEGIN
                UNITARIO = 0 ;
           END

           IF ( :CUSTO IS NULL )
           THEN BEGIN
                CUSTO = 0 ;
           END

           NOME_PRODUTO = NULL;

           SELECT NOME, CODIGO, UNIDADE, SUBUNIDADE, GRUPO, SUBGRUPO
           FROM EST_PRODUTOS
           WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
           ORDER BY CNPJ, CODIGO
           INTO :NOME_PRODUTO, :PRODUTO, :UNIDADE, :SUBUNIDADE, :GRP, :SUB_GRP ;

           IF ((NOT ( NOME_PRODUTO IS NULL ))
           AND ( :GRP = :COD_GRUPO ) AND ( SUB_GRP = :COD_SUBGRUPO ))
           THEN BEGIN
                GRUPO         = NULL;
                NOME_GRUPO    = NULL;
                SUBGRUPO      = NULL;
                NOME_SUBGRUPO = NULL;
                NOME_VENDEDOR = NULL;

                SELECT NOME
                FROM FAT_VENDEDOR
                WHERE CNPJ = :CNPJ AND CODIGO = :VENDEDOR
                INTO :NOME_VENDEDOR ;

                SELECT NOME, CODIGO
                FROM EST_GRUPOS
                WHERE CNPJ = :CNPJ AND CODIGO = :GRP
                INTO :NOME_GRUPO, :GRUPO ;

                SELECT NOME, SUBGRUPO
                FROM EST_SUBGRUPOS
                WHERE CNPJ = :CNPJ AND GRUPO = :GRP AND SUBGRUPO = :SUB_GRP
                INTO :NOME_SUBGRUPO, :SUBGRUPO ;

                SUSPEND;
           END
        END
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_VEICULO (
    CNPJ VARCHAR(14),
    CODIGO INTEGER)
RETURNS (
    VEICULO INTEGER,
    PLACA CHAR(8),
    KM_ATUAL NUMERIC(18,4),
    PESSOA_FJ INTEGER,
    MODELO VARCHAR(50),
    COMBUSTIVEL VARCHAR(15),
    MEDIA_KM NUMERIC(18,4))
AS
begin
     FOR SELECT VEICULO, PLACA, KM_ATUAL, PESSOA_FJ
     FROM FAT_VENDAS_VEICULO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :VEICULO, :PLACA, :KM_ATUAL, :PESSOA_FJ
     DO BEGIN
        SELECT MODELO, COMBUSTIVEL, MEDIA_KM
        FROM GLO_VEICULOS
        WHERE CNPJ = :CNPJ AND PLACA = :PLACA and PESSOA_FJ = :PESSOA_FJ
        INTO :MODELO, :COMBUSTIVEL, :MEDIA_KM ;

        suspend;
     END
END
^

ALTER PROCEDURE VER_FAT_VENDAS_VENDEDOR (
    CNPJ VARCHAR(14),
    DINI DATE,
    DFIM DATE,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    PAGA_COMISSAO CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    DT_EMISSAO_AGRUPADA TIMESTAMP,
    IRRF NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4),
    ISS NUMERIC(18,4),
    SERIE CHAR(3),
    CONTA_CAIXA INTEGER,
    VLR_VISTA NUMERIC(18,4),
    VLR_PRAZO NUMERIC(18,4))
AS
DECLARE VARIABLE TOTAL_SIMPLES NUMERIC(18,4);
DECLARE VARIABLE TOTAL_NOTA NUMERIC(18,4);
BEGIN
/*Alteraçõs: Fabiano 16/11/2005
 1 - "/*AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))"
     Comentei esta parte do código porque o relatorio de vendas canceladas estava pegando informação
     deste mesmo procedimente, mas como ele internamente ja bloqueia as vendas canceladas o relatorio
     saia em branco. obs.. isso pode ter ferrado outras partes..*/
     if (vendedor <> 0)
     then begin
          /*procurando em trocas*/
          for select codigo,data, fechado, pessoa_fj, usuario, vendedor, enviada_cx, forma_pgto,tipo_docto,
            local_cobranca,
            coalesce(desc_acresc,0),
            coalesce(entrada,0),
            coalesce(dinheiro,0),
            coalesce(cheque,0),
            coalesce(cartao,0),
            coalesce(ticket,0),
            ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
            substring(trc.observacao from 1 for 200),
            coalesce(vlr_parc_lc,0),
            volume,peso,nome_consumidor,
            ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
            data_caixa,coalesce(cancelada,'N'),conta_caixa
            from fat_trocas trc
            where ((trc.data_caixa between :dini and :dfim ) or (data_caixa is null)) and cnpj = :cnpj and vendedor = :vendedor
            into :codigo,:data,:fechada,:pessoa_fj,:usuario,:vendedo,:enviada_cx,:forma_pgto,:tipo_docto,
            :local_cobranca,:desc_acres,:entrada,:dinheiro, :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
            :volume,:peso,:nome_consumidor,:vlrliquido, :data_caixa, :cancelada,:conta_caixa
          do
          begin
  
            TIPO_VENDA  = 'TRC';
            if (:vlrliquido > 0) then
            begin
              vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
              if (:vlr_vista > :vlrliquido) then
                vlr_vista = :vlrliquido;
              vlr_Prazo = :vlrliquido - :vlr_vista;
            end
            else
            begin
              vlr_vista = :vlrliquido;
              vlr_Prazo = 0;
            end
              
            select nome_razao
            from glo_pessoas_fj
            where cnpj = :cnpj and codigo = :pessoa_fj
            into :pessoa_razao;

            if (:cancelada = 'S') then
            begin
              pessoa_razao = substring(:pessoa_razao from 1 for 45) ||'-CANC';
              vlr_vista = 0;
              vlr_Prazo = 0;
              desc_acres = 0;
              entrada = 0;
              dinheiro = 0;
              cheque = 0;
              cartao = 0;
              ticket = 0;
              total = 0;
              vlr_parc_lc = 0;
              vlrliquido = 0;
            end

            select (coalesce(codigo,'') ||' - '||coalesce(nome,'')), com_vista, com_prazo
            from fat_vendedor
            where  cnpj = :cnpj and codigo = :vendedo
            into :nome_vendedor, :com_vista, :com_prazo;
          
            paga_comissao = 'S';
            suspend;
          end

          /*procurando em vendas*/
          for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, coalesce(desc_acres,0), coalesce(entrada,0), coalesce(dinheiro,0),
                coalesce(cheque,0), coalesce(cartao,0), coalesce(ticket,0), coalesce(total_nota,0), substring(vd.observacao from 1 for 200), coalesce(vlr_parc_lc,0), terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, (coalesce(total,0) + coalesce(desc_acres,0)) as valor_liquid , data_caixa,
                coalesce(troco,0), coalesce(cancelada,'N'), dt_emissao_agrupada, irrf, pis_cofins_csll, inss, iss,
                serie,conta_caixa, coalesce(total_nota,0), coalesce(total,0)
          from fat_vendas vd
          inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
          where ((vd.data_caixa between :dini and :dfim ) or (data_caixa is null))
          and vd.cnpj = :cnpj and vendedor = :vendedor and nat.es = 'S'
          and coalesce(nat.rel_gerencial,'S') = 'S'
          /*and nat.computa_venda = 'S'  retirado por conta do caso 456 da fert flora, sobre uma NF cancelada que não listava no relatorio
         este mesmo procedure alimenta o realtorio e conforme sugestão do kaiser, foi retirada esta validacao*/
          order by vendedor
          into  :codigo,:data,:fechada,:historico,:pessoa_fj,
               :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
               :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
               :local_cobranca,:desc_acres,:entrada,:dinheiro,
               :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
               :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
               :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
               :data_caixa, :troco, :cancelada, :dt_emissao_agrupada,
               :irrf, :pis_cofins_csll, :inss, :iss, :serie, :conta_caixa,
               :total_nota, :total_simples
          do begin
             vlrliquido = (:total_simples + :desc_acres);
             total = (:total_simples);

             vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
             vlr_prazo = :vlrliquido - :vlr_vista; /*desconto acrescimo ja vem negativo se for desconto por isso somo*/

             select nome_razao
             from glo_pessoas_fj
             where cnpj = :cnpj and codigo = :pessoa_fj
             into :pessoa_razao;

             if (:cancelada = 'S') then
             begin
               pessoa_razao = substring(:pessoa_razao from 1 for 45) ||'-CANC';

               desc_acres = 0;
               entrada = 0;
               dinheiro = 0;
               cheque = 0;
               cartao = 0;
               ticket = 0;
               total = 0;
               vlr_parc_lc = 0;
               troco = 0;
               total_nota = 0;
               total_simples = 0;
               vlr_vista = 0;
               vlr_prazo = 0;
               vlrliquido = 0;
               total = 0;
             end

              select nome, paga_comissao
              from est_natureza
              where cnpj = :cnpj and codigo = :natureza
              into :nome_natureza, :paga_comissao;

              select (coalesce(codigo,'') ||' - '||coalesce(nome,'')), com_vista, com_prazo
              from fat_vendedor
              where  cnpj = :cnpj and codigo = :vendedo
              into :nome_vendedor, :com_vista, :com_prazo;


            suspend;
          end /* faturas */
       end
       else
       begin
          /* procurando em trocas*/
          for select codigo,data, fechado, pessoa_fj, usuario, vendedor, enviada_cx, forma_pgto,tipo_docto,
              local_cobranca,
              coalesce(desc_acresc,0),
              coalesce(entrada,0),
              coalesce(dinheiro,0),
              coalesce(cheque,0),
              coalesce(cartao,0),
              coalesce(ticket,0),
              ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
              substring(trc.observacao from 1 for 200),
              coalesce(vlr_parc_lc,0),
              volume,peso,nome_consumidor,
              ((coalesce(total_2,0) + coalesce(desc_acresc_2,0)) - (coalesce(total,0) + coalesce(desc_acresc,0))),
              data_caixa,coalesce(cancelada,'N'),conta_caixa
            from fat_trocas trc
            where ((trc.data_caixa between :dini and :dfim ) or (data_caixa is null)) and cnpj = :cnpj
            order by vendedor
            into :codigo,:data,:fechada,:pessoa_fj,:usuario,:vendedo,:enviada_cx,:forma_pgto,:tipo_docto,
            :local_cobranca,:desc_acres,:entrada,:dinheiro, :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
            :volume,:peso,:nome_consumidor,:vlrliquido, :data_caixa, :cancelada,:conta_caixa
          do
          begin
            if (:vlrliquido > 0) then
            begin
              vlr_vista = (:dinheiro + :cheque + :cartao + :ticket);
              if (:vlr_vista > :vlrliquido) then
                vlr_vista = :vlrliquido;
              vlr_Prazo = :vlrliquido - :vlr_vista;
            end
            else
            begin
              vlr_vista = :vlrliquido;
              vlr_Prazo = 0;
            end

            tipo_venda  = 'TRC';
            select nome_razao
            from glo_pessoas_fj
            where cnpj = :cnpj and codigo = :pessoa_fj
            into :pessoa_razao;

            if (:cancelada = 'S') then
            begin
              pessoa_razao = substring(:pessoa_razao from 1 for 45) ||'-CANC';
              vlr_vista = 0;
              vlr_Prazo = 0;
              desc_acres = 0;
              entrada = 0;
              dinheiro = 0;
              cheque = 0;
              cartao = 0;
              ticket = 0;
              total = 0;
              vlr_parc_lc = 0;
              vlrliquido = 0;
            end
        
            select (coalesce(codigo,'') ||' - '||coalesce(nome,'')), com_vista, com_prazo
            from fat_vendedor psa
            where  cnpj = :cnpj and codigo = :vendedo
            into :nome_vendedor, :com_vista, :com_prazo;
          
            paga_comissao = 'S';

            suspend;
          end

          /*procurando em vendas*/
          for select vd.codigo, data, coalesce(fechada,'N'), historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, coalesce(desc_acres,0), entrada, dinheiro,
                cheque, cartao, ticket, total_nota, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, data_caixa, troco,
                coalesce(cancelada,'N'), dt_emissao_agrupada, irrf, pis_cofins_csll, inss, iss,
                serie, conta_caixa, coalesce(total_nota,0), coalesce(total,0)
         from fat_vendas vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         where ((vd.data_caixa between :dini and :dfim) or (data_caixa is null)) and vd.cnpj = :cnpj and nat.es = 'S'
         /*and nat.computa_venda = 'S'  retirado por conta do caso 456 da fert flora, sobre uma NF cancelada que não listava no relatorio
         este mesmo procedure alimenta o realtorio e conforme sugestão do kaiser, foi retirada esta validacao*/
         order by vendedor
         into  :codigo,:data,:fechada,:historico,:pessoa_fj,
               :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
               :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
               :local_cobranca,:desc_acres,:entrada,:dinheiro,
               :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
               :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
               :tipo_venda,:nome_consumidor,:orcamento,  :data_caixa, :troco, :cancelada, :dt_emissao_agrupada,
               :irrf, :pis_cofins_csll, :inss, :iss, :serie, :conta_caixa,
               :total_nota, :total_simples
         do begin

               vlrliquido = (:total_simples + :desc_acres);
               total = (:total_simples);


             vlr_vista = :dinheiro + :cartao + :cheque + :ticket + :troco;
             vlr_prazo = :vlrliquido - :vlr_vista; /*desconto acrescimo ja vem negativo se for desconto por isso somo*/

             select nome_razao
             from glo_pessoas_fj
             where cnpj = :cnpj and codigo = :pessoa_fj
             into :pessoa_razao;

             if (:cancelada = 'S') then
             begin
               pessoa_razao = substring(:pessoa_razao from 1 for 45) ||'-CANC';
               desc_acres = 0;
               entrada = 0;
               dinheiro = 0;
               cheque = 0;
               cartao = 0;
               ticket = 0;
               total = 0;
               vlr_parc_lc = 0;
               troco = 0;
               total_nota = 0;
               total_simples = 0;
               vlr_vista = 0;
               vlr_prazo = 0;
               vlrliquido = 0;
               total = 0;
             end

              select nome, paga_comissao
              from est_natureza
              where cnpj = :cnpj and codigo = :natureza
              into :nome_natureza, :paga_comissao;
              
              select (coalesce(codigo,'') ||' - '||coalesce(nome,'')), com_vista, com_prazo
              from fat_vendedor
              where cnpj = :cnpj and codigo = :vendedo
              into :nome_vendedor, :com_vista, :com_prazo;

              suspend;
         end /* faturas */
       end
END
^

ALTER PROCEDURE VER_FAT_VENDAS_VENDEDOR_GERAL (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    PESSOA_RAZAO VARCHAR(50),
    USUARIO INTEGER,
    NATUREZA INTEGER,
    NOME_NATUREZA VARCHAR(50),
    PAGA_COMISSAO CHAR(1),
    ENVIADA_CX CHAR(1),
    DATA_CAIXA TIMESTAMP,
    FORMA_PGTO INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    PROPRIEDADE INTEGER,
    CONVENIADO INTEGER,
    TIPO_DOCTO CHAR(3),
    LOCAL_COBRANCA INTEGER,
    DESC_ACRES NUMERIC(18,4),
    ENTRADA NUMERIC(18,4),
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    TROCO NUMERIC(18,4),
    VLRLIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    VLR_PARC_LC NUMERIC(18,4),
    TERCEIRO INTEGER,
    CARGA INTEGER,
    VOLUME NUMERIC(18,4),
    PESO NUMERIC(18,4),
    REQUISICAO VARCHAR(6),
    DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    ORCAMENTO INTEGER,
    VENDEDO INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    CANCELADA CHAR(1),
    COM_PRAZO NUMERIC(18,4),
    COM_VISTA NUMERIC(18,4),
    DT_EMISSAO_AGRUPADA TIMESTAMP,
    IRRF NUMERIC(18,4),
    PIS_COFINS_CSLL NUMERIC(18,4),
    INSS NUMERIC(18,4),
    ISS NUMERIC(18,4),
    SERIE CHAR(3),
    CONTA_CAIXA INTEGER)
AS
BEGIN
     if (vendedor <> 0) then
     begin
      for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
                cheque, cartao, ticket, total, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, (total + desc_acres) as valor_liquid , data_caixa, troco, cancelada,
                dt_emissao_agrupada, conta_caixa
         from fat_vendas vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         where (( data_caixa >= :dini and data_caixa <= :dfim ) or (data_caixa is null))
         and vd.cnpj = :cnpj and vendedor = :vendedor
         and enviada_cx = 'S'  and nat.es = 'S'
         order by vendedor
         into  :codigo,:data,:fechada,:historico,:pessoa_fj,
               :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
               :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
               :local_cobranca,:desc_acres,:entrada,:dinheiro,
               :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
               :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
               :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
               :data_caixa, :troco, :cancelada, :dt_emissao_agrupada, :conta_caixa
         do
         begin
           select nome_razao from glo_pessoas_fj
           where cnpj = :cnpj and codigo = :pessoa_fj
           into :pessoa_razao;

           select nome, paga_comissao
           from est_natureza
           where cnpj = :cnpj and codigo = :natureza
           into :nome_natureza, :paga_comissao;

           select nome, com_vista, com_prazo
           from fat_vendedor
           where codigo = :vendedo
           into :nome_vendedor, :com_vista, :com_prazo;


           suspend;
         end /* faturas */
     end
     else
     begin
         for select vd.codigo, data, fechada, historico, pessoa_fj, usuario, vendedor,
                natureza, enviada_cx, forma_pgto, num_nf, num_cupom, propriedade,
                conveniado, tipo_docto, local_cobranca, desc_acres, entrada, dinheiro,
                cheque, cartao, ticket, total, substring(vd.observacao from 1 for 200), vlr_parc_lc, terceiro,
                carga, volume,peso,requisicao,descricao,tipo_venda,nome_consumidor,
                orcamento, (total + desc_acres) as valor_liquid, data_caixa, troco, cancelada,
                dt_emissao_agrupada, conta_caixa
         from fat_vendas vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         where (( data_caixa >= :dini and data_caixa <= :dfim ) or (data_caixa is null)) and vd.cnpj = :cnpj
         and enviada_cx = 'S' and nat.es = 'S'
         order by vendedor
         into  :codigo,:data,:fechada,:historico,:pessoa_fj,
               :usuario,:vendedo,:natureza,:enviada_cx,:forma_pgto,
               :num_nf,:num_cupom,:propriedade,:conveniado,:tipo_docto,
               :local_cobranca,:desc_acres,:entrada,:dinheiro,
               :cheque,:cartao,:ticket,:total,:observacao,:vlr_parc_lc,
               :terceiro,:carga,:volume,:peso,:requisicao,:descricao,
               :tipo_venda,:nome_consumidor,:orcamento, :vlrliquido,
               :data_caixa, :troco, :cancelada, :dt_emissao_agrupada,:conta_caixa
         do begin
             select nome_razao
             from glo_pessoas_fj
             where cnpj = :cnpj and codigo = :pessoa_fj
             plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
             order by cnpj, codigo
             into :pessoa_razao;


              select nome
              from est_natureza
              where cnpj = :cnpj and codigo = :natureza
              into :nome_natureza;
              
              select nome, com_vista, com_prazo
              from fat_vendedor
              where codigo = :vendedo
              into :nome_vendedor, :com_vista, :com_prazo;

            suspend;
         end /* faturas */
     end
END
^

ALTER PROCEDURE VER_FATURA (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    DUPLICATA VARCHAR(30),
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS, AGRUPADORA,
         DATA_BAIXA, USUARIO, VALOR_ORIGINAL, ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS, :AGRUPADORA,
         :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL, :ULTIMA_BX_PARCIAL
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_CAIXA (
    CNPJ CHAR(14),
    DATA_CAIXA TIMESTAMP,
    USR INTEGER,
    TURNO INTEGER,
    CONTA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14),
    ORIGEM CHAR(3),
    CONTA_BANCO INTEGER)
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS,
         AGRUPADORA, DATA_BAIXA, USUARIO, VALOR_ORIGINAL,
         ULTIMA_BX_PARCIAL, ORIGEM, CONTA
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND DATA_BAIXA = :DATA_CAIXA
     AND USUARIO = :USR AND BAIXADA = 'S' AND TURNO = :TURNO
     AND CONTA = :CONTA
     ORDER BY CNPJ, DATA_BAIXA, USUARIO, TURNO, CONTA
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS,
         :AGRUPADORA, :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL,
         :ULTIMA_BX_PARCIAL, :ORIGEM, :CONTA_BANCO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, substring(FONE from 1 for 15)
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;


        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_EMITIDA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    BANCO VARCHAR(3),
    BOLETO VARCHAR(30),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    DUPLICATA VARCHAR(30),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO, BANCO, DUPLICATA, BOLETO,
         TIPO, ENVIADA, OBS, AGRUPADORA, DATA_BAIXA, USUARIO, VALOR_ORIGINAL,
         ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND CODIGO = :COD
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :DUPLICATA, :BOLETO, :TIPO, :ENVIADA, :OBS, :AGRUPADORA,
         :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL, :ULTIMA_BX_PARCIAL
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_GERAL (
    CNPJ CHAR(14),
    DATA_CAIXA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    ORIGEM CHAR(3))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS,
         AGRUPADORA, DATA_BAIXA, USUARIO, VALOR_ORIGINAL,
         ULTIMA_BX_PARCIAL, ORIGEM
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND CAST(DATA_BAIXA AS DATE) = :DATA_CAIXA
     ORDER BY CNPJ, DATA_BAIXA, USUARIO, TURNO
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS,
         :AGRUPADORA, :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL,
         :ULTIMA_BX_PARCIAL, :ORIGEM
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;


        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    LOTE VARCHAR(10),
    CODIGO_LOTE INTEGER,
    VALIDADE_LOTE DATE,
    PRC_CUSTO NUMERIC(18,4),
    CUSTO_MEDIO NUMERIC(18,4),
    LUCRO_ITEM NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRC_UNITARIO_FIS NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_MARCA VARCHAR(50),
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    QTDE_ENTREGUE NUMERIC(18,4),
    QUANTIDADE_FIS NUMERIC(18,4),
    SEQUENCIA INTEGER,
    CFOP INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    COMPLEMENTO VARCHAR(100),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    BCH_CODIGO INTEGER,
    REDUCAO INTEGER,
    SERVICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    GRADE VARCHAR(4),
    NUMERO VARCHAR(6),
    CODIGO_2 VARCHAR(15),
    MENSAGEM_REDUCAO VARCHAR(80),
    VENDEDOR VARCHAR(50),
    ENTREGUE FLOAT,
    CARREGADO FLOAT,
    DEVOLVIDO FLOAT,
    CARGA_CREDITO_UND FLOAT,
    CARGA_CREDITO_REAIS FLOAT)
AS
DECLARE VARIABLE AGRUPADOR VARCHAR(15);
DECLARE VARIABLE MARCA INTEGER;
DECLARE VARIABLE VDD INTEGER;
BEGIN
     FOR SELECT
         DESCONTO, ICM, ICM_SUBS, IPI, PESO, PORC_DESC, PRODUTOFIS,
         PRC_CUSTO, VE.custo_medio, ve.lucro_item, PRC_UNIT_ORIGINAL, PRC_UNITARIO, PRODUTO, QUANTIDADE,
         SEQUENCIA, UNIDADE, SUBUNIDADE, VOLUME, ALIQUOTA, ORIGEM, CTE, CTIE,
         REDUCAO, COMPLEMENTO, SERVICO, QUANTIDADE_FIS, PRC_UNITARIO_FIS, GRADE, NUMERO,
         MENSAGEM_REDUCAO, CFOP, LOTE, CODIGO_LOTE, VE.vendedor, ve.qtde_entregue
     from FAT_VENDAS_ITENS VE
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
         :DESCONTO, :ICM, :ICM_SUBS, :IPI, :PESO, :PORC_DESC, :PRODUTOFIS,
         :PRC_CUSTO, :CUSTO_MEDIO, :lucro_item, :PRC_UNIT_ORIGINAL, :PRC_UNITARIO, :PRODUTO, :QUANTIDADE,
         :SEQUENCIA, :UNIDADE, :SUBUNIDADE, :VOLUME, :ALIQUOTA, :ORIGEM, :CTE, :CTIE,
         :REDUCAO, :COMPLEMENTO, :SERVICO, :QUANTIDADE_FIS, :PRC_UNITARIO_FIS, :GRADE, :NUMERO,
         :MENSAGEM_REDUCAO, :CFOP, :LOTE, :CODIGO_LOTE, :vdd, :QTDE_ENTREGUE
     DO BEGIN
        /* ----------- Controle de Carga --------------------- */
        select sum(coalesce(crgi.entregue,0)), sum(coalesce(crgi.carregado,0)), sum(coalesce(crgi.devolvido,0))
        from crg_ordem_carga crg
        inner join crg_ordem_carga_itens crgi on (crgi.codigo = crg.codigo and crgi.cnpj = crg.cnpj)
        where crg.codigo_vnd = :CODIGO and crgi.produto = :PRODUTO and crg.cnpj = :CNPJ
        into :ENTREGUE, :CARREGADO, :DEVOLVIDO;
        CARGA_CREDITO_UND   = QUANTIDADE + DEVOLVIDO - ENTREGUE - CARREGADO;
        CARGA_CREDITO_REAIS = PRC_UNITARIO * CARGA_CREDITO_UND;

        /* ----------- Vendedor --------------------- */
        select vdd.nome from fat_vendedor vdd
        where vdd.cnpj = :cnpj and vdd.codigo = :vdd
        into :vendedor;

        select nome, cod_agrup, codigo_2, marca, bch_codigo
        FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO :NOME_PRODUTO, :AGRUPADOR, :codigo_2, :MARCA, :bch_codigo;

        if ( marca is null )then
        begin
             nome_marca = '<>';
        end
        else
        begin
          select nome from est_marcas
          where codigo = :marca and cnpj = :cnpj
          into :nome_marca ;
        end

        /* ----------- Lote --------------------- */
        SELECT VALIDADE
        FROM EST_LOTE_PRODUTO
        WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND CODIGO = :CODIGO_LOTE
        INTO :VALIDADE_LOTE ;

        IF ( AGRUPADOR IS NULL )
        THEN BEGIN
             SELECT NOME FROM EST_PRODUTOS
             WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTOFIS
             INTO NOME_FIS ;
        END
        ELSE BEGIN
             SELECT NOME FROM EST_AGRUPADORES
             WHERE CNPJ = :CNPJ AND CODIGO = :AGRUPADOR
             INTO NOME_FIS ;

             PRODUTOFIS = :AGRUPADOR ;
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_ITENS_AGRUPADA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    COMPLEMENTO VARCHAR(100),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    SERVICO BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
DECLARE VARIABLE AGRUPADOR VARCHAR(15);
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
     FOR SELECT CODIGO
     FROM FAT_VENDAS
     WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
     AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND DUPLICATA = 0 AND
     TIPO_VENDA = 'FFT' AND (( NUM_NF IS NULL ) OR ( NUM_NF <= 0 ))
     INTO  :CODIGO
     DO BEGIN
         FOR SELECT
         DESCONTO, ICM, ICM_SUBS, IPI, PESO, PORC_DESC, PRODUTOFIS,
         PRC_CUSTO, PRC_UNIT_ORIGINAL, PRC_UNITARIO, PRODUTO, QUANTIDADE,
         SEQUENCIA, UNIDADE, SUBUNIDADE, VOLUME, ALIQUOTA, ORIGEM, CTE, CTIE,
         REDUCAO, COMPLEMENTO, SERVICO
         FROM FAT_VENDAS_ITENS VE
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO
         :DESCONTO, :ICM, :ICM_SUBS, :IPI, :PESO, :PORC_DESC, :PRODUTOFIS,
         :PRC_CUSTO, :PRC_UNIT_ORIGINAL, :PRC_UNITARIO, :PRODUTO, :QUANTIDADE,
         :SEQUENCIA, :UNIDADE, :SUBUNIDADE, :VOLUME, :ALIQUOTA, :ORIGEM, :CTE, :CTIE,
         :REDUCAO, :COMPLEMENTO, :SERVICO
         DO BEGIN
            SELECT NOME, COD_AGRUP FROM EST_PRODUTOS
            WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
            INTO :NOME_PRODUTO, :AGRUPADOR ;

            IF ( AGRUPADOR IS NULL )
            THEN BEGIN
                 SELECT NOME FROM EST_PRODUTOS
                 WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTOFIS
                 INTO NOME_FIS ;
            END
            ELSE BEGIN
                 SELECT NOME FROM EST_AGRUPADORES
                 WHERE CNPJ = :CNPJ AND CODIGO = :AGRUPADOR
                 INTO NOME_FIS ;

                 PRODUTOFIS = :AGRUPADOR ;
            END

            SUSPEND;
         END
     END
END
^

ALTER PROCEDURE VER_FATURA_PERIODO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(20),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    RG_IE VARCHAR(20))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS,
         AGRUPADORA, DATA_BAIXA, USUARIO, VALOR_ORIGINAL,
         ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ
     AND VENCIMENTO >= :DINI
     AND VENCIMENTO <= :DFIM
     AND BAIXADA <> 'S'
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS,
         :AGRUPADORA, :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL,
         :ULTIMA_BX_PARCIAL
     DO BEGIN
        /* PESSOAS FJ */
        SELECT p.ENDERECO, p.BAIRRO, p.CIDADE, p.NOME_RAZAO, p.FONE, p.CPF_CGC, p.NUMERO, p.CEP, p.UF,
        p.FANTASIA, p.rg_ie
        FROM   GLO_PESSOAS_FJ P
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
--        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY p.CNPJ, p.CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA, :rg_ie ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;


        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_PERIODO_BAIXADAS (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(20),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO VARCHAR(14),
    RG_IE VARCHAR(20))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS,
         AGRUPADORA, VALOR_ORIGINAL, :ULTIMA_BX_PARCIAL,
         DATA_BAIXA, USUARIO
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND DATA_BAIXA >= :DINI AND DATA_BAIXA <= :DFIM
     AND BAIXADA = 'S'
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS,
         :AGRUPADORA, :VALOR_ORIGINAL, :ULTIMA_BX_PARCIAL,
         :DATA_BAIXA, :USUARIO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA, RG_IE
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA, :RG_IE ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;


        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_PERIODO_SINT_ADM (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_NF NUMERIC(18,4);
DECLARE VARIABLE REP NUMERIC(18,4);
DECLARE VARIABLE TOTAL_ITEM NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE DESC_PROP NUMERIC(18,4);
begin
     for select fv.codigo, fv.vendedor, fv.fechada, fv.total, coalesce(fvi.quantidade,0),
        (coalesce(fvi.prc_unitario,0) - coalesce(fvi.desconto,0)),
        (coalesce(fvi.quantidade,0) * coalesce(fvi.prc_custo,0)),
        (coalesce(fvi.quantidade,0) * coalesce(fvi.peso,0)),
        coalesce(fv.desc_acres,0)
        from fat_vendas fv
        inner join fat_vendas_itens fvi on (fv.cnpj = fvi.cnpj and fv.codigo = fvi.codigo)
        inner join est_natureza nat on (fv.natureza = nat.codigo and fv.cnpj = nat.cnpj)
        where fv.cnpj = :cnpj  and ((fv.data_caixa between :dini  and :dfim)
        or (fv.data_caixa is null)) and fvi.produto = :produto
        and nat.es = 'S' and nat.computa_venda = 'S' and coalesce(fv.cancelada,'N') = 'N'
        into :codigo, :vendedor, :fechada, :total, :quantidade,
             :unitario,
             :custo,
             :peso,
             :desc_acresc
     do
     begin
        /*até então aqui é desconsiderado o desconto dado na nf. que terá se ser rateado entre os itens*/
        if (:desc_acresc < 0) then
        begin
          desc_acresc = :desc_acresc * -1;

          total_item = (:unitario * :quantidade);

          /*Descobrindo qnto o item representa na NF*/
          rep = (:total_item * 100/:total);

         /*Desconto proporcional*/
         desc_prop = (:rep * :desc_acresc/100);

         /*Apos descoberto o desconto aplicando no item*/
         unitario = (:unitario - (:unitario * :desc_prop/100));
        end
        suspend;
     end
END
^

ALTER PROCEDURE VER_FATURA_PERIODO_SINTETICO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PRODUTO VARCHAR(15))
RETURNS (
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4),
    VENDEDOR INTEGER,
    FECHADA CHAR(1),
    CUSTO NUMERIC(18,4),
    PESO NUMERIC(18,4))
AS
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACRESC NUMERIC(18,4);
DECLARE VARIABLE PORC NUMERIC(18,4);
BEGIN
     FOR SELECT CODIGO, VENDEDOR, FECHADA, TOTAL, DESC_ACRES
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND ( DATA_CAIXA >= :DINI  AND DATA_CAIXA <= :DFIM )
/*     or ( DATA_CAIXA IS NULL ))*/
     INTO :CODIGO, :VENDEDOR, :FECHADA, :TOTAL, :DESC_ACRESC
     DO BEGIN
        PORC        = 0 ;
        UNITARIO    = 0 ;
        QUANTIDADE  = 0 ;
        UNITARIO    = 0 ;
        CUSTO       = 0 ;

        /* ITENS */
        FOR SELECT QUANTIDADE, ( PRC_UNITARIO - DESCONTO ), ( QUANTIDADE * PRC_CUSTO ), quantidade * peso
        FROM FAT_VENDAS_ITENS
        WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO AND PRODUTO = :PRODUTO
        INTO :QUANTIDADE, :UNITARIO, :CUSTO, :peso
        DO BEGIN
           /* PORCENTAGEM DO VALOR UNITARIO EM CIMA DO TOTAL DA VENDA */
           PORC = :UNITARIO / :TOTAL ;

           /* VALOR ATRIBUIDO DO ITEM NO TOTAL DO DESCONTO */
           DESC_ACRESC = ( :DESC_ACRESC * :PORC );

           /* ACUMULANDO O DESC/ACRESC DA VENDA NO ITEM */
           UNITARIO = :UNITARIO + :DESC_ACRESC ;

           IF ( :QUANTIDADE IS NULL )
           THEN BEGIN
                QUANTIDADE = 0 ;
           END

           IF ( :UNITARIO IS NULL )
           THEN BEGIN
                UNITARIO = 0 ;
           END

           IF ( :CUSTO IS NULL )
           THEN BEGIN
                CUSTO = 0 ;
           END
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_FATURA_PESSOA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    BANCO CHAR(3),
    BOLETO VARCHAR(30),
    OBS VARCHAR(30),
    DUPLICATA VARCHAR(30),
    ENVIADA CHAR(1),
    TIPO VARCHAR(11),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15),
    DATA_BAIXA TIMESTAMP,
    USUARIO CHAR(14))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         BANCO, ENVIADA, TIPO, BOLETO, DUPLICATA, OBS,
         AGRUPADORA, DATA_BAIXA, USUARIO, VALOR_ORIGINAL,
         ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND BAIXADA = 'N'
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO,
         :BANCO, :ENVIADA, :TIPO, :BOLETO, :DUPLICATA, :OBS,
         :AGRUPADORA, :DATA_BAIXA, :USUARIO, :VALOR_ORIGINAL,
         :ULTIMA_BX_PARCIAL
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;


        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_PESSOA_BAIXADA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    DATA TIMESTAMP,
    VALOR NUMERIC(18,4),
    VALOR_ORIGINAL NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    VENCIMENTO TIMESTAMP,
    ULTIMA_BX_PARCIAL TIMESTAMP,
    HISTORICO VARCHAR(100),
    NOME VARCHAR(50),
    NOME_FANTASIA VARCHAR(50),
    COMPRADOR VARCHAR(50),
    FONE_COMPRADOR VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    AGRUPADORA INTEGER,
    FONE VARCHAR(20),
    DUPLICATA VARCHAR(30),
    BOLETO VARCHAR(30),
    BANCO CHAR(3),
    TIPO VARCHAR(11),
    ENVIADA CHAR(1),
    OBS VARCHAR(30),
    NOME_BANCO VARCHAR(50),
    CPF_CGC VARCHAR(15))
AS
BEGIN
     FOR SELECT CODIGO, PESSOA_FJ, DATA,
         VALOR, DESCONTO, JUROS, VENCIMENTO, HISTORICO,
         DUPLICATA , BOLETO ,  BANCO, TIPO, ENVIADA, OBS,
         AGRUPADORA, VALOR_ORIGINAL, ULTIMA_BX_PARCIAL
     FROM FIN_FATURAS
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND BAIXADA = 'S'
     INTO
         :CODIGO, :PESSOA_FJ, :DATA,
         :VALOR, :DESCONTO, :JUROS, :VENCIMENTO, :HISTORICO     ,
         :DUPLICATA , :BOLETO ,  :BANCO, :TIPO, :ENVIADA, :OBS,
         :AGRUPADORA, :VALOR_ORIGINAL, :ULTIMA_BX_PARCIAL
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF,
        FANTASIA
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF,
               :NOME_FANTASIA ;

        /* CLIENTES */
        SELECT COMPRADOR, FONE
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :COMPRADOR, :FONE_COMPRADOR ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* BANCOS */
        SELECT NOME FROM FIN_BANCO
        WHERE CODIGO = :BANCO
        INTO :NOME_BANCO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FATURA_RECEBER (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    DATA_ULT_BAIXA TIMESTAMP,
    NUM_CUPOM INTEGER,
    COBRADOR INTEGER,
    CONVENIADO INTEGER,
    NOME_CONVENIADO VARCHAR(50))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA,
            DATA_ULT_BAIXA, COBRADOR
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FAT
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :DATA_ULT_BAIXA, :COBRADOR
     DO BEGIN
        IF ( CODIGO_VN IS NOT NULL )
        THEN BEGIN
             SELECT NUM_CUPOM, CONVENIADO
             FROM FAT_VENDAS
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_VN
             ORDER BY CNPJ, CODIGO
             INTO :NUM_CUPOM, :CONVENIADO ;

             SELECT NOME_RAZAO
             FROM  GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIADO
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO )
             ORDER BY CNPJ, CODIGO
             INTO :NOME_CONVENIADO ;
        END

        IF ( CONVENIADO IS NULL )
        THEN
            CONVENIADO = 0;

        SUSPEND;

        CONVENIADO = NULL ;
        NOME_CONVENIADO = NULL;
     END
END
^

ALTER PROCEDURE VER_FICHA_CLIENTE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    VENDAS NUMERIC(18,4),
    RECEBER NUMERIC(18,4),
    FATURAS NUMERIC(18,4),
    CUPOM NUMERIC(18,4),
    NOTAS NUMERIC(18,4),
    TOTAL NUMERIC(18,4))
AS
DECLARE VARIABLE COD_CLASSIFICACAO INTEGER;
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE NF INTEGER;
DECLARE VARIABLE CF INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
BEGIN
     /* DADOS DAS PESSOAS */
     FOR SELECT CODIGO, NOME_RAZAO, FONE, FANTASIA, CPF_CGC, UF
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ 
     INTO :CODIGO, :NOME_RAZAO, :FONE, :FANTASIA, :CPF_CGC, :UF
     DO BEGIN
        FATURAS = 0;
        RECEBER = 0;
        CUPOM = 0;
        NOTAS = 0;
        VENDAS = 0;

        SELECT PESSOA_FJ, BLOQUEADO, COD_CLASSIF
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO AND BLOQUEADO <> 'S'
        INTO :PESSOA_FJ, :BLOQUEADO, :COD_CLASSIFICACAO ;

        /* CLASSIFICACAO */
        SELECT NOME FROM GLO_CLASSIFICACAO
        WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIFICACAO
        INTO :CLASSIFICACAO ;

        /* CONTAS A RECEBER */
        FOR SELECT (VALOR - VLR_PARCIAL + JUROS_REC - DESCONTOS), CODIGO_VN
        FROM FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO AND
        (( FATURA = 0 )OR ( FATURA IS NULL )) AND
        ( CODIGO_VN > 0 )
        INTO :AUX, VENDA
        DO BEGIN
           IF ( AUX IS NULL )
           THEN
               AUX = 0;

           /* TOTALIZAR AS VENDAS EM ABERTO Q SAO NF */
           SELECT NUM_CUPOM, NUM_NF
           FROM FAT_VENDAS
           WHERE ( CNPJ = :CNPJ ) AND ( CODIGO = :VENDA )
           ORDER BY CNPJ, CODIGO
           INTO :NF, :CF ;

           IF (( CF = 0 ) OR ( CF IS NULL ))
           THEN BEGIN
                IF (( NF = 0 ) OR ( NF IS NULL ))
                THEN BEGIN
                     NOTAS = NOTAS + :AUX ;
                END
                ELSE BEGIN
                     VENDAS = VENDAS + :AUX ;
                END
           END
           ELSE BEGIN
                CUPOM = CUPOM + :AUX ;
           END
        END

        /* CONTAS A RECEBER */
        SELECT SUM(VALOR - VLR_PARCIAL + JUROS_REC - DESCONTOS)
        FROM FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO AND
        (( FATURA = 0 )OR ( FATURA IS NULL )) AND
        (( CODIGO_VN IS NULL )OR ( CODIGO_VN = 0 ))
        INTO :RECEBER ;

        IF ( RECEBER IS NULL )
        THEN
            RECEBER = 0;

        /* FATURA FUTURA */
        SELECT SUM(VALOR - DESCONTO + JUROS )
        FROM FIN_FATURAS
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO AND BAIXADA = 'N'
        INTO :FATURAS ;

        IF ( FATURAS IS NULL )
        THEN
            FATURAS = 0;

        IF ( RECEBER IS NULL )
        THEN
            RECEBER = 0;

        IF ( CUPOM IS NULL )
        THEN
            CUPOM = 0;

        IF ( NOTAS IS NULL )
        THEN
            NOTAS = 0;

        IF ( VENDAS IS NULL )
        THEN
            VENDAS = 0;

        TOTAL = FATURAS + RECEBER + CUPOM + NOTAS + VENDAS ;

        SUSPEND ;

        FATURAS = 0;
        RECEBER = 0;
        CUPOM = 0;
        NOTAS = 0;
        VENDAS = 0;
     END
END
^

ALTER PROCEDURE VER_FIN_CENTRO_CUSTO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME VARCHAR(50),
    CODIGO_AGRUPADO INTEGER,
    NOME_AGRUPADO VARCHAR(50),
    AGRUPADOR INTEGER)
AS
declare variable cont integer;
begin
    /*Percorrendo todos os que forem agrupadores*/
    for select codigo, nome, agrupador from fin_centro_custo
        where cnpj = :cnpj and agrupador is null
        into :codigo, :nome, :agrupador
    do
    begin
      cont = 0;
      codigo_agrupado = 0;
      nome_agrupado = '';
      for select codigo, nome from fin_centro_custo
           where cnpj = :cnpj and agrupador = :codigo
           into :codigo_agrupado, nome_agrupado
      do
      begin
         suspend;
         cont = cont + 1;
      end
      if (cont = 0) then
        suspend;
    end
END
^

ALTER PROCEDURE VER_FIN_CHEQUES (
    CNPJ CHAR(14))
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    PROCESSADO CHAR(1))
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                PROCESSADO, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :PROCESSADO, :AUX
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC, RG_IE
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC, :RG_IE ;

        IF (NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SELECT LOCAL_TRABALHO, FONE_TRABALHO
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :LOCAL_TRABALHO, :FONE_TRABALHO ;

        IF ( CODIGO_MOTIVO_DEVOLUCAO > 0 )
        THEN BEGIN
             SELECT NOME FROM FIN_MOTIVO_DEVOLUCAO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MOTIVO_DEVOLUCAO
             INTO :MOTIVO_DEVOLUCAO ;
        END
        ELSE BEGIN
             MOTIVO_DEVOLUCAO = '';
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_ARQ_MAGNETICO (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    LOCAL_TRABALHO VARCHAR(50),
    FONE_TRABALHO VARCHAR(20),
    PROCESSADO CHAR(1),
    CMC7 VARCHAR(50))
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                PROCESSADO, NOME, CMC7
     FROM FIN_CHEQUES
     WHERE ( CNPJ = :CNPJ ) AND ( DATA_CONCILIACAO = :DATA )
     AND ( PROCESSADO <> 'S' ) AND ( CMC7 IS NOT NULL )
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :PROCESSADO, :AUX, :CMC7
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC, RG_IE
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC, :RG_IE ;

        IF ( NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SELECT LOCAL_TRABALHO, FONE_TRABALHO
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
        ORDER BY CNPJ, PESSOA_FJ
        INTO :LOCAL_TRABALHO, :FONE_TRABALHO ;

        IF ( CODIGO_MOTIVO_DEVOLUCAO > 0 )
        THEN BEGIN
             SELECT NOME FROM FIN_MOTIVO_DEVOLUCAO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MOTIVO_DEVOLUCAO
             INTO :MOTIVO_DEVOLUCAO ;
        END
        ELSE BEGIN
             MOTIVO_DEVOLUCAO = '';
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    TURNO INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ
     AND DATA_CAIXA = :DATA AND USUARIO = :USUARIO AND
     (( ORIGEM <> 'REC' ) OR ( ORIGEM IS NULL )) AND
     TURNO = :TURNO
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :AUX
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF (NOME = 'CONSUMIDOR')
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_CAIXA_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    TURNO INTEGER)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, USUARIO, TURNO, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :USUARIO, :TURNO, :NOME
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF (NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_CAIXA_RECEBER (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ
     AND DATA_CAIXA = :DATA AND USUARIO = :USUARIO AND ORIGEM = 'REC'
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :NOME
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF (NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_COMISSAO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    VENDEDOR INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, NOME
     FROM FIN_CHEQUES
     WHERE ( CNPJ = :CNPJ ) AND ( PRE_DATE >= :INI AND PRE_DATE <= :FIM )
     AND (( ORIGEM <> 'REC' ) OR ( ORIGEM IS NULL )) AND ( VENDA > 0 )
     AND ( EMISSAO <> PRE_DATE )
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :AUX
     DO BEGIN
        SELECT VENDEDOR FROM FAT_VENDAS
        WHERE CNPJ = :CNPJ AND CODIGO = :VENDA
        ORDER BY CNPJ, CODIGO
        INTO :VENDEDOR ;

        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF ( NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_CX_REC_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ
     AND ( DATA_CAIXA >= :INI AND DATA_CAIXA <= :FIM )
     AND ORIGEM = 'REC'
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :AUX
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF (NOME = 'CONSUMIDOR')
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_PERIODO (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_CAIXA TIMESTAMP)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                DATA_CAIXA, NOME
     FROM FIN_CHEQUES
     WHERE ( CNPJ = :CNPJ ) AND ( DATA_CAIXA >= :INI AND DATA_CAIXA <= :FIM )
     AND
     (( ORIGEM <> 'REC' ) OR ( ORIGEM IS NULL ))
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :DATA_CAIXA, :AUX
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF (NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_PESSOA (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE DATE,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_ACERTO TIMESTAMP,
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1))
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO,
                VEZES_DEVOLUCAO, NOME
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :COD
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :AUX
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        IF ( NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        IF ( CODIGO_MOTIVO_DEVOLUCAO > 0 )
        THEN BEGIN
             SELECT NOME FROM FIN_MOTIVO_DEVOLUCAO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MOTIVO_DEVOLUCAO
             INTO :MOTIVO_DEVOLUCAO ;
        END
        ELSE BEGIN
             MOTIVO_DEVOLUCAO = '';
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_PESSOA_ABERTO (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    RG_IE VARCHAR(20),
    PROCESSADO CHAR(1))
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                NOME, PROCESSADO
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :COD AND CONCILIADO = 'N'
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :AUX, :PROCESSADO
     DO BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC, RG_IE
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC, :RG_IE ;

        IF ( NOME = 'CONSUMIDOR')
        THEN
            NOME = :AUX;

        IF ( CODIGO_MOTIVO_DEVOLUCAO > 0 )
        THEN BEGIN
             SELECT NOME FROM FIN_MOTIVO_DEVOLUCAO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MOTIVO_DEVOLUCAO
             INTO :MOTIVO_DEVOLUCAO ;
        END
        ELSE BEGIN
             MOTIVO_DEVOLUCAO = '';
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_CHEQUES_PESSOA_PAGO (
    CNPJ CHAR(14),
    COD INTEGER)
RETURNS (
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6),
    VENDA INTEGER,
    EMISSAO TIMESTAMP,
    PRE_DATE TIMESTAMP,
    VALOR NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    CONCILIADO CHAR(1),
    PESSOA_FJ INTEGER,
    HISTORICO VARCHAR(100),
    AGENCIA VARCHAR(6),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    DATA_CONCILIACAO TIMESTAMP,
    MOEDA1 NUMERIC(18,4),
    MOEDA2 NUMERIC(18,4),
    TIPO CHAR(2),
    DATA_ACERTO TIMESTAMP,
    PLANILHA INTEGER,
    DIGITO_AGENCIA CHAR(1),
    DIGITO_CHEQUE CHAR(1),
    DATA_DEVOLUCAO TIMESTAMP,
    MOTIVO_DEVOLUCAO VARCHAR(50),
    CODIGO_MOTIVO_DEVOLUCAO INTEGER,
    VEZES_DEVOLUCAO INTEGER,
    RG_IE VARCHAR(20),
    PROCESSADO CHAR(1),
    DATA_REAPRES DATE)
AS
DECLARE VARIABLE AUX VARCHAR(50);
BEGIN
     FOR SELECT BANCO, CONTA, CHEQUE, VENDA, EMISSAO, PRE_DATE,
                VALOR, CONCILIADO, PESSOA_FJ, HISTORICO, AGENCIA,
                DATA_CONCILIACAO, JUROS, MOEDA1, MOEDA2, TIPO,
                DATA_ACERTO, PLANILHA, DIGITO_AGENCIA, DIGITO_CHEQUE,
                DATA_DEVOLUCAO, MOTIVO_DEVOLUCAO, VEZES_DEVOLUCAO,
                NOME, PROCESSADO, DATA_REAPRES
     FROM FIN_CHEQUES
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :COD AND (CONCILIADO = 'S' )
     INTO :BANCO, :CONTA, :CHEQUE, :VENDA, :EMISSAO, :PRE_DATE,
          :VALOR, :CONCILIADO, :PESSOA_FJ, :HISTORICO, :AGENCIA,
          :DATA_CONCILIACAO, :JUROS, :MOEDA1, :MOEDA2, :TIPO,
          :DATA_ACERTO, :PLANILHA, :DIGITO_AGENCIA, :DIGITO_CHEQUE,
          :DATA_DEVOLUCAO, :CODIGO_MOTIVO_DEVOLUCAO, :VEZES_DEVOLUCAO,
          :AUX, :PROCESSADO, :DATA_REAPRES
     DO BEGIN

        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC, RG_IE
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC, :RG_IE ;

        IF (NOME = 'CONSUMIDOR' )
        THEN
            NOME = :AUX;

        IF ( CODIGO_MOTIVO_DEVOLUCAO > 0 )
        THEN BEGIN
             SELECT NOME FROM FIN_MOTIVO_DEVOLUCAO
             WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO_MOTIVO_DEVOLUCAO
             INTO :MOTIVO_DEVOLUCAO ;
        END
        ELSE BEGIN
             MOTIVO_DEVOLUCAO = '';
        END

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_COBRANCAS_PERIODO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    DATA_COBRANCA TIMESTAMP,
    MOTIVO INTEGER,
    PESSOA_FJ INTEGER,
    CODIGO INTEGER,
    NOME VARCHAR(50),
    COBRAR_EM TIMESTAMP,
    HISTORICO VARCHAR(100),
    PAGO_EM TIMESTAMP,
    NOME_MOTIVO VARCHAR(50),
    COBRADOR INTEGER,
    NOME_COBRADOR VARCHAR(50),
    DT_VENCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    VALOR NUMERIC(14,4),
    COD_REC INTEGER,
    ANO INTEGER,
    VENDA INTEGER)
AS
DECLARE VARIABLE COD INTEGER;
DECLARE VARIABLE ORIGEM CHAR(3);
BEGIN
      for select data_cobranca, motivo, cobrar_em,
          historico, pago_em, nome_motivo, cobrador, pessoa_fj,
          receber, ano, origem from fin_cobrancas
          where cnpj = :cnpj and data_cobranca >= :dini and data_cobranca <= :dfim
      into :data_cobranca, :motivo, :cobrar_em, :historico, :pago_em, :nome_motivo,
           :cobrador, :pessoa_fj, :cod_rec, :ano, :origem
      do
      begin
         /* pessoas fj*/
         select nome_razao from  glo_pessoas_fj
         where cnpj = :cnpj and codigo = :pessoa_fj
         order by cnpj, codigo
         into :nome;

         codigo = :pessoa_fj ;

         dt_vencto = null ;
         docto     = null ;
         valor     = null ;

         if (origem = 'REC' ) then
         begin
           select max(dt_vencto), docto, sum(coalesce(valor,0) - coalesce(vlr_parcial,0)), codigo_vn
           from fin_contas_receber  where cnpj = :cnpj and codigo = :cod_rec and ano = :ano
           group by docto, codigo_vn
           into :dt_vencto, :docto, :valor, :venda;

           if (dt_vencto is null) then
           begin
             /*essa eu não entendi...*/
             for select dt_vencto, docto, coalesce(valor,0)- coalesce(vlr_parcial,0)
                 from fin_baixas_receber
                 where cnpj = :cnpj and codigo_cr = :cod_rec and ano_cr = :ano
                 order by codigo
                 into :dt_vencto, :docto, :valor
             do
             begin
               /*só tem esse 'for', porque aconteceu de na base da piratini nós pegarmos
               o max de dt. vencto e do saldo agrupando por codigo e ter baixas com código diferentes,
               causando erro de multiselect*/
             end
           end
         end

         select nome from fin_motivo_cobranca
         where cnpj = :cnpj and codigo = :motivo
         into :nome_motivo;

         select nome from fin_cobrador
         where cnpj = :cnpj and codigo = :cobrador
         into :nome_cobrador ;

         suspend;
      end
END
^

ALTER PROCEDURE VER_FIN_FATURAS_PARCIAL (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DATA_CAIXA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    PLANILHA INTEGER,
    VALOR_ANTERIOR NUMERIC(18,4),
    JUROS_RECEBIDOS NUMERIC(18,4),
    VALOR_ATUAL NUMERIC(18,4),
    TURNO INTEGER,
    DESCONTOS_CONCEDIDOS NUMERIC(18,4))
AS
BEGIN
     SEQUENCIA = 0;

     FOR SELECT
         SEQUENCIA, HISTORICO, VALOR,
         DATA_CAIXA, USUARIO, CONTA, PLANILHA,
         VALOR_ANTERIOR, JUROS_RECEBIDOS, VALOR_ATUAL,
         TURNO, DESCONTOS_CONCEDIDOS

     FROM FIN_FATURAS_PARCIAL
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :SEQUENCIA, :HISTORICO,
          :VALOR, :DATA_CAIXA, :USUARIO,
          :CONTA, :PLANILHA,
          :VALOR_ANTERIOR, :JUROS_RECEBIDOS,
          :VALOR_ATUAL, :TURNO, :DESCONTOS_CONCEDIDOS
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_FATURAS_PARCIAL_CAIXA (
    CNPJ CHAR(14),
    DATA DATE,
    USUARIO INTEGER,
    CONTA INTEGER,
    TURNO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    PESSOA_FJ INTEGER,
    VALOR NUMERIC(18,4),
    PLANILHA INTEGER,
    FATURA INTEGER,
    NOME VARCHAR(50),
    ORIGEM CHAR(3),
    JUROS NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4))
AS
BEGIN
     FOR SELECT
         CODIGO, SEQUENCIA, HISTORICO, VALOR, PLANILHA,
         JUROS_RECEBIDOS, DESCONTOS_CONCEDIDOS
     FROM FIN_FATURAS_PARCIAL
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     AND USUARIO = :USUARIO AND CONTA = :CONTA
     AND TURNO = :TURNO AND (( BANCO = 0 ) OR ( BANCO IS NULL ))
     ORDER BY CNPJ, DATA_CAIXA, USUARIO, CONTA
     INTO :FATURA, :SEQUENCIA, :HISTORICO,
          :VALOR, :PLANILHA, :JUROS, :DESCONTOS
     DO BEGIN
        SELECT NOME, ORIGEM, PESSOA_FJ FROM FIN_FATURAS
        WHERE CNPJ = :CNPJ AND CODIGO = :FATURA
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :ORIGEM, :PESSOA_FJ ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_FATURAS_PARCIAL_GERAL (
    CNPJ CHAR(14),
    DATA DATE)
RETURNS (
    SEQUENCIA INTEGER,
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    JUROS NUMERIC(18,4),
    PLANILHA INTEGER,
    FATURA INTEGER,
    NOME VARCHAR(50),
    ORIGEM CHAR(3))
AS
BEGIN
     FOR SELECT
         CODIGO, SEQUENCIA, HISTORICO, VALOR, PLANILHA,
         DESCONTOS_CONCEDIDOS, JUROS_RECEBIDOS
     FROM FIN_FATURAS_PARCIAL
     WHERE CNPJ = :CNPJ AND DATA_CAIXA = :DATA
     ORDER BY CNPJ, DATA_CAIXA, USUARIO, CONTA
     INTO :FATURA, :SEQUENCIA, :HISTORICO,
          :VALOR, :PLANILHA, :DESCONTOS, :JUROS
     DO BEGIN
        SELECT NOME, ORIGEM FROM FIN_FATURAS
        WHERE CNPJ = :CNPJ AND CODIGO = :FATURA
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :ORIGEM ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_FUNCIONARIOS (
    CNPJ CHAR(14))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    DT_ADMISSAO TIMESTAMP,
    CARGO VARCHAR(50),
    CTPS VARCHAR(15),
    SERIE VARCHAR(5),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80)
AS
BEGIN
     FOR SELECT
             PESSOA_FJ,
             DT_ADMISSAO,
             CARGO,
             CTPS,
             SERIE,
             OBS
     FROM FIN_FUNCIONARIOS
     INTO
          :PESSOA_FJ, :DT_ADMISSAO, :CARGO,
          :CTPS, :SERIE, :OBS
     DO BEGIN
        /* PESSOAS FJ */
        SELECT NOME_RAZAO
        FROM  GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :NOME ;
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FIN_MOV_CARTAO_CONCILIACAO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
     FOR SELECT
             CODIGO,
             DATA,
             USUARIO,
             CONTA,
             CPF_CNPJ,
             CLIENTE,
             REEMBOLSO,
             ADMINISTRADORA,
             VALOR,
             NUM_CARTAO,
             NUM_BANCO,
             NUM_CONTA,
             CONCILIADO,
             TIPO_DOC,
             DOCUMENTO,
             VENDA,
             PESSOA_FJ,
             TIPO,
             NUM_PARCELAS,
             TAXA,
             TURNO,
             PROCESSADO
      FROM FIN_MOVIMENTO_CARTAO
      WHERE CNPJ = :CNPJ AND DATA_CONCILIACAO >= :DATAINI AND DATA_CONCILIACAO <= :DATAFIM
      INTO
           :CODIGO,
           :DATA,
           :USUARIO,
           :CONTA,
           :CPF_CNPJ,
           :CLIENTE,
           :REEMBOLSO,
           :ADMINISTRADORA,
           :VALOR,
           :NUM_CARTAO,
           :NUM_BANCO,
           :NUM_CONTA,
           :CONCILIADO,
           :TIPO_DOC,
           :DOCUMENTO,
           :VENDA,
           :PESSOA_FJ,
           :TIPO,
           :NUM_PARCELAS,
           :TAXA,
           :TURNO,
           :PROCESSADO
  DO
  BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        SELECT NOME, TAXA, TAXA_PARCELADO, TAXA_DEBITO FROM FIN_ADMINISTRADORA
        WHERE CNPJ = :CNPJ AND CODIGO = :ADMINISTRADORA
        INTO :NOME_ADMINISTRADORA, :TAXA, :TAXA_PARCELADO, :TAXA_DEBITO ;

        SUSPEND;
  END
END
^

ALTER PROCEDURE VER_FIN_MOVIMENTO_CARTAO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
     FOR SELECT
             CODIGO,
             DATA,
             USUARIO,
             CONTA,
             CPF_CNPJ,
             CLIENTE,
             REEMBOLSO,
             ADMINISTRADORA,
             VALOR,
             NUM_CARTAO,
             NUM_BANCO,
             NUM_CONTA,
             CONCILIADO,
             TIPO_DOC,
             DOCUMENTO,
             VENDA,
             PESSOA_FJ,
             TIPO,
             NUM_PARCELAS,
             TAXA,
             TURNO,
             PROCESSADO
      FROM FIN_MOVIMENTO_CARTAO
      WHERE CNPJ = :CNPJ AND DATA >= :DATAINI AND DATA <= :DATAFIM
      INTO
           :CODIGO,
           :DATA,
           :USUARIO,
           :CONTA,
           :CPF_CNPJ,
           :CLIENTE,
           :REEMBOLSO,
           :ADMINISTRADORA,
           :VALOR,
           :NUM_CARTAO,
           :NUM_BANCO,
           :NUM_CONTA,
           :CONCILIADO,
           :TIPO_DOC,
           :DOCUMENTO,
           :VENDA,
           :PESSOA_FJ,
           :TIPO,
           :NUM_PARCELAS,
           :TAXA,
           :TURNO,
           :PROCESSADO
  DO
  BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        SELECT NOME, TAXA, TAXA_PARCELADO, TAXA_DEBITO FROM FIN_ADMINISTRADORA
        WHERE CNPJ = :CNPJ AND CODIGO = :ADMINISTRADORA
        INTO :NOME_ADMINISTRADORA, :TAXA, :TAXA_PARCELADO, :TAXA_DEBITO ;

        SUSPEND;
  END
END
^

ALTER PROCEDURE VER_FIN_MOVTO_CARTAO_REEMBOLSO (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    USUARIO INTEGER,
    CONTA INTEGER,
    CPF_CNPJ VARCHAR(20),
    CLIENTE VARCHAR(50),
    REEMBOLSO TIMESTAMP,
    ADMINISTRADORA INTEGER,
    NOME_ADMINISTRADORA VARCHAR(50),
    VALOR NUMERIC(18,4),
    NUM_CARTAO VARCHAR(20),
    NUM_BANCO CHAR(3),
    NUM_CONTA VARCHAR(20),
    CONCILIADO CHAR(1),
    TIPO_DOC CHAR(3),
    DOCUMENTO VARCHAR(20),
    VENDA INTEGER,
    PESSOA_FJ INTEGER,
    TIPO CHAR(3),
    NUM_PARCELAS INTEGER,
    TAXA NUMERIC(18,4),
    TAXA_PARCELADO NUMERIC(18,4),
    TAXA_DEBITO NUMERIC(18,4),
    NOME VARCHAR(50),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    CPF_CGC VARCHAR(15),
    TURNO INTEGER,
    PROCESSADO CHAR(1))
AS
BEGIN
     FOR SELECT
             CODIGO,
             DATA,
             USUARIO,
             CONTA,
             CPF_CNPJ,
             CLIENTE,
             REEMBOLSO,
             ADMINISTRADORA,
             VALOR,
             NUM_CARTAO,
             NUM_BANCO,
             NUM_CONTA,
             CONCILIADO,
             TIPO_DOC,
             DOCUMENTO,
             VENDA,
             PESSOA_FJ,
             TIPO,
             NUM_PARCELAS,
             TAXA,
             TURNO,
             PROCESSADO
      FROM FIN_MOVIMENTO_CARTAO
      WHERE CNPJ = :CNPJ AND REEMBOLSO >= :DATAINI AND REEMBOLSO <= :DATAFIM
      INTO
           :CODIGO,
           :DATA,
           :USUARIO,
           :CONTA,
           :CPF_CNPJ,
           :CLIENTE,
           :REEMBOLSO,
           :ADMINISTRADORA,
           :VALOR,
           :NUM_CARTAO,
           :NUM_BANCO,
           :NUM_CONTA,
           :CONCILIADO,
           :TIPO_DOC,
           :DOCUMENTO,
           :VENDA,
           :PESSOA_FJ,
           :TIPO,
           :NUM_PARCELAS,
           :TAXA,
           :TURNO,
           :PROCESSADO
  DO
  BEGIN
        SELECT NOME_RAZAO, FONE, FAX, CELULAR,  CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :NOME, :FONE, :FAX, :CELULAR, :CPF_CGC ;

        SELECT NOME, TAXA_PARCELADO, TAXA_DEBITO
        FROM FIN_ADMINISTRADORA
        WHERE CNPJ = :CNPJ AND CODIGO = :ADMINISTRADORA
        INTO :NOME_ADMINISTRADORA, TAXA_PARCELADO, TAXA_DEBITO  ;

        SUSPEND;
  END
END
^

ALTER PROCEDURE VER_FIN_PAGAS_ANALISE (
    CNPJ VARCHAR(14),
    DATA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    MES INTEGER,
    ANO INTEGER,
    TIPO_CENTRO CHAR(3),
    CENTRO_CUSTO INTEGER,
    NOME VARCHAR(50))
AS
DECLARE VARIABLE MES_FIM INTEGER;
DECLARE VARIABLE CONT INTEGER;
BEGIN
     /* MES INICIAL PARA A ANALISE */
     MES = EXTRACT ( MONTH FROM DATA ) ;
     MES_FIM = MES ;

     /* ANO INICIAL PARA A ANALISE */
     ANO = EXTRACT ( YEAR FROM DATA ) ;

     IF ( MES <= 6 )
     THEN BEGIN
          IF ( MES = 6 )
          THEN BEGIN
               MES_FIM = 12 ;
               ANO = ANO - 1;
          END

          IF ( MES = 5 )
          THEN BEGIN
               MES_FIM = 11 ;
               ANO = ANO - 1;
          END

          IF ( MES = 4 )
          THEN BEGIN
               MES_FIM = 10 ;
               ANO = ANO - 1;
          END

          IF ( MES = 3 )
          THEN BEGIN
               MES_FIM = 09 ;
               ANO = ANO - 1;
          END

          IF ( MES = 2 )
          THEN BEGIN
               MES_FIM = 08 ;
               ANO = ANO - 1;
          END

          IF ( MES = 1 )
          THEN BEGIN
               MES_FIM = 07 ;
               ANO = ANO - 1;
          END
     END
     ELSE BEGIN
          MES = MES - 6 ;
          MES_FIM = MES ;
     END

     CONT = 1;

     WHILE ( CONT <= 6 ) DO
     BEGIN
          MES = MES_FIM;

          FOR SELECT TIPO_CENTRO, NOME, CODIGO
          FROM FIN_CENTRO_CUSTO
          WHERE (( CNPJ = :CNPJ ) AND
          ( EXCLUI_DEMOSTRATIVO_FINANCEIRO = 'N' ) OR ( EXCLUI_DEMOSTRATIVO_FINANCEIRO IS NULL ))
          INTO :TIPO_CENTRO, :NOME, :CENTRO_CUSTO
          DO BEGIN
             SELECT SUM(VLR_BAIXA)
             FROM FIN_BAIXAS_PAGAR
             WHERE CNPJ = :CNPJ
             AND EXTRACT ( MONTH FROM DT_BAIXA ) = :MES_FIM
             AND EXTRACT ( YEAR FROM DT_BAIXA )  = :ANO
             AND CENTRO_CUSTO = :CENTRO_CUSTO
             INTO :SOMA ;

             IF ( SOMA IS NULL )
             THEN
                 SOMA = 0;

             SUSPEND;
          END

          MES_FIM = MES_FIM + 1 ;

          IF ( MES_FIM = 13 )
          THEN BEGIN
               MES_FIM = 1;
               ANO = ANO + 1;
          END

          CONT = CONT + 1;
     END
END
^

ALTER PROCEDURE VER_FIN_PAGAS_ANALISE_MES (
    CNPJ VARCHAR(14),
    DATAINI DATE,
    ULTIMODIA DATE)
RETURNS (
    SOMA NUMERIC(18,4),
    SEMANA INTEGER,
    TIPO_CENTRO CHAR(3),
    CENTRO_CUSTO INTEGER,
    NOME VARCHAR(50))
AS
DECLARE VARIABLE DATAFIM DATE;
BEGIN
     DATAFIM = DATAINI + 6;

     SEMANA = 1;

     WHILE ( SEMANA <= 4 ) DO
     BEGIN
          FOR SELECT TIPO_CENTRO, NOME, CODIGO
          FROM FIN_CENTRO_CUSTO
          WHERE (( CNPJ = :CNPJ ) AND
          ( EXCLUI_DEMOSTRATIVO_FINANCEIRO = 'N' ) OR ( EXCLUI_DEMOSTRATIVO_FINANCEIRO IS NULL ))
          INTO :TIPO_CENTRO, :NOME, :CENTRO_CUSTO
          DO BEGIN
             SELECT SUM(VLR_BAIXA)
             FROM FIN_BAIXAS_PAGAR
             WHERE CNPJ = :CNPJ
             AND DT_BAIXA >= :DATAINI
             AND DT_BAIXA <= :DATAFIM
             AND CENTRO_CUSTO = :CENTRO_CUSTO
             INTO :SOMA ;

             IF ( SOMA IS NULL )
             THEN
                 SOMA = 0;

             SUSPEND;
          END

          DATAINI = DATAFIM + 1 ;

          IF ( SEMANA < 3 )
          THEN BEGIN
               DATAFIM = DATAINI + 6;
          END
          ELSE
               DATAFIM = ULTIMODIA ;

          SEMANA = SEMANA + 1;
     END
END
^

ALTER PROCEDURE VER_FISICA_FINANCEIRA (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    NOME_GRUP0 VARCHAR(50),
    NOME_SUBGRUPO VARCHAR(50),
    QTDADE NUMERIC(18,4),
    T_REPOS NUMERIC(18,4),
    T_CUSTO_MED NUMERIC(18,4),
    T_VENDA NUMERIC(18,4))
AS
BEGIN
     FOR SELECT NOME_GRUPO,
                NOME_SUBGRUPO,
                SUM(QTDADE_2) ,
                SUM((QTDADE_2) * PRC_REPOS) ,
                SUM((QTDADE_2) * PRC_CUSTO_MED) ,
                SUM((QTDADE_2) * PRC_VENDA)
     FROM VER_EST_PRODUTOS ( :CNPJ )
     WHERE CNPJ = :CNPJ AND ATIVO = :ATV
     AND NOME_GRUPO >= :GRUPO_INI AND NOME_GRUPO <= :GRUPO_FIM

     GROUP BY NOME_GRUPO, NOME_SUBGRUPO
     ORDER BY NOME_GRUPO, NOME_SUBGRUPO
     
     INTO :NOME_GRUP0, :NOME_SUBGRUPO, :QTDADE, :T_REPOS, :T_CUSTO_MED, :T_VENDA
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_FORNECEDOR (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    UF CHAR(2))
AS
declare variable COD_CLASSIFICACAO INTEGER;
BEGIN
     /* DADOS DAS PESSOAS */
     FOR SELECT CNPJ, CODIGO, NOME_RAZAO, FONE, FANTASIA, CPF_CGC, UF
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ 
     INTO :EMPRESA, :CODIGO, :NOME_RAZAO, :FONE, :FANTASIA, :CPF_CGC, :UF
     DO BEGIN
        SELECT PESSOA_FJ
        FROM GLO_FORNECEDORES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
        INTO :PESSOA_FJ;

        IF (:PESSOA_FJ IS NOT NULL)
        THEN BEGIN
             SUSPEND;
             PESSOA_FJ = NULL ;
        END
     END
END
^

ALTER PROCEDURE VER_GARANTIAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    ENVIADA_CX CHAR(1),
    CANCELADA CHAR(1))
AS
BEGIN
     FOR SELECT
         PESSOA_FJ, NOME, CODIGO, DATA, TOTAL, DESC_ACRESC,
         FECHADO, VENDEDOR, USUARIO, DATA_CAIXA,
         CONTA_CAIXA,
         NOME_CONSUMIDOR, OBSERVACAO, ENVIADA_CX,
         CANCELADA
     FROM FAT_GARANTIAS
     WHERE CNPJ = :CNPJ AND FECHADO = :TP
     AND ENVIADA_CX = 'S'
     INTO
         :PESSOA_FJ, :NOME, :CODIGO, :DATA, :TOTAL, :DESC_ACRESC,
         :FECHADO, :VENDEDOR, :USUARIO, :DATA_CAIXA, :CONTA_CAIXA,
         :NOME_CONSUMIDOR, :OBSERVACAO, :ENVIADA_CX,
         :CANCELADA
     DO BEGIN
        /* VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDOR AND CNPJ = :CNPJ
        INTO :NOMEVENDEDOR ;

        VLR_TOTAL = :TOTAL + :DESC_ACRESC ;
        
        SUSPEND;
    END
END
^

ALTER PROCEDURE VER_GLO_INDICACOES (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    INDICADO INTEGER,
    PORCENTAGEM NUMERIC(18,4),
    NOME VARCHAR(50),
    INICIO TIMESTAMP)
AS
BEGIN
      FOR SELECT INDICADO,
             PORCENTAGEM,
             NOME,
             INICIO
      FROM GLO_INDICACOES
      WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
      INTO :INDICADO,
           :PORCENTAGEM,
           :NOME,
           :INICIO
      DO
      BEGIN
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_GLO_VEICULOS (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    CODIGO INTEGER,
    TIPO_VEICULO INTEGER,
    NOME_TIPO VARCHAR(50),
    MARCA_VEICULO INTEGER,
    MODELO VARCHAR(50),
    NOME_MARCA VARCHAR(50),
    PLACA CHAR(8),
    KM_ATUAL NUMERIC(18,4),
    ATIVO CHAR(1),
    MOTORISTA VARCHAR(50),
    COD_CLIENTE INTEGER,
    NOME_RAZAO VARCHAR(50),
    CPF_CGC VARCHAR(14))
AS
BEGIN
      FOR SELECT v.CODIGO, TIPO_VEICULO,
             MARCA_VEICULO, MODELO, PLACA, KM_ATUAL,
             v.ATIVO, MOTORISTA, psa.codigo, psa.nome_razao, substring(psa.cpf_cgc from 1 for 14)
      FROM GLO_VEICULOS v
      left join glo_pessoas_fj psa on (psa.cnpj = v.cnpj and v.pessoa_fj = psa.codigo)
      WHERE v.CNPJ = :CNPJ AND ((v.PESSOA_FJ = :PESSOA_FJ) or (:pessoa_fj = 0))
      INTO :CODIGO, :TIPO_VEICULO, :MARCA_VEICULO,
           :MODELO, :PLACA, :KM_ATUAL,
           :ATIVO, :MOTORISTA, :cod_cliente, :nome_razao, :cpf_cgc
      DO BEGIN
         SELECT NOME FROM GLO_TIPO_VEICULOS
         WHERE CNPJ = :CNPJ AND CODIGO = :TIPO_VEICULO
         INTO :NOME_TIPO;
      
         SELECT NOME FROM GLO_MARCA_VEICULOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MARCA_VEICULO
         INTO :NOME_MARCA ;

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_MOVIMENTO_CONTABIL (
    EMPRESA VARCHAR(14))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA TIMESTAMP,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
    FOR SELECT CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO,
            MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA,
            CONTRA_PARTIDA, CNPJ, EXCLUIR, VALOR_INDEXADO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :EMPRESA
     INTO
         :CODIGO, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA,
         :CONTRA_PARTIDA, :CNPJ, :EXCLUIR, :VALOR_INDEXADO
     DO BEGIN
        SELECT CODIGO, NOME FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTA AND CNPJ = :EMPRESA
        INTO :CODIGO_CONTABIL, :CREDITO ;
        
        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTRA_PARTIDA AND CNPJ = :EMPRESA
        INTO :DEBITO ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_MOVIMENTO_CONTABIL_CREDITO (
    EMPRESA VARCHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(15),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
    FOR SELECT CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO,
            MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA,
            CONTRA_PARTIDA, CNPJ, EXCLUIR, VALOR_INDEXADO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :EMPRESA AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND TIPO ='C'
     ORDER BY CNPJ, DATA, TIPO
     INTO
         :CODIGO, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA,
         :CONTRA_PARTIDA, :CNPJ, :EXCLUIR, :VALOR_INDEXADO
     DO BEGIN
        SELECT CODIGO, NOME, CONTAPAI FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTA AND CNPJ = :EMPRESA
        ORDER BY CNPJ, CONTA
        INTO :CODIGO_CONTABIL, :CREDITO, :CONTA_PAI ;

        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CODIGO = :CONTA_PAI AND CNPJ = :EMPRESA
        INTO :NOME_CONTA_PAI ;

        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTRA_PARTIDA AND CNPJ = :EMPRESA
        ORDER BY CNPJ, CONTA
        INTO :DEBITO ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_MOVIMENTO_CONTABIL_DEBITO (
    EMPRESA VARCHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(15),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
BEGIN
    FOR SELECT CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO,
            MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA,
            CONTRA_PARTIDA, CNPJ, EXCLUIR, VALOR_INDEXADO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :EMPRESA AND DATA >= :DATAINI AND DATA <= :DATAFIM
     AND TIPO ='D'
     ORDER BY CNPJ, DATA, TIPO
     INTO
         :CODIGO, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA,
         :CONTRA_PARTIDA, :CNPJ, :EXCLUIR, :VALOR_INDEXADO
     DO BEGIN
        SELECT CODIGO, NOME, CONTAPAI FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTA AND CNPJ = :EMPRESA
        ORDER BY CNPJ, CONTA
        INTO :CODIGO_CONTABIL, :CREDITO, :CONTA_PAI ;

        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CODIGO = :CONTA_PAI AND CNPJ = :EMPRESA
        INTO :NOME_CONTA_PAI ;

        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CONTA = :CONTRA_PARTIDA AND CNPJ = :EMPRESA
        ORDER BY CNPJ, CONTA
        INTO :DEBITO ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_NFCF_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER,
    SERIE CHAR(3))
RETURNS (
    NF INTEGER,
    CF INTEGER)
AS
begin
     if (serie = '') then
     begin
       select num_nf, num_cupom from fat_vendas
       where cnpj = :cnpj and codigo = :codigo and serie = :serie
       into :nf, :cf ;
     end
     else
     begin
       select num_nf, num_cupom from fat_vendas
       where cnpj = :cnpj and codigo = :codigo
       into :nf, :cf ; 
     end

     suspend;
END
^

ALTER PROCEDURE VER_OFC_CTRL_QUALIDADE (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    VIRABREQUIM VARCHAR(15),
    MEDIDA_MANCAL VARCHAR(15),
    MEDIDA_BIELA VARCHAR(15),
    FOLGA_AXIAL_VIRABREQUIM VARCHAR(15),
    CABECOTE VARCHAR(15),
    ALTURA_CABECOTE VARCHAR(15),
    ALTURA_VALV_ADMISSAO VARCHAR(15),
    ALTURA_VALV_ESCAPE VARCHAR(15),
    BLOCO VARCHAR(15),
    FOLGA_CILINDRO VARCHAR(15),
    FOLGA_RADIAL_BLOCO VARCHAR(15),
    BIELA VARCHAR(15),
    FOLGA_RADIAL_BIELA VARCHAR(15),
    FOLGA_PINO VARCHAR(15),
    FOLGA_AXIAL_BIELA VARCHAR(15),
    AJUSTADO VARCHAR(15),
    TORQUE_MANCAL VARCHAR(15),
    TORQUE_BIELA VARCHAR(15),
    ALTURA_PISTAO VARCHAR(15),
    MONTADOR INTEGER,
    NOME_MONTADOR VARCHAR(50),
    PESSOA_FJ INTEGER,
    NOME_CLIENTE VARCHAR(50),
    DATA TIMESTAMP,
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4))
AS
BEGIN
      FOR SELECT CODIGO, VIRABREQUIM, MEDIDA_MANCAL, MEDIDA_BIELA,
                FOLGA_AXIAL_VIRABREQUIM, CABECOTE, ALTURA_CABECOTE,
                ALTURA_VALV_ADMISSAO, ALTURA_VALV_ESCAPE, BLOCO, FOLGA_CILINDRO,
                FOLGA_RADIAL_BLOCO, BIELA, FOLGA_RADIAL_BIELA, FOLGA_PINO,
                FOLGA_AXIAL_BIELA, AJUSTADO, TORQUE_MANCAL, TORQUE_BIELA,
                ALTURA_PISTAO, MONTADOR, NOME_MONTADOR
      FROM OFC_CTRL_QUALIDADE
      WHERE CNPJ = :CNPJ
      INTO
           :CODIGO, :VIRABREQUIM, :MEDIDA_MANCAL, :MEDIDA_BIELA, :FOLGA_AXIAL_VIRABREQUIM,
           :CABECOTE, :ALTURA_CABECOTE, :ALTURA_VALV_ADMISSAO, :ALTURA_VALV_ESCAPE,
           :BLOCO, :FOLGA_CILINDRO, :FOLGA_RADIAL_BLOCO, :BIELA, :FOLGA_RADIAL_BIELA,
           :FOLGA_PINO, :FOLGA_AXIAL_BIELA, :AJUSTADO, :TORQUE_MANCAL, :TORQUE_BIELA,
           :ALTURA_PISTAO, :MONTADOR, :NOME_MONTADOR
      DO BEGIN
         /* CLIENTE */
         SELECT PESSOA_FJ, DATA, NF, ALIQUOTA_ISS FROM OFC_ORDEM_SERVICO
         WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
         INTO :PESSOA_FJ, :DATA, :NF, :ALIQUOTA_ISS ;

         /* PESSOAS FJ */
         SELECT NOME_RAZAO
         FROM  GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
         ORDER BY CNPJ, CODIGO
         INTO  :NOME_CLIENTE;

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_OFC_ORD_SERV_MOVTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    SEQUENCIA INTEGER,
    VALOR NUMERIC(18,4),
    DATA TIMESTAMP,
    HISTORICO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    TIPO CHAR(1),
    TIPO_DESPESA CHAR(3))
AS
BEGIN
     FOR SELECT
         SEQUENCIA, VALOR, HISTORICO, TIPO, DATA, TIPO_DESPESA
     FROM OFC_ORDEM_SERVICO_MOVIMENTO
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO :SEQUENCIA, :VALOR, :HISTORICO, :TIPO, :DATA, :TIPO_DESPESA
     DO BEGIN
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_ORDEM_SERVICO (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_FECHAMENTO TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    COD_STATUS INTEGER,
    COR_STATUS INTEGER)
AS
begin
     FOR SELECT
         CODIGO, DATA, PESSOA_FJ, NOME,
         NATUREZA, MECANICO, VIAJANTE, ENTRADA,
         HISTORICO, CHASSI, TOTAL, DESC_ACRESC,
         CLIENTE, FECHADO, NOME_NATUREZA,
         NOME_MECANICO, NOME_VIAJANTE, NOME_MOTOR,
         NF, ALIQUOTA_ISS, MOTOR, ENVIADA_CAIXA,
         DATA_FECHAMENTO, COD_STATUS
     FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ
     INTO
         :CODIGO, :DATA, :PESSOA_FJ, :NOME,
         :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
         :HISTORICO, :CHASSI, :TOTAL, :DESC_ACRESC,
         :CLIENTE, :FECHADO, :NOME_NATUREZA,
         :NOME_MECANICO, :NOME_VIAJANTE, :NOME_MOTOR,
         :NF, :ALIQUOTA_ISS, :MOTOR, :ENVIADA_CX, :DATA_FECHAMENTO, COD_STATUS
     DO BEGIN

     select ST.cor from ofc_status st
     where CNPJ = :CNPJ AND st.codigo = :cod_status
     INTO :COR_STATUS;

     suspend;
     END
END
^

ALTER PROCEDURE VER_ORDEM_SERVICO_ORC (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MOTOR INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    ENVIADA_CAIXA CHAR(1))
AS
begin
     FOR SELECT
         CODIGO, DATA, PESSOA_FJ, NOME,
         NATUREZA, MECANICO, VIAJANTE, ENTRADA,
         HISTORICO, CHASSI, TOTAL, DESC_ACRESC,
         CLIENTE, FECHADO, NOME_NATUREZA,
         NOME_MECANICO, NOME_VIAJANTE, NOME_MOTOR,
         ENVIADA_CAIXA, MOTOR
     FROM OFC_ORDEM_SERVICO_ORC
     WHERE CNPJ = :CNPJ
     INTO
         :CODIGO, :DATA, :PESSOA_FJ, :NOME,
         :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
         :HISTORICO, :CHASSI, :TOTAL, :DESC_ACRESC,
         :CLIENTE, :FECHADO, :NOME_NATUREZA,
         :NOME_MECANICO, :NOME_VIAJANTE, :NOME_MOTOR,
         :ENVIADA_CAIXA, :MOTOR
     DO BEGIN

         suspend;
     END
END
^

ALTER PROCEDURE VER_ORDEM_SERVICO_PERIODO (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DATA_FECHAMENTO TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4))
AS
begin
     FOR SELECT
         CODIGO, DATA, PESSOA_FJ, NOME,
         NATUREZA, MECANICO, VIAJANTE, ENTRADA,
         HISTORICO, CHASSI, TOTAL, DESC_ACRESC,
         CLIENTE, FECHADO, NOME_NATUREZA,
         NOME_MECANICO, NOME_VIAJANTE, NOME_MOTOR,
         NF, ALIQUOTA_ISS, MOTOR, ENVIADA_CAIXA,
         DATA_FECHAMENTO
     FROM OFC_ORDEM_SERVICO
     WHERE CNPJ = :CNPJ AND DATA_FECHAMENTO >= :DINI AND
     DATA_FECHAMENTO <= :DFIM
     INTO
         :CODIGO, :DATA, :PESSOA_FJ, :NOME,
         :NATUREZA, :MECANICO, :VIAJANTE, :ENTRADA,
         :HISTORICO, :CHASSI, :TOTAL, :DESC_ACRESC,
         :CLIENTE, :FECHADO, :NOME_NATUREZA,
         :NOME_MECANICO, :NOME_VIAJANTE, :NOME_MOTOR,
         :NF, :ALIQUOTA_ISS, :MOTOR, :ENVIADA_CX,
         :DATA_FECHAMENTO
     DO BEGIN
         suspend;
     END
END
^

ALTER PROCEDURE VER_PAGAR (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER,
    DT_ULTIMA_BAIXA DATE,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO,
            ORIGEM, CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO, SELECIONADO,
            CENTRO_CUSTO, DUPLICATA, CONFERIDA,dt_ultima_baixa,
            p.COD_INDEXADOR,
            p.IDX_DATABASE ,
            p.IDX_COTACAO,
            p.IDX_QTDE
     FROM FIN_CONTAS_PAGAR P
     WHERE CNPJ = :CNPJ
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO,
            :SELECIONADO, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA, :DT_ULTIMA_BAIXA,
            :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_PAGAR_3MESES (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO, ORIGEM, CODIGO_ENT, ANO_ENT, AVISO,
            DT_AVISO, SELECIONADO, CENTRO_CUSTO, DUPLICATA, CONFERIDA
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO < :DATA
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO, :SELECIONADO, :CENTRO_CUSTO,
            :DUPLICATA, CONFERIDA
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_PAGAR_LANCAMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_ULTIMA_BAIXA DATE,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO,
            ORIGEM, CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO, SELECIONADO, CENTRO_CUSTO,
            DUPLICATA, CONFERIDA, DT_ULTIMA_BAIXA
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ
     AND CAST(DT_LANCTO AS DATE) >= :DINI
     AND CAST(DT_LANCTO AS DATE) <= :DFIM
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO, :SELECIONADO,
            :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA, :DT_ULTIMA_BAIXA
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_PAGAR_PREVISAO (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER)
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO, ORIGEM, CODIGO_ENT,
            ANO_ENT, AVISO, DT_AVISO, SELECIONADO, CENTRO_CUSTO, DUPLICATA, CONFERIDA
     FROM FIN_CONTAS_PAGAR
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DATA
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO, :SELECIONADO,
            :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;

        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_PAGAR_VENCIMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_PAG NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_ENT INTEGER,
    ANO_ENT SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    CENTRO_CUSTO INTEGER,
    NOME_CENTRO VARCHAR(50),
    DUPLICATA VARCHAR(15),
    CONFERIDA CHAR(1),
    AGRUPADOR INTEGER,
    DT_ULTIMA_BAIXA DATE,
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_PAG, DESCONTOS, BOLETO,
            ORIGEM, CODIGO_ENT, ANO_ENT, AVISO, DT_AVISO, SELECIONADO,
            CENTRO_CUSTO, DUPLICATA, CONFERIDA,dt_ultima_baixa,
            p.COD_INDEXADOR,
            p.IDX_DATABASE ,
            p.IDX_COTACAO,
            p.IDX_QTDE
     FROM FIN_CONTAS_PAGAR P
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI AND DT_VENCTO <= :DFIM
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_PAG, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_ENT, :ANO_ENT, :AVISO, :DT_AVISO,
            :SELECIONADO, :CENTRO_CUSTO, :DUPLICATA, :CONFERIDA, :DT_ULTIMA_BAIXA,
            :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        /* CENTRO DE CUSTO */
        SELECT NOME, AGRUPADOR FROM FIN_CENTRO_CUSTO
        WHERE CODIGO = :CENTRO_CUSTO AND CNPJ = :CNPJ
        INTO :NOME_CENTRO, :AGRUPADOR ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_PENDENCIAS (
    CNPJ CHAR(14),
    DINI DATE,
    DFIM DATE)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
     for select cnpj, codigo, ano, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn,
            ano_vn, aviso, dt_aviso, selecionado, tipo_docto, numboleto,
            numduplicata, fatura, parcial, juros_parcial, data_ult_baixa, cobrador,
            coalesce(rec.arquivo_morto,'N')
     from fin_contas_receber rec
     where cnpj = :cnpj and dt_vencto >= :dini and dt_vencto <= :dfim
     into
        :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
        :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
        :valor, :vlr_parcial, :juros_rec, :descontos, :boleto,
        :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
        :tipo_docto, :numboleto, :numduplicata, :fatura, :parcial, :juros_parcial,
        :data_ult_baixa, :cobrador, :arq_morto
     do begin
        if (:fatura is null) then
          fatura = 0;

        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from  glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
        order by cnpj, codigo
        into
            :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
            :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        suspend;
     end

     /*Notas não faturadas (Quando uma Venda FFT é faturada o campo duplicata é preenchido
     e ela não é mais encontrada aqui em fat-vendas-fft e vai pra receber) */
     for select codigo, data_caixa, (data_caixa + 30), data_caixa, historico, pessoa_fj,
         (total + desc_acres) as valor_liquid, duplicata
     from fat_vendas
     where fechada = 'S' and data_caixa >= :dini and data_caixa <= :dfim and cnpj = :cnpj
     and cancelada <> 'S' and tipo_venda = 'FFT' and (( duplicata is null ) or ( duplicata = 0 ))
     into  :codigo, :dt_emissao, :dt_vencto, :dt_lancto ,:historico,:pessoa_fj, :valor, :numduplicata
     do begin
        fatura       = :numduplicata ;

        docto = cast(codigo as varchar(20));
        parcela = '1/1' ;

        vlr_parcial = 0       ;
        juros_rec   = 0       ;
        descontos   = 0       ;
        BOLETO      = 'N'     ;
        ORIGEM      = 'VND'   ;
        codigo_vn   = :codigo ;
        ano_vn      = 0       ;

        select nome_razao
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        plan (glo_pessoas_fj order glo_pessoas_fj_codigo)
        order by cnpj, codigo
        into :nome;

        suspend;
    end /* faturas */


     /* Faturadas Lancadas Manualmente - Embora as as FFT faturadas caiam neste tabela,
     elas nãos serão retornadas na select pois não são 'MAN' */
     for select codigo, pessoa_fj, data, valor, vencimento, historico
     from fin_faturas
     where cnpj = :cnpj and origem = 'MAN' and baixada = 'N'
     into  :codigo, :pessoa_fj, :dt_emissao, :valor, :dt_vencto, :historico
     do begin
        fatura       = :codigo ;

        docto = cast(codigo as varchar(20));
        parcela = '1/1' ;

        dt_lancto   = :dt_emissao ;
        vlr_parcial = 0       ;
        juros_rec   = 0       ;
        descontos   = 0       ;
        boleto      = 'N'     ;
        origem      = 'FAT'   ;
        codigo_vn   = 0 ;
        ano_vn      = 0       ;

        select nome_razao
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome;

        suspend;
    end /* faturas */
END
^

ALTER PROCEDURE VER_PESSOA (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    ORDEM INTEGER,
    FONE_CLIENTE VARCHAR(20),
    FONE_TRABALHO VARCHAR(20))
AS
DECLARE VARIABLE END_COBRANCA INTEGER;
BEGIN
  FOR
  SELECT p.CODIGO, p.NOME_RAZAO, p.FANTASIA, p.ATIVIDADE, p.ENDERECO, p.NUMERO, p.COMPLEMENTO, p.BAIRRO,
    p.CIDADE, p.UF, p.CEP, p.FONE,FAX, p.CELULAR, p.PESSOA, p.CPF_CGC, p.RG_IE, p.CONTATO, p.DT_NASCIMENTO,
    p.DT_CADASTRO, p.EMAIL, p.OBS, p.INSC_MUNIC, p.ORDEM, c.fone, c.fone_trabalho
  FROM GLO_PESSOAS_FJ p
  left join glo_clientes c on (c.pessoa_fj = p.codigo and c.cnpj = :cnpj)
  WHERE p.CNPJ = :CNPJ AND p.CODIGO = :COD
  INTO :CODIGO, :NOME_RAZAO, :FANTASIA, :COD_ATIVIDADE, :COD_ENDERECO, :NUMERO, :COMPLEMENTO, :COD_BAIRRO,
    :COD_CIDADE, :UF, :CEP, :FONE, :FAX, :CELULAR, :PESSOA, :CPF_CGC, :RG_IE, :CONTATO, :DT_NASCIMENTO,
    :DT_CADASTRO, :EMAIL, :OBS, :INSC_MUNIC, :ORDEM, :fone_cliente, :fone_trabalho
  DO
      BEGIN
           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

            select max(e.codigo) from glo_cliente_endereco e
            where e.cnpj = :cnpj and e.id_cliente = :codigo
            and e.endereco_padrao = 'S'
            into :end_cobranca;
            
            if (coalesce(:end_cobranca,0) > 0) then
            begin
                select lgd.codigo,
                 lgd.nome,
                 e.cep,
                 cdd.codigo,
                 cdd.nome,
                 br.codigo,
                 br.nome,
                 e.uf_sigla,
                 e.numero_end
                  from glo_cliente_endereco e
                left join glo_bairros br on (br.cnpj = e.cnpj and br.codigo = e.id_bairro)
                left join glo_logradouros lgd on (lgd.cnpj = e.cnpj and lgd.codigo = e.id_logradouro)
                left join glo_cidades cdd on (cdd.cnpj = e.cnpj and cdd.codigo = e.id_cidade)
                where e.cnpj = :cnpj and e.id_cliente = :codigo and e.codigo = :end_cobranca
                into  :cod_endereco,
                      :endereco,
                      :cep,
                      :cod_cidade,
                      :cidade,
                      :cod_bairro,
                      :bairro,
                      :uf,
                      :numero;
            end
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PESSOA_CODIGO (
    CNPJ VARCHAR(14),
    COD INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
  FOR SELECT
             CODIGO,
             NOME_RAZAO,
             FANTASIA,
             ATIVIDADE,
             ENDERECO,
             NUMERO,
             COMPLEMENTO,
             BAIRRO,
             CIDADE,
             UF,
             CEP,
             FONE,
             FAX,
             CELULAR,
             PESSOA,
             CPF_CGC,
             RG_IE,
             CONTATO,
             DT_NASCIMENTO,
             DT_CADASTRO,
             EMAIL,
             OBS,
             INSC_MUNIC,
             ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ AND CODIGO = :COD
      INTO
           :CODIGO,
           :NOME_RAZAO,
           :FANTASIA,
           :COD_ATIVIDADE,
           :COD_ENDERECO,
           :NUMERO,
           :COMPLEMENTO,
           :COD_BAIRRO,
           :COD_CIDADE,
           :UF,
           :CEP,
           :FONE,
           :FAX,
           :CELULAR,
           :PESSOA,
           :CPF_CGC,
           :RG_IE,
           :CONTATO,
           :DT_NASCIMENTO,
           :DT_CADASTRO,
           :EMAIL,
           :OBS,
           :INSC_MUNIC,
           :ORDEM
      DO
      BEGIN
           /* DADOS DO CLIENTE */
           SELECT BLOQUEADO, ASSINA_NOTA, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           INTO :BLOQUEADO, :ASSINA_NOTA, :FREQUENCIA;
      
           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PESSOA_CONTA (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    AGENCIA VARCHAR(15),
    CONTA VARCHAR(15))
RETURNS (
    PESSOA_FJ INTEGER)
AS
DECLARE VARIABLE CONT INTEGER;
BEGIN
      CONT = 0;

      FOR SELECT PESSOA_FJ
      FROM GLO_CONTAS_PESSOAS
      WHERE CNPJ = :CNPJ
      AND BANCO = :BANCO
      AND CONTA = :CONTA
      AND AGENCIA = :AGENCIA
      AND :CONT = 0
      INTO 
          :PESSOA_FJ
      DO
      BEGIN
           CONT = CONT + 1;
           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PESSOA_CPFCGC (
    CNPJ VARCHAR(14),
    CPFCGC VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
BEGIN
     FOR SELECT
         CODIGO, NOME_RAZAO, FANTASIA,
         ATIVIDADE, ENDERECO, NUMERO,
         COMPLEMENTO, BAIRRO, CIDADE,
         UF, CEP, FONE, FAX, CELULAR,
         PESSOA, CPF_CGC, RG_IE, CONTATO,
         DT_NASCIMENTO, DT_CADASTRO, EMAIL,
         OBS, INSC_MUNIC, ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ AND CPF_CGC = :CPFCGC
      INTO
           :CODIGO,
           :NOME_RAZAO,
           :FANTASIA,
           :COD_ATIVIDADE,
           :COD_ENDERECO,
           :NUMERO,
           :COMPLEMENTO,
           :COD_BAIRRO,
           :COD_CIDADE,
           :UF,
           :CEP,
           :FONE,
           :FAX,
           :CELULAR,
           :PESSOA,
           :CPF_CGC,
           :RG_IE,
           :CONTATO,
           :DT_NASCIMENTO,
           :DT_CADASTRO,
           :EMAIL,
           :OBS,
           :INSC_MUNIC,
           :ORDEM
      DO
      BEGIN
           /* DADOS DO CLIENTE */
           SELECT BLOQUEADO, ASSINA_NOTA, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           INTO :BLOQUEADO, :ASSINA_NOTA, :FREQUENCIA;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;
           
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PESSOA_CPFCGC_CHEQUE (
    CNPJ VARCHAR(14),
    CPFCGC VARCHAR(15))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
DECLARE VARIABLE CHEQUE CHAR(1);
BEGIN
     FOR SELECT
         CODIGO, NOME_RAZAO, FANTASIA,
         ATIVIDADE, ENDERECO, NUMERO,
         COMPLEMENTO, BAIRRO, CIDADE,
         UF, CEP, FONE, FAX, CELULAR,
         PESSOA, CPF_CGC, RG_IE, CONTATO,
         DT_NASCIMENTO, DT_CADASTRO, EMAIL,
         OBS, INSC_MUNIC, ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ AND CPF_CGC = :CPFCGC
      INTO
           :CODIGO,
           :NOME_RAZAO,
           :FANTASIA,
           :COD_ATIVIDADE,
           :COD_ENDERECO,
           :NUMERO,
           :COMPLEMENTO,
           :COD_BAIRRO,
           :COD_CIDADE,
           :UF,
           :CEP,
           :FONE,
           :FAX,
           :CELULAR,
           :PESSOA,
           :CPF_CGC,
           :RG_IE,
           :CONTATO,
           :DT_NASCIMENTO,
           :DT_CADASTRO,
           :EMAIL,
           :OBS,
           :INSC_MUNIC,
           :ORDEM
      DO
      BEGIN
           /* DADOS DO CLIENTE */
           SELECT BLOQUEADO, ASSINA_NOTA, CHEQUE,
           FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           INTO :BLOQUEADO, :ASSINA_NOTA, :CHEQUE, :FREQUENCIA;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;
           
           IF ( CHEQUE = 'S' )
           THEN BEGIN
                SUSPEND;
           END
      END
END
^

ALTER PROCEDURE VER_PESSOA_FJ (
    CNPJ VARCHAR(14))
RETURNS (
    EMPRESA CHAR(14),
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    NOME_RAZAO VARCHAR(50),
    FONE VARCHAR(20),
    FANTASIA VARCHAR(50),
    CPF_CGC VARCHAR(15),
    BLOQUEADO CHAR(1),
    CLASSIFICACAO VARCHAR(50),
    UF CHAR(2),
    ORDEM INTEGER,
    ENDERECO VARCHAR(65),
    EMAIL VARCHAR(80))
AS
DECLARE VARIABLE COD_CLASSIFICACAO INTEGER;
DECLARE VARIABLE COD_ENDERECO INTEGER;
DECLARE VARIABLE NUMERO VARCHAR(15);
BEGIN
     /* DADOS DAS PESSOAS */
     FOR SELECT CNPJ, CODIGO, NOME_RAZAO, FONE, FANTASIA, CPF_CGC, UF,
     ORDEM, ENDERECO, NUMERO, EMAIL
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ 
     INTO :EMPRESA, :CODIGO, :NOME_RAZAO, :FONE, :FANTASIA, :CPF_CGC, :UF,
     :ORDEM, :cod_endereco, :NUMERO, :EMAIL
     DO BEGIN
        CLASSIFICACAO       = NULL;
        BLOQUEADO           = NULL;
        COD_CLASSIFICACAO   = NULL;
        ENDERECO            = NULL;

        SELECT BLOQUEADO, COD_CLASSIF
        FROM GLO_CLIENTES
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
        PLAN (GLO_CLIENTES INDEX (GLO_CLIENTES_PESSOA))
        ORDER BY CNPJ, PESSOA_FJ
        INTO :BLOQUEADO, :COD_CLASSIFICACAO ;
        
        PESSOA_FJ = :CODIGO ;

        /* CLASSIFICACAO */
        SELECT NOME FROM GLO_CLASSIFICACAO
        WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIFICACAO
        INTO :CLASSIFICACAO ;

        /* ENDERECO */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
        INTO :ENDERECO ;

        ENDERECO = substring(:ENDERECO || ',N ' || :NUMERO from  1 for 65);
        
        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_PESSOA_NOME (
    CNPJ VARCHAR(14),
    NOME VARCHAR(40))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    ATIVIDADE VARCHAR(50),
    COD_ENDERECO INTEGER,
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    INSC_MUNIC VARCHAR(15),
    BLOQUEADO CHAR(1),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
DECLARE VARIABLE PESSOA_FJ INTEGER;
BEGIN
     IF ( NOME = '.' ) /* LOCALIZAR TODOS OS CLIENTES POR ORDEM DE NOME */
     THEN BEGIN
          FOR SELECT
             CODIGO, NOME_RAZAO, FANTASIA, ATIVIDADE, ENDERECO, NUMERO, COMPLEMENTO, BAIRRO,
             CIDADE, UF, CEP, FONE, FAX, CELULAR, PESSOA, CPF_CGC, RG_IE, CONTATO,
             DT_NASCIMENTO, DT_CADASTRO, EMAIL, OBS, INSC_MUNIC,
             ORDEM
          FROM GLO_PESSOAS_FJ
          WHERE CNPJ = :CNPJ
          INTO
              :CODIGO, :NOME_RAZAO, :FANTASIA, :COD_ATIVIDADE, :COD_ENDERECO, :NUMERO, :COMPLEMENTO,
              :COD_BAIRRO, :COD_CIDADE, :UF, :CEP, :FONE, :FAX, :CELULAR, :PESSOA, :CPF_CGC, :RG_IE,
              :CONTATO, :DT_NASCIMENTO, :DT_CADASTRO, :EMAIL, :OBS, :INSC_MUNIC, :ORDEM
          DO
          BEGIN
           PESSOA_FJ = NULL;

           /* DADOS DO CLIENTE */
           SELECT BLOQUEADO, ASSINA_NOTA, PESSOA_FJ, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           PLAN (GLO_CLIENTES INDEX (GLO_CLIENTES_PESSOA))
           ORDER BY CNPJ, PESSOA_FJ
           INTO :BLOQUEADO, :ASSINA_NOTA, :PESSOA_FJ, :FREQUENCIA ;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           IF ( NOT PESSOA_FJ IS NULL )
           THEN
               SUSPEND;
          END
     END
     ELSE BEGIN
          FOR SELECT
             CODIGO, NOME_RAZAO, FANTASIA, ATIVIDADE, ENDERECO, NUMERO, COMPLEMENTO, BAIRRO,
             CIDADE, UF, CEP, FONE, FAX, CELULAR, PESSOA, CPF_CGC, RG_IE, CONTATO,
             DT_NASCIMENTO, DT_CADASTRO, EMAIL, OBS, INSC_MUNIC,
             ORDEM
          FROM GLO_PESSOAS_FJ
          WHERE CNPJ = :CNPJ AND NOME_RAZAO LIKE (:NOME || '%')
          INTO
              :CODIGO, :NOME_RAZAO, :FANTASIA, :COD_ATIVIDADE, :COD_ENDERECO, :NUMERO, :COMPLEMENTO,
              :COD_BAIRRO, :COD_CIDADE, :UF, :CEP, :FONE, :FAX, :CELULAR, :PESSOA, :CPF_CGC, :RG_IE,
              :CONTATO, :DT_NASCIMENTO, :DT_CADASTRO, :EMAIL, :OBS, :INSC_MUNIC, :ORDEM
          DO
          BEGIN
           PESSOA_FJ = NULL;

           /* DADOS DO CLIENTE */
           SELECT BLOQUEADO, ASSINA_NOTA, PESSOA_FJ, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           PLAN (GLO_CLIENTES INDEX (GLO_CLIENTES_PESSOA))
           ORDER BY CNPJ, PESSOA_FJ
           INTO :BLOQUEADO, :ASSINA_NOTA, :PESSOA_FJ, :FREQUENCIA ;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;
           
           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           IF ( NOT PESSOA_FJ IS NULL )
           THEN
               SUSPEND;
          END
     END
END
^

ALTER PROCEDURE VER_PESSOAS (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO TIMESTAMP,
    DT_CADASTRO TIMESTAMP,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3),
    CPF VARCHAR(15))
AS
DECLARE VARIABLE FORMA INTEGER;
DECLARE VARIABLE END_COBRANCA INTEGER;
BEGIN
      FOR SELECT
      CODIGO, NOME_RAZAO, FANTASIA, ATIVIDADE, ENDERECO, NUMERO, COMPLEMENTO,
      BAIRRO, CIDADE, UF, CEP, FONE, FAX, CELULAR, PESSOA, CPF_CGC, substring(RG_IE from 1 for 15),
      CONTATO, DT_NASCIMENTO,  DT_CADASTRO, EMAIL, OBS, INSC_MUNIC, ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ
      INTO
      :CODIGO, :NOME_RAZAO, :FANTASIA, :COD_ATIVIDADE, :COD_ENDERECO, :NUMERO,
      :COMPLEMENTO, :COD_BAIRRO, :COD_CIDADE, :UF, :CEP, :FONE, :FAX, :CELULAR,
      :PESSOA, :CPF_CGC, :RG_IE, :CONTATO, :DT_NASCIMENTO, :DT_CADASTRO, :EMAIL,
      :OBS, :INSC_MUNIC, :ORDEM
      DO
      BEGIN
           IF ( :DT_NASCIMENTO IS NULL ) THEN
                DT_NASCIMENTO = '01/01/1900';

           IF ( :DT_CADASTRO IS NULL )THEN
                DT_CADASTRO = '01/01/1900';

           COMPRADOR     = NULL;
           PRAZO         = NULL;
           BLOQUEADO     = NULL;
           COD_VENDEDOR  = NULL;
           NOME_VENDEDOR = NULL;
           COD_CLASSIF   = NULL;
           REGIAO        = NULL;
           FORMA         = NULL;
           ASSINA_NOTA   = NULL;
           FREQUENCIA    = NULL;
           NOME_CLASSIF  = NULL;
           ENDERECO      = NULL;
           BAIRRO        = NULL;
           ATIVIDADE     = NULL;
           NOME_CLASSIF  = NULL;
           NOME_FORMA_PAGTO = NULL;
           COMPRADOR   = NULL;
           PRAZO       = NULL;
           BLOQUEADO   = NULL;
           COD_CLASSIF = NULL;
           FORMA       = NULL;
           ASSINA_NOTA = NULL;
           FREQUENCIA  = NULL;
           CPF = :cpf_cgc ;

           regiao = null;
           SELECT ROTA FROM VER_CODIGO_ROTA ( :CNPJ, :COD_CIDADE )
           INTO :REGIAO ;

           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;

           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           SELECT COMPRADOR, PRAZO, BLOQUEADO,
           COD_VEND, COD_CLASSIF, COD_FPAGTO, ASSINA_NOTA, FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           PLAN (GLO_CLIENTES INDEX (GLO_CLIENTES_PESSOA))
           ORDER BY CNPJ, PESSOA_FJ
           INTO :COMPRADOR, :PRAZO, :BLOQUEADO, :COD_VENDEDOR,
           :COD_CLASSIF, :FORMA, :ASSINA_NOTA, :FREQUENCIA ;

           IF ( COMPRADOR IS NULL ) THEN
                COMPRADOR = '';

           IF ( BLOQUEADO IS NULL )THEN
                BLOQUEADO = '';

           IF ( ASSINA_NOTA IS NULL ) THEN
                ASSINA_NOTA = 'N';

           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_VENDEDOR
           INTO :NOME_VENDEDOR ;

           SELECT NOME FROM GLO_CLASSIFICACAO
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIF
           INTO :NOME_CLASSIF ;

           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA_PAGTO ;

            select max(e.codigo) from glo_cliente_endereco e
            where e.cnpj = :cnpj and e.id_cliente = :codigo
            and e.endereco_padrao = 'S'
            into :end_cobranca;
            
            if (coalesce(:end_cobranca,0) > 0) then
            begin
                select lgd.codigo,
                 lgd.nome,
                 e.cep,
                 cdd.codigo,
                 cdd.nome,
                 br.codigo,
                 br.nome,
                 e.uf_sigla,
                 e.numero_end
                  from glo_cliente_endereco e
                left join glo_bairros br on (br.cnpj = e.cnpj and br.codigo = e.id_bairro)
                left join glo_logradouros lgd on (lgd.cnpj = e.cnpj and lgd.codigo = e.id_logradouro)
                left join glo_cidades cdd on (cdd.cnpj = e.cnpj and cdd.codigo = e.id_cidade)
                where e.cnpj = :cnpj and e.id_cliente = :codigo and e.codigo = :end_cobranca
                into  :cod_endereco,
                      :endereco,
                      :cep,
                      :cod_cidade,
                      :cidade,
                      :cod_bairro,
                      :bairro,
                      :uf,
                      :numero;
            end

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PESSOAS_CHEQUE (
    CNPJ VARCHAR(14))
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ASSINA_NOTA CHAR(1),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3))
AS
DECLARE VARIABLE FORMA INTEGER;
DECLARE VARIABLE CHEQUE CHAR(1);
BEGIN
  FOR SELECT
             CODIGO,
             NOME_RAZAO,
             FANTASIA,
             ATIVIDADE,
             ENDERECO,
             NUMERO,
             COMPLEMENTO,
             BAIRRO,
             CIDADE,
             UF,
             CEP,
             FONE,
             FAX,
             CELULAR,
             PESSOA,
             CPF_CGC,
             RG_IE,
             CONTATO,
             DT_NASCIMENTO,
             DT_CADASTRO,
             EMAIL,
             OBS,
             INSC_MUNIC,
             ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ
      INTO
           :CODIGO,
           :NOME_RAZAO,
           :FANTASIA,
           :COD_ATIVIDADE,
           :COD_ENDERECO,
           :NUMERO,
           :COMPLEMENTO,
           :COD_BAIRRO,
           :COD_CIDADE,
           :UF,
           :CEP,
           :FONE,
           :FAX,
           :CELULAR,
           :PESSOA,
           :CPF_CGC,
           :RG_IE,
           :CONTATO,
           :DT_NASCIMENTO,
           :DT_CADASTRO,
           :EMAIL,
           :OBS,
           :INSC_MUNIC,
           :ORDEM
      DO
      BEGIN
           COMPRADOR     = NULL;
           PRAZO         = NULL;
           BLOQUEADO     = NULL;
           COD_VENDEDOR  = NULL;
           COD_CLASSIF   = NULL;
           FORMA         = NULL;
           ASSINA_NOTA   = NULL;

           /* REGIAO */
           SELECT ROTA FROM VER_CODIGO_ROTA ( :CNPJ, :COD_CIDADE )
           INTO :REGIAO ;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;

           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           /* DADOS DOS CLIENTES */
           SELECT COMPRADOR, PRAZO, BLOQUEADO,
           COD_VEND, COD_CLASSIF, COD_FPAGTO, CHEQUE, ASSINA_NOTA,
           FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           INTO :COMPRADOR, :PRAZO, :BLOQUEADO, :COD_VENDEDOR,
           :COD_CLASSIF, :FORMA, :CHEQUE, :ASSINA_NOTA,
           :FREQUENCIA ;

           /* DADOS DO VENDEDOR */
           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_VENDEDOR
           INTO :NOME_VENDEDOR ;

           /* DADOS DO CLASSIFICACAO */
           SELECT NOME FROM GLO_CLASSIFICACAO
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIF
           INTO :NOME_CLASSIF ;

           /* DADOS DA FORMA DE PAGTO */
           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA_PAGTO ;

           IF ( :CHEQUE = 'S' )
           THEN BEGIN
                SUSPEND;
           END
      END
END
^

ALTER PROCEDURE VER_PESSOAS_CONVENIO (
    CNPJ VARCHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    NOME_RAZAO VARCHAR(50),
    FANTASIA VARCHAR(50),
    COD_ATIVIDADE INTEGER,
    COD_CLASSIF INTEGER,
    PRAZO INTEGER,
    COMPRADOR VARCHAR(50),
    ATIVIDADE VARCHAR(50),
    NOME_VENDEDOR VARCHAR(50),
    COD_ENDERECO INTEGER,
    COD_VENDEDOR INTEGER,
    NOME_CLASSIF VARCHAR(50),
    ENDERECO VARCHAR(50),
    NOME_FORMA_PAGTO VARCHAR(50),
    NUMERO VARCHAR(15),
    COMPLEMENTO VARCHAR(30),
    COD_BAIRRO INTEGER,
    BAIRRO VARCHAR(50),
    COD_CIDADE INTEGER,
    CIDADE VARCHAR(50),
    UF CHAR(2),
    BLOQUEADO CHAR(1),
    CEP VARCHAR(8),
    FONE VARCHAR(20),
    FAX VARCHAR(20),
    CELULAR VARCHAR(20),
    PESSOA CHAR(1),
    CPF_CGC VARCHAR(15),
    RG_IE VARCHAR(15),
    CONTATO VARCHAR(30),
    DT_NASCIMENTO DATE,
    DT_CADASTRO DATE,
    EMAIL VARCHAR(80),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    REGIAO INTEGER,
    INSC_MUNIC VARCHAR(15),
    ORDEM INTEGER,
    FREQUENCIA CHAR(3),
    ASSINA_NOTA CHAR(1))
AS
DECLARE VARIABLE FORMA INTEGER;
BEGIN
     FOR SELECT
             CODIGO, NOME_RAZAO, FANTASIA, ATIVIDADE, ENDERECO,
             NUMERO, COMPLEMENTO, BAIRRO, CIDADE, UF,
             CEP, FONE, FAX, CELULAR, PESSOA, CPF_CGC,
             RG_IE, CONTATO, DT_NASCIMENTO, DT_CADASTRO,
             EMAIL, OBS, INSC_MUNIC, ORDEM
      FROM GLO_PESSOAS_FJ
      WHERE CNPJ = :CNPJ AND CONVENIO = :CONVENIO
      INTO
           :CODIGO, :NOME_RAZAO, :FANTASIA, :COD_ATIVIDADE,
           :COD_ENDERECO, :NUMERO, :COMPLEMENTO,
           :COD_BAIRRO, :COD_CIDADE, :UF, :CEP, :FONE,
           :FAX, :CELULAR, :PESSOA, :CPF_CGC, :RG_IE,
           :CONTATO, :DT_NASCIMENTO, :DT_CADASTRO,
           :EMAIL, :OBS, :INSC_MUNIC, :ORDEM
      DO
      BEGIN
           COMPRADOR     = NULL;
           PRAZO         = NULL;
           BLOQUEADO     = NULL;
           COD_VENDEDOR  = NULL;
           COD_CLASSIF   = NULL;
           FORMA         = NULL;

           /* REGIAO */
           SELECT ROTA FROM VER_CODIGO_ROTA ( :CNPJ, :COD_CIDADE )
           INTO :REGIAO ;

           /* DADOS DA CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CIDADE
           INTO :CIDADE ;

           /* DADOS DO ENDERECO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ENDERECO
           INTO :ENDERECO ;

           /* DADOS DO BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAIRRO
           INTO :BAIRRO ;
           
           /* DADOS DA ATIVIDADE */
           SELECT NOME FROM GLO_ATIVIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_ATIVIDADE
           INTO :ATIVIDADE ;

           /* DADOS DOS CLIENTES */
           SELECT COMPRADOR, PRAZO, BLOQUEADO,
           COD_VEND, COD_CLASSIF, COD_FPAGTO,
           FREQUENCIA
           FROM GLO_CLIENTES
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CODIGO
           INTO :COMPRADOR, :PRAZO, :BLOQUEADO, :COD_VENDEDOR,
           :COD_CLASSIF, :FORMA, :FREQUENCIA ;

           /* DADOS DO VENDEDOR */
           SELECT NOME FROM FAT_VENDEDOR
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_VENDEDOR
           INTO :NOME_VENDEDOR ;

           /* DADOS DO CLASSIFICACAO */
           SELECT NOME FROM GLO_CLASSIFICACAO
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CLASSIF
           INTO :NOME_CLASSIF ;

           /* DADOS DA FORMA DE PAGTO */
           SELECT NOME FROM FIN_FORMAS_PAGTO
           WHERE CNPJ = :CNPJ AND CODIGO = :FORMA
           INTO :NOME_FORMA_PAGTO ;

           SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PRODUTO_GRUPO (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_GRUPO VARCHAR(50),
    CODIGO_G INTEGER,
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_INDEXADO NUMERIC(18,4),
    MARGEM_BRUTA NUMERIC(18,4))
AS
BEGIN
     FOR SELECT CODIGO, NOME
     FROM EST_GRUPOS
     WHERE CNPJ = :CNPJ AND NOME >= :GRUPO_INI AND NOME <= :GRUPO_FIM
     INTO :CODIGO_G, :NOME_GRUPO
     DO BEGIN
        FOR SELECT CODIGO, NOME,
                UNIDADE, QTDADE_2, PRC_REPOS,
                PRC_CUSTO_MED, PRC_VENDA, SUBGRUPO, SUBUNIDADE,
                CODIGO_INTERNO, CUSTO_AQUISICAO, CUSTO_INDEXADO,
                MARGEM_BRUTA
        FROM EST_PRODUTOS P
        WHERE CNPJ = :CNPJ AND ATIVO = :ATV AND GRUPO = :CODIGO_G
        PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
        ORDER BY CNPJ, ATIVO, GRUPO
        INTO :CODIGO, :NOME, :UNIDADE, :QTDADE_2, :PRC_REPOS,
             :PRC_CUSTO_MED, :PRC_VENDA, :SUBGRUPO, :SUBUNIDADE,
             :CODIGO_INTERNO, :CUSTO_AQUISICAO, :CUSTO_INDEXADO,
             :MARGEM_BRUTA
        DO BEGIN
           SELECT NOME FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :CODIGO_G AND SUBGRUPO = :SUBGRUPO
           INTO :NOME_SUBGRUPO ;
           
           /* Procedure body */
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_PRODUTO_GRUPO_VENDA (
    CNPJ VARCHAR(14),
    GRUPO_INI VARCHAR(50),
    GRUPO_FIM VARCHAR(50),
    ATV CHAR(1),
    MINI DATE,
    MFIM DATE)
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    CUSTO_AQUISICAO NUMERIC(18,4),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_GRUPO VARCHAR(50),
    CODIGO_G INTEGER,
    SUBGRUPO INTEGER,
    NOME_SUBGRUPO VARCHAR(50),
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4),
    CUSTO_INDEXADO NUMERIC(18,4),
    MARGEM_BRUTA NUMERIC(18,4),
    VENDA NUMERIC(18,4))
AS
BEGIN
     FOR SELECT CODIGO, NOME
     FROM EST_GRUPOS
     WHERE CNPJ = :CNPJ AND NOME >= :GRUPO_INI AND NOME <= :GRUPO_FIM
     INTO :CODIGO_G, :NOME_GRUPO
     DO BEGIN
        FOR SELECT CODIGO, NOME,
                UNIDADE, QTDADE_2, PRC_REPOS,
                PRC_CUSTO_MED, PRC_VENDA, SUBGRUPO, SUBUNIDADE,
                CODIGO_INTERNO, CUSTO_AQUISICAO, CUSTO_INDEXADO,
                MARGEM_BRUTA
        FROM EST_PRODUTOS P
        WHERE CNPJ = :CNPJ AND ATIVO = :ATV AND GRUPO = :CODIGO_G
        PLAN (P INDEX (IDX_EST_PRODUTOS_ATIVOD))
        ORDER BY CNPJ, ATIVO, GRUPO
        INTO :CODIGO, :NOME, :UNIDADE, :QTDADE_2, :PRC_REPOS,
             :PRC_CUSTO_MED, :PRC_VENDA, :SUBGRUPO, :SUBUNIDADE,
             :CODIGO_INTERNO, :CUSTO_AQUISICAO, :CUSTO_INDEXADO,
             :MARGEM_BRUTA
        DO BEGIN
           /* VENDA NOS 3 ULTIMOS MESES */
           SELECT QUANTIDADE FROM VENDAS_PERIODO_PRODUTO ( :CNPJ ,
                                  :MINI ,
                                  :MFIM ,
                                  :CODIGO)
           INTO :VENDA ;

           SELECT NOME FROM EST_SUBGRUPOS
           WHERE CNPJ = :CNPJ AND GRUPO = :CODIGO_G AND SUBGRUPO = :SUBGRUPO
           INTO :NOME_SUBGRUPO ;
           
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_PRODUTO_MARCA (
    CNPJ VARCHAR(14),
    MARCA_INI VARCHAR(50),
    MARCA_FIM VARCHAR(50),
    ATV CHAR(1))
RETURNS (
    CODIGO VARCHAR(15),
    CODIGO_2 VARCHAR(15),
    CODIGO_INTERNO INTEGER,
    COD_GRUPO INTEGER,
    COD_SUB_GRUPO INTEGER,
    GRUPO VARCHAR(50),
    SUB_GRUPO VARCHAR(50),
    NOME VARCHAR(50),
    UNIDADE VARCHAR(5),
    NOME_MARCA VARCHAR(50),
    CODIGO_M INTEGER,
    SUBUNIDADE INTEGER,
    QTDADE_2 NUMERIC(18,4),
    PRC_REPOS NUMERIC(18,4),
    PRC_CUSTO_MED NUMERIC(18,4),
    CUSTO_AQUISICAO NUMERIC(18,4),
    PRC_VENDA NUMERIC(18,4))
AS
BEGIN
        for select
                codigo, nome, codigo_interno,
                unidade, qtdade_2, prc_repos,
                prc_custo_med, prc_venda, marca,
                custo_aquisicao, subunidade, codigo_2,
                p.grupo, p.subgrupo
        from est_produtos p
        where cnpj = :cnpj and ativo = :atv 
        into :codigo, :nome, :codigo_interno, :unidade, :qtdade_2, :prc_repos,
             :prc_custo_med, :prc_venda, :codigo_m, :custo_aquisicao, :subunidade,
             :codigo_2, :cod_grupo, :cod_sub_grupo
        do begin

           select g.nome from est_grupos g
           where cnpj = :cnpj and codigo = :cod_grupo
           into :grupo;

           select nome from est_subgrupos sg
           where cnpj = :cnpj and sg.subgrupo = :cod_sub_grupo and sg.grupo = :cod_grupo
           into :sub_grupo;

           select nome from est_marcas m
           where cnpj = :cnpj and m.codigo = :codigo_m
           into :nome_marca;

           IF ((NOME_MARCA >= :MARCA_INI)AND(NOME_MARCA <=:MARCA_FIM))
           THEN BEGIN
                SUSPEND;
           END

           NOME_MARCA = NULL;
        END
END
^

ALTER PROCEDURE VER_PRODUTOS_APLICACOES (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    APLICACAO VARCHAR(50),
    LOCAL VARCHAR(50))
AS
declare variable COD_APLIC INTEGER;
BEGIN
      FOR SELECT
         APLICACAO,
         LOCAL
      FROM EST_PRODUTOS_APLICACOES
      WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO
      INTO
           :COD_APLIC,
           :LOCAL
      DO BEGIN
         SELECT NOME FROM EST_APLICACOES
         WHERE CNPJ = :CNPJ AND CODIGO = :COD_APLIC
         INTO :APLICACAO ;
         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PROPRIEDADE (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER,
    PROPRIEDADE INTEGER)
RETURNS (
    NOME VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    CPF VARCHAR(20),
    TECNICO INTEGER)
AS
DECLARE VARIABLE COD_END INTEGER;
DECLARE VARIABLE COD_CID INTEGER;
DECLARE VARIABLE COD_BAI INTEGER;
BEGIN
      COD_END = NULL;
      COD_CID = NULL;
      COD_BAI = NULL;

      SELECT NOME, PROPRIETARIO, IE,
            ENDERECO, COMPLEMENTO, CIDADE, UF, CEP, AREA_TOTAL,
            OBS, NUMERO, BAIRRO, ATIVA, TIPO_CONTRATO, CPF, TECNICO
      FROM GLO_PROPRIEDADES
      WHERE CNPJ = :CNPJ AND PROPRIEDADE = :PROPRIEDADE AND PESSOA_FJ = :PESSOA_FJ
      AND ((ATIVA = 'S') OR ( ATIVA IS NULL ))
      ORDER BY CNPJ, PESSOA_FJ, PROPRIEDADE
      INTO :NOME, :PROPRIETARIO, :IE, :COD_END,
           :COMPLEMENTO, :COD_CID, :UF, :CEP, :AREA_TOTAL, :OBS, :NUMERO, :COD_BAI,
           :ATIVA, :TIPO_CONTRATO, :CPF, :TECNICO ;

      IF ( TIPO_CONTRATO IS NOT NULL )
      THEN BEGIN
           /* LOGRADOURO */
           SELECT NOME FROM GLO_TIPO_CONTRATO
           WHERE CNPJ = :CNPJ AND CODIGO = :TIPO_CONTRATO
           INTO :NOME_CONTRATO ;
      END
      ELSE
          NOME_CONTRATO = '<>';

      IF ( COD_END IS NOT NULL )
      THEN BEGIN
           /* LOGRADOURO */
           SELECT NOME FROM GLO_LOGRADOUROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_END
           INTO :ENDERECO ;
         
           /* BAIRRO */
           SELECT NOME FROM GLO_BAIRROS
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAI
           INTO :BAIRRO ;

           /* CIDADE */
           SELECT NOME FROM GLO_CIDADES
           WHERE CNPJ = :CNPJ AND CODIGO = :COD_CID
           INTO :CIDADE ;
      END

      SUSPEND;
END
^

ALTER PROCEDURE VER_PROPRIEDADE_IE (
    CNPJ VARCHAR(14),
    IE_SERIE VARCHAR(15))
RETURNS (
    NOME VARCHAR(50),
    PROPRIETARIO VARCHAR(50),
    PESSOA_FJ INTEGER,
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    OBS BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50))
AS
DECLARE VARIABLE COD_END INTEGER;
DECLARE VARIABLE COD_CID INTEGER;
DECLARE VARIABLE COD_BAI INTEGER;
BEGIN
      COD_END = NULL;
      COD_CID = NULL;
      COD_BAI = NULL;

      FOR SELECT NOME, PROPRIETARIO, IE,
            ENDERECO, COMPLEMENTO, CIDADE, UF, CEP, AREA_TOTAL,
            OBS, NUMERO, BAIRRO, ATIVA, TIPO_CONTRATO,
            PESSOA_FJ
      FROM GLO_PROPRIEDADES
      WHERE CNPJ = :CNPJ AND IE LIKE '%' || :IE_SERIE || '%' /* EM QUALQUER PARTE */
      INTO :NOME, :PROPRIETARIO, :IE, :COD_END,
           :COMPLEMENTO, :COD_CID, :UF, :CEP, :AREA_TOTAL, :OBS, :NUMERO, :COD_BAI,
           :ATIVA, :TIPO_CONTRATO, :PESSOA_FJ
      DO BEGIN
         IF ( TIPO_CONTRATO IS NOT NULL )
         THEN BEGIN
              /* LOGRADOURO */
              SELECT NOME FROM GLO_TIPO_CONTRATO
              WHERE CNPJ = :CNPJ AND CODIGO = :TIPO_CONTRATO
              INTO :NOME_CONTRATO ;
         END
         ELSE
             NOME_CONTRATO = '<>';

         IF ( COD_END IS NOT NULL )
         THEN BEGIN
              /* LOGRADOURO */
              SELECT NOME FROM GLO_LOGRADOUROS
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_END
              INTO :ENDERECO ;
         
              /* BAIRRO */
              SELECT NOME FROM GLO_BAIRROS
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAI
              INTO :BAIRRO ;

              /* CIDADE */
              SELECT NOME FROM GLO_CIDADES
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_CID
              INTO :CIDADE ;
         END

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_PROPRIEDADES (
    CNPJ VARCHAR(14),
    PESSOA_FJ INTEGER)
RETURNS (
    NOME VARCHAR(50),
    PROPRIEDADE INTEGER,
    PROPRIETARIO VARCHAR(50),
    IE VARCHAR(15),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    BAIRRO VARCHAR(50),
    COMPLEMENTO VARCHAR(30),
    CIDADE VARCHAR(50),
    UF CHAR(2),
    CEP VARCHAR(8),
    AREA_TOTAL VARCHAR(30),
    ATIVA CHAR(1),
    TIPO_CONTRATO INTEGER,
    NOME_CONTRATO VARCHAR(50),
    CPF VARCHAR(20),
    TECNICO INTEGER)
AS
DECLARE VARIABLE COD_END INTEGER;
DECLARE VARIABLE COD_CID INTEGER;
DECLARE VARIABLE COD_BAI INTEGER;
BEGIN
      FOR SELECT NOME, PROPRIETARIO, IE, PROPRIEDADE,
            ENDERECO, COMPLEMENTO, CIDADE, UF, CEP, AREA_TOTAL,
            ATIVA, BAIRRO, NUMERO, CPF, TECNICO
      FROM GLO_PROPRIEDADES
      WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA_FJ
      AND ((ATIVA = 'S') OR ( ATIVA IS NULL ))
      ORDER BY CNPJ, PESSOA_FJ, PROPRIEDADE
      INTO :NOME, :PROPRIETARIO, :IE, :PROPRIEDADE, :COD_END,
           :COMPLEMENTO, :COD_CID, :UF, :CEP, :AREA_TOTAL,
           :ATIVA, :COD_BAI, :NUMERO, :CPF, :TECNICO
      DO BEGIN
         IF ( TIPO_CONTRATO IS NOT NULL )
         THEN BEGIN
              /* LOGRADOURO */
              SELECT NOME FROM GLO_TIPO_CONTRATO
              WHERE CNPJ = :CNPJ AND CODIGO = :TIPO_CONTRATO
              INTO :NOME_CONTRATO ;
         END
         ELSE
             NOME_CONTRATO = '<>';

         IF ( COD_END IS NOT NULL )
         THEN BEGIN
              /* BAIRRO */
              SELECT NOME FROM GLO_BAIRROS
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_BAI
              INTO :BAIRRO ;

              /* LOGRADOURO */
              SELECT NOME FROM GLO_LOGRADOUROS
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_END
              INTO :ENDERECO ;
         
              /* CIDADE */
              SELECT NOME FROM GLO_CIDADES
              WHERE CNPJ = :CNPJ AND CODIGO = :COD_CID
              INTO :CIDADE ;
         END

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_RAZAO (
    CNPJ CHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODINI VARCHAR(15),
    CODFIM VARCHAR(15))
RETURNS (
    CONTA INTEGER,
    CODIGOPLANO VARCHAR(15),
    CONTAPAI VARCHAR(10),
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER)
AS
BEGIN
     FOR   SELECT CONTA, CODIGO, CONTAPAI, NOME
     FROM  CTB_PLANOCONTA
     WHERE CODIGO >= :CODINI
     AND CODIGO <= :CODFIM
     AND CNPJ = :CNPJ
     ORDER BY CNPJ, CODIGO
     INTO
         :CONTA, :CODIGOPLANO, :CONTAPAI, :NOME
     DO BEGIN
        FOR SELECT
            CODIGO, DATA, TIPO, DOCUMENTO, HISTORICO, MES, ANO, VALOR,
            ORIGEM, PLANILHA, CONTRA_PARTIDA
        FROM CTB_MOVIMENTO_CONTABIL
        WHERE CONTA = :CONTA
        AND DATA >= :DATINI AND DATA <= :DATFIM
        AND CNPJ = :CNPJ
        ORDER BY CNPJ, DATA, TIPO
        INTO
            :CODIGO, :DATA, :TIPO, :DOCUMENTO, :HISTORICO, :MES, :ANO, :VALOR,
            :ORIGEM, :PLANILHA, :CONTRA_PARTIDA
        DO BEGIN
            SUSPEND ;
        END
     END
END
^

ALTER PROCEDURE VER_RAZAO_DESPESAS (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
BEGIN
     CNPJ = :EMPRESA ;

     /* TAMANHO DA CONTA */
     select * from getlength(:CODIINI) into :len;

     /* DEBITO */
     FOR SELECT
       CNPJ, CODIGO, CODIGO_CONTABIL, DATA, TIPO, DOCUMENTO, HISTORICO,
       MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA, CONTRA_PARTIDA,
       CREDITO, DEBITO, EXCLUIR, CONTA_PAI, NOME_CONTA_PAI, VALOR_INDEXADO
     FROM VER_MOVIMENTO_CONTABIL_DEBITO ( :EMPRESA, :DATINI, :DATFIM )
     WHERE CODIGO_CONTABIL LIKE :CODIINI||'%'
     INTO
         :CNPJ, :CODIGO, :CODIGO_CONTABIL, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA, :CONTRA_PARTIDA,
         :CREDITO, :DEBITO, :EXCLUIR, :CONTA_PAI, :NOME_CONTA_PAI, :VALOR_INDEXADO
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_RAZAO_DESPESAS_ACUMULADAS (
    EMPRESA VARCHAR(14),
    CODIINI VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4),
    INDICE NUMERIC(18,4),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
DECLARE VARIABLE TOTAL NUMERIC(18,4);
BEGIN
     /* TAMANHO DA CONTA */
     select * from getlength(:CODIINI) into :len;
     SELECT SUM ( VALOR )
     FROM VER_MOVIMENTO_CONTABIL_DEBITO ( :EMPRESA, '01/01/1900', '12/31/9999' )
     WHERE CODIGO_CONTABIL like  :CODIINI||'%'
     INTO :TOTAL ;

     /* DEBITO */
     FOR SELECT SUM ( VALOR ), SUM ( VALOR_INDEXADO ), CONTA_PAI
     FROM VER_MOVIMENTO_CONTABIL_DEBITO ( :EMPRESA, '01/01/1900', '12/31/9999' )
     WHERE CODIGO_CONTABIL like :CODIINI||'%'
     GROUP BY CONTA_PAI
     INTO :VALOR, :VALOR_INDEXADO, :CONTA_PAI
     DO BEGIN
        IF ( VALOR IS NULL )
        THEN
            VALOR = 0;

        IF ( VALOR_INDEXADO IS NULL )
        THEN
            VALOR_INDEXADO = 0;

        /* INDICE */
        IF ( TOTAL > 0 )
        THEN BEGIN
             INDICE = VALOR / TOTAL * 100 ;
        END

        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CODIGO = :CONTA_PAI AND CNPJ = :EMPRESA
        INTO :NOME_CONTA_PAI ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_RAZAO_DESPESAS_SINTETICO (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    VALOR NUMERIC(18,4),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
BEGIN
     /* TAMANHO DA CONTA */
     select * from getlength(:CODIINI) into :len;

     /* DEBITO */
     FOR SELECT SUM ( VALOR ), SUM ( VALOR_INDEXADO ), CONTA_PAI
     FROM VER_MOVIMENTO_CONTABIL_DEBITO ( :EMPRESA, :DATINI, :DATFIM )
     WHERE CODIGO_CONTABIL LIKE :CODIINI||'%'
     GROUP BY CONTA_PAI
     INTO :VALOR, :VALOR_INDEXADO, :CONTA_PAI
     DO BEGIN
        SELECT NOME FROM CTB_PLANOCONTA
        WHERE CODIGO = :CONTA_PAI AND CNPJ = :EMPRESA
        INTO :NOME_CONTA_PAI ;

        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_RAZAO_RECEITAS (
    EMPRESA VARCHAR(14),
    DATINI DATE,
    DATFIM DATE,
    CODIINI VARCHAR(15))
RETURNS (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    CODIGO_CONTABIL VARCHAR(15),
    DATA DATE,
    TIPO CHAR(1),
    DOCUMENTO VARCHAR(20),
    HISTORICO VARCHAR(100),
    MES INTEGER,
    ANO INTEGER,
    VALOR NUMERIC(18,4),
    CONTA INTEGER,
    ORIGEM VARCHAR(15),
    PLANILHA INTEGER,
    CONTRA_PARTIDA INTEGER,
    CREDITO VARCHAR(50),
    DEBITO VARCHAR(50),
    EXCLUIR CHAR(1),
    CONTA_PAI VARCHAR(10),
    NOME_CONTA_PAI VARCHAR(50),
    VALOR_INDEXADO NUMERIC(18,4))
AS
DECLARE VARIABLE LEN INTEGER;
BEGIN
     CNPJ = :EMPRESA ;

     /* TAMANHO DA CONTA */
     select * from getlength(:CODIINI) into :len;
     /* CREDITO */
     FOR SELECT
       CNPJ, CODIGO, CODIGO_CONTABIL, DATA, TIPO, DOCUMENTO, HISTORICO,
       MES, ANO, VALOR, CONTA, ORIGEM, PLANILHA, CONTRA_PARTIDA,
       CREDITO, DEBITO, EXCLUIR, CONTA_PAI, NOME_CONTA_PAI, VALOR_INDEXADO
     FROM VER_MOVIMENTO_CONTABIL_CREDITO ( :EMPRESA, :DATINI, :DATFIM )
     WHERE CODIGO_CONTABIL like :CODIINI||'%'
     INTO
         :CNPJ, :CODIGO, :CODIGO_CONTABIL, :DATA, :TIPO, :DOCUMENTO, :HISTORICO,
         :MES, :ANO, :VALOR, :CONTA, :ORIGEM, :PLANILHA, :CONTRA_PARTIDA,
         :CREDITO, :DEBITO, :EXCLUIR, :CONTA_PAI, :NOME_CONTA_PAI, :VALOR_INDEXADO
     DO BEGIN
        SUSPEND ;
     END
END
^

ALTER PROCEDURE VER_RECEBER (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(10),
    SALDO_DESCTO NUMERIC(18,4),
    TAXA_JUROS NUMERIC(18,4),
    COD_INDEXADOR INTEGER,
    IDX_DATABASE DATE,
    IDX_COTACAO NUMERIC(18,4),
    IDX_QTDE NUMERIC(18,4))
AS
BEGIN
     /*Percorrendo as contas a Receber*/
     for select rec.cnpj, rec.codigo, rec.ano, rec.pessoa_fj, rec.dt_emissao, rec.dt_vencto, rec.dt_lancto, rec.docto,
         rec.parcela, rec.historico, rec.valor, rec.vlr_parcial, rec.juros_rec, rec.descontos, rec.boleto, rec.origem,
         rec.codigo_vn, rec.ano_vn, rec.aviso, rec.dt_aviso, rec.selecionado,rec.tipo_docto, rec.numboleto, rec.numduplicata,
         rec.fatura, rec.parcial, rec.juros_parcial,rec.data_ult_baixa, rec.cobrador, rec.local_cobranca, coalesce(rec.arquivo_morto,'N'),
         case coalesce(vd.total,0)
         when 0 then 0
         else (
              (
               (coalesce(rec.valor_nominal,0) * 100.00)/(coalesce(vd.total,0) + coalesce(desc_acres,0))
              )
              * (coalesce(vd.descto_res,0)/100.00)
            )
          end, coalesce(cli.taxa_juros,0),
         rec.COD_INDEXADOR,
         rec.IDX_DATABASE ,
         rec.IDX_COTACAO,
         rec.IDX_QTDE
         from fin_contas_receber rec
         left join glo_clientes cli on (cli.cnpj = rec.cnpj and cli.pessoa_fj = rec.pessoa_fj)
         left join fat_vendas vd on (rec.cnpj = vd.cnpj and rec.codigo_vn = vd.codigo and vd.pessoa_fj = rec.pessoa_fj)
         where rec.cnpj = :cnpj and coalesce(rec.fatura,0) = 0
     into
        :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao, :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
        :valor, :vlr_parcial, :juros_rec, :descontos, :boleto, :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
        :tipo_docto, :numboleto, :numduplicata, :fatura, :parcial, :juros_parcial,
        :data_ult_baixa, :cobrador, :local, :arq_morto, :saldo_descto,:taxa_juros,
        :cod_indexador, :idx_database, :idx_cotacao, :idx_qtde
     do
     begin
        if (:fatura is null) then
           fatura = 0;

        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc, numero, cep, uf
        from  glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc, :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        suspend;
     end
END
^

ALTER PROCEDURE VER_RECEBER_3MESES (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    FATURA INTEGER,
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA, PARCIAL, JUROS_PARCIAL,
            DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO < :DATA 
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL, :JUROS_PARCIAL,
            :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQUIVO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_CLASSE (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    CLASSE INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
  for select rec.cnpj, codigo, ano, rec.pessoa_fj, dt_emissao, dt_vencto, dt_lancto, docto, parcela, historico,
      valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn, ano_vn, aviso,
      dt_aviso, selecionado, tipo_docto, numboleto, numduplicata, fatura, parcial, juros_parcial,
      data_ult_baixa, cobrador, local_cobranca,coalesce(arquivo_morto,'N'), cli.taxa_juros
  from fin_contas_receber rec
  left join glo_clientes cli on (rec.cnpj = cli.cnpj and rec.pessoa_fj = cli.pessoa_fj)
  where rec.cnpj = :cnpj and dt_vencto >= :dini and dt_vencto <= :dfim and coalesce(rec.fatura,0) = 0
  into
         :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,:dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :vlr_parcial, :juros_rec, :descontos, :boleto, :origem,:codigo_vn, :ano_vn, :aviso,
         :dt_aviso, :selecionado, :tipo_docto,:numboleto, :numduplicata, :fatura, :parcial,
         :juros_parcial, :data_ult_baixa, :cobrador, :local, :arquivo,:taxa_juros
  do
  begin
    /* pessoas fj */
    select endereco, bairro, cidade, nome_razao, fone, cpf_cgc, numero, cep, uf
    from   glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc, :numero, :cep, :uf;
               
    /* logradoutos */
    select nome from glo_logradouros where codigo = :cod_end and cnpj = :cnpj
    into :endereco ;
        
    /* cidades */
    select nome from glo_cidades  where codigo = :cod_cid and cnpj = :cnpj
    into :cidade ;

    /* bairros */
    select nome from glo_bairros where codigo = :cod_bai and cnpj = :cnpj
    into :bairro ;


    select cod_classif from glo_clientes where cnpj = :cnpj and pessoa_fj = :pessoa_fj
    into :classe ;

    suspend;
 end

  /*Notas não faturadas (Quando uma Venda FFT é faturada o campo duplicata é preenchido
      e ela não é mais encontrada aqui em fat-vendas-fft e vai pra receber)
      */
  for select vd.cnpj, vd.codigo, vd.pessoa_fj, (vd.data_caixa + 30), vd.data_caixa, vd.historico, coalesce(vd.total,0)
      from fat_vendas vd
      where fechada = 'S'  and cnpj = :cnpj  and ((data_caixa + 30) between :dini and :dfim)
      and cancelada <> 'S' and tipo_venda = 'FFT' and (( duplicata is null ) or ( duplicata = 0 ))
      into :cnpj, :codigo, :pessoa_fj, :dt_vencto, :dt_lancto, :historico, :valor
  do
  begin
    arquivo = 'N';
    /*------------------------------------Dados sobre a Venda--------------------------------------*/
    /* pessoas fj */
    select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
    numero, cep, uf
    from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
    :numero, :cep, :uf;
               
     /* logradoutos */
    select nome from glo_logradouros
    where codigo = :cod_end and cnpj = :cnpj
    into :endereco;
    
    /* cidades */
    select nome from glo_cidades
    where codigo = :cod_cid and cnpj = :cnpj
    into :cidade;

    /* bairros */
    select nome from glo_bairros
    where codigo = :cod_bai and cnpj = :cnpj
    into :bairro;

    select cod_classif from glo_clientes where cnpj = :cnpj and pessoa_fj = :pessoa_fj
    into :classe ;

    suspend;
  end /*faturas */
    
    
  /* Faturadas Lancadas Manualmente - Embora as as FFT faturadas caiam neste tabela,
  elas nãos serão retornadas na select pois não são 'MAN'
    
  select , dt_vencto, rec.data_ult_baixa, pessoa_fj,
  coalesce(rec.arquivo_morto,'N'),  rec.codigo*/
  for select ft.pessoa_fj, ft.ultima_bx_parcial, ft.valor, ft.vencimento
  from fin_faturas ft
  where cnpj = :cnpj and  baixada = 'N'
  into  :pessoa_fj, :data_ult_baixa, :valor, :dt_vencto
  do
  begin
   /*------------------------------------Dados sobre a Venda--------------------------------------*/
   /* pessoas fj */
    select endereco, bairro, cidade, nome_razao, fone, cpf_cgc, numero, cep, uf
    from glo_pessoas_fj
    where cnpj = :cnpj and codigo = :pessoa_fj
    into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,:numero, :cep, :uf;
               
    /* logradoutos */
    select nome from glo_logradouros where codigo = :cod_end and cnpj = :cnpj
    into :endereco;
        
    /* cidades */
    select nome from glo_cidades
    where codigo = :cod_cid and cnpj = :cnpj
    into :cidade;
    
    /* bairros */
    select nome from glo_bairros where codigo = :cod_bai and cnpj = :cnpj
    into :bairro;

    select cod_classif from glo_clientes where cnpj = :cnpj and pessoa_fj = :pessoa_fj
    into :classe ;
    
    suspend;
  end
END
^

ALTER PROCEDURE VER_RECEBER_CONVENIO (
    CNPJ CHAR(14),
    CONVENIO INTEGER)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(80),
    NOMECONVENIADO VARCHAR(80),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
IF ( CONVENIO > 0)
THEN BEGIN
     /* pessoas fj */
     for select codigo, endereco, psa.bairro, cidade, coalesce(codigo,'')||'-'||coalesce(nome_razao,''), psa.fone, cpf_cgc, cli.taxa_juros
     from glo_pessoas_fj psa
     left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
     where psa.cnpj = :cnpj and psa.codigo = :convenio
     into :pessoa_fj, :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc, :taxa_juros
     do begin
        /* zera os conveniados */
        conveniado        = null ;
        nomeconveniado    = :nome;
        cpf_cgcconveniado = null ;
             
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;
          
        /* busca as parcelas do convenio */
        for select codigo, ano, dt_emissao,
        dt_vencto, dt_lancto, docto, parcela, historico,
        valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn,
        ano_vn, aviso, dt_aviso, selecionado, tipo_docto, numboleto, numduplicata,
        fatura, parcial, data_ult_baixa, cobrador, local_cobranca, arquivo_morto
        from fin_contas_receber
        where cnpj = :cnpj and pessoa_fj = :convenio
        and fatura is null
        into
            :codigo, :ano, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_parcial, :juros_rec, :descontos, :boleto,
            :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
            :tipo_docto, :numboleto, :numduplicata, :fatura, :parcial, :data_ult_baixa,
            :cobrador, :local, :arquivo
        do begin
           suspend;
        end

        for select codigo, coalesce(codigo,'')||'-'||coalesce(nome_razao,''),
        cpf_cgc, coalesce(cli.taxa_juros,0)
        from glo_pessoas_fj psa
        left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
        where psa.cnpj = :cnpj and psa.convenio = :pessoa_fj
        into :conveniado, :nomeconveniado, :cpf_cgcconveniado, :taxa_juros
        do begin
           for select codigo, ano, dt_emissao,
           dt_vencto, dt_lancto, docto, parcela, historico,
           valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn,
           ano_vn, aviso, dt_aviso, selecionado, tipo_docto, numboleto, numduplicata,
           local_cobranca, arquivo_morto
           from fin_contas_receber
           where cnpj = :cnpj and pessoa_fj = :conveniado
           and fatura is null
           into
               :codigo, :ano, :dt_emissao,
               :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
               :valor, :vlr_parcial, :juros_rec, :descontos, :boleto,
               :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
               :tipo_docto, :numboleto, :numduplicata, :local, :arquivo
           do begin
              suspend;
           end
        end
     end
end
else begin
     /* BUSCA AS PARCELAS DO CONVENIO */
     for select pessoa_fj, codigo, ano, dt_emissao,
     dt_vencto, dt_lancto, docto, parcela, historico,
     valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn,
     ano_vn, aviso, dt_aviso, selecionado, tipo_docto, numboleto, numduplicata,
     parcial, cobrador, local_cobranca, arquivo_morto
     from fin_contas_receber
     where cnpj = :cnpj and fatura is null
     into
         :pessoa_fj, :codigo, :ano, :dt_emissao,
         :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
         :valor, :vlr_parcial, :juros_rec, :descontos, :boleto,
         :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
         :tipo_docto, :numboleto, :numduplicata, :parcial, :cobrador, :local,
         :arquivo
     do begin
        /* PESSOAS FJ */
        select endereco, psa.bairro, cidade, coalesce(codigo,'')||'-'||coalesce(nome_razao,''), psa.fone, cpf_cgc, convenio,
        numero, cep, uf, coalesce(cli.taxa_juros,0)
        from glo_pessoas_fj psa
        left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
        where psa.cnpj = :cnpj and psa.codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc, :conveniado,
             :numero, :cep, :uf, :taxa_juros;
        
        if (( conveniado = 0 ) or ( conveniado is null )) then
        begin
             /* zera os conveniados */
             conveniado        = null ;
             nomeconveniado    = :nome ;
             cpf_cgcconveniado = null ;
             
             /* logradoutos */
             select nome from glo_logradouros
             where codigo = :cod_end and cnpj = :cnpj
             into :endereco ;
        
             /* cidades */
             select nome from glo_cidades
             where codigo = :cod_cid and cnpj = :cnpj
             into :cidade ;

             /* bairros */
             select nome from glo_bairros
             where codigo = :cod_bai and cnpj = :cnpj
             into :bairro ;
          
             suspend;
        end
        else
        begin
             nomeconveniado    = :nome;
             cpf_cgcconveniado = :cpf_cgc ;
             select codigo, endereco, psa.bairro, cidade,coalesce(codigo,'')||'-'||coalesce(nome_razao,''), psa.fone, cpf_cgc,
             numero, cep, uf, coalesce(cli.taxa_juros,0)
             from glo_pessoas_fj psa
             left join glo_clientes cli on (cli.cnpj = psa.cnpj and cli.pessoa_fj = psa.codigo)
             where psa.cnpj = :cnpj and psa.codigo = :conveniado
             into :pessoa_fj, :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
                  :numero, :cep, :uf, :taxa_juros;

             /* logradoutos */
             select nome from glo_logradouros
             where codigo = :cod_end and cnpj = :cnpj
             into :endereco ;
        
             /* cidades */
             select nome from glo_cidades
             where codigo = :cod_cid and cnpj = :cnpj
             into :cidade ;

             /* bairros */
             select nome from glo_bairros
             where codigo = :cod_bai and cnpj = :cnpj
             into :bairro ;
          
             suspend;
       end
    end
end
END
^

ALTER PROCEDURE VER_RECEBER_CONVENIO_PERIODO (
    CNPJ CHAR(14),
    CONVENIO INTEGER,
    INICIAL TIMESTAMP,
    FINAL TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    ANO SMALLINT,
    CONVENIADO INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    NOMECONVENIADO VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    CPF_CGCCONVENIADO VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
IF ( CONVENIO > 0)
THEN BEGIN
     /* PESSOAS FJ */
     FOR SELECT CODIGO, ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
                NUMERO, CEP, UF
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIO
     INTO :PESSOA_FJ, :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :NUMERO, :CEP, :UF
     DO BEGIN
        /* ZERA OS CONVENIADOS */
        CONVENIADO        = NULL ;
        NOMECONVENIADO    = NULL ;
        CPF_CGCCONVENIADO = NULL ;
             
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;
          
        /* BUSCA AS PARCELAS DO CONVENIO */
        FOR SELECT CODIGO, ANO, DT_EMISSAO,
        DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
        VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
        ANO_VN, AVISO, DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA,
        FATURA, PARCIAL, DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
        FROM FIN_CONTAS_RECEBER
        WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIO AND DT_VENCTO >= :INICIAL AND DT_VENCTO <= :FINAL
        AND FATURA IS NULL
        INTO
            :CODIGO, :ANO, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO,
            :TIPO_DOCTO, :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL, :DATA_ULT_BAIXA,
            :COBRADOR, :LOCAL, :ARQUIVO
        DO BEGIN
           SUSPEND;
        END

        FOR SELECT CODIGO, NOME_RAZAO, CPF_CGC
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CONVENIO = :PESSOA_FJ
        INTO :CONVENIADO, :NOMECONVENIADO, :CPF_CGCCONVENIADO
        DO BEGIN
           FOR SELECT CODIGO, ANO, DT_EMISSAO,
           DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
           VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
           ANO_VN, AVISO, DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA,
           PARCIAL, COBRADOR
           FROM FIN_CONTAS_RECEBER
           WHERE CNPJ = :CNPJ AND PESSOA_FJ = :CONVENIADO AND DT_VENCTO >= :INICIAL AND DT_VENCTO <= :FINAL
           AND FATURA IS NULL 
           INTO
               :CODIGO, :ANO, :DT_EMISSAO,
               :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
               :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
               :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO,
               :TIPO_DOCTO, :NUMBOLETO, :NUMDUPLICATA, :PARCIAL, :COBRADOR
           DO BEGIN
              SUSPEND;
           END
        END
     END
END
ELSE BEGIN
     /* BUSCA AS PARCELAS DO CONVENIO */
     FOR SELECT PESSOA_FJ, CODIGO, ANO, DT_EMISSAO,
     DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
     VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
     ANO_VN, AVISO, DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA,
     COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :INICIAL AND DT_VENCTO <= :FINAL
     AND FATURA IS NULL
     INTO
         :PESSOA_FJ, :CODIGO, :ANO, :DT_EMISSAO,
         :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
         :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
         :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO,
         :TIPO_DOCTO, :NUMBOLETO, :NUMDUPLICATA, :COBRADOR, :LOCAL, :ARQUIVO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC, CONVENIO,
        NUMERO, CEP, UF
        FROM GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC, :CONVENIADO,
             :NUMERO, :CEP, :UF ;
        
        IF (( CONVENIADO = 0 ) or ( CONVENIADO IS NULL ))
        THEN BEGIN
             /* ZERA OS CONVENIADOS */
             CONVENIADO        = NULL ;
             NOMECONVENIADO    = NULL ;
             CPF_CGCCONVENIADO = NULL ;
             
             /* LOGRADOUTOS */
             SELECT NOME FROM GLO_LOGRADOUROS
             WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
             INTO :ENDERECO ;
        
             /* CIDADES */
             SELECT NOME FROM GLO_CIDADES
             WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
             INTO :CIDADE ;

             /* BAIRROS */
             SELECT NOME FROM GLO_BAIRROS
             WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
             INTO :BAIRRO ;
          
             SUSPEND;
        END
        ELSE BEGIN
             NOMECONVENIADO    = :NOME    ;
             CPF_CGCCONVENIADO = :CPF_CGC ;
        
             SELECT CODIGO, ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :CONVENIADO
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :PESSOA_FJ, :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC ;

             /* LOGRADOUTOS */
             SELECT NOME FROM GLO_LOGRADOUROS
             WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
             INTO :ENDERECO ;
        
             /* CIDADES */
             SELECT NOME FROM GLO_CIDADES
             WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
             INTO :CIDADE ;

             /* BAIRROS */
             SELECT NOME FROM GLO_BAIRROS
             WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
             INTO :BAIRRO ;
          
             SUSPEND;
       END
    END
END
END
^

ALTER PROCEDURE VER_RECEBER_FATURA (
    CNPJ CHAR(14),
    FAT INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA,
            PARCIAL, JUROS_PARCIAL, DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND FATURA = :FAT
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQ_MORTO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_LANCAMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO,
            ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO, SELECIONADO,
            TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA,
            PARCIAL, JUROS_PARCIAL, DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA,
            ARQUIVO_MORTO, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI AND DT_LANCTO <= :DFIM
     AND FATURA IS NULL
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL,
            :ARQUIVO, :arq_morto
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
               NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
               :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
               :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_LANCAMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    NUMBOLETO INTEGER,
    FATURA INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO,
            ORIGEM, CODIGO_VN, ANO_VN, AVISO, DT_AVISO, SELECIONADO,
            TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA, PARCIAL, JUROS_PARCIAL,
            DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_LANCTO >= :DINI AND DT_LANCTO <= :DFIM AND FATURA IS NULL
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL, :JUROS_PARCIAL,
            :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQUIVO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_PESSOA (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ARQ_MORTO CHAR(1),
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO,
            NUMDUPLICATA, FATURA, PARCIAL, JUROS_PARCIAL,
            DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA
     AND FATURA IS NULL
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO,
            :TIPO_DOCTO, :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQUIVO, :arq_morto
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
               NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
             :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_PESSOA_NFATURADO (
    CNPJ CHAR(14),
    PESSOA INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN,
            ANO_VN, AVISO, DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO,
            NUMDUPLICATA, FATURA, PARCIAL, JUROS_PARCIAL, DATA_ULT_BAIXA,
            COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND (( FATURA IS NULL ) OR ( FATURA = 0 ))
     ORDER BY CNPJ, PESSOA_FJ
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO,
            :ORIGEM, :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO,
            :TIPO_DOCTO, :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQUIVO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
               NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
             :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
             :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_PREVISAO (
    CNPJ CHAR(14),
    DATA TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
     for select cnpj, codigo, ano, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn,
            ano_vn, aviso, dt_aviso, selecionado, tipo_docto, numboleto, numduplicata,
            fatura, parcial, juros_parcial, data_ult_baixa, cobrador, local_cobranca,
            arquivo_morto
     from fin_contas_receber
     where cnpj = :cnpj and dt_vencto >= :data 
     into
            :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_parcial, :juros_rec, :descontos, :boleto,
            :origem, :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado,
            :tipo_docto, :numboleto, :numduplicata, :fatura, :parcial,
            :juros_parcial, :data_ult_baixa, :cobrador, :local, :arq_morto
     do begin
        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into
            :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
            :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        suspend;
     end

     /*Notas não faturadas (Quando uma Venda FFT é faturada o campo duplicata é preenchido
     e ela não é mais encontrada aqui em fat-vendas-fft e vai pra receber) */
     for select codigo, data_caixa, (data_caixa + 30), data_caixa, historico, pessoa_fj,
         (total + desc_acres) as valor_liquid, duplicata
     from fat_vendas
     where fechada = 'S'  and cnpj = :cnpj  and ((data_caixa + 30) >= :data)
     and cancelada <> 'S' and tipo_venda = 'FFT' and (( duplicata is null ) or ( duplicata = 0 ))
     into  :codigo, :dt_emissao, :dt_vencto, :dt_lancto ,:historico,:pessoa_fj, :valor, :numduplicata
     do begin
        fatura       = :numduplicata ;

        docto = cast(codigo as varchar(20));
        parcela = '1/1' ;

        vlr_parcial = 0       ;
        juros_rec   = 0       ;
        descontos   = 0       ;
        BOLETO      = 'N'     ;
        ORIGEM      = 'VND'   ;
        codigo_vn   = :codigo ;
        ano_vn      = 0       ;

        select nome_razao
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome;

        suspend;
    end /* faturas */


    /* Faturadas Lancadas Manualmente - Embora as as FFT faturadas caiam neste tabela,
     elas nãos serão retornadas na select pois não são 'MAN' */
     for select codigo, pessoa_fj, data, valor, vencimento, historico
     from fin_faturas
     where cnpj = :cnpj and origem = 'MAN' and baixada = 'N' and vencimento >= :data
     into  :codigo, :pessoa_fj, :dt_emissao, :valor, :dt_vencto, :historico
     do begin
        fatura       = :codigo ;

        docto = cast(codigo as varchar(20));
        parcela = '1/1' ;

        dt_lancto   = :dt_emissao ;
        vlr_parcial = 0       ;
        juros_rec   = 0       ;
        descontos   = 0       ;
        boleto      = 'N'     ;
        origem      = 'FAT'   ;
        codigo_vn   = 0 ;
        ano_vn      = 0       ;

        select nome_razao
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        order by cnpj, codigo
        into :nome;

        suspend;
    end /* faturas */
END
^

ALTER PROCEDURE VER_RECEBER_REGIAO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    REGIAO INTEGER)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
DECLARE VARIABLE CONT INTEGER;
BEGIN
     for select cnpj, codigo, ano, pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn, ano_vn, aviso,
            dt_aviso, selecionado, tipo_docto, numboleto, numduplicata, fatura,
            parcial, juros_parcial, data_ult_baixa, cobrador, local_cobranca, coalesce(arquivo_morto,'N'),
            coalesce(arquivo_morto,'N')
     from fin_contas_receber rec
     where cnpj = :cnpj and (dt_vencto between :dini and :dfim) and coalesce(rec.fatura,0) = 0
     into
            :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_parcial, :juros_rec, :descontos, :boleto, :origem,
            :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado, :tipo_docto,
            :numboleto, :numduplicata, :fatura, :parcial,
            :juros_parcial, :data_ult_baixa, :cobrador, :local, :arquivo, :arq_morto
     do begin
        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from   glo_pessoas_fj where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
        :numero, :cep, :uf ;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        select cont from compoe_rota( :cnpj, :regiao, :cod_cid )
        into :cont ;

        if ( cont > 0 ) then
          suspend;
     end

     /*Notas não faturadas (Quando uma Venda FFT é faturada o campo duplicata é preenchido
      e ela não é mais encontrada aqui em fat-vendas-fft e vai pra receber)
      */
     for select vd.cnpj, vd.codigo, vd.pessoa_fj, (vd.data_caixa + 30), vd.data_caixa, vd.historico, coalesce(vd.total,0)
         from fat_vendas vd
         where fechada = 'S'  and cnpj = :cnpj  and ((data_caixa + 30) between :dini and :dfim)
         and cancelada <> 'S' and tipo_venda = 'FFT' and (( duplicata is null ) or ( duplicata = 0 ))
         into :cnpj, :codigo, :pessoa_fj, :dt_vencto, :dt_lancto, :historico, :valor
     do
     begin
        arquivo = 'N';
        /*------------------------------------Dados sobre a Venda--------------------------------------*/
        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
        :numero, :cep, :uf;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco;
    
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro;

        select cont from compoe_rota( :cnpj, :regiao, :cod_cid )
        into :cont ;

        if ( cont > 0 ) then
          suspend;

    end /*faturas */
    
    
    /* Faturadas Lancadas Manualmente - Embora as as FFT faturadas caiam neste tabela,
    elas nãos serão retornadas na select pois não são 'MAN'
    
    */
    for select ft.pessoa_fj, ft.ultima_bx_parcial, ft.valor, ft.vencimento
        from fin_faturas ft
        where cnpj = :cnpj and  baixada = 'N'
        into  :pessoa_fj, :data_ult_baixa, :valor, :dt_vencto
    do
    begin
      /*------------------------------------Dados sobre a Venda--------------------------------------*/
      /* pessoas fj */
      select endereco, bairro, cidade, nome_razao, fone, cpf_cgc, numero, cep, uf
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,:numero, :cep, :uf;
               
      /* logradoutos */
      select nome from glo_logradouros where codigo = :cod_end and cnpj = :cnpj
      into :endereco;
        
      /* cidades */
      select nome from glo_cidades
      where codigo = :cod_cid and cnpj = :cnpj
      into :cidade;
    
      /* bairros */
      select nome from glo_bairros where codigo = :cod_bai and cnpj = :cnpj
      into :bairro;

      select cont from compoe_rota( :cnpj, :regiao, :cod_cid ) into :cont;

      if (cont > 0) then
        suspend;
  end
END
^

ALTER PROCEDURE VER_RECEBER_VENCIMENTO (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQUIVO CHAR(1),
    ARQ_MORTO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA,
            PARCIAL, JUROS_PARCIAL, DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA,
            ARQUIVO_MORTO, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI AND DT_VENCTO <= :DFIM
     AND FATURA IS NULL
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQUIVO, :arq_morto
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_VENCIMENTO_BAIXA (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    ARQ_MORTO CHAR(1))
AS
BEGIN
     FOR SELECT CNPJ, CODIGO, ANO, PESSOA_FJ, DT_EMISSAO,
            DT_VENCTO, DT_LANCTO, DOCTO, PARCELA, HISTORICO,
            VALOR, VLR_PARCIAL, JUROS_REC, DESCONTOS, BOLETO, ORIGEM, CODIGO_VN, ANO_VN, AVISO,
            DT_AVISO, SELECIONADO, TIPO_DOCTO, NUMBOLETO, NUMDUPLICATA, FATURA,
            PARCIAL, JUROS_PARCIAL, DATA_ULT_BAIXA, COBRADOR, LOCAL_COBRANCA, ARQUIVO_MORTO
     FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND DT_VENCTO >= :DINI AND DT_VENCTO <= :DFIM AND FATURA IS NULL
     INTO
            :CNPJ, :CODIGO, :ANO, :PESSOA_FJ, :DT_EMISSAO,
            :DT_VENCTO, :DT_LANCTO, :DOCTO, :PARCELA, :HISTORICO,
            :VALOR, :VLR_PARCIAL, :JUROS_REC, :DESCONTOS, :BOLETO, :ORIGEM,
            :CODIGO_VN, :ANO_VN, :AVISO, :DT_AVISO, :SELECIONADO, :TIPO_DOCTO,
            :NUMBOLETO, :NUMDUPLICATA, :FATURA, :PARCIAL,
            :JUROS_PARCIAL, :DATA_ULT_BAIXA, :COBRADOR, :LOCAL, :ARQ_MORTO
     DO BEGIN
        /* PESSOAS FJ */
        SELECT ENDERECO, BAIRRO, CIDADE, NOME_RAZAO, FONE, CPF_CGC,
        NUMERO, CEP, UF
        FROM   GLO_PESSOAS_FJ
        WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
        PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
        ORDER BY CNPJ, CODIGO
        INTO
            :COD_END, :COD_BAI, :COD_CID, :NOME, :FONE, :CPF_CGC,
            :NUMERO, :CEP, :UF ;
               
        /* LOGRADOUTOS */
        SELECT NOME FROM GLO_LOGRADOUROS
        WHERE CODIGO = :COD_END AND CNPJ = :CNPJ
        INTO :ENDERECO ;
        
        /* CIDADES */
        SELECT NOME FROM GLO_CIDADES
        WHERE CODIGO = :COD_CID AND CNPJ = :CNPJ
        INTO :CIDADE ;

        /* BAIRROS */
        SELECT NOME FROM GLO_BAIRROS
        WHERE CODIGO = :COD_BAI AND CNPJ = :CNPJ
        INTO :BAIRRO ;

        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_RECEBER_VENDEDOR (
    CNPJ CHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP)
RETURNS (
    CODIGO INTEGER,
    ANO SMALLINT,
    PESSOA_FJ INTEGER,
    DT_EMISSAO TIMESTAMP,
    DT_VENCTO TIMESTAMP,
    DT_LANCTO TIMESTAMP,
    DOCTO VARCHAR(20),
    PARCELA CHAR(6),
    HISTORICO VARCHAR(100),
    VALOR NUMERIC(18,4),
    VLR_PARCIAL NUMERIC(18,4),
    JUROS_REC NUMERIC(18,4),
    DESCONTOS NUMERIC(18,4),
    BOLETO CHAR(1),
    ORIGEM CHAR(3),
    CODIGO_VN INTEGER,
    ANO_VN SMALLINT,
    AVISO SMALLINT,
    DT_AVISO TIMESTAMP,
    NOME VARCHAR(50),
    ENDERECO VARCHAR(50),
    NUMERO VARCHAR(15),
    CIDADE VARCHAR(50),
    BAIRRO VARCHAR(50),
    CEP CHAR(8),
    UF CHAR(2),
    COD_END INTEGER,
    COD_CID INTEGER,
    COD_BAI INTEGER,
    FONE VARCHAR(20),
    CPF_CGC VARCHAR(15),
    SELECIONADO CHAR(1),
    TIPO_DOCTO CHAR(3),
    NUMDUPLICATA INTEGER,
    FATURA INTEGER,
    NUMBOLETO INTEGER,
    PARCIAL NUMERIC(18,4),
    JUROS_PARCIAL NUMERIC(18,4),
    DATA_ULT_BAIXA TIMESTAMP,
    COBRADOR INTEGER,
    LOCAL INTEGER,
    VENDEDOR INTEGER,
    ARQUIVO CHAR(1),
    TAXA_JUROS NUMERIC(18,4))
AS
BEGIN
     for select rec.cnpj, codigo, ano, rec.pessoa_fj, dt_emissao,
            dt_vencto, dt_lancto, docto, parcela, historico,
            valor, vlr_parcial, juros_rec, descontos, boleto, origem, codigo_vn, ano_vn, aviso,
            dt_aviso, selecionado, tipo_docto, numboleto, numduplicata, fatura,
            parcial, juros_parcial, data_ult_baixa, cobrador, local_cobranca, coalesce(arquivo_morto,'N'),
            coalesce(cli.taxa_juros,0)
     from fin_contas_receber rec
     left join glo_clientes cli on (cli.cnpj = rec.cnpj and rec.pessoa_fj = cli.pessoa_fj)
     where cli.cnpj = :cnpj and (dt_vencto between :dini and :dfim) and coalesce(rec.fatura,0) = 0
     into
            :cnpj, :codigo, :ano, :pessoa_fj, :dt_emissao,
            :dt_vencto, :dt_lancto, :docto, :parcela, :historico,
            :valor, :vlr_parcial, :juros_rec, :descontos, :boleto, :origem,
            :codigo_vn, :ano_vn, :aviso, :dt_aviso, :selecionado, :tipo_docto,
            :numboleto, :numduplicata, :fatura, :parcial,
            :juros_parcial, :data_ult_baixa, :cobrador, :local, :arquivo,
            :taxa_juros
     do begin
        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from   glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
             :numero, :cep, :uf;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco ;
        
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade ;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro ;

        /* vendedor */
        select vendedor
        from fat_vendas
        where cnpj = :cnpj and codigo = :codigo_vn
        into :vendedor ;

        suspend;
     end

     /*Notas não faturadas (Quando uma Venda FFT é faturada o campo duplicata é preenchido
      e ela não é mais encontrada aqui em fat-vendas-fft e vai pra receber)
      */
     for select vd.cnpj, vd.codigo, vd.pessoa_fj, (vd.data_caixa + 30), vd.data_caixa, vd.historico, coalesce(vd.total,0)
         from fat_vendas vd
         where fechada = 'S'  and cnpj = :cnpj  and ((data_caixa + 30) between :dini and :dfim)
         and cancelada <> 'S' and tipo_venda = 'FFT' and (( duplicata is null ) or ( duplicata = 0 ))
         into :cnpj, :codigo, :pessoa_fj, :dt_vencto, :dt_lancto, :historico, :valor
     do
     begin
        arquivo = 'N';
        /*------------------------------------Dados sobre a Venda--------------------------------------*/
        /* pessoas fj */
        select endereco, bairro, cidade, nome_razao, fone, cpf_cgc,
        numero, cep, uf
        from glo_pessoas_fj
        where cnpj = :cnpj and codigo = :pessoa_fj
        into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,
        :numero, :cep, :uf;
               
        /* logradoutos */
        select nome from glo_logradouros
        where codigo = :cod_end and cnpj = :cnpj
        into :endereco;
    
        /* cidades */
        select nome from glo_cidades
        where codigo = :cod_cid and cnpj = :cnpj
        into :cidade;

        /* bairros */
        select nome from glo_bairros
        where codigo = :cod_bai and cnpj = :cnpj
        into :bairro;

        suspend;

    end /*faturas */
    
    
    /* Faturadas Lancadas Manualmente - Embora as as FFT faturadas caiam neste tabela,
    elas nãos serão retornadas na select pois não são 'MAN'
    
    */
    for select ft.pessoa_fj, ft.ultima_bx_parcial, ft.valor, ft.vencimento
        from fin_faturas ft
        where cnpj = :cnpj and  baixada = 'N'
        into  :pessoa_fj, :data_ult_baixa, :valor, :dt_vencto
    do
    begin
      /*------------------------------------Dados sobre a Venda--------------------------------------*/
      /* pessoas fj */
      select endereco, bairro, cidade, nome_razao, fone, cpf_cgc, numero, cep, uf
      from glo_pessoas_fj
      where cnpj = :cnpj and codigo = :pessoa_fj
      into :cod_end, :cod_bai, :cod_cid, :nome, :fone, :cpf_cgc,:numero, :cep, :uf;
               
      /* logradoutos */
      select nome from glo_logradouros where codigo = :cod_end and cnpj = :cnpj
      into :endereco;
        
      /* cidades */
      select nome from glo_cidades
      where codigo = :cod_cid and cnpj = :cnpj
      into :cidade;
    
      /* bairros */
      select nome from glo_bairros where codigo = :cod_bai and cnpj = :cnpj
      into :bairro;


      suspend;
  end
END
^

ALTER PROCEDURE VER_REDUCOES (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    PERC_ESTADUAL NUMERIC(18,4),
    PERC_INTERESTADUAL NUMERIC(18,4),
    PERC_CONTRIBUINTE NUMERIC(18,4),
    MENSAGEM_NF VARCHAR(80),
    MENSAGEM_NF_IE VARCHAR(80))
AS
BEGIN
     FOR SELECT
             PERC_ESTADUAL,
             PERC_INTERESTADUAL,
             MENSAGEM_NF,
             MENSAGEM_NF_IE,
             PERC_CONTRIBUINTE
      FROM EST_REDUCOES
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      INTO
           :PERC_ESTADUAL,
           :PERC_INTERESTADUAL,
           :MENSAGEM_NF,
           :MENSAGEM_NF_IE,
           :PERC_CONTRIBUINTE
      DO
      BEGIN
        SUSPEND;
      END
END
^

ALTER PROCEDURE VER_SIS_BOLETOBANCARIO (
    CNPJ VARCHAR(14),
    LOCAL INTEGER)
RETURNS (
    BANCO CHAR(3),
    VENCIMENTO_DST INTEGER,
    VENCIMENTO_ALT INTEGER,
    DATA_DST INTEGER,
    DATA_ALT INTEGER,
    DOCUMENTO_DST INTEGER,
    DOCUMENTO_ALT INTEGER,
    ESPECIE_DST INTEGER,
    ESPECIE_ALT INTEGER,
    ACEITE_DST INTEGER,
    ACEITE_ALT INTEGER,
    DTPROCESSAMENTO_DST INTEGER,
    DTPROCESSAMENTO_ALT INTEGER,
    VALOR_DST INTEGER,
    VALOR_ALT INTEGER,
    INSTRUCOES_DST INTEGER,
    INSTRUCOES_ALT INTEGER,
    SACADO_DST INTEGER,
    SACADO_ALT INTEGER,
    CIDADE_DST INTEGER,
    CIDADE_ALT INTEGER,
    PORTA_IMPRESSORA VARCHAR(50),
    TAMANHOPAGINA INTEGER,
    LPP INTEGER)
AS
BEGIN
     SELECT BANCO FROM CTB_PLANOCONTA
     WHERE CONTA = :LOCAL AND CNPJ = :CNPJ
     INTO :BANCO ;

     FOR SELECT VENCIMENTO_DST, VENCIMENTO_ALT, DATA_DST,
            DATA_ALT, DOCUMENTO_DST, DOCUMENTO_ALT, ESPECIE_DST, ESPECIE_ALT,
            ACEITE_DST, ACEITE_ALT, DTPROCESSAMENTO_DST, DTPROCESSAMENTO_ALT,
            VALOR_DST, VALOR_ALT, INSTRUCOES_DST, INSTRUCOES_ALT, SACADO_DST,
            SACADO_ALT, TAMANHOPAGINA, CIDADE_DST, CIDADE_ALT, PORTA_IMPRESSORA,
            LPP
     FROM SIS_BOLETOBANCARIO
     WHERE CNPJ = :CNPJ AND BANCO = :BANCO
     INTO :VENCIMENTO_DST, :VENCIMENTO_ALT, :DATA_DST,
          :DATA_ALT, :DOCUMENTO_DST, :DOCUMENTO_ALT, :ESPECIE_DST,
          :ESPECIE_ALT, :ACEITE_DST, :ACEITE_ALT, :DTPROCESSAMENTO_DST,
          :DTPROCESSAMENTO_ALT, :VALOR_DST, :VALOR_ALT, :INSTRUCOES_DST,
          :INSTRUCOES_ALT, :SACADO_DST, :SACADO_ALT, :TAMANHOPAGINA,
          :CIDADE_DST, :CIDADE_ALT, :PORTA_IMPRESSORA, :LPP
     DO BEGIN
         SUSPEND;
     END
END
^

ALTER PROCEDURE VER_TROCA_ITENS (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    TIPO CHAR(1))
AS
BEGIN
     FOR SELECT
         DESCONTO, ICM, ICM_SUBS, IPI, PESO, PORC_DESC, PRC_CUSTO,
         PRC_UNIT_ORIGINAL, PRC_UNITARIO, PRODUTO, QUANTIDADE,
         SEQUENCIA, UNIDADE, SUBUNIDADE, VOLUME, TIPO
     from FAT_TROCAS_ITENS VE
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     INTO
         :DESCONTO, :ICM, :ICM_SUBS, :IPI, :PESO, :PORC_DESC, :PRC_CUSTO,
         :PRC_UNIT_ORIGINAL, :PRC_UNITARIO, :PRODUTO, :QUANTIDADE,
         :SEQUENCIA, :UNIDADE, :SUBUNIDADE, :VOLUME, :TIPO
     DO BEGIN
        SELECT NOME FROM EST_PRODUTOS
        WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
        INTO NOME_PRODUTO ;
        
        SUSPEND;
     END
END
^

ALTER PROCEDURE VER_TROCAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA DATE,
    TOTAL NUMERIC(18,4),
    TOTAL_2 NUMERIC(18,4),
    FECHADO CHAR(1),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    VLR_TOTAL_2 NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    DESC_ACRESC_2 NUMERIC(18,4),
    LIQUIDO NUMERIC(18,4),
    OBSERVACAO VARCHAR(80),
    ENVIADA_CX CHAR(1),
    CANCELADA CHAR(1))
AS
BEGIN
     FOR SELECT
         PESSOA_FJ, NOME, CODIGO, DATA, TOTAL, DESC_ACRESC,
         FECHADO, VENDEDOR, USUARIO, DATA_CAIXA,
         CONTA_CAIXA, NOME_CONSUMIDOR, OBSERVACAO, ENVIADA_CX,
         CANCELADA, TOTAL_2, DESC_ACRESC_2
     FROM FAT_TROCAS
     WHERE CNPJ = :CNPJ AND FECHADO = :TP
     AND ENVIADA_CX = 'S'
     INTO
         :PESSOA_FJ, :NOME, :CODIGO, :DATA, :TOTAL, :DESC_ACRESC,
         :FECHADO, :VENDEDOR, :USUARIO, :DATA_CAIXA, :CONTA_CAIXA,
         :NOME_CONSUMIDOR, :OBSERVACAO, :ENVIADA_CX, :CANCELADA,
         :TOTAL_2, :DESC_ACRESC_2
     DO BEGIN
        /* VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDOR AND CNPJ = :CNPJ
        INTO :NOMEVENDEDOR ;

        VLR_TOTAL = :TOTAL + :DESC_ACRESC ;
        VLR_TOTAL_2 = :TOTAL_2 + :DESC_ACRESC_2 ;

        LIQUIDO = :VLR_TOTAL_2 - :VLR_TOTAL;
        
        SUSPEND;
    END
END
^

ALTER PROCEDURE VER_ULTIMAS_ORDENS_SERVICO (
    CNPJ CHAR(14),
    CODIGO_CLIENTE INTEGER,
    PROPRIEDADE INTEGER,
    COD_ATUAL INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    PESSOA_FJ INTEGER,
    ENVIADA_CX CHAR(1),
    NOME VARCHAR(50),
    NATUREZA INTEGER,
    MECANICO INTEGER,
    VIAJANTE INTEGER,
    ENTRADA TIMESTAMP,
    MOTOR INTEGER,
    SOLICITANTE VARCHAR(50),
    HISTORICO VARCHAR(100),
    CHASSI VARCHAR(30),
    TOTAL NUMERIC(18,4),
    DESC_ACRESC NUMERIC(18,4),
    CLIENTE VARCHAR(50),
    FECHADO VARCHAR(50),
    NOME_NATUREZA VARCHAR(50),
    NOME_MECANICO VARCHAR(50),
    NOME_VIAJANTE VARCHAR(50),
    NOME_MOTOR VARCHAR(50),
    NF INTEGER,
    ALIQUOTA_ISS NUMERIC(18,4),
    CONTADOR_TOTAL NUMERIC(18,4),
    CONTADOR_COR NUMERIC(18,4),
    CONTADOR_PRETO NUMERIC(18,4),
    CONTADOR_CILINDRO NUMERIC(18,4),
    CONTADOR_REVELADOR NUMERIC(18,4),
    CONTADOR_IMPRESSAO NUMERIC(18,4),
    DEFEITO_RECLAMADO VARCHAR(50),
    TIPO_ATENDIMENTO VARCHAR(50),
    CONDICAO_FINAL_EQUIPAMENTO VARCHAR(50),
    CAUSA_CHAMADO VARCHAR(200))
AS
DECLARE VARIABLE CONT INTEGER;
DECLARE VARIABLE CODIGO_DEFEITO INTEGER;
begin
     CONT = 0;

     for select
         codigo, data, pessoa_fj, nome,
         natureza, mecanico, viajante, entrada,
         historico, chassi, total, desc_acresc,
         cliente, fechado, nome_natureza,
         nome_mecanico, nome_viajante, nome_motor,
         nf, aliquota_iss, motor, enviada_caixa,
         contador_total, contador_cilindro, contador_revelador,
         contador_cor, contador_preto, contador_impressao, cliente,
         defeito_reclamado, tipo_atendimento, condicao_final_equipamento,
         causa_chamado
     from ofc_ordem_servico o
     where pessoa_fj = :codigo_cliente and cnpj = :cnpj
     and propriedade = :propriedade and codigo < :cod_atual
     order by codigo desc
     into
         :codigo, :data, :pessoa_fj, :nome,
         :natureza, :mecanico, :viajante, :entrada,
         :historico, :chassi, :total, :desc_acresc,
         :cliente, :fechado, :nome_natureza,
         :nome_mecanico, :nome_viajante, :nome_motor,
         :nf, :aliquota_iss, :motor, :enviada_cx,
         :contador_total, :contador_cilindro, :contador_revelador,
         :contador_cor, :contador_preto, :contador_impressao, :solicitante,
         :codigo_defeito, :tipo_atendimento, :condicao_final_equipamento,
         :causa_chamado
     do begin
        select nome from ofc_defeito
        where cnpj = :cnpj and codigo = :codigo_defeito
        into :defeito_reclamado;
        /*Isso impedirá que procedure pegue o próprio orçamento que está sendo inserido
        pois ele será o primeiro a ser listado*/

        suspend;

        CONT = CONT + 1;
        
        IF (CONT > 3) then
            EXIT ;

     END
END
^

ALTER PROCEDURE VER_ULTIMAS_VENDAS (
    CNPJ CHAR(14),
    CLIENTE INTEGER)
RETURNS (
    CODIGO INTEGER,
    DATA TIMESTAMP,
    DINHEIRO NUMERIC(18,4),
    CHEQUE NUMERIC(18,4),
    CARTAO NUMERIC(18,4),
    TICKET NUMERIC(18,4),
    CONVENIO NUMERIC(18,4),
    DESCONTO NUMERIC(18,4),
    TOTAL NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    NOME_PRODUTO VARCHAR(50),
    QUANTIDADE NUMERIC(18,4),
    UNITARIO NUMERIC(18,4))
AS
DECLARE VARIABLE CONT INTEGER;
begin
     CONT = 0 ;

     FOR SELECT CODIGO, DATA, DINHEIRO, CHEQUE, CARTAO, TICKET, VLR_PARC_LC,
     DESC_ACRES, TOTAL
     FROM FAT_VENDAS
     WHERE PESSOA_FJ = :CLIENTE AND CNPJ = :CNPJ
     ORDER BY CODIGO DESC
     INTO :CODIGO, :DATA, :DINHEIRO, :CHEQUE, :CARTAO, :TICKET, :CONVENIO,
     :DESCONTO, :TOTAL
     DO BEGIN
        FOR SELECT PRODUTO, NOME_PRODUTO, QUANTIDADE, PRC_UNITARIO
        FROM FAT_VENDAS_ITENS
        WHERE CODIGO = :CODIGO AND CNPJ = :CNPJ
        INTO :PRODUTO, :NOME_PRODUTO, :QUANTIDADE, :UNITARIO
        DO BEGIN

           suspend;
        END

        CONT = CONT + 1;
        
        IF ( CONT > 3 )
        then
            EXIT ;
     END
END
^

ALTER PROCEDURE VER_VARIACOES_VENDA (
    CNPJ CHAR(14),
    DATAINI DATE,
    DATAFIM DATE)
RETURNS (
    CODIGO INTEGER,
    DESCONTO NUMERIC(18,4),
    ICM NUMERIC(18,4),
    ICM_SUBS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    PESO NUMERIC(18,4),
    PORC_DESC NUMERIC(18,4),
    PRC_CUSTO NUMERIC(18,4),
    PRC_UNIT_ORIGINAL NUMERIC(18,4),
    PRC_UNITARIO NUMERIC(18,4),
    PRODUTO VARCHAR(15),
    GRUPO INTEGER,
    PRODUTOFIS VARCHAR(15),
    QUANTIDADE NUMERIC(18,4),
    SEQUENCIA INTEGER,
    UNIDADE CHAR(4),
    SUBUNIDADE INTEGER,
    VOLUME NUMERIC(18,4),
    NOME_PRODUTO VARCHAR(50),
    NOME_FIS VARCHAR(50),
    ALIQUOTA CHAR(3),
    ORIGEM INTEGER,
    CTE INTEGER,
    CTIE INTEGER,
    REDUCAO INTEGER,
    DATA DATE,
    VENDEDOR INTEGER,
    NOME_VENDEDOR VARCHAR(50),
    VARIACAO NUMERIC(18,4))
AS
DECLARE VARIABLE TOTAL NUMERIC(18,4);
DECLARE VARIABLE DESC_ACREC NUMERIC(18,4);
DECLARE VARIABLE REPRESENTA NUMERIC(18,4);
DECLARE VARIABLE RAT_DESCONTO NUMERIC(18,4);
BEGIN
     for select vd.codigo, data,coalesce(vd.total,0), coalesce(vd.desc_acres,0) from fat_vendas vd
     inner join est_natureza nat on (vd.natureza = nat.codigo and nat.cnpj = vd.cnpj)
     where vd.cnpj = :cnpj and (vd.data between :dataini and :datafim) and fechada = 'S'
     and nat.es = 'S' and nat.computa_venda = 'S'
     into :codigo, :data, :total, :desc_acrec
     do begin
        for select
            produto, sequencia, quantidade, coalesce(prc_unitario,0),coalesce(prc_custo,0), icm,
            icm_subs, ipi, volume, peso, coalesce(desconto,0), porc_desc, unidade, prc_unit_original,
            aliquota, produtofis, nome_fis, cte, ctie, origem, reducao,
            subunidade
            from fat_vendas_itens vdi
            where cnpj = :cnpj and codigo = :codigo
            into :produto, :sequencia, :quantidade, :prc_unitario, :prc_custo,
             :icm, :icm_subs, :ipi, :volume, :peso, :desconto, :porc_desc, :unidade,
             :prc_unit_original, :aliquota, :produtofis, :nome_fis,
             :cte, :ctie, :origem, :reducao, :subunidade
        do
        begin
           select nome, grupo, prd.prc_venda
           from est_produtos prd
           where cnpj = :cnpj and codigo = :produto
           into :nome_produto, :grupo, :prc_unit_original;

           /*Deescobrindo o quanto o item representa no total*/
           representa = (((:prc_unitario - :desconto) * :quantidade) * 100.00)/:total;
           /*Descobrindo quanto do desconto é do item*/
           rat_desconto = (:desc_acrec * :representa)/100.00;
           /*dividindo pela qtde pra saber o descto rat, individual*/
           rat_desconto = (:rat_desconto / :quantidade);

           prc_unitario = (:prc_unitario - :desconto) + :rat_desconto;

           /* calcula a varicao */
           if (:prc_unit_original > 0) then
             variacao = (:prc_unitario * 100) / :prc_unit_original;
           else
             variacao = 0 ;
        

        
           SUSPEND;
        END
     END
END
^

ALTER PROCEDURE VER_VEICULOS (
    CNPJ CHAR(14))
RETURNS (
    CODIGO INTEGER,
    PESSOA_FJ INTEGER,
    TIPO_VEICULO INTEGER,
    NOME_TIPO VARCHAR(50),
    MARCA_VEICULO INTEGER,
    NOME_MARCA VARCHAR(50),
    MODELO VARCHAR(15),
    NOME VARCHAR(50))
AS
BEGIN
     FOR SELECT
             CODIGO, PESSOA_FJ, TIPO_VEICULO, MARCA_VEICULO, MODELO
      FROM GLO_VEICULOS
      WHERE CNPJ = :CNPJ
      INTO
          :CODIGO, :PESSOA_FJ, :TIPO_VEICULO, :MARCA_VEICULO, :MODELO
      DO BEGIN
         SELECT NOME_RAZAO
         FROM GLO_PESSOAS_FJ
         WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA_FJ
         INTO :NOME ;
         
         SELECT NOME
         FROM GLO_MARCA_VEICULOS
         WHERE CNPJ = :CNPJ AND CODIGO = :MARCA_VEICULO
         INTO :NOME_MARCA ;

         SELECT NOME
         FROM GLO_TIPO_VEICULOS
         WHERE CNPJ = :CNPJ AND CODIGO = :TIPO_VEICULO
         INTO :NOME_TIPO ;

         SUSPEND;
      END
END
^

ALTER PROCEDURE VER_VENDA_CF (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    VENDA INTEGER)
AS
begin
     SELECT CODIGO FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND NUM_CUPOM = :CODIGO
     INTO :VENDA ;

     suspend;
END
^

ALTER PROCEDURE VER_VENDAS (
    CNPJ CHAR(14),
    TP CHAR(1))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA DATE,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_NF_XML VARCHAR(8),
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CARGA INTEGER,
    CANCELADA CHAR(1),
    SERIE CHAR(3),
    SELECIONADA CHAR(1),
    STATUS_CARREGAMENTO INTEGER,
    ORDEM_CARGA INTEGER,
    PSA_ATIVIDADE INTEGER,
    PSA_BAIRRO INTEGER,
    PSA_CELULAR VARCHAR(20),
    PSA_CEP VARCHAR(8),
    PSA_CIDADE INTEGER,
    PSA_COMPLEMENTO VARCHAR(30),
    PSA_CONTATO VARCHAR(30),
    PSA_CONVENIO INTEGER,
    PSA_CPF_CGC VARCHAR(15),
    PSA_DT_CADASTRO TIMESTAMP,
    PSA_DT_NASCIMENTO TIMESTAMP,
    PSA_EMISSOR VARCHAR(6),
    PSA_ENDERECO INTEGER,
    PSA_FANTASIA VARCHAR(50),
    PSA_FAX VARCHAR(20),
    PSA_FONE VARCHAR(20),
    PSA_INSC_MUNIC VARCHAR(15),
    PSA_NOME_RAZAO VARCHAR(50),
    PSA_NUMERO VARCHAR(15),
    PSA_PESSOA CHAR(1),
    PSA_RG_IE VARCHAR(15),
    PSA_UF CHAR(2),
    LGD_NOME VARCHAR(50),
    BAI_NOME VARCHAR(50),
    CID_NOME VARCHAR(50),
    ID_AGRUPADOR INTEGER,
    ENTREGA_FUTURA CHAR(1),
    ATI_NOME VARCHAR(50),
    REG_NOME VARCHAR(50),
    PSA_EMAIL VARCHAR(80),
    PCT_COMISSAO NUMERIC(18,4),
    HORA TIME,
    NFE_CHAVE VARCHAR(80),
    NFE_SELECIONADO CHAR(1),
    NFE_VALIDADA CHAR(1),
    NFE_ASSINADA CHAR(1),
    NFE_TRANSMITIDA CHAR(1),
    NFE_AUTORIZADA CHAR(1),
    NFE_DANFE_IMPRESSO CHAR(1),
    N_SEQ_ECF CHAR(3),
    N_SERIE_ECF CHAR(20),
    NFE_PROTOCOLO CHAR(200),
    NFE_RECIBO CHAR(200),
    NFE_XML BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    CONT_CARTAO INTEGER,
    CONT_CHEQUE INTEGER,
    VD_CHEQUE FLOAT,
    VD_CARTAO FLOAT,
    VD_DINHEIRO FLOAT,
    VD_ENTRADA FLOAT,
    DIVERG_CARTAO FLOAT,
    DIVERG_CHEQUE FLOAT,
    DT_EMISSAO_NF DATE,
    NFE_IMPRESSAO CHAR(1))
AS
DECLARE VARIABLE INICIO INTEGER;
DECLARE VARIABLE TAMANHO INTEGER;
DECLARE VARIABLE TOTAL_CHEQUE FLOAT;
DECLARE VARIABLE TOTAL_CARTAO FLOAT;
BEGIN

     FOR SELECT pessoa_fj, nome, codigo, data, total, desc_acres,
         fechada, historico, vendedor, usuario, data_caixa, conta_caixa,
         num_nf, num_cupom, natureza, tipo_venda,
         nome_consumidor, substring(observacao from 1 for 200), orcamento, local, enviada_cx, cancelada,
         base_icm, icm, base_icm_subst, valor_icm_subst, frete, seguro,
         despesas, ipi, total_nota, carga, vd.serie,coalesce(selecionada,'N'), status_carregamento,
         ordem_carga, id_agrupador, entrega_futura,pct_comissao, hora,
         substring( NFE_XML FROM 182 FOR 44) ,
        NFE_SELECIONADO        ,
        NFE_VALIDADA           ,
        NFE_ASSINADA           ,
        NFE_TRANSMITIDA        ,
        NFE_AUTORIZADA         ,
        NFE_DANFE_IMPRESSO     ,
        N_SEQ_ECF              ,
        N_SERIE_ECF,
        NFE_PROTOCOLO,
        NFE_RECIBO,
        NFE_XML,
        vd.cheque,
        vd.cartao,
        vd.dinheiro,
        vd.entrada,
        vd.DT_EMISSAO_NF,
        coalesce(s.nfe_impressao,'S')
              FROM FAT_VENDAS vd
              left join sis_serienf s on (s.cnpj = vd.cnpj and s.serie = vd.serie)
     WHERE (vd.CNPJ = :CNPJ) AND (FECHADA = :TP OR '0' = :TP) AND (coalesce(CANCELADA,'N') = 'N')
     INTO
         :PESSOA_FJ, :NOME, :CODIGO, :DATA, :TOTAL, :DESC_ACRES,
         :FECHADA, :HISTORICO, :VENDEDOR, :USUARIO, :DATA_CAIXA, :CONTA_CAIXA,
         :NUM_NF, :NUM_CUPOM, :NATUREZA, :TIPO_VENDA,
         :NOME_CONSUMIDOR, :OBSERVACAO, :ORCAMENTO, LOCAL, :ENVIADA_CX, :CANCELADA,
         :BASE_ICM, :ICM, :BASE_ICM_SUBST, :VALOR_ICM_SUBST, :FRETE, :SEGURO,
         :DESPESAS, :IPI, :TOTAL_NOTA, :CARGA, :SERIE, :SELECIONADA, :STATUS_CARREGAMENTO,
         :ordem_carga, :id_agrupador, :entrega_futura, :pct_comissao, :hora,
         :NFE_CHAVE ,
         :NFE_SELECIONADO        ,
         :NFE_VALIDADA           ,
         :NFE_ASSINADA           ,
         :NFE_TRANSMITIDA        ,
         :NFE_AUTORIZADA         ,
         :NFE_DANFE_IMPRESSO     ,
         :N_SEQ_ECF              ,
         :N_SERIE_ECF,
         :NFE_PROTOCOLO,
         :NFE_RECIBO,
         :NFE_XML,
         :VD_CHEQUE,
         :VD_CARTAO,
         :VD_DINHEIRO,
         :VD_ENTRADA,
         :dt_emissao_nf,
         :NFE_IMPRESSAO
     DO BEGIN
        vd_cartao = coalesce(:vd_cartao,0);
        vd_cheque = coalesce(:vd_cheque,0);

        /* CLIENTE */
        select count(*) from fin_movimento_cartao ctr
        where ctr.cnpj = :cnpj and ctr.venda = :codigo
        into :cont_cartao;


        select count(*) from fin_cheques ch
        where ch.cnpj = :cnpj and ch.venda = :codigo
        into :cont_cheque;

        select sum(valor) from fin_movimento_cartao ctr
        where ctr.cnpj = :cnpj and ctr.venda = :codigo
        into :total_cartao;
        total_cartao = coalesce(:total_cartao,0);


        select sum(valor) from fin_cheques ch
        where ch.cnpj = :cnpj and ch.venda = :codigo
        into :total_cheque;
        total_cheque = coalesce(:total_cheque,0);


        /*Avaliando se há divergencia nos valores de cartão, no entanto por questão de arredondamento só sera considerada se for superior a 1 */
        diverg_cartao = (:vd_cartao - :total_cartao);
        if (diverg_cartao < 0) then
          diverg_cartao = :diverg_cartao * -1;

        if (diverg_cartao < 1) then
          diverg_cartao = 0;


       /*Avaliando se há divergencia nos valores de cheque, no entanto por questão de arredondamento só sera considerada se for superior a 1  */
        diverg_cheque = (:vd_cheque - :total_cheque);
        if (diverg_cheque < 0) then
          diverg_cheque = :diverg_cheque * -1;

        if (diverg_cheque < 1) then
          diverg_cheque = 0;


        select * from GETLENGTH(:num_nf)
        into :tamanho;
        if (:tamanho = 1) then
          inicio = 224;
        if (:tamanho = 2) then
          inicio = 223;
        else if (:tamanho = 3) then
          inicio = 222;
        else if (:tamanho = 4) then
          inicio = 221;
        else if (:tamanho = 5) then
          inicio = 220;
        else if (:tamanho = 6) then
          inicio = 219;


        select coalesce(substring(vd.nfe_xml from :inicio for :tamanho) ,'0') from fat_vendas vd
        where vd.cnpj = :cnpj and vd.codigo = :codigo
        into :num_nf_xml;



        select psa.atividade,psa.bairro,psa.celular,psa.cep,psa.cidade,psa.complemento,
        psa.contato,psa.convenio ,psa.cpf_cgc,psa.dt_cadastro,psa.dt_nascimento,psa.emissor,
        psa.endereco,psa.fantasia,psa.fax,psa.fone,psa.insc_munic,psa.nome_razao,psa.numero,
        psa.pessoa,substring(psa.rg_ie from 1 for 15),psa.uf,
        lgd.nome, bai.nome, cid.nome, ati.nome, reg.nome, psa.email
        from glo_pessoas_fj psa
        left join glo_logradouros lgd on (lgd.codigo = psa.endereco and lgd.cnpj = psa.cnpj)
        left join glo_bairros bai on (psa.bairro = bai.codigo and bai.cnpj = psa.cnpj)
        left join glo_cidades cid on (psa.cidade = cid.codigo and cid.cnpj = psa.cnpj)
        left join glo_atividades ati on (ati.codigo = psa.atividade and psa.cnpj = ati.cnpj )
        left join glo_regioes reg on (reg.codigo = psa.regiao and psa.cnpj = reg.cnpj)
        where psa.codigo = :pessoa_fj and psa.cnpj = :cnpj
        into psa_atividade,psa_bairro,psa_celular,psa_cep,psa_cidade,psa_complemento,
        psa_contato,psa_convenio,psa_cpf_cgc,psa_dt_cadastro,psa_dt_nascimento,psa_emissor,
        psa_endereco,psa_fantasia,psa_fax,psa_fone,psa_insc_munic,psa_nome_razao,psa_numero,psa_pessoa,:psa_rg_ie,psa_uf,
        lgd_nome, bai_nome, cid_nome, ati_nome, reg_nome, psa_email;

        /* VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDOR AND CNPJ = :CNPJ
        INTO :NOMEVENDEDOR ;

        /* NATUREZA */
        SELECT NOME FROM EST_NATUREZA
        WHERE CODIGO = :NATUREZA AND CNPJ = :CNPJ
        INTO :NOMENATUREZA ;

        VLR_TOTAL = :TOTAL + :DESC_ACRES ;
        
        SUSPEND;
    END
END
^

ALTER PROCEDURE VER_VENDAS_CLIENTE (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    VD_CODIGO INTEGER,
    VD_DATA TIMESTAMP,
    VD_FECHADA CHAR(1),
    VD_HISTORICO VARCHAR(100),
    VD_PESSOA_FJ INTEGER,
    VD_PESSOA_RAZAO VARCHAR(50),
    VD_USUARIO INTEGER,
    VD_NATUREZA INTEGER,
    VD_NOME_NATUREZA VARCHAR(50),
    VD_ENVIADA_CX CHAR(1),
    VD_FORMA_PGTO INTEGER,
    VD_NUM_NF INTEGER,
    VD_NUM_CUPOM INTEGER,
    VD_PROPRIEDADE INTEGER,
    VD_CONVENIADO INTEGER,
    VD_TIPO_DOCTO CHAR(3),
    VD_LOCAL_COBRANCA INTEGER,
    VD_DESC_ACRES NUMERIC(18,4),
    VD_ENTRADA NUMERIC(18,4),
    VD_DINHEIRO NUMERIC(18,4),
    VD_CHEQUE NUMERIC(18,4),
    VD_CARTAO NUMERIC(18,4),
    VD_TICKET NUMERIC(18,4),
    VD_TOTAL NUMERIC(18,4),
    VD_VLRLIQUIDO NUMERIC(18,4),
    VD_OBSERVACAO VARCHAR(200),
    VD_VLR_PARC_LC NUMERIC(18,4),
    VD_TERCEIRO INTEGER,
    VD_CARGA INTEGER,
    VD_VOLUME NUMERIC(18,4),
    VD_PESO NUMERIC(18,4),
    VD_REQUISICAO VARCHAR(6),
    VD_DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    VD_TIPO_VENDA CHAR(3),
    VD_NOME_CONSUMIDOR VARCHAR(50),
    VD_ORCAMENTO INTEGER,
    VD_VENDEDO INTEGER,
    VD_NOME_VENDEDOR VARCHAR(50),
    VD_FAT_VINCULADO INTEGER,
    DEV_CODIGO INTEGER,
    DEV_DATA TIMESTAMP,
    DEV_FECHADA CHAR(1),
    DEV_HISTORICO VARCHAR(100),
    DEV_PESSOA_FJ INTEGER,
    DEV_PESSOA_RAZAO VARCHAR(50),
    DEV_USUARIO INTEGER,
    DEV_NATUREZA INTEGER,
    DEV_NOME_NATUREZA VARCHAR(50),
    DEV_ENVIADA_CX CHAR(1),
    DEV_FORMA_PGTO INTEGER,
    DEV_NUM_NF INTEGER,
    DEV_NUM_CUPOM INTEGER,
    DEV_PROPRIEDADE INTEGER,
    DEV_CONVENIADO INTEGER,
    DEV_TIPO_DOCTO CHAR(3),
    DEV_LOCAL_COBRANCA INTEGER,
    DEV_DESC_ACRES NUMERIC(18,4),
    DEV_ENTRADA NUMERIC(18,4),
    DEV_DINHEIRO NUMERIC(18,4),
    DEV_CHEQUE NUMERIC(18,4),
    DEV_CARTAO NUMERIC(18,4),
    DEV_TICKET NUMERIC(18,4),
    DEV_TOTAL NUMERIC(18,4),
    DEV_VLRLIQUIDO NUMERIC(18,4),
    DEV_OBSERVACAO VARCHAR(200),
    DEV_VLR_PARC_LC NUMERIC(18,4),
    DEV_TERCEIRO INTEGER,
    DEV_CARGA INTEGER,
    DEV_VOLUME NUMERIC(18,4),
    DEV_PESO NUMERIC(18,4),
    DEV_REQUISICAO VARCHAR(6),
    DEV_DESCRICAO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
    DEV_TIPO_VENDA CHAR(3),
    DEV_NOME_CONSUMIDOR VARCHAR(50),
    DEV_ORCAMENTO INTEGER,
    DEV_VENDEDO INTEGER,
    DEV_NOME_VENDEDOR VARCHAR(50))
AS
BEGIN
         FOR SELECT VD.CODIGO, VD.DATA_CAIXA, VD.FECHADA, VD.HISTORICO, VD.PESSOA_FJ, VD.USUARIO, VD.VENDEDOR,
                VD.NATUREZA, VD.ENVIADA_CX, VD.FORMA_PGTO, VD.NUM_NF, VD.NUM_CUPOM, VD.PROPRIEDADE,
                VD.CONVENIADO, VD.TIPO_DOCTO, VD.LOCAL_COBRANCA, VD.DESC_ACRES, VD.ENTRADA, VD.DINHEIRO,
                VD.CHEQUE, VD.CARTAO, VD.TICKET, VD.TOTAL, substring(vd.observacao from 1 for 200), VD.VLR_PARC_LC, VD.TERCEIRO,
                VD.CARGA, VD.VOLUME,PESO,VD.REQUISICAO,VD.DESCRICAO,VD.TIPO_VENDA,VD.NOME_CONSUMIDOR,
                VD.ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID, VD.ID_AGRUPADOR
         FROM FAT_VENDAS vd
         inner join est_natureza nat on (vd.natureza = nat.codigo and vd.cnpj = nat.cnpj)
         WHERE DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND vd.CNPJ = :CNPJ
         AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
         AND PESSOA_FJ = :PESSOA and nat.es = 'S'
         AND VD.CODIGO = 17783
         INTO  :VD_CODIGO,:VD_DATA,:VD_FECHADA,:VD_HISTORICO,:VD_PESSOA_FJ,
               :VD_USUARIO,:VD_VENDEDO,:VD_NATUREZA,:VD_ENVIADA_CX,:VD_FORMA_PGTO,
               :VD_NUM_NF,:VD_NUM_CUPOM,:VD_PROPRIEDADE,:VD_CONVENIADO,:VD_TIPO_DOCTO,
               :VD_LOCAL_COBRANCA,:VD_DESC_ACRES,:VD_ENTRADA,:VD_DINHEIRO,
               :VD_CHEQUE,:VD_CARTAO,:VD_TICKET,:VD_TOTAL,:VD_OBSERVACAO,:VD_VLR_PARC_LC,
               :VD_TERCEIRO,:VD_CARGA,:VD_VOLUME,:VD_PESO,:VD_REQUISICAO,:VD_DESCRICAO,
               :VD_TIPO_VENDA,:VD_NOME_CONSUMIDOR,:VD_ORCAMENTO, :VD_VLRLIQUIDO, :VD_FAT_VINCULADO

         DO BEGIN
             SELECT NOME_RAZAO
             FROM GLO_PESSOAS_FJ
             WHERE CNPJ = :CNPJ AND CODIGO = :VD_PESSOA_FJ
             PLAN (GLO_PESSOAS_FJ ORDER GLO_PESSOAS_FJ_CODIGO)
             ORDER BY CNPJ, CODIGO
             INTO :VD_PESSOA_RAZAO;

              SELECT NOME
              FROM EST_NATUREZA
              WHERE CNPJ = :CNPJ AND CODIGO = :VD_NATUREZA
              INTO :VD_NOME_NATUREZA;

              SELECT NOME
              FROM FAT_VENDEDOR
              WHERE CODIGO = :VD_VENDEDO
              INTO :VD_NOME_VENDEDOR;

              SUSPEND;

              FOR SELECT DEV.CODIGO, DEV.DATA_CAIXA, DEV.FECHADA, DEV.HISTORICO, DEV.PESSOA_FJ, DEV.USUARIO, DEV.VENDEDOR,
                    DEV.NATUREZA, DEV.ENVIADA_CX, DEV.FORMA_PGTO, DEV.NUM_NF, DEV.NUM_CUPOM, DEV.PROPRIEDADE,
                    DEV.CONVENIADO, DEV.TIPO_DOCTO, DEV.LOCAL_COBRANCA, DEV.DESC_ACRES, DEV.ENTRADA, DEV.DINHEIRO,
                    DEV.CHEQUE, DEV.CARTAO, DEV.TICKET, DEV.TOTAL, substring(dev.observacao from 1 for 200), DEV.VLR_PARC_LC, DEV.TERCEIRO,
                    DEV.CARGA, DEV.VOLUME,PESO,DEV.REQUISICAO,DEV.DESCRICAO,DEV.TIPO_VENDA,DEV.NOME_CONSUMIDOR,
                    DEV.ORCAMENTO, (TOTAL + DESC_ACRES) AS VALOR_LIQUID
              FROM FAT_VENDAS DEV
              inner join est_natureza nat on (DEV.natureza = nat.codigo and DEV.cnpj = nat.cnpj)
              WHERE DEV.CNPJ = :CNPJ AND FECHADA = 'S' AND ENVIADA_CX = 'S' AND ((CANCELADA <> 'S') OR (CANCELADA IS NULL))
              AND PESSOA_FJ = :PESSOA and nat.es = 'E' AND DEV.id_agrupador = :VD_CODIGO
              INTO  :DEV_CODIGO,:DEV_DATA,:DEV_FECHADA,:DEV_HISTORICO,:DEV_PESSOA_FJ,
                   :DEV_USUARIO,:DEV_VENDEDO,:DEV_NATUREZA,:DEV_ENVIADA_CX,:DEV_FORMA_PGTO,
                   :DEV_NUM_NF,:DEV_NUM_CUPOM,:DEV_PROPRIEDADE,:DEV_CONVENIADO,:DEV_TIPO_DOCTO,
                   :DEV_LOCAL_COBRANCA,:DEV_DESC_ACRES,:DEV_ENTRADA,:DEV_DINHEIRO,
                   :DEV_CHEQUE,:DEV_CARTAO,:DEV_TICKET,:DEV_TOTAL,:DEV_OBSERVACAO,:DEV_VLR_PARC_LC,
                   :DEV_TERCEIRO,:DEV_CARGA,:DEV_VOLUME,:DEV_PESO,:DEV_REQUISICAO,:DEV_DESCRICAO,
                   :DEV_TIPO_VENDA,:DEV_NOME_CONSUMIDOR,:DEV_ORCAMENTO, :DEV_VLRLIQUIDO
              DO BEGIN


              SUSPEND;
              END


         END /* FATURAS */
END
^

ALTER PROCEDURE VER_VENDAS_MESAS_ABERTAS (
    CNPJ CHAR(14),
    MESA INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
    SELECT MIN (CODIGO)
    FROM FAT_VENDAS
    WHERE CNPJ = :CNPJ AND MESA = :MESA
    AND ENVIADA_CX = 'N' AND FECHADA = 'N' AND CANCELADA <> 'S'
    INTO :CODIGO;

    SUSPEND;
END
^

ALTER PROCEDURE VER_VENDAS_TOTAIS (
    CNPJ CHAR(14))
RETURNS (
    PESSOA_FJ INTEGER,
    NOME VARCHAR(50),
    CODIGO INTEGER,
    DATA TIMESTAMP,
    TOTAL NUMERIC(18,4),
    FECHADA CHAR(1),
    HISTORICO VARCHAR(100),
    VENDEDOR INTEGER,
    NOMEVENDEDOR VARCHAR(50),
    USUARIO INTEGER,
    DATA_CAIXA TIMESTAMP,
    CONTA_CAIXA INTEGER,
    NUM_NF INTEGER,
    NUM_CUPOM INTEGER,
    NATUREZA INTEGER,
    NOMENATUREZA VARCHAR(50),
    TIPO_VENDA CHAR(3),
    NOME_CONSUMIDOR VARCHAR(50),
    VLR_TOTAL NUMERIC(18,4),
    DESC_ACRES NUMERIC(18,4),
    OBSERVACAO VARCHAR(200),
    ORCAMENTO INTEGER,
    LOCAL INTEGER,
    ENVIADA_CX CHAR(1),
    BASE_ICM NUMERIC(18,4),
    ICM NUMERIC(18,4),
    BASE_ICM_SUBST NUMERIC(18,4),
    VALOR_ICM_SUBST NUMERIC(18,4),
    FRETE NUMERIC(18,4),
    SEGURO NUMERIC(18,4),
    DESPESAS NUMERIC(18,4),
    IPI NUMERIC(18,4),
    TOTAL_NOTA NUMERIC(18,4),
    CANCELADA CHAR(1))
AS
BEGIN
     FOR SELECT
         PESSOA_FJ, NOME, CODIGO, DATA, TOTAL, DESC_ACRES,
         FECHADA, HISTORICO, VENDEDOR, USUARIO, DATA_CAIXA, CONTA_CAIXA,
         NUM_NF, NUM_CUPOM, NATUREZA, TIPO_VENDA,
         NOME_CONSUMIDOR, substring(observacao from 1 for 200), ORCAMENTO, LOCAL, ENVIADA_CX, CANCELADA,
         BASE_ICM, ICM, BASE_ICM_SUBST, VALOR_ICM_SUBST, FRETE, SEGURO,
         DESPESAS, IPI, TOTAL_NOTA
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND FECHADA = 'S'
     INTO
         :PESSOA_FJ, :NOME, :CODIGO, :DATA, :TOTAL, :DESC_ACRES,
         :FECHADA, :HISTORICO, :VENDEDOR, :USUARIO, :DATA_CAIXA, :CONTA_CAIXA,
         :NUM_NF, :NUM_CUPOM, :NATUREZA, :TIPO_VENDA,
         :NOME_CONSUMIDOR, :OBSERVACAO, :ORCAMENTO, :LOCAL, :ENVIADA_CX, :CANCELADA,
         :BASE_ICM, :ICM, :BASE_ICM_SUBST, :VALOR_ICM_SUBST, :FRETE, :SEGURO,
         :DESPESAS, :IPI, :TOTAL_NOTA
     DO BEGIN
        /* VENDEDOR */
        SELECT NOME FROM FAT_VENDEDOR
        WHERE CODIGO = :VENDEDOR AND CNPJ = :CNPJ
        INTO :NOMEVENDEDOR ;

        /* NATUREZA */
        SELECT NOME FROM EST_NATUREZA
        WHERE CODIGO = :NATUREZA AND CNPJ = :CNPJ
        INTO :NOMENATUREZA ;

        VLR_TOTAL = :TOTAL + :DESC_ACRES ;
        
        SUSPEND;
    END
END
^

ALTER PROCEDURE VER_VENDAS_VENDEDOR_ABERTAS (
    CNPJ CHAR(14),
    VENDEDOR INTEGER)
RETURNS (
    CODIGO INTEGER)
AS
BEGIN
     SELECT MIN (CODIGO)
     FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND VENDEDOR = :VENDEDOR
     AND ENVIADA_CX = 'N' AND FECHADA = 'N' AND CANCELADA <> 'S'
     INTO :CODIGO;

     SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_APLICACAO (
    CNPJ VARCHAR(14),
    NOME VARCHAR(50))
RETURNS (
    TAG INTEGER)
AS
BEGIN
  /*  */
  SELECT CODIGO
  FROM EST_APLICACOES
  WHERE CNPJ = :CNPJ AND
        NOME = :NOME
  INTO :TAG;
  /*  */
  IF (:TAG IS NULL) THEN
     TAG = 0;
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_CAIXA (
    CNPJ VARCHAR(20),
    USUARIO INTEGER,
    CONTA INTEGER,
    DATA DATE,
    TURNO INTEGER)
RETURNS (
    ESTADO VARCHAR(1))
AS
BEGIN
     SELECT FECHADO
     FROM FAT_CAIXAS
     WHERE
     CNPJ = :CNPJ AND
     USUARIO = :USUARIO AND
     CONTA = :CONTA AND
     DATA = :DATA AND
     TURNO = :TURNO
     INTO :ESTADO ;
     
     SUSPEND ;
END
^

ALTER PROCEDURE VERIFICA_CAIXA_ABERTO (
    CNPJ VARCHAR(20),
    DATA DATE)
RETURNS (
    QUANTIDADE INTEGER)
AS
BEGIN
     SELECT COUNT(FECHADO)
     FROM FAT_CAIXAS
     WHERE
     CNPJ = :CNPJ AND
     DATA = :DATA AND
     FECHADO <> 'S' AND
     TURNO <> 99
     INTO :QUANTIDADE ;

     QUANTIDADE = 0;
     
     SUSPEND ;
END
^

ALTER PROCEDURE VERIFICA_CAIXA_RESUMO (
    CNPJ CHAR(14))
RETURNS (
    DATA DATE)
AS
DECLARE VARIABLE CONT INTEGER;
BEGIN
     SELECT MAX(DATA), COUNT(DATA)
     FROM FAT_CAIXAS_RESUMO
     WHERE ( CNPJ = :CNPJ )  AND ( FECHADO = 'N' )
     INTO :DATA , :CONT ;

     IF (( DATA IS NULL ) OR ( CONT = 0 ))
     THEN      
         DATA = '01/01/1900';

     SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_CPF (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
DECLARE VARIABLE CPF_CGC VARCHAR(15);
begin
     SELECT CPF_CGC
     FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA
     ORDER BY CNPJ, CODIGO
     INTO :CPF_CGC ;

     IF (( CPF_CGC IS NULL ) OR ( CPF_CGC = '' ))
     THEN BEGIN
          VERIFICA = 'N' ;
     END
     ELSE BEGIN
          VERIFICA = 'S' ;
     END

     SUSPEND ;
END
^

ALTER PROCEDURE VERIFICA_DESCTOITEM (
    CNPJ VARCHAR(18),
    PRODUTO VARCHAR(15),
    CLIENTE INTEGER,
    VALOR NUMERIC(18,4),
    VENDEDOR INTEGER)
RETURNS (
    VALIDO CHAR(1))
AS
DECLARE VARIABLE VLR_ORIGINAL NUMERIC(18,4);
DECLARE VARIABLE VLR_ESPECIAL NUMERIC(18,4);
DECLARE VARIABLE VLR_DIFERENCIADO NUMERIC(18,4);
DECLARE VARIABLE VLR_PROMOCAO NUMERIC(18,4);
DECLARE VARIABLE DESCTO_MAX NUMERIC(18,4);
DECLARE VARIABLE DESCTO_PROD NUMERIC(18,4);
DECLARE VARIABLE TOTAL_DESCONTO NUMERIC(18,4);
DECLARE VARIABLE TBL_DESC_MAX NUMERIC(18,4);
DECLARE VARIABLE PCT_DESCTO NUMERIC(18,4);
DECLARE VARIABLE GRUPO INTEGER;
DECLARE VARIABLE SUBGRUPO INTEGER;
DECLARE VARIABLE EXIBE_TBL CHAR(1);
begin
  /* Procedure Text */
  valido = 'N';
  select prd.prc_venda, prd.grupo, prd.subgrupo from est_produtos prd
  where prd.cnpj = :cnpj and prd.codigo = :produto
  into :vlr_original, :grupo, :subgrupo;

  select coalesce(e.exibe_tbl,'N') from sis_empresas e
  where e.cnpj = :cnpj
  into :exibe_tbl;

  if ((exibe_tbl = 'S') and (coalesce(:VENDEDOR,0) > 0 )) then
  begin
    vlr_original = null;
    select itbl.valor, coalesce(itbl.descontomaximo,0) from fat_itemtabelapreco itbl
    inner join fat_tabelapreco tbl on (tbl.cnpj = itbl.cnpj and itbl.cod_tabelapreco = tbl.codigo)
    /*vinculando TabelaPreco-->TabelaN<---Vendedor*/
    inner join fat_tbl_vd_tabela tvdt on (tvdt.cnpj = tbl.cnpj and tvdt.cod_tabela = tbl.codigo)
    inner join fat_tbl_vendedor tvd on (tvd.cnpj = tvdt.cnpj and tvd.codigo = tvdt.cod_tbl_vendedor)
    inner join est_produtos prd on (prd.cnpj = itbl.cnpj and prd.codigo = itbl.produto)
    where  itbl.produto = :produto and tvd.cod_vendedor = :vendedor and itbl.cnpj = :cnpj
    and (current_date between tbl.iniciovigencia and tbl.fimvigencia)
    and (current_date between itbl.datainiciovigencia and itbl.datafimvigencia)
    into :vlr_original, :tbl_desc_max;

    if (:vlr_original is null) then
     exception VALIDA_PRD_ITEM_TBL;
  end

  /*se o valor do produto for menor que o original, ou seja se houve desconto
  então faço as verificações, caso contrário retorno 'S'*/
  if (:valor < :vlr_original) then
  begin
    /*pegando o preço especial*/
    select coalesce((pre.original - ((pre.original * pre.porcentagem)/100.00)),0) from glo_precos_especiais pre
    where pre.pessoa_fj = :cliente and pre.cnpj = :cnpj and pre.produto = :produto
    into :vlr_especial;

    if (:vlr_especial is null) then
      vlr_especial = 0;

    select * from round2(:vlr_especial) into :vlr_especial;

    /*pegando o preço da promoção*/
    select coalesce(pro.valor,0) from est_promocao pro
    where pro.cnpj = :cnpj and pro.produto = :produto
    into :vlr_promocao;

    if (:vlr_promocao is null) then
      vlr_promocao = 0;

    select * from round2(:vlr_promocao) into :vlr_promocao;
    /*se os dois forem 0 então não temos preço diferenciado*/
    if ((:vlr_especial = 0) and (:vlr_promocao = 0)) then
       vlr_diferenciado = 0;
    else if (:vlr_especial = 0) then
    begin  /*estou fazendo isso, pq segundo o wendel ele poderá dar descto em cima do preço de promoção*/
      vlr_diferenciado = :vlr_promocao;
      vlr_original = :vlr_promocao;
    end
    else if (:vlr_promocao = 0) then
      vlr_diferenciado = :vlr_especial;
    else if ((:vlr_especial > 0) and (:vlr_especial <= :vlr_promocao)) then
       vlr_diferenciado = :vlr_especial;
    else if ((:vlr_promocao > 0) and (:vlr_especial > :vlr_promocao)) then
    begin
       vlr_diferenciado = :vlr_promocao;
       vlr_original = :vlr_promocao;
    end

    /*se o preço for maior que preço diferenciado e o especial existir retorno 'S'*/
    if ((coalesce(:vlr_diferenciado,0) <= :valor) and (coalesce(:vlr_diferenciado,0) > 0))then
      valido = 'S';
    else
    begin 
      total_desconto = (:vlr_original - :valor);
      select * from round2(:total_desconto) into :total_desconto;
      pct_descto = (:total_desconto * 100)/:vlr_original;

--      select * from round2(:pct_descto) into :pct_descto;

      descto_max = 0;
      select coalesce(emp.desconto_maximo,0) from sis_empresas emp
      where emp.cnpj = :cnpj
      into :descto_max;

      descto_prod = -1;
      select coalesce(gr.desconto_max,0) from est_subgrupos gr
      where gr.cnpj = :cnpj and gr.subgrupo = :subgrupo and gr.grupo = :grupo
      into :descto_prod;

      /* -1          Pega o desconto da empresa
          0 até 100% Pega % de desconto */
      if (:descto_prod = -1) then
        descto_prod = :descto_max;
      else
        descto_max = :descto_prod;

      if ((exibe_tbl = 'S') and (coalesce(:VENDEDOR,0) > 0 )) then
         descto_max = :tbl_desc_max;

      if (:pct_descto <= :descto_max) then
        valido = 'S';
      else
        valido = 'N';
    end
  end
  else
    valido = 'S';

  suspend;
END
^

ALTER PROCEDURE VERIFICA_DIREITO (
    EXECUTAVEL VARCHAR(30),
    OBJETO VARCHAR(30),
    PERFIL INTEGER)
RETURNS (
    DIREITO VARCHAR(300))
AS
DECLARE VARIABLE MODULO INTEGER;
DECLARE VARIABLE RESTRITO VARCHAR(1);
BEGIN

  /* LIMPANDO A VARIAVEL DIREITO */
  DIREITO = '';

  /* DESCOBRINDO O CODIGO DO MODULO */
  SELECT CODIGO, RESTRITO FROM SIS_MODULOS
  WHERE EXECUTAVEL = :EXECUTAVEL AND
        OBJETO = :OBJETO INTO :MODULO, :RESTRITO;
  
  /* SE O MODULO NÃO FOR RESTRITO */
  IF (RESTRITO = 'N') THEN
     SELECT DIREITO
     FROM SIS_DIREITOS_PERFIL
     WHERE PERFIL = :PERFIL AND
           MODULO = :MODULO INTO :DIREITO;

  /* SE O PERFIL FOR SUPERVISORES */
  IF (PERFIL = 1 AND DIREITO = '') THEN
     BEGIN
       /* RETORNA DIREITO PARA TODAS AS ACOES */
       DIREITO = 'SUPERVISOR';
       /* TCHAU */
       SUSPEND;
     END

  /* TCHAU */
  SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_EST_FISCAL_AGRUPADA (
    CNPJ VARCHAR(14),
    DINI TIMESTAMP,
    DFIM TIMESTAMP,
    PESSOA INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
DECLARE VARIABLE PRODUTO VARCHAR(15);
DECLARE VARIABLE PRODUTOFIS VARCHAR(15);
DECLARE VARIABLE QUANTIDADE NUMERIC(18,4);
DECLARE VARIABLE QTDADE_1 NUMERIC(18,4);
DECLARE VARIABLE QNTDEUNIDADE INTEGER;
DECLARE VARIABLE UNIDADE VARCHAR(4);
DECLARE VARIABLE CODIGO INTEGER;
DECLARE VARIABLE AUX NUMERIC(18,4);
BEGIN
      PROD = '';

      FOR SELECT CODIGO
      FROM FAT_VENDAS
      WHERE FECHADA = 'S' AND DATA_CAIXA >= :DINI AND DATA_CAIXA <= :DFIM AND CNPJ = :CNPJ
      AND PESSOA_FJ = :PESSOA AND CANCELADA <> 'S' AND DUPLICATA = 0 AND
      TIPO_VENDA = 'FFT' AND (( NUM_NF IS NULL ) OR ( NUM_NF <= 0 )) 
      INTO  :CODIGO DO
      BEGIN
           /* VERIFICA A QUANTIDADE FISCAL DO PRODUTO */
           FOR SELECT PRODUTO, QUANTIDADE, UNIDADE, SUBUNIDADE, PRODUTOFIS
           FROM FAT_VENDAS_ITENS
           WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
           INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE, :PRODUTOFIS
           DO BEGIN
              IF ( PRODUTOFIS <> PRODUTO )
              THEN BEGIN
                   SELECT QTDADE_1 FROM EST_PRODUTOS
                   WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTOFIS
                   INTO :QTDADE_1 ;
              END
              ELSE BEGIN
                   SELECT QTDADE_1 FROM EST_PRODUTOS
                   WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
                   INTO :QTDADE_1 ;
              END

              select * from round2(:qtdade_1) into :qtdade_1;
              select * from round2(:QUANTIDADE * :QNTDEUNIDADE) into :aux;

              IF (:QTDADE_1 < :aux)THEN
                PROD = :PRODUTO ;

           END
     
           SUSPEND;
      END
END
^

ALTER PROCEDURE VERIFICA_ESTADO_VENDA (
    CNPJ CHAR(14),
    CODIGO INTEGER)
RETURNS (
    FECHADA CHAR(1),
    NF INTEGER,
    CF INTEGER,
    DATA_CAIXA TIMESTAMP,
    ENVIADA_CX CHAR(1),
    USUARIO INTEGER,
    CONTA_CAIXA INTEGER)
AS
begin
      SELECT FECHADA, ENVIADA_CX, NUM_NF, NUM_CUPOM, DATA_CAIXA,
      CONTA_CAIXA, USUARIO
      FROM FAT_VENDAS
      WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
      ORDER BY CNPJ, CODIGO
      INTO :FECHADA, :ENVIADA_CX, :NF, :CF, :DATA_CAIXA,
      :CONTA_CAIXA, :USUARIO ;

      /* Procedure Text */
      suspend;
END
^

ALTER PROCEDURE VERIFICA_ESTOQUE (
    CNPJ VARCHAR(14),
    CODIGO INTEGER,
    TIPO INTEGER)
RETURNS (
    PROD VARCHAR(15))
AS
declare variable produto varchar(15);
declare variable produtofis varchar(15);
declare variable quantidade numeric(18,4);
declare variable qtdade numeric(18,4);
declare variable qntdeunidade integer;
declare variable unidade varchar(4);
declare variable aux numeric(18,4);
declare variable NEG_QTDADE_2 char(1);
BEGIN
     /*Procedimento sera utilizado tanto para validar estoque fisico como estoque fiscal
     se TIPO = 1 validacao estoque fiscal
     se TIPO = 2 estoque fisico*/
     PROD = '';

     /* ========[ VERIFICA A QUANTIDADE FISCAL DO PRODUTO ]===========================*/
     FOR SELECT PRODUTO, SUM(QUANTIDADE), UNIDADE, SUBUNIDADE
     FROM FAT_VENDAS_ITENS
     WHERE CNPJ = :CNPJ AND CODIGO = :CODIGO
     GROUP BY PRODUTO, UNIDADE, SUBUNIDADE
     INTO :PRODUTO, :QUANTIDADE, :UNIDADE, :QNTDEUNIDADE
     DO BEGIN
        if (:tipo = 1) then
        begin
            SELECT QTDADE_1 FROM EST_PRODUTOS
            WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
            INTO :QTDADE ;
    
    
            select * from round2(:QTDADE) into :qtdade;
            select * from round2(:QUANTIDADE * :QNTDEUNIDADE)
            into :aux;

            IF (:QTDADE  < :aux) THEN
              PROD = :PRODUTO ;
        end
        else
        begin               /*aceita estoque negativo*/
            SELECT QTDADE_2, coalesce(NEG_QTDADE_2,'S') FROM EST_PRODUTOS
            WHERE CNPJ = :CNPJ AND CODIGO = :PRODUTO
            INTO :QTDADE, :neg_qtdade_2 ;
    
            if (:neg_qtdade_2 = 'N') then
            begin
                select * from round2(:QTDADE) into :qtdade;
                select * from round2(:QUANTIDADE * :QNTDEUNIDADE)
                into :aux;
    
                IF (:QTDADE  < :aux) THEN
                  PROD = :PRODUTO ;
            end
        end

     END
     
     SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_FATURAMENTO (
    CNPJ CHAR(14),
    CODIGO INTEGER)
AS
DECLARE VARIABLE NUM INTEGER;
DECLARE VARIABLE AUX INTEGER;
begin
     AUX = 0;

     /* VERIFICA SE TEM CONTAS A RECEBER OU RECEBIDA */
     SELECT COUNT(CODIGO_VN) FROM FIN_CONTAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_VN = :CODIGO
     INTO :NUM ;

     IF ( NUM IS NULL )
     THEN
       NUM = 0;

     AUX = NUM ;

     SELECT COUNT(CODIGO_VN) FROM FIN_BAIXAS_RECEBER
     WHERE CNPJ = :CNPJ AND CODIGO_VN = :CODIGO
     INTO :NUM ;

     IF ( NUM IS NULL )
     THEN
       NUM = 0;

     AUX = AUX + NUM ;

     IF ( AUX > 0 )
     THEN
         EXCEPTION VENDA_FATURADA ;

     suspend;
END
^

ALTER PROCEDURE VERIFICA_FIN_CHEQUES (
    CNPJ CHAR(14),
    BANCO CHAR(3),
    CONTA VARCHAR(15),
    CHEQUE VARCHAR(6))
RETURNS (
    NUMERO INTEGER)
AS
BEGIN
      SELECT COUNT(*)
      FROM FIN_CHEQUES
      WHERE CNPJ = :CNPJ AND BANCO = :BANCO AND
      CONTA = :CONTA AND CHEQUE = :CHEQUE
      INTO :NUMERO ;

      SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_IE_RG (
    CNPJ VARCHAR(14),
    VENDA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
DECLARE VARIABLE PESSOA INTEGER;
DECLARE VARIABLE PROPRIEDADE INTEGER;
DECLARE VARIABLE ECF INTEGER;
DECLARE VARIABLE RG_IE VARCHAR(15);
DECLARE VARIABLE TPESSOA CHAR(1);
begin
     SELECT PESSOA_FJ, NUM_CUPOM, PROPRIEDADE FROM FAT_VENDAS
     WHERE CNPJ = :CNPJ AND CODIGO = :VENDA
     ORDER BY CNPJ, CODIGO
     INTO :PESSOA, :ECF, :PROPRIEDADE ;

     IF ( PESSOA IS NULL )
     THEN BEGIN
          PESSOA = 0 ;
     END

     IF ( ECF IS NULL )
     THEN BEGIN
          ECF = 0 ;
     END

     /*

       QDO E PESSOA JURIDICA TEM Q TER A IE

       QDO E FISICA SE HOUVER UM CUPOM IMPRESSO NAO PRECIDA DE IERG

       MAS NAO HOUVER É OBRIGATORIO

     */

     IF ( PROPRIEDADE > 0 )
     THEN BEGIN
          SELECT IE FROM GLO_PROPRIEDADES
          WHERE CNPJ = :CNPJ AND PESSOA_FJ = :PESSOA AND PROPRIEDADE = :PROPRIEDADE
          INTO :RG_IE ;

          RG_IE = RG_IE;

          IF (RG_IE = '' ) THEN
          BEGIN
               IF ( ECF = 0 )
               THEN BEGIN
                    VERIFICA = 'N';
               END
               ELSE BEGIN
                    VERIFICA = 'S';
               END
          END
          ELSE BEGIN
               VERIFICA = 'S';
          END
     END
     ELSE BEGIN
          SELECT RG_IE, PESSOA FROM GLO_PESSOAS_FJ
          WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA
          ORDER BY CNPJ, CODIGO
          INTO :RG_IE, :TPESSOA ;

          IF ( TPESSOA = 'J' )
          THEN BEGIN
               RG_IE = RG_IE;

               IF (RG_IE = '')
               THEN BEGIN
                    VERIFICA = 'N';
               END
               ELSE BEGIN
                    VERIFICA = 'S';
               END
          END
          ELSE BEGIN
               IF (RG_IE = '')
               THEN BEGIN
                    IF ( ECF = 0 )
                    THEN BEGIN
                         VERIFICA = 'N';
                    END
                    ELSE BEGIN
                         VERIFICA = 'S';
                    END
               END
          END
     END

     SUSPEND ;
END
^

ALTER PROCEDURE VERIFICA_IE_RG_AGRUPADA (
    CNPJ VARCHAR(14),
    PESSOA INTEGER)
RETURNS (
    VERIFICA CHAR(1))
AS
DECLARE VARIABLE RG_IE VARCHAR(15);
DECLARE VARIABLE TPESSOA CHAR(1);
begin
     IF ( PESSOA IS NULL )
     THEN BEGIN
          PESSOA = 0 ;
     END

     /*

       QDO E PESSOA JURIDICA TEM Q TER A IE

       QDO E FISICA SE HOUVER UM CUPOM IMPRESSO NAO PRECIDA DE IERG

       MAS NAO HOUVER É OBRIGATORIO

     */

     SELECT RG_IE, PESSOA FROM GLO_PESSOAS_FJ
     WHERE CNPJ = :CNPJ AND CODIGO = :PESSOA
     ORDER BY CNPJ, CODIGO
     INTO :RG_IE, :TPESSOA ;

     IF ( TPESSOA = 'J' )
     THEN BEGIN
          RG_IE = RG_IE;

          IF ( RG_IE = '' )
          THEN BEGIN
               VERIFICA = 'N';
          END
          ELSE BEGIN
               VERIFICA = 'S';
          END
     END
     ELSE BEGIN
          IF ( RG_IE = '' )
          THEN BEGIN
               VERIFICA = 'N';
          END
          ELSE BEGIN
               VERIFICA = 'S';
          END
     END

     SUSPEND ;
END
^

ALTER PROCEDURE VERIFICA_LIMITE_RECEBER (
    CNPJ CHAR(14),
    INI DATE,
    FIM DATE,
    DT_CX DATE,
    LIMITE_TEMPO INTEGER,
    PESSOA_FJ INTEGER)
RETURNS (
    SOMA NUMERIC(18,4))
AS
DECLARE VARIABLE TOTALRECEBER NUMERIC(18,4);
DECLARE VARIABLE VALOR_ACRESCIMO NUMERIC(18,8);
DECLARE VARIABLE DATA_ULT_BX DATE;
DECLARE VARIABLE DATA DATE;
DECLARE VARIABLE CODREC INTEGER;
DECLARE VARIABLE TX_JUROS_APOS NUMERIC(18,8);
DECLARE VARIABLE TX_JUROS_ATE NUMERIC(18,8);
DECLARE VARIABLE TIPO CHAR(1);
DECLARE VARIABLE TOLERANCIA_JUROS INTEGER;
DECLARE VARIABLE VENDA INTEGER;
DECLARE VARIABLE MULTA_FINANCEIRA NUMERIC(18,4);
BEGIN
     /*Copiado do receber data analitico, mas modificado para o verifica-limite*/
     /*------------------------------------Somando o total de contas a Receber---------------------------*/

     soma = 0;
     select e.tx_juros_apos, e.tx_juros_ate, e.tipo_taxa
     from sis_empresas e
     where cnpj = :cnpj
     into :tx_juros_apos, :tx_juros_ate, :tipo;

     /*tolerância de juros*/
     select coalesce(c.tolerancia_juros,0)
     from sis_configuracoes c
     where cnpj = :cnpj
     into :tolerancia_juros;

     /* SOMA O TOTAL DE CONTAS A RECEBER      group by dt_vencto, pessoa_fj, arquivo_morto */
     for select (coalesce(valor,0)-coalesce(vlr_parcial,0)), dt_vencto, rec.data_ult_baixa,
         rec.codigo, rec.codigo_vn
     from fin_contas_receber  rec
     where cnpj = :cnpj and (dt_vencto between :ini and :fim) and rec.pessoa_fj = :pessoa_fj
     into :soma, :data, :data_ult_bx, :codrec, :venda
     do
     begin
        /*------------------------------------Calculando ACréscimos--------------------------------------*/
        if (:data_ult_bx > :data) then
          data = :data_ult_bx;

        select coalesce(valor_multa,0) from pcd_calcula_multa_rec(:cnpj,:codrec,:pessoa_fj,:venda, :dt_cx,:tolerancia_juros,:multa_financeira)
        into :valor_acrescimo;

        soma = :soma + :valor_acrescimo;

        select coalesce(valor_juros,0) from pcd_calcula_juros(:cnpj,:SOMA,:DATA,:dt_cx,:tx_juros_ate,:tx_juros_apos,:tipo,:tolerancia_juros)
        into :valor_acrescimo;

        soma = :soma + :valor_acrescimo;

        suspend;
     end
END
^

ALTER PROCEDURE VERIFICA_MODULO (
    EXECUTAVEL VARCHAR(30),
    OBJETO VARCHAR(30),
    DESCRICAO VARCHAR(45),
    ACTIONS VARCHAR(500))
RETURNS (
    OK INTEGER)
AS
DECLARE VARIABLE NUM_ROWS INTEGER;
DECLARE VARIABLE CODIGO INTEGER;
BEGIN
  /* verificando se o modulo existe */
  select count(*) from sis_modulos where executavel = :executavel and objeto = :objeto
  into :num_rows;

  /*se não existir, insira*/
  if (num_rows = 0) then
  begin
    codigo = gen_id(sis_modulos_ge, 1);

    /* inserindo o registro de modulos */
    insert into sis_modulos values (:codigo,
                                    :executavel,
                                    :objeto,
                                    :descricao,
                                    'N',
                                    :ACTIONS);

  end

  /* se existir, atualizar os registros */
  if (num_rows = 1) then
  begin
    /* resgatando o codigo do modulo */
    select sis_modulos.codigo from sis_modulos
    where executavel = :executavel and objeto = :objeto into :codigo;

    /* ATUALIZANDO MODULOS */
    update sis_modulos set descricao = :descricao, actions = :actions where codigo = :codigo;

    /* atualizando direitos para supervisores */
    update sis_direitos_perfil sp set direito = :actions where sp.perfil = 1 and sp.modulo =:codigo;
  end

  /* resultado */
  ok = num_rows;
  suspend;
END
^

ALTER PROCEDURE VERIFICA_PRECO_ESPECIAL (
    CNPJ CHAR(14),
    PESSOA_FJ INTEGER,
    PRODUTO VARCHAR(15))
RETURNS (
    PORCENTAGEM NUMERIC(15,4))
AS
begin
     SELECT PORCENTAGEM FROM GLO_PRECOS_ESPECIAIS
     WHERE CNPJ = :CNPJ AND PRODUTO = :PRODUTO AND PESSOA_FJ = :PESSOA_FJ
     INTO :PORCENTAGEM ;

     suspend;
END
^

ALTER PROCEDURE VERIFICA_PRODUTO (
    CNPJ VARCHAR(14),
    PRODUTO VARCHAR(15))
RETURNS (
    TAG INTEGER)
AS
BEGIN
  /*  */
  TAG = 0;
  /*  */
  IF (EXISTS(SELECT CNPJ, CODIGO
             FROM EST_PRODUTOS
             WHERE CNPJ = :CNPJ AND
                   CODIGO = :PRODUTO)) THEN
     TAG = 1;
  SUSPEND;
END
^

ALTER PROCEDURE VERIFICA_SIMILARES (
    PRODUTO_A VARCHAR(13),
    PRODUTO_B VARCHAR(13))
RETURNS (
    RETORNO INTEGER)
AS
BEGIN
  /*  */
  RETORNO = 0;
  /*  */
  /*IF (EXISTS(SELECT PRODUTO_A, PRODUTO_B
             FROM EST_PRODUTOS_SIMILARES
             WHERE PRODUTO_A = :PRODUTO_A AND
                   PRODUTO_B = :PRODUTO_B)) THEN
     RETORNO = 1;
  /*  */
  /*IF (EXISTS(SELECT PRODUTO_A, PRODUTO_B
             FROM EST_PRODUTOS_SIMILARES
             WHERE PRODUTO_A = :PRODUTO_B AND
                   PRODUTO_B = :PRODUTO_A)) THEN
     RETORNO = 1;
  /*  */
  SUSPEND;
END
^

ALTER PROCEDURE VERLANCAMENTO (
    CNPJ CHAR(14),
    CONTA INTEGER,
    D DATE,
    D1 DATE)
RETURNS (
    DATA DATE,
    COD_DOC VARCHAR(3),
    DOCUMENTO VARCHAR(40),
    HISTORICO VARCHAR(80),
    VALOR NUMERIC(18,4),
    TIPO CHAR(1),
    DATA_CONCILIACAO DATE)
AS
begin
     FOR SELECT DATA, COD_DOC, DOCUMENTO, substring(HISTORICO from 1 for 80), VALOR, TIPO,
     DATA_CONCILIACAO
     FROM CTB_MOVIMENTO_CONTABIL
     WHERE CNPJ = :CNPJ AND CONTA = :CONTA AND DATA >= :D AND DATA <= :D1
     ORDER BY DATA, COD_DOC, DOCUMENTO
     INTO :DATA, :COD_DOC, :DOCUMENTO, :HISTORICO, :VALOR, :TIPO,
     :DATA_CONCILIACAO
     DO BEGIN
        suspend;
     END
END
^


SET TERM ; ^


/******************************************************************************/
/****                             Descriptions                             ****/
/******************************************************************************/

DESCRIBE TABLE CM_PARC_PAGAR
'Tabela conterá o vículo dos parcelamentos de comissão
com a tabela de contas à pagar';

DESCRIBE TABLE CM_PERFIL
'Perfil de Comissões';

DESCRIBE TABLE CM_REL_COM_PGR_REC
'Essta tabela guarda a relação que existe entre baixa de contas à receber
e contas à pagar:
Ex: Um recebimento aconteceu e liberou X% para pagamento de comissão.
O processo de quitação de comissão foi acionado e um registro de Contas à Pagar
foi gerado. Logo o percentual de liberação de pagamento de comissão foi zerado
(ou seja, caso o usuário chamasse novamente o processo de quitação este não geraria
nenhum valor de receber pois o campo pct_comissao é igual à 0), se neste instante
o movimento de recebida for estornado e depois novamente baixado será possivel
gerar novos "contas à pagar" para o registro de comissão que na verdade já tem
contas à pagar gerado.
Essa relação foi escrita para impedir justamente isso';

DESCRIBE TABLE FIN_BAIXAS_RECEBER
'Código da faixa de redução caso a conta tenha sido paga com atraso';

DESCRIBE TABLE FIN_COBRANCAS
'Esse receber me parece ser a id da conta receber';



/******************************************************************************/
/****                             Descriptions                             ****/
/******************************************************************************/

DESCRIBE EXCEPTION CHEQUE_CONCILIADO
'Só permite selecionar cheque ainda não conciliados';

DESCRIBE EXCEPTION CTB_VERIFICA_TIPO
'So permite C ou D, conforme o Plano de Contas';

DESCRIBE EXCEPTION EXCLUSAO_PLANILHA
'Só Permite Apagar a Planilha Inteira';

DESCRIBE EXCEPTION REC_VENDA
'Utilizado para não permitir mudança de proprietario em cts. gerada por venda
s';

DESCRIBE EXCEPTION SEM_CAIXA_SELECIONADO
'Só permite faturar ou baixar movimentos com usuários selecionados';

DESCRIBE EXCEPTION TESTE
'utilizado para tester triguer..';



/******************************************************************************/
/****                             Descriptions                             ****/
/******************************************************************************/



/* Fields descriptions */

DESCRIBE FIELD TIPO_ACERTO TABLE ACT_ACERTOCONTA
'hehe.. copiando do cooperate';

DESCRIBE FIELD DATAINICIOVARIACAO TABLE ACT_CONFIGURACAOTITULO
'CORREÇÃO MONETÁRIA';

DESCRIBE FIELD DATAFIMVARIACAO TABLE ACT_CONFIGURACAOTITULO
'CORREÇÃO MONETÁRIA';

DESCRIBE FIELD COD_INDEXADOR TABLE ACT_CONFIGURACAOTITULO
'CORREÇÃO MONETÁRIA';

DESCRIBE FIELD JUROSIMPLES TABLE ACT_CONFIGURACAOTITULO
'Tipo de juros: Simples ou Composto';

DESCRIBE FIELD TAXAMULTA TABLE ACT_CONFIGURACAOTITULO
'MULTA';

DESCRIBE FIELD CARENCIAMULTA TABLE ACT_CONFIGURACAOTITULO
'MULTA';

DESCRIBE FIELD TIPODESCONTO TABLE ACT_CONFIGURACAOTITULO
'DESCONTO POR ANTECIPAÇÃO';

DESCRIBE FIELD PERCDESCONTOANTECIPADO TABLE ACT_CONFIGURACAOTITULO
'DESCONTO POR ANTECIPAÇÃO';

DESCRIBE FIELD PERCDESCONTOPONTUALIDADE TABLE ACT_CONFIGURACAOTITULO
'DESCONTO POR ANTECIPAÇÃO';

DESCRIBE FIELD COD_JURO_POS_FIXADO TABLE ACT_CONFIGURACAOTITULO
'Juros pós fixado';

DESCRIBE FIELD CARENCIAJUROS TABLE ACT_CONFIGURACAOTITULO
'Parece ser do campo data de inicio juros, acho que ambos são uma só, ou seja tanto se for juros pós fixado 
ou juros pré fixado ambos iniciarão em um data a ser determinada, o campo serve para os dois controles';

DESCRIBE FIELD TAXARISCO TABLE ACT_CONFIGURACAOTITULO
'Ainda não sei da onde é!! Acho que é o tal do spreed';

DESCRIBE FIELD MATERIAL_EMBALAGEM TABLE AGR_DEFENSIVO_AGRICOLA
'1 - Metal
2 - Plastico
3 - Vidro
4 - Não Lavável';

DESCRIBE FIELD COD_FINANCEIRO TABLE CM2_ACERTO_COMISSAO
'Codigo do financeiro, pode ser de conta a receber ou mesmo conta a pagar,
dependendo e claro do saldo da operacao de quitacao';

DESCRIBE FIELD DT_GERACAO TABLE CM2_COMISSAO_PARC
'Data em que foi gerado a registro de comissão.';

DESCRIBE FIELD STATUS TABLE CM_COMISSAO
'''Q'' = QUITADA - Comissão já enviada para o Contas à Pagar
''G'' = GERADA - Gerado os Vlr. a partir do procedure 
''A'' = ABERTA - Gerado os regs. somente do contas à receber';

DESCRIBE FIELD PCT_ANTECIPACAO TABLE CM_COMISSAO
'Percentual de antecipação aplicado em parcelamentos';

DESCRIBE FIELD PESSOA_FJ TABLE CM_COMISSAO
'Código do cliente (C. Receber)';

DESCRIBE FIELD PCT_PAGO TABLE CM_COMISSAO_PARC
'Percentual bruto aplicado em cima do valor da comissão.
Sem considerar a faixa de redução por atraso.. caso ela exista. chega no máximo 100%';

DESCRIBE FIELD PCT_LIBERADO TABLE CM_COMISSAO_PARC
'Percentual aplicado em cima do valor total da comissão. 
Obs: Será determinado ao se realizar uma baixa de contas à receber ou no caso de entradas de vendas à prazo ou vlr. integral de venda à vista ou mesmo na antecipação determinada no perfil de pagto.

Calculo: 
Baixas Receber -> Calculá-se o percentual de acordo com o percentual baixado da conta à receber. Quando possuir um
valor redutor por conta do atraso, o percentual liberado deverá sofrer uma redução no seu percentual para 

';

DESCRIBE FIELD COD_RECEBER TABLE CM_COMISSAO_PARC
'Cód Receber embora seja uma chave estrangeira.. não deve 
possuir integridade referencial..pois quando as contas à receber são quitadas elas 
são excluidas do receber e transferidas para as baixas';

DESCRIBE FIELD ANO TABLE CM_COMISSAO_PARC
'Apenas por compatibilidade ao contas à receber';

DESCRIBE FIELD VLR_RECEBER TABLE CM_COMISSAO_PARC
'Vlr. da conta à receber';

DESCRIBE FIELD STATUS TABLE CM_COMISSAO_PARC
'Status da parcela';

DESCRIBE FIELD PCT_LUCRO_ITEM TABLE CM_COMISSAO_PARC
'Percentual de lucro que o item rendeu';

DESCRIBE FIELD COD_PERFIL_PAGTO TABLE CM_COMISSAO_PARC
'utilizado ';

DESCRIBE FIELD P_CODIGO TABLE CM_LOG
'Código do perfil utilizado
';

DESCRIBE FIELD P_PERFIL TABLE CM_LOG
'Nome do perfil
';

DESCRIBE FIELD P_FX_CODIGO TABLE CM_LOG
'Código do faixa de valores utilizada
CM_PERFIL_FAIXA
';

DESCRIBE FIELD P_FX_D_CODIGO TABLE CM_LOG
'Codigo do registro da tabela faixa de descto
CM_PERFIL_FAIXA_DESC';

DESCRIBE FIELD P_FX_D_PRD_CODIGO TABLE CM_LOG
'Código da tabela de descontos dos produtos exeções
CM_PERFIL_FAIXA_PROD';

DESCRIBE FIELD TTL_FATURAMENTO TABLE CM_LOG
'Total do faturamento do periodo para saber em qual faixa ele caiu';

DESCRIBE FIELD TTL_DESCTO_ITEM TABLE CM_LOG
'total do percentual de desconto do item nomento 
da geração da tabela';

DESCRIBE FIELD DT_INICIAL TABLE CM_LOG
'Dt. inicial da pesquisa';

DESCRIBE FIELD DT_FINAL TABLE CM_LOG
'Dt. final';

DESCRIBE FIELD COM_VISTA TABLE CM_LOG
'Vlr. de Comissão a vista aplicado no item.


Obs.: Estou armazenando estes valores nesta tabela pela conveniencia de se resgatar para
exibição no relatorio de comissões.';

DESCRIBE FIELD COM_PRAZO TABLE CM_LOG
'Vlr. de Comissão a prazo no item.';

DESCRIBE FIELD USUARIO TABLE CM_LOG
'Usuário que realizou a geração das comissões';

DESCRIBE FIELD COD_PARC_COM TABLE CM_PARC_PAGAR
'Código da parcela da comissão';

DESCRIBE FIELD COD_PAGAR TABLE CM_PARC_PAGAR
'Código da conta à pagar gerada a partir desta quitação';

DESCRIBE FIELD PCT_ANT_PRAZO TABLE CM_PERFIL_PAGTO
'Isso define quanto por cento da venda à prazo é gerado no ato do fechamento';

DESCRIBE FIELD STATUS TABLE CRG_FORMAR_CARGA
'1 - FORMANDO CARGA
2 - ENTREGA PENDENTE
3 - FINALIZADO
';

DESCRIBE FIELD STATUS TABLE CRG_ORDEM_CARGA
'/* ---------- [ Legenda - VENDA] ---------             ---------- [ Legenda - CARGA] ---------
      0 - Aberto
                                                             1 - a Carregar
                                                             2 - a Entregar
      3 - Parcialmente Carregado                             3 - Parcialmente Carregado
      4 - Parcialmente Entregue                              4 - Parcialmente Entregue
      5 - Carregado                                          5 - Carregado
      6 - Entregue                                           6 - Entregue
                                                             7 - Devolvido
                                                             8 - Cancelado    
   ---------------------------------------             ---------------------------------------  */
';

DESCRIBE FIELD QUANTIDADE TABLE CRG_ORDEM_CARGA_ITENS
'quantidade para ser entregue para o cliente';

DESCRIBE FIELD CARREGADO TABLE CRG_ORDEM_CARGA_ITENS
'qtde passada ao cliente';

DESCRIBE FIELD ENTREGUE TABLE CRG_ORDEM_CARGA_ITENS
'qtde entregue na loja';

DESCRIBE FIELD DT_KARDEX TABLE EST_KARDEX
'Dt. em que o registro é inserido na tabela do kardex';

DESCRIBE FIELD CFOP TABLE EST_KARDEX
'Criado para controlar se o cfop do movimento que gerou o kardex realmente esta correto.';

DESCRIBE FIELD CFOP_ESTOQUE TABLE EST_KARDEX
'Vai salvar se o cfop utilizado no movimento no ato da execução da função controlava estoque ou não.';

DESCRIBE FIELD TTL_RES_DIVERSOS TABLE EST_NATUREZA
'Define se movimentações com essa natureza totalizará
no totalizador de "Diversos" em vendas fiscais(Frigorifico São luiz)';

DESCRIBE FIELD TTL_RES_BONIFICACAO TABLE EST_NATUREZA
'Parâmetro marcado significa que o a naturaza computará no demonstrativo financeiro como bonificação';

DESCRIBE FIELD DEVOLUCAO TABLE EST_NATUREZA
'Se será uma CFOP de devolução';

DESCRIBE FIELD REMESSA TABLE EST_NATUREZA
'Se será um CFOP de simples remessa';

DESCRIBE FIELD ENTREGA_FUTURA TABLE EST_NATUREZA
'CFOP de entrega futura';

DESCRIBE FIELD EST_MIN TABLE EST_PRODUTOS
'Estoque mínimo a ser definido manualmente';

DESCRIBE FIELD EST_MAX TABLE EST_PRODUTOS
'Est. maximo a ser definido manualmente';

DESCRIBE FIELD DEBITA_ICMS TABLE EST_PRODUTOS
'Utilizado pela FERT-FLORA que debita o total de ICMS
do total da NF.
';

DESCRIBE FIELD FATOR_CONVERSAO TABLE EST_PRODUTOS
'Fator pelo qual será dividido a unidade movimentada (unidade primaria) para ser encontrada quanto esta representa em unidade padrão';

DESCRIBE FIELD QNTDE_PDR_CARGA TABLE EST_PRODUTOS
'Qtde padrão de carregamento (Cadu Alimentos)';

DESCRIBE FIELD STATUS TABLE FAT_ORCAMENTOS
'1 - Aberto
2 - Parcialmente Faturado
3 - Faturado
4 - Cancelado';

DESCRIBE FIELD QTDE_FATURADA TABLE FAT_ORCAMENTOS_ITENS
'Quantidade faturada em casos de carregamentos parciais';

DESCRIBE FIELD TIPO_VENDA TABLE FAT_VENDAS
'Ven = Venda
Con = Condicional
Fut = Entrega Futura';

DESCRIBE FIELD DESCONTOS_CONCEDIDOS TABLE FAT_VENDAS
'DESCONTOS CONDEDIDOS NOS PRODUTOS';

DESCRIBE FIELD VALE_TROCO TABLE FAT_VENDAS
'O troco já é guardado no campo troco mesmo, so precisamos identificar o motivo do vale troco
''C'' = Cheque
''V'' = Convênio
''T'' = Ticket ';

DESCRIBE FIELD PGTO_FRETE TABLE FAT_VENDAS
'Se o frete será pago pelo 
''E''-Emitente(Empresa vendedora)
''D''-Destinatário(Cliente)

Utilizado na Nota de serviço gráfica';

DESCRIBE FIELD DESCTO_RES TABLE FAT_VENDAS
'Desconto percentual que ainda poderá ser aplicado 
no recebimento';

DESCRIBE FIELD ID_AGRUPADOR TABLE FAT_VENDAS
'Esse campo conterá o relacionamento entre faturamentos como no caso da simples remessa, devoluções etc..
';

DESCRIBE FIELD DESCTO_ICMS TABLE FAT_VENDAS
'Total de desconto de imposto que será debitado do total da venda';

DESCRIBE FIELD PCT_DESCTO_ICMS TABLE FAT_VENDAS
'Percentual cadastrado no CFOP que será debitado do total da NF';

DESCRIBE FIELD NF_AGRUPADA TABLE FAT_VENDAS
'Utilizando impressão de NF agrupada';

DESCRIBE FIELD STATUS_CARREGAMENTO TABLE FAT_VENDAS
'/* ---------- [ Legenda - VENDA] ---------             ---------- [ Legenda - CARGA] ---------
                                                            -1 - Cancelado
      0 - Aberto
                                                             1 - a Carregar
                                                             2 - a Entregar
      3 - Parcialmente Carregado                             3 - Parcialmente Carregado
      4 - Parcialmente Entregue                              4 - Parcialmente Entregue
      5 - Carregado                                          5 - Carregado
      6 - Entregue                                           6 - Entregue
   ---------------------------------------             ---------------------------------------  */                            
';

DESCRIBE FIELD ORDEM_CARGA TABLE FAT_VENDAS
'Armazena a ultima ordem de carga';

DESCRIBE FIELD ENTREGA_FUTURA TABLE FAT_VENDAS
'S-SIM
N-NAO';

DESCRIBE FIELD PCT_COMISSAO TABLE FAT_VENDAS
'COMISSÃO DO VENDEDOR';

DESCRIBE FIELD NFE_CHAVE TABLE FAT_VENDAS
'Chave da NFe, necessário caso seja necessário referênciar esta NF através de uma outra operação
- Devolução
- Simples Remessa
etc..

';

DESCRIBE FIELD COD_CONFIGTITULO TABLE FAT_VENDAS
'Essa idéia foi copiada do cooperate, imagino que ele trate a configuração de titulo como uma 
tabela a parte pelo fato de ela poder ser utilizada pelo faturamento e pelo titulo,sendo que deverá ser 
a mesma no caso de títulos gerados automaticamente.';

DESCRIBE FIELD COM_GERADA TABLE FAT_VENDAS_ITENS
'A comissão é gerada por items.. portanto
se a comissão daquele item já foi gerada 
este campo terá o valor ''S''';

DESCRIBE FIELD CARREGAR TABLE FAT_VENDAS_ITENS
'qtde para ser carregado ou entregue pelo deposito';

DESCRIBE FIELD CARREGADO TABLE FAT_VENDAS_ITENS
'qtde confirmada de carregamento pelo deposito ao fundo';

DESCRIBE FIELD ENTREGUE TABLE FAT_VENDAS_ITENS
'qtde entregue pelo vendedor, estoque da loja';

DESCRIBE FIELD SPRODUTO TABLE FAT_VENDAS_ITENS
'Criado para corrigir o problema da limitação de 15 posições existente no campo 
produto, (Atitude Modas)';

DESCRIBE FIELD COD_EVENTOCONTABIL TABLE FIN_BAIXAS_PAGAR
'Em desuso por enquanto...';

DESCRIBE FIELD ACT_TIPO_BAIXA TABLE FIN_BAIXAS_PAGAR
'1 - Baixa por Caixa.
2 - Baixa por Cheque
3 - Baixa por Aviso Bancário.
4 - Baixa por Renegociacao
5 - Baixa por Compensasao de Cheques(Aviso de compensasao enviado pelo banco).
Usado no cooperate porque estes trata todo cheque não conciliado como um título em aberto.';

DESCRIBE FIELD VLR_ORIG_ALT TABLE FIN_BAIXAS_PAGAR
'Criado apenas para manter compatibilidade com a tabela de baixas a receber, nao utilizado.';

DESCRIBE FIELD JUROS_REC TABLE FIN_BAIXAS_RECEBER
'Pelo que vc ententi, o campo JUROS_REC não quer dizer que naquela data a pessoa recebeu essa quantia de juros, mas sim apenas um descritivo da conta, tal como o campo VALOR
ou serja quer dizer que na data desta baixa, vc tinha um saldo de conta: 
Valor Inicial        = VALOR
Valor P/Parcialmente = VLR_PARCIAL
Jrs. Recebidos       = JUR_RECEB
etc..
';

DESCRIBE FIELD VLR_ORIG_ALT TABLE FIN_BAIXAS_RECEBER
'Significa que o valor original da conta foi alterado por uma baixa parcial dos juros. 
Ex: Conta = 100 Juros = 50 baixa-se 25 dos juros..
seto o valor da conta p/125 e data da ultima baixa 
coloco a data da baixa
Vlr. Original era 100 passou a ser 125 e estado ''S''
';

DESCRIBE FIELD BAIXA_BLT TABLE FIN_BAIXAS_RECEBER
'Se a baixa foi através de boleto';

DESCRIBE FIELD PGT_FX_CODIGO TABLE FIN_BAIXAS_RECEBER
'Aparentemente estes campos são utilizados somente como históricos, para sabermos em 
qual perfil de pagamento determinada baixa se emquadrou, como sabemos existe uma inconsistencia
no código que seta estes valores, pois ele pressupõe que o vendedor relacionado no registro de
venda é o mesmo para todos os itens, oque nem sempre é verdade, portanto não temos como 
determinar em qual perfil a baixa de conta à receber se emquadrou, pois o que determina
estes valores são os registros de comissão e não a baixa de receber. sem que quando ler isso
denovo não vai entender nada.. huahuaah good look!';

DESCRIBE FIELD ACT_TIPO_BAIXA TABLE FIN_BAIXAS_RECEBER
'1 - Baixa por Caixa.
2 - Baixa por Cheque
3 - Baixa por Aviso Bancário.
4 - Baixa por Renegociacao
5 - Baixa por Compensasao de Cheques(Aviso de compensasao enviado pelo banco).
Usado no cooperate porque estes trata todo cheque não conciliado como um título em aberto.';

DESCRIBE FIELD CMV TABLE FIN_CENTRO_CUSTO
'As contas pagas serão debitadas do lucro de vendas, pois elas serão relacionadas com despesas com vendas';

DESCRIBE FIELD DT_ALT_MANUAL TABLE FIN_CHEQUES
'Data da alteração manual, caso o cheque tenha tido seu estado alterado manualmente este campo estara preenhcido
com a data da alteração';

DESCRIBE FIELD COD_MVT_CTB TABLE FIN_CHEQUES
'O Lancto dos cheques no movto bancário se dá de forma agrupada, portanto precisamos de um vínculo para podermos estornar o movimento quando estornarmos o banco ou vice-versa';

DESCRIBE FIELD DT_INSERT TABLE FIN_COBRANCAS
'Armazenará a dt. da inserção do registro';

DESCRIBE FIELD CNPJ TABLE FIN_CONTAS_PAGAR
'08740264000193';

DESCRIBE FIELD LOCAL_COBRANCA TABLE FIN_CONTAS_RECEBER
'Este LOCAL_COBRANCA nao e o mesmo do LOCAL_COBRANCA do faturamento, no faturamento se refere a conta corrente
na qual os titulos serao vinculados';

DESCRIBE FIELD VLR_ORIG_ALT TABLE FIN_CONTAS_RECEBER
'Significa que o valor original da conta foi alterado por uma baixa parcial dos juros. 
Ex: Conta = 100 Juros = 50 baixa-se 25 dos juros..
seto o valor da conta p/125 e data da ultima baixa 
coloco a data da baixa
Vlr. Original era 100 passou a ser 125 e estado ''S''
';

DESCRIBE FIELD VALOR_NOMINAL TABLE FIN_CONTAS_RECEBER
'Pode acontecer de que a conta à receber tenha seu valor 
original alterado, no entanto este valor original será necessário para calcular o saldo de descto na conta como 
no caso da fert flora.. portanto estou salvando este valor neste campo';

DESCRIBE FIELD IDX_VLR_PARCIAL TABLE FIN_CONTAS_RECEBER
'Valor parcial já pago do indexador';

DESCRIBE FIELD ACT_TOTAL_RECEBER TABLE FIN_CONTAS_RECEBER
'Utilizado para compensação';

DESCRIBE FIELD NDOC TABLE FIN_CONTAS_RECEBER
'Código sequencial do conta a receber, usado no boleto como 
numero do documento';

DESCRIBE FIELD BLT_NUM_IMP TABLE FIN_CONTAS_RECEBER
'Em caso de boletos armazenará o número de impressões do 
título';

DESCRIBE FIELD SUB_TRIBUTARIO TABLE GLO_CLIENTES
'Campo criado na intenção de ser utilizado primáriamente na impressão da nf de serviço';

DESCRIBE FIELD RET_PIS TABLE GLO_CLIENTES
'Se reterá na NF de serviço os valores de PIS/COFINS/CSLL';

DESCRIBE FIELD RET_INSS TABLE GLO_CLIENTES
'Se reterá na NF de serviço os valores de INSS';

DESCRIBE FIELD RET_IRRF TABLE GLO_CLIENTES
'Se reterá na NF de serviço os valores de IRRF(IMPOSTO DE RENDA)';

DESCRIBE FIELD TEMPO_RESPOSTA TABLE GLO_CLIENTES_PRODUTOS
'VAI SAIR';

DESCRIBE FIELD MEDIA_COPIAS TABLE GLO_CLIENTES_PRODUTOS
'VAI SAIR';

DESCRIBE FIELD DIAS_RECHAMADO TABLE GLO_CLIENTES_PRODUTOS
'VAI SAIR';

DESCRIBE FIELD QTDE_COPIAS_PREVENTIVA TABLE GLO_CLIENTES_PRODUTOS
'VAI SAIR';

DESCRIBE FIELD CODIGO TABLE GLO_CLIENTES_PRODUTOS_ITENS
'Aqui ficarao os produtos relacionados com o contrato';

DESCRIBE FIELD VALOR TABLE GLO_CLIENTES_PRODUTOS_ITENS
'Valor que o item representa na totalização do contrato pois terá de ser gerado um faturamento com itens discriminados por valor.';

DESCRIBE FIELD BLT TABLE GLO_TIPOS_DOCTO
'Se o tipo de docmento é boleto, utilizado para definir se parcelamento com este tipo de docto fará com q o sistema gere os boletos, ficando também na dependencia o parametro em sis_empresas estiver marcado como ''S'' para que o docto seja gerado';

DESCRIBE FIELD DIA_BASE TABLE OFC_CONTRATOS
'Dia base de vencimento';

DESCRIBE FIELD CODIGO TABLE OFC_CONTRATOS_ITENS
'Aqui ficarao os produtos relacionados com o contrato';

DESCRIBE FIELD VALOR TABLE OFC_CONTRATOS_ITENS
'Valor que o item representa na totalização do contrato pois terá de ser gerado um faturamento com itens discriminados por valor.';

DESCRIBE FIELD COD_ITEM_CONTRATO TABLE OFC_LEITURAS_ITENS
'Coloquei o item do contrato e não o ''produto'' pois dessa forma faria o item ser uma chave
estrangeira em um movimento e isso por si só validaria qualquer espécie de exclusão do mesmo.';

DESCRIBE FIELD DATA TABLE OFC_ORDEM_SERVICO
'Dt. Atribuida automaticamente no inserção do registro';

DESCRIBE FIELD ENTRADA TABLE OFC_ORDEM_SERVICO
'Dt. Atribuida pelo operador como sendo a dt. de requisição do serviço';

DESCRIBE FIELD HR_ENTRADA TABLE OFC_ORDEM_SERVICO
'Horário da solicitação do seviço';

DESCRIBE FIELD DATA_FECHAMENTO TABLE OFC_ORDEM_SERVICO
'Dt. Fechamento OS, fechamento literal';

DESCRIBE FIELD HORA_CHEGADA TABLE OFC_ORDEM_SERVICO
'Não tenho a minima ideia de que hora é essa..

';

DESCRIBE FIELD DT_ATRIBUICAO TABLE OFC_ORDEM_SERVICO
'Dt.e hora em que o trabalho foi atribuido ato técnico';

DESCRIBE FIELD HR_ATRIBUICAO TABLE OFC_ORDEM_SERVICO
'Horário em que o serviço foi atribuido ao técnico "Programado"';

DESCRIBE FIELD DT_INICIALIZACAO TABLE OFC_ORDEM_SERVICO
'Dt. em que o serviço foi iniciado';

DESCRIBE FIELD HR_INICIALIZACAO TABLE OFC_ORDEM_SERVICO
'Hr. em que o serviço foi iniciado';

DESCRIBE FIELD DT_FINALIZACAO TABLE OFC_ORDEM_SERVICO
'Dt. e hora em que o serviço foi definido como finalizado pelo técnico';

DESCRIBE FIELD HR_FINALIZACAO TABLE OFC_ORDEM_SERVICO
'Hr. em que o serviço foi finalizado';

DESCRIBE FIELD KM_INICIAL TABLE OFC_ORDEM_SERVICO
'Km. Inicial ao Atendimento';

DESCRIBE FIELD KM_FINAL TABLE OFC_ORDEM_SERVICO
'Km. Final do atendimento.';

DESCRIBE FIELD OS_RECHAMADO TABLE OFC_ORDEM_SERVICO
'Armazena o código da última OS caso o atendimento foi considerado rechamado.
O campo está sendo atualizado quando a OS é salva.(Trigger)
Cadastro de rechamando na tela de Contrato/Cliente';

DESCRIBE FIELD KM_RODADO TABLE OFC_ORDEM_SERVICO
'SOMATORIA DE KM RODADO DURANTE ATENDIMENTO DA ATENDIMENTO DA TABELA OFC_ORDEM_SERVICO_INTERVALO';

DESCRIBE FIELD TEMPO_RESPOSTA TABLE OFC_ORDEM_SERVICO
'Tempo resposta do atendimento, atraves deste valor salvo no fechamento da OS vamos ter condicoes de
determinar se o tempo foi estourado.
';

DESCRIBE FIELD TIPO_TECNICO TABLE OFC_ORDEM_SERVICO
'Se o atendimento foi realizado pelo técnico 
''T'' = Titular
''S'' = Substituto

';

DESCRIBE FIELD TIPO TABLE OFC_ORDEM_SERVICO_INTERVALO
'A - Abertura
F - FECHAMENTO
N - NORMAL';

DESCRIBE FIELD SERVICO TABLE OFC_ORDEM_SERVICO_SERVICO
'Só estou deixando esta porcaria de campo por causa dos registros que existem na base da sistemaq.. senão..
tive de fazer essa gambiarra de montar a chave primaria com os quatro campo sendo que o serviço não mais será
usado#@$$@@';

DESCRIBE FIELD TIPO TABLE OFC_O_S_INTERVALO_EMAIL
'A - ''ABERTURA''
F - ''FECHAMENTO''
M - ''MOVIMENTO''';

DESCRIBE FIELD RETORNO TABLE OFC_TIPO_ATENDIMENTO
'Se esta opção for ''S'' então os atendimentos que forem lançados não geração Originar/Rechamado.';

DESCRIBE FIELD DPL_GRAFICA TABLE SIS_DUPLICATA
'Define se a duplicata é grafica ou não';

DESCRIBE FIELD CONFIG_DPL TABLE SIS_DUPLICATA
'Configurações de duplicata';

DESCRIBE FIELD CAIXA_SINCRONIZADO TABLE SIS_EMPRESAS
'SO PERMITE ABRIR CAIXA COM A MESMA DATA DO SISTEMA';

DESCRIBE FIELD EST_ET_PROD_GRD1 TABLE SIS_EMPRESAS
'Campo pertencente ao formuário: Etiquetas de Produtos por Grades
Código de Barras Formulário Contínuo';

DESCRIBE FIELD EST_ET_PROD_GRD2 TABLE SIS_EMPRESAS
'Campo pertencente ao formuário: Etiquetas de Produtos por Grades
Código de Barras Formulário Contínuo Uma Coluna';

DESCRIBE FIELD EST_ET_PROD_GRD3 TABLE SIS_EMPRESAS
'Campo pertencente ao formuário: Etiquetas de Produtos por Grades
Código de Barras Formulário Laser Uma Coluna';

DESCRIBE FIELD EST_ET_PROD_GRD4 TABLE SIS_EMPRESAS
'Campo pertencente ao formuário: Etiquetas de Produtos por Grades
Código de Barras Formulário Laser Três Colunas';

DESCRIBE FIELD CH_INFLUENCIA_VENDA TABLE SIS_EMPRESAS
'Se este campo estiver marcado como ''S'' então um venda a vista que possuir um pagto em cheque à prazo no pagamento é "transformada" em venda prazo no relatório F5';

DESCRIBE FIELD CRT_INFLUENCIA_VENDA TABLE SIS_EMPRESAS
'Se este campo estiver marcado como ''S'' então um venda a vista que possuir um pagto em cartão
à prazo no pagamento é "transformada" em venda prazo no relatório F5';

DESCRIBE FIELD IMP_SERIE_NF TABLE SIS_EMPRESAS
'Piratini Ferramentas solicitou alteração na impressão de NF em folhas pré-ipressas o manager permitirá imprimir nesta folha ao fechar a venda caso este campo estiver marcado com ''S''';

DESCRIBE FIELD BLT_AGENCIA TABLE SIS_EMPRESAS
'Codigo da Agencia';

DESCRIBE FIELD BLT_DIG_AGENCIA TABLE SIS_EMPRESAS
'Digito da agencia';

DESCRIBE FIELD BLT_CONTA TABLE SIS_EMPRESAS
'Codigo da Conta';

DESCRIBE FIELD BLT_DIG_CONTA TABLE SIS_EMPRESAS
'Digito conta';

DESCRIBE FIELD BLT_LAYOUT TABLE SIS_EMPRESAS
'1 - CNAB240
2 - CNAB400';

DESCRIBE FIELD BLT_DIAS_ABATIMENTO TABLE SIS_EMPRESAS
'Data máxima para conceder abatimentos ao sacado';

DESCRIBE FIELD BLT_DIAS_DESCONTO TABLE SIS_EMPRESAS
'Data máxima para conceder desconto ao sacado';

DESCRIBE FIELD BLT_DIAS_MORA_JUROS TABLE SIS_EMPRESAS
'Data a partir da qual serão cobrados juros';

DESCRIBE FIELD BLT_DIAS_PROTESTO TABLE SIS_EMPRESAS
'Data em que o título deverá ser protestado
';

DESCRIBE FIELD BLT_PCT_ABATIMENTO TABLE SIS_EMPRESAS
'% de Abatimento';

DESCRIBE FIELD BLT_PCT_DESCONTO TABLE SIS_EMPRESAS
'% de Desconto';

DESCRIBE FIELD BLT_VLR_IOF TABLE SIS_EMPRESAS
'Valor do Imposto sobre Operações Financeiras';

DESCRIBE FIELD BLT_VLR_OUTRAS_DESP TABLE SIS_EMPRESAS
'Valor de outras despesas cobradas pelo banco: protesto de títulos, por exemplo';

DESCRIBE FIELD DIG_ITENS_NF TABLE SIS_EMPRESAS
'Através deste campo o usuário poderá escolher se a impressão das casas decimais nos Itens NF terá exibirá
2 ou 4 casas.';

DESCRIBE FIELD VALIDA_ABERTURA_CX TABLE SIS_EMPRESAS
'Em caso de parametro setado como ''S'' só permitirá abertura de um novo caixa caso não exista um predecessor aberto';

DESCRIBE FIELD TAXA_ACRESC_PDV TABLE SIS_EMPRESAS
'Campo utilizado para adicionar um percentual, de desconto no final da venda. 
Pode ser usado para computar a comissão do garçom.';

DESCRIBE FIELD CONTAGEM_INCREMENTAL TABLE SIS_EMPRESAS
'Define se a contagem de estoque será incremental, ou seja,
se ao fechar a contagem o estoque será incrementado ou será setado com o valor da contagem.';

DESCRIBE FIELD EXIBE_MOD TABLE SIS_EMPRESAS
'Exibir formulário de releases';

DESCRIBE FIELD EXIBE_PENDENCIA TABLE SIS_EMPRESAS
'Se parâmetro for = ''S'' então ao escolher o cliente no momento da venda e ele tendo pendências que estrapolam os valores de seus limites, de crédito ou tempo será exibida a tela de pendencias.';

DESCRIBE FIELD EXIBE_MESAS TABLE SIS_EMPRESAS
'Exibir "controle" de mesas no caso de restaurantes';

DESCRIBE FIELD EXIBE_CTB TABLE SIS_EMPRESAS
'Exibir "controles" de contabilidade';

DESCRIBE FIELD EXIBE_CB TABLE SIS_EMPRESAS
'Exibir "controles" de cobrança';

DESCRIBE FIELD EXIBE_SRV TABLE SIS_EMPRESAS
'Exibir "controles" de serviço';

DESCRIBE FIELD CARREGAMENTO_PARCIAL TABLE SIS_EMPRESAS
'Parametro utilizado para o carregamento parcial,
de orçamentos para vendas';

DESCRIBE FIELD CONFIG_NF_GRAF TABLE SIS_EMPRESAS
'Configuração da NF Gráfica';

DESCRIBE FIELD ATIVA_AGENTE TABLE SIS_EMPRESAS
'Ativar microsoft agente para entrega de mensagens';

DESCRIBE FIELD NF_CONTINUO_COM_MESMO_NUM_NF TABLE SIS_EMPRESAS
'Para empresas que utilizam impressao grafica com 
formulário continuo e utilizam mesmo numero de NF.
A diferença é que os calculos saem somente na ultima folha de NF.';

DESCRIBE FIELD NF_CONTINUO_NOME_CAMPO_TRUE TABLE SIS_EMPRESAS
'Caso a empresa utilizar NF com formulário continuo e mesmo numero de NF.
Esse campo armazenará o nome do memorando que será preenchido com **** (asterisco)
para serem preenchido nas folhas de NF exceto a última.';

DESCRIBE FIELD NUM_ITENS_NF TABLE SIS_EMPRESAS
'Nº de itens por cada folha de NF Gráfica';

DESCRIBE FIELD NUM_ITENS_PDD TABLE SIS_EMPRESAS
'Nº de itens por cada folha do pedido de faturamento';

DESCRIBE FIELD OFC_LT_PRODUTO_COPIAS TABLE SIS_EMPRESAS
'Produto definido para lançamento no caso de cópias excedentes';

DESCRIBE FIELD EXIBE_AGR TABLE SIS_EMPRESAS
'Exibe Receituário Agronômico';

DESCRIBE FIELD NFE_AMBIENTE TABLE SIS_EMPRESAS
'1 - Produção
2 - Homologação';

DESCRIBE FIELD NFE_VERSAO_APP TABLE SIS_EMPRESAS
'Versão do Aplicativo emissor';

DESCRIBE FIELD NFE_DIR_EXPORTACAO TABLE SIS_EMPRESAS
'Diretório para onde serão exportados os registros do manager';

DESCRIBE FIELD NFE_LEIAUTE_DANFE TABLE SIS_EMPRESAS
'1 - Retrato
2 - Paisagem';

DESCRIBE FIELD CONFIG_ACERTO_1 TABLE SIS_EMPRESAS
'Acerto por compensação entre títulos';

DESCRIBE FIELD CM_AGR TABLE SIS_EMPRESAS
'Comissao agricola - 
Fert Flora (Descontinuado)';

DESCRIBE FIELD CM_VDT TABLE SIS_EMPRESAS
'Valor devido a terceiros - America Agroseeds';

DESCRIBE FIELD CMD_VDT_PCT TABLE SIS_EMPRESAS
'Percentual de comissao a ser aplicado sobre o lucro';

DESCRIBE FIELD EMAIL_PADRAO TABLE SIS_EMPRESAS
'Email padrao utilizado pelo suporte';

DESCRIBE FIELD CM_LIB_PCT_VD_VISTA TABLE SIS_EMPRESAS
'Percentual de liberacao de comissão no caso de vendas à vista. Utilizado no relatorio de comissoes por recebimento para atender a empresa Fert. Flora.';

DESCRIBE FIELD CM_LIB_PCT_VD_PRAZO TABLE SIS_EMPRESAS
'Percentual de liberacao de comissão no caso de vendas à PRAZO. Utilizado no relatorio de comissoes por recebimento para atender a empresa Fert. Flora.';

DESCRIBE FIELD PDV_QTDE_COD_BARRAS TABLE SIS_EMPRESAS
'Define se no código de barras de produtos pesáveis so padrão utilizado será ''2''+CODIGO_PRODUTO+PESO_BALANÇA (QTDE) 
';

DESCRIBE FIELD BLOQUEIA_MVB TABLE SIS_EMPRESAS
'BLOQUEIA O MOVIMENTO BANCARIO COM DOCUMENTO DUPLICADO';

DESCRIBE FIELD CTB_DT_AVISO_BANCARIO TABLE SIS_EMPRESAS
'Determinar se contas à pagar obedecerão como data de baixa a dt do aviso bancario lançado.';

DESCRIBE FIELD DT_CX_MOVTO_ANTERIOR TABLE SIS_EMPRESAS
'Solicitação da Regina (Central Eletricidade), para sugerir a data atual - 1, no lanaçmendo de movimento do caixa';

DESCRIBE FIELD PR_GRAF TABLE SIS_NOTAPROMISSORIA
'Defini se a impressão é grafica';

DESCRIBE FIELD PR_GRAF_LEIAUTE TABLE SIS_NOTAPROMISSORIA
'Guardará as insformações da Promissória Gráfica';

DESCRIBE FIELD NF_GRAFICA TABLE SIS_SERIENF
'Pedido Gráfico (Piratini)  ';

DESCRIBE FIELD NF_GRAFICA2 TABLE SIS_SERIENF
'Configurações da NF - Essa sim é a configuração da NF, pois a outra
NF_GRAFICA refere-se a configuração de pedidos para a piratini ferrementas';

